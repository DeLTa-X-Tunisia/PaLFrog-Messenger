var m6=Object.defineProperty;var g6=(t,e,n)=>e in t?m6(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var $e=(t,e,n)=>(g6(t,typeof e!="symbol"?e+"":e,n),n);function y6(t,e){for(var n=0;n<e.length;n++){const s=e[n];if(typeof s!="string"&&!Array.isArray(s)){for(const r in s)if(r!=="default"&&!(r in t)){const i=Object.getOwnPropertyDescriptor(s,r);i&&Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:()=>s[r]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}})();var Wc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};function bp(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function x6(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function s(){return this instanceof s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(s){var r=Object.getOwnPropertyDescriptor(t,s);Object.defineProperty(n,s,r.get?r:{enumerable:!0,get:function(){return t[s]}})}),n}var sL={exports:{}},Vx={},rL={exports:{}},Ye={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vp=Symbol.for("react.element"),b6=Symbol.for("react.portal"),v6=Symbol.for("react.fragment"),w6=Symbol.for("react.strict_mode"),S6=Symbol.for("react.profiler"),k6=Symbol.for("react.provider"),C6=Symbol.for("react.context"),N6=Symbol.for("react.forward_ref"),T6=Symbol.for("react.suspense"),E6=Symbol.for("react.memo"),I6=Symbol.for("react.lazy"),RA=Symbol.iterator;function A6(t){return t===null||typeof t!="object"?null:(t=RA&&t[RA]||t["@@iterator"],typeof t=="function"?t:null)}var iL={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},oL=Object.assign,aL={};function Bd(t,e,n){this.props=t,this.context=e,this.refs=aL,this.updater=n||iL}Bd.prototype.isReactComponent={};Bd.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Bd.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function lL(){}lL.prototype=Bd.prototype;function uN(t,e,n){this.props=t,this.context=e,this.refs=aL,this.updater=n||iL}var dN=uN.prototype=new lL;dN.constructor=uN;oL(dN,Bd.prototype);dN.isPureReactComponent=!0;var DA=Array.isArray,cL=Object.prototype.hasOwnProperty,hN={current:null},uL={key:!0,ref:!0,__self:!0,__source:!0};function dL(t,e,n){var s,r={},i=null,o=null;if(e!=null)for(s in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)cL.call(e,s)&&!uL.hasOwnProperty(s)&&(r[s]=e[s]);var a=arguments.length-2;if(a===1)r.children=n;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];r.children=l}if(t&&t.defaultProps)for(s in a=t.defaultProps,a)r[s]===void 0&&(r[s]=a[s]);return{$$typeof:vp,type:t,key:i,ref:o,props:r,_owner:hN.current}}function $6(t,e){return{$$typeof:vp,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function fN(t){return typeof t=="object"&&t!==null&&t.$$typeof===vp}function R6(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var OA=/\/+/g;function S1(t,e){return typeof t=="object"&&t!==null&&t.key!=null?R6(""+t.key):e.toString(36)}function oy(t,e,n,s,r){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case vp:case b6:o=!0}}if(o)return o=t,r=r(o),t=s===""?"."+S1(o,0):s,DA(r)?(n="",t!=null&&(n=t.replace(OA,"$&/")+"/"),oy(r,e,n,"",function(c){return c})):r!=null&&(fN(r)&&(r=$6(r,n+(!r.key||o&&o.key===r.key?"":(""+r.key).replace(OA,"$&/")+"/")+t)),e.push(r)),1;if(o=0,s=s===""?".":s+":",DA(t))for(var a=0;a<t.length;a++){i=t[a];var l=s+S1(i,a);o+=oy(i,e,n,l,r)}else if(l=A6(t),typeof l=="function")for(t=l.call(t),a=0;!(i=t.next()).done;)i=i.value,l=s+S1(i,a++),o+=oy(i,e,n,l,r);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function rg(t,e,n){if(t==null)return t;var s=[],r=0;return oy(t,s,"","",function(i){return e.call(n,i,r++)}),s}function D6(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Hs={current:null},ay={transition:null},O6={ReactCurrentDispatcher:Hs,ReactCurrentBatchConfig:ay,ReactCurrentOwner:hN};function hL(){throw Error("act(...) is not supported in production builds of React.")}Ye.Children={map:rg,forEach:function(t,e,n){rg(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return rg(t,function(){e++}),e},toArray:function(t){return rg(t,function(e){return e})||[]},only:function(t){if(!fN(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Ye.Component=Bd;Ye.Fragment=v6;Ye.Profiler=S6;Ye.PureComponent=uN;Ye.StrictMode=w6;Ye.Suspense=T6;Ye.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=O6;Ye.act=hL;Ye.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var s=oL({},t.props),r=t.key,i=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=hN.current),e.key!==void 0&&(r=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)cL.call(e,l)&&!uL.hasOwnProperty(l)&&(s[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)s.children=n;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];s.children=a}return{$$typeof:vp,type:t.type,key:r,ref:i,props:s,_owner:o}};Ye.createContext=function(t){return t={$$typeof:C6,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:k6,_context:t},t.Consumer=t};Ye.createElement=dL;Ye.createFactory=function(t){var e=dL.bind(null,t);return e.type=t,e};Ye.createRef=function(){return{current:null}};Ye.forwardRef=function(t){return{$$typeof:N6,render:t}};Ye.isValidElement=fN;Ye.lazy=function(t){return{$$typeof:I6,_payload:{_status:-1,_result:t},_init:D6}};Ye.memo=function(t,e){return{$$typeof:E6,type:t,compare:e===void 0?null:e}};Ye.startTransition=function(t){var e=ay.transition;ay.transition={};try{t()}finally{ay.transition=e}};Ye.unstable_act=hL;Ye.useCallback=function(t,e){return Hs.current.useCallback(t,e)};Ye.useContext=function(t){return Hs.current.useContext(t)};Ye.useDebugValue=function(){};Ye.useDeferredValue=function(t){return Hs.current.useDeferredValue(t)};Ye.useEffect=function(t,e){return Hs.current.useEffect(t,e)};Ye.useId=function(){return Hs.current.useId()};Ye.useImperativeHandle=function(t,e,n){return Hs.current.useImperativeHandle(t,e,n)};Ye.useInsertionEffect=function(t,e){return Hs.current.useInsertionEffect(t,e)};Ye.useLayoutEffect=function(t,e){return Hs.current.useLayoutEffect(t,e)};Ye.useMemo=function(t,e){return Hs.current.useMemo(t,e)};Ye.useReducer=function(t,e,n){return Hs.current.useReducer(t,e,n)};Ye.useRef=function(t){return Hs.current.useRef(t)};Ye.useState=function(t){return Hs.current.useState(t)};Ye.useSyncExternalStore=function(t,e,n){return Hs.current.useSyncExternalStore(t,e,n)};Ye.useTransition=function(){return Hs.current.useTransition()};Ye.version="18.3.1";rL.exports=Ye;var z=rL.exports;const Fs=bp(z);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var M6=z,P6=Symbol.for("react.element"),L6=Symbol.for("react.fragment"),F6=Object.prototype.hasOwnProperty,_6=M6.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,z6={key:!0,ref:!0,__self:!0,__source:!0};function fL(t,e,n){var s,r={},i=null,o=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(s in e)F6.call(e,s)&&!z6.hasOwnProperty(s)&&(r[s]=e[s]);if(t&&t.defaultProps)for(s in e=t.defaultProps,e)r[s]===void 0&&(r[s]=e[s]);return{$$typeof:P6,type:t,key:i,ref:o,props:r,_owner:_6.current}}Vx.Fragment=L6;Vx.jsx=fL;Vx.jsxs=fL;sL.exports=Vx;var b=sL.exports,mS={},pL={exports:{}},Nr={},mL={exports:{}},gL={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e($,U){var K=$.length;$.push(U);e:for(;0<K;){var j=K-1>>>1,ee=$[j];if(0<r(ee,U))$[j]=U,$[K]=ee,K=j;else break e}}function n($){return $.length===0?null:$[0]}function s($){if($.length===0)return null;var U=$[0],K=$.pop();if(K!==U){$[0]=K;e:for(var j=0,ee=$.length,Z=ee>>>1;j<Z;){var re=2*(j+1)-1,te=$[re],le=re+1,pe=$[le];if(0>r(te,K))le<ee&&0>r(pe,te)?($[j]=pe,$[le]=K,j=le):($[j]=te,$[re]=K,j=re);else if(le<ee&&0>r(pe,K))$[j]=pe,$[le]=K,j=le;else break e}}return U}function r($,U){var K=$.sortIndex-U.sortIndex;return K!==0?K:$.id-U.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,d=null,h=3,f=!1,p=!1,m=!1,g=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function v($){for(var U=n(c);U!==null;){if(U.callback===null)s(c);else if(U.startTime<=$)s(c),U.sortIndex=U.expirationTime,e(l,U);else break;U=n(c)}}function w($){if(m=!1,v($),!p)if(n(l)!==null)p=!0,L(S);else{var U=n(c);U!==null&&G(w,U.startTime-$)}}function S($,U){p=!1,m&&(m=!1,y(N),N=-1),f=!0;var K=h;try{for(v(U),d=n(l);d!==null&&(!(d.expirationTime>U)||$&&!D());){var j=d.callback;if(typeof j=="function"){d.callback=null,h=d.priorityLevel;var ee=j(d.expirationTime<=U);U=t.unstable_now(),typeof ee=="function"?d.callback=ee:d===n(l)&&s(l),v(U)}else s(l);d=n(l)}if(d!==null)var Z=!0;else{var re=n(c);re!==null&&G(w,re.startTime-U),Z=!1}return Z}finally{d=null,h=K,f=!1}}var k=!1,C=null,N=-1,T=5,I=-1;function D(){return!(t.unstable_now()-I<T)}function F(){if(C!==null){var $=t.unstable_now();I=$;var U=!0;try{U=C(!0,$)}finally{U?A():(k=!1,C=null)}}else k=!1}var A;if(typeof x=="function")A=function(){x(F)};else if(typeof MessageChannel<"u"){var O=new MessageChannel,P=O.port2;O.port1.onmessage=F,A=function(){P.postMessage(null)}}else A=function(){g(F,0)};function L($){C=$,k||(k=!0,A())}function G($,U){N=g(function(){$(t.unstable_now())},U)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function($){$.callback=null},t.unstable_continueExecution=function(){p||f||(p=!0,L(S))},t.unstable_forceFrameRate=function($){0>$||125<$?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<$?Math.floor(1e3/$):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function($){switch(h){case 1:case 2:case 3:var U=3;break;default:U=h}var K=h;h=U;try{return $()}finally{h=K}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function($,U){switch($){case 1:case 2:case 3:case 4:case 5:break;default:$=3}var K=h;h=$;try{return U()}finally{h=K}},t.unstable_scheduleCallback=function($,U,K){var j=t.unstable_now();switch(typeof K=="object"&&K!==null?(K=K.delay,K=typeof K=="number"&&0<K?j+K:j):K=j,$){case 1:var ee=-1;break;case 2:ee=250;break;case 5:ee=1073741823;break;case 4:ee=1e4;break;default:ee=5e3}return ee=K+ee,$={id:u++,callback:U,priorityLevel:$,startTime:K,expirationTime:ee,sortIndex:-1},K>j?($.sortIndex=K,e(c,$),n(l)===null&&$===n(c)&&(m?(y(N),N=-1):m=!0,G(w,K-j))):($.sortIndex=ee,e(l,$),p||f||(p=!0,L(S))),$},t.unstable_shouldYield=D,t.unstable_wrapCallback=function($){var U=h;return function(){var K=h;h=U;try{return $.apply(this,arguments)}finally{h=K}}}})(gL);mL.exports=gL;var B6=mL.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var j6=z,Sr=B6;function ae(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var yL=new Set,Ef={};function Hc(t,e){cd(t,e),cd(t+"Capture",e)}function cd(t,e){for(Ef[t]=e,t=0;t<e.length;t++)yL.add(e[t])}var Jo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),gS=Object.prototype.hasOwnProperty,V6=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,MA={},PA={};function U6(t){return gS.call(PA,t)?!0:gS.call(MA,t)?!1:V6.test(t)?PA[t]=!0:(MA[t]=!0,!1)}function W6(t,e,n,s){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return s?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function H6(t,e,n,s){if(e===null||typeof e>"u"||W6(t,e,n,s))return!0;if(s)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Gs(t,e,n,s,r,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=s,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var ts={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){ts[t]=new Gs(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];ts[e]=new Gs(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){ts[t]=new Gs(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){ts[t]=new Gs(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){ts[t]=new Gs(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){ts[t]=new Gs(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){ts[t]=new Gs(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){ts[t]=new Gs(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){ts[t]=new Gs(t,5,!1,t.toLowerCase(),null,!1,!1)});var pN=/[\-:]([a-z])/g;function mN(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(pN,mN);ts[e]=new Gs(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(pN,mN);ts[e]=new Gs(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(pN,mN);ts[e]=new Gs(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){ts[t]=new Gs(t,1,!1,t.toLowerCase(),null,!1,!1)});ts.xlinkHref=new Gs("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){ts[t]=new Gs(t,1,!1,t.toLowerCase(),null,!0,!0)});function gN(t,e,n,s){var r=ts.hasOwnProperty(e)?ts[e]:null;(r!==null?r.type!==0:s||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(H6(e,n,r,s)&&(n=null),s||r===null?U6(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):r.mustUseProperty?t[r.propertyName]=n===null?r.type===3?!1:"":n:(e=r.attributeName,s=r.attributeNamespace,n===null?t.removeAttribute(e):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,s?t.setAttributeNS(s,e,n):t.setAttribute(e,n))))}var oa=j6.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ig=Symbol.for("react.element"),$u=Symbol.for("react.portal"),Ru=Symbol.for("react.fragment"),yN=Symbol.for("react.strict_mode"),yS=Symbol.for("react.profiler"),xL=Symbol.for("react.provider"),bL=Symbol.for("react.context"),xN=Symbol.for("react.forward_ref"),xS=Symbol.for("react.suspense"),bS=Symbol.for("react.suspense_list"),bN=Symbol.for("react.memo"),ya=Symbol.for("react.lazy"),vL=Symbol.for("react.offscreen"),LA=Symbol.iterator;function uh(t){return t===null||typeof t!="object"?null:(t=LA&&t[LA]||t["@@iterator"],typeof t=="function"?t:null)}var Ht=Object.assign,k1;function Lh(t){if(k1===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);k1=e&&e[1]||""}return`
`+k1+t}var C1=!1;function N1(t,e){if(!t||C1)return"";C1=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var s=c}Reflect.construct(t,[],e)}else{try{e.call()}catch(c){s=c}t.call(e.prototype)}else{try{throw Error()}catch(c){s=c}t()}}catch(c){if(c&&s&&typeof c.stack=="string"){for(var r=c.stack.split(`
`),i=s.stack.split(`
`),o=r.length-1,a=i.length-1;1<=o&&0<=a&&r[o]!==i[a];)a--;for(;1<=o&&0<=a;o--,a--)if(r[o]!==i[a]){if(o!==1||a!==1)do if(o--,a--,0>a||r[o]!==i[a]){var l=`
`+r[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=a);break}}}finally{C1=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Lh(t):""}function G6(t){switch(t.tag){case 5:return Lh(t.type);case 16:return Lh("Lazy");case 13:return Lh("Suspense");case 19:return Lh("SuspenseList");case 0:case 2:case 15:return t=N1(t.type,!1),t;case 11:return t=N1(t.type.render,!1),t;case 1:return t=N1(t.type,!0),t;default:return""}}function vS(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Ru:return"Fragment";case $u:return"Portal";case yS:return"Profiler";case yN:return"StrictMode";case xS:return"Suspense";case bS:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case bL:return(t.displayName||"Context")+".Consumer";case xL:return(t._context.displayName||"Context")+".Provider";case xN:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case bN:return e=t.displayName||null,e!==null?e:vS(t.type)||"Memo";case ya:e=t._payload,t=t._init;try{return vS(t(e))}catch{}}return null}function K6(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return vS(e);case 8:return e===yN?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function nl(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function wL(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function q6(t){var e=wL(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),s=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(o){s=""+o,i.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return s},setValue:function(o){s=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function og(t){t._valueTracker||(t._valueTracker=q6(t))}function SL(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),s="";return t&&(s=wL(t)?t.checked?"true":"false":t.value),t=s,t!==n?(e.setValue(t),!0):!1}function zy(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function wS(t,e){var n=e.checked;return Ht({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function FA(t,e){var n=e.defaultValue==null?"":e.defaultValue,s=e.checked!=null?e.checked:e.defaultChecked;n=nl(e.value!=null?e.value:n),t._wrapperState={initialChecked:s,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function kL(t,e){e=e.checked,e!=null&&gN(t,"checked",e,!1)}function SS(t,e){kL(t,e);var n=nl(e.value),s=e.type;if(n!=null)s==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(s==="submit"||s==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?kS(t,e.type,n):e.hasOwnProperty("defaultValue")&&kS(t,e.type,nl(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function _A(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var s=e.type;if(!(s!=="submit"&&s!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function kS(t,e,n){(e!=="number"||zy(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Fh=Array.isArray;function qu(t,e,n,s){if(t=t.options,e){e={};for(var r=0;r<n.length;r++)e["$"+n[r]]=!0;for(n=0;n<t.length;n++)r=e.hasOwnProperty("$"+t[n].value),t[n].selected!==r&&(t[n].selected=r),r&&s&&(t[n].defaultSelected=!0)}else{for(n=""+nl(n),e=null,r=0;r<t.length;r++){if(t[r].value===n){t[r].selected=!0,s&&(t[r].defaultSelected=!0);return}e!==null||t[r].disabled||(e=t[r])}e!==null&&(e.selected=!0)}}function CS(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(ae(91));return Ht({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function zA(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(ae(92));if(Fh(n)){if(1<n.length)throw Error(ae(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:nl(n)}}function CL(t,e){var n=nl(e.value),s=nl(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),s!=null&&(t.defaultValue=""+s)}function BA(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function NL(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function NS(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?NL(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var ag,TL=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,s,r){MSApp.execUnsafeLocalFunction(function(){return t(e,n,s,r)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(ag=ag||document.createElement("div"),ag.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=ag.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function If(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Zh={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},X6=["Webkit","ms","Moz","O"];Object.keys(Zh).forEach(function(t){X6.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Zh[e]=Zh[t]})});function EL(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Zh.hasOwnProperty(t)&&Zh[t]?(""+e).trim():e+"px"}function IL(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var s=n.indexOf("--")===0,r=EL(n,e[n],s);n==="float"&&(n="cssFloat"),s?t.setProperty(n,r):t[n]=r}}var J6=Ht({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function TS(t,e){if(e){if(J6[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(ae(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(ae(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(ae(61))}if(e.style!=null&&typeof e.style!="object")throw Error(ae(62))}}function ES(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var IS=null;function vN(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var AS=null,Xu=null,Ju=null;function jA(t){if(t=kp(t)){if(typeof AS!="function")throw Error(ae(280));var e=t.stateNode;e&&(e=Kx(e),AS(t.stateNode,t.type,e))}}function AL(t){Xu?Ju?Ju.push(t):Ju=[t]:Xu=t}function $L(){if(Xu){var t=Xu,e=Ju;if(Ju=Xu=null,jA(t),e)for(t=0;t<e.length;t++)jA(e[t])}}function RL(t,e){return t(e)}function DL(){}var T1=!1;function OL(t,e,n){if(T1)return t(e,n);T1=!0;try{return RL(t,e,n)}finally{T1=!1,(Xu!==null||Ju!==null)&&(DL(),$L())}}function Af(t,e){var n=t.stateNode;if(n===null)return null;var s=Kx(n);if(s===null)return null;n=s[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(t=t.type,s=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!s;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(ae(231,e,typeof n));return n}var $S=!1;if(Jo)try{var dh={};Object.defineProperty(dh,"passive",{get:function(){$S=!0}}),window.addEventListener("test",dh,dh),window.removeEventListener("test",dh,dh)}catch{$S=!1}function Y6(t,e,n,s,r,i,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(n,c)}catch(u){this.onError(u)}}var ef=!1,By=null,jy=!1,RS=null,Q6={onError:function(t){ef=!0,By=t}};function Z6(t,e,n,s,r,i,o,a,l){ef=!1,By=null,Y6.apply(Q6,arguments)}function eK(t,e,n,s,r,i,o,a,l){if(Z6.apply(this,arguments),ef){if(ef){var c=By;ef=!1,By=null}else throw Error(ae(198));jy||(jy=!0,RS=c)}}function Gc(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function ML(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function VA(t){if(Gc(t)!==t)throw Error(ae(188))}function tK(t){var e=t.alternate;if(!e){if(e=Gc(t),e===null)throw Error(ae(188));return e!==t?null:t}for(var n=t,s=e;;){var r=n.return;if(r===null)break;var i=r.alternate;if(i===null){if(s=r.return,s!==null){n=s;continue}break}if(r.child===i.child){for(i=r.child;i;){if(i===n)return VA(r),t;if(i===s)return VA(r),e;i=i.sibling}throw Error(ae(188))}if(n.return!==s.return)n=r,s=i;else{for(var o=!1,a=r.child;a;){if(a===n){o=!0,n=r,s=i;break}if(a===s){o=!0,s=r,n=i;break}a=a.sibling}if(!o){for(a=i.child;a;){if(a===n){o=!0,n=i,s=r;break}if(a===s){o=!0,s=i,n=r;break}a=a.sibling}if(!o)throw Error(ae(189))}}if(n.alternate!==s)throw Error(ae(190))}if(n.tag!==3)throw Error(ae(188));return n.stateNode.current===n?t:e}function PL(t){return t=tK(t),t!==null?LL(t):null}function LL(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=LL(t);if(e!==null)return e;t=t.sibling}return null}var FL=Sr.unstable_scheduleCallback,UA=Sr.unstable_cancelCallback,nK=Sr.unstable_shouldYield,sK=Sr.unstable_requestPaint,an=Sr.unstable_now,rK=Sr.unstable_getCurrentPriorityLevel,wN=Sr.unstable_ImmediatePriority,_L=Sr.unstable_UserBlockingPriority,Vy=Sr.unstable_NormalPriority,iK=Sr.unstable_LowPriority,zL=Sr.unstable_IdlePriority,Ux=null,no=null;function oK(t){if(no&&typeof no.onCommitFiberRoot=="function")try{no.onCommitFiberRoot(Ux,t,void 0,(t.current.flags&128)===128)}catch{}}var Ci=Math.clz32?Math.clz32:cK,aK=Math.log,lK=Math.LN2;function cK(t){return t>>>=0,t===0?32:31-(aK(t)/lK|0)|0}var lg=64,cg=4194304;function _h(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Uy(t,e){var n=t.pendingLanes;if(n===0)return 0;var s=0,r=t.suspendedLanes,i=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~r;a!==0?s=_h(a):(i&=o,i!==0&&(s=_h(i)))}else o=n&~r,o!==0?s=_h(o):i!==0&&(s=_h(i));if(s===0)return 0;if(e!==0&&e!==s&&!(e&r)&&(r=s&-s,i=e&-e,r>=i||r===16&&(i&4194240)!==0))return e;if(s&4&&(s|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=s;0<e;)n=31-Ci(e),r=1<<n,s|=t[n],e&=~r;return s}function uK(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function dK(t,e){for(var n=t.suspendedLanes,s=t.pingedLanes,r=t.expirationTimes,i=t.pendingLanes;0<i;){var o=31-Ci(i),a=1<<o,l=r[o];l===-1?(!(a&n)||a&s)&&(r[o]=uK(a,e)):l<=e&&(t.expiredLanes|=a),i&=~a}}function DS(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function BL(){var t=lg;return lg<<=1,!(lg&4194240)&&(lg=64),t}function E1(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function wp(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Ci(e),t[e]=n}function hK(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var s=t.eventTimes;for(t=t.expirationTimes;0<n;){var r=31-Ci(n),i=1<<r;e[r]=0,s[r]=-1,t[r]=-1,n&=~i}}function SN(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var s=31-Ci(n),r=1<<s;r&e|t[s]&e&&(t[s]|=e),n&=~r}}var mt=0;function jL(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var VL,kN,UL,WL,HL,OS=!1,ug=[],Fa=null,_a=null,za=null,$f=new Map,Rf=new Map,Ca=[],fK="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function WA(t,e){switch(t){case"focusin":case"focusout":Fa=null;break;case"dragenter":case"dragleave":_a=null;break;case"mouseover":case"mouseout":za=null;break;case"pointerover":case"pointerout":$f.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Rf.delete(e.pointerId)}}function hh(t,e,n,s,r,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:s,nativeEvent:i,targetContainers:[r]},e!==null&&(e=kp(e),e!==null&&kN(e)),t):(t.eventSystemFlags|=s,e=t.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),t)}function pK(t,e,n,s,r){switch(e){case"focusin":return Fa=hh(Fa,t,e,n,s,r),!0;case"dragenter":return _a=hh(_a,t,e,n,s,r),!0;case"mouseover":return za=hh(za,t,e,n,s,r),!0;case"pointerover":var i=r.pointerId;return $f.set(i,hh($f.get(i)||null,t,e,n,s,r)),!0;case"gotpointercapture":return i=r.pointerId,Rf.set(i,hh(Rf.get(i)||null,t,e,n,s,r)),!0}return!1}function GL(t){var e=Xl(t.target);if(e!==null){var n=Gc(e);if(n!==null){if(e=n.tag,e===13){if(e=ML(n),e!==null){t.blockedOn=e,HL(t.priority,function(){UL(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function ly(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=MS(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var s=new n.constructor(n.type,n);IS=s,n.target.dispatchEvent(s),IS=null}else return e=kp(n),e!==null&&kN(e),t.blockedOn=n,!1;e.shift()}return!0}function HA(t,e,n){ly(t)&&n.delete(e)}function mK(){OS=!1,Fa!==null&&ly(Fa)&&(Fa=null),_a!==null&&ly(_a)&&(_a=null),za!==null&&ly(za)&&(za=null),$f.forEach(HA),Rf.forEach(HA)}function fh(t,e){t.blockedOn===e&&(t.blockedOn=null,OS||(OS=!0,Sr.unstable_scheduleCallback(Sr.unstable_NormalPriority,mK)))}function Df(t){function e(r){return fh(r,t)}if(0<ug.length){fh(ug[0],t);for(var n=1;n<ug.length;n++){var s=ug[n];s.blockedOn===t&&(s.blockedOn=null)}}for(Fa!==null&&fh(Fa,t),_a!==null&&fh(_a,t),za!==null&&fh(za,t),$f.forEach(e),Rf.forEach(e),n=0;n<Ca.length;n++)s=Ca[n],s.blockedOn===t&&(s.blockedOn=null);for(;0<Ca.length&&(n=Ca[0],n.blockedOn===null);)GL(n),n.blockedOn===null&&Ca.shift()}var Yu=oa.ReactCurrentBatchConfig,Wy=!0;function gK(t,e,n,s){var r=mt,i=Yu.transition;Yu.transition=null;try{mt=1,CN(t,e,n,s)}finally{mt=r,Yu.transition=i}}function yK(t,e,n,s){var r=mt,i=Yu.transition;Yu.transition=null;try{mt=4,CN(t,e,n,s)}finally{mt=r,Yu.transition=i}}function CN(t,e,n,s){if(Wy){var r=MS(t,e,n,s);if(r===null)F1(t,e,s,Hy,n),WA(t,s);else if(pK(r,t,e,n,s))s.stopPropagation();else if(WA(t,s),e&4&&-1<fK.indexOf(t)){for(;r!==null;){var i=kp(r);if(i!==null&&VL(i),i=MS(t,e,n,s),i===null&&F1(t,e,s,Hy,n),i===r)break;r=i}r!==null&&s.stopPropagation()}else F1(t,e,s,null,n)}}var Hy=null;function MS(t,e,n,s){if(Hy=null,t=vN(s),t=Xl(t),t!==null)if(e=Gc(t),e===null)t=null;else if(n=e.tag,n===13){if(t=ML(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Hy=t,null}function KL(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(rK()){case wN:return 1;case _L:return 4;case Vy:case iK:return 16;case zL:return 536870912;default:return 16}default:return 16}}var Aa=null,NN=null,cy=null;function qL(){if(cy)return cy;var t,e=NN,n=e.length,s,r="value"in Aa?Aa.value:Aa.textContent,i=r.length;for(t=0;t<n&&e[t]===r[t];t++);var o=n-t;for(s=1;s<=o&&e[n-s]===r[i-s];s++);return cy=r.slice(t,1<s?1-s:void 0)}function uy(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function dg(){return!0}function GA(){return!1}function Tr(t){function e(n,s,r,i,o){this._reactName=n,this._targetInst=r,this.type=s,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(i):i[a]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?dg:GA,this.isPropagationStopped=GA,this}return Ht(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=dg)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=dg)},persist:function(){},isPersistent:dg}),e}var jd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},TN=Tr(jd),Sp=Ht({},jd,{view:0,detail:0}),xK=Tr(Sp),I1,A1,ph,Wx=Ht({},Sp,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:EN,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==ph&&(ph&&t.type==="mousemove"?(I1=t.screenX-ph.screenX,A1=t.screenY-ph.screenY):A1=I1=0,ph=t),I1)},movementY:function(t){return"movementY"in t?t.movementY:A1}}),KA=Tr(Wx),bK=Ht({},Wx,{dataTransfer:0}),vK=Tr(bK),wK=Ht({},Sp,{relatedTarget:0}),$1=Tr(wK),SK=Ht({},jd,{animationName:0,elapsedTime:0,pseudoElement:0}),kK=Tr(SK),CK=Ht({},jd,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),NK=Tr(CK),TK=Ht({},jd,{data:0}),qA=Tr(TK),EK={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},IK={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},AK={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function $K(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=AK[t])?!!e[t]:!1}function EN(){return $K}var RK=Ht({},Sp,{key:function(t){if(t.key){var e=EK[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=uy(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?IK[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:EN,charCode:function(t){return t.type==="keypress"?uy(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?uy(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),DK=Tr(RK),OK=Ht({},Wx,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),XA=Tr(OK),MK=Ht({},Sp,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:EN}),PK=Tr(MK),LK=Ht({},jd,{propertyName:0,elapsedTime:0,pseudoElement:0}),FK=Tr(LK),_K=Ht({},Wx,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),zK=Tr(_K),BK=[9,13,27,32],IN=Jo&&"CompositionEvent"in window,tf=null;Jo&&"documentMode"in document&&(tf=document.documentMode);var jK=Jo&&"TextEvent"in window&&!tf,XL=Jo&&(!IN||tf&&8<tf&&11>=tf),JA=String.fromCharCode(32),YA=!1;function JL(t,e){switch(t){case"keyup":return BK.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function YL(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Du=!1;function VK(t,e){switch(t){case"compositionend":return YL(e);case"keypress":return e.which!==32?null:(YA=!0,JA);case"textInput":return t=e.data,t===JA&&YA?null:t;default:return null}}function UK(t,e){if(Du)return t==="compositionend"||!IN&&JL(t,e)?(t=qL(),cy=NN=Aa=null,Du=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return XL&&e.locale!=="ko"?null:e.data;default:return null}}var WK={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function QA(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!WK[t.type]:e==="textarea"}function QL(t,e,n,s){AL(s),e=Gy(e,"onChange"),0<e.length&&(n=new TN("onChange","change",null,n,s),t.push({event:n,listeners:e}))}var nf=null,Of=null;function HK(t){cF(t,0)}function Hx(t){var e=Pu(t);if(SL(e))return t}function GK(t,e){if(t==="change")return e}var ZL=!1;if(Jo){var R1;if(Jo){var D1="oninput"in document;if(!D1){var ZA=document.createElement("div");ZA.setAttribute("oninput","return;"),D1=typeof ZA.oninput=="function"}R1=D1}else R1=!1;ZL=R1&&(!document.documentMode||9<document.documentMode)}function e$(){nf&&(nf.detachEvent("onpropertychange",eF),Of=nf=null)}function eF(t){if(t.propertyName==="value"&&Hx(Of)){var e=[];QL(e,Of,t,vN(t)),OL(HK,e)}}function KK(t,e,n){t==="focusin"?(e$(),nf=e,Of=n,nf.attachEvent("onpropertychange",eF)):t==="focusout"&&e$()}function qK(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Hx(Of)}function XK(t,e){if(t==="click")return Hx(e)}function JK(t,e){if(t==="input"||t==="change")return Hx(e)}function YK(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Ri=typeof Object.is=="function"?Object.is:YK;function Mf(t,e){if(Ri(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),s=Object.keys(e);if(n.length!==s.length)return!1;for(s=0;s<n.length;s++){var r=n[s];if(!gS.call(e,r)||!Ri(t[r],e[r]))return!1}return!0}function t$(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function n$(t,e){var n=t$(t);t=0;for(var s;n;){if(n.nodeType===3){if(s=t+n.textContent.length,t<=e&&s>=e)return{node:n,offset:e-t};t=s}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=t$(n)}}function tF(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?tF(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function nF(){for(var t=window,e=zy();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=zy(t.document)}return e}function AN(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function QK(t){var e=nF(),n=t.focusedElem,s=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&tF(n.ownerDocument.documentElement,n)){if(s!==null&&AN(n)){if(e=s.start,t=s.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var r=n.textContent.length,i=Math.min(s.start,r);s=s.end===void 0?i:Math.min(s.end,r),!t.extend&&i>s&&(r=s,s=i,i=r),r=n$(n,i);var o=n$(n,s);r&&o&&(t.rangeCount!==1||t.anchorNode!==r.node||t.anchorOffset!==r.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),t.removeAllRanges(),i>s?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var ZK=Jo&&"documentMode"in document&&11>=document.documentMode,Ou=null,PS=null,sf=null,LS=!1;function s$(t,e,n){var s=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;LS||Ou==null||Ou!==zy(s)||(s=Ou,"selectionStart"in s&&AN(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),sf&&Mf(sf,s)||(sf=s,s=Gy(PS,"onSelect"),0<s.length&&(e=new TN("onSelect","select",null,e,n),t.push({event:e,listeners:s}),e.target=Ou)))}function hg(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Mu={animationend:hg("Animation","AnimationEnd"),animationiteration:hg("Animation","AnimationIteration"),animationstart:hg("Animation","AnimationStart"),transitionend:hg("Transition","TransitionEnd")},O1={},sF={};Jo&&(sF=document.createElement("div").style,"AnimationEvent"in window||(delete Mu.animationend.animation,delete Mu.animationiteration.animation,delete Mu.animationstart.animation),"TransitionEvent"in window||delete Mu.transitionend.transition);function Gx(t){if(O1[t])return O1[t];if(!Mu[t])return t;var e=Mu[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in sF)return O1[t]=e[n];return t}var rF=Gx("animationend"),iF=Gx("animationiteration"),oF=Gx("animationstart"),aF=Gx("transitionend"),lF=new Map,r$="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function pl(t,e){lF.set(t,e),Hc(e,[t])}for(var M1=0;M1<r$.length;M1++){var P1=r$[M1],e8=P1.toLowerCase(),t8=P1[0].toUpperCase()+P1.slice(1);pl(e8,"on"+t8)}pl(rF,"onAnimationEnd");pl(iF,"onAnimationIteration");pl(oF,"onAnimationStart");pl("dblclick","onDoubleClick");pl("focusin","onFocus");pl("focusout","onBlur");pl(aF,"onTransitionEnd");cd("onMouseEnter",["mouseout","mouseover"]);cd("onMouseLeave",["mouseout","mouseover"]);cd("onPointerEnter",["pointerout","pointerover"]);cd("onPointerLeave",["pointerout","pointerover"]);Hc("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Hc("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Hc("onBeforeInput",["compositionend","keypress","textInput","paste"]);Hc("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Hc("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Hc("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var zh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),n8=new Set("cancel close invalid load scroll toggle".split(" ").concat(zh));function i$(t,e,n){var s=t.type||"unknown-event";t.currentTarget=n,eK(s,e,void 0,t),t.currentTarget=null}function cF(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var s=t[n],r=s.event;s=s.listeners;e:{var i=void 0;if(e)for(var o=s.length-1;0<=o;o--){var a=s[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==i&&r.isPropagationStopped())break e;i$(r,a,c),i=l}else for(o=0;o<s.length;o++){if(a=s[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==i&&r.isPropagationStopped())break e;i$(r,a,c),i=l}}}if(jy)throw t=RS,jy=!1,RS=null,t}function At(t,e){var n=e[jS];n===void 0&&(n=e[jS]=new Set);var s=t+"__bubble";n.has(s)||(uF(e,t,2,!1),n.add(s))}function L1(t,e,n){var s=0;e&&(s|=4),uF(n,t,s,e)}var fg="_reactListening"+Math.random().toString(36).slice(2);function Pf(t){if(!t[fg]){t[fg]=!0,yL.forEach(function(n){n!=="selectionchange"&&(n8.has(n)||L1(n,!1,t),L1(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[fg]||(e[fg]=!0,L1("selectionchange",!1,e))}}function uF(t,e,n,s){switch(KL(e)){case 1:var r=gK;break;case 4:r=yK;break;default:r=CN}n=r.bind(null,e,n,t),r=void 0,!$S||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),s?r!==void 0?t.addEventListener(e,n,{capture:!0,passive:r}):t.addEventListener(e,n,!0):r!==void 0?t.addEventListener(e,n,{passive:r}):t.addEventListener(e,n,!1)}function F1(t,e,n,s,r){var i=s;if(!(e&1)&&!(e&2)&&s!==null)e:for(;;){if(s===null)return;var o=s.tag;if(o===3||o===4){var a=s.stateNode.containerInfo;if(a===r||a.nodeType===8&&a.parentNode===r)break;if(o===4)for(o=s.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===r||l.nodeType===8&&l.parentNode===r))return;o=o.return}for(;a!==null;){if(o=Xl(a),o===null)return;if(l=o.tag,l===5||l===6){s=i=o;continue e}a=a.parentNode}}s=s.return}OL(function(){var c=i,u=vN(n),d=[];e:{var h=lF.get(t);if(h!==void 0){var f=TN,p=t;switch(t){case"keypress":if(uy(n)===0)break e;case"keydown":case"keyup":f=DK;break;case"focusin":p="focus",f=$1;break;case"focusout":p="blur",f=$1;break;case"beforeblur":case"afterblur":f=$1;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=KA;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=vK;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=PK;break;case rF:case iF:case oF:f=kK;break;case aF:f=FK;break;case"scroll":f=xK;break;case"wheel":f=zK;break;case"copy":case"cut":case"paste":f=NK;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=XA}var m=(e&4)!==0,g=!m&&t==="scroll",y=m?h!==null?h+"Capture":null:h;m=[];for(var x=c,v;x!==null;){v=x;var w=v.stateNode;if(v.tag===5&&w!==null&&(v=w,y!==null&&(w=Af(x,y),w!=null&&m.push(Lf(x,w,v)))),g)break;x=x.return}0<m.length&&(h=new f(h,p,null,n,u),d.push({event:h,listeners:m}))}}if(!(e&7)){e:{if(h=t==="mouseover"||t==="pointerover",f=t==="mouseout"||t==="pointerout",h&&n!==IS&&(p=n.relatedTarget||n.fromElement)&&(Xl(p)||p[Yo]))break e;if((f||h)&&(h=u.window===u?u:(h=u.ownerDocument)?h.defaultView||h.parentWindow:window,f?(p=n.relatedTarget||n.toElement,f=c,p=p?Xl(p):null,p!==null&&(g=Gc(p),p!==g||p.tag!==5&&p.tag!==6)&&(p=null)):(f=null,p=c),f!==p)){if(m=KA,w="onMouseLeave",y="onMouseEnter",x="mouse",(t==="pointerout"||t==="pointerover")&&(m=XA,w="onPointerLeave",y="onPointerEnter",x="pointer"),g=f==null?h:Pu(f),v=p==null?h:Pu(p),h=new m(w,x+"leave",f,n,u),h.target=g,h.relatedTarget=v,w=null,Xl(u)===c&&(m=new m(y,x+"enter",p,n,u),m.target=v,m.relatedTarget=g,w=m),g=w,f&&p)t:{for(m=f,y=p,x=0,v=m;v;v=hu(v))x++;for(v=0,w=y;w;w=hu(w))v++;for(;0<x-v;)m=hu(m),x--;for(;0<v-x;)y=hu(y),v--;for(;x--;){if(m===y||y!==null&&m===y.alternate)break t;m=hu(m),y=hu(y)}m=null}else m=null;f!==null&&o$(d,h,f,m,!1),p!==null&&g!==null&&o$(d,g,p,m,!0)}}e:{if(h=c?Pu(c):window,f=h.nodeName&&h.nodeName.toLowerCase(),f==="select"||f==="input"&&h.type==="file")var S=GK;else if(QA(h))if(ZL)S=JK;else{S=qK;var k=KK}else(f=h.nodeName)&&f.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(S=XK);if(S&&(S=S(t,c))){QL(d,S,n,u);break e}k&&k(t,h,c),t==="focusout"&&(k=h._wrapperState)&&k.controlled&&h.type==="number"&&kS(h,"number",h.value)}switch(k=c?Pu(c):window,t){case"focusin":(QA(k)||k.contentEditable==="true")&&(Ou=k,PS=c,sf=null);break;case"focusout":sf=PS=Ou=null;break;case"mousedown":LS=!0;break;case"contextmenu":case"mouseup":case"dragend":LS=!1,s$(d,n,u);break;case"selectionchange":if(ZK)break;case"keydown":case"keyup":s$(d,n,u)}var C;if(IN)e:{switch(t){case"compositionstart":var N="onCompositionStart";break e;case"compositionend":N="onCompositionEnd";break e;case"compositionupdate":N="onCompositionUpdate";break e}N=void 0}else Du?JL(t,n)&&(N="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(N="onCompositionStart");N&&(XL&&n.locale!=="ko"&&(Du||N!=="onCompositionStart"?N==="onCompositionEnd"&&Du&&(C=qL()):(Aa=u,NN="value"in Aa?Aa.value:Aa.textContent,Du=!0)),k=Gy(c,N),0<k.length&&(N=new qA(N,t,null,n,u),d.push({event:N,listeners:k}),C?N.data=C:(C=YL(n),C!==null&&(N.data=C)))),(C=jK?VK(t,n):UK(t,n))&&(c=Gy(c,"onBeforeInput"),0<c.length&&(u=new qA("onBeforeInput","beforeinput",null,n,u),d.push({event:u,listeners:c}),u.data=C))}cF(d,e)})}function Lf(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Gy(t,e){for(var n=e+"Capture",s=[];t!==null;){var r=t,i=r.stateNode;r.tag===5&&i!==null&&(r=i,i=Af(t,n),i!=null&&s.unshift(Lf(t,i,r)),i=Af(t,e),i!=null&&s.push(Lf(t,i,r))),t=t.return}return s}function hu(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function o$(t,e,n,s,r){for(var i=e._reactName,o=[];n!==null&&n!==s;){var a=n,l=a.alternate,c=a.stateNode;if(l!==null&&l===s)break;a.tag===5&&c!==null&&(a=c,r?(l=Af(n,i),l!=null&&o.unshift(Lf(n,l,a))):r||(l=Af(n,i),l!=null&&o.push(Lf(n,l,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var s8=/\r\n?/g,r8=/\u0000|\uFFFD/g;function a$(t){return(typeof t=="string"?t:""+t).replace(s8,`
`).replace(r8,"")}function pg(t,e,n){if(e=a$(e),a$(t)!==e&&n)throw Error(ae(425))}function Ky(){}var FS=null,_S=null;function zS(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var BS=typeof setTimeout=="function"?setTimeout:void 0,i8=typeof clearTimeout=="function"?clearTimeout:void 0,l$=typeof Promise=="function"?Promise:void 0,o8=typeof queueMicrotask=="function"?queueMicrotask:typeof l$<"u"?function(t){return l$.resolve(null).then(t).catch(a8)}:BS;function a8(t){setTimeout(function(){throw t})}function _1(t,e){var n=e,s=0;do{var r=n.nextSibling;if(t.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(s===0){t.removeChild(r),Df(e);return}s--}else n!=="$"&&n!=="$?"&&n!=="$!"||s++;n=r}while(n);Df(e)}function Ba(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function c$(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Vd=Math.random().toString(36).slice(2),Qi="__reactFiber$"+Vd,Ff="__reactProps$"+Vd,Yo="__reactContainer$"+Vd,jS="__reactEvents$"+Vd,l8="__reactListeners$"+Vd,c8="__reactHandles$"+Vd;function Xl(t){var e=t[Qi];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Yo]||n[Qi]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=c$(t);t!==null;){if(n=t[Qi])return n;t=c$(t)}return e}t=n,n=t.parentNode}return null}function kp(t){return t=t[Qi]||t[Yo],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Pu(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(ae(33))}function Kx(t){return t[Ff]||null}var VS=[],Lu=-1;function ml(t){return{current:t}}function Rt(t){0>Lu||(t.current=VS[Lu],VS[Lu]=null,Lu--)}function Nt(t,e){Lu++,VS[Lu]=t.current,t.current=e}var sl={},Ss=ml(sl),nr=ml(!1),xc=sl;function ud(t,e){var n=t.type.contextTypes;if(!n)return sl;var s=t.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===e)return s.__reactInternalMemoizedMaskedChildContext;var r={},i;for(i in n)r[i]=e[i];return s&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=r),r}function sr(t){return t=t.childContextTypes,t!=null}function qy(){Rt(nr),Rt(Ss)}function u$(t,e,n){if(Ss.current!==sl)throw Error(ae(168));Nt(Ss,e),Nt(nr,n)}function dF(t,e,n){var s=t.stateNode;if(e=e.childContextTypes,typeof s.getChildContext!="function")return n;s=s.getChildContext();for(var r in s)if(!(r in e))throw Error(ae(108,K6(t)||"Unknown",r));return Ht({},n,s)}function Xy(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||sl,xc=Ss.current,Nt(Ss,t),Nt(nr,nr.current),!0}function d$(t,e,n){var s=t.stateNode;if(!s)throw Error(ae(169));n?(t=dF(t,e,xc),s.__reactInternalMemoizedMergedChildContext=t,Rt(nr),Rt(Ss),Nt(Ss,t)):Rt(nr),Nt(nr,n)}var Lo=null,qx=!1,z1=!1;function hF(t){Lo===null?Lo=[t]:Lo.push(t)}function u8(t){qx=!0,hF(t)}function gl(){if(!z1&&Lo!==null){z1=!0;var t=0,e=mt;try{var n=Lo;for(mt=1;t<n.length;t++){var s=n[t];do s=s(!0);while(s!==null)}Lo=null,qx=!1}catch(r){throw Lo!==null&&(Lo=Lo.slice(t+1)),FL(wN,gl),r}finally{mt=e,z1=!1}}return null}var Fu=[],_u=0,Jy=null,Yy=0,jr=[],Vr=0,bc=null,zo=1,Bo="";function Bl(t,e){Fu[_u++]=Yy,Fu[_u++]=Jy,Jy=t,Yy=e}function fF(t,e,n){jr[Vr++]=zo,jr[Vr++]=Bo,jr[Vr++]=bc,bc=t;var s=zo;t=Bo;var r=32-Ci(s)-1;s&=~(1<<r),n+=1;var i=32-Ci(e)+r;if(30<i){var o=r-r%5;i=(s&(1<<o)-1).toString(32),s>>=o,r-=o,zo=1<<32-Ci(e)+r|n<<r|s,Bo=i+t}else zo=1<<i|n<<r|s,Bo=t}function $N(t){t.return!==null&&(Bl(t,1),fF(t,1,0))}function RN(t){for(;t===Jy;)Jy=Fu[--_u],Fu[_u]=null,Yy=Fu[--_u],Fu[_u]=null;for(;t===bc;)bc=jr[--Vr],jr[Vr]=null,Bo=jr[--Vr],jr[Vr]=null,zo=jr[--Vr],jr[Vr]=null}var vr=null,xr=null,Ft=!1,xi=null;function pF(t,e){var n=Gr(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function h$(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,vr=t,xr=Ba(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,vr=t,xr=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=bc!==null?{id:zo,overflow:Bo}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Gr(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,vr=t,xr=null,!0):!1;default:return!1}}function US(t){return(t.mode&1)!==0&&(t.flags&128)===0}function WS(t){if(Ft){var e=xr;if(e){var n=e;if(!h$(t,e)){if(US(t))throw Error(ae(418));e=Ba(n.nextSibling);var s=vr;e&&h$(t,e)?pF(s,n):(t.flags=t.flags&-4097|2,Ft=!1,vr=t)}}else{if(US(t))throw Error(ae(418));t.flags=t.flags&-4097|2,Ft=!1,vr=t}}}function f$(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;vr=t}function mg(t){if(t!==vr)return!1;if(!Ft)return f$(t),Ft=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!zS(t.type,t.memoizedProps)),e&&(e=xr)){if(US(t))throw mF(),Error(ae(418));for(;e;)pF(t,e),e=Ba(e.nextSibling)}if(f$(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(ae(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){xr=Ba(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}xr=null}}else xr=vr?Ba(t.stateNode.nextSibling):null;return!0}function mF(){for(var t=xr;t;)t=Ba(t.nextSibling)}function dd(){xr=vr=null,Ft=!1}function DN(t){xi===null?xi=[t]:xi.push(t)}var d8=oa.ReactCurrentBatchConfig;function mh(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(ae(309));var s=n.stateNode}if(!s)throw Error(ae(147,t));var r=s,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var a=r.refs;o===null?delete a[i]:a[i]=o},e._stringRef=i,e)}if(typeof t!="string")throw Error(ae(284));if(!n._owner)throw Error(ae(290,t))}return t}function gg(t,e){throw t=Object.prototype.toString.call(e),Error(ae(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function p$(t){var e=t._init;return e(t._payload)}function gF(t){function e(y,x){if(t){var v=y.deletions;v===null?(y.deletions=[x],y.flags|=16):v.push(x)}}function n(y,x){if(!t)return null;for(;x!==null;)e(y,x),x=x.sibling;return null}function s(y,x){for(y=new Map;x!==null;)x.key!==null?y.set(x.key,x):y.set(x.index,x),x=x.sibling;return y}function r(y,x){return y=Wa(y,x),y.index=0,y.sibling=null,y}function i(y,x,v){return y.index=v,t?(v=y.alternate,v!==null?(v=v.index,v<x?(y.flags|=2,x):v):(y.flags|=2,x)):(y.flags|=1048576,x)}function o(y){return t&&y.alternate===null&&(y.flags|=2),y}function a(y,x,v,w){return x===null||x.tag!==6?(x=G1(v,y.mode,w),x.return=y,x):(x=r(x,v),x.return=y,x)}function l(y,x,v,w){var S=v.type;return S===Ru?u(y,x,v.props.children,w,v.key):x!==null&&(x.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===ya&&p$(S)===x.type)?(w=r(x,v.props),w.ref=mh(y,x,v),w.return=y,w):(w=yy(v.type,v.key,v.props,null,y.mode,w),w.ref=mh(y,x,v),w.return=y,w)}function c(y,x,v,w){return x===null||x.tag!==4||x.stateNode.containerInfo!==v.containerInfo||x.stateNode.implementation!==v.implementation?(x=K1(v,y.mode,w),x.return=y,x):(x=r(x,v.children||[]),x.return=y,x)}function u(y,x,v,w,S){return x===null||x.tag!==7?(x=lc(v,y.mode,w,S),x.return=y,x):(x=r(x,v),x.return=y,x)}function d(y,x,v){if(typeof x=="string"&&x!==""||typeof x=="number")return x=G1(""+x,y.mode,v),x.return=y,x;if(typeof x=="object"&&x!==null){switch(x.$$typeof){case ig:return v=yy(x.type,x.key,x.props,null,y.mode,v),v.ref=mh(y,null,x),v.return=y,v;case $u:return x=K1(x,y.mode,v),x.return=y,x;case ya:var w=x._init;return d(y,w(x._payload),v)}if(Fh(x)||uh(x))return x=lc(x,y.mode,v,null),x.return=y,x;gg(y,x)}return null}function h(y,x,v,w){var S=x!==null?x.key:null;if(typeof v=="string"&&v!==""||typeof v=="number")return S!==null?null:a(y,x,""+v,w);if(typeof v=="object"&&v!==null){switch(v.$$typeof){case ig:return v.key===S?l(y,x,v,w):null;case $u:return v.key===S?c(y,x,v,w):null;case ya:return S=v._init,h(y,x,S(v._payload),w)}if(Fh(v)||uh(v))return S!==null?null:u(y,x,v,w,null);gg(y,v)}return null}function f(y,x,v,w,S){if(typeof w=="string"&&w!==""||typeof w=="number")return y=y.get(v)||null,a(x,y,""+w,S);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case ig:return y=y.get(w.key===null?v:w.key)||null,l(x,y,w,S);case $u:return y=y.get(w.key===null?v:w.key)||null,c(x,y,w,S);case ya:var k=w._init;return f(y,x,v,k(w._payload),S)}if(Fh(w)||uh(w))return y=y.get(v)||null,u(x,y,w,S,null);gg(x,w)}return null}function p(y,x,v,w){for(var S=null,k=null,C=x,N=x=0,T=null;C!==null&&N<v.length;N++){C.index>N?(T=C,C=null):T=C.sibling;var I=h(y,C,v[N],w);if(I===null){C===null&&(C=T);break}t&&C&&I.alternate===null&&e(y,C),x=i(I,x,N),k===null?S=I:k.sibling=I,k=I,C=T}if(N===v.length)return n(y,C),Ft&&Bl(y,N),S;if(C===null){for(;N<v.length;N++)C=d(y,v[N],w),C!==null&&(x=i(C,x,N),k===null?S=C:k.sibling=C,k=C);return Ft&&Bl(y,N),S}for(C=s(y,C);N<v.length;N++)T=f(C,y,N,v[N],w),T!==null&&(t&&T.alternate!==null&&C.delete(T.key===null?N:T.key),x=i(T,x,N),k===null?S=T:k.sibling=T,k=T);return t&&C.forEach(function(D){return e(y,D)}),Ft&&Bl(y,N),S}function m(y,x,v,w){var S=uh(v);if(typeof S!="function")throw Error(ae(150));if(v=S.call(v),v==null)throw Error(ae(151));for(var k=S=null,C=x,N=x=0,T=null,I=v.next();C!==null&&!I.done;N++,I=v.next()){C.index>N?(T=C,C=null):T=C.sibling;var D=h(y,C,I.value,w);if(D===null){C===null&&(C=T);break}t&&C&&D.alternate===null&&e(y,C),x=i(D,x,N),k===null?S=D:k.sibling=D,k=D,C=T}if(I.done)return n(y,C),Ft&&Bl(y,N),S;if(C===null){for(;!I.done;N++,I=v.next())I=d(y,I.value,w),I!==null&&(x=i(I,x,N),k===null?S=I:k.sibling=I,k=I);return Ft&&Bl(y,N),S}for(C=s(y,C);!I.done;N++,I=v.next())I=f(C,y,N,I.value,w),I!==null&&(t&&I.alternate!==null&&C.delete(I.key===null?N:I.key),x=i(I,x,N),k===null?S=I:k.sibling=I,k=I);return t&&C.forEach(function(F){return e(y,F)}),Ft&&Bl(y,N),S}function g(y,x,v,w){if(typeof v=="object"&&v!==null&&v.type===Ru&&v.key===null&&(v=v.props.children),typeof v=="object"&&v!==null){switch(v.$$typeof){case ig:e:{for(var S=v.key,k=x;k!==null;){if(k.key===S){if(S=v.type,S===Ru){if(k.tag===7){n(y,k.sibling),x=r(k,v.props.children),x.return=y,y=x;break e}}else if(k.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===ya&&p$(S)===k.type){n(y,k.sibling),x=r(k,v.props),x.ref=mh(y,k,v),x.return=y,y=x;break e}n(y,k);break}else e(y,k);k=k.sibling}v.type===Ru?(x=lc(v.props.children,y.mode,w,v.key),x.return=y,y=x):(w=yy(v.type,v.key,v.props,null,y.mode,w),w.ref=mh(y,x,v),w.return=y,y=w)}return o(y);case $u:e:{for(k=v.key;x!==null;){if(x.key===k)if(x.tag===4&&x.stateNode.containerInfo===v.containerInfo&&x.stateNode.implementation===v.implementation){n(y,x.sibling),x=r(x,v.children||[]),x.return=y,y=x;break e}else{n(y,x);break}else e(y,x);x=x.sibling}x=K1(v,y.mode,w),x.return=y,y=x}return o(y);case ya:return k=v._init,g(y,x,k(v._payload),w)}if(Fh(v))return p(y,x,v,w);if(uh(v))return m(y,x,v,w);gg(y,v)}return typeof v=="string"&&v!==""||typeof v=="number"?(v=""+v,x!==null&&x.tag===6?(n(y,x.sibling),x=r(x,v),x.return=y,y=x):(n(y,x),x=G1(v,y.mode,w),x.return=y,y=x),o(y)):n(y,x)}return g}var hd=gF(!0),yF=gF(!1),Qy=ml(null),Zy=null,zu=null,ON=null;function MN(){ON=zu=Zy=null}function PN(t){var e=Qy.current;Rt(Qy),t._currentValue=e}function HS(t,e,n){for(;t!==null;){var s=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,s!==null&&(s.childLanes|=e)):s!==null&&(s.childLanes&e)!==e&&(s.childLanes|=e),t===n)break;t=t.return}}function Qu(t,e){Zy=t,ON=zu=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Zs=!0),t.firstContext=null)}function ni(t){var e=t._currentValue;if(ON!==t)if(t={context:t,memoizedValue:e,next:null},zu===null){if(Zy===null)throw Error(ae(308));zu=t,Zy.dependencies={lanes:0,firstContext:t}}else zu=zu.next=t;return e}var Jl=null;function LN(t){Jl===null?Jl=[t]:Jl.push(t)}function xF(t,e,n,s){var r=e.interleaved;return r===null?(n.next=n,LN(e)):(n.next=r.next,r.next=n),e.interleaved=n,Qo(t,s)}function Qo(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var xa=!1;function FN(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function bF(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Ho(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function ja(t,e,n){var s=t.updateQueue;if(s===null)return null;if(s=s.shared,ot&2){var r=s.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),s.pending=e,Qo(t,n)}return r=s.interleaved,r===null?(e.next=e,LN(s)):(e.next=r.next,r.next=e),s.interleaved=e,Qo(t,n)}function dy(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var s=e.lanes;s&=t.pendingLanes,n|=s,e.lanes=n,SN(t,n)}}function m$(t,e){var n=t.updateQueue,s=t.alternate;if(s!==null&&(s=s.updateQueue,n===s)){var r=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?r=i=o:i=i.next=o,n=n.next}while(n!==null);i===null?r=i=e:i=i.next=e}else r=i=e;n={baseState:s.baseState,firstBaseUpdate:r,lastBaseUpdate:i,shared:s.shared,effects:s.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function e0(t,e,n,s){var r=t.updateQueue;xa=!1;var i=r.firstBaseUpdate,o=r.lastBaseUpdate,a=r.shared.pending;if(a!==null){r.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?i=c:o.next=c,o=l;var u=t.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(i!==null){var d=r.baseState;o=0,u=c=l=null,a=i;do{var h=a.lane,f=a.eventTime;if((s&h)===h){u!==null&&(u=u.next={eventTime:f,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var p=t,m=a;switch(h=e,f=n,m.tag){case 1:if(p=m.payload,typeof p=="function"){d=p.call(f,d,h);break e}d=p;break e;case 3:p.flags=p.flags&-65537|128;case 0:if(p=m.payload,h=typeof p=="function"?p.call(f,d,h):p,h==null)break e;d=Ht({},d,h);break e;case 2:xa=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,h=r.effects,h===null?r.effects=[a]:h.push(a))}else f={eventTime:f,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(c=u=f,l=d):u=u.next=f,o|=h;if(a=a.next,a===null){if(a=r.shared.pending,a===null)break;h=a,a=h.next,h.next=null,r.lastBaseUpdate=h,r.shared.pending=null}}while(1);if(u===null&&(l=d),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=u,e=r.shared.interleaved,e!==null){r=e;do o|=r.lane,r=r.next;while(r!==e)}else i===null&&(r.shared.lanes=0);wc|=o,t.lanes=o,t.memoizedState=d}}function g$(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var s=t[e],r=s.callback;if(r!==null){if(s.callback=null,s=n,typeof r!="function")throw Error(ae(191,r));r.call(s)}}}var Cp={},so=ml(Cp),_f=ml(Cp),zf=ml(Cp);function Yl(t){if(t===Cp)throw Error(ae(174));return t}function _N(t,e){switch(Nt(zf,e),Nt(_f,t),Nt(so,Cp),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:NS(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=NS(e,t)}Rt(so),Nt(so,e)}function fd(){Rt(so),Rt(_f),Rt(zf)}function vF(t){Yl(zf.current);var e=Yl(so.current),n=NS(e,t.type);e!==n&&(Nt(_f,t),Nt(so,n))}function zN(t){_f.current===t&&(Rt(so),Rt(_f))}var jt=ml(0);function t0(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var B1=[];function BN(){for(var t=0;t<B1.length;t++)B1[t]._workInProgressVersionPrimary=null;B1.length=0}var hy=oa.ReactCurrentDispatcher,j1=oa.ReactCurrentBatchConfig,vc=0,Wt=null,En=null,Ln=null,n0=!1,rf=!1,Bf=0,h8=0;function us(){throw Error(ae(321))}function jN(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Ri(t[n],e[n]))return!1;return!0}function VN(t,e,n,s,r,i){if(vc=i,Wt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,hy.current=t===null||t.memoizedState===null?g8:y8,t=n(s,r),rf){i=0;do{if(rf=!1,Bf=0,25<=i)throw Error(ae(301));i+=1,Ln=En=null,e.updateQueue=null,hy.current=x8,t=n(s,r)}while(rf)}if(hy.current=s0,e=En!==null&&En.next!==null,vc=0,Ln=En=Wt=null,n0=!1,e)throw Error(ae(300));return t}function UN(){var t=Bf!==0;return Bf=0,t}function Vi(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ln===null?Wt.memoizedState=Ln=t:Ln=Ln.next=t,Ln}function si(){if(En===null){var t=Wt.alternate;t=t!==null?t.memoizedState:null}else t=En.next;var e=Ln===null?Wt.memoizedState:Ln.next;if(e!==null)Ln=e,En=t;else{if(t===null)throw Error(ae(310));En=t,t={memoizedState:En.memoizedState,baseState:En.baseState,baseQueue:En.baseQueue,queue:En.queue,next:null},Ln===null?Wt.memoizedState=Ln=t:Ln=Ln.next=t}return Ln}function jf(t,e){return typeof e=="function"?e(t):e}function V1(t){var e=si(),n=e.queue;if(n===null)throw Error(ae(311));n.lastRenderedReducer=t;var s=En,r=s.baseQueue,i=n.pending;if(i!==null){if(r!==null){var o=r.next;r.next=i.next,i.next=o}s.baseQueue=r=i,n.pending=null}if(r!==null){i=r.next,s=s.baseState;var a=o=null,l=null,c=i;do{var u=c.lane;if((vc&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),s=c.hasEagerState?c.eagerState:t(s,c.action);else{var d={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=d,o=s):l=l.next=d,Wt.lanes|=u,wc|=u}c=c.next}while(c!==null&&c!==i);l===null?o=s:l.next=a,Ri(s,e.memoizedState)||(Zs=!0),e.memoizedState=s,e.baseState=o,e.baseQueue=l,n.lastRenderedState=s}if(t=n.interleaved,t!==null){r=t;do i=r.lane,Wt.lanes|=i,wc|=i,r=r.next;while(r!==t)}else r===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function U1(t){var e=si(),n=e.queue;if(n===null)throw Error(ae(311));n.lastRenderedReducer=t;var s=n.dispatch,r=n.pending,i=e.memoizedState;if(r!==null){n.pending=null;var o=r=r.next;do i=t(i,o.action),o=o.next;while(o!==r);Ri(i,e.memoizedState)||(Zs=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,s]}function wF(){}function SF(t,e){var n=Wt,s=si(),r=e(),i=!Ri(s.memoizedState,r);if(i&&(s.memoizedState=r,Zs=!0),s=s.queue,WN(NF.bind(null,n,s,t),[t]),s.getSnapshot!==e||i||Ln!==null&&Ln.memoizedState.tag&1){if(n.flags|=2048,Vf(9,CF.bind(null,n,s,r,e),void 0,null),Bn===null)throw Error(ae(349));vc&30||kF(n,e,r)}return r}function kF(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Wt.updateQueue,e===null?(e={lastEffect:null,stores:null},Wt.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function CF(t,e,n,s){e.value=n,e.getSnapshot=s,TF(e)&&EF(t)}function NF(t,e,n){return n(function(){TF(e)&&EF(t)})}function TF(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Ri(t,n)}catch{return!0}}function EF(t){var e=Qo(t,1);e!==null&&Ni(e,t,1,-1)}function y$(t){var e=Vi();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:jf,lastRenderedState:t},e.queue=t,t=t.dispatch=m8.bind(null,Wt,t),[e.memoizedState,t]}function Vf(t,e,n,s){return t={tag:t,create:e,destroy:n,deps:s,next:null},e=Wt.updateQueue,e===null?(e={lastEffect:null,stores:null},Wt.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(s=n.next,n.next=t,t.next=s,e.lastEffect=t)),t}function IF(){return si().memoizedState}function fy(t,e,n,s){var r=Vi();Wt.flags|=t,r.memoizedState=Vf(1|e,n,void 0,s===void 0?null:s)}function Xx(t,e,n,s){var r=si();s=s===void 0?null:s;var i=void 0;if(En!==null){var o=En.memoizedState;if(i=o.destroy,s!==null&&jN(s,o.deps)){r.memoizedState=Vf(e,n,i,s);return}}Wt.flags|=t,r.memoizedState=Vf(1|e,n,i,s)}function x$(t,e){return fy(8390656,8,t,e)}function WN(t,e){return Xx(2048,8,t,e)}function AF(t,e){return Xx(4,2,t,e)}function $F(t,e){return Xx(4,4,t,e)}function RF(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function DF(t,e,n){return n=n!=null?n.concat([t]):null,Xx(4,4,RF.bind(null,e,t),n)}function HN(){}function OF(t,e){var n=si();e=e===void 0?null:e;var s=n.memoizedState;return s!==null&&e!==null&&jN(e,s[1])?s[0]:(n.memoizedState=[t,e],t)}function MF(t,e){var n=si();e=e===void 0?null:e;var s=n.memoizedState;return s!==null&&e!==null&&jN(e,s[1])?s[0]:(t=t(),n.memoizedState=[t,e],t)}function PF(t,e,n){return vc&21?(Ri(n,e)||(n=BL(),Wt.lanes|=n,wc|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Zs=!0),t.memoizedState=n)}function f8(t,e){var n=mt;mt=n!==0&&4>n?n:4,t(!0);var s=j1.transition;j1.transition={};try{t(!1),e()}finally{mt=n,j1.transition=s}}function LF(){return si().memoizedState}function p8(t,e,n){var s=Ua(t);if(n={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null},FF(t))_F(e,n);else if(n=xF(t,e,n,s),n!==null){var r=Ps();Ni(n,t,s,r),zF(n,e,s)}}function m8(t,e,n){var s=Ua(t),r={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null};if(FF(t))_F(e,r);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,a=i(o,n);if(r.hasEagerState=!0,r.eagerState=a,Ri(a,o)){var l=e.interleaved;l===null?(r.next=r,LN(e)):(r.next=l.next,l.next=r),e.interleaved=r;return}}catch{}finally{}n=xF(t,e,r,s),n!==null&&(r=Ps(),Ni(n,t,s,r),zF(n,e,s))}}function FF(t){var e=t.alternate;return t===Wt||e!==null&&e===Wt}function _F(t,e){rf=n0=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function zF(t,e,n){if(n&4194240){var s=e.lanes;s&=t.pendingLanes,n|=s,e.lanes=n,SN(t,n)}}var s0={readContext:ni,useCallback:us,useContext:us,useEffect:us,useImperativeHandle:us,useInsertionEffect:us,useLayoutEffect:us,useMemo:us,useReducer:us,useRef:us,useState:us,useDebugValue:us,useDeferredValue:us,useTransition:us,useMutableSource:us,useSyncExternalStore:us,useId:us,unstable_isNewReconciler:!1},g8={readContext:ni,useCallback:function(t,e){return Vi().memoizedState=[t,e===void 0?null:e],t},useContext:ni,useEffect:x$,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,fy(4194308,4,RF.bind(null,e,t),n)},useLayoutEffect:function(t,e){return fy(4194308,4,t,e)},useInsertionEffect:function(t,e){return fy(4,2,t,e)},useMemo:function(t,e){var n=Vi();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var s=Vi();return e=n!==void 0?n(e):e,s.memoizedState=s.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},s.queue=t,t=t.dispatch=p8.bind(null,Wt,t),[s.memoizedState,t]},useRef:function(t){var e=Vi();return t={current:t},e.memoizedState=t},useState:y$,useDebugValue:HN,useDeferredValue:function(t){return Vi().memoizedState=t},useTransition:function(){var t=y$(!1),e=t[0];return t=f8.bind(null,t[1]),Vi().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var s=Wt,r=Vi();if(Ft){if(n===void 0)throw Error(ae(407));n=n()}else{if(n=e(),Bn===null)throw Error(ae(349));vc&30||kF(s,e,n)}r.memoizedState=n;var i={value:n,getSnapshot:e};return r.queue=i,x$(NF.bind(null,s,i,t),[t]),s.flags|=2048,Vf(9,CF.bind(null,s,i,n,e),void 0,null),n},useId:function(){var t=Vi(),e=Bn.identifierPrefix;if(Ft){var n=Bo,s=zo;n=(s&~(1<<32-Ci(s)-1)).toString(32)+n,e=":"+e+"R"+n,n=Bf++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=h8++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},y8={readContext:ni,useCallback:OF,useContext:ni,useEffect:WN,useImperativeHandle:DF,useInsertionEffect:AF,useLayoutEffect:$F,useMemo:MF,useReducer:V1,useRef:IF,useState:function(){return V1(jf)},useDebugValue:HN,useDeferredValue:function(t){var e=si();return PF(e,En.memoizedState,t)},useTransition:function(){var t=V1(jf)[0],e=si().memoizedState;return[t,e]},useMutableSource:wF,useSyncExternalStore:SF,useId:LF,unstable_isNewReconciler:!1},x8={readContext:ni,useCallback:OF,useContext:ni,useEffect:WN,useImperativeHandle:DF,useInsertionEffect:AF,useLayoutEffect:$F,useMemo:MF,useReducer:U1,useRef:IF,useState:function(){return U1(jf)},useDebugValue:HN,useDeferredValue:function(t){var e=si();return En===null?e.memoizedState=t:PF(e,En.memoizedState,t)},useTransition:function(){var t=U1(jf)[0],e=si().memoizedState;return[t,e]},useMutableSource:wF,useSyncExternalStore:SF,useId:LF,unstable_isNewReconciler:!1};function mi(t,e){if(t&&t.defaultProps){e=Ht({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function GS(t,e,n,s){e=t.memoizedState,n=n(s,e),n=n==null?e:Ht({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Jx={isMounted:function(t){return(t=t._reactInternals)?Gc(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var s=Ps(),r=Ua(t),i=Ho(s,r);i.payload=e,n!=null&&(i.callback=n),e=ja(t,i,r),e!==null&&(Ni(e,t,r,s),dy(e,t,r))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var s=Ps(),r=Ua(t),i=Ho(s,r);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=ja(t,i,r),e!==null&&(Ni(e,t,r,s),dy(e,t,r))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Ps(),s=Ua(t),r=Ho(n,s);r.tag=2,e!=null&&(r.callback=e),e=ja(t,r,s),e!==null&&(Ni(e,t,s,n),dy(e,t,s))}};function b$(t,e,n,s,r,i,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(s,i,o):e.prototype&&e.prototype.isPureReactComponent?!Mf(n,s)||!Mf(r,i):!0}function BF(t,e,n){var s=!1,r=sl,i=e.contextType;return typeof i=="object"&&i!==null?i=ni(i):(r=sr(e)?xc:Ss.current,s=e.contextTypes,i=(s=s!=null)?ud(t,r):sl),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Jx,t.stateNode=e,e._reactInternals=t,s&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=i),e}function v$(t,e,n,s){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,s),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,s),e.state!==t&&Jx.enqueueReplaceState(e,e.state,null)}function KS(t,e,n,s){var r=t.stateNode;r.props=n,r.state=t.memoizedState,r.refs={},FN(t);var i=e.contextType;typeof i=="object"&&i!==null?r.context=ni(i):(i=sr(e)?xc:Ss.current,r.context=ud(t,i)),r.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(GS(t,e,i,n),r.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&Jx.enqueueReplaceState(r,r.state,null),e0(t,n,r,s),r.state=t.memoizedState),typeof r.componentDidMount=="function"&&(t.flags|=4194308)}function pd(t,e){try{var n="",s=e;do n+=G6(s),s=s.return;while(s);var r=n}catch(i){r=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:r,digest:null}}function W1(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function qS(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var b8=typeof WeakMap=="function"?WeakMap:Map;function jF(t,e,n){n=Ho(-1,n),n.tag=3,n.payload={element:null};var s=e.value;return n.callback=function(){i0||(i0=!0,rk=s),qS(t,e)},n}function VF(t,e,n){n=Ho(-1,n),n.tag=3;var s=t.type.getDerivedStateFromError;if(typeof s=="function"){var r=e.value;n.payload=function(){return s(r)},n.callback=function(){qS(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){qS(t,e),typeof s!="function"&&(Va===null?Va=new Set([this]):Va.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function w$(t,e,n){var s=t.pingCache;if(s===null){s=t.pingCache=new b8;var r=new Set;s.set(e,r)}else r=s.get(e),r===void 0&&(r=new Set,s.set(e,r));r.has(n)||(r.add(n),t=O8.bind(null,t,e,n),e.then(t,t))}function S$(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function k$(t,e,n,s,r){return t.mode&1?(t.flags|=65536,t.lanes=r,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Ho(-1,1),e.tag=2,ja(n,e,1))),n.lanes|=1),t)}var v8=oa.ReactCurrentOwner,Zs=!1;function As(t,e,n,s){e.child=t===null?yF(e,null,n,s):hd(e,t.child,n,s)}function C$(t,e,n,s,r){n=n.render;var i=e.ref;return Qu(e,r),s=VN(t,e,n,s,i,r),n=UN(),t!==null&&!Zs?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,Zo(t,e,r)):(Ft&&n&&$N(e),e.flags|=1,As(t,e,s,r),e.child)}function N$(t,e,n,s,r){if(t===null){var i=n.type;return typeof i=="function"&&!ZN(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,UF(t,e,i,s,r)):(t=yy(n.type,null,s,e,e.mode,r),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&r)){var o=i.memoizedProps;if(n=n.compare,n=n!==null?n:Mf,n(o,s)&&t.ref===e.ref)return Zo(t,e,r)}return e.flags|=1,t=Wa(i,s),t.ref=e.ref,t.return=e,e.child=t}function UF(t,e,n,s,r){if(t!==null){var i=t.memoizedProps;if(Mf(i,s)&&t.ref===e.ref)if(Zs=!1,e.pendingProps=s=i,(t.lanes&r)!==0)t.flags&131072&&(Zs=!0);else return e.lanes=t.lanes,Zo(t,e,r)}return XS(t,e,n,s,r)}function WF(t,e,n){var s=e.pendingProps,r=s.children,i=t!==null?t.memoizedState:null;if(s.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Nt(ju,mr),mr|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Nt(ju,mr),mr|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},s=i!==null?i.baseLanes:n,Nt(ju,mr),mr|=s}else i!==null?(s=i.baseLanes|n,e.memoizedState=null):s=n,Nt(ju,mr),mr|=s;return As(t,e,r,n),e.child}function HF(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function XS(t,e,n,s,r){var i=sr(n)?xc:Ss.current;return i=ud(e,i),Qu(e,r),n=VN(t,e,n,s,i,r),s=UN(),t!==null&&!Zs?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,Zo(t,e,r)):(Ft&&s&&$N(e),e.flags|=1,As(t,e,n,r),e.child)}function T$(t,e,n,s,r){if(sr(n)){var i=!0;Xy(e)}else i=!1;if(Qu(e,r),e.stateNode===null)py(t,e),BF(e,n,s),KS(e,n,s,r),s=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=n.contextType;typeof c=="object"&&c!==null?c=ni(c):(c=sr(n)?xc:Ss.current,c=ud(e,c));var u=n.getDerivedStateFromProps,d=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==s||l!==c)&&v$(e,o,s,c),xa=!1;var h=e.memoizedState;o.state=h,e0(e,s,o,r),l=e.memoizedState,a!==s||h!==l||nr.current||xa?(typeof u=="function"&&(GS(e,n,u,s),l=e.memoizedState),(a=xa||b$(e,n,a,s,h,l,c))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=s,e.memoizedState=l),o.props=s,o.state=l,o.context=c,s=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),s=!1)}else{o=e.stateNode,bF(t,e),a=e.memoizedProps,c=e.type===e.elementType?a:mi(e.type,a),o.props=c,d=e.pendingProps,h=o.context,l=n.contextType,typeof l=="object"&&l!==null?l=ni(l):(l=sr(n)?xc:Ss.current,l=ud(e,l));var f=n.getDerivedStateFromProps;(u=typeof f=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==d||h!==l)&&v$(e,o,s,l),xa=!1,h=e.memoizedState,o.state=h,e0(e,s,o,r);var p=e.memoizedState;a!==d||h!==p||nr.current||xa?(typeof f=="function"&&(GS(e,n,f,s),p=e.memoizedState),(c=xa||b$(e,n,c,s,h,p,l)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(s,p,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(s,p,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),e.memoizedProps=s,e.memoizedState=p),o.props=s,o.state=p,o.context=l,s=c):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),s=!1)}return JS(t,e,n,s,i,r)}function JS(t,e,n,s,r,i){HF(t,e);var o=(e.flags&128)!==0;if(!s&&!o)return r&&d$(e,n,!1),Zo(t,e,i);s=e.stateNode,v8.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:s.render();return e.flags|=1,t!==null&&o?(e.child=hd(e,t.child,null,i),e.child=hd(e,null,a,i)):As(t,e,a,i),e.memoizedState=s.state,r&&d$(e,n,!0),e.child}function GF(t){var e=t.stateNode;e.pendingContext?u$(t,e.pendingContext,e.pendingContext!==e.context):e.context&&u$(t,e.context,!1),_N(t,e.containerInfo)}function E$(t,e,n,s,r){return dd(),DN(r),e.flags|=256,As(t,e,n,s),e.child}var YS={dehydrated:null,treeContext:null,retryLane:0};function QS(t){return{baseLanes:t,cachePool:null,transitions:null}}function KF(t,e,n){var s=e.pendingProps,r=jt.current,i=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(r&2)!==0),a?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(r|=1),Nt(jt,r&1),t===null)return WS(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=s.children,t=s.fallback,i?(s=e.mode,i=e.child,o={mode:"hidden",children:o},!(s&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=Zx(o,s,0,null),t=lc(t,s,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=QS(n),e.memoizedState=YS,t):GN(e,o));if(r=t.memoizedState,r!==null&&(a=r.dehydrated,a!==null))return w8(t,e,o,s,a,r,n);if(i){i=s.fallback,o=e.mode,r=t.child,a=r.sibling;var l={mode:"hidden",children:s.children};return!(o&1)&&e.child!==r?(s=e.child,s.childLanes=0,s.pendingProps=l,e.deletions=null):(s=Wa(r,l),s.subtreeFlags=r.subtreeFlags&14680064),a!==null?i=Wa(a,i):(i=lc(i,o,n,null),i.flags|=2),i.return=e,s.return=e,s.sibling=i,e.child=s,s=i,i=e.child,o=t.child.memoizedState,o=o===null?QS(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=t.childLanes&~n,e.memoizedState=YS,s}return i=t.child,t=i.sibling,s=Wa(i,{mode:"visible",children:s.children}),!(e.mode&1)&&(s.lanes=n),s.return=e,s.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=s,e.memoizedState=null,s}function GN(t,e){return e=Zx({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function yg(t,e,n,s){return s!==null&&DN(s),hd(e,t.child,null,n),t=GN(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function w8(t,e,n,s,r,i,o){if(n)return e.flags&256?(e.flags&=-257,s=W1(Error(ae(422))),yg(t,e,o,s)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=s.fallback,r=e.mode,s=Zx({mode:"visible",children:s.children},r,0,null),i=lc(i,r,o,null),i.flags|=2,s.return=e,i.return=e,s.sibling=i,e.child=s,e.mode&1&&hd(e,t.child,null,o),e.child.memoizedState=QS(o),e.memoizedState=YS,i);if(!(e.mode&1))return yg(t,e,o,null);if(r.data==="$!"){if(s=r.nextSibling&&r.nextSibling.dataset,s)var a=s.dgst;return s=a,i=Error(ae(419)),s=W1(i,s,void 0),yg(t,e,o,s)}if(a=(o&t.childLanes)!==0,Zs||a){if(s=Bn,s!==null){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(s.suspendedLanes|o)?0:r,r!==0&&r!==i.retryLane&&(i.retryLane=r,Qo(t,r),Ni(s,t,r,-1))}return QN(),s=W1(Error(ae(421))),yg(t,e,o,s)}return r.data==="$?"?(e.flags|=128,e.child=t.child,e=M8.bind(null,t),r._reactRetry=e,null):(t=i.treeContext,xr=Ba(r.nextSibling),vr=e,Ft=!0,xi=null,t!==null&&(jr[Vr++]=zo,jr[Vr++]=Bo,jr[Vr++]=bc,zo=t.id,Bo=t.overflow,bc=e),e=GN(e,s.children),e.flags|=4096,e)}function I$(t,e,n){t.lanes|=e;var s=t.alternate;s!==null&&(s.lanes|=e),HS(t.return,e,n)}function H1(t,e,n,s,r){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:s,tail:n,tailMode:r}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=s,i.tail=n,i.tailMode=r)}function qF(t,e,n){var s=e.pendingProps,r=s.revealOrder,i=s.tail;if(As(t,e,s.children,n),s=jt.current,s&2)s=s&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&I$(t,n,e);else if(t.tag===19)I$(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}s&=1}if(Nt(jt,s),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(n=e.child,r=null;n!==null;)t=n.alternate,t!==null&&t0(t)===null&&(r=n),n=n.sibling;n=r,n===null?(r=e.child,e.child=null):(r=n.sibling,n.sibling=null),H1(e,!1,r,n,i);break;case"backwards":for(n=null,r=e.child,e.child=null;r!==null;){if(t=r.alternate,t!==null&&t0(t)===null){e.child=r;break}t=r.sibling,r.sibling=n,n=r,r=t}H1(e,!0,n,null,i);break;case"together":H1(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function py(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Zo(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),wc|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(ae(153));if(e.child!==null){for(t=e.child,n=Wa(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Wa(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function S8(t,e,n){switch(e.tag){case 3:GF(e),dd();break;case 5:vF(e);break;case 1:sr(e.type)&&Xy(e);break;case 4:_N(e,e.stateNode.containerInfo);break;case 10:var s=e.type._context,r=e.memoizedProps.value;Nt(Qy,s._currentValue),s._currentValue=r;break;case 13:if(s=e.memoizedState,s!==null)return s.dehydrated!==null?(Nt(jt,jt.current&1),e.flags|=128,null):n&e.child.childLanes?KF(t,e,n):(Nt(jt,jt.current&1),t=Zo(t,e,n),t!==null?t.sibling:null);Nt(jt,jt.current&1);break;case 19:if(s=(n&e.childLanes)!==0,t.flags&128){if(s)return qF(t,e,n);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),Nt(jt,jt.current),s)break;return null;case 22:case 23:return e.lanes=0,WF(t,e,n)}return Zo(t,e,n)}var XF,ZS,JF,YF;XF=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};ZS=function(){};JF=function(t,e,n,s){var r=t.memoizedProps;if(r!==s){t=e.stateNode,Yl(so.current);var i=null;switch(n){case"input":r=wS(t,r),s=wS(t,s),i=[];break;case"select":r=Ht({},r,{value:void 0}),s=Ht({},s,{value:void 0}),i=[];break;case"textarea":r=CS(t,r),s=CS(t,s),i=[];break;default:typeof r.onClick!="function"&&typeof s.onClick=="function"&&(t.onclick=Ky)}TS(n,s);var o;n=null;for(c in r)if(!s.hasOwnProperty(c)&&r.hasOwnProperty(c)&&r[c]!=null)if(c==="style"){var a=r[c];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(Ef.hasOwnProperty(c)?i||(i=[]):(i=i||[]).push(c,null));for(c in s){var l=s[c];if(a=r!=null?r[c]:void 0,s.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(n||(n={}),n[o]=l[o])}else n||(i||(i=[]),i.push(c,n)),n=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(i=i||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(i=i||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(Ef.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&At("scroll",t),i||a===l||(i=[])):(i=i||[]).push(c,l))}n&&(i=i||[]).push("style",n);var c=i;(e.updateQueue=c)&&(e.flags|=4)}};YF=function(t,e,n,s){n!==s&&(e.flags|=4)};function gh(t,e){if(!Ft)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var s=null;n!==null;)n.alternate!==null&&(s=n),n=n.sibling;s===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:s.sibling=null}}function ds(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,s=0;if(e)for(var r=t.child;r!==null;)n|=r.lanes|r.childLanes,s|=r.subtreeFlags&14680064,s|=r.flags&14680064,r.return=t,r=r.sibling;else for(r=t.child;r!==null;)n|=r.lanes|r.childLanes,s|=r.subtreeFlags,s|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=s,t.childLanes=n,e}function k8(t,e,n){var s=e.pendingProps;switch(RN(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ds(e),null;case 1:return sr(e.type)&&qy(),ds(e),null;case 3:return s=e.stateNode,fd(),Rt(nr),Rt(Ss),BN(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(t===null||t.child===null)&&(mg(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,xi!==null&&(ak(xi),xi=null))),ZS(t,e),ds(e),null;case 5:zN(e);var r=Yl(zf.current);if(n=e.type,t!==null&&e.stateNode!=null)JF(t,e,n,s,r),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!s){if(e.stateNode===null)throw Error(ae(166));return ds(e),null}if(t=Yl(so.current),mg(e)){s=e.stateNode,n=e.type;var i=e.memoizedProps;switch(s[Qi]=e,s[Ff]=i,t=(e.mode&1)!==0,n){case"dialog":At("cancel",s),At("close",s);break;case"iframe":case"object":case"embed":At("load",s);break;case"video":case"audio":for(r=0;r<zh.length;r++)At(zh[r],s);break;case"source":At("error",s);break;case"img":case"image":case"link":At("error",s),At("load",s);break;case"details":At("toggle",s);break;case"input":FA(s,i),At("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!i.multiple},At("invalid",s);break;case"textarea":zA(s,i),At("invalid",s)}TS(n,i),r=null;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];o==="children"?typeof a=="string"?s.textContent!==a&&(i.suppressHydrationWarning!==!0&&pg(s.textContent,a,t),r=["children",a]):typeof a=="number"&&s.textContent!==""+a&&(i.suppressHydrationWarning!==!0&&pg(s.textContent,a,t),r=["children",""+a]):Ef.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&At("scroll",s)}switch(n){case"input":og(s),_A(s,i,!0);break;case"textarea":og(s),BA(s);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(s.onclick=Ky)}s=r,e.updateQueue=s,s!==null&&(e.flags|=4)}else{o=r.nodeType===9?r:r.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=NL(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof s.is=="string"?t=o.createElement(n,{is:s.is}):(t=o.createElement(n),n==="select"&&(o=t,s.multiple?o.multiple=!0:s.size&&(o.size=s.size))):t=o.createElementNS(t,n),t[Qi]=e,t[Ff]=s,XF(t,e,!1,!1),e.stateNode=t;e:{switch(o=ES(n,s),n){case"dialog":At("cancel",t),At("close",t),r=s;break;case"iframe":case"object":case"embed":At("load",t),r=s;break;case"video":case"audio":for(r=0;r<zh.length;r++)At(zh[r],t);r=s;break;case"source":At("error",t),r=s;break;case"img":case"image":case"link":At("error",t),At("load",t),r=s;break;case"details":At("toggle",t),r=s;break;case"input":FA(t,s),r=wS(t,s),At("invalid",t);break;case"option":r=s;break;case"select":t._wrapperState={wasMultiple:!!s.multiple},r=Ht({},s,{value:void 0}),At("invalid",t);break;case"textarea":zA(t,s),r=CS(t,s),At("invalid",t);break;default:r=s}TS(n,r),a=r;for(i in a)if(a.hasOwnProperty(i)){var l=a[i];i==="style"?IL(t,l):i==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&TL(t,l)):i==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&If(t,l):typeof l=="number"&&If(t,""+l):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Ef.hasOwnProperty(i)?l!=null&&i==="onScroll"&&At("scroll",t):l!=null&&gN(t,i,l,o))}switch(n){case"input":og(t),_A(t,s,!1);break;case"textarea":og(t),BA(t);break;case"option":s.value!=null&&t.setAttribute("value",""+nl(s.value));break;case"select":t.multiple=!!s.multiple,i=s.value,i!=null?qu(t,!!s.multiple,i,!1):s.defaultValue!=null&&qu(t,!!s.multiple,s.defaultValue,!0);break;default:typeof r.onClick=="function"&&(t.onclick=Ky)}switch(n){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return ds(e),null;case 6:if(t&&e.stateNode!=null)YF(t,e,t.memoizedProps,s);else{if(typeof s!="string"&&e.stateNode===null)throw Error(ae(166));if(n=Yl(zf.current),Yl(so.current),mg(e)){if(s=e.stateNode,n=e.memoizedProps,s[Qi]=e,(i=s.nodeValue!==n)&&(t=vr,t!==null))switch(t.tag){case 3:pg(s.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&pg(s.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else s=(n.nodeType===9?n:n.ownerDocument).createTextNode(s),s[Qi]=e,e.stateNode=s}return ds(e),null;case 13:if(Rt(jt),s=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Ft&&xr!==null&&e.mode&1&&!(e.flags&128))mF(),dd(),e.flags|=98560,i=!1;else if(i=mg(e),s!==null&&s.dehydrated!==null){if(t===null){if(!i)throw Error(ae(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(ae(317));i[Qi]=e}else dd(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;ds(e),i=!1}else xi!==null&&(ak(xi),xi=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(s=s!==null,s!==(t!==null&&t.memoizedState!==null)&&s&&(e.child.flags|=8192,e.mode&1&&(t===null||jt.current&1?$n===0&&($n=3):QN())),e.updateQueue!==null&&(e.flags|=4),ds(e),null);case 4:return fd(),ZS(t,e),t===null&&Pf(e.stateNode.containerInfo),ds(e),null;case 10:return PN(e.type._context),ds(e),null;case 17:return sr(e.type)&&qy(),ds(e),null;case 19:if(Rt(jt),i=e.memoizedState,i===null)return ds(e),null;if(s=(e.flags&128)!==0,o=i.rendering,o===null)if(s)gh(i,!1);else{if($n!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=t0(t),o!==null){for(e.flags|=128,gh(i,!1),s=o.updateQueue,s!==null&&(e.updateQueue=s,e.flags|=4),e.subtreeFlags=0,s=n,n=e.child;n!==null;)i=n,t=s,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,t=o.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return Nt(jt,jt.current&1|2),e.child}t=t.sibling}i.tail!==null&&an()>md&&(e.flags|=128,s=!0,gh(i,!1),e.lanes=4194304)}else{if(!s)if(t=t0(o),t!==null){if(e.flags|=128,s=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),gh(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!Ft)return ds(e),null}else 2*an()-i.renderingStartTime>md&&n!==1073741824&&(e.flags|=128,s=!0,gh(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(n=i.last,n!==null?n.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=an(),e.sibling=null,n=jt.current,Nt(jt,s?n&1|2:n&1),e):(ds(e),null);case 22:case 23:return YN(),s=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==s&&(e.flags|=8192),s&&e.mode&1?mr&1073741824&&(ds(e),e.subtreeFlags&6&&(e.flags|=8192)):ds(e),null;case 24:return null;case 25:return null}throw Error(ae(156,e.tag))}function C8(t,e){switch(RN(e),e.tag){case 1:return sr(e.type)&&qy(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return fd(),Rt(nr),Rt(Ss),BN(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return zN(e),null;case 13:if(Rt(jt),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(ae(340));dd()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Rt(jt),null;case 4:return fd(),null;case 10:return PN(e.type._context),null;case 22:case 23:return YN(),null;case 24:return null;default:return null}}var xg=!1,ms=!1,N8=typeof WeakSet=="function"?WeakSet:Set,ye=null;function Bu(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(s){qt(t,e,s)}else n.current=null}function ek(t,e,n){try{n()}catch(s){qt(t,e,s)}}var A$=!1;function T8(t,e){if(FS=Wy,t=nF(),AN(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var s=n.getSelection&&n.getSelection();if(s&&s.rangeCount!==0){n=s.anchorNode;var r=s.anchorOffset,i=s.focusNode;s=s.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var o=0,a=-1,l=-1,c=0,u=0,d=t,h=null;t:for(;;){for(var f;d!==n||r!==0&&d.nodeType!==3||(a=o+r),d!==i||s!==0&&d.nodeType!==3||(l=o+s),d.nodeType===3&&(o+=d.nodeValue.length),(f=d.firstChild)!==null;)h=d,d=f;for(;;){if(d===t)break t;if(h===n&&++c===r&&(a=o),h===i&&++u===s&&(l=o),(f=d.nextSibling)!==null)break;d=h,h=d.parentNode}d=f}n=a===-1||l===-1?null:{start:a,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(_S={focusedElem:t,selectionRange:n},Wy=!1,ye=e;ye!==null;)if(e=ye,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,ye=t;else for(;ye!==null;){e=ye;try{var p=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(p!==null){var m=p.memoizedProps,g=p.memoizedState,y=e.stateNode,x=y.getSnapshotBeforeUpdate(e.elementType===e.type?m:mi(e.type,m),g);y.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var v=e.stateNode.containerInfo;v.nodeType===1?v.textContent="":v.nodeType===9&&v.documentElement&&v.removeChild(v.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ae(163))}}catch(w){qt(e,e.return,w)}if(t=e.sibling,t!==null){t.return=e.return,ye=t;break}ye=e.return}return p=A$,A$=!1,p}function of(t,e,n){var s=e.updateQueue;if(s=s!==null?s.lastEffect:null,s!==null){var r=s=s.next;do{if((r.tag&t)===t){var i=r.destroy;r.destroy=void 0,i!==void 0&&ek(e,n,i)}r=r.next}while(r!==s)}}function Yx(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var s=n.create;n.destroy=s()}n=n.next}while(n!==e)}}function tk(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function QF(t){var e=t.alternate;e!==null&&(t.alternate=null,QF(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Qi],delete e[Ff],delete e[jS],delete e[l8],delete e[c8])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function ZF(t){return t.tag===5||t.tag===3||t.tag===4}function $$(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||ZF(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function nk(t,e,n){var s=t.tag;if(s===5||s===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Ky));else if(s!==4&&(t=t.child,t!==null))for(nk(t,e,n),t=t.sibling;t!==null;)nk(t,e,n),t=t.sibling}function sk(t,e,n){var s=t.tag;if(s===5||s===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(s!==4&&(t=t.child,t!==null))for(sk(t,e,n),t=t.sibling;t!==null;)sk(t,e,n),t=t.sibling}var Jn=null,gi=!1;function ha(t,e,n){for(n=n.child;n!==null;)e_(t,e,n),n=n.sibling}function e_(t,e,n){if(no&&typeof no.onCommitFiberUnmount=="function")try{no.onCommitFiberUnmount(Ux,n)}catch{}switch(n.tag){case 5:ms||Bu(n,e);case 6:var s=Jn,r=gi;Jn=null,ha(t,e,n),Jn=s,gi=r,Jn!==null&&(gi?(t=Jn,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Jn.removeChild(n.stateNode));break;case 18:Jn!==null&&(gi?(t=Jn,n=n.stateNode,t.nodeType===8?_1(t.parentNode,n):t.nodeType===1&&_1(t,n),Df(t)):_1(Jn,n.stateNode));break;case 4:s=Jn,r=gi,Jn=n.stateNode.containerInfo,gi=!0,ha(t,e,n),Jn=s,gi=r;break;case 0:case 11:case 14:case 15:if(!ms&&(s=n.updateQueue,s!==null&&(s=s.lastEffect,s!==null))){r=s=s.next;do{var i=r,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&ek(n,e,o),r=r.next}while(r!==s)}ha(t,e,n);break;case 1:if(!ms&&(Bu(n,e),s=n.stateNode,typeof s.componentWillUnmount=="function"))try{s.props=n.memoizedProps,s.state=n.memoizedState,s.componentWillUnmount()}catch(a){qt(n,e,a)}ha(t,e,n);break;case 21:ha(t,e,n);break;case 22:n.mode&1?(ms=(s=ms)||n.memoizedState!==null,ha(t,e,n),ms=s):ha(t,e,n);break;default:ha(t,e,n)}}function R$(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new N8),e.forEach(function(s){var r=P8.bind(null,t,s);n.has(s)||(n.add(s),s.then(r,r))})}}function di(t,e){var n=e.deletions;if(n!==null)for(var s=0;s<n.length;s++){var r=n[s];try{var i=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Jn=a.stateNode,gi=!1;break e;case 3:Jn=a.stateNode.containerInfo,gi=!0;break e;case 4:Jn=a.stateNode.containerInfo,gi=!0;break e}a=a.return}if(Jn===null)throw Error(ae(160));e_(i,o,r),Jn=null,gi=!1;var l=r.alternate;l!==null&&(l.return=null),r.return=null}catch(c){qt(r,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)t_(e,t),e=e.sibling}function t_(t,e){var n=t.alternate,s=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(di(e,t),Bi(t),s&4){try{of(3,t,t.return),Yx(3,t)}catch(m){qt(t,t.return,m)}try{of(5,t,t.return)}catch(m){qt(t,t.return,m)}}break;case 1:di(e,t),Bi(t),s&512&&n!==null&&Bu(n,n.return);break;case 5:if(di(e,t),Bi(t),s&512&&n!==null&&Bu(n,n.return),t.flags&32){var r=t.stateNode;try{If(r,"")}catch(m){qt(t,t.return,m)}}if(s&4&&(r=t.stateNode,r!=null)){var i=t.memoizedProps,o=n!==null?n.memoizedProps:i,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&i.type==="radio"&&i.name!=null&&kL(r,i),ES(a,o);var c=ES(a,i);for(o=0;o<l.length;o+=2){var u=l[o],d=l[o+1];u==="style"?IL(r,d):u==="dangerouslySetInnerHTML"?TL(r,d):u==="children"?If(r,d):gN(r,u,d,c)}switch(a){case"input":SS(r,i);break;case"textarea":CL(r,i);break;case"select":var h=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!i.multiple;var f=i.value;f!=null?qu(r,!!i.multiple,f,!1):h!==!!i.multiple&&(i.defaultValue!=null?qu(r,!!i.multiple,i.defaultValue,!0):qu(r,!!i.multiple,i.multiple?[]:"",!1))}r[Ff]=i}catch(m){qt(t,t.return,m)}}break;case 6:if(di(e,t),Bi(t),s&4){if(t.stateNode===null)throw Error(ae(162));r=t.stateNode,i=t.memoizedProps;try{r.nodeValue=i}catch(m){qt(t,t.return,m)}}break;case 3:if(di(e,t),Bi(t),s&4&&n!==null&&n.memoizedState.isDehydrated)try{Df(e.containerInfo)}catch(m){qt(t,t.return,m)}break;case 4:di(e,t),Bi(t);break;case 13:di(e,t),Bi(t),r=t.child,r.flags&8192&&(i=r.memoizedState!==null,r.stateNode.isHidden=i,!i||r.alternate!==null&&r.alternate.memoizedState!==null||(XN=an())),s&4&&R$(t);break;case 22:if(u=n!==null&&n.memoizedState!==null,t.mode&1?(ms=(c=ms)||u,di(e,t),ms=c):di(e,t),Bi(t),s&8192){if(c=t.memoizedState!==null,(t.stateNode.isHidden=c)&&!u&&t.mode&1)for(ye=t,u=t.child;u!==null;){for(d=ye=u;ye!==null;){switch(h=ye,f=h.child,h.tag){case 0:case 11:case 14:case 15:of(4,h,h.return);break;case 1:Bu(h,h.return);var p=h.stateNode;if(typeof p.componentWillUnmount=="function"){s=h,n=h.return;try{e=s,p.props=e.memoizedProps,p.state=e.memoizedState,p.componentWillUnmount()}catch(m){qt(s,n,m)}}break;case 5:Bu(h,h.return);break;case 22:if(h.memoizedState!==null){O$(d);continue}}f!==null?(f.return=h,ye=f):O$(d)}u=u.sibling}e:for(u=null,d=t;;){if(d.tag===5){if(u===null){u=d;try{r=d.stateNode,c?(i=r.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(a=d.stateNode,l=d.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=EL("display",o))}catch(m){qt(t,t.return,m)}}}else if(d.tag===6){if(u===null)try{d.stateNode.nodeValue=c?"":d.memoizedProps}catch(m){qt(t,t.return,m)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===t)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===t)break e;for(;d.sibling===null;){if(d.return===null||d.return===t)break e;u===d&&(u=null),d=d.return}u===d&&(u=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:di(e,t),Bi(t),s&4&&R$(t);break;case 21:break;default:di(e,t),Bi(t)}}function Bi(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(ZF(n)){var s=n;break e}n=n.return}throw Error(ae(160))}switch(s.tag){case 5:var r=s.stateNode;s.flags&32&&(If(r,""),s.flags&=-33);var i=$$(t);sk(t,i,r);break;case 3:case 4:var o=s.stateNode.containerInfo,a=$$(t);nk(t,a,o);break;default:throw Error(ae(161))}}catch(l){qt(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function E8(t,e,n){ye=t,n_(t)}function n_(t,e,n){for(var s=(t.mode&1)!==0;ye!==null;){var r=ye,i=r.child;if(r.tag===22&&s){var o=r.memoizedState!==null||xg;if(!o){var a=r.alternate,l=a!==null&&a.memoizedState!==null||ms;a=xg;var c=ms;if(xg=o,(ms=l)&&!c)for(ye=r;ye!==null;)o=ye,l=o.child,o.tag===22&&o.memoizedState!==null?M$(r):l!==null?(l.return=o,ye=l):M$(r);for(;i!==null;)ye=i,n_(i),i=i.sibling;ye=r,xg=a,ms=c}D$(t)}else r.subtreeFlags&8772&&i!==null?(i.return=r,ye=i):D$(t)}}function D$(t){for(;ye!==null;){var e=ye;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:ms||Yx(5,e);break;case 1:var s=e.stateNode;if(e.flags&4&&!ms)if(n===null)s.componentDidMount();else{var r=e.elementType===e.type?n.memoizedProps:mi(e.type,n.memoizedProps);s.componentDidUpdate(r,n.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&g$(e,i,s);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}g$(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var d=u.dehydrated;d!==null&&Df(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ae(163))}ms||e.flags&512&&tk(e)}catch(h){qt(e,e.return,h)}}if(e===t){ye=null;break}if(n=e.sibling,n!==null){n.return=e.return,ye=n;break}ye=e.return}}function O$(t){for(;ye!==null;){var e=ye;if(e===t){ye=null;break}var n=e.sibling;if(n!==null){n.return=e.return,ye=n;break}ye=e.return}}function M$(t){for(;ye!==null;){var e=ye;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Yx(4,e)}catch(l){qt(e,n,l)}break;case 1:var s=e.stateNode;if(typeof s.componentDidMount=="function"){var r=e.return;try{s.componentDidMount()}catch(l){qt(e,r,l)}}var i=e.return;try{tk(e)}catch(l){qt(e,i,l)}break;case 5:var o=e.return;try{tk(e)}catch(l){qt(e,o,l)}}}catch(l){qt(e,e.return,l)}if(e===t){ye=null;break}var a=e.sibling;if(a!==null){a.return=e.return,ye=a;break}ye=e.return}}var I8=Math.ceil,r0=oa.ReactCurrentDispatcher,KN=oa.ReactCurrentOwner,Qr=oa.ReactCurrentBatchConfig,ot=0,Bn=null,mn=null,es=0,mr=0,ju=ml(0),$n=0,Uf=null,wc=0,Qx=0,qN=0,af=null,Js=null,XN=0,md=1/0,Mo=null,i0=!1,rk=null,Va=null,bg=!1,$a=null,o0=0,lf=0,ik=null,my=-1,gy=0;function Ps(){return ot&6?an():my!==-1?my:my=an()}function Ua(t){return t.mode&1?ot&2&&es!==0?es&-es:d8.transition!==null?(gy===0&&(gy=BL()),gy):(t=mt,t!==0||(t=window.event,t=t===void 0?16:KL(t.type)),t):1}function Ni(t,e,n,s){if(50<lf)throw lf=0,ik=null,Error(ae(185));wp(t,n,s),(!(ot&2)||t!==Bn)&&(t===Bn&&(!(ot&2)&&(Qx|=n),$n===4&&Na(t,es)),rr(t,s),n===1&&ot===0&&!(e.mode&1)&&(md=an()+500,qx&&gl()))}function rr(t,e){var n=t.callbackNode;dK(t,e);var s=Uy(t,t===Bn?es:0);if(s===0)n!==null&&UA(n),t.callbackNode=null,t.callbackPriority=0;else if(e=s&-s,t.callbackPriority!==e){if(n!=null&&UA(n),e===1)t.tag===0?u8(P$.bind(null,t)):hF(P$.bind(null,t)),o8(function(){!(ot&6)&&gl()}),n=null;else{switch(jL(s)){case 1:n=wN;break;case 4:n=_L;break;case 16:n=Vy;break;case 536870912:n=zL;break;default:n=Vy}n=u_(n,s_.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function s_(t,e){if(my=-1,gy=0,ot&6)throw Error(ae(327));var n=t.callbackNode;if(Zu()&&t.callbackNode!==n)return null;var s=Uy(t,t===Bn?es:0);if(s===0)return null;if(s&30||s&t.expiredLanes||e)e=a0(t,s);else{e=s;var r=ot;ot|=2;var i=i_();(Bn!==t||es!==e)&&(Mo=null,md=an()+500,ac(t,e));do try{R8();break}catch(a){r_(t,a)}while(1);MN(),r0.current=i,ot=r,mn!==null?e=0:(Bn=null,es=0,e=$n)}if(e!==0){if(e===2&&(r=DS(t),r!==0&&(s=r,e=ok(t,r))),e===1)throw n=Uf,ac(t,0),Na(t,s),rr(t,an()),n;if(e===6)Na(t,s);else{if(r=t.current.alternate,!(s&30)&&!A8(r)&&(e=a0(t,s),e===2&&(i=DS(t),i!==0&&(s=i,e=ok(t,i))),e===1))throw n=Uf,ac(t,0),Na(t,s),rr(t,an()),n;switch(t.finishedWork=r,t.finishedLanes=s,e){case 0:case 1:throw Error(ae(345));case 2:jl(t,Js,Mo);break;case 3:if(Na(t,s),(s&130023424)===s&&(e=XN+500-an(),10<e)){if(Uy(t,0)!==0)break;if(r=t.suspendedLanes,(r&s)!==s){Ps(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=BS(jl.bind(null,t,Js,Mo),e);break}jl(t,Js,Mo);break;case 4:if(Na(t,s),(s&4194240)===s)break;for(e=t.eventTimes,r=-1;0<s;){var o=31-Ci(s);i=1<<o,o=e[o],o>r&&(r=o),s&=~i}if(s=r,s=an()-s,s=(120>s?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*I8(s/1960))-s,10<s){t.timeoutHandle=BS(jl.bind(null,t,Js,Mo),s);break}jl(t,Js,Mo);break;case 5:jl(t,Js,Mo);break;default:throw Error(ae(329))}}}return rr(t,an()),t.callbackNode===n?s_.bind(null,t):null}function ok(t,e){var n=af;return t.current.memoizedState.isDehydrated&&(ac(t,e).flags|=256),t=a0(t,e),t!==2&&(e=Js,Js=n,e!==null&&ak(e)),t}function ak(t){Js===null?Js=t:Js.push.apply(Js,t)}function A8(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var s=0;s<n.length;s++){var r=n[s],i=r.getSnapshot;r=r.value;try{if(!Ri(i(),r))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Na(t,e){for(e&=~qN,e&=~Qx,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Ci(e),s=1<<n;t[n]=-1,e&=~s}}function P$(t){if(ot&6)throw Error(ae(327));Zu();var e=Uy(t,0);if(!(e&1))return rr(t,an()),null;var n=a0(t,e);if(t.tag!==0&&n===2){var s=DS(t);s!==0&&(e=s,n=ok(t,s))}if(n===1)throw n=Uf,ac(t,0),Na(t,e),rr(t,an()),n;if(n===6)throw Error(ae(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,jl(t,Js,Mo),rr(t,an()),null}function JN(t,e){var n=ot;ot|=1;try{return t(e)}finally{ot=n,ot===0&&(md=an()+500,qx&&gl())}}function Sc(t){$a!==null&&$a.tag===0&&!(ot&6)&&Zu();var e=ot;ot|=1;var n=Qr.transition,s=mt;try{if(Qr.transition=null,mt=1,t)return t()}finally{mt=s,Qr.transition=n,ot=e,!(ot&6)&&gl()}}function YN(){mr=ju.current,Rt(ju)}function ac(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,i8(n)),mn!==null)for(n=mn.return;n!==null;){var s=n;switch(RN(s),s.tag){case 1:s=s.type.childContextTypes,s!=null&&qy();break;case 3:fd(),Rt(nr),Rt(Ss),BN();break;case 5:zN(s);break;case 4:fd();break;case 13:Rt(jt);break;case 19:Rt(jt);break;case 10:PN(s.type._context);break;case 22:case 23:YN()}n=n.return}if(Bn=t,mn=t=Wa(t.current,null),es=mr=e,$n=0,Uf=null,qN=Qx=wc=0,Js=af=null,Jl!==null){for(e=0;e<Jl.length;e++)if(n=Jl[e],s=n.interleaved,s!==null){n.interleaved=null;var r=s.next,i=n.pending;if(i!==null){var o=i.next;i.next=r,s.next=o}n.pending=s}Jl=null}return t}function r_(t,e){do{var n=mn;try{if(MN(),hy.current=s0,n0){for(var s=Wt.memoizedState;s!==null;){var r=s.queue;r!==null&&(r.pending=null),s=s.next}n0=!1}if(vc=0,Ln=En=Wt=null,rf=!1,Bf=0,KN.current=null,n===null||n.return===null){$n=1,Uf=e,mn=null;break}e:{var i=t,o=n.return,a=n,l=e;if(e=es,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=a,d=u.tag;if(!(u.mode&1)&&(d===0||d===11||d===15)){var h=u.alternate;h?(u.updateQueue=h.updateQueue,u.memoizedState=h.memoizedState,u.lanes=h.lanes):(u.updateQueue=null,u.memoizedState=null)}var f=S$(o);if(f!==null){f.flags&=-257,k$(f,o,a,i,e),f.mode&1&&w$(i,c,e),e=f,l=c;var p=e.updateQueue;if(p===null){var m=new Set;m.add(l),e.updateQueue=m}else p.add(l);break e}else{if(!(e&1)){w$(i,c,e),QN();break e}l=Error(ae(426))}}else if(Ft&&a.mode&1){var g=S$(o);if(g!==null){!(g.flags&65536)&&(g.flags|=256),k$(g,o,a,i,e),DN(pd(l,a));break e}}i=l=pd(l,a),$n!==4&&($n=2),af===null?af=[i]:af.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var y=jF(i,l,e);m$(i,y);break e;case 1:a=l;var x=i.type,v=i.stateNode;if(!(i.flags&128)&&(typeof x.getDerivedStateFromError=="function"||v!==null&&typeof v.componentDidCatch=="function"&&(Va===null||!Va.has(v)))){i.flags|=65536,e&=-e,i.lanes|=e;var w=VF(i,a,e);m$(i,w);break e}}i=i.return}while(i!==null)}a_(n)}catch(S){e=S,mn===n&&n!==null&&(mn=n=n.return);continue}break}while(1)}function i_(){var t=r0.current;return r0.current=s0,t===null?s0:t}function QN(){($n===0||$n===3||$n===2)&&($n=4),Bn===null||!(wc&268435455)&&!(Qx&268435455)||Na(Bn,es)}function a0(t,e){var n=ot;ot|=2;var s=i_();(Bn!==t||es!==e)&&(Mo=null,ac(t,e));do try{$8();break}catch(r){r_(t,r)}while(1);if(MN(),ot=n,r0.current=s,mn!==null)throw Error(ae(261));return Bn=null,es=0,$n}function $8(){for(;mn!==null;)o_(mn)}function R8(){for(;mn!==null&&!nK();)o_(mn)}function o_(t){var e=c_(t.alternate,t,mr);t.memoizedProps=t.pendingProps,e===null?a_(t):mn=e,KN.current=null}function a_(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=C8(n,e),n!==null){n.flags&=32767,mn=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{$n=6,mn=null;return}}else if(n=k8(n,e,mr),n!==null){mn=n;return}if(e=e.sibling,e!==null){mn=e;return}mn=e=t}while(e!==null);$n===0&&($n=5)}function jl(t,e,n){var s=mt,r=Qr.transition;try{Qr.transition=null,mt=1,D8(t,e,n,s)}finally{Qr.transition=r,mt=s}return null}function D8(t,e,n,s){do Zu();while($a!==null);if(ot&6)throw Error(ae(327));n=t.finishedWork;var r=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(ae(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(hK(t,i),t===Bn&&(mn=Bn=null,es=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||bg||(bg=!0,u_(Vy,function(){return Zu(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=Qr.transition,Qr.transition=null;var o=mt;mt=1;var a=ot;ot|=4,KN.current=null,T8(t,n),t_(n,t),QK(_S),Wy=!!FS,_S=FS=null,t.current=n,E8(n),sK(),ot=a,mt=o,Qr.transition=i}else t.current=n;if(bg&&(bg=!1,$a=t,o0=r),i=t.pendingLanes,i===0&&(Va=null),oK(n.stateNode),rr(t,an()),e!==null)for(s=t.onRecoverableError,n=0;n<e.length;n++)r=e[n],s(r.value,{componentStack:r.stack,digest:r.digest});if(i0)throw i0=!1,t=rk,rk=null,t;return o0&1&&t.tag!==0&&Zu(),i=t.pendingLanes,i&1?t===ik?lf++:(lf=0,ik=t):lf=0,gl(),null}function Zu(){if($a!==null){var t=jL(o0),e=Qr.transition,n=mt;try{if(Qr.transition=null,mt=16>t?16:t,$a===null)var s=!1;else{if(t=$a,$a=null,o0=0,ot&6)throw Error(ae(331));var r=ot;for(ot|=4,ye=t.current;ye!==null;){var i=ye,o=i.child;if(ye.flags&16){var a=i.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(ye=c;ye!==null;){var u=ye;switch(u.tag){case 0:case 11:case 15:of(8,u,i)}var d=u.child;if(d!==null)d.return=u,ye=d;else for(;ye!==null;){u=ye;var h=u.sibling,f=u.return;if(QF(u),u===c){ye=null;break}if(h!==null){h.return=f,ye=h;break}ye=f}}}var p=i.alternate;if(p!==null){var m=p.child;if(m!==null){p.child=null;do{var g=m.sibling;m.sibling=null,m=g}while(m!==null)}}ye=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,ye=o;else e:for(;ye!==null;){if(i=ye,i.flags&2048)switch(i.tag){case 0:case 11:case 15:of(9,i,i.return)}var y=i.sibling;if(y!==null){y.return=i.return,ye=y;break e}ye=i.return}}var x=t.current;for(ye=x;ye!==null;){o=ye;var v=o.child;if(o.subtreeFlags&2064&&v!==null)v.return=o,ye=v;else e:for(o=x;ye!==null;){if(a=ye,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Yx(9,a)}}catch(S){qt(a,a.return,S)}if(a===o){ye=null;break e}var w=a.sibling;if(w!==null){w.return=a.return,ye=w;break e}ye=a.return}}if(ot=r,gl(),no&&typeof no.onPostCommitFiberRoot=="function")try{no.onPostCommitFiberRoot(Ux,t)}catch{}s=!0}return s}finally{mt=n,Qr.transition=e}}return!1}function L$(t,e,n){e=pd(n,e),e=jF(t,e,1),t=ja(t,e,1),e=Ps(),t!==null&&(wp(t,1,e),rr(t,e))}function qt(t,e,n){if(t.tag===3)L$(t,t,n);else for(;e!==null;){if(e.tag===3){L$(e,t,n);break}else if(e.tag===1){var s=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(Va===null||!Va.has(s))){t=pd(n,t),t=VF(e,t,1),e=ja(e,t,1),t=Ps(),e!==null&&(wp(e,1,t),rr(e,t));break}}e=e.return}}function O8(t,e,n){var s=t.pingCache;s!==null&&s.delete(e),e=Ps(),t.pingedLanes|=t.suspendedLanes&n,Bn===t&&(es&n)===n&&($n===4||$n===3&&(es&130023424)===es&&500>an()-XN?ac(t,0):qN|=n),rr(t,e)}function l_(t,e){e===0&&(t.mode&1?(e=cg,cg<<=1,!(cg&130023424)&&(cg=4194304)):e=1);var n=Ps();t=Qo(t,e),t!==null&&(wp(t,e,n),rr(t,n))}function M8(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),l_(t,n)}function P8(t,e){var n=0;switch(t.tag){case 13:var s=t.stateNode,r=t.memoizedState;r!==null&&(n=r.retryLane);break;case 19:s=t.stateNode;break;default:throw Error(ae(314))}s!==null&&s.delete(e),l_(t,n)}var c_;c_=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||nr.current)Zs=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Zs=!1,S8(t,e,n);Zs=!!(t.flags&131072)}else Zs=!1,Ft&&e.flags&1048576&&fF(e,Yy,e.index);switch(e.lanes=0,e.tag){case 2:var s=e.type;py(t,e),t=e.pendingProps;var r=ud(e,Ss.current);Qu(e,n),r=VN(null,e,s,t,r,n);var i=UN();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,sr(s)?(i=!0,Xy(e)):i=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,FN(e),r.updater=Jx,e.stateNode=r,r._reactInternals=e,KS(e,s,t,n),e=JS(null,e,s,!0,i,n)):(e.tag=0,Ft&&i&&$N(e),As(null,e,r,n),e=e.child),e;case 16:s=e.elementType;e:{switch(py(t,e),t=e.pendingProps,r=s._init,s=r(s._payload),e.type=s,r=e.tag=F8(s),t=mi(s,t),r){case 0:e=XS(null,e,s,t,n);break e;case 1:e=T$(null,e,s,t,n);break e;case 11:e=C$(null,e,s,t,n);break e;case 14:e=N$(null,e,s,mi(s.type,t),n);break e}throw Error(ae(306,s,""))}return e;case 0:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:mi(s,r),XS(t,e,s,r,n);case 1:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:mi(s,r),T$(t,e,s,r,n);case 3:e:{if(GF(e),t===null)throw Error(ae(387));s=e.pendingProps,i=e.memoizedState,r=i.element,bF(t,e),e0(e,s,null,n);var o=e.memoizedState;if(s=o.element,i.isDehydrated)if(i={element:s,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){r=pd(Error(ae(423)),e),e=E$(t,e,s,n,r);break e}else if(s!==r){r=pd(Error(ae(424)),e),e=E$(t,e,s,n,r);break e}else for(xr=Ba(e.stateNode.containerInfo.firstChild),vr=e,Ft=!0,xi=null,n=yF(e,null,s,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(dd(),s===r){e=Zo(t,e,n);break e}As(t,e,s,n)}e=e.child}return e;case 5:return vF(e),t===null&&WS(e),s=e.type,r=e.pendingProps,i=t!==null?t.memoizedProps:null,o=r.children,zS(s,r)?o=null:i!==null&&zS(s,i)&&(e.flags|=32),HF(t,e),As(t,e,o,n),e.child;case 6:return t===null&&WS(e),null;case 13:return KF(t,e,n);case 4:return _N(e,e.stateNode.containerInfo),s=e.pendingProps,t===null?e.child=hd(e,null,s,n):As(t,e,s,n),e.child;case 11:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:mi(s,r),C$(t,e,s,r,n);case 7:return As(t,e,e.pendingProps,n),e.child;case 8:return As(t,e,e.pendingProps.children,n),e.child;case 12:return As(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(s=e.type._context,r=e.pendingProps,i=e.memoizedProps,o=r.value,Nt(Qy,s._currentValue),s._currentValue=o,i!==null)if(Ri(i.value,o)){if(i.children===r.children&&!nr.current){e=Zo(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var a=i.dependencies;if(a!==null){o=i.child;for(var l=a.firstContext;l!==null;){if(l.context===s){if(i.tag===1){l=Ho(-1,n&-n),l.tag=2;var c=i.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}i.lanes|=n,l=i.alternate,l!==null&&(l.lanes|=n),HS(i.return,n,e),a.lanes|=n;break}l=l.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(ae(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),HS(o,n,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}As(t,e,r.children,n),e=e.child}return e;case 9:return r=e.type,s=e.pendingProps.children,Qu(e,n),r=ni(r),s=s(r),e.flags|=1,As(t,e,s,n),e.child;case 14:return s=e.type,r=mi(s,e.pendingProps),r=mi(s.type,r),N$(t,e,s,r,n);case 15:return UF(t,e,e.type,e.pendingProps,n);case 17:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:mi(s,r),py(t,e),e.tag=1,sr(s)?(t=!0,Xy(e)):t=!1,Qu(e,n),BF(e,s,r),KS(e,s,r,n),JS(null,e,s,!0,t,n);case 19:return qF(t,e,n);case 22:return WF(t,e,n)}throw Error(ae(156,e.tag))};function u_(t,e){return FL(t,e)}function L8(t,e,n,s){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Gr(t,e,n,s){return new L8(t,e,n,s)}function ZN(t){return t=t.prototype,!(!t||!t.isReactComponent)}function F8(t){if(typeof t=="function")return ZN(t)?1:0;if(t!=null){if(t=t.$$typeof,t===xN)return 11;if(t===bN)return 14}return 2}function Wa(t,e){var n=t.alternate;return n===null?(n=Gr(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function yy(t,e,n,s,r,i){var o=2;if(s=t,typeof t=="function")ZN(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case Ru:return lc(n.children,r,i,e);case yN:o=8,r|=8;break;case yS:return t=Gr(12,n,e,r|2),t.elementType=yS,t.lanes=i,t;case xS:return t=Gr(13,n,e,r),t.elementType=xS,t.lanes=i,t;case bS:return t=Gr(19,n,e,r),t.elementType=bS,t.lanes=i,t;case vL:return Zx(n,r,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case xL:o=10;break e;case bL:o=9;break e;case xN:o=11;break e;case bN:o=14;break e;case ya:o=16,s=null;break e}throw Error(ae(130,t==null?t:typeof t,""))}return e=Gr(o,n,e,r),e.elementType=t,e.type=s,e.lanes=i,e}function lc(t,e,n,s){return t=Gr(7,t,s,e),t.lanes=n,t}function Zx(t,e,n,s){return t=Gr(22,t,s,e),t.elementType=vL,t.lanes=n,t.stateNode={isHidden:!1},t}function G1(t,e,n){return t=Gr(6,t,null,e),t.lanes=n,t}function K1(t,e,n){return e=Gr(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function _8(t,e,n,s,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=E1(0),this.expirationTimes=E1(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=E1(0),this.identifierPrefix=s,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function eT(t,e,n,s,r,i,o,a,l){return t=new _8(t,e,n,a,l),e===1?(e=1,i===!0&&(e|=8)):e=0,i=Gr(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:s,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},FN(i),t}function z8(t,e,n){var s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:$u,key:s==null?null:""+s,children:t,containerInfo:e,implementation:n}}function d_(t){if(!t)return sl;t=t._reactInternals;e:{if(Gc(t)!==t||t.tag!==1)throw Error(ae(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(sr(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(ae(171))}if(t.tag===1){var n=t.type;if(sr(n))return dF(t,n,e)}return e}function h_(t,e,n,s,r,i,o,a,l){return t=eT(n,s,!0,t,r,i,o,a,l),t.context=d_(null),n=t.current,s=Ps(),r=Ua(n),i=Ho(s,r),i.callback=e??null,ja(n,i,r),t.current.lanes=r,wp(t,r,s),rr(t,s),t}function eb(t,e,n,s){var r=e.current,i=Ps(),o=Ua(r);return n=d_(n),e.context===null?e.context=n:e.pendingContext=n,e=Ho(i,o),e.payload={element:t},s=s===void 0?null:s,s!==null&&(e.callback=s),t=ja(r,e,o),t!==null&&(Ni(t,r,o,i),dy(t,r,o)),o}function l0(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function F$(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function tT(t,e){F$(t,e),(t=t.alternate)&&F$(t,e)}function B8(){return null}var f_=typeof reportError=="function"?reportError:function(t){console.error(t)};function nT(t){this._internalRoot=t}tb.prototype.render=nT.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(ae(409));eb(t,e,null,null)};tb.prototype.unmount=nT.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Sc(function(){eb(null,t,null,null)}),e[Yo]=null}};function tb(t){this._internalRoot=t}tb.prototype.unstable_scheduleHydration=function(t){if(t){var e=WL();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Ca.length&&e!==0&&e<Ca[n].priority;n++);Ca.splice(n,0,t),n===0&&GL(t)}};function sT(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function nb(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function _$(){}function j8(t,e,n,s,r){if(r){if(typeof s=="function"){var i=s;s=function(){var c=l0(o);i.call(c)}}var o=h_(e,s,t,0,null,!1,!1,"",_$);return t._reactRootContainer=o,t[Yo]=o.current,Pf(t.nodeType===8?t.parentNode:t),Sc(),o}for(;r=t.lastChild;)t.removeChild(r);if(typeof s=="function"){var a=s;s=function(){var c=l0(l);a.call(c)}}var l=eT(t,0,!1,null,null,!1,!1,"",_$);return t._reactRootContainer=l,t[Yo]=l.current,Pf(t.nodeType===8?t.parentNode:t),Sc(function(){eb(e,l,n,s)}),l}function sb(t,e,n,s,r){var i=n._reactRootContainer;if(i){var o=i;if(typeof r=="function"){var a=r;r=function(){var l=l0(o);a.call(l)}}eb(e,o,t,r)}else o=j8(n,e,t,r,s);return l0(o)}VL=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=_h(e.pendingLanes);n!==0&&(SN(e,n|1),rr(e,an()),!(ot&6)&&(md=an()+500,gl()))}break;case 13:Sc(function(){var s=Qo(t,1);if(s!==null){var r=Ps();Ni(s,t,1,r)}}),tT(t,1)}};kN=function(t){if(t.tag===13){var e=Qo(t,134217728);if(e!==null){var n=Ps();Ni(e,t,134217728,n)}tT(t,134217728)}};UL=function(t){if(t.tag===13){var e=Ua(t),n=Qo(t,e);if(n!==null){var s=Ps();Ni(n,t,e,s)}tT(t,e)}};WL=function(){return mt};HL=function(t,e){var n=mt;try{return mt=t,e()}finally{mt=n}};AS=function(t,e,n){switch(e){case"input":if(SS(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var s=n[e];if(s!==t&&s.form===t.form){var r=Kx(s);if(!r)throw Error(ae(90));SL(s),SS(s,r)}}}break;case"textarea":CL(t,n);break;case"select":e=n.value,e!=null&&qu(t,!!n.multiple,e,!1)}};RL=JN;DL=Sc;var V8={usingClientEntryPoint:!1,Events:[kp,Pu,Kx,AL,$L,JN]},yh={findFiberByHostInstance:Xl,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},U8={bundleType:yh.bundleType,version:yh.version,rendererPackageName:yh.rendererPackageName,rendererConfig:yh.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:oa.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=PL(t),t===null?null:t.stateNode},findFiberByHostInstance:yh.findFiberByHostInstance||B8,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var vg=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vg.isDisabled&&vg.supportsFiber)try{Ux=vg.inject(U8),no=vg}catch{}}Nr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=V8;Nr.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!sT(e))throw Error(ae(200));return z8(t,e,null,n)};Nr.createRoot=function(t,e){if(!sT(t))throw Error(ae(299));var n=!1,s="",r=f_;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(s=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=eT(t,1,!1,null,null,n,!1,s,r),t[Yo]=e.current,Pf(t.nodeType===8?t.parentNode:t),new nT(e)};Nr.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(ae(188)):(t=Object.keys(t).join(","),Error(ae(268,t)));return t=PL(e),t=t===null?null:t.stateNode,t};Nr.flushSync=function(t){return Sc(t)};Nr.hydrate=function(t,e,n){if(!nb(e))throw Error(ae(200));return sb(null,t,e,!0,n)};Nr.hydrateRoot=function(t,e,n){if(!sT(t))throw Error(ae(405));var s=n!=null&&n.hydratedSources||null,r=!1,i="",o=f_;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=h_(e,null,t,1,n??null,r,!1,i,o),t[Yo]=e.current,Pf(t),s)for(t=0;t<s.length;t++)n=s[t],r=n._getVersion,r=r(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,r]:e.mutableSourceEagerHydrationData.push(n,r);return new tb(e)};Nr.render=function(t,e,n){if(!nb(e))throw Error(ae(200));return sb(null,t,e,!1,n)};Nr.unmountComponentAtNode=function(t){if(!nb(t))throw Error(ae(40));return t._reactRootContainer?(Sc(function(){sb(null,null,t,!1,function(){t._reactRootContainer=null,t[Yo]=null})}),!0):!1};Nr.unstable_batchedUpdates=JN;Nr.unstable_renderSubtreeIntoContainer=function(t,e,n,s){if(!nb(n))throw Error(ae(200));if(t==null||t._reactInternals===void 0)throw Error(ae(38));return sb(t,e,n,!1,s)};Nr.version="18.3.1-next-f1338f8080-20240426";function p_(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(p_)}catch(t){console.error(t)}}p_(),pL.exports=Nr;var rT=pL.exports;const W8=bp(rT);var z$=rT;mS.createRoot=z$.createRoot,mS.hydrateRoot=z$.hydrateRoot;const H8="modulepreload",G8=function(t){return"/"+t},B$={},bs=function(e,n,s){if(!n||n.length===0)return e();const r=document.getElementsByTagName("link");return Promise.all(n.map(i=>{if(i=G8(i),i in B$)return;B$[i]=!0;const o=i.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!s)for(let u=r.length-1;u>=0;u--){const d=r[u];if(d.href===i&&(!o||d.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":H8,o||(c.as="script",c.crossOrigin=""),c.href=i,document.head.appendChild(c),o)return new Promise((u,d)=>{c.addEventListener("load",u),c.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>e()).catch(i=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i})},j$=t=>{let e;const n=new Set,s=(u,d)=>{const h=typeof u=="function"?u(e):u;if(!Object.is(h,e)){const f=e;e=d??(typeof h!="object"||h===null)?h:Object.assign({},e,h),n.forEach(p=>p(e,f))}},r=()=>e,l={setState:s,getState:r,getInitialState:()=>c,subscribe:u=>(n.add(u),()=>n.delete(u)),destroy:()=>{n.clear()}},c=e=t(s,r,l);return l},K8=t=>t?j$(t):j$;var m_={exports:{}},g_={},y_={exports:{}},x_={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gd=z;function q8(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var X8=typeof Object.is=="function"?Object.is:q8,J8=gd.useState,Y8=gd.useEffect,Q8=gd.useLayoutEffect,Z8=gd.useDebugValue;function eq(t,e){var n=e(),s=J8({inst:{value:n,getSnapshot:e}}),r=s[0].inst,i=s[1];return Q8(function(){r.value=n,r.getSnapshot=e,q1(r)&&i({inst:r})},[t,n,e]),Y8(function(){return q1(r)&&i({inst:r}),t(function(){q1(r)&&i({inst:r})})},[t]),Z8(n),n}function q1(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!X8(t,n)}catch{return!0}}function tq(t,e){return e()}var nq=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?tq:eq;x_.useSyncExternalStore=gd.useSyncExternalStore!==void 0?gd.useSyncExternalStore:nq;y_.exports=x_;var iT=y_.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rb=z,sq=iT;function rq(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var iq=typeof Object.is=="function"?Object.is:rq,oq=sq.useSyncExternalStore,aq=rb.useRef,lq=rb.useEffect,cq=rb.useMemo,uq=rb.useDebugValue;g_.useSyncExternalStoreWithSelector=function(t,e,n,s,r){var i=aq(null);if(i.current===null){var o={hasValue:!1,value:null};i.current=o}else o=i.current;i=cq(function(){function l(f){if(!c){if(c=!0,u=f,f=s(f),r!==void 0&&o.hasValue){var p=o.value;if(r(p,f))return d=p}return d=f}if(p=d,iq(u,f))return p;var m=s(f);return r!==void 0&&r(p,m)?(u=f,p):(u=f,d=m)}var c=!1,u,d,h=n===void 0?null:n;return[function(){return l(e())},h===null?void 0:function(){return l(h())}]},[e,n,s,r]);var a=oq(t,i[0],i[1]);return lq(function(){o.hasValue=!0,o.value=a},[a]),uq(a),a};m_.exports=g_;var b_=m_.exports;const dq=bp(b_),{useDebugValue:hq}=Fs,{useSyncExternalStoreWithSelector:fq}=dq;const pq=t=>t;function mq(t,e=pq,n){const s=fq(t.subscribe,t.getState,t.getServerState||t.getInitialState,e,n);return hq(s),s}const V$=t=>{const e=typeof t=="function"?K8(t):t,n=(s,r)=>mq(e,s,r);return Object.assign(n,e),n},wo=t=>t?V$(t):V$;function gq(t,e){let n;try{n=t()}catch{return}return{getItem:r=>{var i;const o=l=>l===null?null:JSON.parse(l,e==null?void 0:e.reviver),a=(i=n.getItem(r))!=null?i:null;return a instanceof Promise?a.then(o):o(a)},setItem:(r,i)=>n.setItem(r,JSON.stringify(i,e==null?void 0:e.replacer)),removeItem:r=>n.removeItem(r)}}const Wf=t=>e=>{try{const n=t(e);return n instanceof Promise?n:{then(s){return Wf(s)(n)},catch(s){return this}}}catch(n){return{then(s){return this},catch(s){return Wf(s)(n)}}}},yq=(t,e)=>(n,s,r)=>{let i={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:g=>g,version:0,merge:(g,y)=>({...y,...g}),...e},o=!1;const a=new Set,l=new Set;let c;try{c=i.getStorage()}catch{}if(!c)return t((...g)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),n(...g)},s,r);const u=Wf(i.serialize),d=()=>{const g=i.partialize({...s()});let y;const x=u({state:g,version:i.version}).then(v=>c.setItem(i.name,v)).catch(v=>{y=v});if(y)throw y;return x},h=r.setState;r.setState=(g,y)=>{h(g,y),d()};const f=t((...g)=>{n(...g),d()},s,r);let p;const m=()=>{var g;if(!c)return;o=!1,a.forEach(x=>x(s()));const y=((g=i.onRehydrateStorage)==null?void 0:g.call(i,s()))||void 0;return Wf(c.getItem.bind(c))(i.name).then(x=>{if(x)return i.deserialize(x)}).then(x=>{if(x)if(typeof x.version=="number"&&x.version!==i.version){if(i.migrate)return i.migrate(x.state,x.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return x.state}).then(x=>{var v;return p=i.merge(x,(v=s())!=null?v:f),n(p,!0),d()}).then(()=>{y==null||y(p,void 0),o=!0,l.forEach(x=>x(p))}).catch(x=>{y==null||y(void 0,x)})};return r.persist={setOptions:g=>{i={...i,...g},g.getStorage&&(c=g.getStorage())},clearStorage:()=>{c==null||c.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>m(),hasHydrated:()=>o,onHydrate:g=>(a.add(g),()=>{a.delete(g)}),onFinishHydration:g=>(l.add(g),()=>{l.delete(g)})},m(),p||f},xq=(t,e)=>(n,s,r)=>{let i={storage:gq(()=>localStorage),partialize:m=>m,version:0,merge:(m,g)=>({...g,...m}),...e},o=!1;const a=new Set,l=new Set;let c=i.storage;if(!c)return t((...m)=>{console.warn(`[zustand persist middleware] Unable to update item '${i.name}', the given storage is currently unavailable.`),n(...m)},s,r);const u=()=>{const m=i.partialize({...s()});return c.setItem(i.name,{state:m,version:i.version})},d=r.setState;r.setState=(m,g)=>{d(m,g),u()};const h=t((...m)=>{n(...m),u()},s,r);r.getInitialState=()=>h;let f;const p=()=>{var m,g;if(!c)return;o=!1,a.forEach(x=>{var v;return x((v=s())!=null?v:h)});const y=((g=i.onRehydrateStorage)==null?void 0:g.call(i,(m=s())!=null?m:h))||void 0;return Wf(c.getItem.bind(c))(i.name).then(x=>{if(x)if(typeof x.version=="number"&&x.version!==i.version){if(i.migrate)return[!0,i.migrate(x.state,x.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,x.state];return[!1,void 0]}).then(x=>{var v;const[w,S]=x;if(f=i.merge(S,(v=s())!=null?v:h),n(f,!0),w)return u()}).then(()=>{y==null||y(f,void 0),f=s(),o=!0,l.forEach(x=>x(f))}).catch(x=>{y==null||y(void 0,x)})};return r.persist={setOptions:m=>{i={...i,...m},m.storage&&(c=m.storage)},clearStorage:()=>{c==null||c.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>p(),hasHydrated:()=>o,onHydrate:m=>(a.add(m),()=>{a.delete(m)}),onFinishHydration:m=>(l.add(m),()=>{l.delete(m)})},i.skipHydration||p(),f||h},bq=(t,e)=>"getStorage"in e||"serialize"in e||"deserialize"in e?yq(t,e):xq(t,e),v_=bq;function w_(t,e){return function(){return t.apply(e,arguments)}}const{toString:vq}=Object.prototype,{getPrototypeOf:oT}=Object,{iterator:ib,toStringTag:S_}=Symbol,ob=(t=>e=>{const n=vq.call(e);return t[n]||(t[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),Pi=t=>(t=t.toLowerCase(),e=>ob(e)===t),ab=t=>e=>typeof e===t,{isArray:Ud}=Array,yd=ab("undefined");function Np(t){return t!==null&&!yd(t)&&t.constructor!==null&&!yd(t.constructor)&&ir(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const k_=Pi("ArrayBuffer");function wq(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&k_(t.buffer),e}const Sq=ab("string"),ir=ab("function"),C_=ab("number"),Tp=t=>t!==null&&typeof t=="object",kq=t=>t===!0||t===!1,xy=t=>{if(ob(t)!=="object")return!1;const e=oT(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(S_ in t)&&!(ib in t)},Cq=t=>{if(!Tp(t)||Np(t))return!1;try{return Object.keys(t).length===0&&Object.getPrototypeOf(t)===Object.prototype}catch{return!1}},Nq=Pi("Date"),Tq=Pi("File"),Eq=Pi("Blob"),Iq=Pi("FileList"),Aq=t=>Tp(t)&&ir(t.pipe),$q=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||ir(t.append)&&((e=ob(t))==="formdata"||e==="object"&&ir(t.toString)&&t.toString()==="[object FormData]"))},Rq=Pi("URLSearchParams"),[Dq,Oq,Mq,Pq]=["ReadableStream","Request","Response","Headers"].map(Pi),Lq=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Ep(t,e,{allOwnKeys:n=!1}={}){if(t===null||typeof t>"u")return;let s,r;if(typeof t!="object"&&(t=[t]),Ud(t))for(s=0,r=t.length;s<r;s++)e.call(null,t[s],s,t);else{if(Np(t))return;const i=n?Object.getOwnPropertyNames(t):Object.keys(t),o=i.length;let a;for(s=0;s<o;s++)a=i[s],e.call(null,t[a],a,t)}}function N_(t,e){if(Np(t))return null;e=e.toLowerCase();const n=Object.keys(t);let s=n.length,r;for(;s-- >0;)if(r=n[s],e===r.toLowerCase())return r;return null}const Ql=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:globalThis)(),T_=t=>!yd(t)&&t!==Ql;function lk(){const{caseless:t,skipUndefined:e}=T_(this)&&this||{},n={},s=(r,i)=>{const o=t&&N_(n,i)||i;xy(n[o])&&xy(r)?n[o]=lk(n[o],r):xy(r)?n[o]=lk({},r):Ud(r)?n[o]=r.slice():(!e||!yd(r))&&(n[o]=r)};for(let r=0,i=arguments.length;r<i;r++)arguments[r]&&Ep(arguments[r],s);return n}const Fq=(t,e,n,{allOwnKeys:s}={})=>(Ep(e,(r,i)=>{n&&ir(r)?t[i]=w_(r,n):t[i]=r},{allOwnKeys:s}),t),_q=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),zq=(t,e,n,s)=>{t.prototype=Object.create(e.prototype,s),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),n&&Object.assign(t.prototype,n)},Bq=(t,e,n,s)=>{let r,i,o;const a={};if(e=e||{},t==null)return e;do{for(r=Object.getOwnPropertyNames(t),i=r.length;i-- >0;)o=r[i],(!s||s(o,t,e))&&!a[o]&&(e[o]=t[o],a[o]=!0);t=n!==!1&&oT(t)}while(t&&(!n||n(t,e))&&t!==Object.prototype);return e},jq=(t,e,n)=>{t=String(t),(n===void 0||n>t.length)&&(n=t.length),n-=e.length;const s=t.indexOf(e,n);return s!==-1&&s===n},Vq=t=>{if(!t)return null;if(Ud(t))return t;let e=t.length;if(!C_(e))return null;const n=new Array(e);for(;e-- >0;)n[e]=t[e];return n},Uq=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&oT(Uint8Array)),Wq=(t,e)=>{const s=(t&&t[ib]).call(t);let r;for(;(r=s.next())&&!r.done;){const i=r.value;e.call(t,i[0],i[1])}},Hq=(t,e)=>{let n;const s=[];for(;(n=t.exec(e))!==null;)s.push(n);return s},Gq=Pi("HTMLFormElement"),Kq=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,s,r){return s.toUpperCase()+r}),U$=(({hasOwnProperty:t})=>(e,n)=>t.call(e,n))(Object.prototype),qq=Pi("RegExp"),E_=(t,e)=>{const n=Object.getOwnPropertyDescriptors(t),s={};Ep(n,(r,i)=>{let o;(o=e(r,i,t))!==!1&&(s[i]=o||r)}),Object.defineProperties(t,s)},Xq=t=>{E_(t,(e,n)=>{if(ir(t)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const s=t[n];if(ir(s)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},Jq=(t,e)=>{const n={},s=r=>{r.forEach(i=>{n[i]=!0})};return Ud(t)?s(t):s(String(t).split(e)),n},Yq=()=>{},Qq=(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e;function Zq(t){return!!(t&&ir(t.append)&&t[S_]==="FormData"&&t[ib])}const e9=t=>{const e=new Array(10),n=(s,r)=>{if(Tp(s)){if(e.indexOf(s)>=0)return;if(Np(s))return s;if(!("toJSON"in s)){e[r]=s;const i=Ud(s)?[]:{};return Ep(s,(o,a)=>{const l=n(o,r+1);!yd(l)&&(i[a]=l)}),e[r]=void 0,i}}return s};return n(t,0)},t9=Pi("AsyncFunction"),n9=t=>t&&(Tp(t)||ir(t))&&ir(t.then)&&ir(t.catch),I_=((t,e)=>t?setImmediate:e?((n,s)=>(Ql.addEventListener("message",({source:r,data:i})=>{r===Ql&&i===n&&s.length&&s.shift()()},!1),r=>{s.push(r),Ql.postMessage(n,"*")}))(`axios@${Math.random()}`,[]):n=>setTimeout(n))(typeof setImmediate=="function",ir(Ql.postMessage)),s9=typeof queueMicrotask<"u"?queueMicrotask.bind(Ql):typeof process<"u"&&process.nextTick||I_,r9=t=>t!=null&&ir(t[ib]),J={isArray:Ud,isArrayBuffer:k_,isBuffer:Np,isFormData:$q,isArrayBufferView:wq,isString:Sq,isNumber:C_,isBoolean:kq,isObject:Tp,isPlainObject:xy,isEmptyObject:Cq,isReadableStream:Dq,isRequest:Oq,isResponse:Mq,isHeaders:Pq,isUndefined:yd,isDate:Nq,isFile:Tq,isBlob:Eq,isRegExp:qq,isFunction:ir,isStream:Aq,isURLSearchParams:Rq,isTypedArray:Uq,isFileList:Iq,forEach:Ep,merge:lk,extend:Fq,trim:Lq,stripBOM:_q,inherits:zq,toFlatObject:Bq,kindOf:ob,kindOfTest:Pi,endsWith:jq,toArray:Vq,forEachEntry:Wq,matchAll:Hq,isHTMLForm:Gq,hasOwnProperty:U$,hasOwnProp:U$,reduceDescriptors:E_,freezeMethods:Xq,toObjectSet:Jq,toCamelCase:Kq,noop:Yq,toFiniteNumber:Qq,findKey:N_,globalThis:Ql,isContextDefined:T_,isSpecCompliantForm:Zq,toJSONObject:e9,isAsyncFn:t9,isThenable:n9,setImmediate:I_,asap:s9,isIterable:r9};function je(t,e,n,s,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),s&&(this.request=s),r&&(this.response=r,this.status=r.status?r.status:null)}J.inherits(je,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:J.toJSONObject(this.config),code:this.code,status:this.status}}});const A_=je.prototype,$_={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{$_[t]={value:t}});Object.defineProperties(je,$_);Object.defineProperty(A_,"isAxiosError",{value:!0});je.from=(t,e,n,s,r,i)=>{const o=Object.create(A_);J.toFlatObject(t,o,function(u){return u!==Error.prototype},c=>c!=="isAxiosError");const a=t&&t.message?t.message:"Error",l=e==null&&t?t.code:e;return je.call(o,a,l,n,s,r),t&&o.cause==null&&Object.defineProperty(o,"cause",{value:t,configurable:!0}),o.name=t&&t.name||"Error",i&&Object.assign(o,i),o};const i9=null;function ck(t){return J.isPlainObject(t)||J.isArray(t)}function R_(t){return J.endsWith(t,"[]")?t.slice(0,-2):t}function W$(t,e,n){return t?t.concat(e).map(function(r,i){return r=R_(r),!n&&i?"["+r+"]":r}).join(n?".":""):e}function o9(t){return J.isArray(t)&&!t.some(ck)}const a9=J.toFlatObject(J,{},null,function(e){return/^is[A-Z]/.test(e)});function lb(t,e,n){if(!J.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,n=J.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(m,g){return!J.isUndefined(g[m])});const s=n.metaTokens,r=n.visitor||u,i=n.dots,o=n.indexes,l=(n.Blob||typeof Blob<"u"&&Blob)&&J.isSpecCompliantForm(e);if(!J.isFunction(r))throw new TypeError("visitor must be a function");function c(p){if(p===null)return"";if(J.isDate(p))return p.toISOString();if(J.isBoolean(p))return p.toString();if(!l&&J.isBlob(p))throw new je("Blob is not supported. Use a Buffer instead.");return J.isArrayBuffer(p)||J.isTypedArray(p)?l&&typeof Blob=="function"?new Blob([p]):Buffer.from(p):p}function u(p,m,g){let y=p;if(p&&!g&&typeof p=="object"){if(J.endsWith(m,"{}"))m=s?m:m.slice(0,-2),p=JSON.stringify(p);else if(J.isArray(p)&&o9(p)||(J.isFileList(p)||J.endsWith(m,"[]"))&&(y=J.toArray(p)))return m=R_(m),y.forEach(function(v,w){!(J.isUndefined(v)||v===null)&&e.append(o===!0?W$([m],w,i):o===null?m:m+"[]",c(v))}),!1}return ck(p)?!0:(e.append(W$(g,m,i),c(p)),!1)}const d=[],h=Object.assign(a9,{defaultVisitor:u,convertValue:c,isVisitable:ck});function f(p,m){if(!J.isUndefined(p)){if(d.indexOf(p)!==-1)throw Error("Circular reference detected in "+m.join("."));d.push(p),J.forEach(p,function(y,x){(!(J.isUndefined(y)||y===null)&&r.call(e,y,J.isString(x)?x.trim():x,m,h))===!0&&f(y,m?m.concat(x):[x])}),d.pop()}}if(!J.isObject(t))throw new TypeError("data must be an object");return f(t),e}function H$(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(s){return e[s]})}function aT(t,e){this._pairs=[],t&&lb(t,this,e)}const D_=aT.prototype;D_.append=function(e,n){this._pairs.push([e,n])};D_.toString=function(e){const n=e?function(s){return e.call(this,s,H$)}:H$;return this._pairs.map(function(r){return n(r[0])+"="+n(r[1])},"").join("&")};function l9(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function O_(t,e,n){if(!e)return t;const s=n&&n.encode||l9;J.isFunction(n)&&(n={serialize:n});const r=n&&n.serialize;let i;if(r?i=r(e,n):i=J.isURLSearchParams(e)?e.toString():new aT(e,n).toString(s),i){const o=t.indexOf("#");o!==-1&&(t=t.slice(0,o)),t+=(t.indexOf("?")===-1?"?":"&")+i}return t}class c9{constructor(){this.handlers=[]}use(e,n,s){return this.handlers.push({fulfilled:e,rejected:n,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){J.forEach(this.handlers,function(s){s!==null&&e(s)})}}const G$=c9,M_={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},u9=typeof URLSearchParams<"u"?URLSearchParams:aT,d9=typeof FormData<"u"?FormData:null,h9=typeof Blob<"u"?Blob:null,f9={isBrowser:!0,classes:{URLSearchParams:u9,FormData:d9,Blob:h9},protocols:["http","https","file","blob","url","data"]},lT=typeof window<"u"&&typeof document<"u",uk=typeof navigator=="object"&&navigator||void 0,p9=lT&&(!uk||["ReactNative","NativeScript","NS"].indexOf(uk.product)<0),m9=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),g9=lT&&window.location.href||"http://localhost",y9=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:lT,hasStandardBrowserEnv:p9,hasStandardBrowserWebWorkerEnv:m9,navigator:uk,origin:g9},Symbol.toStringTag,{value:"Module"})),ys={...y9,...f9};function x9(t,e){return lb(t,new ys.classes.URLSearchParams,{visitor:function(n,s,r,i){return ys.isNode&&J.isBuffer(n)?(this.append(s,n.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)},...e})}function b9(t){return J.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function v9(t){const e={},n=Object.keys(t);let s;const r=n.length;let i;for(s=0;s<r;s++)i=n[s],e[i]=t[i];return e}function P_(t){function e(n,s,r,i){let o=n[i++];if(o==="__proto__")return!0;const a=Number.isFinite(+o),l=i>=n.length;return o=!o&&J.isArray(r)?r.length:o,l?(J.hasOwnProp(r,o)?r[o]=[r[o],s]:r[o]=s,!a):((!r[o]||!J.isObject(r[o]))&&(r[o]=[]),e(n,s,r[o],i)&&J.isArray(r[o])&&(r[o]=v9(r[o])),!a)}if(J.isFormData(t)&&J.isFunction(t.entries)){const n={};return J.forEachEntry(t,(s,r)=>{e(b9(s),r,n,0)}),n}return null}function w9(t,e,n){if(J.isString(t))try{return(e||JSON.parse)(t),J.trim(t)}catch(s){if(s.name!=="SyntaxError")throw s}return(n||JSON.stringify)(t)}const cT={transitional:M_,adapter:["xhr","http","fetch"],transformRequest:[function(e,n){const s=n.getContentType()||"",r=s.indexOf("application/json")>-1,i=J.isObject(e);if(i&&J.isHTMLForm(e)&&(e=new FormData(e)),J.isFormData(e))return r?JSON.stringify(P_(e)):e;if(J.isArrayBuffer(e)||J.isBuffer(e)||J.isStream(e)||J.isFile(e)||J.isBlob(e)||J.isReadableStream(e))return e;if(J.isArrayBufferView(e))return e.buffer;if(J.isURLSearchParams(e))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(i){if(s.indexOf("application/x-www-form-urlencoded")>-1)return x9(e,this.formSerializer).toString();if((a=J.isFileList(e))||s.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return lb(a?{"files[]":e}:e,l&&new l,this.formSerializer)}}return i||r?(n.setContentType("application/json",!1),w9(e)):e}],transformResponse:[function(e){const n=this.transitional||cT.transitional,s=n&&n.forcedJSONParsing,r=this.responseType==="json";if(J.isResponse(e)||J.isReadableStream(e))return e;if(e&&J.isString(e)&&(s&&!this.responseType||r)){const o=!(n&&n.silentJSONParsing)&&r;try{return JSON.parse(e,this.parseReviver)}catch(a){if(o)throw a.name==="SyntaxError"?je.from(a,je.ERR_BAD_RESPONSE,this,null,this.response):a}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ys.classes.FormData,Blob:ys.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};J.forEach(["delete","get","head","post","put","patch"],t=>{cT.headers[t]={}});const uT=cT,S9=J.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),k9=t=>{const e={};let n,s,r;return t&&t.split(`
`).forEach(function(o){r=o.indexOf(":"),n=o.substring(0,r).trim().toLowerCase(),s=o.substring(r+1).trim(),!(!n||e[n]&&S9[n])&&(n==="set-cookie"?e[n]?e[n].push(s):e[n]=[s]:e[n]=e[n]?e[n]+", "+s:s)}),e},K$=Symbol("internals");function xh(t){return t&&String(t).trim().toLowerCase()}function by(t){return t===!1||t==null?t:J.isArray(t)?t.map(by):String(t)}function C9(t){const e=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=n.exec(t);)e[s[1]]=s[2];return e}const N9=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function X1(t,e,n,s,r){if(J.isFunction(s))return s.call(this,e,n);if(r&&(e=n),!!J.isString(e)){if(J.isString(s))return e.indexOf(s)!==-1;if(J.isRegExp(s))return s.test(e)}}function T9(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,n,s)=>n.toUpperCase()+s)}function E9(t,e){const n=J.toCamelCase(" "+e);["get","set","has"].forEach(s=>{Object.defineProperty(t,s+n,{value:function(r,i,o){return this[s].call(this,e,r,i,o)},configurable:!0})})}class cb{constructor(e){e&&this.set(e)}set(e,n,s){const r=this;function i(a,l,c){const u=xh(l);if(!u)throw new Error("header name must be a non-empty string");const d=J.findKey(r,u);(!d||r[d]===void 0||c===!0||c===void 0&&r[d]!==!1)&&(r[d||l]=by(a))}const o=(a,l)=>J.forEach(a,(c,u)=>i(c,u,l));if(J.isPlainObject(e)||e instanceof this.constructor)o(e,n);else if(J.isString(e)&&(e=e.trim())&&!N9(e))o(k9(e),n);else if(J.isObject(e)&&J.isIterable(e)){let a={},l,c;for(const u of e){if(!J.isArray(u))throw TypeError("Object iterator must return a key-value pair");a[c=u[0]]=(l=a[c])?J.isArray(l)?[...l,u[1]]:[l,u[1]]:u[1]}o(a,n)}else e!=null&&i(n,e,s);return this}get(e,n){if(e=xh(e),e){const s=J.findKey(this,e);if(s){const r=this[s];if(!n)return r;if(n===!0)return C9(r);if(J.isFunction(n))return n.call(this,r,s);if(J.isRegExp(n))return n.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,n){if(e=xh(e),e){const s=J.findKey(this,e);return!!(s&&this[s]!==void 0&&(!n||X1(this,this[s],s,n)))}return!1}delete(e,n){const s=this;let r=!1;function i(o){if(o=xh(o),o){const a=J.findKey(s,o);a&&(!n||X1(s,s[a],a,n))&&(delete s[a],r=!0)}}return J.isArray(e)?e.forEach(i):i(e),r}clear(e){const n=Object.keys(this);let s=n.length,r=!1;for(;s--;){const i=n[s];(!e||X1(this,this[i],i,e,!0))&&(delete this[i],r=!0)}return r}normalize(e){const n=this,s={};return J.forEach(this,(r,i)=>{const o=J.findKey(s,i);if(o){n[o]=by(r),delete n[i];return}const a=e?T9(i):String(i).trim();a!==i&&delete n[i],n[a]=by(r),s[a]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const n=Object.create(null);return J.forEach(this,(s,r)=>{s!=null&&s!==!1&&(n[r]=e&&J.isArray(s)?s.join(", "):s)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,n])=>e+": "+n).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...n){const s=new this(e);return n.forEach(r=>s.set(r)),s}static accessor(e){const s=(this[K$]=this[K$]={accessors:{}}).accessors,r=this.prototype;function i(o){const a=xh(o);s[a]||(E9(r,o),s[a]=!0)}return J.isArray(e)?e.forEach(i):i(e),this}}cb.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);J.reduceDescriptors(cb.prototype,({value:t},e)=>{let n=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(s){this[n]=s}}});J.freezeMethods(cb);const Ti=cb;function J1(t,e){const n=this||uT,s=e||n,r=Ti.from(s.headers);let i=s.data;return J.forEach(t,function(a){i=a.call(n,i,r.normalize(),e?e.status:void 0)}),r.normalize(),i}function L_(t){return!!(t&&t.__CANCEL__)}function Wd(t,e,n){je.call(this,t??"canceled",je.ERR_CANCELED,e,n),this.name="CanceledError"}J.inherits(Wd,je,{__CANCEL__:!0});function F_(t,e,n){const s=n.config.validateStatus;!n.status||!s||s(n.status)?t(n):e(new je("Request failed with status code "+n.status,[je.ERR_BAD_REQUEST,je.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function I9(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function A9(t,e){t=t||10;const n=new Array(t),s=new Array(t);let r=0,i=0,o;return e=e!==void 0?e:1e3,function(l){const c=Date.now(),u=s[i];o||(o=c),n[r]=l,s[r]=c;let d=i,h=0;for(;d!==r;)h+=n[d++],d=d%t;if(r=(r+1)%t,r===i&&(i=(i+1)%t),c-o<e)return;const f=u&&c-u;return f?Math.round(h*1e3/f):void 0}}function $9(t,e){let n=0,s=1e3/e,r,i;const o=(c,u=Date.now())=>{n=u,r=null,i&&(clearTimeout(i),i=null),t(...c)};return[(...c)=>{const u=Date.now(),d=u-n;d>=s?o(c,u):(r=c,i||(i=setTimeout(()=>{i=null,o(r)},s-d)))},()=>r&&o(r)]}const c0=(t,e,n=3)=>{let s=0;const r=A9(50,250);return $9(i=>{const o=i.loaded,a=i.lengthComputable?i.total:void 0,l=o-s,c=r(l),u=o<=a;s=o;const d={loaded:o,total:a,progress:a?o/a:void 0,bytes:l,rate:c||void 0,estimated:c&&a&&u?(a-o)/c:void 0,event:i,lengthComputable:a!=null,[e?"download":"upload"]:!0};t(d)},n)},q$=(t,e)=>{const n=t!=null;return[s=>e[0]({lengthComputable:n,total:t,loaded:s}),e[1]]},X$=t=>(...e)=>J.asap(()=>t(...e)),R9=ys.hasStandardBrowserEnv?((t,e)=>n=>(n=new URL(n,ys.origin),t.protocol===n.protocol&&t.host===n.host&&(e||t.port===n.port)))(new URL(ys.origin),ys.navigator&&/(msie|trident)/i.test(ys.navigator.userAgent)):()=>!0,D9=ys.hasStandardBrowserEnv?{write(t,e,n,s,r,i,o){if(typeof document>"u")return;const a=[`${t}=${encodeURIComponent(e)}`];J.isNumber(n)&&a.push(`expires=${new Date(n).toUTCString()}`),J.isString(s)&&a.push(`path=${s}`),J.isString(r)&&a.push(`domain=${r}`),i===!0&&a.push("secure"),J.isString(o)&&a.push(`SameSite=${o}`),document.cookie=a.join("; ")},read(t){if(typeof document>"u")return null;const e=document.cookie.match(new RegExp("(?:^|; )"+t+"=([^;]*)"));return e?decodeURIComponent(e[1]):null},remove(t){this.write(t,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function O9(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function M9(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function __(t,e,n){let s=!O9(e);return t&&(s||n==!1)?M9(t,e):e}const J$=t=>t instanceof Ti?{...t}:t;function kc(t,e){e=e||{};const n={};function s(c,u,d,h){return J.isPlainObject(c)&&J.isPlainObject(u)?J.merge.call({caseless:h},c,u):J.isPlainObject(u)?J.merge({},u):J.isArray(u)?u.slice():u}function r(c,u,d,h){if(J.isUndefined(u)){if(!J.isUndefined(c))return s(void 0,c,d,h)}else return s(c,u,d,h)}function i(c,u){if(!J.isUndefined(u))return s(void 0,u)}function o(c,u){if(J.isUndefined(u)){if(!J.isUndefined(c))return s(void 0,c)}else return s(void 0,u)}function a(c,u,d){if(d in e)return s(c,u);if(d in t)return s(void 0,c)}const l={url:i,method:i,data:i,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a,headers:(c,u,d)=>r(J$(c),J$(u),d,!0)};return J.forEach(Object.keys({...t,...e}),function(u){const d=l[u]||r,h=d(t[u],e[u],u);J.isUndefined(h)&&d!==a||(n[u]=h)}),n}const z_=t=>{const e=kc({},t);let{data:n,withXSRFToken:s,xsrfHeaderName:r,xsrfCookieName:i,headers:o,auth:a}=e;if(e.headers=o=Ti.from(o),e.url=O_(__(e.baseURL,e.url,e.allowAbsoluteUrls),t.params,t.paramsSerializer),a&&o.set("Authorization","Basic "+btoa((a.username||"")+":"+(a.password?unescape(encodeURIComponent(a.password)):""))),J.isFormData(n)){if(ys.hasStandardBrowserEnv||ys.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if(J.isFunction(n.getHeaders)){const l=n.getHeaders(),c=["content-type","content-length"];Object.entries(l).forEach(([u,d])=>{c.includes(u.toLowerCase())&&o.set(u,d)})}}if(ys.hasStandardBrowserEnv&&(s&&J.isFunction(s)&&(s=s(e)),s||s!==!1&&R9(e.url))){const l=r&&i&&D9.read(i);l&&o.set(r,l)}return e},P9=typeof XMLHttpRequest<"u",L9=P9&&function(t){return new Promise(function(n,s){const r=z_(t);let i=r.data;const o=Ti.from(r.headers).normalize();let{responseType:a,onUploadProgress:l,onDownloadProgress:c}=r,u,d,h,f,p;function m(){f&&f(),p&&p(),r.cancelToken&&r.cancelToken.unsubscribe(u),r.signal&&r.signal.removeEventListener("abort",u)}let g=new XMLHttpRequest;g.open(r.method.toUpperCase(),r.url,!0),g.timeout=r.timeout;function y(){if(!g)return;const v=Ti.from("getAllResponseHeaders"in g&&g.getAllResponseHeaders()),S={data:!a||a==="text"||a==="json"?g.responseText:g.response,status:g.status,statusText:g.statusText,headers:v,config:t,request:g};F_(function(C){n(C),m()},function(C){s(C),m()},S),g=null}"onloadend"in g?g.onloadend=y:g.onreadystatechange=function(){!g||g.readyState!==4||g.status===0&&!(g.responseURL&&g.responseURL.indexOf("file:")===0)||setTimeout(y)},g.onabort=function(){g&&(s(new je("Request aborted",je.ECONNABORTED,t,g)),g=null)},g.onerror=function(w){const S=w&&w.message?w.message:"Network Error",k=new je(S,je.ERR_NETWORK,t,g);k.event=w||null,s(k),g=null},g.ontimeout=function(){let w=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const S=r.transitional||M_;r.timeoutErrorMessage&&(w=r.timeoutErrorMessage),s(new je(w,S.clarifyTimeoutError?je.ETIMEDOUT:je.ECONNABORTED,t,g)),g=null},i===void 0&&o.setContentType(null),"setRequestHeader"in g&&J.forEach(o.toJSON(),function(w,S){g.setRequestHeader(S,w)}),J.isUndefined(r.withCredentials)||(g.withCredentials=!!r.withCredentials),a&&a!=="json"&&(g.responseType=r.responseType),c&&([h,p]=c0(c,!0),g.addEventListener("progress",h)),l&&g.upload&&([d,f]=c0(l),g.upload.addEventListener("progress",d),g.upload.addEventListener("loadend",f)),(r.cancelToken||r.signal)&&(u=v=>{g&&(s(!v||v.type?new Wd(null,t,g):v),g.abort(),g=null)},r.cancelToken&&r.cancelToken.subscribe(u),r.signal&&(r.signal.aborted?u():r.signal.addEventListener("abort",u)));const x=I9(r.url);if(x&&ys.protocols.indexOf(x)===-1){s(new je("Unsupported protocol "+x+":",je.ERR_BAD_REQUEST,t));return}g.send(i||null)})},F9=(t,e)=>{const{length:n}=t=t?t.filter(Boolean):[];if(e||n){let s=new AbortController,r;const i=function(c){if(!r){r=!0,a();const u=c instanceof Error?c:this.reason;s.abort(u instanceof je?u:new Wd(u instanceof Error?u.message:u))}};let o=e&&setTimeout(()=>{o=null,i(new je(`timeout ${e} of ms exceeded`,je.ETIMEDOUT))},e);const a=()=>{t&&(o&&clearTimeout(o),o=null,t.forEach(c=>{c.unsubscribe?c.unsubscribe(i):c.removeEventListener("abort",i)}),t=null)};t.forEach(c=>c.addEventListener("abort",i));const{signal:l}=s;return l.unsubscribe=()=>J.asap(a),l}},_9=F9,z9=function*(t,e){let n=t.byteLength;if(!e||n<e){yield t;return}let s=0,r;for(;s<n;)r=s+e,yield t.slice(s,r),s=r},B9=async function*(t,e){for await(const n of j9(t))yield*z9(n,e)},j9=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const e=t.getReader();try{for(;;){const{done:n,value:s}=await e.read();if(n)break;yield s}}finally{await e.cancel()}},Y$=(t,e,n,s)=>{const r=B9(t,e);let i=0,o,a=l=>{o||(o=!0,s&&s(l))};return new ReadableStream({async pull(l){try{const{done:c,value:u}=await r.next();if(c){a(),l.close();return}let d=u.byteLength;if(n){let h=i+=d;n(h)}l.enqueue(new Uint8Array(u))}catch(c){throw a(c),c}},cancel(l){return a(l),r.return()}},{highWaterMark:2})},Q$=64*1024,{isFunction:wg}=J,V9=(({Request:t,Response:e})=>({Request:t,Response:e}))(J.global),{ReadableStream:Z$,TextEncoder:eR}=J.global,tR=(t,...e)=>{try{return!!t(...e)}catch{return!1}},U9=t=>{t=J.merge.call({skipUndefined:!0},V9,t);const{fetch:e,Request:n,Response:s}=t,r=e?wg(e):typeof fetch=="function",i=wg(n),o=wg(s);if(!r)return!1;const a=r&&wg(Z$),l=r&&(typeof eR=="function"?(p=>m=>p.encode(m))(new eR):async p=>new Uint8Array(await new n(p).arrayBuffer())),c=i&&a&&tR(()=>{let p=!1;const m=new n(ys.origin,{body:new Z$,method:"POST",get duplex(){return p=!0,"half"}}).headers.has("Content-Type");return p&&!m}),u=o&&a&&tR(()=>J.isReadableStream(new s("").body)),d={stream:u&&(p=>p.body)};r&&["text","arrayBuffer","blob","formData","stream"].forEach(p=>{!d[p]&&(d[p]=(m,g)=>{let y=m&&m[p];if(y)return y.call(m);throw new je(`Response type '${p}' is not supported`,je.ERR_NOT_SUPPORT,g)})});const h=async p=>{if(p==null)return 0;if(J.isBlob(p))return p.size;if(J.isSpecCompliantForm(p))return(await new n(ys.origin,{method:"POST",body:p}).arrayBuffer()).byteLength;if(J.isArrayBufferView(p)||J.isArrayBuffer(p))return p.byteLength;if(J.isURLSearchParams(p)&&(p=p+""),J.isString(p))return(await l(p)).byteLength},f=async(p,m)=>{const g=J.toFiniteNumber(p.getContentLength());return g??h(m)};return async p=>{let{url:m,method:g,data:y,signal:x,cancelToken:v,timeout:w,onDownloadProgress:S,onUploadProgress:k,responseType:C,headers:N,withCredentials:T="same-origin",fetchOptions:I}=z_(p),D=e||fetch;C=C?(C+"").toLowerCase():"text";let F=_9([x,v&&v.toAbortSignal()],w),A=null;const O=F&&F.unsubscribe&&(()=>{F.unsubscribe()});let P;try{if(k&&c&&g!=="get"&&g!=="head"&&(P=await f(N,y))!==0){let j=new n(m,{method:"POST",body:y,duplex:"half"}),ee;if(J.isFormData(y)&&(ee=j.headers.get("content-type"))&&N.setContentType(ee),j.body){const[Z,re]=q$(P,c0(X$(k)));y=Y$(j.body,Q$,Z,re)}}J.isString(T)||(T=T?"include":"omit");const L=i&&"credentials"in n.prototype,G={...I,signal:F,method:g.toUpperCase(),headers:N.normalize().toJSON(),body:y,duplex:"half",credentials:L?T:void 0};A=i&&new n(m,G);let $=await(i?D(A,I):D(m,G));const U=u&&(C==="stream"||C==="response");if(u&&(S||U&&O)){const j={};["status","statusText","headers"].forEach(te=>{j[te]=$[te]});const ee=J.toFiniteNumber($.headers.get("content-length")),[Z,re]=S&&q$(ee,c0(X$(S),!0))||[];$=new s(Y$($.body,Q$,Z,()=>{re&&re(),O&&O()}),j)}C=C||"text";let K=await d[J.findKey(d,C)||"text"]($,p);return!U&&O&&O(),await new Promise((j,ee)=>{F_(j,ee,{data:K,headers:Ti.from($.headers),status:$.status,statusText:$.statusText,config:p,request:A})})}catch(L){throw O&&O(),L&&L.name==="TypeError"&&/Load failed|fetch/i.test(L.message)?Object.assign(new je("Network Error",je.ERR_NETWORK,p,A),{cause:L.cause||L}):je.from(L,L&&L.code,p,A)}}},W9=new Map,B_=t=>{let e=t&&t.env||{};const{fetch:n,Request:s,Response:r}=e,i=[s,r,n];let o=i.length,a=o,l,c,u=W9;for(;a--;)l=i[a],c=u.get(l),c===void 0&&u.set(l,c=a?new Map:U9(e)),u=c;return c};B_();const dT={http:i9,xhr:L9,fetch:{get:B_}};J.forEach(dT,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const nR=t=>`- ${t}`,H9=t=>J.isFunction(t)||t===null||t===!1;function G9(t,e){t=J.isArray(t)?t:[t];const{length:n}=t;let s,r;const i={};for(let o=0;o<n;o++){s=t[o];let a;if(r=s,!H9(s)&&(r=dT[(a=String(s)).toLowerCase()],r===void 0))throw new je(`Unknown adapter '${a}'`);if(r&&(J.isFunction(r)||(r=r.get(e))))break;i[a||"#"+o]=r}if(!r){const o=Object.entries(i).map(([l,c])=>`adapter ${l} `+(c===!1?"is not supported by the environment":"is not available in the build"));let a=n?o.length>1?`since :
`+o.map(nR).join(`
`):" "+nR(o[0]):"as no adapter specified";throw new je("There is no suitable adapter to dispatch the request "+a,"ERR_NOT_SUPPORT")}return r}const j_={getAdapter:G9,adapters:dT};function Y1(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Wd(null,t)}function sR(t){return Y1(t),t.headers=Ti.from(t.headers),t.data=J1.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),j_.getAdapter(t.adapter||uT.adapter,t)(t).then(function(s){return Y1(t),s.data=J1.call(t,t.transformResponse,s),s.headers=Ti.from(s.headers),s},function(s){return L_(s)||(Y1(t),s&&s.response&&(s.response.data=J1.call(t,t.transformResponse,s.response),s.response.headers=Ti.from(s.response.headers))),Promise.reject(s)})}const V_="1.13.2",ub={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{ub[t]=function(s){return typeof s===t||"a"+(e<1?"n ":" ")+t}});const rR={};ub.transitional=function(e,n,s){function r(i,o){return"[Axios v"+V_+"] Transitional option '"+i+"'"+o+(s?". "+s:"")}return(i,o,a)=>{if(e===!1)throw new je(r(o," has been removed"+(n?" in "+n:"")),je.ERR_DEPRECATED);return n&&!rR[o]&&(rR[o]=!0,console.warn(r(o," has been deprecated since v"+n+" and will be removed in the near future"))),e?e(i,o,a):!0}};ub.spelling=function(e){return(n,s)=>(console.warn(`${s} is likely a misspelling of ${e}`),!0)};function K9(t,e,n){if(typeof t!="object")throw new je("options must be an object",je.ERR_BAD_OPTION_VALUE);const s=Object.keys(t);let r=s.length;for(;r-- >0;){const i=s[r],o=e[i];if(o){const a=t[i],l=a===void 0||o(a,i,t);if(l!==!0)throw new je("option "+i+" must be "+l,je.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new je("Unknown option "+i,je.ERR_BAD_OPTION)}}const vy={assertOptions:K9,validators:ub},ji=vy.validators;class u0{constructor(e){this.defaults=e||{},this.interceptors={request:new G$,response:new G$}}async request(e,n){try{return await this._request(e,n)}catch(s){if(s instanceof Error){let r={};Error.captureStackTrace?Error.captureStackTrace(r):r=new Error;const i=r.stack?r.stack.replace(/^.+\n/,""):"";try{s.stack?i&&!String(s.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+i):s.stack=i}catch{}}throw s}}_request(e,n){typeof e=="string"?(n=n||{},n.url=e):n=e||{},n=kc(this.defaults,n);const{transitional:s,paramsSerializer:r,headers:i}=n;s!==void 0&&vy.assertOptions(s,{silentJSONParsing:ji.transitional(ji.boolean),forcedJSONParsing:ji.transitional(ji.boolean),clarifyTimeoutError:ji.transitional(ji.boolean)},!1),r!=null&&(J.isFunction(r)?n.paramsSerializer={serialize:r}:vy.assertOptions(r,{encode:ji.function,serialize:ji.function},!0)),n.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?n.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:n.allowAbsoluteUrls=!0),vy.assertOptions(n,{baseUrl:ji.spelling("baseURL"),withXsrfToken:ji.spelling("withXSRFToken")},!0),n.method=(n.method||this.defaults.method||"get").toLowerCase();let o=i&&J.merge(i.common,i[n.method]);i&&J.forEach(["delete","get","head","post","put","patch","common"],p=>{delete i[p]}),n.headers=Ti.concat(o,i);const a=[];let l=!0;this.interceptors.request.forEach(function(m){typeof m.runWhen=="function"&&m.runWhen(n)===!1||(l=l&&m.synchronous,a.unshift(m.fulfilled,m.rejected))});const c=[];this.interceptors.response.forEach(function(m){c.push(m.fulfilled,m.rejected)});let u,d=0,h;if(!l){const p=[sR.bind(this),void 0];for(p.unshift(...a),p.push(...c),h=p.length,u=Promise.resolve(n);d<h;)u=u.then(p[d++],p[d++]);return u}h=a.length;let f=n;for(;d<h;){const p=a[d++],m=a[d++];try{f=p(f)}catch(g){m.call(this,g);break}}try{u=sR.call(this,f)}catch(p){return Promise.reject(p)}for(d=0,h=c.length;d<h;)u=u.then(c[d++],c[d++]);return u}getUri(e){e=kc(this.defaults,e);const n=__(e.baseURL,e.url,e.allowAbsoluteUrls);return O_(n,e.params,e.paramsSerializer)}}J.forEach(["delete","get","head","options"],function(e){u0.prototype[e]=function(n,s){return this.request(kc(s||{},{method:e,url:n,data:(s||{}).data}))}});J.forEach(["post","put","patch"],function(e){function n(s){return function(i,o,a){return this.request(kc(a||{},{method:e,headers:s?{"Content-Type":"multipart/form-data"}:{},url:i,data:o}))}}u0.prototype[e]=n(),u0.prototype[e+"Form"]=n(!0)});const wy=u0;class hT{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(i){n=i});const s=this;this.promise.then(r=>{if(!s._listeners)return;let i=s._listeners.length;for(;i-- >0;)s._listeners[i](r);s._listeners=null}),this.promise.then=r=>{let i;const o=new Promise(a=>{s.subscribe(a),i=a}).then(r);return o.cancel=function(){s.unsubscribe(i)},o},e(function(i,o,a){s.reason||(s.reason=new Wd(i,o,a),n(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const n=this._listeners.indexOf(e);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const e=new AbortController,n=s=>{e.abort(s)};return this.subscribe(n),e.signal.unsubscribe=()=>this.unsubscribe(n),e.signal}static source(){let e;return{token:new hT(function(r){e=r}),cancel:e}}}const q9=hT;function X9(t){return function(n){return t.apply(null,n)}}function J9(t){return J.isObject(t)&&t.isAxiosError===!0}const dk={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(dk).forEach(([t,e])=>{dk[e]=t});const Y9=dk;function U_(t){const e=new wy(t),n=w_(wy.prototype.request,e);return J.extend(n,wy.prototype,e,{allOwnKeys:!0}),J.extend(n,e,null,{allOwnKeys:!0}),n.create=function(r){return U_(kc(t,r))},n}const Sn=U_(uT);Sn.Axios=wy;Sn.CanceledError=Wd;Sn.CancelToken=q9;Sn.isCancel=L_;Sn.VERSION=V_;Sn.toFormData=lb;Sn.AxiosError=je;Sn.Cancel=Sn.CanceledError;Sn.all=function(e){return Promise.all(e)};Sn.spread=X9;Sn.isAxiosError=J9;Sn.mergeConfig=kc;Sn.AxiosHeaders=Ti;Sn.formToJSON=t=>P_(J.isHTMLForm(t)?new FormData(t):t);Sn.getAdapter=j_.getAdapter;Sn.HttpStatusCode=Y9;Sn.default=Sn;const Q9=Sn,Z9={}.VITE_API_URL||"http://localhost:3001",Fn=Q9.create({baseURL:`${Z9}`,headers:{"Content-Type":"application/json"}});Fn.interceptors.request.use(t=>{const e=_t.getState().accessToken;return e&&(t.headers.Authorization=`Bearer ${e}`),t},t=>Promise.reject(t));Fn.interceptors.response.use(t=>t,t=>{var e;return((e=t.response)==null?void 0:e.status)===401&&_t.getState().clearAuth(),Promise.reject(t)});const ed={login:t=>Fn.post("/auth/login",t).then(e=>e.data),signup:t=>Fn.post("/auth/signup",t).then(e=>e.data),getProfile:()=>Fn.get("/auth/me").then(t=>t.data),getVisibleProfile:t=>Fn.get(`/auth/profile/${t}`).then(e=>e.data),updateProfile:t=>Fn.put("/auth/profile",t).then(e=>e.data)},_t=wo()(v_((t,e)=>({user:null,accessToken:null,isLoading:!1,isAuthenticated:!1,ui:{sidebarOpen:!1,currentView:"chat",animationEnabled:!0,showSignup:!1},setStatus:n=>{const{user:s}=e();s&&n&&(console.log("AuthStore: Setting status to",n),t({user:{...s,status:n}}),bs(()=>Promise.resolve().then(()=>Bte),void 0).then(({socketService:r})=>{console.log("AuthStore: Calling socketService.updateStatus"),r.updateStatus(n)}).catch(r=>console.error("AuthStore: Failed to import socketService",r)))},login:async(n,s)=>{t({isLoading:!0});try{const r=await ed.login({email:n,password:s});t({user:r.user,accessToken:r.accessToken,isAuthenticated:!0,isLoading:!1})}catch(r){throw t({isLoading:!1}),r}},signup:async(n,s,r,i,o)=>{t({isLoading:!0});try{const a=await ed.signup({email:n,username:s,password:r,birthDate:i,gender:o});t({user:a.user,accessToken:a.accessToken,isAuthenticated:!0,isLoading:!1})}catch(a){throw t({isLoading:!1}),a}},logout:()=>{t(n=>({user:null,accessToken:null,isAuthenticated:!1,ui:{...n.ui,showSignup:!1}}))},getProfile:async()=>{t({isLoading:!0});try{const n=await ed.getProfile();t({user:n,isLoading:!1})}catch(n){throw t({isLoading:!1}),e().clearAuth(),n}},updateUser:n=>{t(s=>({user:s.user?{...s.user,...n}:null}))},clearAuth:()=>{t(n=>({user:null,accessToken:null,isAuthenticated:!1,ui:{...n.ui,showSignup:!1}}))},toggleSidebar:()=>t(n=>({ui:{...n.ui,sidebarOpen:!n.ui.sidebarOpen}})),setCurrentView:n=>t(s=>({ui:{...s.ui,currentView:n}})),setShowSignup:n=>t(s=>({ui:{...s.ui,showSignup:n}}))}),{name:"auth-storage",partialize:t=>({accessToken:t.accessToken,user:t.user})})),e7=()=>{const[t,e]=z.useState(""),[n,s]=z.useState(""),[r,i]=z.useState(!1),[o,a]=z.useState(""),{login:l,isLoading:c}=_t(),u=async d=>{var h,f;d.preventDefault(),a("");try{await l(t,n)}catch(p){a(((f=(h=p.response)==null?void 0:h.data)==null?void 0:f.message)||"chec de la connexion")}};return b.jsxs("div",{className:"min-h-screen flex",children:[b.jsxs("div",{className:"hidden lg:flex lg:flex-1 bg-gradient-to-br from-primary-600 via-primary-500 to-accent-400 relative overflow-hidden",children:[b.jsx("div",{className:"absolute inset-0 bg-black/10"}),b.jsxs("div",{className:"relative z-10 flex flex-col justify-center px-12 text-white",children:[b.jsxs("h1",{className:"text-5xl font-bold mb-6",children:["Connectez-vous",b.jsx("br",{}),b.jsx("span",{className:"text-primary-100",children:"librement"})]}),b.jsx("p",{className:"text-xl text-primary-100 opacity-90",children:"Chattez en peer-to-peer avec une scurit maximale et une interface fluide."}),b.jsxs("div",{className:"mt-12 flex space-x-4",children:[b.jsx("div",{className:"w-4 h-4 bg-white rounded-full animate-bounce"}),b.jsx("div",{className:"w-4 h-4 bg-white rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),b.jsx("div",{className:"w-4 h-4 bg-white rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})]})]}),b.jsx("div",{className:"flex-1 flex flex-col justify-center py-12 px-4 sm:px-6 lg:px-20 xl:px-24",children:b.jsxs("div",{className:"mx-auto w-full max-w-md",children:[b.jsxs("div",{className:"text-center lg:text-left",children:[b.jsx("div",{className:"lg:hidden flex justify-center mb-8",children:b.jsx("div",{className:"w-16 h-16 bg-gradient-to-r from-primary-500 to-accent-400 rounded-2xl flex items-center justify-center shadow-lg",children:b.jsx("span",{className:"text-white font-bold text-2xl",children:"P"})})}),b.jsx("h2",{className:"text-3xl font-bold text-gray-900",children:"Content de vous revoir"}),b.jsx("p",{className:"mt-3 text-gray-600",children:"Connectez-vous  votre compte Palfrog"})]}),b.jsxs("form",{className:"mt-8 space-y-6",onSubmit:u,children:[o&&b.jsx("div",{className:"rounded-xl bg-red-50 border border-red-200 p-4 animate-shake",children:b.jsxs("div",{className:"flex items-center space-x-2 text-red-700",children:[b.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:b.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),b.jsx("span",{className:"text-sm font-medium",children:o})]})}),b.jsxs("div",{className:"space-y-4",children:[b.jsxs("div",{children:[b.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),b.jsxs("div",{className:"relative",children:[b.jsx("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,className:"block w-full px-4 py-3 bg-white border border-gray-300 rounded-2xl placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all duration-200",placeholder:"votre@email.com",value:t,onChange:d=>e(d.target.value)}),b.jsx("div",{className:"absolute right-3 top-3 text-gray-400",children:""})]})]}),b.jsxs("div",{children:[b.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-2",children:"Mot de passe"}),b.jsxs("div",{className:"relative",children:[b.jsx("input",{id:"password",name:"password",type:r?"text":"password",autoComplete:"current-password",required:!0,className:"block w-full px-4 py-3 bg-white border border-gray-300 rounded-2xl placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all duration-200 pr-10",placeholder:"Votre mot de passe",value:n,onChange:d=>s(d.target.value)}),b.jsx("button",{type:"button",onClick:()=>i(!r),className:"absolute right-3 top-3 text-gray-400 hover:text-gray-600 transition-colors focus:outline-none",title:r?"Masquer le mot de passe":"Afficher le mot de passe",children:r?"":""})]})]})]}),b.jsx("div",{children:b.jsx("button",{type:"submit",disabled:c,className:"group relative w-full flex justify-center items-center py-3 px-4 border border-transparent text-base font-medium rounded-2xl text-white bg-gradient-to-r from-primary-500 to-accent-400 hover:from-primary-600 hover:to-accent-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed transform hover:scale-[1.02] active:scale-[0.98] transition-all duration-200 shadow-lg hover:shadow-xl",children:c?b.jsxs("span",{className:"flex items-center",children:[b.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[b.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),b.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Connexion..."]}):"Se connecter"})}),b.jsx("div",{className:"text-center",children:b.jsx("a",{href:"#",className:"text-primary-600 hover:text-primary-500 text-sm font-medium transition-colors duration-200",children:"Mot de passe oubli ?"})})]})]})})]})},t7=()=>{const[t,e]=z.useState({email:"",username:"",password:"",confirmPassword:"",birthDate:"",gender:"",customGender:""}),[n,s]=z.useState(""),[r,i]=z.useState(!1),[o,a]=z.useState(!1),{signup:l,isLoading:c}=_t(),u=f=>{e(p=>({...p,[f.target.name]:f.target.value}))},d=f=>{const p=new Date,m=new Date(f);let g=p.getFullYear()-m.getFullYear();const y=p.getMonth()-m.getMonth();return(y<0||y===0&&p.getDate()<m.getDate())&&g--,g>=13},h=async f=>{var m,g;if(f.preventDefault(),s(""),t.password!==t.confirmPassword){s("Passwords do not match");return}if(!d(t.birthDate)){s("You must be at least 13 years old to register.");return}const p=t.gender==="Autre"?t.customGender:t.gender;try{await l(t.email,t.username,t.password,t.birthDate,p)}catch(y){s(((g=(m=y.response)==null?void 0:m.data)==null?void 0:g.message)||"Signup failed")}};return b.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:b.jsxs("div",{className:"max-w-md w-full space-y-8",children:[b.jsxs("div",{children:[b.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Create your account"}),b.jsx("p",{className:"mt-2 text-center text-sm text-gray-600",children:"Join Palfrog secure chat"})]}),b.jsxs("form",{className:"mt-8 space-y-6",onSubmit:h,children:[n&&b.jsx("div",{className:"rounded-md bg-red-50 p-4",children:b.jsx("div",{className:"text-sm text-red-700",children:n})}),b.jsxs("div",{className:"space-y-4",children:[b.jsxs("div",{children:[b.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email"}),b.jsx("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,className:"mt-1 appearance-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"Enter your email",value:t.email,onChange:u})]}),b.jsxs("div",{children:[b.jsx("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700",children:"Username"}),b.jsx("input",{id:"username",name:"username",type:"text",autoComplete:"username",required:!0,className:"mt-1 appearance-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"Choose a username",value:t.username,onChange:u})]}),b.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[b.jsxs("div",{children:[b.jsx("label",{htmlFor:"birthDate",className:"block text-sm font-medium text-gray-700",children:"Date de naissance"}),b.jsx("input",{id:"birthDate",name:"birthDate",type:"date",required:!0,className:"mt-1 appearance-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",value:t.birthDate,onChange:u})]}),b.jsxs("div",{children:[b.jsx("label",{htmlFor:"gender",className:"block text-sm font-medium text-gray-700",children:"Genre"}),b.jsxs("select",{id:"gender",name:"gender",required:!0,className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md",value:t.gender,onChange:u,children:[b.jsx("option",{value:"",children:"Slectionner"}),b.jsx("option",{value:"Homme",children:"Homme"}),b.jsx("option",{value:"Femme",children:"Femme"}),b.jsx("option",{value:"Non-binaire",children:"Non-binaire"}),b.jsx("option",{value:"Prfre ne pas dire",children:"Prfre ne pas dire"}),b.jsx("option",{value:"Autre",children:"Autre"})]})]})]}),t.gender==="Autre"&&b.jsxs("div",{children:[b.jsx("label",{htmlFor:"customGender",className:"block text-sm font-medium text-gray-700",children:"Prcisez votre genre"}),b.jsx("input",{id:"customGender",name:"customGender",type:"text",required:!0,className:"mt-1 appearance-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"Votre genre",value:t.customGender,onChange:u})]}),b.jsxs("div",{children:[b.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Password"}),b.jsxs("div",{className:"relative mt-1",children:[b.jsx("input",{id:"password",name:"password",type:r?"text":"password",autoComplete:"new-password",required:!0,className:"appearance-none block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm pr-10",placeholder:"Create a password",value:t.password,onChange:u}),b.jsx("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600 focus:outline-none",onClick:()=>i(!r),children:r?b.jsx("span",{role:"img","aria-label":"hide password",children:""}):b.jsx("span",{role:"img","aria-label":"show password",children:""})})]}),b.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Must contain uppercase, lowercase, number and special character"})]}),b.jsxs("div",{children:[b.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700",children:"Confirm Password"}),b.jsxs("div",{className:"relative mt-1",children:[b.jsx("input",{id:"confirmPassword",name:"confirmPassword",type:o?"text":"password",autoComplete:"new-password",required:!0,className:"appearance-none block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm pr-10",placeholder:"Confirm your password",value:t.confirmPassword,onChange:u}),b.jsx("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600 focus:outline-none",onClick:()=>a(!o),children:o?b.jsx("span",{role:"img","aria-label":"hide password",children:""}):b.jsx("span",{role:"img","aria-label":"show password",children:""})})]})]})]}),b.jsx("div",{children:b.jsx("button",{type:"submit",disabled:c,className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed",children:c?"Creating account...":"Create account"})})]})]})})};function n7(){if(console&&console.warn){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];typeof e[0]=="string"&&(e[0]=`react-i18next:: ${e[0]}`),console.warn(...e)}}const iR={};function hk(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];typeof e[0]=="string"&&iR[e[0]]||(typeof e[0]=="string"&&(iR[e[0]]=new Date),n7(...e))}const W_=(t,e)=>()=>{if(t.isInitialized)e();else{const n=()=>{setTimeout(()=>{t.off("initialized",n)},0),e()};t.on("initialized",n)}};function oR(t,e,n){t.loadNamespaces(e,W_(t,n))}function aR(t,e,n,s){typeof n=="string"&&(n=[n]),n.forEach(r=>{t.options.ns.indexOf(r)<0&&t.options.ns.push(r)}),t.loadLanguages(e,W_(t,s))}function s7(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=e.languages[0],r=e.options?e.options.fallbackLng:!1,i=e.languages[e.languages.length-1];if(s.toLowerCase()==="cimode")return!0;const o=(a,l)=>{const c=e.services.backendConnector.state[`${a}|${l}`];return c===-1||c===2};return n.bindI18n&&n.bindI18n.indexOf("languageChanging")>-1&&e.services.backendConnector.backend&&e.isLanguageChangingTo&&!o(e.isLanguageChangingTo,t)?!1:!!(e.hasResourceBundle(s,t)||!e.services.backendConnector.backend||e.options.resources&&!e.options.partialBundledLanguages||o(s,t)&&(!r||o(i,t)))}function r7(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return!e.languages||!e.languages.length?(hk("i18n.languages were undefined or empty",e.languages),!0):e.options.ignoreJSONStructure!==void 0?e.hasLoadedNamespace(t,{lng:n.lng,precheck:(r,i)=>{if(n.bindI18n&&n.bindI18n.indexOf("languageChanging")>-1&&r.services.backendConnector.backend&&r.isLanguageChangingTo&&!i(r.isLanguageChangingTo,t))return!1}}):s7(t,e,n)}const i7=/&(?:amp|#38|lt|#60|gt|#62|apos|#39|quot|#34|nbsp|#160|copy|#169|reg|#174|hellip|#8230|#x2F|#47);/g,o7={"&amp;":"&","&#38;":"&","&lt;":"<","&#60;":"<","&gt;":">","&#62;":">","&apos;":"'","&#39;":"'","&quot;":'"',"&#34;":'"',"&nbsp;":" ","&#160;":" ","&copy;":"","&#169;":"","&reg;":"","&#174;":"","&hellip;":"","&#8230;":"","&#x2F;":"/","&#47;":"/"},a7=t=>o7[t],l7=t=>t.replace(i7,a7);let fk={bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transSupportBasicHtmlNodes:!0,transWrapTextNodes:"",transKeepBasicHtmlNodesFor:["br","strong","i","p"],useSuspense:!0,unescape:l7};function c7(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};fk={...fk,...t}}function u7(){return fk}let H_;function d7(t){H_=t}function h7(){return H_}const f7={type:"3rdParty",init(t){c7(t.options.react),d7(t)}},p7=z.createContext();class m7{constructor(){this.usedNamespaces={}}addUsedNamespaces(e){e.forEach(n=>{this.usedNamespaces[n]||(this.usedNamespaces[n]=!0)})}getUsedNamespaces(){return Object.keys(this.usedNamespaces)}}const g7=(t,e)=>{const n=z.useRef();return z.useEffect(()=>{n.current=e?n.current:t},[t,e]),n.current};function y7(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{i18n:n}=e,{i18n:s,defaultNS:r}=z.useContext(p7)||{},i=n||s||h7();if(i&&!i.reportNamespaces&&(i.reportNamespaces=new m7),!i){hk("You will need to pass in an i18next instance by using initReactI18next");const v=(S,k)=>typeof k=="string"?k:k&&typeof k=="object"&&typeof k.defaultValue=="string"?k.defaultValue:Array.isArray(S)?S[S.length-1]:S,w=[v,{},!1];return w.t=v,w.i18n={},w.ready=!1,w}i.options.react&&i.options.react.wait!==void 0&&hk("It seems you are still using the old wait option, you may migrate to the new useSuspense behaviour.");const o={...u7(),...i.options.react,...e},{useSuspense:a,keyPrefix:l}=o;let c=t||r||i.options&&i.options.defaultNS;c=typeof c=="string"?[c]:c||["translation"],i.reportNamespaces.addUsedNamespaces&&i.reportNamespaces.addUsedNamespaces(c);const u=(i.isInitialized||i.initializedStoreOnce)&&c.every(v=>r7(v,i,o));function d(){return i.getFixedT(e.lng||null,o.nsMode==="fallback"?c:c[0],l)}const[h,f]=z.useState(d);let p=c.join();e.lng&&(p=`${e.lng}${p}`);const m=g7(p),g=z.useRef(!0);z.useEffect(()=>{const{bindI18n:v,bindI18nStore:w}=o;g.current=!0,!u&&!a&&(e.lng?aR(i,e.lng,c,()=>{g.current&&f(d)}):oR(i,c,()=>{g.current&&f(d)})),u&&m&&m!==p&&g.current&&f(d);function S(){g.current&&f(d)}return v&&i&&i.on(v,S),w&&i&&i.store.on(w,S),()=>{g.current=!1,v&&i&&v.split(" ").forEach(k=>i.off(k,S)),w&&i&&w.split(" ").forEach(k=>i.store.off(k,S))}},[i,p]);const y=z.useRef(!0);z.useEffect(()=>{g.current&&!y.current&&f(d),y.current=!1},[i,l]);const x=[h,i,u];if(x.t=h,x.i18n=i,x.ready=u,u||!u&&!a)return x;throw new Promise(v=>{e.lng?aR(i,e.lng,c,()=>v()):oR(i,c,()=>v())})}const Pe=t=>typeof t=="string",bh=()=>{let t,e;const n=new Promise((s,r)=>{t=s,e=r});return n.resolve=t,n.reject=e,n},lR=t=>t==null?"":""+t,x7=(t,e,n)=>{t.forEach(s=>{e[s]&&(n[s]=e[s])})},b7=/###/g,cR=t=>t&&t.indexOf("###")>-1?t.replace(b7,"."):t,uR=t=>!t||Pe(t),cf=(t,e,n)=>{const s=Pe(e)?e.split("."):e;let r=0;for(;r<s.length-1;){if(uR(t))return{};const i=cR(s[r]);!t[i]&&n&&(t[i]=new n),Object.prototype.hasOwnProperty.call(t,i)?t=t[i]:t={},++r}return uR(t)?{}:{obj:t,k:cR(s[r])}},dR=(t,e,n)=>{const{obj:s,k:r}=cf(t,e,Object);if(s!==void 0||e.length===1){s[r]=n;return}let i=e[e.length-1],o=e.slice(0,e.length-1),a=cf(t,o,Object);for(;a.obj===void 0&&o.length;)i=`${o[o.length-1]}.${i}`,o=o.slice(0,o.length-1),a=cf(t,o,Object),a&&a.obj&&typeof a.obj[`${a.k}.${i}`]<"u"&&(a.obj=void 0);a.obj[`${a.k}.${i}`]=n},v7=(t,e,n,s)=>{const{obj:r,k:i}=cf(t,e,Object);r[i]=r[i]||[],r[i].push(n)},d0=(t,e)=>{const{obj:n,k:s}=cf(t,e);if(n)return n[s]},w7=(t,e,n)=>{const s=d0(t,n);return s!==void 0?s:d0(e,n)},G_=(t,e,n)=>{for(const s in e)s!=="__proto__"&&s!=="constructor"&&(s in t?Pe(t[s])||t[s]instanceof String||Pe(e[s])||e[s]instanceof String?n&&(t[s]=e[s]):G_(t[s],e[s],n):t[s]=e[s]);return t},fu=t=>t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");var S7={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};const k7=t=>Pe(t)?t.replace(/[&<>"'\/]/g,e=>S7[e]):t;class C7{constructor(e){this.capacity=e,this.regExpMap=new Map,this.regExpQueue=[]}getRegExp(e){const n=this.regExpMap.get(e);if(n!==void 0)return n;const s=new RegExp(e);return this.regExpQueue.length===this.capacity&&this.regExpMap.delete(this.regExpQueue.shift()),this.regExpMap.set(e,s),this.regExpQueue.push(e),s}}const N7=[" ",",","?","!",";"],T7=new C7(20),E7=(t,e,n)=>{e=e||"",n=n||"";const s=N7.filter(o=>e.indexOf(o)<0&&n.indexOf(o)<0);if(s.length===0)return!0;const r=T7.getRegExp(`(${s.map(o=>o==="?"?"\\?":o).join("|")})`);let i=!r.test(t);if(!i){const o=t.indexOf(n);o>0&&!r.test(t.substring(0,o))&&(i=!0)}return i},pk=function(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:".";if(!t)return;if(t[e])return t[e];const s=e.split(n);let r=t;for(let i=0;i<s.length;){if(!r||typeof r!="object")return;let o,a="";for(let l=i;l<s.length;++l)if(l!==i&&(a+=n),a+=s[l],o=r[a],o!==void 0){if(["string","number","boolean"].indexOf(typeof o)>-1&&l<s.length-1)continue;i+=l-i+1;break}r=o}return r},h0=t=>t&&t.replace("_","-"),I7={type:"logger",log(t){this.output("log",t)},warn(t){this.output("warn",t)},error(t){this.output("error",t)},output(t,e){console&&console[t]&&console[t].apply(console,e)}};let A7=class mk{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.init(e,n)}init(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.prefix=n.prefix||"i18next:",this.logger=e||I7,this.options=n,this.debug=n.debug}log(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return this.forward(n,"log","",!0)}warn(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return this.forward(n,"warn","",!0)}error(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return this.forward(n,"error","")}deprecate(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return this.forward(n,"warn","WARNING DEPRECATED: ",!0)}forward(e,n,s,r){return r&&!this.debug?null:(Pe(e[0])&&(e[0]=`${s}${this.prefix} ${e[0]}`),this.logger[n](e))}create(e){return new mk(this.logger,{prefix:`${this.prefix}:${e}:`,...this.options})}clone(e){return e=e||this.options,e.prefix=e.prefix||this.prefix,new mk(this.logger,e)}};var Zi=new A7;let db=class{constructor(){this.observers={}}on(e,n){return e.split(" ").forEach(s=>{this.observers[s]||(this.observers[s]=new Map);const r=this.observers[s].get(n)||0;this.observers[s].set(n,r+1)}),this}off(e,n){if(this.observers[e]){if(!n){delete this.observers[e];return}this.observers[e].delete(n)}}emit(e){for(var n=arguments.length,s=new Array(n>1?n-1:0),r=1;r<n;r++)s[r-1]=arguments[r];this.observers[e]&&Array.from(this.observers[e].entries()).forEach(o=>{let[a,l]=o;for(let c=0;c<l;c++)a(...s)}),this.observers["*"]&&Array.from(this.observers["*"].entries()).forEach(o=>{let[a,l]=o;for(let c=0;c<l;c++)a.apply(a,[e,...s])})}};class hR extends db{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{ns:["translation"],defaultNS:"translation"};super(),this.data=e||{},this.options=n,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.options.ignoreJSONStructure===void 0&&(this.options.ignoreJSONStructure=!0)}addNamespaces(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}removeNamespaces(e){const n=this.options.ns.indexOf(e);n>-1&&this.options.ns.splice(n,1)}getResource(e,n,s){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const i=r.keySeparator!==void 0?r.keySeparator:this.options.keySeparator,o=r.ignoreJSONStructure!==void 0?r.ignoreJSONStructure:this.options.ignoreJSONStructure;let a;e.indexOf(".")>-1?a=e.split("."):(a=[e,n],s&&(Array.isArray(s)?a.push(...s):Pe(s)&&i?a.push(...s.split(i)):a.push(s)));const l=d0(this.data,a);return!l&&!n&&!s&&e.indexOf(".")>-1&&(e=a[0],n=a[1],s=a.slice(2).join(".")),l||!o||!Pe(s)?l:pk(this.data&&this.data[e]&&this.data[e][n],s,i)}addResource(e,n,s,r){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{silent:!1};const o=i.keySeparator!==void 0?i.keySeparator:this.options.keySeparator;let a=[e,n];s&&(a=a.concat(o?s.split(o):s)),e.indexOf(".")>-1&&(a=e.split("."),r=n,n=a[1]),this.addNamespaces(n),dR(this.data,a,r),i.silent||this.emit("added",e,n,s,r)}addResources(e,n,s){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{silent:!1};for(const i in s)(Pe(s[i])||Array.isArray(s[i]))&&this.addResource(e,n,i,s[i],{silent:!0});r.silent||this.emit("added",e,n,s)}addResourceBundle(e,n,s,r,i){let o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{silent:!1,skipCopy:!1},a=[e,n];e.indexOf(".")>-1&&(a=e.split("."),r=s,s=n,n=a[1]),this.addNamespaces(n);let l=d0(this.data,a)||{};o.skipCopy||(s=JSON.parse(JSON.stringify(s))),r?G_(l,s,i):l={...l,...s},dR(this.data,a,l),o.silent||this.emit("added",e,n,s)}removeResourceBundle(e,n){this.hasResourceBundle(e,n)&&delete this.data[e][n],this.removeNamespaces(n),this.emit("removed",e,n)}hasResourceBundle(e,n){return this.getResource(e,n)!==void 0}getResourceBundle(e,n){return n||(n=this.options.defaultNS),this.options.compatibilityAPI==="v1"?{...this.getResource(e,n)}:this.getResource(e,n)}getDataByLanguage(e){return this.data[e]}hasLanguageSomeTranslations(e){const n=this.getDataByLanguage(e);return!!(n&&Object.keys(n)||[]).find(r=>n[r]&&Object.keys(n[r]).length>0)}toJSON(){return this.data}}var K_={processors:{},addPostProcessor(t){this.processors[t.name]=t},handle(t,e,n,s,r){return t.forEach(i=>{this.processors[i]&&(e=this.processors[i].process(e,n,s,r))}),e}};const fR={};class f0 extends db{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),x7(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,this),this.options=n,this.options.keySeparator===void 0&&(this.options.keySeparator="."),this.logger=Zi.create("translator")}changeLanguage(e){e&&(this.language=e)}exists(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}};if(e==null)return!1;const s=this.resolve(e,n);return s&&s.res!==void 0}extractFromKey(e,n){let s=n.nsSeparator!==void 0?n.nsSeparator:this.options.nsSeparator;s===void 0&&(s=":");const r=n.keySeparator!==void 0?n.keySeparator:this.options.keySeparator;let i=n.ns||this.options.defaultNS||[];const o=s&&e.indexOf(s)>-1,a=!this.options.userDefinedKeySeparator&&!n.keySeparator&&!this.options.userDefinedNsSeparator&&!n.nsSeparator&&!E7(e,s,r);if(o&&!a){const l=e.match(this.interpolator.nestingRegexp);if(l&&l.length>0)return{key:e,namespaces:Pe(i)?[i]:i};const c=e.split(s);(s!==r||s===r&&this.options.ns.indexOf(c[0])>-1)&&(i=c.shift()),e=c.join(r)}return{key:e,namespaces:Pe(i)?[i]:i}}translate(e,n,s){if(typeof n!="object"&&this.options.overloadTranslationOptionHandler&&(n=this.options.overloadTranslationOptionHandler(arguments)),typeof n=="object"&&(n={...n}),n||(n={}),e==null)return"";Array.isArray(e)||(e=[String(e)]);const r=n.returnDetails!==void 0?n.returnDetails:this.options.returnDetails,i=n.keySeparator!==void 0?n.keySeparator:this.options.keySeparator,{key:o,namespaces:a}=this.extractFromKey(e[e.length-1],n),l=a[a.length-1],c=n.lng||this.language,u=n.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(c&&c.toLowerCase()==="cimode"){if(u){const w=n.nsSeparator||this.options.nsSeparator;return r?{res:`${l}${w}${o}`,usedKey:o,exactUsedKey:o,usedLng:c,usedNS:l,usedParams:this.getUsedParamsDetails(n)}:`${l}${w}${o}`}return r?{res:o,usedKey:o,exactUsedKey:o,usedLng:c,usedNS:l,usedParams:this.getUsedParamsDetails(n)}:o}const d=this.resolve(e,n);let h=d&&d.res;const f=d&&d.usedKey||o,p=d&&d.exactUsedKey||o,m=Object.prototype.toString.apply(h),g=["[object Number]","[object Function]","[object RegExp]"],y=n.joinArrays!==void 0?n.joinArrays:this.options.joinArrays,x=!this.i18nFormat||this.i18nFormat.handleAsObject,v=!Pe(h)&&typeof h!="boolean"&&typeof h!="number";if(x&&h&&v&&g.indexOf(m)<0&&!(Pe(y)&&Array.isArray(h))){if(!n.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");const w=this.options.returnedObjectHandler?this.options.returnedObjectHandler(f,h,{...n,ns:a}):`key '${o} (${this.language})' returned an object instead of string.`;return r?(d.res=w,d.usedParams=this.getUsedParamsDetails(n),d):w}if(i){const w=Array.isArray(h),S=w?[]:{},k=w?p:f;for(const C in h)if(Object.prototype.hasOwnProperty.call(h,C)){const N=`${k}${i}${C}`;S[C]=this.translate(N,{...n,joinArrays:!1,ns:a}),S[C]===N&&(S[C]=h[C])}h=S}}else if(x&&Pe(y)&&Array.isArray(h))h=h.join(y),h&&(h=this.extendTranslation(h,e,n,s));else{let w=!1,S=!1;const k=n.count!==void 0&&!Pe(n.count),C=f0.hasDefaultValue(n),N=k?this.pluralResolver.getSuffix(c,n.count,n):"",T=n.ordinal&&k?this.pluralResolver.getSuffix(c,n.count,{ordinal:!1}):"",I=k&&!n.ordinal&&n.count===0&&this.pluralResolver.shouldUseIntlApi(),D=I&&n[`defaultValue${this.options.pluralSeparator}zero`]||n[`defaultValue${N}`]||n[`defaultValue${T}`]||n.defaultValue;!this.isValidLookup(h)&&C&&(w=!0,h=D),this.isValidLookup(h)||(S=!0,h=o);const A=(n.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&S?void 0:h,O=C&&D!==h&&this.options.updateMissing;if(S||w||O){if(this.logger.log(O?"updateKey":"missingKey",c,l,o,O?D:h),i){const $=this.resolve(o,{...n,keySeparator:!1});$&&$.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}let P=[];const L=this.languageUtils.getFallbackCodes(this.options.fallbackLng,n.lng||this.language);if(this.options.saveMissingTo==="fallback"&&L&&L[0])for(let $=0;$<L.length;$++)P.push(L[$]);else this.options.saveMissingTo==="all"?P=this.languageUtils.toResolveHierarchy(n.lng||this.language):P.push(n.lng||this.language);const G=($,U,K)=>{const j=C&&K!==h?K:A;this.options.missingKeyHandler?this.options.missingKeyHandler($,l,U,j,O,n):this.backendConnector&&this.backendConnector.saveMissing&&this.backendConnector.saveMissing($,l,U,j,O,n),this.emit("missingKey",$,l,U,h)};this.options.saveMissing&&(this.options.saveMissingPlurals&&k?P.forEach($=>{const U=this.pluralResolver.getSuffixes($,n);I&&n[`defaultValue${this.options.pluralSeparator}zero`]&&U.indexOf(`${this.options.pluralSeparator}zero`)<0&&U.push(`${this.options.pluralSeparator}zero`),U.forEach(K=>{G([$],o+K,n[`defaultValue${K}`]||D)})}):G(P,o,D))}h=this.extendTranslation(h,e,n,d,s),S&&h===o&&this.options.appendNamespaceToMissingKey&&(h=`${l}:${o}`),(S||w)&&this.options.parseMissingKeyHandler&&(this.options.compatibilityAPI!=="v1"?h=this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?`${l}:${o}`:o,w?h:void 0):h=this.options.parseMissingKeyHandler(h))}return r?(d.res=h,d.usedParams=this.getUsedParamsDetails(n),d):h}extendTranslation(e,n,s,r,i){var o=this;if(this.i18nFormat&&this.i18nFormat.parse)e=this.i18nFormat.parse(e,{...this.options.interpolation.defaultVariables,...s},s.lng||this.language||r.usedLng,r.usedNS,r.usedKey,{resolved:r});else if(!s.skipInterpolation){s.interpolation&&this.interpolator.init({...s,interpolation:{...this.options.interpolation,...s.interpolation}});const c=Pe(e)&&(s&&s.interpolation&&s.interpolation.skipOnVariables!==void 0?s.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);let u;if(c){const h=e.match(this.interpolator.nestingRegexp);u=h&&h.length}let d=s.replace&&!Pe(s.replace)?s.replace:s;if(this.options.interpolation.defaultVariables&&(d={...this.options.interpolation.defaultVariables,...d}),e=this.interpolator.interpolate(e,d,s.lng||this.language||r.usedLng,s),c){const h=e.match(this.interpolator.nestingRegexp),f=h&&h.length;u<f&&(s.nest=!1)}!s.lng&&this.options.compatibilityAPI!=="v1"&&r&&r.res&&(s.lng=this.language||r.usedLng),s.nest!==!1&&(e=this.interpolator.nest(e,function(){for(var h=arguments.length,f=new Array(h),p=0;p<h;p++)f[p]=arguments[p];return i&&i[0]===f[0]&&!s.context?(o.logger.warn(`It seems you are nesting recursively key: ${f[0]} in key: ${n[0]}`),null):o.translate(...f,n)},s)),s.interpolation&&this.interpolator.reset()}const a=s.postProcess||this.options.postProcess,l=Pe(a)?[a]:a;return e!=null&&l&&l.length&&s.applyPostProcessor!==!1&&(e=K_.handle(l,e,n,this.options&&this.options.postProcessPassResolved?{i18nResolved:{...r,usedParams:this.getUsedParamsDetails(s)},...s}:s,this)),e}resolve(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s,r,i,o,a;return Pe(e)&&(e=[e]),e.forEach(l=>{if(this.isValidLookup(s))return;const c=this.extractFromKey(l,n),u=c.key;r=u;let d=c.namespaces;this.options.fallbackNS&&(d=d.concat(this.options.fallbackNS));const h=n.count!==void 0&&!Pe(n.count),f=h&&!n.ordinal&&n.count===0&&this.pluralResolver.shouldUseIntlApi(),p=n.context!==void 0&&(Pe(n.context)||typeof n.context=="number")&&n.context!=="",m=n.lngs?n.lngs:this.languageUtils.toResolveHierarchy(n.lng||this.language,n.fallbackLng);d.forEach(g=>{this.isValidLookup(s)||(a=g,!fR[`${m[0]}-${g}`]&&this.utils&&this.utils.hasLoadedNamespace&&!this.utils.hasLoadedNamespace(a)&&(fR[`${m[0]}-${g}`]=!0,this.logger.warn(`key "${r}" for languages "${m.join(", ")}" won't get resolved as namespace "${a}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),m.forEach(y=>{if(this.isValidLookup(s))return;o=y;const x=[u];if(this.i18nFormat&&this.i18nFormat.addLookupKeys)this.i18nFormat.addLookupKeys(x,u,y,g,n);else{let w;h&&(w=this.pluralResolver.getSuffix(y,n.count,n));const S=`${this.options.pluralSeparator}zero`,k=`${this.options.pluralSeparator}ordinal${this.options.pluralSeparator}`;if(h&&(x.push(u+w),n.ordinal&&w.indexOf(k)===0&&x.push(u+w.replace(k,this.options.pluralSeparator)),f&&x.push(u+S)),p){const C=`${u}${this.options.contextSeparator}${n.context}`;x.push(C),h&&(x.push(C+w),n.ordinal&&w.indexOf(k)===0&&x.push(C+w.replace(k,this.options.pluralSeparator)),f&&x.push(C+S))}}let v;for(;v=x.pop();)this.isValidLookup(s)||(i=v,s=this.getResource(y,g,v,n))}))})}),{res:s,usedKey:r,exactUsedKey:i,usedLng:o,usedNS:a}}isValidLookup(e){return e!==void 0&&!(!this.options.returnNull&&e===null)&&!(!this.options.returnEmptyString&&e==="")}getResource(e,n,s){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return this.i18nFormat&&this.i18nFormat.getResource?this.i18nFormat.getResource(e,n,s,r):this.resourceStore.getResource(e,n,s,r)}getUsedParamsDetails(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=["defaultValue","ordinal","context","replace","lng","lngs","fallbackLng","ns","keySeparator","nsSeparator","returnObjects","returnDetails","joinArrays","postProcess","interpolation"],s=e.replace&&!Pe(e.replace);let r=s?e.replace:e;if(s&&typeof e.count<"u"&&(r.count=e.count),this.options.interpolation.defaultVariables&&(r={...this.options.interpolation.defaultVariables,...r}),!s){r={...r};for(const i of n)delete r[i]}return r}static hasDefaultValue(e){const n="defaultValue";for(const s in e)if(Object.prototype.hasOwnProperty.call(e,s)&&n===s.substring(0,n.length)&&e[s]!==void 0)return!0;return!1}}const Q1=t=>t.charAt(0).toUpperCase()+t.slice(1);class pR{constructor(e){this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=Zi.create("languageUtils")}getScriptPartFromCode(e){if(e=h0(e),!e||e.indexOf("-")<0)return null;const n=e.split("-");return n.length===2||(n.pop(),n[n.length-1].toLowerCase()==="x")?null:this.formatLanguageCode(n.join("-"))}getLanguagePartFromCode(e){if(e=h0(e),!e||e.indexOf("-")<0)return e;const n=e.split("-");return this.formatLanguageCode(n[0])}formatLanguageCode(e){if(Pe(e)&&e.indexOf("-")>-1){if(typeof Intl<"u"&&typeof Intl.getCanonicalLocales<"u")try{let r=Intl.getCanonicalLocales(e)[0];if(r&&this.options.lowerCaseLng&&(r=r.toLowerCase()),r)return r}catch{}const n=["hans","hant","latn","cyrl","cans","mong","arab"];let s=e.split("-");return this.options.lowerCaseLng?s=s.map(r=>r.toLowerCase()):s.length===2?(s[0]=s[0].toLowerCase(),s[1]=s[1].toUpperCase(),n.indexOf(s[1].toLowerCase())>-1&&(s[1]=Q1(s[1].toLowerCase()))):s.length===3&&(s[0]=s[0].toLowerCase(),s[1].length===2&&(s[1]=s[1].toUpperCase()),s[0]!=="sgn"&&s[2].length===2&&(s[2]=s[2].toUpperCase()),n.indexOf(s[1].toLowerCase())>-1&&(s[1]=Q1(s[1].toLowerCase())),n.indexOf(s[2].toLowerCase())>-1&&(s[2]=Q1(s[2].toLowerCase()))),s.join("-")}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}isSupportedCode(e){return(this.options.load==="languageOnly"||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}getBestMatchFromCodes(e){if(!e)return null;let n;return e.forEach(s=>{if(n)return;const r=this.formatLanguageCode(s);(!this.options.supportedLngs||this.isSupportedCode(r))&&(n=r)}),!n&&this.options.supportedLngs&&e.forEach(s=>{if(n)return;const r=this.getLanguagePartFromCode(s);if(this.isSupportedCode(r))return n=r;n=this.options.supportedLngs.find(i=>{if(i===r)return i;if(!(i.indexOf("-")<0&&r.indexOf("-")<0)&&(i.indexOf("-")>0&&r.indexOf("-")<0&&i.substring(0,i.indexOf("-"))===r||i.indexOf(r)===0&&r.length>1))return i})}),n||(n=this.getFallbackCodes(this.options.fallbackLng)[0]),n}getFallbackCodes(e,n){if(!e)return[];if(typeof e=="function"&&(e=e(n)),Pe(e)&&(e=[e]),Array.isArray(e))return e;if(!n)return e.default||[];let s=e[n];return s||(s=e[this.getScriptPartFromCode(n)]),s||(s=e[this.formatLanguageCode(n)]),s||(s=e[this.getLanguagePartFromCode(n)]),s||(s=e.default),s||[]}toResolveHierarchy(e,n){const s=this.getFallbackCodes(n||this.options.fallbackLng||[],e),r=[],i=o=>{o&&(this.isSupportedCode(o)?r.push(o):this.logger.warn(`rejecting language code not found in supportedLngs: ${o}`))};return Pe(e)&&(e.indexOf("-")>-1||e.indexOf("_")>-1)?(this.options.load!=="languageOnly"&&i(this.formatLanguageCode(e)),this.options.load!=="languageOnly"&&this.options.load!=="currentOnly"&&i(this.getScriptPartFromCode(e)),this.options.load!=="currentOnly"&&i(this.getLanguagePartFromCode(e))):Pe(e)&&i(this.formatLanguageCode(e)),s.forEach(o=>{r.indexOf(o)<0&&i(this.formatLanguageCode(o))}),r}}let $7=[{lngs:["ach","ak","am","arn","br","fil","gun","ln","mfe","mg","mi","oc","pt","pt-BR","tg","tl","ti","tr","uz","wa"],nr:[1,2],fc:1},{lngs:["af","an","ast","az","bg","bn","ca","da","de","dev","el","en","eo","es","et","eu","fi","fo","fur","fy","gl","gu","ha","hi","hu","hy","ia","it","kk","kn","ku","lb","mai","ml","mn","mr","nah","nap","nb","ne","nl","nn","no","nso","pa","pap","pms","ps","pt-PT","rm","sco","se","si","so","son","sq","sv","sw","ta","te","tk","ur","yo"],nr:[1,2],fc:2},{lngs:["ay","bo","cgg","fa","ht","id","ja","jbo","ka","km","ko","ky","lo","ms","sah","su","th","tt","ug","vi","wo","zh"],nr:[1],fc:3},{lngs:["be","bs","cnr","dz","hr","ru","sr","uk"],nr:[1,2,5],fc:4},{lngs:["ar"],nr:[0,1,2,3,11,100],fc:5},{lngs:["cs","sk"],nr:[1,2,5],fc:6},{lngs:["csb","pl"],nr:[1,2,5],fc:7},{lngs:["cy"],nr:[1,2,3,8],fc:8},{lngs:["fr"],nr:[1,2],fc:9},{lngs:["ga"],nr:[1,2,3,7,11],fc:10},{lngs:["gd"],nr:[1,2,3,20],fc:11},{lngs:["is"],nr:[1,2],fc:12},{lngs:["jv"],nr:[0,1],fc:13},{lngs:["kw"],nr:[1,2,3,4],fc:14},{lngs:["lt"],nr:[1,2,10],fc:15},{lngs:["lv"],nr:[1,2,0],fc:16},{lngs:["mk"],nr:[1,2],fc:17},{lngs:["mnk"],nr:[0,1,2],fc:18},{lngs:["mt"],nr:[1,2,11,20],fc:19},{lngs:["or"],nr:[2,1],fc:2},{lngs:["ro"],nr:[1,2,20],fc:20},{lngs:["sl"],nr:[5,1,2,3],fc:21},{lngs:["he","iw"],nr:[1,2,20,21],fc:22}],R7={1:t=>+(t>1),2:t=>+(t!=1),3:t=>0,4:t=>t%10==1&&t%100!=11?0:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?1:2,5:t=>t==0?0:t==1?1:t==2?2:t%100>=3&&t%100<=10?3:t%100>=11?4:5,6:t=>t==1?0:t>=2&&t<=4?1:2,7:t=>t==1?0:t%10>=2&&t%10<=4&&(t%100<10||t%100>=20)?1:2,8:t=>t==1?0:t==2?1:t!=8&&t!=11?2:3,9:t=>+(t>=2),10:t=>t==1?0:t==2?1:t<7?2:t<11?3:4,11:t=>t==1||t==11?0:t==2||t==12?1:t>2&&t<20?2:3,12:t=>+(t%10!=1||t%100==11),13:t=>+(t!==0),14:t=>t==1?0:t==2?1:t==3?2:3,15:t=>t%10==1&&t%100!=11?0:t%10>=2&&(t%100<10||t%100>=20)?1:2,16:t=>t%10==1&&t%100!=11?0:t!==0?1:2,17:t=>t==1||t%10==1&&t%100!=11?0:1,18:t=>t==0?0:t==1?1:2,19:t=>t==1?0:t==0||t%100>1&&t%100<11?1:t%100>10&&t%100<20?2:3,20:t=>t==1?0:t==0||t%100>0&&t%100<20?1:2,21:t=>t%100==1?1:t%100==2?2:t%100==3||t%100==4?3:0,22:t=>t==1?0:t==2?1:(t<0||t>10)&&t%10==0?2:3};const D7=["v1","v2","v3"],O7=["v4"],mR={zero:0,one:1,two:2,few:3,many:4,other:5},M7=()=>{const t={};return $7.forEach(e=>{e.lngs.forEach(n=>{t[n]={numbers:e.nr,plurals:R7[e.fc]}})}),t};class P7{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.languageUtils=e,this.options=n,this.logger=Zi.create("pluralResolver"),(!this.options.compatibilityJSON||O7.includes(this.options.compatibilityJSON))&&(typeof Intl>"u"||!Intl.PluralRules)&&(this.options.compatibilityJSON="v3",this.logger.error("Your environment seems not to be Intl API compatible, use an Intl.PluralRules polyfill. Will fallback to the compatibilityJSON v3 format handling.")),this.rules=M7(),this.pluralRulesCache={}}addRule(e,n){this.rules[e]=n}clearCache(){this.pluralRulesCache={}}getRule(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.shouldUseIntlApi()){const s=h0(e==="dev"?"en":e),r=n.ordinal?"ordinal":"cardinal",i=JSON.stringify({cleanedCode:s,type:r});if(i in this.pluralRulesCache)return this.pluralRulesCache[i];let o;try{o=new Intl.PluralRules(s,{type:r})}catch{if(!e.match(/-|_/))return;const l=this.languageUtils.getLanguagePartFromCode(e);o=this.getRule(l,n)}return this.pluralRulesCache[i]=o,o}return this.rules[e]||this.rules[this.languageUtils.getLanguagePartFromCode(e)]}needsPlural(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=this.getRule(e,n);return this.shouldUseIntlApi()?s&&s.resolvedOptions().pluralCategories.length>1:s&&s.numbers.length>1}getPluralFormsOfKey(e,n){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.getSuffixes(e,s).map(r=>`${n}${r}`)}getSuffixes(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s=this.getRule(e,n);return s?this.shouldUseIntlApi()?s.resolvedOptions().pluralCategories.sort((r,i)=>mR[r]-mR[i]).map(r=>`${this.options.prepend}${n.ordinal?`ordinal${this.options.prepend}`:""}${r}`):s.numbers.map(r=>this.getSuffix(e,r,n)):[]}getSuffix(e,n){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=this.getRule(e,s);return r?this.shouldUseIntlApi()?`${this.options.prepend}${s.ordinal?`ordinal${this.options.prepend}`:""}${r.select(n)}`:this.getSuffixRetroCompatible(r,n):(this.logger.warn(`no plural rule found for: ${e}`),"")}getSuffixRetroCompatible(e,n){const s=e.noAbs?e.plurals(n):e.plurals(Math.abs(n));let r=e.numbers[s];this.options.simplifyPluralSuffix&&e.numbers.length===2&&e.numbers[0]===1&&(r===2?r="plural":r===1&&(r=""));const i=()=>this.options.prepend&&r.toString()?this.options.prepend+r.toString():r.toString();return this.options.compatibilityJSON==="v1"?r===1?"":typeof r=="number"?`_plural_${r.toString()}`:i():this.options.compatibilityJSON==="v2"||this.options.simplifyPluralSuffix&&e.numbers.length===2&&e.numbers[0]===1?i():this.options.prepend&&s.toString()?this.options.prepend+s.toString():s.toString()}shouldUseIntlApi(){return!D7.includes(this.options.compatibilityJSON)}}const gR=function(t,e,n){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:".",r=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!0,i=w7(t,e,n);return!i&&r&&Pe(n)&&(i=pk(t,n,s),i===void 0&&(i=pk(e,n,s))),i},Z1=t=>t.replace(/\$/g,"$$$$");class L7{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=Zi.create("interpolator"),this.options=e,this.format=e.interpolation&&e.interpolation.format||(n=>n),this.init(e)}init(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});const{escape:n,escapeValue:s,useRawValueToEscape:r,prefix:i,prefixEscaped:o,suffix:a,suffixEscaped:l,formatSeparator:c,unescapeSuffix:u,unescapePrefix:d,nestingPrefix:h,nestingPrefixEscaped:f,nestingSuffix:p,nestingSuffixEscaped:m,nestingOptionsSeparator:g,maxReplaces:y,alwaysFormat:x}=e.interpolation;this.escape=n!==void 0?n:k7,this.escapeValue=s!==void 0?s:!0,this.useRawValueToEscape=r!==void 0?r:!1,this.prefix=i?fu(i):o||"{{",this.suffix=a?fu(a):l||"}}",this.formatSeparator=c||",",this.unescapePrefix=u?"":d||"-",this.unescapeSuffix=this.unescapePrefix?"":u||"",this.nestingPrefix=h?fu(h):f||fu("$t("),this.nestingSuffix=p?fu(p):m||fu(")"),this.nestingOptionsSeparator=g||",",this.maxReplaces=y||1e3,this.alwaysFormat=x!==void 0?x:!1,this.resetRegExp()}reset(){this.options&&this.init(this.options)}resetRegExp(){const e=(n,s)=>n&&n.source===s?(n.lastIndex=0,n):new RegExp(s,"g");this.regexp=e(this.regexp,`${this.prefix}(.+?)${this.suffix}`),this.regexpUnescape=e(this.regexpUnescape,`${this.prefix}${this.unescapePrefix}(.+?)${this.unescapeSuffix}${this.suffix}`),this.nestingRegexp=e(this.nestingRegexp,`${this.nestingPrefix}(.+?)${this.nestingSuffix}`)}interpolate(e,n,s,r){let i,o,a;const l=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{},c=f=>{if(f.indexOf(this.formatSeparator)<0){const y=gR(n,l,f,this.options.keySeparator,this.options.ignoreJSONStructure);return this.alwaysFormat?this.format(y,void 0,s,{...r,...n,interpolationkey:f}):y}const p=f.split(this.formatSeparator),m=p.shift().trim(),g=p.join(this.formatSeparator).trim();return this.format(gR(n,l,m,this.options.keySeparator,this.options.ignoreJSONStructure),g,s,{...r,...n,interpolationkey:m})};this.resetRegExp();const u=r&&r.missingInterpolationHandler||this.options.missingInterpolationHandler,d=r&&r.interpolation&&r.interpolation.skipOnVariables!==void 0?r.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:f=>Z1(f)},{regex:this.regexp,safeValue:f=>this.escapeValue?Z1(this.escape(f)):Z1(f)}].forEach(f=>{for(a=0;i=f.regex.exec(e);){const p=i[1].trim();if(o=c(p),o===void 0)if(typeof u=="function"){const g=u(e,i,r);o=Pe(g)?g:""}else if(r&&Object.prototype.hasOwnProperty.call(r,p))o="";else if(d){o=i[0];continue}else this.logger.warn(`missed to pass in variable ${p} for interpolating ${e}`),o="";else!Pe(o)&&!this.useRawValueToEscape&&(o=lR(o));const m=f.safeValue(o);if(e=e.replace(i[0],m),d?(f.regex.lastIndex+=o.length,f.regex.lastIndex-=i[0].length):f.regex.lastIndex=0,a++,a>=this.maxReplaces)break}}),e}nest(e,n){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r,i,o;const a=(l,c)=>{const u=this.nestingOptionsSeparator;if(l.indexOf(u)<0)return l;const d=l.split(new RegExp(`${u}[ ]*{`));let h=`{${d[1]}`;l=d[0],h=this.interpolate(h,o);const f=h.match(/'/g),p=h.match(/"/g);(f&&f.length%2===0&&!p||p.length%2!==0)&&(h=h.replace(/'/g,'"'));try{o=JSON.parse(h),c&&(o={...c,...o})}catch(m){return this.logger.warn(`failed parsing options string in nesting for key ${l}`,m),`${l}${u}${h}`}return o.defaultValue&&o.defaultValue.indexOf(this.prefix)>-1&&delete o.defaultValue,l};for(;r=this.nestingRegexp.exec(e);){let l=[];o={...s},o=o.replace&&!Pe(o.replace)?o.replace:o,o.applyPostProcessor=!1,delete o.defaultValue;let c=!1;if(r[0].indexOf(this.formatSeparator)!==-1&&!/{.*}/.test(r[1])){const u=r[1].split(this.formatSeparator).map(d=>d.trim());r[1]=u.shift(),l=u,c=!0}if(i=n(a.call(this,r[1].trim(),o),o),i&&r[0]===e&&!Pe(i))return i;Pe(i)||(i=lR(i)),i||(this.logger.warn(`missed to resolve ${r[1]} for nesting ${e}`),i=""),c&&(i=l.reduce((u,d)=>this.format(u,d,s.lng,{...s,interpolationkey:r[1].trim()}),i.trim())),e=e.replace(r[0],i),this.regexp.lastIndex=0}return e}}const F7=t=>{let e=t.toLowerCase().trim();const n={};if(t.indexOf("(")>-1){const s=t.split("(");e=s[0].toLowerCase().trim();const r=s[1].substring(0,s[1].length-1);e==="currency"&&r.indexOf(":")<0?n.currency||(n.currency=r.trim()):e==="relativetime"&&r.indexOf(":")<0?n.range||(n.range=r.trim()):r.split(";").forEach(o=>{if(o){const[a,...l]=o.split(":"),c=l.join(":").trim().replace(/^'+|'+$/g,""),u=a.trim();n[u]||(n[u]=c),c==="false"&&(n[u]=!1),c==="true"&&(n[u]=!0),isNaN(c)||(n[u]=parseInt(c,10))}})}return{formatName:e,formatOptions:n}},pu=t=>{const e={};return(n,s,r)=>{let i=r;r&&r.interpolationkey&&r.formatParams&&r.formatParams[r.interpolationkey]&&r[r.interpolationkey]&&(i={...i,[r.interpolationkey]:void 0});const o=s+JSON.stringify(i);let a=e[o];return a||(a=t(h0(s),r),e[o]=a),a(n)}};class _7{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.logger=Zi.create("formatter"),this.options=e,this.formats={number:pu((n,s)=>{const r=new Intl.NumberFormat(n,{...s});return i=>r.format(i)}),currency:pu((n,s)=>{const r=new Intl.NumberFormat(n,{...s,style:"currency"});return i=>r.format(i)}),datetime:pu((n,s)=>{const r=new Intl.DateTimeFormat(n,{...s});return i=>r.format(i)}),relativetime:pu((n,s)=>{const r=new Intl.RelativeTimeFormat(n,{...s});return i=>r.format(i,s.range||"day")}),list:pu((n,s)=>{const r=new Intl.ListFormat(n,{...s});return i=>r.format(i)})},this.init(e)}init(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{interpolation:{}};this.formatSeparator=n.interpolation.formatSeparator||","}add(e,n){this.formats[e.toLowerCase().trim()]=n}addCached(e,n){this.formats[e.toLowerCase().trim()]=pu(n)}format(e,n,s){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};const i=n.split(this.formatSeparator);if(i.length>1&&i[0].indexOf("(")>1&&i[0].indexOf(")")<0&&i.find(a=>a.indexOf(")")>-1)){const a=i.findIndex(l=>l.indexOf(")")>-1);i[0]=[i[0],...i.splice(1,a)].join(this.formatSeparator)}return i.reduce((a,l)=>{const{formatName:c,formatOptions:u}=F7(l);if(this.formats[c]){let d=a;try{const h=r&&r.formatParams&&r.formatParams[r.interpolationkey]||{},f=h.locale||h.lng||r.locale||r.lng||s;d=this.formats[c](a,f,{...u,...r,...h})}catch(h){this.logger.warn(h)}return d}else this.logger.warn(`there was no format function for ${c}`);return a},e)}}const z7=(t,e)=>{t.pending[e]!==void 0&&(delete t.pending[e],t.pendingCount--)};class B7 extends db{constructor(e,n,s){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};super(),this.backend=e,this.store=n,this.services=s,this.languageUtils=s.languageUtils,this.options=r,this.logger=Zi.create("backendConnector"),this.waitingReads=[],this.maxParallelReads=r.maxParallelReads||10,this.readingCalls=0,this.maxRetries=r.maxRetries>=0?r.maxRetries:5,this.retryTimeout=r.retryTimeout>=1?r.retryTimeout:350,this.state={},this.queue=[],this.backend&&this.backend.init&&this.backend.init(s,r.backend,r)}queueLoad(e,n,s,r){const i={},o={},a={},l={};return e.forEach(c=>{let u=!0;n.forEach(d=>{const h=`${c}|${d}`;!s.reload&&this.store.hasResourceBundle(c,d)?this.state[h]=2:this.state[h]<0||(this.state[h]===1?o[h]===void 0&&(o[h]=!0):(this.state[h]=1,u=!1,o[h]===void 0&&(o[h]=!0),i[h]===void 0&&(i[h]=!0),l[d]===void 0&&(l[d]=!0)))}),u||(a[c]=!0)}),(Object.keys(i).length||Object.keys(o).length)&&this.queue.push({pending:o,pendingCount:Object.keys(o).length,loaded:{},errors:[],callback:r}),{toLoad:Object.keys(i),pending:Object.keys(o),toLoadLanguages:Object.keys(a),toLoadNamespaces:Object.keys(l)}}loaded(e,n,s){const r=e.split("|"),i=r[0],o=r[1];n&&this.emit("failedLoading",i,o,n),!n&&s&&this.store.addResourceBundle(i,o,s,void 0,void 0,{skipCopy:!0}),this.state[e]=n?-1:2,n&&s&&(this.state[e]=0);const a={};this.queue.forEach(l=>{v7(l.loaded,[i],o),z7(l,e),n&&l.errors.push(n),l.pendingCount===0&&!l.done&&(Object.keys(l.loaded).forEach(c=>{a[c]||(a[c]={});const u=l.loaded[c];u.length&&u.forEach(d=>{a[c][d]===void 0&&(a[c][d]=!0)})}),l.done=!0,l.errors.length?l.callback(l.errors):l.callback())}),this.emit("loaded",a),this.queue=this.queue.filter(l=>!l.done)}read(e,n,s){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:this.retryTimeout,o=arguments.length>5?arguments[5]:void 0;if(!e.length)return o(null,{});if(this.readingCalls>=this.maxParallelReads){this.waitingReads.push({lng:e,ns:n,fcName:s,tried:r,wait:i,callback:o});return}this.readingCalls++;const a=(c,u)=>{if(this.readingCalls--,this.waitingReads.length>0){const d=this.waitingReads.shift();this.read(d.lng,d.ns,d.fcName,d.tried,d.wait,d.callback)}if(c&&u&&r<this.maxRetries){setTimeout(()=>{this.read.call(this,e,n,s,r+1,i*2,o)},i);return}o(c,u)},l=this.backend[s].bind(this.backend);if(l.length===2){try{const c=l(e,n);c&&typeof c.then=="function"?c.then(u=>a(null,u)).catch(a):a(null,c)}catch(c){a(c)}return}return l(e,n,a)}prepareLoading(e,n){let s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),r&&r();Pe(e)&&(e=this.languageUtils.toResolveHierarchy(e)),Pe(n)&&(n=[n]);const i=this.queueLoad(e,n,s,r);if(!i.toLoad.length)return i.pending.length||r(),null;i.toLoad.forEach(o=>{this.loadOne(o)})}load(e,n,s){this.prepareLoading(e,n,{},s)}reload(e,n,s){this.prepareLoading(e,n,{reload:!0},s)}loadOne(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const s=e.split("|"),r=s[0],i=s[1];this.read(r,i,"read",void 0,void 0,(o,a)=>{o&&this.logger.warn(`${n}loading namespace ${i} for language ${r} failed`,o),!o&&a&&this.logger.log(`${n}loaded namespace ${i} for language ${r}`,a),this.loaded(e,o,a)})}saveMissing(e,n,s,r,i){let o=arguments.length>5&&arguments[5]!==void 0?arguments[5]:{},a=arguments.length>6&&arguments[6]!==void 0?arguments[6]:()=>{};if(this.services.utils&&this.services.utils.hasLoadedNamespace&&!this.services.utils.hasLoadedNamespace(n)){this.logger.warn(`did not save key "${s}" as the namespace "${n}" was not yet loaded`,"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");return}if(!(s==null||s==="")){if(this.backend&&this.backend.create){const l={...o,isUpdate:i},c=this.backend.create.bind(this.backend);if(c.length<6)try{let u;c.length===5?u=c(e,n,s,r,l):u=c(e,n,s,r),u&&typeof u.then=="function"?u.then(d=>a(null,d)).catch(a):a(null,u)}catch(u){a(u)}else c(e,n,s,r,a,l)}!e||!e[0]||this.store.addResource(e[0],n,s,r)}}}const yR=()=>({debug:!1,initImmediate:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!1,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:t=>{let e={};if(typeof t[1]=="object"&&(e=t[1]),Pe(t[1])&&(e.defaultValue=t[1]),Pe(t[2])&&(e.tDescription=t[2]),typeof t[2]=="object"||typeof t[3]=="object"){const n=t[3]||t[2];Object.keys(n).forEach(s=>{e[s]=n[s]})}return e},interpolation:{escapeValue:!0,format:t=>t,prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}}),xR=t=>(Pe(t.ns)&&(t.ns=[t.ns]),Pe(t.fallbackLng)&&(t.fallbackLng=[t.fallbackLng]),Pe(t.fallbackNS)&&(t.fallbackNS=[t.fallbackNS]),t.supportedLngs&&t.supportedLngs.indexOf("cimode")<0&&(t.supportedLngs=t.supportedLngs.concat(["cimode"])),t),Sg=()=>{},j7=t=>{Object.getOwnPropertyNames(Object.getPrototypeOf(t)).forEach(n=>{typeof t[n]=="function"&&(t[n]=t[n].bind(t))})};class Hf extends db{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;if(super(),this.options=xR(e),this.services={},this.logger=Zi,this.modules={external:[]},j7(this),n&&!this.isInitialized&&!e.isClone){if(!this.options.initImmediate)return this.init(e,n),this;setTimeout(()=>{this.init(e,n)},0)}}init(){var e=this;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=arguments.length>1?arguments[1]:void 0;this.isInitializing=!0,typeof n=="function"&&(s=n,n={}),!n.defaultNS&&n.defaultNS!==!1&&n.ns&&(Pe(n.ns)?n.defaultNS=n.ns:n.ns.indexOf("translation")<0&&(n.defaultNS=n.ns[0]));const r=yR();this.options={...r,...this.options,...xR(n)},this.options.compatibilityAPI!=="v1"&&(this.options.interpolation={...r.interpolation,...this.options.interpolation}),n.keySeparator!==void 0&&(this.options.userDefinedKeySeparator=n.keySeparator),n.nsSeparator!==void 0&&(this.options.userDefinedNsSeparator=n.nsSeparator);const i=u=>u?typeof u=="function"?new u:u:null;if(!this.options.isClone){this.modules.logger?Zi.init(i(this.modules.logger),this.options):Zi.init(null,this.options);let u;this.modules.formatter?u=this.modules.formatter:typeof Intl<"u"&&(u=_7);const d=new pR(this.options);this.store=new hR(this.options.resources,this.options);const h=this.services;h.logger=Zi,h.resourceStore=this.store,h.languageUtils=d,h.pluralResolver=new P7(d,{prepend:this.options.pluralSeparator,compatibilityJSON:this.options.compatibilityJSON,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),u&&(!this.options.interpolation.format||this.options.interpolation.format===r.interpolation.format)&&(h.formatter=i(u),h.formatter.init(h,this.options),this.options.interpolation.format=h.formatter.format.bind(h.formatter)),h.interpolator=new L7(this.options),h.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},h.backendConnector=new B7(i(this.modules.backend),h.resourceStore,h,this.options),h.backendConnector.on("*",function(f){for(var p=arguments.length,m=new Array(p>1?p-1:0),g=1;g<p;g++)m[g-1]=arguments[g];e.emit(f,...m)}),this.modules.languageDetector&&(h.languageDetector=i(this.modules.languageDetector),h.languageDetector.init&&h.languageDetector.init(h,this.options.detection,this.options)),this.modules.i18nFormat&&(h.i18nFormat=i(this.modules.i18nFormat),h.i18nFormat.init&&h.i18nFormat.init(this)),this.translator=new f0(this.services,this.options),this.translator.on("*",function(f){for(var p=arguments.length,m=new Array(p>1?p-1:0),g=1;g<p;g++)m[g-1]=arguments[g];e.emit(f,...m)}),this.modules.external.forEach(f=>{f.init&&f.init(this)})}if(this.format=this.options.interpolation.format,s||(s=Sg),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){const u=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);u.length>0&&u[0]!=="dev"&&(this.options.lng=u[0])}!this.services.languageDetector&&!this.options.lng&&this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach(u=>{this[u]=function(){return e.store[u](...arguments)}}),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach(u=>{this[u]=function(){return e.store[u](...arguments),e}});const l=bh(),c=()=>{const u=(d,h)=>{this.isInitializing=!1,this.isInitialized&&!this.initializedStoreOnce&&this.logger.warn("init: i18next is already initialized. You should call init just once!"),this.isInitialized=!0,this.options.isClone||this.logger.log("initialized",this.options),this.emit("initialized",this.options),l.resolve(h),s(d,h)};if(this.languages&&this.options.compatibilityAPI!=="v1"&&!this.isInitialized)return u(null,this.t.bind(this));this.changeLanguage(this.options.lng,u)};return this.options.resources||!this.options.initImmediate?c():setTimeout(c,0),l}loadResources(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Sg;const r=Pe(e)?e:this.language;if(typeof e=="function"&&(s=e),!this.options.resources||this.options.partialBundledLanguages){if(r&&r.toLowerCase()==="cimode"&&(!this.options.preload||this.options.preload.length===0))return s();const i=[],o=a=>{if(!a||a==="cimode")return;this.services.languageUtils.toResolveHierarchy(a).forEach(c=>{c!=="cimode"&&i.indexOf(c)<0&&i.push(c)})};r?o(r):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach(l=>o(l)),this.options.preload&&this.options.preload.forEach(a=>o(a)),this.services.backendConnector.load(i,this.options.ns,a=>{!a&&!this.resolvedLanguage&&this.language&&this.setResolvedLanguage(this.language),s(a)})}else s(null)}reloadResources(e,n,s){const r=bh();return typeof e=="function"&&(s=e,e=void 0),typeof n=="function"&&(s=n,n=void 0),e||(e=this.languages),n||(n=this.options.ns),s||(s=Sg),this.services.backendConnector.reload(e,n,i=>{r.resolve(),s(i)}),r}use(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return e.type==="backend"&&(this.modules.backend=e),(e.type==="logger"||e.log&&e.warn&&e.error)&&(this.modules.logger=e),e.type==="languageDetector"&&(this.modules.languageDetector=e),e.type==="i18nFormat"&&(this.modules.i18nFormat=e),e.type==="postProcessor"&&K_.addPostProcessor(e),e.type==="formatter"&&(this.modules.formatter=e),e.type==="3rdParty"&&this.modules.external.push(e),this}setResolvedLanguage(e){if(!(!e||!this.languages)&&!(["cimode","dev"].indexOf(e)>-1))for(let n=0;n<this.languages.length;n++){const s=this.languages[n];if(!(["cimode","dev"].indexOf(s)>-1)&&this.store.hasLanguageSomeTranslations(s)){this.resolvedLanguage=s;break}}}changeLanguage(e,n){var s=this;this.isLanguageChangingTo=e;const r=bh();this.emit("languageChanging",e);const i=l=>{this.language=l,this.languages=this.services.languageUtils.toResolveHierarchy(l),this.resolvedLanguage=void 0,this.setResolvedLanguage(l)},o=(l,c)=>{c?(i(c),this.translator.changeLanguage(c),this.isLanguageChangingTo=void 0,this.emit("languageChanged",c),this.logger.log("languageChanged",c)):this.isLanguageChangingTo=void 0,r.resolve(function(){return s.t(...arguments)}),n&&n(l,function(){return s.t(...arguments)})},a=l=>{!e&&!l&&this.services.languageDetector&&(l=[]);const c=Pe(l)?l:this.services.languageUtils.getBestMatchFromCodes(l);c&&(this.language||i(c),this.translator.language||this.translator.changeLanguage(c),this.services.languageDetector&&this.services.languageDetector.cacheUserLanguage&&this.services.languageDetector.cacheUserLanguage(c)),this.loadResources(c,u=>{o(u,c)})};return!e&&this.services.languageDetector&&!this.services.languageDetector.async?a(this.services.languageDetector.detect()):!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect.length===0?this.services.languageDetector.detect().then(a):this.services.languageDetector.detect(a):a(e),r}getFixedT(e,n,s){var r=this;const i=function(o,a){let l;if(typeof a!="object"){for(var c=arguments.length,u=new Array(c>2?c-2:0),d=2;d<c;d++)u[d-2]=arguments[d];l=r.options.overloadTranslationOptionHandler([o,a].concat(u))}else l={...a};l.lng=l.lng||i.lng,l.lngs=l.lngs||i.lngs,l.ns=l.ns||i.ns,l.keyPrefix!==""&&(l.keyPrefix=l.keyPrefix||s||i.keyPrefix);const h=r.options.keySeparator||".";let f;return l.keyPrefix&&Array.isArray(o)?f=o.map(p=>`${l.keyPrefix}${h}${p}`):f=l.keyPrefix?`${l.keyPrefix}${h}${o}`:o,r.t(f,l)};return Pe(e)?i.lng=e:i.lngs=e,i.ns=n,i.keyPrefix=s,i}t(){return this.translator&&this.translator.translate(...arguments)}exists(){return this.translator&&this.translator.exists(...arguments)}setDefaultNamespace(e){this.options.defaultNS=e}hasLoadedNamespace(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;const s=n.lng||this.resolvedLanguage||this.languages[0],r=this.options?this.options.fallbackLng:!1,i=this.languages[this.languages.length-1];if(s.toLowerCase()==="cimode")return!0;const o=(a,l)=>{const c=this.services.backendConnector.state[`${a}|${l}`];return c===-1||c===0||c===2};if(n.precheck){const a=n.precheck(this,o);if(a!==void 0)return a}return!!(this.hasResourceBundle(s,e)||!this.services.backendConnector.backend||this.options.resources&&!this.options.partialBundledLanguages||o(s,e)&&(!r||o(i,e)))}loadNamespaces(e,n){const s=bh();return this.options.ns?(Pe(e)&&(e=[e]),e.forEach(r=>{this.options.ns.indexOf(r)<0&&this.options.ns.push(r)}),this.loadResources(r=>{s.resolve(),n&&n(r)}),s):(n&&n(),Promise.resolve())}loadLanguages(e,n){const s=bh();Pe(e)&&(e=[e]);const r=this.options.preload||[],i=e.filter(o=>r.indexOf(o)<0&&this.services.languageUtils.isSupportedCode(o));return i.length?(this.options.preload=r.concat(i),this.loadResources(o=>{s.resolve(),n&&n(o)}),s):(n&&n(),Promise.resolve())}dir(e){if(e||(e=this.resolvedLanguage||(this.languages&&this.languages.length>0?this.languages[0]:this.language)),!e)return"rtl";const n=["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"],s=this.services&&this.services.languageUtils||new pR(yR());return n.indexOf(s.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}static createInstance(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;return new Hf(e,n)}cloneInstance(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Sg;const s=e.forkResourceStore;s&&delete e.forkResourceStore;const r={...this.options,...e,isClone:!0},i=new Hf(r);return(e.debug!==void 0||e.prefix!==void 0)&&(i.logger=i.logger.clone(e)),["store","services","language"].forEach(a=>{i[a]=this[a]}),i.services={...this.services},i.services.utils={hasLoadedNamespace:i.hasLoadedNamespace.bind(i)},s&&(i.store=new hR(this.store.data,r),i.services.resourceStore=i.store),i.translator=new f0(i.services,r),i.translator.on("*",function(a){for(var l=arguments.length,c=new Array(l>1?l-1:0),u=1;u<l;u++)c[u-1]=arguments[u];i.emit(a,...c)}),i.init(r,n),i.translator.options=r,i.translator.backendConnector.services.utils={hasLoadedNamespace:i.hasLoadedNamespace.bind(i)},i}toJSON(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}const Cs=Hf.createInstance();Cs.createInstance=Hf.createInstance;Cs.createInstance;Cs.dir;Cs.init;Cs.loadResources;Cs.reloadResources;Cs.use;Cs.changeLanguage;Cs.getFixedT;Cs.t;Cs.exists;Cs.setDefaultNamespace;Cs.hasLoadedNamespace;Cs.loadNamespaces;Cs.loadLanguages;function V7(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Gf(t){"@babel/helpers - typeof";return Gf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Gf(t)}function U7(t,e){if(Gf(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var s=n.call(t,e||"default");if(Gf(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function W7(t){var e=U7(t,"string");return Gf(e)=="symbol"?e:e+""}function bR(t,e){for(var n=0;n<e.length;n++){var s=e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,W7(s.key),s)}}function H7(t,e,n){return e&&bR(t.prototype,e),n&&bR(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}var q_=[],G7=q_.forEach,K7=q_.slice;function q7(t){return G7.call(K7.call(arguments,1),function(e){if(e)for(var n in e)t[n]===void 0&&(t[n]=e[n])}),t}var vR=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/,X7=function(e,n,s){var r=s||{};r.path=r.path||"/";var i=encodeURIComponent(n),o="".concat(e,"=").concat(i);if(r.maxAge>0){var a=r.maxAge-0;if(Number.isNaN(a))throw new Error("maxAge should be a Number");o+="; Max-Age=".concat(Math.floor(a))}if(r.domain){if(!vR.test(r.domain))throw new TypeError("option domain is invalid");o+="; Domain=".concat(r.domain)}if(r.path){if(!vR.test(r.path))throw new TypeError("option path is invalid");o+="; Path=".concat(r.path)}if(r.expires){if(typeof r.expires.toUTCString!="function")throw new TypeError("option expires is invalid");o+="; Expires=".concat(r.expires.toUTCString())}if(r.httpOnly&&(o+="; HttpOnly"),r.secure&&(o+="; Secure"),r.sameSite){var l=typeof r.sameSite=="string"?r.sameSite.toLowerCase():r.sameSite;switch(l){case!0:o+="; SameSite=Strict";break;case"lax":o+="; SameSite=Lax";break;case"strict":o+="; SameSite=Strict";break;case"none":o+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return o},wR={create:function(e,n,s,r){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{path:"/",sameSite:"strict"};s&&(i.expires=new Date,i.expires.setTime(i.expires.getTime()+s*60*1e3)),r&&(i.domain=r),document.cookie=X7(e,encodeURIComponent(n),i)},read:function(e){for(var n="".concat(e,"="),s=document.cookie.split(";"),r=0;r<s.length;r++){for(var i=s[r];i.charAt(0)===" ";)i=i.substring(1,i.length);if(i.indexOf(n)===0)return i.substring(n.length,i.length)}return null},remove:function(e){this.create(e,"",-1)}},J7={name:"cookie",lookup:function(e){var n;if(e.lookupCookie&&typeof document<"u"){var s=wR.read(e.lookupCookie);s&&(n=s)}return n},cacheUserLanguage:function(e,n){n.lookupCookie&&typeof document<"u"&&wR.create(n.lookupCookie,e,n.cookieMinutes,n.cookieDomain,n.cookieOptions)}},Y7={name:"querystring",lookup:function(e){var n;if(typeof window<"u"){var s=window.location.search;!window.location.search&&window.location.hash&&window.location.hash.indexOf("?")>-1&&(s=window.location.hash.substring(window.location.hash.indexOf("?")));for(var r=s.substring(1),i=r.split("&"),o=0;o<i.length;o++){var a=i[o].indexOf("=");if(a>0){var l=i[o].substring(0,a);l===e.lookupQuerystring&&(n=i[o].substring(a+1))}}}return n}},vh=null,SR=function(){if(vh!==null)return vh;try{vh=window!=="undefined"&&window.localStorage!==null;var e="i18next.translate.boo";window.localStorage.setItem(e,"foo"),window.localStorage.removeItem(e)}catch{vh=!1}return vh},Q7={name:"localStorage",lookup:function(e){var n;if(e.lookupLocalStorage&&SR()){var s=window.localStorage.getItem(e.lookupLocalStorage);s&&(n=s)}return n},cacheUserLanguage:function(e,n){n.lookupLocalStorage&&SR()&&window.localStorage.setItem(n.lookupLocalStorage,e)}},wh=null,kR=function(){if(wh!==null)return wh;try{wh=window!=="undefined"&&window.sessionStorage!==null;var e="i18next.translate.boo";window.sessionStorage.setItem(e,"foo"),window.sessionStorage.removeItem(e)}catch{wh=!1}return wh},Z7={name:"sessionStorage",lookup:function(e){var n;if(e.lookupSessionStorage&&kR()){var s=window.sessionStorage.getItem(e.lookupSessionStorage);s&&(n=s)}return n},cacheUserLanguage:function(e,n){n.lookupSessionStorage&&kR()&&window.sessionStorage.setItem(n.lookupSessionStorage,e)}},eX={name:"navigator",lookup:function(e){var n=[];if(typeof navigator<"u"){if(navigator.languages)for(var s=0;s<navigator.languages.length;s++)n.push(navigator.languages[s]);navigator.userLanguage&&n.push(navigator.userLanguage),navigator.language&&n.push(navigator.language)}return n.length>0?n:void 0}},tX={name:"htmlTag",lookup:function(e){var n,s=e.htmlTag||(typeof document<"u"?document.documentElement:null);return s&&typeof s.getAttribute=="function"&&(n=s.getAttribute("lang")),n}},nX={name:"path",lookup:function(e){var n;if(typeof window<"u"){var s=window.location.pathname.match(/\/([a-zA-Z-]*)/g);if(s instanceof Array)if(typeof e.lookupFromPathIndex=="number"){if(typeof s[e.lookupFromPathIndex]!="string")return;n=s[e.lookupFromPathIndex].replace("/","")}else n=s[0].replace("/","")}return n}},sX={name:"subdomain",lookup:function(e){var n=typeof e.lookupFromSubdomainIndex=="number"?e.lookupFromSubdomainIndex+1:1,s=typeof window<"u"&&window.location&&window.location.hostname&&window.location.hostname.match(/^(\w{2,5})\.(([a-z0-9-]{1,63}\.[a-z]{2,6})|localhost)/i);if(s)return s[n]}},X_=!1;try{document.cookie,X_=!0}catch{}var J_=["querystring","cookie","localStorage","sessionStorage","navigator","htmlTag"];X_||J_.splice(1,1);function rX(){return{order:J_,lookupQuerystring:"lng",lookupCookie:"i18next",lookupLocalStorage:"i18nextLng",lookupSessionStorage:"i18nextLng",caches:["localStorage"],excludeCacheFor:["cimode"],convertDetectedLanguage:function(e){return e}}}var Y_=function(){function t(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};V7(this,t),this.type="languageDetector",this.detectors={},this.init(e,n)}return H7(t,[{key:"init",value:function(n){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.services=n||{languageUtils:{}},this.options=q7(s,this.options||{},rX()),typeof this.options.convertDetectedLanguage=="string"&&this.options.convertDetectedLanguage.indexOf("15897")>-1&&(this.options.convertDetectedLanguage=function(i){return i.replace("-","_")}),this.options.lookupFromUrlIndex&&(this.options.lookupFromPathIndex=this.options.lookupFromUrlIndex),this.i18nOptions=r,this.addDetector(J7),this.addDetector(Y7),this.addDetector(Q7),this.addDetector(Z7),this.addDetector(eX),this.addDetector(tX),this.addDetector(nX),this.addDetector(sX)}},{key:"addDetector",value:function(n){return this.detectors[n.name]=n,this}},{key:"detect",value:function(n){var s=this;n||(n=this.options.order);var r=[];return n.forEach(function(i){if(s.detectors[i]){var o=s.detectors[i].lookup(s.options);o&&typeof o=="string"&&(o=[o]),o&&(r=r.concat(o))}}),r=r.map(function(i){return s.options.convertDetectedLanguage(i)}),this.services.languageUtils.getBestMatchFromCodes?r:r.length>0?r[0]:null}},{key:"cacheUserLanguage",value:function(n,s){var r=this;s||(s=this.options.caches),s&&(this.options.excludeCacheFor&&this.options.excludeCacheFor.indexOf(n)>-1||s.forEach(function(i){r.detectors[i]&&r.detectors[i].cacheUserLanguage(n,r.options)}))}}])}();Y_.type="languageDetector";const iX={save:"Save",cancel:"Cancel",delete:"Delete",edit:"Edit",send:"Send",search:"Search",loading:"Loading...",error:"Error",success:"Success"},oX={login:"Login",logout:"Logout",signup:"Sign Up",email:"Email",password:"Password",username:"Username",confirmPassword:"Confirm Password",forgotPassword:"Forgot Password?",noAccount:"No account?",hasAccount:"Already have an account?",welcome:"Welcome to Palfrog",secureChat:"Secure peer-to-peer chat"},aX={messages:"Messages",contacts:"Contacts",typeMessage:"Type your message...",online:"Online",offline:"Offline",typing:"{{user}} is typing...",encryptionActive:"E2E Encryption Active",encryptionPending:"Establishing encryption...",newMessage:"New message from {{user}}"},lX={incomingCall:"Incoming Call",outgoingCall:"Outgoing Call",audioCall:"Audio Call",videoCall:"Video Call",accept:"Accept",reject:"Reject",endCall:"End Call",mute:"Mute",unmute:"Unmute",videoOn:"Camera On",videoOff:"Camera Off",screenShare:"Screen Share"},cX={assistantTitle:"Local AI Assistant",suggestions:"Reply Suggestions",conversationSummary:"Conversation Summary",regenerateSummary:"Regenerate Summary",generatingSummary:"Generating summary...",enableAssistant:"Enable AI Assistant",enablePrompt:"Enable AI assistant for smart suggestions, auto-summaries, and more.",privacyNote:" All AI processing happens locally on your device. No data is sent to the cloud.",preferences:"Preferences",features:{autoSummarize:"Auto Summaries",smartReplies:"Smart Replies",sentimentAnalysis:"Sentiment Analysis",autoTranslation:"Auto Translation"},capabilities:{summarization:"Summarization",translation:"Translation",sentiment:"Sentiment",suggestions:"Suggestions",smartReplies:"Smart Replies"},replies:{agree:"Agree",letMeThink:"Let me think",goodQuestion:"Good question",youreWelcome:"You're welcome!",happyToHelp:"Happy to help",hello:"Hello!",howAreYou:"How are you?",interesting:"Interesting",iSee:"I see",letsDiscuss:"Let's discuss"}},uX={sendFile:"Send File",fileTooLarge:"File too large. Maximum: {{size}}MB",transferProgress:"Transfer in progress",transferComplete:"Transfer complete",transferFailed:"Transfer failed",download:"Download"},dX={settings:"Settings",language:"Language",theme:"Theme",notifications:"Notifications",security:"Security",privacy:"Privacy"},hX={dashboardTitle:"Security Dashboard",levels:{excellent:"Excellent",good:"Good",fair:"Fair",poor:"Poor",critical:"Critical"},descriptions:{excellent:"Your security is optimal. Keep it up!",good:"Good security level. Some minor improvements possible.",fair:"Fair security level. Several items need your attention.",poor:"Insufficient security. Corrective actions are needed.",critical:"Critical security! Please act immediately."},categories:{authentication:"Authentication",encryption:"Encryption",privacy:"Privacy",behavior:"Behavior",network:"Network"},lastUpdated:"Last updated:",improvementTips:"Improvement Tips",encryption:"Encryption",endToEndEncryption:"End-to-End Encryption",regenerateKeys:"Regenerate Keys",backupKeys:"Backup Keys",twoFactorAuth:"Two-Factor Authentication",twoFactorEnabled:"Two-Factor Authentication Enabled",scanQRCode:"Scan this QR Code with your authenticator app",enable2FA:"Enable 2FA",scanWithAuthenticator:"Scan with Google Authenticator or Authy",enterVerificationCode:"Enter verification code",verifyAndEnable:"Verify and Enable",invalidCode:"Invalid code"},fX={common:iX,auth:oX,chat:aX,calls:lX,ai:cX,files:uX,settings:dX,security:hX},pX={save:"Sauvegarder",cancel:"Annuler",delete:"Supprimer",edit:"Modifier",send:"Envoyer",search:"Rechercher",loading:"Chargement...",error:"Erreur",success:"Succs"},mX={login:"Connexion",logout:"Dconnexion",signup:"Inscription",email:"E-mail",password:"Mot de passe",username:"Nom d'utilisateur",confirmPassword:"Confirmer le mot de passe",forgotPassword:"Mot de passe oubli ?",noAccount:"Pas de compte ?",hasAccount:"Dj un compte ?",welcome:"Bienvenue sur Palfrog",secureChat:"Chat scuris peer-to-peer"},gX={messages:"Messages",contacts:"Contacts",typeMessage:"Tapez votre message...",online:"En ligne",offline:"Hors ligne",typing:"{{user}} est en train d'crire...",encryptionActive:"Chiffrement E2E activ",encryptionPending:"tablissement du chiffrement...",newMessage:"Nouveau message de {{user}}"},yX={incomingCall:"Appel entrant",outgoingCall:"Appel sortant",audioCall:"Appel audio",videoCall:"Appel vido",accept:"Accepter",reject:"Rejeter",endCall:"Raccrocher",mute:"Muet",unmute:"Activer le micro",videoOn:"Camra active",videoOff:"Camra dsactive",screenShare:"Partage d'cran"},xX={assistantTitle:"Assistant IA Local",suggestions:"Suggestions de rponses",conversationSummary:"Rsum de la conversation",regenerateSummary:"Rgnrer le rsum",generatingSummary:"Gnration du rsum...",enableAssistant:"Activer l'Assistant IA",enablePrompt:"Activez l'assistant IA pour des suggestions intelligentes, des rsums automatiques et plus encore.",privacyNote:" Tous les traitements IA s'effectuent localement sur votre appareil. Aucune donne n'est envoye au cloud.",preferences:"Prfrences",features:{autoSummarize:"Rsums automatiques",smartReplies:"Rponses intelligentes",sentimentAnalysis:"Analyse de sentiment",autoTranslation:"Traduction automatique"},capabilities:{summarization:"Rsums",translation:"Traduction",sentiment:"Sentiment",suggestions:"Suggestions",smartReplies:"Rponses intelligentes"},replies:{agree:"D'accord",letMeThink:"Laisse-moi rflchir",goodQuestion:"Bonne question",youreWelcome:"De rien !",happyToHelp:"Content de pouvoir aider",hello:"Salut !",howAreYou:"Comment a va ?",interesting:"Intressant",iSee:"Je vois",letsDiscuss:"Parlons-en"}},bX={sendFile:"Envoyer un fichier",fileTooLarge:"Fichier trop volumineux. Maximum: {{size}}MB",transferProgress:"Transfert en cours",transferComplete:"Transfert termin",transferFailed:"chec du transfert",download:"Tlcharger"},vX={settings:"Paramtres",language:"Langue",theme:"Thme",notifications:"Notifications",security:"Scurit",privacy:"Confidentialit"},wX={dashboardTitle:"Tableau de bord de scurit",levels:{excellent:"Excellent",good:"Bon",fair:"Moyen",poor:"Faible",critical:"Critique"},descriptions:{excellent:"Votre scurit est optimale. Continuez ainsi !",good:"Bon niveau de scurit. Quelques amliorations mineures possibles.",fair:"Niveau de scurit moyen. Plusieurs points ncessitent votre attention.",poor:"Scurit insuffisante. Des actions correctives sont ncessaires.",critical:"Scurit critique ! Veuillez agir immdiatement."},categories:{authentication:"Authentification",encryption:"Chiffrement",privacy:"Confidentialit",behavior:"Comportement",network:"Rseau"},lastUpdated:"Dernire mise  jour :",improvementTips:"Conseils d'amlioration",encryption:"Chiffrement",endToEndEncryption:"Chiffrement de bout en bout",regenerateKeys:"Rgnrer les cls",backupKeys:"Sauvegarder les cls",twoFactorAuth:"Double authentification",twoFactorEnabled:"Double authentification active",scanQRCode:"Scannez ce QR Code avec votre application d'authentification",enable2FA:"Activer la 2FA",scanWithAuthenticator:"Scannez avec Google Authenticator ou Authy",enterVerificationCode:"Entrez le code de vrification",verifyAndEnable:"Vrifier et activer",invalidCode:"Code invalide"},SX={dashboardTitle:"Ponts d'Applications",dashboardDescription:"Connectez Palfrog  vos autres applications de messagerie",messagesImported:"Messages Imports",messagesExported:"Messages Exports",activeConnections:"Connexions Actives",connected:"Connect",disconnected:"Dconnect",connectToService:"Se connecter  {{service}}",phoneNumber:"Numro de tlphone",connect:"Se connecter",importMessages:"Importer des messages",contactId:"ID du contact",importLimit:"Limite d'importation",startImport:"Dmarrer l'importation",settings:"Paramtres",autoImport:"Importation automatique",autoExport:"Exportation automatique",disconnect:"Se dconnecter",securityNote:"Note de scurit",whatsappSecurity:"La connexion  WhatsApp utilise des mthodes scurises. Vos donnes restent prives.",importSuccess:"Importation russie !",importFailed:"chec de l'importation",connectedDescription:"Connect et synchronis avec WhatsApp",disconnectedDescription:"Non connect  WhatsApp"},kX={dashboardTitle:"Arcade Sociale",dashboardSubtitle:"Gagnez des points, dbloquez des succs et montez en niveau!",levelProgress:"Progression du Niveau",achievements:"Succs",unlocked:"dbloqus",nextAchievements:"Prochains Succs  Dbloquer",streak:"Srie",points:"Points",rank:"Rang",ranks:{bronze:"Bronze",silver:"Argent",gold:"Or",platinum:"Platine",diamond:"Diamant"},dailyQuests:"Qutes Quotidiennes",leaderboard:"Classement",quests:{sendMessages:"Envoyer 10 messages",makeCalls:"Faire 3 appels",shareFiles:"Partager 5 fichiers",useAI:"Utiliser l'IA 5 fois",secureAccount:"Scuriser votre compte"}},CX={voiceRooms:"Salons Vocaux",communityEvents:"vnements Communautaires",createRoom:"Crer un Salon",joinRoom:"Rejoindre",leaveRoom:"Quitter",participants:"Participants",upcomingEvents:"vnements  Venir",hostEvent:"Organiser un vnement"},NX={dashboardTitle:"Analytics Avances",dashboardSubtitle:"Insights dtaills sur votre activit de communication",generatingReport:"Gnration du rapport...",noDataTitle:"Aucune donne d'analyse",noDataDescription:"Commencez  utiliser l'application pour gnrer vos premires analyses",generateFirstReport:"Gnrer mon premier rapport",refresh:"Actualiser",overallScore:"Score Global",generatedOn:"Gnr le",overview:"Vue d'ensemble",relationships:"Relations",productivity:"Productivit",mood:"Humeur",goals:"Objectifs",privacyMinimal:"Confidentialit Maximale",privacyBalanced:"quilibre",privacyDetailed:"Analyses Dtailles",totalMessages:"Messages Totaux",contacts:"Contacts",timeSpent:"Temps Pass",wellbeingScore:"Bien-tre"},TX={title:"Plans et Tarifs",subtitle:"Choisissez le plan qui correspond le mieux  vos besoins",monthly:"Mensuel",yearly:"Annuel (-20%)",currentPlan:"Plan Actuel",subscribe:"S'abonner",contactSales:"Contacter les ventes",recommended:"Recommand",month:"mois",year:"an",features:{unlimitedBridges:"Ponts illimits",storage:"{{amount}}GB de stockage",prioritySupport:"Support prioritaire",advancedAI:"IA Avance",offlineMode:"Mode hors ligne",advancedAnalytics:"Analytiques avances",sso:"SSO & Scurit avance",dedicatedManager:"Gestionnaire de compte ddi",sla:"SLA garanti"},tiers:{free:{name:"Gratuit",description:"Pour les individus et les petits projets"},pro:{name:"Pro",description:"Pour les professionnels et les crateurs"},enterprise:{name:"Entreprise",description:"Pour les grandes quipes et organisations"}},upgrade:{title:"Fonctionnalit Premium",message:"Passez  la version Pro pour dbloquer cette fonctionnalit.",cta:"Voir les plans"}},EX={common:pX,auth:mX,chat:gX,calls:yX,ai:xX,files:bX,settings:vX,security:wX,bridge:SX,gamification:kX,social:CX,analytics:NX,subscription:TX},IX={},AX={},$X={},RX={save:"",cancel:"",delete:"",edit:"",send:"",search:"",loading:" ...",error:"",success:""},DX={login:" ",logout:" ",signup:" ",email:" ",password:" ",username:" ",confirmPassword:"  ",forgotPassword:"  ",noAccount:"  ",hasAccount:"  ",welcome:"   Palfrog",secureChat:"     "},OX={messages:"",contacts:" ",typeMessage:" ...",online:"",offline:" ",typing:"{{user}} ...",encryptionActive:"  ",encryptionPending:"  ...",newMessage:"   {{user}}"},MX={incomingCall:" ",outgoingCall:" ",audioCall:" ",videoCall:" ",accept:"",reject:"",endCall:" ",mute:" ",unmute:"  ",videoOn:" ",videoOff:" ",screenShare:" "},PX={sendFile:" ",fileTooLarge:"  .  : {{size}} ",transferProgress:" ",transferComplete:" ",transferFailed:" ",download:""},LX={settings:"",language:"",theme:"",notifications:"",security:"",privacy:""},FX={encryption:"",endToEndEncryption:"    ",regenerateKeys:"  ",backupKeys:"  ",twoFactorAuth:" ",twoFactorEnabled:"   ",scanQRCode:"       ",enable2FA:"  ",scanWithAuthenticator:"  Google Authenticator  Authy",enterVerificationCode:"  ",verifyAndEnable:" ",invalidCode:"  "},_X={common:RX,auth:DX,chat:OX,calls:MX,files:PX,settings:LX,security:FX},zX={},BX={en:{translation:fX},fr:{translation:EX},es:{translation:IX},de:{translation:AX},it:{translation:$X},ar:{translation:_X},fa:{translation:zX}};Cs.use(Y_).use(f7).init({resources:BX,fallbackLng:"en",debug:!1,interpolation:{escapeValue:!1},detection:{order:["localStorage","navigator","htmlTag"],caches:["localStorage"]},react:{useSuspense:!0}});const CR=t=>["ar","fa"].includes(t),Er=()=>{var i;const{t,i18n:e}=y7(),n=z.useCallback(o=>{e.changeLanguage(o),document.documentElement.dir=CR(o)?"rtl":"ltr",document.documentElement.lang=o,localStorage.setItem("palfrog-language",o)},[e]),s=(i=e.language)==null?void 0:i.split("-")[0],r=CR(s)?"rtl":"ltr";return{t,changeLanguage:n,currentLanguage:s,direction:r,isRTL:r==="rtl",availableLanguages:[{code:"en",name:"English",nativeName:"English"},{code:"fr",name:"French",nativeName:"Franais"},{code:"es",name:"Spanish",nativeName:"Espaol"},{code:"de",name:"German",nativeName:"Deutsch"},{code:"it",name:"Italian",nativeName:"Italiano"},{code:"ar",name:"Arabic",nativeName:""},{code:"fa",name:"Persian",nativeName:""}]}},jX=()=>{const{currentLanguage:t,changeLanguage:e,availableLanguages:n}=Er(),[s,r]=z.useState(!1),i=z.useRef(null);return z.useEffect(()=>{const o=a=>{i.current&&!i.current.contains(a.target)&&r(!1)};return document.addEventListener("mousedown",o),()=>document.removeEventListener("mousedown",o)},[]),b.jsxs("div",{className:"relative",ref:i,children:[b.jsxs("button",{onClick:()=>r(!s),className:"flex items-center space-x-1 p-2 rounded-lg hover:bg-gray-100 transition-colors",title:"Change language",children:[b.jsx("span",{className:"text-xl",children:""}),b.jsx("span",{className:"text-sm font-medium text-gray-700 uppercase hidden sm:inline-block",children:t})]}),s&&b.jsx("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-xl shadow-lg border border-gray-100 py-1 z-50",children:n.map(o=>b.jsxs("button",{onClick:()=>{e(o.code),r(!1)},className:`w-full text-left px-4 py-2 text-sm hover:bg-gray-50 flex items-center justify-between ${t===o.code?"text-primary-600 font-medium bg-primary-50":"text-gray-700"}`,children:[b.jsx("span",{children:o.nativeName}),t===o.code&&b.jsx("span",{children:""})]},o.code))})]})},mu={online:{label:"En ligne",icon:"",color:"text-green-500"},busy:{label:"Occup(e)",icon:"",color:"text-red-500"},away:{label:"Absent(e)",icon:"",color:"text-yellow-500"},dnd:{label:"Ne pas dranger",icon:"",color:"text-red-600"},offline:{label:"Hors ligne",icon:"",color:"text-gray-500"}},VX=()=>{const{user:t,setStatus:e}=_t(),[n,s]=z.useState(!1),r=z.useRef(null),i=(t==null?void 0:t.status)||"online";z.useEffect(()=>{const a=l=>{r.current&&!r.current.contains(l.target)&&s(!1)};return n&&document.addEventListener("mousedown",a),()=>{document.removeEventListener("mousedown",a)}},[n]);const o=a=>{e(a),s(!1)};return b.jsxs("div",{className:"relative",ref:r,children:[b.jsxs("button",{onClick:()=>s(!n),className:"flex items-center space-x-2 px-3 py-1.5 rounded-full hover:bg-gray-100 transition-colors duration-200 border border-transparent hover:border-gray-200",title:"Changer de statut",children:[b.jsx("span",{className:"text-lg leading-none",children:mu[i].icon}),b.jsx("span",{className:`text-sm font-medium hidden md:block ${mu[i].color}`,children:mu[i].label}),b.jsx("svg",{className:`w-4 h-4 text-gray-400 transition-transform duration-200 ${n?"transform rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:b.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),n&&b.jsx("div",{className:"absolute right-0 mt-2 w-56 bg-white rounded-xl shadow-xl border border-gray-100 overflow-hidden z-50 animate-fade-in-up",children:b.jsx("div",{className:"py-1",children:Object.keys(mu).map(a=>b.jsxs("button",{onClick:()=>o(a),className:`w-full px-4 py-2.5 text-left text-sm flex items-center space-x-3 hover:bg-gray-50 transition-colors duration-150
                                    ${i===a?"bg-blue-50/50":""}
                                `,children:[b.jsx("span",{className:"text-lg",children:mu[a].icon}),b.jsx("span",{className:`font-medium ${i===a?"text-gray-900":"text-gray-700"}`,children:mu[a].label}),i===a&&b.jsx("span",{className:"ml-auto text-blue-500",children:b.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:b.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})]},a))})})]})},fo=Object.create(null);fo.open="0";fo.close="1";fo.ping="2";fo.pong="3";fo.message="4";fo.upgrade="5";fo.noop="6";const Sy=Object.create(null);Object.keys(fo).forEach(t=>{Sy[fo[t]]=t});const gk={type:"error",data:"parser error"},Q_=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",Z_=typeof ArrayBuffer=="function",e3=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer,fT=({type:t,data:e},n,s)=>Q_&&e instanceof Blob?n?s(e):NR(e,s):Z_&&(e instanceof ArrayBuffer||e3(e))?n?s(e):NR(new Blob([e]),s):s(fo[t]+(e||"")),NR=(t,e)=>{const n=new FileReader;return n.onload=function(){const s=n.result.split(",")[1];e("b"+(s||""))},n.readAsDataURL(t)};function TR(t){return t instanceof Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}let ew;function UX(t,e){if(Q_&&t.data instanceof Blob)return t.data.arrayBuffer().then(TR).then(e);if(Z_&&(t.data instanceof ArrayBuffer||e3(t.data)))return e(TR(t.data));fT(t,!1,n=>{ew||(ew=new TextEncoder),e(ew.encode(n))})}const ER="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Bh=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let t=0;t<ER.length;t++)Bh[ER.charCodeAt(t)]=t;const WX=t=>{let e=t.length*.75,n=t.length,s,r=0,i,o,a,l;t[t.length-1]==="="&&(e--,t[t.length-2]==="="&&e--);const c=new ArrayBuffer(e),u=new Uint8Array(c);for(s=0;s<n;s+=4)i=Bh[t.charCodeAt(s)],o=Bh[t.charCodeAt(s+1)],a=Bh[t.charCodeAt(s+2)],l=Bh[t.charCodeAt(s+3)],u[r++]=i<<2|o>>4,u[r++]=(o&15)<<4|a>>2,u[r++]=(a&3)<<6|l&63;return c},HX=typeof ArrayBuffer=="function",pT=(t,e)=>{if(typeof t!="string")return{type:"message",data:t3(t,e)};const n=t.charAt(0);return n==="b"?{type:"message",data:GX(t.substring(1),e)}:Sy[n]?t.length>1?{type:Sy[n],data:t.substring(1)}:{type:Sy[n]}:gk},GX=(t,e)=>{if(HX){const n=WX(t);return t3(n,e)}else return{base64:!0,data:t}},t3=(t,e)=>{switch(e){case"blob":return t instanceof Blob?t:new Blob([t]);case"arraybuffer":default:return t instanceof ArrayBuffer?t:t.buffer}},n3=String.fromCharCode(30),KX=(t,e)=>{const n=t.length,s=new Array(n);let r=0;t.forEach((i,o)=>{fT(i,!1,a=>{s[o]=a,++r===n&&e(s.join(n3))})})},qX=(t,e)=>{const n=t.split(n3),s=[];for(let r=0;r<n.length;r++){const i=pT(n[r],e);if(s.push(i),i.type==="error")break}return s};function XX(){return new TransformStream({transform(t,e){UX(t,n=>{const s=n.length;let r;if(s<126)r=new Uint8Array(1),new DataView(r.buffer).setUint8(0,s);else if(s<65536){r=new Uint8Array(3);const i=new DataView(r.buffer);i.setUint8(0,126),i.setUint16(1,s)}else{r=new Uint8Array(9);const i=new DataView(r.buffer);i.setUint8(0,127),i.setBigUint64(1,BigInt(s))}t.data&&typeof t.data!="string"&&(r[0]|=128),e.enqueue(r),e.enqueue(n)})}})}let tw;function kg(t){return t.reduce((e,n)=>e+n.length,0)}function Cg(t,e){if(t[0].length===e)return t.shift();const n=new Uint8Array(e);let s=0;for(let r=0;r<e;r++)n[r]=t[0][s++],s===t[0].length&&(t.shift(),s=0);return t.length&&s<t[0].length&&(t[0]=t[0].slice(s)),n}function JX(t,e){tw||(tw=new TextDecoder);const n=[];let s=0,r=-1,i=!1;return new TransformStream({transform(o,a){for(n.push(o);;){if(s===0){if(kg(n)<1)break;const l=Cg(n,1);i=(l[0]&128)===128,r=l[0]&127,r<126?s=3:r===126?s=1:s=2}else if(s===1){if(kg(n)<2)break;const l=Cg(n,2);r=new DataView(l.buffer,l.byteOffset,l.length).getUint16(0),s=3}else if(s===2){if(kg(n)<8)break;const l=Cg(n,8),c=new DataView(l.buffer,l.byteOffset,l.length),u=c.getUint32(0);if(u>Math.pow(2,53-32)-1){a.enqueue(gk);break}r=u*Math.pow(2,32)+c.getUint32(4),s=3}else{if(kg(n)<r)break;const l=Cg(n,r);a.enqueue(pT(i?l:tw.decode(l),e)),s=0}if(r===0||r>t){a.enqueue(gk);break}}}})}const s3=4;function gn(t){if(t)return YX(t)}function YX(t){for(var e in gn.prototype)t[e]=gn.prototype[e];return t}gn.prototype.on=gn.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this};gn.prototype.once=function(t,e){function n(){this.off(t,n),e.apply(this,arguments)}return n.fn=e,this.on(t,n),this};gn.prototype.off=gn.prototype.removeListener=gn.prototype.removeAllListeners=gn.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var n=this._callbacks["$"+t];if(!n)return this;if(arguments.length==1)return delete this._callbacks["$"+t],this;for(var s,r=0;r<n.length;r++)if(s=n[r],s===e||s.fn===e){n.splice(r,1);break}return n.length===0&&delete this._callbacks["$"+t],this};gn.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),n=this._callbacks["$"+t],s=1;s<arguments.length;s++)e[s-1]=arguments[s];if(n){n=n.slice(0);for(var s=0,r=n.length;s<r;++s)n[s].apply(this,e)}return this};gn.prototype.emitReserved=gn.prototype.emit;gn.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]};gn.prototype.hasListeners=function(t){return!!this.listeners(t).length};const hb=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,n)=>n(e,0))(),Ur=(()=>typeof self<"u"?self:typeof window<"u"?window:Function("return this")())(),QX="arraybuffer";function r3(t,...e){return e.reduce((n,s)=>(t.hasOwnProperty(s)&&(n[s]=t[s]),n),{})}const ZX=Ur.setTimeout,eJ=Ur.clearTimeout;function fb(t,e){e.useNativeTimers?(t.setTimeoutFn=ZX.bind(Ur),t.clearTimeoutFn=eJ.bind(Ur)):(t.setTimeoutFn=Ur.setTimeout.bind(Ur),t.clearTimeoutFn=Ur.clearTimeout.bind(Ur))}const tJ=1.33;function nJ(t){return typeof t=="string"?sJ(t):Math.ceil((t.byteLength||t.size)*tJ)}function sJ(t){let e=0,n=0;for(let s=0,r=t.length;s<r;s++)e=t.charCodeAt(s),e<128?n+=1:e<2048?n+=2:e<55296||e>=57344?n+=3:(s++,n+=4);return n}function i3(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function rJ(t){let e="";for(let n in t)t.hasOwnProperty(n)&&(e.length&&(e+="&"),e+=encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e}function iJ(t){let e={},n=t.split("&");for(let s=0,r=n.length;s<r;s++){let i=n[s].split("=");e[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return e}class oJ extends Error{constructor(e,n,s){super(e),this.description=n,this.context=s,this.type="TransportError"}}class mT extends gn{constructor(e){super(),this.writable=!1,fb(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,n,s){return super.emitReserved("error",new oJ(e,n,s)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const n=pT(e,this.socket.binaryType);this.onPacket(n)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,n={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(n)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const n=rJ(e);return n.length?"?"+n:""}}class aJ extends mT{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const n=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let s=0;this._polling&&(s++,this.once("pollComplete",function(){--s||n()})),this.writable||(s++,this.once("drain",function(){--s||n()}))}else n()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const n=s=>{if(this.readyState==="opening"&&s.type==="open"&&this.onOpen(),s.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(s)};qX(e,this.socket.binaryType).forEach(n),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,KX(e,n=>{this.doWrite(n,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",n=this.query||{};return this.opts.timestampRequests!==!1&&(n[this.opts.timestampParam]=i3()),!this.supportsBinary&&!n.sid&&(n.b64=1),this.createUri(e,n)}}let o3=!1;try{o3=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const lJ=o3;function cJ(){}class uJ extends aJ{constructor(e){if(super(e),typeof location<"u"){const n=location.protocol==="https:";let s=location.port;s||(s=n?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||s!==e.port}}doWrite(e,n){const s=this.request({method:"POST",data:e});s.on("success",n),s.on("error",(r,i)=>{this.onError("xhr post error",r,i)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(n,s)=>{this.onError("xhr poll error",n,s)}),this.pollXhr=e}}class ro extends gn{constructor(e,n,s){super(),this.createRequest=e,fb(this,s),this._opts=s,this._method=s.method||"GET",this._uri=n,this._data=s.data!==void 0?s.data:null,this._create()}_create(){var e;const n=r3(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");n.xdomain=!!this._opts.xd;const s=this._xhr=this.createRequest(n);try{s.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){s.setDisableHeaderCheck&&s.setDisableHeaderCheck(!0);for(let r in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(r)&&s.setRequestHeader(r,this._opts.extraHeaders[r])}}catch{}if(this._method==="POST")try{s.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{s.setRequestHeader("Accept","*/*")}catch{}(e=this._opts.cookieJar)===null||e===void 0||e.addCookies(s),"withCredentials"in s&&(s.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(s.timeout=this._opts.requestTimeout),s.onreadystatechange=()=>{var r;s.readyState===3&&((r=this._opts.cookieJar)===null||r===void 0||r.parseCookies(s.getResponseHeader("set-cookie"))),s.readyState===4&&(s.status===200||s.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof s.status=="number"?s.status:0)},0))},s.send(this._data)}catch(r){this.setTimeoutFn(()=>{this._onError(r)},0);return}typeof document<"u"&&(this._index=ro.requestsCount++,ro.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=cJ,e)try{this._xhr.abort()}catch{}typeof document<"u"&&delete ro.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}ro.requestsCount=0;ro.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",IR);else if(typeof addEventListener=="function"){const t="onpagehide"in Ur?"pagehide":"unload";addEventListener(t,IR,!1)}}function IR(){for(let t in ro.requests)ro.requests.hasOwnProperty(t)&&ro.requests[t].abort()}const dJ=function(){const t=a3({xdomain:!1});return t&&t.responseType!==null}();class hJ extends uJ{constructor(e){super(e);const n=e&&e.forceBase64;this.supportsBinary=dJ&&!n}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new ro(a3,this.uri(),e)}}function a3(t){const e=t.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||lJ))return new XMLHttpRequest}catch{}if(!e)try{return new Ur[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const l3=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class fJ extends mT{get name(){return"websocket"}doOpen(){const e=this.uri(),n=this.opts.protocols,s=l3?{}:r3(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(s.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,n,s)}catch(r){return this.emitReserved("error",r)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let n=0;n<e.length;n++){const s=e[n],r=n===e.length-1;fT(s,this.supportsBinary,i=>{try{this.doWrite(s,i)}catch{}r&&hb(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",n=this.query||{};return this.opts.timestampRequests&&(n[this.opts.timestampParam]=i3()),this.supportsBinary||(n.b64=1),this.createUri(e,n)}}const nw=Ur.WebSocket||Ur.MozWebSocket;let pJ=class extends fJ{createSocket(e,n,s){return l3?new nw(e,n,s):n?new nw(e,n):new nw(e)}doWrite(e,n){this.ws.send(n)}};class mJ extends mT{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const n=JX(Number.MAX_SAFE_INTEGER,this.socket.binaryType),s=e.readable.pipeThrough(n).getReader(),r=XX();r.readable.pipeTo(e.writable),this._writer=r.writable.getWriter();const i=()=>{s.read().then(({done:a,value:l})=>{a||(this.onPacket(l),i())}).catch(a=>{})};i();const o={type:"open"};this.query.sid&&(o.data=`{"sid":"${this.query.sid}"}`),this._writer.write(o).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let n=0;n<e.length;n++){const s=e[n],r=n===e.length-1;this._writer.write(s).then(()=>{r&&hb(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this._transport)===null||e===void 0||e.close()}}const gJ={websocket:pJ,webtransport:mJ,polling:hJ},yJ=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,xJ=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function yk(t){if(t.length>8e3)throw"URI too long";const e=t,n=t.indexOf("["),s=t.indexOf("]");n!=-1&&s!=-1&&(t=t.substring(0,n)+t.substring(n,s).replace(/:/g,";")+t.substring(s,t.length));let r=yJ.exec(t||""),i={},o=14;for(;o--;)i[xJ[o]]=r[o]||"";return n!=-1&&s!=-1&&(i.source=e,i.host=i.host.substring(1,i.host.length-1).replace(/;/g,":"),i.authority=i.authority.replace("[","").replace("]","").replace(/;/g,":"),i.ipv6uri=!0),i.pathNames=bJ(i,i.path),i.queryKey=vJ(i,i.query),i}function bJ(t,e){const n=/\/{2,9}/g,s=e.replace(n,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&s.splice(0,1),e.slice(-1)=="/"&&s.splice(s.length-1,1),s}function vJ(t,e){const n={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(s,r,i){r&&(n[r]=i)}),n}const xk=typeof addEventListener=="function"&&typeof removeEventListener=="function",ky=[];xk&&addEventListener("offline",()=>{ky.forEach(t=>t())},!1);class Ha extends gn{constructor(e,n){if(super(),this.binaryType=QX,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&typeof e=="object"&&(n=e,e=null),e){const s=yk(e);n.hostname=s.host,n.secure=s.protocol==="https"||s.protocol==="wss",n.port=s.port,s.query&&(n.query=s.query)}else n.host&&(n.hostname=yk(n.host).host);fb(this,n),this.secure=n.secure!=null?n.secure:typeof location<"u"&&location.protocol==="https:",n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.hostname=n.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=n.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},n.transports.forEach(s=>{const r=s.prototype.name;this.transports.push(r),this._transportsByName[r]=s}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},n),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=iJ(this.opts.query)),xk&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},ky.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const n=Object.assign({},this.opts.query);n.EIO=s3,n.transport=e,this.id&&(n.sid=this.id);const s=Object.assign({},this.opts,{query:n,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](s)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const e=this.opts.rememberUpgrade&&Ha.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const n=this.createTransport(e);n.open(),this.setTransport(n)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",n=>this._onClose("transport close",n))}onOpen(){this.readyState="open",Ha.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const n=new Error("server error");n.code=e.data,this._onError(n);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let n=1;for(let s=0;s<this.writeBuffer.length;s++){const r=this.writeBuffer[s].data;if(r&&(n+=nJ(r)),s>0&&n>this._maxPayload)return this.writeBuffer.slice(0,s);n+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,hb(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,n,s){return this._sendPacket("message",e,n,s),this}send(e,n,s){return this._sendPacket("message",e,n,s),this}_sendPacket(e,n,s,r){if(typeof n=="function"&&(r=n,n=void 0),typeof s=="function"&&(r=s,s=null),this.readyState==="closing"||this.readyState==="closed")return;s=s||{},s.compress=s.compress!==!1;const i={type:e,data:n,options:s};this.emitReserved("packetCreate",i),this.writeBuffer.push(i),r&&this.once("flush",r),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},n=()=>{this.off("upgrade",n),this.off("upgradeError",n),e()},s=()=>{this.once("upgrade",n),this.once("upgradeError",n)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?s():e()}):this.upgrading?s():e()),this}_onError(e){if(Ha.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,n){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),xk&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const s=ky.indexOf(this._offlineEventListener);s!==-1&&ky.splice(s,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,n),this.writeBuffer=[],this._prevBufferLen=0}}}Ha.protocol=s3;class wJ extends Ha{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let n=this.createTransport(e),s=!1;Ha.priorWebsocketSuccess=!1;const r=()=>{s||(n.send([{type:"ping",data:"probe"}]),n.once("packet",d=>{if(!s)if(d.type==="pong"&&d.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",n),!n)return;Ha.priorWebsocketSuccess=n.name==="websocket",this.transport.pause(()=>{s||this.readyState!=="closed"&&(u(),this.setTransport(n),n.send([{type:"upgrade"}]),this.emitReserved("upgrade",n),n=null,this.upgrading=!1,this.flush())})}else{const h=new Error("probe error");h.transport=n.name,this.emitReserved("upgradeError",h)}}))};function i(){s||(s=!0,u(),n.close(),n=null)}const o=d=>{const h=new Error("probe error: "+d);h.transport=n.name,i(),this.emitReserved("upgradeError",h)};function a(){o("transport closed")}function l(){o("socket closed")}function c(d){n&&d.name!==n.name&&i()}const u=()=>{n.removeListener("open",r),n.removeListener("error",o),n.removeListener("close",a),this.off("close",l),this.off("upgrading",c)};n.once("open",r),n.once("error",o),n.once("close",a),this.once("close",l),this.once("upgrading",c),this._upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{s||n.open()},200):n.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const n=[];for(let s=0;s<e.length;s++)~this.transports.indexOf(e[s])&&n.push(e[s]);return n}}let SJ=class extends wJ{constructor(e,n={}){const s=typeof e=="object"?e:n;(!s.transports||s.transports&&typeof s.transports[0]=="string")&&(s.transports=(s.transports||["polling","websocket","webtransport"]).map(r=>gJ[r]).filter(r=>!!r)),super(e,s)}};function kJ(t,e="",n){let s=t;n=n||typeof location<"u"&&location,t==null&&(t=n.protocol+"//"+n.host),typeof t=="string"&&(t.charAt(0)==="/"&&(t.charAt(1)==="/"?t=n.protocol+t:t=n.host+t),/^(https?|wss?):\/\//.test(t)||(typeof n<"u"?t=n.protocol+"//"+t:t="https://"+t),s=yk(t)),s.port||(/^(http|ws)$/.test(s.protocol)?s.port="80":/^(http|ws)s$/.test(s.protocol)&&(s.port="443")),s.path=s.path||"/";const i=s.host.indexOf(":")!==-1?"["+s.host+"]":s.host;return s.id=s.protocol+"://"+i+":"+s.port+e,s.href=s.protocol+"://"+i+(n&&n.port===s.port?"":":"+s.port),s}const CJ=typeof ArrayBuffer=="function",NJ=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer,c3=Object.prototype.toString,TJ=typeof Blob=="function"||typeof Blob<"u"&&c3.call(Blob)==="[object BlobConstructor]",EJ=typeof File=="function"||typeof File<"u"&&c3.call(File)==="[object FileConstructor]";function gT(t){return CJ&&(t instanceof ArrayBuffer||NJ(t))||TJ&&t instanceof Blob||EJ&&t instanceof File}function Cy(t,e){if(!t||typeof t!="object")return!1;if(Array.isArray(t)){for(let n=0,s=t.length;n<s;n++)if(Cy(t[n]))return!0;return!1}if(gT(t))return!0;if(t.toJSON&&typeof t.toJSON=="function"&&arguments.length===1)return Cy(t.toJSON(),!0);for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&Cy(t[n]))return!0;return!1}function IJ(t){const e=[],n=t.data,s=t;return s.data=bk(n,e),s.attachments=e.length,{packet:s,buffers:e}}function bk(t,e){if(!t)return t;if(gT(t)){const n={_placeholder:!0,num:e.length};return e.push(t),n}else if(Array.isArray(t)){const n=new Array(t.length);for(let s=0;s<t.length;s++)n[s]=bk(t[s],e);return n}else if(typeof t=="object"&&!(t instanceof Date)){const n={};for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&(n[s]=bk(t[s],e));return n}return t}function AJ(t,e){return t.data=vk(t.data,e),delete t.attachments,t}function vk(t,e){if(!t)return t;if(t&&t._placeholder===!0){if(typeof t.num=="number"&&t.num>=0&&t.num<e.length)return e[t.num];throw new Error("illegal attachments")}else if(Array.isArray(t))for(let n=0;n<t.length;n++)t[n]=vk(t[n],e);else if(typeof t=="object")for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(t[n]=vk(t[n],e));return t}const $J=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],RJ=5;var tt;(function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.CONNECT_ERROR=4]="CONNECT_ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"})(tt||(tt={}));class DJ{constructor(e){this.replacer=e}encode(e){return(e.type===tt.EVENT||e.type===tt.ACK)&&Cy(e)?this.encodeAsBinary({type:e.type===tt.EVENT?tt.BINARY_EVENT:tt.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let n=""+e.type;return(e.type===tt.BINARY_EVENT||e.type===tt.BINARY_ACK)&&(n+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(n+=e.nsp+","),e.id!=null&&(n+=e.id),e.data!=null&&(n+=JSON.stringify(e.data,this.replacer)),n}encodeAsBinary(e){const n=IJ(e),s=this.encodeAsString(n.packet),r=n.buffers;return r.unshift(s),r}}function AR(t){return Object.prototype.toString.call(t)==="[object Object]"}class yT extends gn{constructor(e){super(),this.reviver=e}add(e){let n;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");n=this.decodeString(e);const s=n.type===tt.BINARY_EVENT;s||n.type===tt.BINARY_ACK?(n.type=s?tt.EVENT:tt.ACK,this.reconstructor=new OJ(n),n.attachments===0&&super.emitReserved("decoded",n)):super.emitReserved("decoded",n)}else if(gT(e)||e.base64)if(this.reconstructor)n=this.reconstructor.takeBinaryData(e),n&&(this.reconstructor=null,super.emitReserved("decoded",n));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let n=0;const s={type:Number(e.charAt(0))};if(tt[s.type]===void 0)throw new Error("unknown packet type "+s.type);if(s.type===tt.BINARY_EVENT||s.type===tt.BINARY_ACK){const i=n+1;for(;e.charAt(++n)!=="-"&&n!=e.length;);const o=e.substring(i,n);if(o!=Number(o)||e.charAt(n)!=="-")throw new Error("Illegal attachments");s.attachments=Number(o)}if(e.charAt(n+1)==="/"){const i=n+1;for(;++n&&!(e.charAt(n)===","||n===e.length););s.nsp=e.substring(i,n)}else s.nsp="/";const r=e.charAt(n+1);if(r!==""&&Number(r)==r){const i=n+1;for(;++n;){const o=e.charAt(n);if(o==null||Number(o)!=o){--n;break}if(n===e.length)break}s.id=Number(e.substring(i,n+1))}if(e.charAt(++n)){const i=this.tryParse(e.substr(n));if(yT.isPayloadValid(s.type,i))s.data=i;else throw new Error("invalid payload")}return s}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,n){switch(e){case tt.CONNECT:return AR(n);case tt.DISCONNECT:return n===void 0;case tt.CONNECT_ERROR:return typeof n=="string"||AR(n);case tt.EVENT:case tt.BINARY_EVENT:return Array.isArray(n)&&(typeof n[0]=="number"||typeof n[0]=="string"&&$J.indexOf(n[0])===-1);case tt.ACK:case tt.BINARY_ACK:return Array.isArray(n)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class OJ{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const n=AJ(this.reconPack,this.buffers);return this.finishedReconstruction(),n}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const MJ=Object.freeze(Object.defineProperty({__proto__:null,Decoder:yT,Encoder:DJ,get PacketType(){return tt},protocol:RJ},Symbol.toStringTag,{value:"Module"}));function yi(t,e,n){return t.on(e,n),function(){t.off(e,n)}}const PJ=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class u3 extends gn{constructor(e,n,s){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=n,s&&s.auth&&(this.auth=s.auth),this._opts=Object.assign({},s),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[yi(e,"open",this.onopen.bind(this)),yi(e,"packet",this.onpacket.bind(this)),yi(e,"error",this.onerror.bind(this)),yi(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...n){var s,r,i;if(PJ.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(n.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(n),this;const o={type:tt.EVENT,data:n};if(o.options={},o.options.compress=this.flags.compress!==!1,typeof n[n.length-1]=="function"){const u=this.ids++,d=n.pop();this._registerAckCallback(u,d),o.id=u}const a=(r=(s=this.io.engine)===null||s===void 0?void 0:s.transport)===null||r===void 0?void 0:r.writable,l=this.connected&&!(!((i=this.io.engine)===null||i===void 0)&&i._hasPingExpired());return this.flags.volatile&&!a||(l?(this.notifyOutgoingListeners(o),this.packet(o)):this.sendBuffer.push(o)),this.flags={},this}_registerAckCallback(e,n){var s;const r=(s=this.flags.timeout)!==null&&s!==void 0?s:this._opts.ackTimeout;if(r===void 0){this.acks[e]=n;return}const i=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let a=0;a<this.sendBuffer.length;a++)this.sendBuffer[a].id===e&&this.sendBuffer.splice(a,1);n.call(this,new Error("operation has timed out"))},r),o=(...a)=>{this.io.clearTimeoutFn(i),n.apply(this,a)};o.withError=!0,this.acks[e]=o}emitWithAck(e,...n){return new Promise((s,r)=>{const i=(o,a)=>o?r(o):s(a);i.withError=!0,n.push(i),this.emit(e,...n)})}_addToQueue(e){let n;typeof e[e.length-1]=="function"&&(n=e.pop());const s={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((r,...i)=>s!==this._queue[0]?void 0:(r!==null?s.tryCount>this._opts.retries&&(this._queue.shift(),n&&n(r)):(this._queue.shift(),n&&n(null,...i)),s.pending=!1,this._drainQueue())),this._queue.push(s),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const n=this._queue[0];n.pending&&!e||(n.pending=!0,n.tryCount++,this.flags=n.flags,this.emit.apply(this,n.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:tt.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,n){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,n),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(s=>String(s.id)===e)){const s=this.acks[e];delete this.acks[e],s.withError&&s.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case tt.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case tt.EVENT:case tt.BINARY_EVENT:this.onevent(e);break;case tt.ACK:case tt.BINARY_ACK:this.onack(e);break;case tt.DISCONNECT:this.ondisconnect();break;case tt.CONNECT_ERROR:this.destroy();const s=new Error(e.data.message);s.data=e.data.data,this.emitReserved("connect_error",s);break}}onevent(e){const n=e.data||[];e.id!=null&&n.push(this.ack(e.id)),this.connected?this.emitEvent(n):this.receiveBuffer.push(Object.freeze(n))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const n=this._anyListeners.slice();for(const s of n)s.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const n=this;let s=!1;return function(...r){s||(s=!0,n.packet({type:tt.ACK,id:e,data:r}))}}onack(e){const n=this.acks[e.id];typeof n=="function"&&(delete this.acks[e.id],n.withError&&e.data.unshift(null),n.apply(this,e.data))}onconnect(e,n){this.id=e,this.recovered=n&&this._pid===n,this._pid=n,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:tt.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const n=this._anyListeners;for(let s=0;s<n.length;s++)if(e===n[s])return n.splice(s,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const n=this._anyOutgoingListeners;for(let s=0;s<n.length;s++)if(e===n[s])return n.splice(s,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const n=this._anyOutgoingListeners.slice();for(const s of n)s.apply(this,e.data)}}}function Hd(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}Hd.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),n=Math.floor(e*this.jitter*t);t=Math.floor(e*10)&1?t+n:t-n}return Math.min(t,this.max)|0};Hd.prototype.reset=function(){this.attempts=0};Hd.prototype.setMin=function(t){this.ms=t};Hd.prototype.setMax=function(t){this.max=t};Hd.prototype.setJitter=function(t){this.jitter=t};class wk extends gn{constructor(e,n){var s;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(n=e,e=void 0),n=n||{},n.path=n.path||"/socket.io",this.opts=n,fb(this,n),this.reconnection(n.reconnection!==!1),this.reconnectionAttempts(n.reconnectionAttempts||1/0),this.reconnectionDelay(n.reconnectionDelay||1e3),this.reconnectionDelayMax(n.reconnectionDelayMax||5e3),this.randomizationFactor((s=n.randomizationFactor)!==null&&s!==void 0?s:.5),this.backoff=new Hd({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(n.timeout==null?2e4:n.timeout),this._readyState="closed",this.uri=e;const r=n.parser||MJ;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this._autoConnect=n.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var n;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(n=this.backoff)===null||n===void 0||n.setMin(e),this)}randomizationFactor(e){var n;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(n=this.backoff)===null||n===void 0||n.setJitter(e),this)}reconnectionDelayMax(e){var n;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(n=this.backoff)===null||n===void 0||n.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new SJ(this.uri,this.opts);const n=this.engine,s=this;this._readyState="opening",this.skipReconnect=!1;const r=yi(n,"open",function(){s.onopen(),e&&e()}),i=a=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",a),e?e(a):this.maybeReconnectOnOpen()},o=yi(n,"error",i);if(this._timeout!==!1){const a=this._timeout,l=this.setTimeoutFn(()=>{r(),i(new Error("timeout")),n.close()},a);this.opts.autoUnref&&l.unref(),this.subs.push(()=>{this.clearTimeoutFn(l)})}return this.subs.push(r),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(yi(e,"ping",this.onping.bind(this)),yi(e,"data",this.ondata.bind(this)),yi(e,"error",this.onerror.bind(this)),yi(e,"close",this.onclose.bind(this)),yi(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(n){this.onclose("parse error",n)}}ondecoded(e){hb(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,n){let s=this.nsps[e];return s?this._autoConnect&&!s.active&&s.connect():(s=new u3(this,e,n),this.nsps[e]=s),s}_destroy(e){const n=Object.keys(this.nsps);for(const s of n)if(this.nsps[s].active)return;this._close()}_packet(e){const n=this.encoder.encode(e);for(let s=0;s<n.length;s++)this.engine.write(n[s],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,n){var s;this.cleanup(),(s=this.engine)===null||s===void 0||s.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,n),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const n=this.backoff.duration();this._reconnecting=!0;const s=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(r=>{r?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",r)):e.onreconnect()}))},n);this.opts.autoUnref&&s.unref(),this.subs.push(()=>{this.clearTimeoutFn(s)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const Sh={};function Ny(t,e){typeof t=="object"&&(e=t,t=void 0),e=e||{};const n=kJ(t,e.path||"/socket.io"),s=n.source,r=n.id,i=n.path,o=Sh[r]&&i in Sh[r].nsps,a=e.forceNew||e["force new connection"]||e.multiplex===!1||o;let l;return a?l=new wk(s,e):(Sh[r]||(Sh[r]=new wk(s,e)),l=Sh[r]),n.query&&!e.query&&(e.query=n.queryKey),l.socket(n.path,e)}Object.assign(Ny,{Manager:wk,Socket:u3,io:Ny,connect:Ny});let LJ={data:""},FJ=t=>{if(typeof window=="object"){let e=(t?t.querySelector("#_goober"):window._goober)||Object.assign(document.createElement("style"),{innerHTML:" ",id:"_goober"});return e.nonce=window.__nonce__,e.parentNode||(t||document.head).appendChild(e),e.firstChild}return t||LJ},_J=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,zJ=/\/\*[^]*?\*\/|  +/g,$R=/\n+/g,Ta=(t,e)=>{let n="",s="",r="";for(let i in t){let o=t[i];i[0]=="@"?i[1]=="i"?n=i+" "+o+";":s+=i[1]=="f"?Ta(o,i):i+"{"+Ta(o,i[1]=="k"?"":e)+"}":typeof o=="object"?s+=Ta(o,e?e.replace(/([^,])+/g,a=>i.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,l=>/&/.test(l)?l.replace(/&/g,a):a?a+" "+l:l)):i):o!=null&&(i=/^--/.test(i)?i:i.replace(/[A-Z]/g,"-$&").toLowerCase(),r+=Ta.p?Ta.p(i,o):i+":"+o+";")}return n+(e&&r?e+"{"+r+"}":r)+s},Eo={},d3=t=>{if(typeof t=="object"){let e="";for(let n in t)e+=n+d3(t[n]);return e}return t},BJ=(t,e,n,s,r)=>{let i=d3(t),o=Eo[i]||(Eo[i]=(l=>{let c=0,u=11;for(;c<l.length;)u=101*u+l.charCodeAt(c++)>>>0;return"go"+u})(i));if(!Eo[o]){let l=i!==t?t:(c=>{let u,d,h=[{}];for(;u=_J.exec(c.replace(zJ,""));)u[4]?h.shift():u[3]?(d=u[3].replace($R," ").trim(),h.unshift(h[0][d]=h[0][d]||{})):h[0][u[1]]=u[2].replace($R," ").trim();return h[0]})(t);Eo[o]=Ta(r?{["@keyframes "+o]:l}:l,n?"":"."+o)}let a=n&&Eo.g?Eo.g:null;return n&&(Eo.g=Eo[o]),((l,c,u,d)=>{d?c.data=c.data.replace(d,l):c.data.indexOf(l)===-1&&(c.data=u?l+c.data:c.data+l)})(Eo[o],e,s,a),o},jJ=(t,e,n)=>t.reduce((s,r,i)=>{let o=e[i];if(o&&o.call){let a=o(n),l=a&&a.props&&a.props.className||/^go/.test(a)&&a;o=l?"."+l:a&&typeof a=="object"?a.props?"":Ta(a,""):a===!1?"":a}return s+r+(o??"")},"");function pb(t){let e=this||{},n=t.call?t(e.p):t;return BJ(n.unshift?n.raw?jJ(n,[].slice.call(arguments,1),e.p):n.reduce((s,r)=>Object.assign(s,r&&r.call?r(e.p):r),{}):n,FJ(e.target),e.g,e.o,e.k)}let h3,Sk,kk;pb.bind({g:1});let ea=pb.bind({k:1});function VJ(t,e,n,s){Ta.p=e,h3=t,Sk=n,kk=s}function yl(t,e){let n=this||{};return function(){let s=arguments;function r(i,o){let a=Object.assign({},i),l=a.className||r.className;n.p=Object.assign({theme:Sk&&Sk()},a),n.o=/ *go\d+/.test(l),a.className=pb.apply(n,s)+(l?" "+l:""),e&&(a.ref=o);let c=t;return t[0]&&(c=a.as||t,delete a.as),kk&&c[0]&&kk(a),h3(c,a)}return e?e(r):r}}var UJ=t=>typeof t=="function",p0=(t,e)=>UJ(t)?t(e):t,WJ=(()=>{let t=0;return()=>(++t).toString()})(),f3=(()=>{let t;return()=>{if(t===void 0&&typeof window<"u"){let e=matchMedia("(prefers-reduced-motion: reduce)");t=!e||e.matches}return t}})(),HJ=20,xT="default",p3=(t,e)=>{let{toastLimit:n}=t.settings;switch(e.type){case 0:return{...t,toasts:[e.toast,...t.toasts].slice(0,n)};case 1:return{...t,toasts:t.toasts.map(o=>o.id===e.toast.id?{...o,...e.toast}:o)};case 2:let{toast:s}=e;return p3(t,{type:t.toasts.find(o=>o.id===s.id)?1:0,toast:s});case 3:let{toastId:r}=e;return{...t,toasts:t.toasts.map(o=>o.id===r||r===void 0?{...o,dismissed:!0,visible:!1}:o)};case 4:return e.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(o=>o.id!==e.toastId)};case 5:return{...t,pausedAt:e.time};case 6:let i=e.time-(t.pausedAt||0);return{...t,pausedAt:void 0,toasts:t.toasts.map(o=>({...o,pauseDuration:o.pauseDuration+i}))}}},Ty=[],m3={toasts:[],pausedAt:void 0,settings:{toastLimit:HJ}},eo={},g3=(t,e=xT)=>{eo[e]=p3(eo[e]||m3,t),Ty.forEach(([n,s])=>{n===e&&s(eo[e])})},y3=t=>Object.keys(eo).forEach(e=>g3(t,e)),GJ=t=>Object.keys(eo).find(e=>eo[e].toasts.some(n=>n.id===t)),mb=(t=xT)=>e=>{g3(e,t)},KJ={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},qJ=(t={},e=xT)=>{let[n,s]=z.useState(eo[e]||m3),r=z.useRef(eo[e]);z.useEffect(()=>(r.current!==eo[e]&&s(eo[e]),Ty.push([e,s]),()=>{let o=Ty.findIndex(([a])=>a===e);o>-1&&Ty.splice(o,1)}),[e]);let i=n.toasts.map(o=>{var a,l,c;return{...t,...t[o.type],...o,removeDelay:o.removeDelay||((a=t[o.type])==null?void 0:a.removeDelay)||(t==null?void 0:t.removeDelay),duration:o.duration||((l=t[o.type])==null?void 0:l.duration)||(t==null?void 0:t.duration)||KJ[o.type],style:{...t.style,...(c=t[o.type])==null?void 0:c.style,...o.style}}});return{...n,toasts:i}},XJ=(t,e="blank",n)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:e,ariaProps:{role:"status","aria-live":"polite"},message:t,pauseDuration:0,...n,id:(n==null?void 0:n.id)||WJ()}),Ip=t=>(e,n)=>{let s=XJ(e,t,n);return mb(s.toasterId||GJ(s.id))({type:2,toast:s}),s.id},Jt=(t,e)=>Ip("blank")(t,e);Jt.error=Ip("error");Jt.success=Ip("success");Jt.loading=Ip("loading");Jt.custom=Ip("custom");Jt.dismiss=(t,e)=>{let n={type:3,toastId:t};e?mb(e)(n):y3(n)};Jt.dismissAll=t=>Jt.dismiss(void 0,t);Jt.remove=(t,e)=>{let n={type:4,toastId:t};e?mb(e)(n):y3(n)};Jt.removeAll=t=>Jt.remove(void 0,t);Jt.promise=(t,e,n)=>{let s=Jt.loading(e.loading,{...n,...n==null?void 0:n.loading});return typeof t=="function"&&(t=t()),t.then(r=>{let i=e.success?p0(e.success,r):void 0;return i?Jt.success(i,{id:s,...n,...n==null?void 0:n.success}):Jt.dismiss(s),r}).catch(r=>{let i=e.error?p0(e.error,r):void 0;i?Jt.error(i,{id:s,...n,...n==null?void 0:n.error}):Jt.dismiss(s)}),t};var JJ=1e3,YJ=(t,e="default")=>{let{toasts:n,pausedAt:s}=qJ(t,e),r=z.useRef(new Map).current,i=z.useCallback((d,h=JJ)=>{if(r.has(d))return;let f=setTimeout(()=>{r.delete(d),o({type:4,toastId:d})},h);r.set(d,f)},[]);z.useEffect(()=>{if(s)return;let d=Date.now(),h=n.map(f=>{if(f.duration===1/0)return;let p=(f.duration||0)+f.pauseDuration-(d-f.createdAt);if(p<0){f.visible&&Jt.dismiss(f.id);return}return setTimeout(()=>Jt.dismiss(f.id,e),p)});return()=>{h.forEach(f=>f&&clearTimeout(f))}},[n,s,e]);let o=z.useCallback(mb(e),[e]),a=z.useCallback(()=>{o({type:5,time:Date.now()})},[o]),l=z.useCallback((d,h)=>{o({type:1,toast:{id:d,height:h}})},[o]),c=z.useCallback(()=>{s&&o({type:6,time:Date.now()})},[s,o]),u=z.useCallback((d,h)=>{let{reverseOrder:f=!1,gutter:p=8,defaultPosition:m}=h||{},g=n.filter(v=>(v.position||m)===(d.position||m)&&v.height),y=g.findIndex(v=>v.id===d.id),x=g.filter((v,w)=>w<y&&v.visible).length;return g.filter(v=>v.visible).slice(...f?[x+1]:[0,x]).reduce((v,w)=>v+(w.height||0)+p,0)},[n]);return z.useEffect(()=>{n.forEach(d=>{if(d.dismissed)i(d.id,d.removeDelay);else{let h=r.get(d.id);h&&(clearTimeout(h),r.delete(d.id))}})},[n,i]),{toasts:n,handlers:{updateHeight:l,startPause:a,endPause:c,calculateOffset:u}}},QJ=ea`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,ZJ=ea`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,eY=ea`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,tY=yl("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${t=>t.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${QJ} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${ZJ} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${t=>t.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${eY} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,nY=ea`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,sY=yl("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${t=>t.secondary||"#e0e0e0"};
  border-right-color: ${t=>t.primary||"#616161"};
  animation: ${nY} 1s linear infinite;
`,rY=ea`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,iY=ea`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,oY=yl("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${t=>t.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${rY} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${iY} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${t=>t.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,aY=yl("div")`
  position: absolute;
`,lY=yl("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,cY=ea`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,uY=yl("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${cY} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,dY=({toast:t})=>{let{icon:e,type:n,iconTheme:s}=t;return e!==void 0?typeof e=="string"?z.createElement(uY,null,e):e:n==="blank"?null:z.createElement(lY,null,z.createElement(sY,{...s}),n!=="loading"&&z.createElement(aY,null,n==="error"?z.createElement(tY,{...s}):z.createElement(oY,{...s})))},hY=t=>`
0% {transform: translate3d(0,${t*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,fY=t=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${t*-150}%,-1px) scale(.6); opacity:0;}
`,pY="0%{opacity:0;} 100%{opacity:1;}",mY="0%{opacity:1;} 100%{opacity:0;}",gY=yl("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,yY=yl("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,xY=(t,e)=>{let n=t.includes("top")?1:-1,[s,r]=f3()?[pY,mY]:[hY(n),fY(n)];return{animation:e?`${ea(s)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${ea(r)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},bY=z.memo(({toast:t,position:e,style:n,children:s})=>{let r=t.height?xY(t.position||e||"top-center",t.visible):{opacity:0},i=z.createElement(dY,{toast:t}),o=z.createElement(yY,{...t.ariaProps},p0(t.message,t));return z.createElement(gY,{className:t.className,style:{...r,...n,...t.style}},typeof s=="function"?s({icon:i,message:o}):z.createElement(z.Fragment,null,i,o))});VJ(z.createElement);var vY=({id:t,className:e,style:n,onHeightUpdate:s,children:r})=>{let i=z.useCallback(o=>{if(o){let a=()=>{let l=o.getBoundingClientRect().height;s(t,l)};a(),new MutationObserver(a).observe(o,{subtree:!0,childList:!0,characterData:!0})}},[t,s]);return z.createElement("div",{ref:i,className:e,style:n},r)},wY=(t,e)=>{let n=t.includes("top"),s=n?{top:0}:{bottom:0},r=t.includes("center")?{justifyContent:"center"}:t.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:f3()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${e*(n?1:-1)}px)`,...s,...r}},SY=pb`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,Ng=16,kY=({reverseOrder:t,position:e="top-center",toastOptions:n,gutter:s,children:r,toasterId:i,containerStyle:o,containerClassName:a})=>{let{toasts:l,handlers:c}=YJ(n,i);return z.createElement("div",{"data-rht-toaster":i||"",style:{position:"fixed",zIndex:9999,top:Ng,left:Ng,right:Ng,bottom:Ng,pointerEvents:"none",...o},className:a,onMouseEnter:c.startPause,onMouseLeave:c.endPause},l.map(u=>{let d=u.position||e,h=c.calculateOffset(u,{reverseOrder:t,gutter:s,defaultPosition:e}),f=wY(d,h);return z.createElement(vY,{id:u.id,key:u.id,onHeightUpdate:c.updateHeight,className:u.visible?SY:"",style:f},u.type==="custom"?p0(u.message,u):r?r(u):z.createElement(bY,{toast:u,position:d}))}))},Yt=Jt;const x3=z.createContext({transformPagePoint:t=>t,isStatic:!1,reducedMotion:"never"}),gb=z.createContext({}),bT=z.createContext(null),yb=typeof document<"u",CY=yb?z.useLayoutEffect:z.useEffect,b3=z.createContext({strict:!1}),vT=t=>t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),NY="framerAppearId",v3="data-"+vT(NY);function TY(t,e,n,s){const{visualElement:r}=z.useContext(gb),i=z.useContext(b3),o=z.useContext(bT),a=z.useContext(x3).reducedMotion,l=z.useRef();s=s||i.renderer,!l.current&&s&&(l.current=s(t,{visualState:e,parent:r,props:n,presenceContext:o,blockInitialAnimation:o?o.initial===!1:!1,reducedMotionConfig:a}));const c=l.current;z.useInsertionEffect(()=>{c&&c.update(n,o)});const u=z.useRef(!!(n[v3]&&!window.HandoffComplete));return CY(()=>{c&&(c.render(),u.current&&c.animationState&&c.animationState.animateChanges())}),z.useEffect(()=>{c&&(c.updateFeatures(),!u.current&&c.animationState&&c.animationState.animateChanges(),u.current&&(u.current=!1,window.HandoffComplete=!0))}),c}function Vu(t){return t&&typeof t=="object"&&Object.prototype.hasOwnProperty.call(t,"current")}function EY(t,e,n){return z.useCallback(s=>{s&&t.mount&&t.mount(s),e&&(s?e.mount(s):e.unmount()),n&&(typeof n=="function"?n(s):Vu(n)&&(n.current=s))},[e])}function Kf(t){return typeof t=="string"||Array.isArray(t)}function xb(t){return t!==null&&typeof t=="object"&&typeof t.start=="function"}const wT=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],ST=["initial",...wT];function bb(t){return xb(t.animate)||ST.some(e=>Kf(t[e]))}function w3(t){return!!(bb(t)||t.variants)}function IY(t,e){if(bb(t)){const{initial:n,animate:s}=t;return{initial:n===!1||Kf(n)?n:void 0,animate:Kf(s)?s:void 0}}return t.inherit!==!1?e:{}}function AY(t){const{initial:e,animate:n}=IY(t,z.useContext(gb));return z.useMemo(()=>({initial:e,animate:n}),[RR(e),RR(n)])}function RR(t){return Array.isArray(t)?t.join(" "):t}const DR={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},qf={};for(const t in DR)qf[t]={isEnabled:e=>DR[t].some(n=>!!e[n])};function $Y(t){for(const e in t)qf[e]={...qf[e],...t[e]}}const S3=z.createContext({}),k3=z.createContext({}),RY=Symbol.for("motionComponentSymbol");function DY({preloadedFeatures:t,createVisualElement:e,useRender:n,useVisualState:s,Component:r}){t&&$Y(t);function i(a,l){let c;const u={...z.useContext(x3),...a,layoutId:OY(a)},{isStatic:d}=u,h=AY(a),f=s(a,d);if(!d&&yb){h.visualElement=TY(r,f,u,e);const p=z.useContext(k3),m=z.useContext(b3).strict;h.visualElement&&(c=h.visualElement.loadFeatures(u,m,t,p))}return z.createElement(gb.Provider,{value:h},c&&h.visualElement?z.createElement(c,{visualElement:h.visualElement,...u}):null,n(r,a,EY(f,h.visualElement,l),f,d,h.visualElement))}const o=z.forwardRef(i);return o[RY]=r,o}function OY({layoutId:t}){const e=z.useContext(S3).id;return e&&t!==void 0?e+"-"+t:t}function MY(t){function e(s,r={}){return DY(t(s,r))}if(typeof Proxy>"u")return e;const n=new Map;return new Proxy(e,{get:(s,r)=>(n.has(r)||n.set(r,e(r)),n.get(r))})}const PY=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function kT(t){return typeof t!="string"||t.includes("-")?!1:!!(PY.indexOf(t)>-1||/[A-Z]/.test(t))}const m0={};function LY(t){Object.assign(m0,t)}const Ap=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Kc=new Set(Ap);function C3(t,{layout:e,layoutId:n}){return Kc.has(t)||t.startsWith("origin")||(e||n!==void 0)&&(!!m0[t]||t==="opacity")}const ar=t=>!!(t&&t.getVelocity),FY={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},_Y=Ap.length;function zY(t,{enableHardwareAcceleration:e=!0,allowTransformNone:n=!0},s,r){let i="";for(let o=0;o<_Y;o++){const a=Ap[o];if(t[a]!==void 0){const l=FY[a]||a;i+=`${l}(${t[a]}) `}}return e&&!t.z&&(i+="translateZ(0)"),i=i.trim(),r?i=r(t,s?"":i):n&&s&&(i="none"),i}const N3=t=>e=>typeof e=="string"&&e.startsWith(t),T3=N3("--"),Ck=N3("var(--"),BY=/var\s*\(\s*--[\w-]+(\s*,\s*(?:(?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)+)?\s*\)/g,jY=(t,e)=>e&&typeof t=="number"?e.transform(t):t,rl=(t,e,n)=>Math.min(Math.max(n,t),e),qc={test:t=>typeof t=="number",parse:parseFloat,transform:t=>t},uf={...qc,transform:t=>rl(0,1,t)},Tg={...qc,default:1},df=t=>Math.round(t*1e5)/1e5,vb=/(-)?([\d]*\.?[\d])+/g,E3=/(#[0-9a-f]{3,8}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))/gi,VY=/^(#[0-9a-f]{3,8}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))$/i;function $p(t){return typeof t=="string"}const Rp=t=>({test:e=>$p(e)&&e.endsWith(t)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${t}`}),ma=Rp("deg"),io=Rp("%"),Me=Rp("px"),UY=Rp("vh"),WY=Rp("vw"),OR={...io,parse:t=>io.parse(t)/100,transform:t=>io.transform(t*100)},MR={...qc,transform:Math.round},I3={borderWidth:Me,borderTopWidth:Me,borderRightWidth:Me,borderBottomWidth:Me,borderLeftWidth:Me,borderRadius:Me,radius:Me,borderTopLeftRadius:Me,borderTopRightRadius:Me,borderBottomRightRadius:Me,borderBottomLeftRadius:Me,width:Me,maxWidth:Me,height:Me,maxHeight:Me,size:Me,top:Me,right:Me,bottom:Me,left:Me,padding:Me,paddingTop:Me,paddingRight:Me,paddingBottom:Me,paddingLeft:Me,margin:Me,marginTop:Me,marginRight:Me,marginBottom:Me,marginLeft:Me,rotate:ma,rotateX:ma,rotateY:ma,rotateZ:ma,scale:Tg,scaleX:Tg,scaleY:Tg,scaleZ:Tg,skew:ma,skewX:ma,skewY:ma,distance:Me,translateX:Me,translateY:Me,translateZ:Me,x:Me,y:Me,z:Me,perspective:Me,transformPerspective:Me,opacity:uf,originX:OR,originY:OR,originZ:Me,zIndex:MR,fillOpacity:uf,strokeOpacity:uf,numOctaves:MR};function CT(t,e,n,s){const{style:r,vars:i,transform:o,transformOrigin:a}=t;let l=!1,c=!1,u=!0;for(const d in e){const h=e[d];if(T3(d)){i[d]=h;continue}const f=I3[d],p=jY(h,f);if(Kc.has(d)){if(l=!0,o[d]=p,!u)continue;h!==(f.default||0)&&(u=!1)}else d.startsWith("origin")?(c=!0,a[d]=p):r[d]=p}if(e.transform||(l||s?r.transform=zY(t.transform,n,u,s):r.transform&&(r.transform="none")),c){const{originX:d="50%",originY:h="50%",originZ:f=0}=a;r.transformOrigin=`${d} ${h} ${f}`}}const NT=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function A3(t,e,n){for(const s in e)!ar(e[s])&&!C3(s,n)&&(t[s]=e[s])}function HY({transformTemplate:t},e,n){return z.useMemo(()=>{const s=NT();return CT(s,e,{enableHardwareAcceleration:!n},t),Object.assign({},s.vars,s.style)},[e])}function GY(t,e,n){const s=t.style||{},r={};return A3(r,s,t),Object.assign(r,HY(t,e,n)),t.transformValues?t.transformValues(r):r}function KY(t,e,n){const s={},r=GY(t,e,n);return t.drag&&t.dragListener!==!1&&(s.draggable=!1,r.userSelect=r.WebkitUserSelect=r.WebkitTouchCallout="none",r.touchAction=t.drag===!0?"none":`pan-${t.drag==="x"?"y":"x"}`),t.tabIndex===void 0&&(t.onTap||t.onTapStart||t.whileTap)&&(s.tabIndex=0),s.style=r,s}const qY=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","transformValues","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function g0(t){return t.startsWith("while")||t.startsWith("drag")&&t!=="draggable"||t.startsWith("layout")||t.startsWith("onTap")||t.startsWith("onPan")||t.startsWith("onLayout")||qY.has(t)}let $3=t=>!g0(t);function XY(t){t&&($3=e=>e.startsWith("on")?!g0(e):t(e))}try{XY(require("@emotion/is-prop-valid").default)}catch{}function JY(t,e,n){const s={};for(const r in t)r==="values"&&typeof t.values=="object"||($3(r)||n===!0&&g0(r)||!e&&!g0(r)||t.draggable&&r.startsWith("onDrag"))&&(s[r]=t[r]);return s}function PR(t,e,n){return typeof t=="string"?t:Me.transform(e+n*t)}function YY(t,e,n){const s=PR(e,t.x,t.width),r=PR(n,t.y,t.height);return`${s} ${r}`}const QY={offset:"stroke-dashoffset",array:"stroke-dasharray"},ZY={offset:"strokeDashoffset",array:"strokeDasharray"};function eQ(t,e,n=1,s=0,r=!0){t.pathLength=1;const i=r?QY:ZY;t[i.offset]=Me.transform(-s);const o=Me.transform(e),a=Me.transform(n);t[i.array]=`${o} ${a}`}function TT(t,{attrX:e,attrY:n,attrScale:s,originX:r,originY:i,pathLength:o,pathSpacing:a=1,pathOffset:l=0,...c},u,d,h){if(CT(t,c,u,h),d){t.style.viewBox&&(t.attrs.viewBox=t.style.viewBox);return}t.attrs=t.style,t.style={};const{attrs:f,style:p,dimensions:m}=t;f.transform&&(m&&(p.transform=f.transform),delete f.transform),m&&(r!==void 0||i!==void 0||p.transform)&&(p.transformOrigin=YY(m,r!==void 0?r:.5,i!==void 0?i:.5)),e!==void 0&&(f.x=e),n!==void 0&&(f.y=n),s!==void 0&&(f.scale=s),o!==void 0&&eQ(f,o,a,l,!1)}const R3=()=>({...NT(),attrs:{}}),ET=t=>typeof t=="string"&&t.toLowerCase()==="svg";function tQ(t,e,n,s){const r=z.useMemo(()=>{const i=R3();return TT(i,e,{enableHardwareAcceleration:!1},ET(s),t.transformTemplate),{...i.attrs,style:{...i.style}}},[e]);if(t.style){const i={};A3(i,t.style,t),r.style={...i,...r.style}}return r}function nQ(t=!1){return(n,s,r,{latestValues:i},o)=>{const l=(kT(n)?tQ:KY)(s,i,o,n),u={...JY(s,typeof n=="string",t),...l,ref:r},{children:d}=s,h=z.useMemo(()=>ar(d)?d.get():d,[d]);return z.createElement(n,{...u,children:h})}}function D3(t,{style:e,vars:n},s,r){Object.assign(t.style,e,r&&r.getProjectionStyles(s));for(const i in n)t.style.setProperty(i,n[i])}const O3=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function M3(t,e,n,s){D3(t,e,void 0,s);for(const r in e.attrs)t.setAttribute(O3.has(r)?r:vT(r),e.attrs[r])}function IT(t,e){const{style:n}=t,s={};for(const r in n)(ar(n[r])||e.style&&ar(e.style[r])||C3(r,t))&&(s[r]=n[r]);return s}function P3(t,e){const n=IT(t,e);for(const s in t)if(ar(t[s])||ar(e[s])){const r=Ap.indexOf(s)!==-1?"attr"+s.charAt(0).toUpperCase()+s.substring(1):s;n[r]=t[s]}return n}function AT(t,e,n,s={},r={}){return typeof e=="function"&&(e=e(n!==void 0?n:t.custom,s,r)),typeof e=="string"&&(e=t.variants&&t.variants[e]),typeof e=="function"&&(e=e(n!==void 0?n:t.custom,s,r)),e}function sQ(t){const e=z.useRef(null);return e.current===null&&(e.current=t()),e.current}const y0=t=>Array.isArray(t),rQ=t=>!!(t&&typeof t=="object"&&t.mix&&t.toValue),iQ=t=>y0(t)?t[t.length-1]||0:t;function Ey(t){const e=ar(t)?t.get():t;return rQ(e)?e.toValue():e}function oQ({scrapeMotionValuesFromProps:t,createRenderState:e,onMount:n},s,r,i){const o={latestValues:aQ(s,r,i,t),renderState:e()};return n&&(o.mount=a=>n(s,a,o)),o}const L3=t=>(e,n)=>{const s=z.useContext(gb),r=z.useContext(bT),i=()=>oQ(t,e,s,r);return n?i():sQ(i)};function aQ(t,e,n,s){const r={},i=s(t,{});for(const h in i)r[h]=Ey(i[h]);let{initial:o,animate:a}=t;const l=bb(t),c=w3(t);e&&c&&!l&&t.inherit!==!1&&(o===void 0&&(o=e.initial),a===void 0&&(a=e.animate));let u=n?n.initial===!1:!1;u=u||o===!1;const d=u?a:o;return d&&typeof d!="boolean"&&!xb(d)&&(Array.isArray(d)?d:[d]).forEach(f=>{const p=AT(t,f);if(!p)return;const{transitionEnd:m,transition:g,...y}=p;for(const x in y){let v=y[x];if(Array.isArray(v)){const w=u?v.length-1:0;v=v[w]}v!==null&&(r[x]=v)}for(const x in m)r[x]=m[x]}),r}const Qt=t=>t;class LR{constructor(){this.order=[],this.scheduled=new Set}add(e){if(!this.scheduled.has(e))return this.scheduled.add(e),this.order.push(e),!0}remove(e){const n=this.order.indexOf(e);n!==-1&&(this.order.splice(n,1),this.scheduled.delete(e))}clear(){this.order.length=0,this.scheduled.clear()}}function lQ(t){let e=new LR,n=new LR,s=0,r=!1,i=!1;const o=new WeakSet,a={schedule:(l,c=!1,u=!1)=>{const d=u&&r,h=d?e:n;return c&&o.add(l),h.add(l)&&d&&r&&(s=e.order.length),l},cancel:l=>{n.remove(l),o.delete(l)},process:l=>{if(r){i=!0;return}if(r=!0,[e,n]=[n,e],n.clear(),s=e.order.length,s)for(let c=0;c<s;c++){const u=e.order[c];u(l),o.has(u)&&(a.schedule(u),t())}r=!1,i&&(i=!1,a.process(l))}};return a}const Eg=["prepare","read","update","preRender","render","postRender"],cQ=40;function uQ(t,e){let n=!1,s=!0;const r={delta:0,timestamp:0,isProcessing:!1},i=Eg.reduce((d,h)=>(d[h]=lQ(()=>n=!0),d),{}),o=d=>i[d].process(r),a=()=>{const d=performance.now();n=!1,r.delta=s?1e3/60:Math.max(Math.min(d-r.timestamp,cQ),1),r.timestamp=d,r.isProcessing=!0,Eg.forEach(o),r.isProcessing=!1,n&&e&&(s=!1,t(a))},l=()=>{n=!0,s=!0,r.isProcessing||t(a)};return{schedule:Eg.reduce((d,h)=>{const f=i[h];return d[h]=(p,m=!1,g=!1)=>(n||l(),f.schedule(p,m,g)),d},{}),cancel:d=>Eg.forEach(h=>i[h].cancel(d)),state:r,steps:i}}const{schedule:Dt,cancel:ta,state:hs,steps:sw}=uQ(typeof requestAnimationFrame<"u"?requestAnimationFrame:Qt,!0),dQ={useVisualState:L3({scrapeMotionValuesFromProps:P3,createRenderState:R3,onMount:(t,e,{renderState:n,latestValues:s})=>{Dt.read(()=>{try{n.dimensions=typeof e.getBBox=="function"?e.getBBox():e.getBoundingClientRect()}catch{n.dimensions={x:0,y:0,width:0,height:0}}}),Dt.render(()=>{TT(n,s,{enableHardwareAcceleration:!1},ET(e.tagName),t.transformTemplate),M3(e,n)})}})},hQ={useVisualState:L3({scrapeMotionValuesFromProps:IT,createRenderState:NT})};function fQ(t,{forwardMotionProps:e=!1},n,s){return{...kT(t)?dQ:hQ,preloadedFeatures:n,useRender:nQ(e),createVisualElement:s,Component:t}}function jo(t,e,n,s={passive:!0}){return t.addEventListener(e,n,s),()=>t.removeEventListener(e,n)}const F3=t=>t.pointerType==="mouse"?typeof t.button!="number"||t.button<=0:t.isPrimary!==!1;function wb(t,e="page"){return{point:{x:t[e+"X"],y:t[e+"Y"]}}}const pQ=t=>e=>F3(e)&&t(e,wb(e));function Go(t,e,n,s){return jo(t,e,pQ(n),s)}const mQ=(t,e)=>n=>e(t(n)),Ga=(...t)=>t.reduce(mQ);function _3(t){let e=null;return()=>{const n=()=>{e=null};return e===null?(e=t,n):!1}}const FR=_3("dragHorizontal"),_R=_3("dragVertical");function z3(t){let e=!1;if(t==="y")e=_R();else if(t==="x")e=FR();else{const n=FR(),s=_R();n&&s?e=()=>{n(),s()}:(n&&n(),s&&s())}return e}function B3(){const t=z3(!0);return t?(t(),!1):!0}class xl{constructor(e){this.isMounted=!1,this.node=e}update(){}}function zR(t,e){const n="pointer"+(e?"enter":"leave"),s="onHover"+(e?"Start":"End"),r=(i,o)=>{if(i.pointerType==="touch"||B3())return;const a=t.getProps();t.animationState&&a.whileHover&&t.animationState.setActive("whileHover",e),a[s]&&Dt.update(()=>a[s](i,o))};return Go(t.current,n,r,{passive:!t.getProps()[s]})}class gQ extends xl{mount(){this.unmount=Ga(zR(this.node,!0),zR(this.node,!1))}unmount(){}}class yQ extends xl{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Ga(jo(this.node.current,"focus",()=>this.onFocus()),jo(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}const j3=(t,e)=>e?t===e?!0:j3(t,e.parentElement):!1;function rw(t,e){if(!e)return;const n=new PointerEvent("pointer"+t);e(n,wb(n))}class xQ extends xl{constructor(){super(...arguments),this.removeStartListeners=Qt,this.removeEndListeners=Qt,this.removeAccessibleListeners=Qt,this.startPointerPress=(e,n)=>{if(this.isPressing)return;this.removeEndListeners();const s=this.node.getProps(),i=Go(window,"pointerup",(a,l)=>{if(!this.checkPressEnd())return;const{onTap:c,onTapCancel:u,globalTapTarget:d}=this.node.getProps();Dt.update(()=>{!d&&!j3(this.node.current,a.target)?u&&u(a,l):c&&c(a,l)})},{passive:!(s.onTap||s.onPointerUp)}),o=Go(window,"pointercancel",(a,l)=>this.cancelPress(a,l),{passive:!(s.onTapCancel||s.onPointerCancel)});this.removeEndListeners=Ga(i,o),this.startPress(e,n)},this.startAccessiblePress=()=>{const e=i=>{if(i.key!=="Enter"||this.isPressing)return;const o=a=>{a.key!=="Enter"||!this.checkPressEnd()||rw("up",(l,c)=>{const{onTap:u}=this.node.getProps();u&&Dt.update(()=>u(l,c))})};this.removeEndListeners(),this.removeEndListeners=jo(this.node.current,"keyup",o),rw("down",(a,l)=>{this.startPress(a,l)})},n=jo(this.node.current,"keydown",e),s=()=>{this.isPressing&&rw("cancel",(i,o)=>this.cancelPress(i,o))},r=jo(this.node.current,"blur",s);this.removeAccessibleListeners=Ga(n,r)}}startPress(e,n){this.isPressing=!0;const{onTapStart:s,whileTap:r}=this.node.getProps();r&&this.node.animationState&&this.node.animationState.setActive("whileTap",!0),s&&Dt.update(()=>s(e,n))}checkPressEnd(){return this.removeEndListeners(),this.isPressing=!1,this.node.getProps().whileTap&&this.node.animationState&&this.node.animationState.setActive("whileTap",!1),!B3()}cancelPress(e,n){if(!this.checkPressEnd())return;const{onTapCancel:s}=this.node.getProps();s&&Dt.update(()=>s(e,n))}mount(){const e=this.node.getProps(),n=Go(e.globalTapTarget?window:this.node.current,"pointerdown",this.startPointerPress,{passive:!(e.onTapStart||e.onPointerStart)}),s=jo(this.node.current,"focus",this.startAccessiblePress);this.removeStartListeners=Ga(n,s)}unmount(){this.removeStartListeners(),this.removeEndListeners(),this.removeAccessibleListeners()}}const Nk=new WeakMap,iw=new WeakMap,bQ=t=>{const e=Nk.get(t.target);e&&e(t)},vQ=t=>{t.forEach(bQ)};function wQ({root:t,...e}){const n=t||document;iw.has(n)||iw.set(n,{});const s=iw.get(n),r=JSON.stringify(e);return s[r]||(s[r]=new IntersectionObserver(vQ,{root:t,...e})),s[r]}function SQ(t,e,n){const s=wQ(e);return Nk.set(t,n),s.observe(t),()=>{Nk.delete(t),s.unobserve(t)}}const kQ={some:0,all:1};class CQ extends xl{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:n,margin:s,amount:r="some",once:i}=e,o={root:n?n.current:void 0,rootMargin:s,threshold:typeof r=="number"?r:kQ[r]},a=l=>{const{isIntersecting:c}=l;if(this.isInView===c||(this.isInView=c,i&&!c&&this.hasEnteredView))return;c&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",c);const{onViewportEnter:u,onViewportLeave:d}=this.node.getProps(),h=c?u:d;h&&h(l)};return SQ(this.node.current,o,a)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:n}=this.node;["amount","margin","root"].some(NQ(e,n))&&this.startObserver()}unmount(){}}function NQ({viewport:t={}},{viewport:e={}}={}){return n=>t[n]!==e[n]}const TQ={inView:{Feature:CQ},tap:{Feature:xQ},focus:{Feature:yQ},hover:{Feature:gQ}};function V3(t,e){if(!Array.isArray(e))return!1;const n=e.length;if(n!==t.length)return!1;for(let s=0;s<n;s++)if(e[s]!==t[s])return!1;return!0}function EQ(t){const e={};return t.values.forEach((n,s)=>e[s]=n.get()),e}function IQ(t){const e={};return t.values.forEach((n,s)=>e[s]=n.getVelocity()),e}function Sb(t,e,n){const s=t.getProps();return AT(s,e,n!==void 0?n:s.custom,EQ(t),IQ(t))}let AQ=Qt,$T=Qt;const Ka=t=>t*1e3,Ko=t=>t/1e3,$Q={current:!1},U3=t=>Array.isArray(t)&&typeof t[0]=="number";function W3(t){return!!(!t||typeof t=="string"&&H3[t]||U3(t)||Array.isArray(t)&&t.every(W3))}const jh=([t,e,n,s])=>`cubic-bezier(${t}, ${e}, ${n}, ${s})`,H3={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:jh([0,.65,.55,1]),circOut:jh([.55,0,1,.45]),backIn:jh([.31,.01,.66,-.59]),backOut:jh([.33,1.53,.69,.99])};function G3(t){if(t)return U3(t)?jh(t):Array.isArray(t)?t.map(G3):H3[t]}function RQ(t,e,n,{delay:s=0,duration:r,repeat:i=0,repeatType:o="loop",ease:a,times:l}={}){const c={[e]:n};l&&(c.offset=l);const u=G3(a);return Array.isArray(u)&&(c.easing=u),t.animate(c,{delay:s,duration:r,easing:Array.isArray(u)?"linear":u,fill:"both",iterations:i+1,direction:o==="reverse"?"alternate":"normal"})}function DQ(t,{repeat:e,repeatType:n="loop"}){const s=e&&n!=="loop"&&e%2===1?0:t.length-1;return t[s]}const K3=(t,e,n)=>(((1-3*n+3*e)*t+(3*n-6*e))*t+3*e)*t,OQ=1e-7,MQ=12;function PQ(t,e,n,s,r){let i,o,a=0;do o=e+(n-e)/2,i=K3(o,s,r)-t,i>0?n=o:e=o;while(Math.abs(i)>OQ&&++a<MQ);return o}function Dp(t,e,n,s){if(t===e&&n===s)return Qt;const r=i=>PQ(i,0,1,t,n);return i=>i===0||i===1?i:K3(r(i),e,s)}const LQ=Dp(.42,0,1,1),FQ=Dp(0,0,.58,1),q3=Dp(.42,0,.58,1),_Q=t=>Array.isArray(t)&&typeof t[0]!="number",X3=t=>e=>e<=.5?t(2*e)/2:(2-t(2*(1-e)))/2,J3=t=>e=>1-t(1-e),RT=t=>1-Math.sin(Math.acos(t)),Y3=J3(RT),zQ=X3(RT),Q3=Dp(.33,1.53,.69,.99),DT=J3(Q3),BQ=X3(DT),jQ=t=>(t*=2)<1?.5*DT(t):.5*(2-Math.pow(2,-10*(t-1))),VQ={linear:Qt,easeIn:LQ,easeInOut:q3,easeOut:FQ,circIn:RT,circInOut:zQ,circOut:Y3,backIn:DT,backInOut:BQ,backOut:Q3,anticipate:jQ},BR=t=>{if(Array.isArray(t)){$T(t.length===4);const[e,n,s,r]=t;return Dp(e,n,s,r)}else if(typeof t=="string")return VQ[t];return t},OT=(t,e)=>n=>!!($p(n)&&VY.test(n)&&n.startsWith(t)||e&&Object.prototype.hasOwnProperty.call(n,e)),Z3=(t,e,n)=>s=>{if(!$p(s))return s;const[r,i,o,a]=s.match(vb);return{[t]:parseFloat(r),[e]:parseFloat(i),[n]:parseFloat(o),alpha:a!==void 0?parseFloat(a):1}},UQ=t=>rl(0,255,t),ow={...qc,transform:t=>Math.round(UQ(t))},Zl={test:OT("rgb","red"),parse:Z3("red","green","blue"),transform:({red:t,green:e,blue:n,alpha:s=1})=>"rgba("+ow.transform(t)+", "+ow.transform(e)+", "+ow.transform(n)+", "+df(uf.transform(s))+")"};function WQ(t){let e="",n="",s="",r="";return t.length>5?(e=t.substring(1,3),n=t.substring(3,5),s=t.substring(5,7),r=t.substring(7,9)):(e=t.substring(1,2),n=t.substring(2,3),s=t.substring(3,4),r=t.substring(4,5),e+=e,n+=n,s+=s,r+=r),{red:parseInt(e,16),green:parseInt(n,16),blue:parseInt(s,16),alpha:r?parseInt(r,16)/255:1}}const Tk={test:OT("#"),parse:WQ,transform:Zl.transform},Uu={test:OT("hsl","hue"),parse:Z3("hue","saturation","lightness"),transform:({hue:t,saturation:e,lightness:n,alpha:s=1})=>"hsla("+Math.round(t)+", "+io.transform(df(e))+", "+io.transform(df(n))+", "+df(uf.transform(s))+")"},Is={test:t=>Zl.test(t)||Tk.test(t)||Uu.test(t),parse:t=>Zl.test(t)?Zl.parse(t):Uu.test(t)?Uu.parse(t):Tk.parse(t),transform:t=>$p(t)?t:t.hasOwnProperty("red")?Zl.transform(t):Uu.transform(t)},Ut=(t,e,n)=>-n*t+n*e+t;function aw(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*(2/3-n)*6:t}function HQ({hue:t,saturation:e,lightness:n,alpha:s}){t/=360,e/=100,n/=100;let r=0,i=0,o=0;if(!e)r=i=o=n;else{const a=n<.5?n*(1+e):n+e-n*e,l=2*n-a;r=aw(l,a,t+1/3),i=aw(l,a,t),o=aw(l,a,t-1/3)}return{red:Math.round(r*255),green:Math.round(i*255),blue:Math.round(o*255),alpha:s}}const lw=(t,e,n)=>{const s=t*t;return Math.sqrt(Math.max(0,n*(e*e-s)+s))},GQ=[Tk,Zl,Uu],KQ=t=>GQ.find(e=>e.test(t));function jR(t){const e=KQ(t);let n=e.parse(t);return e===Uu&&(n=HQ(n)),n}const ez=(t,e)=>{const n=jR(t),s=jR(e),r={...n};return i=>(r.red=lw(n.red,s.red,i),r.green=lw(n.green,s.green,i),r.blue=lw(n.blue,s.blue,i),r.alpha=Ut(n.alpha,s.alpha,i),Zl.transform(r))};function qQ(t){var e,n;return isNaN(t)&&$p(t)&&(((e=t.match(vb))===null||e===void 0?void 0:e.length)||0)+(((n=t.match(E3))===null||n===void 0?void 0:n.length)||0)>0}const tz={regex:BY,countKey:"Vars",token:"${v}",parse:Qt},nz={regex:E3,countKey:"Colors",token:"${c}",parse:Is.parse},sz={regex:vb,countKey:"Numbers",token:"${n}",parse:qc.parse};function cw(t,{regex:e,countKey:n,token:s,parse:r}){const i=t.tokenised.match(e);i&&(t["num"+n]=i.length,t.tokenised=t.tokenised.replace(e,s),t.values.push(...i.map(r)))}function x0(t){const e=t.toString(),n={value:e,tokenised:e,values:[],numVars:0,numColors:0,numNumbers:0};return n.value.includes("var(--")&&cw(n,tz),cw(n,nz),cw(n,sz),n}function rz(t){return x0(t).values}function iz(t){const{values:e,numColors:n,numVars:s,tokenised:r}=x0(t),i=e.length;return o=>{let a=r;for(let l=0;l<i;l++)l<s?a=a.replace(tz.token,o[l]):l<s+n?a=a.replace(nz.token,Is.transform(o[l])):a=a.replace(sz.token,df(o[l]));return a}}const XQ=t=>typeof t=="number"?0:t;function JQ(t){const e=rz(t);return iz(t)(e.map(XQ))}const il={test:qQ,parse:rz,createTransformer:iz,getAnimatableNone:JQ},oz=(t,e)=>n=>`${n>0?e:t}`;function az(t,e){return typeof t=="number"?n=>Ut(t,e,n):Is.test(t)?ez(t,e):t.startsWith("var(")?oz(t,e):cz(t,e)}const lz=(t,e)=>{const n=[...t],s=n.length,r=t.map((i,o)=>az(i,e[o]));return i=>{for(let o=0;o<s;o++)n[o]=r[o](i);return n}},YQ=(t,e)=>{const n={...t,...e},s={};for(const r in n)t[r]!==void 0&&e[r]!==void 0&&(s[r]=az(t[r],e[r]));return r=>{for(const i in s)n[i]=s[i](r);return n}},cz=(t,e)=>{const n=il.createTransformer(e),s=x0(t),r=x0(e);return s.numVars===r.numVars&&s.numColors===r.numColors&&s.numNumbers>=r.numNumbers?Ga(lz(s.values,r.values),n):oz(t,e)},Xf=(t,e,n)=>{const s=e-t;return s===0?1:(n-t)/s},VR=(t,e)=>n=>Ut(t,e,n);function QQ(t){return typeof t=="number"?VR:typeof t=="string"?Is.test(t)?ez:cz:Array.isArray(t)?lz:typeof t=="object"?YQ:VR}function ZQ(t,e,n){const s=[],r=n||QQ(t[0]),i=t.length-1;for(let o=0;o<i;o++){let a=r(t[o],t[o+1]);if(e){const l=Array.isArray(e)?e[o]||Qt:e;a=Ga(l,a)}s.push(a)}return s}function uz(t,e,{clamp:n=!0,ease:s,mixer:r}={}){const i=t.length;if($T(i===e.length),i===1)return()=>e[0];t[0]>t[i-1]&&(t=[...t].reverse(),e=[...e].reverse());const o=ZQ(e,s,r),a=o.length,l=c=>{let u=0;if(a>1)for(;u<t.length-2&&!(c<t[u+1]);u++);const d=Xf(t[u],t[u+1],c);return o[u](d)};return n?c=>l(rl(t[0],t[i-1],c)):l}function eZ(t,e){const n=t[t.length-1];for(let s=1;s<=e;s++){const r=Xf(0,e,s);t.push(Ut(n,1,r))}}function tZ(t){const e=[0];return eZ(e,t.length-1),e}function nZ(t,e){return t.map(n=>n*e)}function sZ(t,e){return t.map(()=>e||q3).splice(0,t.length-1)}function b0({duration:t=300,keyframes:e,times:n,ease:s="easeInOut"}){const r=_Q(s)?s.map(BR):BR(s),i={done:!1,value:e[0]},o=nZ(n&&n.length===e.length?n:tZ(e),t),a=uz(o,e,{ease:Array.isArray(r)?r:sZ(e,r)});return{calculatedDuration:t,next:l=>(i.value=a(l),i.done=l>=t,i)}}function dz(t,e){return e?t*(1e3/e):0}const rZ=5;function hz(t,e,n){const s=Math.max(e-rZ,0);return dz(n-t(s),e-s)}const uw=.001,iZ=.01,UR=10,oZ=.05,aZ=1;function lZ({duration:t=800,bounce:e=.25,velocity:n=0,mass:s=1}){let r,i;AQ(t<=Ka(UR));let o=1-e;o=rl(oZ,aZ,o),t=rl(iZ,UR,Ko(t)),o<1?(r=c=>{const u=c*o,d=u*t,h=u-n,f=Ek(c,o),p=Math.exp(-d);return uw-h/f*p},i=c=>{const d=c*o*t,h=d*n+n,f=Math.pow(o,2)*Math.pow(c,2)*t,p=Math.exp(-d),m=Ek(Math.pow(c,2),o);return(-r(c)+uw>0?-1:1)*((h-f)*p)/m}):(r=c=>{const u=Math.exp(-c*t),d=(c-n)*t+1;return-uw+u*d},i=c=>{const u=Math.exp(-c*t),d=(n-c)*(t*t);return u*d});const a=5/t,l=uZ(r,i,a);if(t=Ka(t),isNaN(l))return{stiffness:100,damping:10,duration:t};{const c=Math.pow(l,2)*s;return{stiffness:c,damping:o*2*Math.sqrt(s*c),duration:t}}}const cZ=12;function uZ(t,e,n){let s=n;for(let r=1;r<cZ;r++)s=s-t(s)/e(s);return s}function Ek(t,e){return t*Math.sqrt(1-e*e)}const dZ=["duration","bounce"],hZ=["stiffness","damping","mass"];function WR(t,e){return e.some(n=>t[n]!==void 0)}function fZ(t){let e={velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1,...t};if(!WR(t,hZ)&&WR(t,dZ)){const n=lZ(t);e={...e,...n,mass:1},e.isResolvedFromDuration=!0}return e}function fz({keyframes:t,restDelta:e,restSpeed:n,...s}){const r=t[0],i=t[t.length-1],o={done:!1,value:r},{stiffness:a,damping:l,mass:c,duration:u,velocity:d,isResolvedFromDuration:h}=fZ({...s,velocity:-Ko(s.velocity||0)}),f=d||0,p=l/(2*Math.sqrt(a*c)),m=i-r,g=Ko(Math.sqrt(a/c)),y=Math.abs(m)<5;n||(n=y?.01:2),e||(e=y?.005:.5);let x;if(p<1){const v=Ek(g,p);x=w=>{const S=Math.exp(-p*g*w);return i-S*((f+p*g*m)/v*Math.sin(v*w)+m*Math.cos(v*w))}}else if(p===1)x=v=>i-Math.exp(-g*v)*(m+(f+g*m)*v);else{const v=g*Math.sqrt(p*p-1);x=w=>{const S=Math.exp(-p*g*w),k=Math.min(v*w,300);return i-S*((f+p*g*m)*Math.sinh(k)+v*m*Math.cosh(k))/v}}return{calculatedDuration:h&&u||null,next:v=>{const w=x(v);if(h)o.done=v>=u;else{let S=f;v!==0&&(p<1?S=hz(x,v,w):S=0);const k=Math.abs(S)<=n,C=Math.abs(i-w)<=e;o.done=k&&C}return o.value=o.done?i:w,o}}}function HR({keyframes:t,velocity:e=0,power:n=.8,timeConstant:s=325,bounceDamping:r=10,bounceStiffness:i=500,modifyTarget:o,min:a,max:l,restDelta:c=.5,restSpeed:u}){const d=t[0],h={done:!1,value:d},f=N=>a!==void 0&&N<a||l!==void 0&&N>l,p=N=>a===void 0?l:l===void 0||Math.abs(a-N)<Math.abs(l-N)?a:l;let m=n*e;const g=d+m,y=o===void 0?g:o(g);y!==g&&(m=y-d);const x=N=>-m*Math.exp(-N/s),v=N=>y+x(N),w=N=>{const T=x(N),I=v(N);h.done=Math.abs(T)<=c,h.value=h.done?y:I};let S,k;const C=N=>{f(h.value)&&(S=N,k=fz({keyframes:[h.value,p(h.value)],velocity:hz(v,N,h.value),damping:r,stiffness:i,restDelta:c,restSpeed:u}))};return C(0),{calculatedDuration:null,next:N=>{let T=!1;return!k&&S===void 0&&(T=!0,w(N),C(N)),S!==void 0&&N>S?k.next(N-S):(!T&&w(N),h)}}}const pZ=t=>{const e=({timestamp:n})=>t(n);return{start:()=>Dt.update(e,!0),stop:()=>ta(e),now:()=>hs.isProcessing?hs.timestamp:performance.now()}},GR=2e4;function KR(t){let e=0;const n=50;let s=t.next(e);for(;!s.done&&e<GR;)e+=n,s=t.next(e);return e>=GR?1/0:e}const mZ={decay:HR,inertia:HR,tween:b0,keyframes:b0,spring:fz};function v0({autoplay:t=!0,delay:e=0,driver:n=pZ,keyframes:s,type:r="keyframes",repeat:i=0,repeatDelay:o=0,repeatType:a="loop",onPlay:l,onStop:c,onComplete:u,onUpdate:d,...h}){let f=1,p=!1,m,g;const y=()=>{g=new Promise(j=>{m=j})};y();let x;const v=mZ[r]||b0;let w;v!==b0&&typeof s[0]!="number"&&(w=uz([0,100],s,{clamp:!1}),s=[0,100]);const S=v({...h,keyframes:s});let k;a==="mirror"&&(k=v({...h,keyframes:[...s].reverse(),velocity:-(h.velocity||0)}));let C="idle",N=null,T=null,I=null;S.calculatedDuration===null&&i&&(S.calculatedDuration=KR(S));const{calculatedDuration:D}=S;let F=1/0,A=1/0;D!==null&&(F=D+o,A=F*(i+1)-o);let O=0;const P=j=>{if(T===null)return;f>0&&(T=Math.min(T,j)),f<0&&(T=Math.min(j-A/f,T)),N!==null?O=N:O=Math.round(j-T)*f;const ee=O-e*(f>=0?1:-1),Z=f>=0?ee<0:ee>A;O=Math.max(ee,0),C==="finished"&&N===null&&(O=A);let re=O,te=S;if(i){const xe=Math.min(O,A)/F;let Ne=Math.floor(xe),Ae=xe%1;!Ae&&xe>=1&&(Ae=1),Ae===1&&Ne--,Ne=Math.min(Ne,i+1),!!(Ne%2)&&(a==="reverse"?(Ae=1-Ae,o&&(Ae-=o/F)):a==="mirror"&&(te=k)),re=rl(0,1,Ae)*F}const le=Z?{done:!1,value:s[0]}:te.next(re);w&&(le.value=w(le.value));let{done:pe}=le;!Z&&D!==null&&(pe=f>=0?O>=A:O<=0);const we=N===null&&(C==="finished"||C==="running"&&pe);return d&&d(le.value),we&&$(),le},L=()=>{x&&x.stop(),x=void 0},G=()=>{C="idle",L(),m(),y(),T=I=null},$=()=>{C="finished",u&&u(),L(),m()},U=()=>{if(p)return;x||(x=n(P));const j=x.now();l&&l(),N!==null?T=j-N:(!T||C==="finished")&&(T=j),C==="finished"&&y(),I=T,N=null,C="running",x.start()};t&&U();const K={then(j,ee){return g.then(j,ee)},get time(){return Ko(O)},set time(j){j=Ka(j),O=j,N!==null||!x||f===0?N=j:T=x.now()-j/f},get duration(){const j=S.calculatedDuration===null?KR(S):S.calculatedDuration;return Ko(j)},get speed(){return f},set speed(j){j===f||!x||(f=j,K.time=Ko(O))},get state(){return C},play:U,pause:()=>{C="paused",N=O},stop:()=>{p=!0,C!=="idle"&&(C="idle",c&&c(),G())},cancel:()=>{I!==null&&P(I),G()},complete:()=>{C="finished"},sample:j=>(T=0,P(j))};return K}function gZ(t){let e;return()=>(e===void 0&&(e=t()),e)}const yZ=gZ(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),xZ=new Set(["opacity","clipPath","filter","transform","backgroundColor"]),Ig=10,bZ=2e4,vZ=(t,e)=>e.type==="spring"||t==="backgroundColor"||!W3(e.ease);function wZ(t,e,{onUpdate:n,onComplete:s,...r}){if(!(yZ()&&xZ.has(e)&&!r.repeatDelay&&r.repeatType!=="mirror"&&r.damping!==0&&r.type!=="inertia"))return!1;let o=!1,a,l,c=!1;const u=()=>{l=new Promise(v=>{a=v})};u();let{keyframes:d,duration:h=300,ease:f,times:p}=r;if(vZ(e,r)){const v=v0({...r,repeat:0,delay:0});let w={done:!1,value:d[0]};const S=[];let k=0;for(;!w.done&&k<bZ;)w=v.sample(k),S.push(w.value),k+=Ig;p=void 0,d=S,h=k-Ig,f="linear"}const m=RQ(t.owner.current,e,d,{...r,duration:h,ease:f,times:p}),g=()=>{c=!1,m.cancel()},y=()=>{c=!0,Dt.update(g),a(),u()};return m.onfinish=()=>{c||(t.set(DQ(d,r)),s&&s(),y())},{then(v,w){return l.then(v,w)},attachTimeline(v){return m.timeline=v,m.onfinish=null,Qt},get time(){return Ko(m.currentTime||0)},set time(v){m.currentTime=Ka(v)},get speed(){return m.playbackRate},set speed(v){m.playbackRate=v},get duration(){return Ko(h)},play:()=>{o||(m.play(),ta(g))},pause:()=>m.pause(),stop:()=>{if(o=!0,m.playState==="idle")return;const{currentTime:v}=m;if(v){const w=v0({...r,autoplay:!1});t.setWithVelocity(w.sample(v-Ig).value,w.sample(v).value,Ig)}y()},complete:()=>{c||m.finish()},cancel:y}}function SZ({keyframes:t,delay:e,onUpdate:n,onComplete:s}){const r=()=>(n&&n(t[t.length-1]),s&&s(),{time:0,speed:1,duration:0,play:Qt,pause:Qt,stop:Qt,then:i=>(i(),Promise.resolve()),cancel:Qt,complete:Qt});return e?v0({keyframes:[0,1],duration:0,delay:e,onComplete:r}):r()}const kZ={type:"spring",stiffness:500,damping:25,restSpeed:10},CZ=t=>({type:"spring",stiffness:550,damping:t===0?2*Math.sqrt(550):30,restSpeed:10}),NZ={type:"keyframes",duration:.8},TZ={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},EZ=(t,{keyframes:e})=>e.length>2?NZ:Kc.has(t)?t.startsWith("scale")?CZ(e[1]):kZ:TZ,Ik=(t,e)=>t==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(il.test(e)||e==="0")&&!e.startsWith("url(")),IZ=new Set(["brightness","contrast","saturate","opacity"]);function AZ(t){const[e,n]=t.slice(0,-1).split("(");if(e==="drop-shadow")return t;const[s]=n.match(vb)||[];if(!s)return t;const r=n.replace(s,"");let i=IZ.has(e)?1:0;return s!==n&&(i*=100),e+"("+i+r+")"}const $Z=/([a-z-]*)\(.*?\)/g,Ak={...il,getAnimatableNone:t=>{const e=t.match($Z);return e?e.map(AZ).join(" "):t}},RZ={...I3,color:Is,backgroundColor:Is,outlineColor:Is,fill:Is,stroke:Is,borderColor:Is,borderTopColor:Is,borderRightColor:Is,borderBottomColor:Is,borderLeftColor:Is,filter:Ak,WebkitFilter:Ak},MT=t=>RZ[t];function pz(t,e){let n=MT(t);return n!==Ak&&(n=il),n.getAnimatableNone?n.getAnimatableNone(e):void 0}const mz=t=>/^0[^.\s]+$/.test(t);function DZ(t){if(typeof t=="number")return t===0;if(t!==null)return t==="none"||t==="0"||mz(t)}function OZ(t,e,n,s){const r=Ik(e,n);let i;Array.isArray(n)?i=[...n]:i=[null,n];const o=s.from!==void 0?s.from:t.get();let a;const l=[];for(let c=0;c<i.length;c++)i[c]===null&&(i[c]=c===0?o:i[c-1]),DZ(i[c])&&l.push(c),typeof i[c]=="string"&&i[c]!=="none"&&i[c]!=="0"&&(a=i[c]);if(r&&l.length&&a)for(let c=0;c<l.length;c++){const u=l[c];i[u]=pz(e,a)}return i}function MZ({when:t,delay:e,delayChildren:n,staggerChildren:s,staggerDirection:r,repeat:i,repeatType:o,repeatDelay:a,from:l,elapsed:c,...u}){return!!Object.keys(u).length}function PT(t,e){return t[e]||t.default||t}const PZ={skipAnimations:!1},LT=(t,e,n,s={})=>r=>{const i=PT(s,t)||{},o=i.delay||s.delay||0;let{elapsed:a=0}=s;a=a-Ka(o);const l=OZ(e,t,n,i),c=l[0],u=l[l.length-1],d=Ik(t,c),h=Ik(t,u);let f={keyframes:l,velocity:e.getVelocity(),ease:"easeOut",...i,delay:-a,onUpdate:p=>{e.set(p),i.onUpdate&&i.onUpdate(p)},onComplete:()=>{r(),i.onComplete&&i.onComplete()}};if(MZ(i)||(f={...f,...EZ(t,f)}),f.duration&&(f.duration=Ka(f.duration)),f.repeatDelay&&(f.repeatDelay=Ka(f.repeatDelay)),!d||!h||$Q.current||i.type===!1||PZ.skipAnimations)return SZ(f);if(!s.isHandoff&&e.owner&&e.owner.current instanceof HTMLElement&&!e.owner.getProps().onUpdate){const p=wZ(e,t,f);if(p)return p}return v0(f)};function w0(t){return!!(ar(t)&&t.add)}const gz=t=>/^\-?\d*\.?\d+$/.test(t);function FT(t,e){t.indexOf(e)===-1&&t.push(e)}function _T(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}class zT{constructor(){this.subscriptions=[]}add(e){return FT(this.subscriptions,e),()=>_T(this.subscriptions,e)}notify(e,n,s){const r=this.subscriptions.length;if(r)if(r===1)this.subscriptions[0](e,n,s);else for(let i=0;i<r;i++){const o=this.subscriptions[i];o&&o(e,n,s)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const LZ=t=>!isNaN(parseFloat(t));class FZ{constructor(e,n={}){this.version="10.18.0",this.timeDelta=0,this.lastUpdated=0,this.canTrackVelocity=!1,this.events={},this.updateAndNotify=(s,r=!0)=>{this.prev=this.current,this.current=s;const{delta:i,timestamp:o}=hs;this.lastUpdated!==o&&(this.timeDelta=i,this.lastUpdated=o,Dt.postRender(this.scheduleVelocityCheck)),this.prev!==this.current&&this.events.change&&this.events.change.notify(this.current),this.events.velocityChange&&this.events.velocityChange.notify(this.getVelocity()),r&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.scheduleVelocityCheck=()=>Dt.postRender(this.velocityCheck),this.velocityCheck=({timestamp:s})=>{s!==this.lastUpdated&&(this.prev=this.current,this.events.velocityChange&&this.events.velocityChange.notify(this.getVelocity()))},this.hasAnimated=!1,this.prev=this.current=e,this.canTrackVelocity=LZ(this.current),this.owner=n.owner}onChange(e){return this.on("change",e)}on(e,n){this.events[e]||(this.events[e]=new zT);const s=this.events[e].add(n);return e==="change"?()=>{s(),Dt.read(()=>{this.events.change.getSize()||this.stop()})}:s}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,n){this.passiveEffect=e,this.stopPassiveEffect=n}set(e,n=!0){!n||!this.passiveEffect?this.updateAndNotify(e,n):this.passiveEffect(e,this.updateAndNotify)}setWithVelocity(e,n,s){this.set(n),this.prev=e,this.timeDelta=s}jump(e){this.updateAndNotify(e),this.prev=e,this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){return this.canTrackVelocity?dz(parseFloat(this.current)-parseFloat(this.prev),this.timeDelta):0}start(e){return this.stop(),new Promise(n=>{this.hasAnimated=!0,this.animation=e(n),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function xd(t,e){return new FZ(t,e)}const yz=t=>e=>e.test(t),_Z={test:t=>t==="auto",parse:t=>t},xz=[qc,Me,io,ma,WY,UY,_Z],kh=t=>xz.find(yz(t)),zZ=[...xz,Is,il],BZ=t=>zZ.find(yz(t));function jZ(t,e,n){t.hasValue(e)?t.getValue(e).set(n):t.addValue(e,xd(n))}function VZ(t,e){const n=Sb(t,e);let{transitionEnd:s={},transition:r={},...i}=n?t.makeTargetAnimatable(n,!1):{};i={...i,...s};for(const o in i){const a=iQ(i[o]);jZ(t,o,a)}}function UZ(t,e,n){var s,r;const i=Object.keys(e).filter(a=>!t.hasValue(a)),o=i.length;if(o)for(let a=0;a<o;a++){const l=i[a],c=e[l];let u=null;Array.isArray(c)&&(u=c[0]),u===null&&(u=(r=(s=n[l])!==null&&s!==void 0?s:t.readValue(l))!==null&&r!==void 0?r:e[l]),u!=null&&(typeof u=="string"&&(gz(u)||mz(u))?u=parseFloat(u):!BZ(u)&&il.test(c)&&(u=pz(l,c)),t.addValue(l,xd(u,{owner:t})),n[l]===void 0&&(n[l]=u),u!==null&&t.setBaseTarget(l,u))}}function WZ(t,e){return e?(e[t]||e.default||e).from:void 0}function HZ(t,e,n){const s={};for(const r in t){const i=WZ(r,e);if(i!==void 0)s[r]=i;else{const o=n.getValue(r);o&&(s[r]=o.get())}}return s}function GZ({protectedKeys:t,needsAnimating:e},n){const s=t.hasOwnProperty(n)&&e[n]!==!0;return e[n]=!1,s}function KZ(t,e){const n=t.get();if(Array.isArray(e)){for(let s=0;s<e.length;s++)if(e[s]!==n)return!0}else return n!==e}function bz(t,e,{delay:n=0,transitionOverride:s,type:r}={}){let{transition:i=t.getDefaultTransition(),transitionEnd:o,...a}=t.makeTargetAnimatable(e);const l=t.getValue("willChange");s&&(i=s);const c=[],u=r&&t.animationState&&t.animationState.getState()[r];for(const d in a){const h=t.getValue(d),f=a[d];if(!h||f===void 0||u&&GZ(u,d))continue;const p={delay:n,elapsed:0,...PT(i||{},d)};if(window.HandoffAppearAnimations){const y=t.getProps()[v3];if(y){const x=window.HandoffAppearAnimations(y,d,h,Dt);x!==null&&(p.elapsed=x,p.isHandoff=!0)}}let m=!p.isHandoff&&!KZ(h,f);if(p.type==="spring"&&(h.getVelocity()||p.velocity)&&(m=!1),h.animation&&(m=!1),m)continue;h.start(LT(d,h,f,t.shouldReduceMotion&&Kc.has(d)?{type:!1}:p));const g=h.animation;w0(l)&&(l.add(d),g.then(()=>l.remove(d))),c.push(g)}return o&&Promise.all(c).then(()=>{o&&VZ(t,o)}),c}function $k(t,e,n={}){const s=Sb(t,e,n.custom);let{transition:r=t.getDefaultTransition()||{}}=s||{};n.transitionOverride&&(r=n.transitionOverride);const i=s?()=>Promise.all(bz(t,s,n)):()=>Promise.resolve(),o=t.variantChildren&&t.variantChildren.size?(l=0)=>{const{delayChildren:c=0,staggerChildren:u,staggerDirection:d}=r;return qZ(t,e,c+l,u,d,n)}:()=>Promise.resolve(),{when:a}=r;if(a){const[l,c]=a==="beforeChildren"?[i,o]:[o,i];return l().then(()=>c())}else return Promise.all([i(),o(n.delay)])}function qZ(t,e,n=0,s=0,r=1,i){const o=[],a=(t.variantChildren.size-1)*s,l=r===1?(c=0)=>c*s:(c=0)=>a-c*s;return Array.from(t.variantChildren).sort(XZ).forEach((c,u)=>{c.notify("AnimationStart",e),o.push($k(c,e,{...i,delay:n+l(u)}).then(()=>c.notify("AnimationComplete",e)))}),Promise.all(o)}function XZ(t,e){return t.sortNodePosition(e)}function JZ(t,e,n={}){t.notify("AnimationStart",e);let s;if(Array.isArray(e)){const r=e.map(i=>$k(t,i,n));s=Promise.all(r)}else if(typeof e=="string")s=$k(t,e,n);else{const r=typeof e=="function"?Sb(t,e,n.custom):e;s=Promise.all(bz(t,r,n))}return s.then(()=>t.notify("AnimationComplete",e))}const YZ=[...wT].reverse(),QZ=wT.length;function ZZ(t){return e=>Promise.all(e.map(({animation:n,options:s})=>JZ(t,n,s)))}function eee(t){let e=ZZ(t);const n=nee();let s=!0;const r=(l,c)=>{const u=Sb(t,c);if(u){const{transition:d,transitionEnd:h,...f}=u;l={...l,...f,...h}}return l};function i(l){e=l(t)}function o(l,c){const u=t.getProps(),d=t.getVariantContext(!0)||{},h=[],f=new Set;let p={},m=1/0;for(let y=0;y<QZ;y++){const x=YZ[y],v=n[x],w=u[x]!==void 0?u[x]:d[x],S=Kf(w),k=x===c?v.isActive:null;k===!1&&(m=y);let C=w===d[x]&&w!==u[x]&&S;if(C&&s&&t.manuallyAnimateOnMount&&(C=!1),v.protectedKeys={...p},!v.isActive&&k===null||!w&&!v.prevProp||xb(w)||typeof w=="boolean")continue;let T=tee(v.prevProp,w)||x===c&&v.isActive&&!C&&S||y>m&&S,I=!1;const D=Array.isArray(w)?w:[w];let F=D.reduce(r,{});k===!1&&(F={});const{prevResolvedValues:A={}}=v,O={...A,...F},P=L=>{T=!0,f.has(L)&&(I=!0,f.delete(L)),v.needsAnimating[L]=!0};for(const L in O){const G=F[L],$=A[L];if(p.hasOwnProperty(L))continue;let U=!1;y0(G)&&y0($)?U=!V3(G,$):U=G!==$,U?G!==void 0?P(L):f.add(L):G!==void 0&&f.has(L)?P(L):v.protectedKeys[L]=!0}v.prevProp=w,v.prevResolvedValues=F,v.isActive&&(p={...p,...F}),s&&t.blockInitialAnimation&&(T=!1),T&&(!C||I)&&h.push(...D.map(L=>({animation:L,options:{type:x,...l}})))}if(f.size){const y={};f.forEach(x=>{const v=t.getBaseTarget(x);v!==void 0&&(y[x]=v)}),h.push({animation:y})}let g=!!h.length;return s&&(u.initial===!1||u.initial===u.animate)&&!t.manuallyAnimateOnMount&&(g=!1),s=!1,g?e(h):Promise.resolve()}function a(l,c,u){var d;if(n[l].isActive===c)return Promise.resolve();(d=t.variantChildren)===null||d===void 0||d.forEach(f=>{var p;return(p=f.animationState)===null||p===void 0?void 0:p.setActive(l,c)}),n[l].isActive=c;const h=o(u,l);for(const f in n)n[f].protectedKeys={};return h}return{animateChanges:o,setActive:a,setAnimateFunction:i,getState:()=>n}}function tee(t,e){return typeof e=="string"?e!==t:Array.isArray(e)?!V3(e,t):!1}function Pl(t=!1){return{isActive:t,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function nee(){return{animate:Pl(!0),whileInView:Pl(),whileHover:Pl(),whileTap:Pl(),whileDrag:Pl(),whileFocus:Pl(),exit:Pl()}}class see extends xl{constructor(e){super(e),e.animationState||(e.animationState=eee(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();this.unmount(),xb(e)&&(this.unmount=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:n}=this.node.prevProps||{};e!==n&&this.updateAnimationControlsSubscription()}unmount(){}}let ree=0;class iee extends xl{constructor(){super(...arguments),this.id=ree++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:n,custom:s}=this.node.presenceContext,{isPresent:r}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===r)return;const i=this.node.animationState.setActive("exit",!e,{custom:s??this.node.getProps().custom});n&&!e&&i.then(()=>n(this.id))}mount(){const{register:e}=this.node.presenceContext||{};e&&(this.unmount=e(this.id))}unmount(){}}const oee={animation:{Feature:see},exit:{Feature:iee}},qR=(t,e)=>Math.abs(t-e);function aee(t,e){const n=qR(t.x,e.x),s=qR(t.y,e.y);return Math.sqrt(n**2+s**2)}class vz{constructor(e,n,{transformPagePoint:s,contextWindow:r,dragSnapToOrigin:i=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const d=hw(this.lastMoveEventInfo,this.history),h=this.startEvent!==null,f=aee(d.offset,{x:0,y:0})>=3;if(!h&&!f)return;const{point:p}=d,{timestamp:m}=hs;this.history.push({...p,timestamp:m});const{onStart:g,onMove:y}=this.handlers;h||(g&&g(this.lastMoveEvent,d),this.startEvent=this.lastMoveEvent),y&&y(this.lastMoveEvent,d)},this.handlePointerMove=(d,h)=>{this.lastMoveEvent=d,this.lastMoveEventInfo=dw(h,this.transformPagePoint),Dt.update(this.updatePoint,!0)},this.handlePointerUp=(d,h)=>{this.end();const{onEnd:f,onSessionEnd:p,resumeAnimation:m}=this.handlers;if(this.dragSnapToOrigin&&m&&m(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const g=hw(d.type==="pointercancel"?this.lastMoveEventInfo:dw(h,this.transformPagePoint),this.history);this.startEvent&&f&&f(d,g),p&&p(d,g)},!F3(e))return;this.dragSnapToOrigin=i,this.handlers=n,this.transformPagePoint=s,this.contextWindow=r||window;const o=wb(e),a=dw(o,this.transformPagePoint),{point:l}=a,{timestamp:c}=hs;this.history=[{...l,timestamp:c}];const{onSessionStart:u}=n;u&&u(e,hw(a,this.history)),this.removeListeners=Ga(Go(this.contextWindow,"pointermove",this.handlePointerMove),Go(this.contextWindow,"pointerup",this.handlePointerUp),Go(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),ta(this.updatePoint)}}function dw(t,e){return e?{point:e(t.point)}:t}function XR(t,e){return{x:t.x-e.x,y:t.y-e.y}}function hw({point:t},e){return{point:t,delta:XR(t,wz(e)),offset:XR(t,lee(e)),velocity:cee(e,.1)}}function lee(t){return t[0]}function wz(t){return t[t.length-1]}function cee(t,e){if(t.length<2)return{x:0,y:0};let n=t.length-1,s=null;const r=wz(t);for(;n>=0&&(s=t[n],!(r.timestamp-s.timestamp>Ka(e)));)n--;if(!s)return{x:0,y:0};const i=Ko(r.timestamp-s.timestamp);if(i===0)return{x:0,y:0};const o={x:(r.x-s.x)/i,y:(r.y-s.y)/i};return o.x===1/0&&(o.x=0),o.y===1/0&&(o.y=0),o}function kr(t){return t.max-t.min}function Rk(t,e=0,n=.01){return Math.abs(t-e)<=n}function JR(t,e,n,s=.5){t.origin=s,t.originPoint=Ut(e.min,e.max,t.origin),t.scale=kr(n)/kr(e),(Rk(t.scale,1,1e-4)||isNaN(t.scale))&&(t.scale=1),t.translate=Ut(n.min,n.max,t.origin)-t.originPoint,(Rk(t.translate)||isNaN(t.translate))&&(t.translate=0)}function hf(t,e,n,s){JR(t.x,e.x,n.x,s?s.originX:void 0),JR(t.y,e.y,n.y,s?s.originY:void 0)}function YR(t,e,n){t.min=n.min+e.min,t.max=t.min+kr(e)}function uee(t,e,n){YR(t.x,e.x,n.x),YR(t.y,e.y,n.y)}function QR(t,e,n){t.min=e.min-n.min,t.max=t.min+kr(e)}function ff(t,e,n){QR(t.x,e.x,n.x),QR(t.y,e.y,n.y)}function dee(t,{min:e,max:n},s){return e!==void 0&&t<e?t=s?Ut(e,t,s.min):Math.max(t,e):n!==void 0&&t>n&&(t=s?Ut(n,t,s.max):Math.min(t,n)),t}function ZR(t,e,n){return{min:e!==void 0?t.min+e:void 0,max:n!==void 0?t.max+n-(t.max-t.min):void 0}}function hee(t,{top:e,left:n,bottom:s,right:r}){return{x:ZR(t.x,n,r),y:ZR(t.y,e,s)}}function eD(t,e){let n=e.min-t.min,s=e.max-t.max;return e.max-e.min<t.max-t.min&&([n,s]=[s,n]),{min:n,max:s}}function fee(t,e){return{x:eD(t.x,e.x),y:eD(t.y,e.y)}}function pee(t,e){let n=.5;const s=kr(t),r=kr(e);return r>s?n=Xf(e.min,e.max-s,t.min):s>r&&(n=Xf(t.min,t.max-r,e.min)),rl(0,1,n)}function mee(t,e){const n={};return e.min!==void 0&&(n.min=e.min-t.min),e.max!==void 0&&(n.max=e.max-t.min),n}const Dk=.35;function gee(t=Dk){return t===!1?t=0:t===!0&&(t=Dk),{x:tD(t,"left","right"),y:tD(t,"top","bottom")}}function tD(t,e,n){return{min:nD(t,e),max:nD(t,n)}}function nD(t,e){return typeof t=="number"?t:t[e]||0}const sD=()=>({translate:0,scale:1,origin:0,originPoint:0}),Wu=()=>({x:sD(),y:sD()}),rD=()=>({min:0,max:0}),fn=()=>({x:rD(),y:rD()});function Lr(t){return[t("x"),t("y")]}function Sz({top:t,left:e,right:n,bottom:s}){return{x:{min:e,max:n},y:{min:t,max:s}}}function yee({x:t,y:e}){return{top:e.min,right:t.max,bottom:e.max,left:t.min}}function xee(t,e){if(!e)return t;const n=e({x:t.left,y:t.top}),s=e({x:t.right,y:t.bottom});return{top:n.y,left:n.x,bottom:s.y,right:s.x}}function fw(t){return t===void 0||t===1}function Ok({scale:t,scaleX:e,scaleY:n}){return!fw(t)||!fw(e)||!fw(n)}function Vl(t){return Ok(t)||kz(t)||t.z||t.rotate||t.rotateX||t.rotateY}function kz(t){return iD(t.x)||iD(t.y)}function iD(t){return t&&t!=="0%"}function S0(t,e,n){const s=t-n,r=e*s;return n+r}function oD(t,e,n,s,r){return r!==void 0&&(t=S0(t,r,s)),S0(t,n,s)+e}function Mk(t,e=0,n=1,s,r){t.min=oD(t.min,e,n,s,r),t.max=oD(t.max,e,n,s,r)}function Cz(t,{x:e,y:n}){Mk(t.x,e.translate,e.scale,e.originPoint),Mk(t.y,n.translate,n.scale,n.originPoint)}function bee(t,e,n,s=!1){const r=n.length;if(!r)return;e.x=e.y=1;let i,o;for(let a=0;a<r;a++){i=n[a],o=i.projectionDelta;const l=i.instance;l&&l.style&&l.style.display==="contents"||(s&&i.options.layoutScroll&&i.scroll&&i!==i.root&&Hu(t,{x:-i.scroll.offset.x,y:-i.scroll.offset.y}),o&&(e.x*=o.x.scale,e.y*=o.y.scale,Cz(t,o)),s&&Vl(i.latestValues)&&Hu(t,i.latestValues))}e.x=aD(e.x),e.y=aD(e.y)}function aD(t){return Number.isInteger(t)||t>1.0000000000001||t<.999999999999?t:1}function ba(t,e){t.min=t.min+e,t.max=t.max+e}function lD(t,e,[n,s,r]){const i=e[r]!==void 0?e[r]:.5,o=Ut(t.min,t.max,i);Mk(t,e[n],e[s],o,e.scale)}const vee=["x","scaleX","originX"],wee=["y","scaleY","originY"];function Hu(t,e){lD(t.x,e,vee),lD(t.y,e,wee)}function Nz(t,e){return Sz(xee(t.getBoundingClientRect(),e))}function See(t,e,n){const s=Nz(t,n),{scroll:r}=e;return r&&(ba(s.x,r.offset.x),ba(s.y,r.offset.y)),s}const Tz=({current:t})=>t?t.ownerDocument.defaultView:null,kee=new WeakMap;class Cee{constructor(e){this.openGlobalLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=fn(),this.visualElement=e}start(e,{snapToCursor:n=!1}={}){const{presenceContext:s}=this.visualElement;if(s&&s.isPresent===!1)return;const r=u=>{const{dragSnapToOrigin:d}=this.getProps();d?this.pauseAnimation():this.stopAnimation(),n&&this.snapToCursor(wb(u,"page").point)},i=(u,d)=>{const{drag:h,dragPropagation:f,onDragStart:p}=this.getProps();if(h&&!f&&(this.openGlobalLock&&this.openGlobalLock(),this.openGlobalLock=z3(h),!this.openGlobalLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Lr(g=>{let y=this.getAxisMotionValue(g).get()||0;if(io.test(y)){const{projection:x}=this.visualElement;if(x&&x.layout){const v=x.layout.layoutBox[g];v&&(y=kr(v)*(parseFloat(y)/100))}}this.originPoint[g]=y}),p&&Dt.update(()=>p(u,d),!1,!0);const{animationState:m}=this.visualElement;m&&m.setActive("whileDrag",!0)},o=(u,d)=>{const{dragPropagation:h,dragDirectionLock:f,onDirectionLock:p,onDrag:m}=this.getProps();if(!h&&!this.openGlobalLock)return;const{offset:g}=d;if(f&&this.currentDirection===null){this.currentDirection=Nee(g),this.currentDirection!==null&&p&&p(this.currentDirection);return}this.updateAxis("x",d.point,g),this.updateAxis("y",d.point,g),this.visualElement.render(),m&&m(u,d)},a=(u,d)=>this.stop(u,d),l=()=>Lr(u=>{var d;return this.getAnimationState(u)==="paused"&&((d=this.getAxisMotionValue(u).animation)===null||d===void 0?void 0:d.play())}),{dragSnapToOrigin:c}=this.getProps();this.panSession=new vz(e,{onSessionStart:r,onStart:i,onMove:o,onSessionEnd:a,resumeAnimation:l},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:c,contextWindow:Tz(this.visualElement)})}stop(e,n){const s=this.isDragging;if(this.cancel(),!s)return;const{velocity:r}=n;this.startAnimation(r);const{onDragEnd:i}=this.getProps();i&&Dt.update(()=>i(e,n))}cancel(){this.isDragging=!1;const{projection:e,animationState:n}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:s}=this.getProps();!s&&this.openGlobalLock&&(this.openGlobalLock(),this.openGlobalLock=null),n&&n.setActive("whileDrag",!1)}updateAxis(e,n,s){const{drag:r}=this.getProps();if(!s||!Ag(e,r,this.currentDirection))return;const i=this.getAxisMotionValue(e);let o=this.originPoint[e]+s[e];this.constraints&&this.constraints[e]&&(o=dee(o,this.constraints[e],this.elastic[e])),i.set(o)}resolveConstraints(){var e;const{dragConstraints:n,dragElastic:s}=this.getProps(),r=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(e=this.visualElement.projection)===null||e===void 0?void 0:e.layout,i=this.constraints;n&&Vu(n)?this.constraints||(this.constraints=this.resolveRefConstraints()):n&&r?this.constraints=hee(r.layoutBox,n):this.constraints=!1,this.elastic=gee(s),i!==this.constraints&&r&&this.constraints&&!this.hasMutatedConstraints&&Lr(o=>{this.getAxisMotionValue(o)&&(this.constraints[o]=mee(r.layoutBox[o],this.constraints[o]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:n}=this.getProps();if(!e||!Vu(e))return!1;const s=e.current,{projection:r}=this.visualElement;if(!r||!r.layout)return!1;const i=See(s,r.root,this.visualElement.getTransformPagePoint());let o=fee(r.layout.layoutBox,i);if(n){const a=n(yee(o));this.hasMutatedConstraints=!!a,a&&(o=Sz(a))}return o}startAnimation(e){const{drag:n,dragMomentum:s,dragElastic:r,dragTransition:i,dragSnapToOrigin:o,onDragTransitionEnd:a}=this.getProps(),l=this.constraints||{},c=Lr(u=>{if(!Ag(u,n,this.currentDirection))return;let d=l&&l[u]||{};o&&(d={min:0,max:0});const h=r?200:1e6,f=r?40:1e7,p={type:"inertia",velocity:s?e[u]:0,bounceStiffness:h,bounceDamping:f,timeConstant:750,restDelta:1,restSpeed:10,...i,...d};return this.startAxisValueAnimation(u,p)});return Promise.all(c).then(a)}startAxisValueAnimation(e,n){const s=this.getAxisMotionValue(e);return s.start(LT(e,s,0,n))}stopAnimation(){Lr(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){Lr(e=>{var n;return(n=this.getAxisMotionValue(e).animation)===null||n===void 0?void 0:n.pause()})}getAnimationState(e){var n;return(n=this.getAxisMotionValue(e).animation)===null||n===void 0?void 0:n.state}getAxisMotionValue(e){const n="_drag"+e.toUpperCase(),s=this.visualElement.getProps(),r=s[n];return r||this.visualElement.getValue(e,(s.initial?s.initial[e]:void 0)||0)}snapToCursor(e){Lr(n=>{const{drag:s}=this.getProps();if(!Ag(n,s,this.currentDirection))return;const{projection:r}=this.visualElement,i=this.getAxisMotionValue(n);if(r&&r.layout){const{min:o,max:a}=r.layout.layoutBox[n];i.set(e[n]-Ut(o,a,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:n}=this.getProps(),{projection:s}=this.visualElement;if(!Vu(n)||!s||!this.constraints)return;this.stopAnimation();const r={x:0,y:0};Lr(o=>{const a=this.getAxisMotionValue(o);if(a){const l=a.get();r[o]=pee({min:l,max:l},this.constraints[o])}});const{transformTemplate:i}=this.visualElement.getProps();this.visualElement.current.style.transform=i?i({},""):"none",s.root&&s.root.updateScroll(),s.updateLayout(),this.resolveConstraints(),Lr(o=>{if(!Ag(o,e,null))return;const a=this.getAxisMotionValue(o),{min:l,max:c}=this.constraints[o];a.set(Ut(l,c,r[o]))})}addListeners(){if(!this.visualElement.current)return;kee.set(this.visualElement,this);const e=this.visualElement.current,n=Go(e,"pointerdown",l=>{const{drag:c,dragListener:u=!0}=this.getProps();c&&u&&this.start(l)}),s=()=>{const{dragConstraints:l}=this.getProps();Vu(l)&&(this.constraints=this.resolveRefConstraints())},{projection:r}=this.visualElement,i=r.addEventListener("measure",s);r&&!r.layout&&(r.root&&r.root.updateScroll(),r.updateLayout()),s();const o=jo(window,"resize",()=>this.scalePositionWithinConstraints()),a=r.addEventListener("didUpdate",({delta:l,hasLayoutChanged:c})=>{this.isDragging&&c&&(Lr(u=>{const d=this.getAxisMotionValue(u);d&&(this.originPoint[u]+=l[u].translate,d.set(d.get()+l[u].translate))}),this.visualElement.render())});return()=>{o(),n(),i(),a&&a()}}getProps(){const e=this.visualElement.getProps(),{drag:n=!1,dragDirectionLock:s=!1,dragPropagation:r=!1,dragConstraints:i=!1,dragElastic:o=Dk,dragMomentum:a=!0}=e;return{...e,drag:n,dragDirectionLock:s,dragPropagation:r,dragConstraints:i,dragElastic:o,dragMomentum:a}}}function Ag(t,e,n){return(e===!0||e===t)&&(n===null||n===t)}function Nee(t,e=10){let n=null;return Math.abs(t.y)>e?n="y":Math.abs(t.x)>e&&(n="x"),n}class Tee extends xl{constructor(e){super(e),this.removeGroupControls=Qt,this.removeListeners=Qt,this.controls=new Cee(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Qt}unmount(){this.removeGroupControls(),this.removeListeners()}}const cD=t=>(e,n)=>{t&&Dt.update(()=>t(e,n))};class Eee extends xl{constructor(){super(...arguments),this.removePointerDownListener=Qt}onPointerDown(e){this.session=new vz(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:Tz(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:n,onPan:s,onPanEnd:r}=this.node.getProps();return{onSessionStart:cD(e),onStart:cD(n),onMove:s,onEnd:(i,o)=>{delete this.session,r&&Dt.update(()=>r(i,o))}}}mount(){this.removePointerDownListener=Go(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}function Iee(){const t=z.useContext(bT);if(t===null)return[!0,null];const{isPresent:e,onExitComplete:n,register:s}=t,r=z.useId();return z.useEffect(()=>s(r),[]),!e&&n?[!1,()=>n&&n(r)]:[!0]}const Iy={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function uD(t,e){return e.max===e.min?0:t/(e.max-e.min)*100}const Ch={correct:(t,e)=>{if(!e.target)return t;if(typeof t=="string")if(Me.test(t))t=parseFloat(t);else return t;const n=uD(t,e.target.x),s=uD(t,e.target.y);return`${n}% ${s}%`}},Aee={correct:(t,{treeScale:e,projectionDelta:n})=>{const s=t,r=il.parse(t);if(r.length>5)return s;const i=il.createTransformer(t),o=typeof r[0]!="number"?1:0,a=n.x.scale*e.x,l=n.y.scale*e.y;r[0+o]/=a,r[1+o]/=l;const c=Ut(a,l,.5);return typeof r[2+o]=="number"&&(r[2+o]/=c),typeof r[3+o]=="number"&&(r[3+o]/=c),i(r)}};class $ee extends Fs.Component{componentDidMount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:s,layoutId:r}=this.props,{projection:i}=e;LY(Ree),i&&(n.group&&n.group.add(i),s&&s.register&&r&&s.register(i),i.root.didUpdate(),i.addEventListener("animationComplete",()=>{this.safeToRemove()}),i.setOptions({...i.options,onExitComplete:()=>this.safeToRemove()})),Iy.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:n,visualElement:s,drag:r,isPresent:i}=this.props,o=s.projection;return o&&(o.isPresent=i,r||e.layoutDependency!==n||n===void 0?o.willUpdate():this.safeToRemove(),e.isPresent!==i&&(i?o.promote():o.relegate()||Dt.postRender(()=>{const a=o.getStack();(!a||!a.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),queueMicrotask(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:n,switchLayoutGroup:s}=this.props,{projection:r}=e;r&&(r.scheduleCheckAfterUnmount(),n&&n.group&&n.group.remove(r),s&&s.deregister&&s.deregister(r))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function Ez(t){const[e,n]=Iee(),s=z.useContext(S3);return Fs.createElement($ee,{...t,layoutGroup:s,switchLayoutGroup:z.useContext(k3),isPresent:e,safeToRemove:n})}const Ree={borderRadius:{...Ch,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Ch,borderTopRightRadius:Ch,borderBottomLeftRadius:Ch,borderBottomRightRadius:Ch,boxShadow:Aee},Iz=["TopLeft","TopRight","BottomLeft","BottomRight"],Dee=Iz.length,dD=t=>typeof t=="string"?parseFloat(t):t,hD=t=>typeof t=="number"||Me.test(t);function Oee(t,e,n,s,r,i){r?(t.opacity=Ut(0,n.opacity!==void 0?n.opacity:1,Mee(s)),t.opacityExit=Ut(e.opacity!==void 0?e.opacity:1,0,Pee(s))):i&&(t.opacity=Ut(e.opacity!==void 0?e.opacity:1,n.opacity!==void 0?n.opacity:1,s));for(let o=0;o<Dee;o++){const a=`border${Iz[o]}Radius`;let l=fD(e,a),c=fD(n,a);if(l===void 0&&c===void 0)continue;l||(l=0),c||(c=0),l===0||c===0||hD(l)===hD(c)?(t[a]=Math.max(Ut(dD(l),dD(c),s),0),(io.test(c)||io.test(l))&&(t[a]+="%")):t[a]=c}(e.rotate||n.rotate)&&(t.rotate=Ut(e.rotate||0,n.rotate||0,s))}function fD(t,e){return t[e]!==void 0?t[e]:t.borderRadius}const Mee=Az(0,.5,Y3),Pee=Az(.5,.95,Qt);function Az(t,e,n){return s=>s<t?0:s>e?1:n(Xf(t,e,s))}function pD(t,e){t.min=e.min,t.max=e.max}function Rr(t,e){pD(t.x,e.x),pD(t.y,e.y)}function mD(t,e,n,s,r){return t-=e,t=S0(t,1/n,s),r!==void 0&&(t=S0(t,1/r,s)),t}function Lee(t,e=0,n=1,s=.5,r,i=t,o=t){if(io.test(e)&&(e=parseFloat(e),e=Ut(o.min,o.max,e/100)-o.min),typeof e!="number")return;let a=Ut(i.min,i.max,s);t===i&&(a-=e),t.min=mD(t.min,e,n,a,r),t.max=mD(t.max,e,n,a,r)}function gD(t,e,[n,s,r],i,o){Lee(t,e[n],e[s],e[r],e.scale,i,o)}const Fee=["x","scaleX","originX"],_ee=["y","scaleY","originY"];function yD(t,e,n,s){gD(t.x,e,Fee,n?n.x:void 0,s?s.x:void 0),gD(t.y,e,_ee,n?n.y:void 0,s?s.y:void 0)}function xD(t){return t.translate===0&&t.scale===1}function $z(t){return xD(t.x)&&xD(t.y)}function zee(t,e){return t.x.min===e.x.min&&t.x.max===e.x.max&&t.y.min===e.y.min&&t.y.max===e.y.max}function Rz(t,e){return Math.round(t.x.min)===Math.round(e.x.min)&&Math.round(t.x.max)===Math.round(e.x.max)&&Math.round(t.y.min)===Math.round(e.y.min)&&Math.round(t.y.max)===Math.round(e.y.max)}function bD(t){return kr(t.x)/kr(t.y)}class Bee{constructor(){this.members=[]}add(e){FT(this.members,e),e.scheduleRender()}remove(e){if(_T(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const n=this.members[this.members.length-1];n&&this.promote(n)}}relegate(e){const n=this.members.findIndex(r=>e===r);if(n===0)return!1;let s;for(let r=n;r>=0;r--){const i=this.members[r];if(i.isPresent!==!1){s=i;break}}return s?(this.promote(s),!0):!1}promote(e,n){const s=this.lead;if(e!==s&&(this.prevLead=s,this.lead=e,e.show(),s)){s.instance&&s.scheduleRender(),e.scheduleRender(),e.resumeFrom=s,n&&(e.resumeFrom.preserveOpacity=!0),s.snapshot&&(e.snapshot=s.snapshot,e.snapshot.latestValues=s.animationValues||s.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:r}=e.options;r===!1&&s.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:n,resumingFrom:s}=e;n.onExitComplete&&n.onExitComplete(),s&&s.options.onExitComplete&&s.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function vD(t,e,n){let s="";const r=t.x.translate/e.x,i=t.y.translate/e.y;if((r||i)&&(s=`translate3d(${r}px, ${i}px, 0) `),(e.x!==1||e.y!==1)&&(s+=`scale(${1/e.x}, ${1/e.y}) `),n){const{rotate:l,rotateX:c,rotateY:u}=n;l&&(s+=`rotate(${l}deg) `),c&&(s+=`rotateX(${c}deg) `),u&&(s+=`rotateY(${u}deg) `)}const o=t.x.scale*e.x,a=t.y.scale*e.y;return(o!==1||a!==1)&&(s+=`scale(${o}, ${a})`),s||"none"}const jee=(t,e)=>t.depth-e.depth;class Vee{constructor(){this.children=[],this.isDirty=!1}add(e){FT(this.children,e),this.isDirty=!0}remove(e){_T(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(jee),this.isDirty=!1,this.children.forEach(e)}}function Uee(t,e){const n=performance.now(),s=({timestamp:r})=>{const i=r-n;i>=e&&(ta(s),t(i-e))};return Dt.read(s,!0),()=>ta(s)}function Wee(t){window.MotionDebug&&window.MotionDebug.record(t)}function Hee(t){return t instanceof SVGElement&&t.tagName!=="svg"}function Gee(t,e,n){const s=ar(t)?t:xd(t);return s.start(LT("",s,e,n)),s.animation}const wD=["","X","Y","Z"],Kee={visibility:"hidden"},SD=1e3;let qee=0;const Ul={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0};function Dz({attachResizeListener:t,defaultParent:e,measureScroll:n,checkIsScrollRoot:s,resetTransform:r}){return class{constructor(o={},a=e==null?void 0:e()){this.id=qee++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,Ul.totalNodes=Ul.resolvedTargetDeltas=Ul.recalculatedProjection=0,this.nodes.forEach(Yee),this.nodes.forEach(nte),this.nodes.forEach(ste),this.nodes.forEach(Qee),Wee(Ul)},this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=o,this.root=a?a.root||a:this,this.path=a?[...a.path,a]:[],this.parent=a,this.depth=a?a.depth+1:0;for(let l=0;l<this.path.length;l++)this.path[l].shouldResetTransform=!0;this.root===this&&(this.nodes=new Vee)}addEventListener(o,a){return this.eventHandlers.has(o)||this.eventHandlers.set(o,new zT),this.eventHandlers.get(o).add(a)}notifyListeners(o,...a){const l=this.eventHandlers.get(o);l&&l.notify(...a)}hasListeners(o){return this.eventHandlers.has(o)}mount(o,a=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=Hee(o),this.instance=o;const{layoutId:l,layout:c,visualElement:u}=this.options;if(u&&!u.current&&u.mount(o),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),a&&(c||l)&&(this.isLayoutDirty=!0),t){let d;const h=()=>this.root.updateBlockedByResize=!1;t(o,()=>{this.root.updateBlockedByResize=!0,d&&d(),d=Uee(h,250),Iy.hasAnimatedSinceResize&&(Iy.hasAnimatedSinceResize=!1,this.nodes.forEach(CD))})}l&&this.root.registerSharedNode(l,this),this.options.animate!==!1&&u&&(l||c)&&this.addEventListener("didUpdate",({delta:d,hasLayoutChanged:h,hasRelativeTargetChanged:f,layout:p})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const m=this.options.transition||u.getDefaultTransition()||lte,{onLayoutAnimationStart:g,onLayoutAnimationComplete:y}=u.getProps(),x=!this.targetLayout||!Rz(this.targetLayout,p)||f,v=!h&&f;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||v||h&&(x||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(d,v);const w={...PT(m,"layout"),onPlay:g,onComplete:y};(u.shouldReduceMotion||this.options.layoutRoot)&&(w.delay=0,w.type=!1),this.startAnimation(w)}else h||CD(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=p})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const o=this.getStack();o&&o.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,ta(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(rte),this.animationId++)}getTransformTemplate(){const{visualElement:o}=this.options;return o&&o.getProps().transformTemplate}willUpdate(o=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let u=0;u<this.path.length;u++){const d=this.path[u];d.shouldResetTransform=!0,d.updateScroll("snapshot"),d.options.layoutRoot&&d.willUpdate(!1)}const{layoutId:a,layout:l}=this.options;if(a===void 0&&!l)return;const c=this.getTransformTemplate();this.prevTransformTemplateValue=c?c(this.latestValues,""):void 0,this.updateSnapshot(),o&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(kD);return}this.isUpdating||this.nodes.forEach(ete),this.isUpdating=!1,this.nodes.forEach(tte),this.nodes.forEach(Xee),this.nodes.forEach(Jee),this.clearAllSnapshots();const a=performance.now();hs.delta=rl(0,1e3/60,a-hs.timestamp),hs.timestamp=a,hs.isProcessing=!0,sw.update.process(hs),sw.preRender.process(hs),sw.render.process(hs),hs.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,queueMicrotask(()=>this.update()))}clearAllSnapshots(){this.nodes.forEach(Zee),this.sharedNodes.forEach(ite)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Dt.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Dt.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let l=0;l<this.path.length;l++)this.path[l].updateScroll();const o=this.layout;this.layout=this.measure(!1),this.layoutCorrected=fn(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:a}=this.options;a&&a.notify("LayoutMeasure",this.layout.layoutBox,o?o.layoutBox:void 0)}updateScroll(o="measure"){let a=!!(this.options.layoutScroll&&this.instance);this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===o&&(a=!1),a&&(this.scroll={animationId:this.root.animationId,phase:o,isRoot:s(this.instance),offset:n(this.instance)})}resetTransform(){if(!r)return;const o=this.isLayoutDirty||this.shouldResetTransform,a=this.projectionDelta&&!$z(this.projectionDelta),l=this.getTransformTemplate(),c=l?l(this.latestValues,""):void 0,u=c!==this.prevTransformTemplateValue;o&&(a||Vl(this.latestValues)||u)&&(r(this.instance,c),this.shouldResetTransform=!1,this.scheduleRender())}measure(o=!0){const a=this.measurePageBox();let l=this.removeElementScroll(a);return o&&(l=this.removeTransform(l)),cte(l),{animationId:this.root.animationId,measuredBox:a,layoutBox:l,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:o}=this.options;if(!o)return fn();const a=o.measureViewportBox(),{scroll:l}=this.root;return l&&(ba(a.x,l.offset.x),ba(a.y,l.offset.y)),a}removeElementScroll(o){const a=fn();Rr(a,o);for(let l=0;l<this.path.length;l++){const c=this.path[l],{scroll:u,options:d}=c;if(c!==this.root&&u&&d.layoutScroll){if(u.isRoot){Rr(a,o);const{scroll:h}=this.root;h&&(ba(a.x,-h.offset.x),ba(a.y,-h.offset.y))}ba(a.x,u.offset.x),ba(a.y,u.offset.y)}}return a}applyTransform(o,a=!1){const l=fn();Rr(l,o);for(let c=0;c<this.path.length;c++){const u=this.path[c];!a&&u.options.layoutScroll&&u.scroll&&u!==u.root&&Hu(l,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),Vl(u.latestValues)&&Hu(l,u.latestValues)}return Vl(this.latestValues)&&Hu(l,this.latestValues),l}removeTransform(o){const a=fn();Rr(a,o);for(let l=0;l<this.path.length;l++){const c=this.path[l];if(!c.instance||!Vl(c.latestValues))continue;Ok(c.latestValues)&&c.updateSnapshot();const u=fn(),d=c.measurePageBox();Rr(u,d),yD(a,c.latestValues,c.snapshot?c.snapshot.layoutBox:void 0,u)}return Vl(this.latestValues)&&yD(a,this.latestValues),a}setTargetDelta(o){this.targetDelta=o,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(o){this.options={...this.options,...o,crossfade:o.crossfade!==void 0?o.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==hs.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(o=!1){var a;const l=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=l.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=l.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=l.isSharedProjectionDirty);const c=!!this.resumingFrom||this!==l;if(!(o||c&&this.isSharedProjectionDirty||this.isProjectionDirty||!((a=this.parent)===null||a===void 0)&&a.isProjectionDirty||this.attemptToResolveRelativeTarget))return;const{layout:d,layoutId:h}=this.options;if(!(!this.layout||!(d||h))){if(this.resolvedRelativeTargetAt=hs.timestamp,!this.targetDelta&&!this.relativeTarget){const f=this.getClosestProjectingParent();f&&f.layout&&this.animationProgress!==1?(this.relativeParent=f,this.forceRelativeParentToResolveTarget(),this.relativeTarget=fn(),this.relativeTargetOrigin=fn(),ff(this.relativeTargetOrigin,this.layout.layoutBox,f.layout.layoutBox),Rr(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=fn(),this.targetWithTransforms=fn()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),uee(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Rr(this.target,this.layout.layoutBox),Cz(this.target,this.targetDelta)):Rr(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const f=this.getClosestProjectingParent();f&&!!f.resumingFrom==!!this.resumingFrom&&!f.options.layoutScroll&&f.target&&this.animationProgress!==1?(this.relativeParent=f,this.forceRelativeParentToResolveTarget(),this.relativeTarget=fn(),this.relativeTargetOrigin=fn(),ff(this.relativeTargetOrigin,this.target,f.target),Rr(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Ul.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||Ok(this.parent.latestValues)||kz(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var o;const a=this.getLead(),l=!!this.resumingFrom||this!==a;let c=!0;if((this.isProjectionDirty||!((o=this.parent)===null||o===void 0)&&o.isProjectionDirty)&&(c=!1),l&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(c=!1),this.resolvedRelativeTargetAt===hs.timestamp&&(c=!1),c)return;const{layout:u,layoutId:d}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(u||d))return;Rr(this.layoutCorrected,this.layout.layoutBox);const h=this.treeScale.x,f=this.treeScale.y;bee(this.layoutCorrected,this.treeScale,this.path,l),a.layout&&!a.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(a.target=a.layout.layoutBox);const{target:p}=a;if(!p){this.projectionTransform&&(this.projectionDelta=Wu(),this.projectionTransform="none",this.scheduleRender());return}this.projectionDelta||(this.projectionDelta=Wu(),this.projectionDeltaWithTransform=Wu());const m=this.projectionTransform;hf(this.projectionDelta,this.layoutCorrected,p,this.latestValues),this.projectionTransform=vD(this.projectionDelta,this.treeScale),(this.projectionTransform!==m||this.treeScale.x!==h||this.treeScale.y!==f)&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",p)),Ul.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(o=!0){if(this.options.scheduleRender&&this.options.scheduleRender(),o){const a=this.getStack();a&&a.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}setAnimationOrigin(o,a=!1){const l=this.snapshot,c=l?l.latestValues:{},u={...this.latestValues},d=Wu();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!a;const h=fn(),f=l?l.source:void 0,p=this.layout?this.layout.source:void 0,m=f!==p,g=this.getStack(),y=!g||g.members.length<=1,x=!!(m&&!y&&this.options.crossfade===!0&&!this.path.some(ate));this.animationProgress=0;let v;this.mixTargetDelta=w=>{const S=w/1e3;ND(d.x,o.x,S),ND(d.y,o.y,S),this.setTargetDelta(d),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(ff(h,this.layout.layoutBox,this.relativeParent.layout.layoutBox),ote(this.relativeTarget,this.relativeTargetOrigin,h,S),v&&zee(this.relativeTarget,v)&&(this.isProjectionDirty=!1),v||(v=fn()),Rr(v,this.relativeTarget)),m&&(this.animationValues=u,Oee(u,c,this.latestValues,S,x,y)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=S},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(o){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(ta(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Dt.update(()=>{Iy.hasAnimatedSinceResize=!0,this.currentAnimation=Gee(0,SD,{...o,onUpdate:a=>{this.mixTargetDelta(a),o.onUpdate&&o.onUpdate(a)},onComplete:()=>{o.onComplete&&o.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const o=this.getStack();o&&o.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(SD),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const o=this.getLead();let{targetWithTransforms:a,target:l,layout:c,latestValues:u}=o;if(!(!a||!l||!c)){if(this!==o&&this.layout&&c&&Oz(this.options.animationType,this.layout.layoutBox,c.layoutBox)){l=this.target||fn();const d=kr(this.layout.layoutBox.x);l.x.min=o.target.x.min,l.x.max=l.x.min+d;const h=kr(this.layout.layoutBox.y);l.y.min=o.target.y.min,l.y.max=l.y.min+h}Rr(a,l),Hu(a,u),hf(this.projectionDeltaWithTransform,this.layoutCorrected,a,u)}}registerSharedNode(o,a){this.sharedNodes.has(o)||this.sharedNodes.set(o,new Bee),this.sharedNodes.get(o).add(a);const c=a.options.initialPromotionConfig;a.promote({transition:c?c.transition:void 0,preserveFollowOpacity:c&&c.shouldPreserveFollowOpacity?c.shouldPreserveFollowOpacity(a):void 0})}isLead(){const o=this.getStack();return o?o.lead===this:!0}getLead(){var o;const{layoutId:a}=this.options;return a?((o=this.getStack())===null||o===void 0?void 0:o.lead)||this:this}getPrevLead(){var o;const{layoutId:a}=this.options;return a?(o=this.getStack())===null||o===void 0?void 0:o.prevLead:void 0}getStack(){const{layoutId:o}=this.options;if(o)return this.root.sharedNodes.get(o)}promote({needsReset:o,transition:a,preserveFollowOpacity:l}={}){const c=this.getStack();c&&c.promote(this,l),o&&(this.projectionDelta=void 0,this.needsReset=!0),a&&this.setOptions({transition:a})}relegate(){const o=this.getStack();return o?o.relegate(this):!1}resetRotation(){const{visualElement:o}=this.options;if(!o)return;let a=!1;const{latestValues:l}=o;if((l.rotate||l.rotateX||l.rotateY||l.rotateZ)&&(a=!0),!a)return;const c={};for(let u=0;u<wD.length;u++){const d="rotate"+wD[u];l[d]&&(c[d]=l[d],o.setStaticValue(d,0))}o.render();for(const u in c)o.setStaticValue(u,c[u]);o.scheduleRender()}getProjectionStyles(o){var a,l;if(!this.instance||this.isSVG)return;if(!this.isVisible)return Kee;const c={visibility:""},u=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,c.opacity="",c.pointerEvents=Ey(o==null?void 0:o.pointerEvents)||"",c.transform=u?u(this.latestValues,""):"none",c;const d=this.getLead();if(!this.projectionDelta||!this.layout||!d.target){const m={};return this.options.layoutId&&(m.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,m.pointerEvents=Ey(o==null?void 0:o.pointerEvents)||""),this.hasProjected&&!Vl(this.latestValues)&&(m.transform=u?u({},""):"none",this.hasProjected=!1),m}const h=d.animationValues||d.latestValues;this.applyTransformsToTarget(),c.transform=vD(this.projectionDeltaWithTransform,this.treeScale,h),u&&(c.transform=u(h,c.transform));const{x:f,y:p}=this.projectionDelta;c.transformOrigin=`${f.origin*100}% ${p.origin*100}% 0`,d.animationValues?c.opacity=d===this?(l=(a=h.opacity)!==null&&a!==void 0?a:this.latestValues.opacity)!==null&&l!==void 0?l:1:this.preserveOpacity?this.latestValues.opacity:h.opacityExit:c.opacity=d===this?h.opacity!==void 0?h.opacity:"":h.opacityExit!==void 0?h.opacityExit:0;for(const m in m0){if(h[m]===void 0)continue;const{correct:g,applyTo:y}=m0[m],x=c.transform==="none"?h[m]:g(h[m],d);if(y){const v=y.length;for(let w=0;w<v;w++)c[y[w]]=x}else c[m]=x}return this.options.layoutId&&(c.pointerEvents=d===this?Ey(o==null?void 0:o.pointerEvents)||"":"none"),c}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(o=>{var a;return(a=o.currentAnimation)===null||a===void 0?void 0:a.stop()}),this.root.nodes.forEach(kD),this.root.sharedNodes.clear()}}}function Xee(t){t.updateLayout()}function Jee(t){var e;const n=((e=t.resumeFrom)===null||e===void 0?void 0:e.snapshot)||t.snapshot;if(t.isLead()&&t.layout&&n&&t.hasListeners("didUpdate")){const{layoutBox:s,measuredBox:r}=t.layout,{animationType:i}=t.options,o=n.source!==t.layout.source;i==="size"?Lr(d=>{const h=o?n.measuredBox[d]:n.layoutBox[d],f=kr(h);h.min=s[d].min,h.max=h.min+f}):Oz(i,n.layoutBox,s)&&Lr(d=>{const h=o?n.measuredBox[d]:n.layoutBox[d],f=kr(s[d]);h.max=h.min+f,t.relativeTarget&&!t.currentAnimation&&(t.isProjectionDirty=!0,t.relativeTarget[d].max=t.relativeTarget[d].min+f)});const a=Wu();hf(a,s,n.layoutBox);const l=Wu();o?hf(l,t.applyTransform(r,!0),n.measuredBox):hf(l,s,n.layoutBox);const c=!$z(a);let u=!1;if(!t.resumeFrom){const d=t.getClosestProjectingParent();if(d&&!d.resumeFrom){const{snapshot:h,layout:f}=d;if(h&&f){const p=fn();ff(p,n.layoutBox,h.layoutBox);const m=fn();ff(m,s,f.layoutBox),Rz(p,m)||(u=!0),d.options.layoutRoot&&(t.relativeTarget=m,t.relativeTargetOrigin=p,t.relativeParent=d)}}}t.notifyListeners("didUpdate",{layout:s,snapshot:n,delta:l,layoutDelta:a,hasLayoutChanged:c,hasRelativeTargetChanged:u})}else if(t.isLead()){const{onExitComplete:s}=t.options;s&&s()}t.options.transition=void 0}function Yee(t){Ul.totalNodes++,t.parent&&(t.isProjecting()||(t.isProjectionDirty=t.parent.isProjectionDirty),t.isSharedProjectionDirty||(t.isSharedProjectionDirty=!!(t.isProjectionDirty||t.parent.isProjectionDirty||t.parent.isSharedProjectionDirty)),t.isTransformDirty||(t.isTransformDirty=t.parent.isTransformDirty))}function Qee(t){t.isProjectionDirty=t.isSharedProjectionDirty=t.isTransformDirty=!1}function Zee(t){t.clearSnapshot()}function kD(t){t.clearMeasurements()}function ete(t){t.isLayoutDirty=!1}function tte(t){const{visualElement:e}=t.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),t.resetTransform()}function CD(t){t.finishAnimation(),t.targetDelta=t.relativeTarget=t.target=void 0,t.isProjectionDirty=!0}function nte(t){t.resolveTargetDelta()}function ste(t){t.calcProjection()}function rte(t){t.resetRotation()}function ite(t){t.removeLeadSnapshot()}function ND(t,e,n){t.translate=Ut(e.translate,0,n),t.scale=Ut(e.scale,1,n),t.origin=e.origin,t.originPoint=e.originPoint}function TD(t,e,n,s){t.min=Ut(e.min,n.min,s),t.max=Ut(e.max,n.max,s)}function ote(t,e,n,s){TD(t.x,e.x,n.x,s),TD(t.y,e.y,n.y,s)}function ate(t){return t.animationValues&&t.animationValues.opacityExit!==void 0}const lte={duration:.45,ease:[.4,0,.1,1]},ED=t=>typeof navigator<"u"&&navigator.userAgent.toLowerCase().includes(t),ID=ED("applewebkit/")&&!ED("chrome/")?Math.round:Qt;function AD(t){t.min=ID(t.min),t.max=ID(t.max)}function cte(t){AD(t.x),AD(t.y)}function Oz(t,e,n){return t==="position"||t==="preserve-aspect"&&!Rk(bD(e),bD(n),.2)}const ute=Dz({attachResizeListener:(t,e)=>jo(t,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),pw={current:void 0},Mz=Dz({measureScroll:t=>({x:t.scrollLeft,y:t.scrollTop}),defaultParent:()=>{if(!pw.current){const t=new ute({});t.mount(window),t.setOptions({layoutScroll:!0}),pw.current=t}return pw.current},resetTransform:(t,e)=>{t.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:t=>window.getComputedStyle(t).position==="fixed"}),dte={pan:{Feature:Eee},drag:{Feature:Tee,ProjectionNode:Mz,MeasureLayout:Ez}},hte=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/;function fte(t){const e=hte.exec(t);if(!e)return[,];const[,n,s]=e;return[n,s]}function Pk(t,e,n=1){const[s,r]=fte(t);if(!s)return;const i=window.getComputedStyle(e).getPropertyValue(s);if(i){const o=i.trim();return gz(o)?parseFloat(o):o}else return Ck(r)?Pk(r,e,n+1):r}function pte(t,{...e},n){const s=t.current;if(!(s instanceof Element))return{target:e,transitionEnd:n};n&&(n={...n}),t.values.forEach(r=>{const i=r.get();if(!Ck(i))return;const o=Pk(i,s);o&&r.set(o)});for(const r in e){const i=e[r];if(!Ck(i))continue;const o=Pk(i,s);o&&(e[r]=o,n||(n={}),n[r]===void 0&&(n[r]=i))}return{target:e,transitionEnd:n}}const mte=new Set(["width","height","top","left","right","bottom","x","y","translateX","translateY"]),Pz=t=>mte.has(t),gte=t=>Object.keys(t).some(Pz),$D=t=>t===qc||t===Me,RD=(t,e)=>parseFloat(t.split(", ")[e]),DD=(t,e)=>(n,{transform:s})=>{if(s==="none"||!s)return 0;const r=s.match(/^matrix3d\((.+)\)$/);if(r)return RD(r[1],e);{const i=s.match(/^matrix\((.+)\)$/);return i?RD(i[1],t):0}},yte=new Set(["x","y","z"]),xte=Ap.filter(t=>!yte.has(t));function bte(t){const e=[];return xte.forEach(n=>{const s=t.getValue(n);s!==void 0&&(e.push([n,s.get()]),s.set(n.startsWith("scale")?1:0))}),e.length&&t.render(),e}const bd={width:({x:t},{paddingLeft:e="0",paddingRight:n="0"})=>t.max-t.min-parseFloat(e)-parseFloat(n),height:({y:t},{paddingTop:e="0",paddingBottom:n="0"})=>t.max-t.min-parseFloat(e)-parseFloat(n),top:(t,{top:e})=>parseFloat(e),left:(t,{left:e})=>parseFloat(e),bottom:({y:t},{top:e})=>parseFloat(e)+(t.max-t.min),right:({x:t},{left:e})=>parseFloat(e)+(t.max-t.min),x:DD(4,13),y:DD(5,14)};bd.translateX=bd.x;bd.translateY=bd.y;const vte=(t,e,n)=>{const s=e.measureViewportBox(),r=e.current,i=getComputedStyle(r),{display:o}=i,a={};o==="none"&&e.setStaticValue("display",t.display||"block"),n.forEach(c=>{a[c]=bd[c](s,i)}),e.render();const l=e.measureViewportBox();return n.forEach(c=>{const u=e.getValue(c);u&&u.jump(a[c]),t[c]=bd[c](l,i)}),t},wte=(t,e,n={},s={})=>{e={...e},s={...s};const r=Object.keys(e).filter(Pz);let i=[],o=!1;const a=[];if(r.forEach(l=>{const c=t.getValue(l);if(!t.hasValue(l))return;let u=n[l],d=kh(u);const h=e[l];let f;if(y0(h)){const p=h.length,m=h[0]===null?1:0;u=h[m],d=kh(u);for(let g=m;g<p&&h[g]!==null;g++)f?$T(kh(h[g])===f):f=kh(h[g])}else f=kh(h);if(d!==f)if($D(d)&&$D(f)){const p=c.get();typeof p=="string"&&c.set(parseFloat(p)),typeof h=="string"?e[l]=parseFloat(h):Array.isArray(h)&&f===Me&&(e[l]=h.map(parseFloat))}else d!=null&&d.transform&&(f!=null&&f.transform)&&(u===0||h===0)?u===0?c.set(f.transform(u)):e[l]=d.transform(h):(o||(i=bte(t),o=!0),a.push(l),s[l]=s[l]!==void 0?s[l]:e[l],c.jump(h))}),a.length){const l=a.indexOf("height")>=0?window.pageYOffset:null,c=vte(e,t,a);return i.length&&i.forEach(([u,d])=>{t.getValue(u).set(d)}),t.render(),yb&&l!==null&&window.scrollTo({top:l}),{target:c,transitionEnd:s}}else return{target:e,transitionEnd:s}};function Ste(t,e,n,s){return gte(e)?wte(t,e,n,s):{target:e,transitionEnd:s}}const kte=(t,e,n,s)=>{const r=pte(t,e,s);return e=r.target,s=r.transitionEnd,Ste(t,e,n,s)},Lk={current:null},Lz={current:!1};function Cte(){if(Lz.current=!0,!!yb)if(window.matchMedia){const t=window.matchMedia("(prefers-reduced-motion)"),e=()=>Lk.current=t.matches;t.addListener(e),e()}else Lk.current=!1}function Nte(t,e,n){const{willChange:s}=e;for(const r in e){const i=e[r],o=n[r];if(ar(i))t.addValue(r,i),w0(s)&&s.add(r);else if(ar(o))t.addValue(r,xd(i,{owner:t})),w0(s)&&s.remove(r);else if(o!==i)if(t.hasValue(r)){const a=t.getValue(r);!a.hasAnimated&&a.set(i)}else{const a=t.getStaticValue(r);t.addValue(r,xd(a!==void 0?a:i,{owner:t}))}}for(const r in n)e[r]===void 0&&t.removeValue(r);return e}const OD=new WeakMap,Fz=Object.keys(qf),Tte=Fz.length,MD=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"],Ete=ST.length;class Ite{constructor({parent:e,props:n,presenceContext:s,reducedMotionConfig:r,visualState:i},o={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.scheduleRender=()=>Dt.render(this.render,!1,!0);const{latestValues:a,renderState:l}=i;this.latestValues=a,this.baseTarget={...a},this.initialValues=n.initial?{...a}:{},this.renderState=l,this.parent=e,this.props=n,this.presenceContext=s,this.depth=e?e.depth+1:0,this.reducedMotionConfig=r,this.options=o,this.isControllingVariants=bb(n),this.isVariantNode=w3(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:c,...u}=this.scrapeMotionValuesFromProps(n,{});for(const d in u){const h=u[d];a[d]!==void 0&&ar(h)&&(h.set(a[d],!1),w0(c)&&c.add(d))}}scrapeMotionValuesFromProps(e,n){return{}}mount(e){this.current=e,OD.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((n,s)=>this.bindToMotionValue(s,n)),Lz.current||Cte(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:Lk.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){OD.delete(this.current),this.projection&&this.projection.unmount(),ta(this.notifyUpdate),ta(this.render),this.valueSubscriptions.forEach(e=>e()),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const e in this.events)this.events[e].clear();for(const e in this.features)this.features[e].unmount();this.current=null}bindToMotionValue(e,n){const s=Kc.has(e),r=n.on("change",o=>{this.latestValues[e]=o,this.props.onUpdate&&Dt.update(this.notifyUpdate,!1,!0),s&&this.projection&&(this.projection.isTransformDirty=!0)}),i=n.on("renderRequest",this.scheduleRender);this.valueSubscriptions.set(e,()=>{r(),i()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}loadFeatures({children:e,...n},s,r,i){let o,a;for(let l=0;l<Tte;l++){const c=Fz[l],{isEnabled:u,Feature:d,ProjectionNode:h,MeasureLayout:f}=qf[c];h&&(o=h),u(n)&&(!this.features[c]&&d&&(this.features[c]=new d(this)),f&&(a=f))}if((this.type==="html"||this.type==="svg")&&!this.projection&&o){this.projection=new o(this.latestValues,this.parent&&this.parent.projection);const{layoutId:l,layout:c,drag:u,dragConstraints:d,layoutScroll:h,layoutRoot:f}=n;this.projection.setOptions({layoutId:l,layout:c,alwaysMeasureLayout:!!u||d&&Vu(d),visualElement:this,scheduleRender:()=>this.scheduleRender(),animationType:typeof c=="string"?c:"both",initialPromotionConfig:i,layoutScroll:h,layoutRoot:f})}return a}updateFeatures(){for(const e in this.features){const n=this.features[e];n.isMounted?n.update():(n.mount(),n.isMounted=!0)}}triggerBuild(){this.build(this.renderState,this.latestValues,this.options,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):fn()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,n){this.latestValues[e]=n}makeTargetAnimatable(e,n=!0){return this.makeTargetAnimatableFromInstance(e,this.props,n)}update(e,n){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=n;for(let s=0;s<MD.length;s++){const r=MD[s];this.propEventSubscriptions[r]&&(this.propEventSubscriptions[r](),delete this.propEventSubscriptions[r]);const i=e["on"+r];i&&(this.propEventSubscriptions[r]=this.on(r,i))}this.prevMotionValues=Nte(this,this.scrapeMotionValuesFromProps(e,this.prevProps),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}getVariantContext(e=!1){if(e)return this.parent?this.parent.getVariantContext():void 0;if(!this.isControllingVariants){const s=this.parent?this.parent.getVariantContext()||{}:{};return this.props.initial!==void 0&&(s.initial=this.props.initial),s}const n={};for(let s=0;s<Ete;s++){const r=ST[s],i=this.props[r];(Kf(i)||i===!1)&&(n[r]=i)}return n}addVariantChild(e){const n=this.getClosestVariantNode();if(n)return n.variantChildren&&n.variantChildren.add(e),()=>n.variantChildren.delete(e)}addValue(e,n){n!==this.values.get(e)&&(this.removeValue(e),this.bindToMotionValue(e,n)),this.values.set(e,n),this.latestValues[e]=n.get()}removeValue(e){this.values.delete(e);const n=this.valueSubscriptions.get(e);n&&(n(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,n){if(this.props.values&&this.props.values[e])return this.props.values[e];let s=this.values.get(e);return s===void 0&&n!==void 0&&(s=xd(n,{owner:this}),this.addValue(e,s)),s}readValue(e){var n;return this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:(n=this.getBaseTargetFromProps(this.props,e))!==null&&n!==void 0?n:this.readValueFromInstance(this.current,e,this.options)}setBaseTarget(e,n){this.baseTarget[e]=n}getBaseTarget(e){var n;const{initial:s}=this.props,r=typeof s=="string"||typeof s=="object"?(n=AT(this.props,s))===null||n===void 0?void 0:n[e]:void 0;if(s&&r!==void 0)return r;const i=this.getBaseTargetFromProps(this.props,e);return i!==void 0&&!ar(i)?i:this.initialValues[e]!==void 0&&r===void 0?void 0:this.baseTarget[e]}on(e,n){return this.events[e]||(this.events[e]=new zT),this.events[e].add(n)}notify(e,...n){this.events[e]&&this.events[e].notify(...n)}}class _z extends Ite{sortInstanceNodePosition(e,n){return e.compareDocumentPosition(n)&2?1:-1}getBaseTargetFromProps(e,n){return e.style?e.style[n]:void 0}removeValueFromRenderState(e,{vars:n,style:s}){delete n[e],delete s[e]}makeTargetAnimatableFromInstance({transition:e,transitionEnd:n,...s},{transformValues:r},i){let o=HZ(s,e||{},this);if(r&&(n&&(n=r(n)),s&&(s=r(s)),o&&(o=r(o))),i){UZ(this,s,o);const a=kte(this,s,o,n);n=a.transitionEnd,s=a.target}return{transition:e,transitionEnd:n,...s}}}function Ate(t){return window.getComputedStyle(t)}class $te extends _z{constructor(){super(...arguments),this.type="html"}readValueFromInstance(e,n){if(Kc.has(n)){const s=MT(n);return s&&s.default||0}else{const s=Ate(e),r=(T3(n)?s.getPropertyValue(n):s[n])||0;return typeof r=="string"?r.trim():r}}measureInstanceViewportBox(e,{transformPagePoint:n}){return Nz(e,n)}build(e,n,s,r){CT(e,n,s,r.transformTemplate)}scrapeMotionValuesFromProps(e,n){return IT(e,n)}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;ar(e)&&(this.childSubscription=e.on("change",n=>{this.current&&(this.current.textContent=`${n}`)}))}renderInstance(e,n,s,r){D3(e,n,s,r)}}class Rte extends _z{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1}getBaseTargetFromProps(e,n){return e[n]}readValueFromInstance(e,n){if(Kc.has(n)){const s=MT(n);return s&&s.default||0}return n=O3.has(n)?n:vT(n),e.getAttribute(n)}measureInstanceViewportBox(){return fn()}scrapeMotionValuesFromProps(e,n){return P3(e,n)}build(e,n,s,r){TT(e,n,s,this.isSVGTag,r.transformTemplate)}renderInstance(e,n,s,r){M3(e,n,s,r)}mount(e){this.isSVGTag=ET(e.tagName),super.mount(e)}}const Dte=(t,e)=>kT(t)?new Rte(e,{enableHardwareAcceleration:!1}):new $te(e,{enableHardwareAcceleration:!0}),Ote={layout:{ProjectionNode:Mz,MeasureLayout:Ez}},Mte={...oee,...TQ,...dte,...Ote},PD=MY((t,e)=>fQ(t,e,Mte,Dte)),Pte=({t,title:e,message:n,avatar:s,type:r="message",onClick:i})=>{const o=()=>{i&&i(),Jt.dismiss(t.id)};return b.jsxs(PD.div,{initial:{opacity:0,y:-20,scale:.9},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,scale:.9,transition:{duration:.2}},className:`${t.visible?"animate-enter":"animate-leave"} max-w-md w-full bg-white/80 dark:bg-gray-800/90 backdrop-blur-md shadow-2xl rounded-2xl pointer-events-auto flex ring-1 ring-black/5 dark:ring-white/10 overflow-hidden cursor-pointer hover:bg-white/90 dark:hover:bg-gray-800 transition-colors duration-200`,onClick:o,children:[b.jsx("div",{className:"flex-1 w-0 p-4",children:b.jsxs("div",{className:"flex items-start",children:[b.jsx("div",{className:"flex-shrink-0 pt-0.5",children:s?b.jsx("img",{className:"h-10 w-10 rounded-full object-cover ring-2 ring-primary-500/50",src:s,alt:""}):b.jsx("div",{className:`h-10 w-10 rounded-full flex items-center justify-center ring-2 ring-offset-2 ring-offset-transparent ${r==="call"?"bg-red-500 ring-red-500":r==="system"?"bg-blue-500 ring-blue-500":"bg-gradient-to-br from-primary-500 to-purple-600 ring-primary-500"}`,children:b.jsx("span",{className:"text-white font-bold text-lg",children:r==="call"?"":r==="system"?"":e.charAt(0).toUpperCase()})})}),b.jsxs("div",{className:"ml-3 flex-1",children:[b.jsx("p",{className:"text-sm font-bold text-gray-900 dark:text-white",children:e}),b.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-300 line-clamp-2",children:n})]})]})}),b.jsx("div",{className:"flex border-l border-gray-200 dark:border-gray-700",children:b.jsx("button",{onClick:a=>{a.stopPropagation(),Jt.dismiss(t.id)},className:"w-full border border-transparent rounded-none rounded-r-lg p-4 flex items-center justify-center text-sm font-medium text-gray-400 hover:text-gray-500 focus:outline-none",children:""})}),b.jsx(PD.div,{initial:{width:"100%"},animate:{width:"0%"},transition:{duration:5,ease:"linear"},className:"absolute bottom-0 left-0 h-1 bg-gradient-to-r from-primary-500 to-purple-600"})]})},Fk=(t,e,n={})=>{Jt.custom(s=>b.jsx(Pte,{t:s,title:t,message:e,avatar:n.avatar,type:n.type,onClick:n.onClick}),{duration:n.duration||5e3,position:"top-right"})},vd=Object.freeze(Object.defineProperty({__proto__:null,showInAppNotification:Fk},Symbol.toStringTag,{value:"Module"}));class Lte{constructor(){$e(this,"permission","default");$e(this,"audioContext",null);$e(this,"notificationSound",null);$e(this,"isWindowFocused",!0);this.initialize()}async initialize(){"Notification"in window&&(this.permission=Notification.permission),this.initializeAudio(),this.setupWindowListeners()}initializeAudio(){try{const e=window.AudioContext||window.webkitAudioContext;e&&(this.audioContext=new e),this.notificationSound=new Audio,this.notificationSound.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQQAAAAAAA==",this.notificationSound.volume=.3}catch(e){console.warn("Audio context not supported:",e)}}setupWindowListeners(){window.addEventListener("focus",()=>{this.isWindowFocused=!0}),window.addEventListener("blur",()=>{this.isWindowFocused=!1}),document.addEventListener("visibilitychange",()=>{this.isWindowFocused=!document.hidden})}getPreference(e,n){const s=localStorage.getItem(`palfrog-${e}`);return s!==null?JSON.parse(s):n}async requestPermission(){return"Notification"in window?(this.permission==="default"&&(this.permission=await Notification.requestPermission()),this.permission==="granted"):(console.warn("Notifications not supported"),!1)}async shouldNotify(){const e=this.getPreference("desktop-notifications",!0),n=await this.requestPermission();return e&&n}async shouldPlaySound(){return this.getPreference("sounds-enabled",!0)}async showNotification(e,n={}){var i;if(!(!this.isWindowFocused||n.requireInteraction)&&!((i=n.data)!=null&&i.force)||!await this.requestPermission())return;const r={icon:"/vite.svg",badge:"/vite.svg",tag:"palfrog-message",requireInteraction:!1,silent:!1,...n};try{const o=new Notification(e,r);return setTimeout(()=>{o.close()},5e3),o.onclick=async()=>{var a;if(window.focus(),o.close(),(a=n.data)!=null&&a.chatId){const{useWebRTCStore:l}=await bs(()=>Promise.resolve().then(()=>Vh),void 0);l.getState().setActiveChat(n.data.chatId)}},o}catch(o){console.error("Failed to show notification:",o)}}async playNotificationSound(e="message"){if(this.audioContext&&await this.shouldPlaySound())try{this.audioContext.state==="suspended"&&await this.audioContext.resume();const n=this.audioContext.createOscillator(),s=this.audioContext.createGain();switch(n.connect(s),s.connect(this.audioContext.destination),e){case"message":n.type="sine",n.frequency.setValueAtTime(800,this.audioContext.currentTime),n.frequency.setValueAtTime(600,this.audioContext.currentTime+.1);break;case"call":n.type="triangle",n.frequency.setValueAtTime(1e3,this.audioContext.currentTime),n.frequency.setValueAtTime(800,this.audioContext.currentTime+.2),n.frequency.setValueAtTime(1e3,this.audioContext.currentTime+.4);break;case"system":n.type="sine",n.frequency.setValueAtTime(400,this.audioContext.currentTime);break}s.gain.setValueAtTime(.1,this.audioContext.currentTime),s.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.5),n.start(this.audioContext.currentTime),n.stop(this.audioContext.currentTime+.5)}catch(n){console.warn("Failed to play notification sound:",n);try{this.notificationSound&&(this.notificationSound.currentTime=0,await this.notificationSound.play())}catch(s){console.warn("Audio fallback also failed:",s)}}}async notifyNewMessage(e){await this.playNotificationSound("message"),Fk(`Message de ${e.sender}`,e.content||" Fichier joint",{type:"message",onClick:async()=>{const{useWebRTCStore:n}=await bs(()=>Promise.resolve().then(()=>Vh),void 0);n.getState().setActiveChat(e.chatId),window.focus()}}),this.updateTabTitle("(1) Palfrog")}async notifyUserOnline(e){const{useWebRTCStore:n}=await bs(()=>Promise.resolve().then(()=>Vh),void 0);n.getState().showOnlineNotification(e)}async notifyUserStatusChange(e,n,s){const{useWebRTCStore:r}=await bs(()=>Promise.resolve().then(()=>Vh),void 0);r.getState().showOnlineNotification(e,n,s)}async notifyIncomingCall(e){await this.playNotificationSound("call"),Fk(" Appel entrant",`${e} essaie de vous joindre...`,{type:"call",duration:3e4,onClick:()=>{window.focus()}})}updateTabTitle(e){const n=document.title;let s=!0;const r=setInterval(()=>{document.title=s?e:n,s=!s},1e3),i=()=>{clearInterval(r),document.title=n,window.removeEventListener("focus",i)};setTimeout(i,5e3),window.addEventListener("focus",i)}destroy(){this.audioContext&&this.audioContext.close()}}const qo=new Lte;class Fte{constructor(){$e(this,"peerConnections",new Map);$e(this,"pendingOffers",new Map);$e(this,"currentPeerId",null)}async initiateCall(e,n,s){try{this.currentPeerId=e;const r=await this.createPeerConnection(e,s);this.peerConnections.set(e,r);const i=await r.createOffer();await r.setLocalDescription(i),Rs.sendCallOffer(e,i,n),setTimeout(async()=>{const{currentCall:o}=zr.getState();if((o==null?void 0:o.status)==="connecting"){zr.getState().endCall();const{showInAppNotification:a}=await bs(()=>Promise.resolve().then(()=>vd),void 0);a("Appel sans rponse","Aucune rponse de l'utilisateur",{type:"call"})}},3e4)}catch(r){throw console.error("Failed to initiate call:",r),r}}async acceptCall(e,n){const s=this.pendingOffers.get(e);if(!s){if(this.peerConnections.has(e)){console.warn("Call already accepted for peer:",e);return}throw new Error("No pending offer found for this call")}try{this.currentPeerId=e;const r=await this.createPeerConnection(e,n);this.peerConnections.set(e,r),await r.setRemoteDescription(new RTCSessionDescription(s));const i=await r.createAnswer();await r.setLocalDescription(i),Rs.sendCallAnswer(e,i),this.pendingOffers.delete(e)}catch(r){throw console.error("Failed to accept call:",r),r}}async handleCallOffer(e,n,s){const{currentCall:r}=zr.getState();if(r){Rs.sendCallReject(e,"BUSY");return}this.pendingOffers.set(e,n),zr.setState({currentCall:{peerId:e,type:s,status:"connecting",direction:"incoming",startTime:new Date}});const{useWebRTCStore:i}=await bs(()=>Promise.resolve().then(()=>Vh),void 0),o=i.getState().onlineUsers.find(l=>l.userId===e),a=(o==null?void 0:o.username)||"Un utilisateur";await qo.notifyIncomingCall(a)}async handleCallAnswer(e,n){const s=this.peerConnections.get(e);s&&(await s.setRemoteDescription(n),zr.setState(r=>({currentCall:r.currentCall?{...r.currentCall,status:"active"}:null})))}async handleICECandidate(e,n){const s=this.peerConnections.get(e);s&&await s.addIceCandidate(n)}endCall(e){const n=this.peerConnections.get(e);n&&(n.close(),this.peerConnections.delete(e)),Rs.sendCallEnd(e),this.currentPeerId===e&&(this.currentPeerId=null)}rejectCall(e){Rs.sendCallReject(e,"REJECTED"),this.cleanupCall(e)}async createPeerConnection(e,n){const s={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:globalThis.stun.twilio.com:3478"}]},r=new RTCPeerConnection(s);return n.getTracks().forEach(i=>{r.addTrack(i,n)}),r.ontrack=i=>{const[o]=i.streams;zr.getState().setRemoteStream(o)},r.onicecandidate=i=>{i.candidate&&Rs.sendCallICECandidate(e,i.candidate)},r.onconnectionstatechange=()=>{const i=r.connectionState;i==="connected"?console.log("Call connected with:",e):(i==="disconnected"||i==="failed")&&(console.log("Call disconnected with:",e),zr.getState().endCall())},r}async replaceVideoTrack(e){const{currentCall:n}=zr.getState();if(!n)return;const s=this.peerConnections.get(n.peerId);if(!s)return;const r=s.getSenders().find(i=>{var o;return((o=i.track)==null?void 0:o.kind)==="video"});r&&await r.replaceTrack(e)}cleanupCall(e){const n=this.peerConnections.get(e);n&&(n.close(),this.peerConnections.delete(e)),this.currentPeerId===e&&(this.currentPeerId=null)}}const Ay=new Fte,pr=wo((t,e)=>({transfers:new Map,maxFileSize:100*1024*1024,sendFile:async(n,s,r)=>{const{transfers:i,maxFileSize:o}=e();if(s.size>o)throw new Error(`Fichier trop volumineux. Maximum: ${o/1024/1024}MB`);const a=`send-${n}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,l={id:a,file:s,peerId:n,progress:0,status:"pending",direction:"sending",speed:0,transferredBytes:0,totalBytes:s.size,startTime:new Date},c=new Map(i);c.set(a,l),t({transfers:c});try{await qi.fileTransfer.sendFile(n,s,a,r)}catch(u){throw e().failTransfer(a,u instanceof Error?u.message:"Transfer failed"),u}},receiveFile:(n,s)=>{const{transfers:r}=e(),i={id:n,file:new File([],s.name,{type:s.fileType}),peerId:s.senderId,progress:0,status:"pending",direction:"receiving",speed:0,transferredBytes:0,totalBytes:s.size,startTime:new Date},o=new Map(r);o.set(n,i),t({transfers:o})},updateProgress:(n,s,r)=>{var h;const{transfers:i}=e(),o=i.get(n);if(!o)return;const a=new Date,l=(a.getTime()-(((h=o.startTime)==null?void 0:h.getTime())||a.getTime()))/1e3,c=l>0?r/l:0,u={...o,progress:s,transferredBytes:r,speed:c,status:s<100?"transferring":o.status},d=new Map(i);d.set(n,u),t({transfers:d})},cancelTransfer:n=>{const{transfers:s}=e(),r=s.get(n);if(!r)return;const i={...r,status:"cancelled",endTime:new Date},o=new Map(s);o.set(n,i),t({transfers:o}),qi.fileTransfer.cancelTransfer(n)},rejectTransfer:n=>{const{transfers:s}=e(),r=s.get(n);if(!r)return;const i={...r,status:"rejected",endTime:new Date},o=new Map(s);o.set(n,i),t({transfers:o})},completeTransfer:n=>{const{transfers:s}=e(),r=s.get(n);if(!r)return;const i={...r,progress:100,status:"completed",endTime:new Date},o=new Map(s);o.set(n,i),t({transfers:o})},failTransfer:(n,s)=>{const{transfers:r}=e(),i=r.get(n);if(!i)return;const o={...i,status:"failed",error:s,endTime:new Date},a=new Map(r);a.set(n,o),t({transfers:a})},clearCompleted:()=>{const{transfers:n}=e(),s=new Map;n.forEach((r,i)=>{r.status!=="completed"&&r.status!=="failed"&&s.set(i,r)}),t({transfers:s})}}));class _te{constructor(){$e(this,"chunkSize",16*1024);$e(this,"activeTransfers",new Map);$e(this,"receivedChunks",new Map);$e(this,"pendingSends",new Map)}async sendFile(e,n,s,r){const{dataChannels:i}=Be.getState(),o=i.get(e);if(!o||o.readyState!=="open")throw new Error("DataChannel non disponible");this.pendingSends.set(s,{file:n,peerId:e});const a={type:"file_offer",transferId:s,name:n.name,size:n.size,fileType:n.type,thumbnail:r,timestamp:new Date().toISOString()};o.send(JSON.stringify(a)),Be.getState().addMessage({id:Date.now().toString(),content:JSON.stringify(a),sender:"me",timestamp:new Date,type:"file"})}async startTransfer(e,n,s){const{dataChannels:r}=Be.getState(),i=r.get(e);if(!i||i.readyState!=="open")return;const o={type:"file_metadata",transferId:s,name:n.name,size:n.size,fileType:n.type,totalChunks:Math.ceil(n.size/this.chunkSize),timestamp:new Date().toISOString()};i.send(JSON.stringify(o));const a=Math.ceil(n.size/this.chunkSize);let l=0;const c=async()=>{if(l>=a)return;const u=l*this.chunkSize,d=Math.min(u+this.chunkSize,n.size),h=n.slice(u,d);return new Promise((f,p)=>{const m=new FileReader;m.onload=()=>{const g={transferId:s,chunkIndex:l,totalChunks:a,data:m.result,isFinal:l===a-1};i.send(JSON.stringify({type:"file_chunk",...g}));const y=(l+1)/a*100,x=Math.min((l+1)*this.chunkSize,n.size);pr.getState().updateProgress(s,y,x),l++,setTimeout(()=>c().then(f).catch(p),0)},m.onerror=()=>p(new Error("Erreur de lecture du fichier")),m.readAsDataURL(h)})};try{pr.getState().updateProgress(s,0,0),await c(),pr.getState().completeTransfer(s)}catch(u){throw pr.getState().failTransfer(s,u instanceof Error?u.message:"Erreur de transfert"),u}}acceptFile(e,n){const{dataChannels:s}=Be.getState(),r=s.get(n);r&&r.send(JSON.stringify({type:"file_accept",transferId:e}))}rejectFile(e,n){const{dataChannels:s}=Be.getState(),r=s.get(n);r&&r.send(JSON.stringify({type:"file_reject",transferId:e}))}cancelSend(e,n){this.pendingSends.delete(e);const{dataChannels:s}=Be.getState(),r=s.get(n);r&&r.send(JSON.stringify({type:"file_cancel",transferId:e}))}updateMessageTransferStatus(e,n){const{messages:s,updateMessageContent:r}=Be.getState(),i=s.find(o=>{try{return JSON.parse(o.content).transferId===e}catch{return!1}});if(i)try{const o=JSON.parse(i.content);o.transferStatus=n,r(i.id,JSON.stringify(o))}catch(o){console.error("Failed to update message transfer status",o)}}async receiveFile(e,n,s){this.receivedChunks.set(e,[]),pr.getState().receiveFile(e,n),s.send(JSON.stringify({type:"file_transfer_ack",transferId:e,status:"ready"}))}async receiveChunk(e,n,s){const r=this.receivedChunks.get(e)||[],o=await(await fetch(n.data)).blob();r[n.chunkIndex]=o,this.receivedChunks.set(e,r);const a=(n.chunkIndex+1)/n.totalChunks*100,l=r.reduce((c,u)=>c+(u?u.size:0),0);pr.getState().updateProgress(e,a,l),n.isFinal&&await this.completeFileReception(e,n.totalChunks),s.send(JSON.stringify({type:"chunk_ack",transferId:e,chunkIndex:n.chunkIndex,status:"received"}))}async completeFileReception(e,n){const s=this.receivedChunks.get(e);if(!s||s.length!==n)throw new Error("Chunks manquants pour la reconstruction du fichier");const r=new Blob(s),o=pr.getState().transfers.get(e);if(!o)return;const a=new File([r],o.file.name,{type:o.file.type,lastModified:Date.now()}),l={...o,file:a},c=new Map(pr.getState().transfers);c.set(e,l),pr.setState({transfers:c}),pr.getState().completeTransfer(e),this.updateMessageTransferStatus(e,"completed");const{showInAppNotification:u}=await bs(()=>Promise.resolve().then(()=>vd),void 0);u("Fichier reu",`"${a.name}" a t reu avec succs`,{type:"system"}),this.receivedChunks.delete(e)}cancelTransfer(e){this.activeTransfers.delete(e),this.receivedChunks.delete(e)}handleFileMessage(e,n,s){switch(n.type){case"file_offer":Be.getState().addMessage({id:Date.now().toString(),content:JSON.stringify(n),sender:e,timestamp:new Date,type:"file"});break;case"file_accept":const r=this.pendingSends.get(n.transferId);r&&(this.startTransfer(r.peerId,r.file,n.transferId),this.pendingSends.delete(n.transferId));break;case"file_reject":this.pendingSends.delete(n.transferId),pr.getState().rejectTransfer(n.transferId),this.updateMessageTransferStatus(n.transferId,"rejected");break;case"file_cancel":const{messages:i,removeMessage:o}=Be.getState(),a=i.find(l=>{try{return JSON.parse(l.content).transferId===n.transferId}catch{return!1}});a&&o(a.id);break;case"file_metadata":this.receiveFile(n.transferId,n,s);break;case"file_chunk":this.receiveChunk(n.transferId,n,s);break;case"file_transfer_ack":console.log("Transfer acknowledged:",n.transferId);break}}}const $y=new _te,qi={call:Ay,fileTransfer:$y},zr=wo((t,e)=>({currentCall:null,localStream:null,remoteStream:null,isAudioMuted:!1,isVideoOff:!1,isScreenSharing:!1,startCall:async(n,s)=>{var r,i;try{const o={audio:!0,video:s==="video"?{width:{ideal:1280},height:{ideal:720},frameRate:{ideal:30}}:!1},a=await navigator.mediaDevices.getUserMedia(o);t({currentCall:{peerId:n,type:s,status:"connecting",direction:"outgoing",startTime:new Date},localStream:a,isAudioMuted:!1,isVideoOff:s==="audio"}),await qi.call.initiateCall(n,s,a)}catch(o){console.error("Failed to start call:",o),t({currentCall:null,localStream:null});const{showInAppNotification:a}=await bs(()=>Promise.resolve().then(()=>vd),void 0);throw o.name==="NotAllowedError"||(r=o.message)!=null&&r.includes("Permission denied")?a(" Accs refus","Veuillez autoriser l'accs  votre camra et microphone pour passer des appels.",{type:"system",duration:5e3}):o.name==="NotFoundError"||(i=o.message)!=null&&i.includes("not found")?a(" Priphrique introuvable","Aucune camra ou microphone dtect. Vrifiez que vos priphriques sont connects.",{type:"system",duration:5e3}):a(" Erreur d'appel",`Impossible de dmarrer l'appel: ${o.message||"Erreur inconnue"}`,{type:"system",duration:5e3}),o}},acceptCall:async n=>{var s,r;try{const{currentCall:i}=e();if(!i||i.peerId!==n)return;const o={audio:!0,video:i.type==="video"?{width:{ideal:1280},height:{ideal:720}}:!1},a=await navigator.mediaDevices.getUserMedia(o);t({localStream:a,isAudioMuted:!1,isVideoOff:i.type==="audio"}),await qi.call.acceptCall(n,a),t(l=>({currentCall:l.currentCall?{...l.currentCall,status:"active"}:null}))}catch(i){console.error("Failed to accept call:",i),e().endCall();const{showInAppNotification:o}=await bs(()=>Promise.resolve().then(()=>vd),void 0);throw i.name==="NotAllowedError"||(s=i.message)!=null&&s.includes("Permission denied")?o(" Accs refus","Veuillez autoriser l'accs  votre camra et microphone pour rpondre  l'appel.",{type:"system",duration:5e3}):i.name==="NotFoundError"||(r=i.message)!=null&&r.includes("not found")?o(" Priphrique introuvable","Aucune camra ou microphone dtect. Vrifiez que vos priphriques sont connects.",{type:"system",duration:5e3}):o(" Erreur d'appel",`Impossible d'accepter l'appel: ${i.message||"Erreur inconnue"}`,{type:"system",duration:5e3}),i}},endCall:()=>{const{currentCall:n,localStream:s}=e();s==null||s.getTracks().forEach(r=>r.stop()),n&&qi.call.endCall(n.peerId),t({currentCall:null,localStream:null,remoteStream:null,isScreenSharing:!1})},rejectCall:()=>{const{currentCall:n}=e();n&&qi.call.rejectCall(n.peerId),t({currentCall:null,localStream:null,remoteStream:null})},toggleAudio:()=>{const{localStream:n,isAudioMuted:s}=e();n&&n.getAudioTracks().forEach(r=>{r.enabled=s}),t({isAudioMuted:!s})},toggleVideo:()=>{const{localStream:n,isVideoOff:s}=e();n&&n.getVideoTracks().forEach(r=>{r.enabled=s}),t({isVideoOff:!s})},toggleScreenShare:async()=>{const{isScreenSharing:n,localStream:s}=e();try{if(n){const r=s==null?void 0:s.getVideoTracks()[0];r&&r.stop();const i=await navigator.mediaDevices.getUserMedia({video:{width:1280,height:720},audio:!0});t({localStream:i,isScreenSharing:!1}),await qi.call.replaceVideoTrack(i.getVideoTracks()[0])}else{const r=await navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0}),i=s==null?void 0:s.getAudioTracks()[0];i&&r.addTrack(i),t({localStream:r,isScreenSharing:!0}),await qi.call.replaceVideoTrack(r.getVideoTracks()[0]),r.getVideoTracks()[0].onended=()=>{e().toggleScreenShare()}}}catch(r){console.error("Screen share failed:",r)}},setLocalStream:n=>{t({localStream:n})},setRemoteStream:n=>{t({remoteStream:n})}}));class zte{constructor(){$e(this,"socket",null);$e(this,"reconnectAttempts",0);$e(this,"maxReconnectAttempts",5);$e(this,"handleWebRTCOffer",e=>{console.log("Offer received from:",e.from),Be.getState().handleOffer(e.from,e.offer)});$e(this,"handleWebRTCAnswer",e=>{console.log("Answer received from:",e.from),Be.getState().handleAnswer(e.from,e.answer)});$e(this,"handleICECandidate",e=>{console.log("ICE candidate received from:",e.from),Be.getState().handleCandidate(e.from,e.candidate)});$e(this,"handleTypingStart",e=>{Be.getState().setTypingIndicator(e.from,!0)});$e(this,"handleTypingStop",e=>{Be.getState().setTypingIndicator(e.from,!1)});$e(this,"handleCallOffer",e=>{Ay.handleCallOffer(e.from,e.offer,e.type)});$e(this,"handleCallAnswer",e=>{Ay.handleCallAnswer(e.from,e.answer)});$e(this,"handleCallEnd",e=>{zr.getState().endCall()});$e(this,"handleCallReject",async e=>{zr.getState().endCall();const{showInAppNotification:n}=await bs(()=>Promise.resolve().then(()=>vd),void 0);n("Appel rejet",`Raison: ${e.reason}`,{type:"call"})});$e(this,"handleCallICECandidate",e=>{Ay.handleICECandidate(e.from,e.candidate)});$e(this,"handleUserOnline",e=>{console.log("User online:",e.userId);const n=e.userInfo.status||"online";Be.getState().addUser({userId:e.userId,username:e.userInfo.username,email:e.userInfo.email,avatarUrl:e.userInfo.avatarUrl,isOnline:!0,status:n}),n!=="offline"&&qo.notifyUserStatusChange(e.userInfo.username,n,e.userId)});$e(this,"handleUserOffline",e=>{console.log("User offline:",e.userId);const n=Be.getState().onlineUsers.find(s=>s.userId===e.userId);n&&qo.notifyUserStatusChange(n.username,"offline",e.userId),Be.getState().removeUser(e.userId)});$e(this,"handleOnlineUsers",e=>{console.log("Online users:",e);const n=e.map(s=>({...s,status:s.status||"online"}));Be.getState().setOnlineUsers(n)});$e(this,"handleProfileUpdated",e=>{console.log("Socket: profile-updated received",e);const{user:n,updateUser:s}=_t.getState(),{onlineUsers:r,setOnlineUsers:i}=Be.getState();n&&n.id===e.userId&&(console.log("Socket: Updating current user profile"),s({avatarUrl:e.avatarUrl,username:e.username}));const o=r.map(a=>a.userId===e.userId?{...a,...e}:a);i(o),e.avatarUrl&&bs(()=>Promise.resolve().then(()=>ene),void 0).then(({databaseService:a})=>{a.updateChatAvatar(e.userId,e.avatarUrl)})});$e(this,"handleStatusUpdated",e=>{console.log(" Socket: status-updated received",e);try{const n=Be.getState(),{updateUserStatus:s}=n,i=n.onlineUsers.find(o=>o.userId===e.userId);console.log(" Socket: Current user in store before update:",i),console.log(" Socket: Calling updateUserStatus..."),s(e.userId,e.status),setTimeout(()=>{const a=Be.getState().onlineUsers.find(l=>l.userId===e.userId);console.log(" Socket: After update, user is:",a)},0),console.log(" Socket: Showing notification for",e.username),qo.notifyUserStatusChange(e.username,e.status,e.userId)}catch(n){console.error(" Socket: Error handling status update",n)}})}connect(){const{accessToken:e,user:n}=_t.getState();if(!e||!n){console.error("Cannot connect: No authentication token");return}const s={}.VITE_API_URL||"http://localhost:3001";this.socket=Ny(`${s}/webrtc`,{auth:{token:e},transports:["websocket","polling"]}),this.setupEventListeners()}setupEventListeners(){this.socket&&(this.socket.on("connect",()=>{var e;console.log("Connected to signaling server"),this.reconnectAttempts=0,(e=this.socket)==null||e.emit("get-online-users")}),this.socket.on("disconnect",e=>{var n;console.log("Disconnected from signaling server:",e),e==="io server disconnect"&&((n=this.socket)==null||n.connect())}),this.socket.on("connect_error",e=>{console.error("Connection error:",e),this.handleReconnection()}),this.socket.on("webrtc-offer",this.handleWebRTCOffer),this.socket.on("webrtc-answer",this.handleWebRTCAnswer),this.socket.on("webrtc-ice-candidate",this.handleICECandidate),this.socket.on("user-online",this.handleUserOnline),this.socket.on("user-offline",this.handleUserOffline),this.socket.on("online-users",this.handleOnlineUsers),this.socket.on("typing-start",this.handleTypingStart),this.socket.on("typing-stop",this.handleTypingStop),this.socket.on("profile-updated",this.handleProfileUpdated),this.socket.on("status-updated",this.handleStatusUpdated),this.socket.on("call-offer",this.handleCallOffer),this.socket.on("call-answer",this.handleCallAnswer),this.socket.on("call-end",this.handleCallEnd),this.socket.on("call-reject",this.handleCallReject),this.socket.on("call-ice-candidate",this.handleCallICECandidate))}sendOffer(e,n){var s;(s=this.socket)==null||s.emit("webrtc-offer",{to:e,offer:n})}sendAnswer(e,n){var s;(s=this.socket)==null||s.emit("webrtc-answer",{to:e,answer:n})}sendICECandidate(e,n){var s;(s=this.socket)==null||s.emit("webrtc-ice-candidate",{to:e,candidate:n})}sendTypingStart(e){var n;(n=this.socket)==null||n.emit("typing-start",{to:e})}sendTypingStop(e){var n;(n=this.socket)==null||n.emit("typing-stop",{to:e})}updateStatus(e){if(console.log(" SocketService: Emitting update-status with status:",e),!this.socket){console.error(" SocketService: Socket is not connected");return}this.socket.emit("update-status",{status:e}),console.log(" SocketService: update-status emitted")}sendCallOffer(e,n,s){var r;(r=this.socket)==null||r.emit("call-offer",{to:e,offer:n,type:s})}sendCallAnswer(e,n){var s;(s=this.socket)==null||s.emit("call-answer",{to:e,answer:n})}sendCallEnd(e){var n;(n=this.socket)==null||n.emit("call-end",{to:e})}sendCallReject(e,n){var s;(s=this.socket)==null||s.emit("call-reject",{to:e,reason:n})}sendCallICECandidate(e,n){var s;(s=this.socket)==null||s.emit("call-ice-candidate",{to:e,candidate:n})}handleReconnection(){this.reconnectAttempts++,this.reconnectAttempts<=this.maxReconnectAttempts&&setTimeout(()=>{var e;console.log(`Reconnection attempt ${this.reconnectAttempts}`),(e=this.socket)==null||e.connect()},1e3*this.reconnectAttempts)}disconnect(){this.socket&&(this.socket.disconnect(),this.socket=null)}getSocket(){return this.socket}}const Rs=new zte,Bte=Object.freeze(Object.defineProperty({__proto__:null,socketService:Rs},Symbol.toStringTag,{value:"Module"})),_k=(t,e)=>e.some(n=>t instanceof n);let LD,FD;function jte(){return LD||(LD=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Vte(){return FD||(FD=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const zk=new WeakMap,mw=new WeakMap,kb=new WeakMap;function Ute(t){const e=new Promise((n,s)=>{const r=()=>{t.removeEventListener("success",i),t.removeEventListener("error",o)},i=()=>{n(cc(t.result)),r()},o=()=>{s(t.error),r()};t.addEventListener("success",i),t.addEventListener("error",o)});return kb.set(e,t),e}function Wte(t){if(zk.has(t))return;const e=new Promise((n,s)=>{const r=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",o),t.removeEventListener("abort",o)},i=()=>{n(),r()},o=()=>{s(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",i),t.addEventListener("error",o),t.addEventListener("abort",o)});zk.set(t,e)}let Bk={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return zk.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return cc(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function zz(t){Bk=t(Bk)}function Hte(t){return Vte().includes(t)?function(...e){return t.apply(jk(this),e),cc(this.request)}:function(...e){return cc(t.apply(jk(this),e))}}function Gte(t){return typeof t=="function"?Hte(t):(t instanceof IDBTransaction&&Wte(t),_k(t,jte())?new Proxy(t,Bk):t)}function cc(t){if(t instanceof IDBRequest)return Ute(t);if(mw.has(t))return mw.get(t);const e=Gte(t);return e!==t&&(mw.set(t,e),kb.set(e,t)),e}const jk=t=>kb.get(t);function Kte(t,e,{blocked:n,upgrade:s,blocking:r,terminated:i}={}){const o=indexedDB.open(t,e),a=cc(o);return s&&o.addEventListener("upgradeneeded",l=>{s(cc(o.result),l.oldVersion,l.newVersion,cc(o.transaction),l)}),n&&o.addEventListener("blocked",l=>n(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),r&&l.addEventListener("versionchange",c=>r(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}const qte=["get","getKey","getAll","getAllKeys","count"],Xte=["put","add","delete","clear"],gw=new Map;function _D(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(gw.get(e))return gw.get(e);const n=e.replace(/FromIndex$/,""),s=e!==n,r=Xte.includes(n);if(!(n in(s?IDBIndex:IDBObjectStore).prototype)||!(r||qte.includes(n)))return;const i=async function(o,...a){const l=this.transaction(o,r?"readwrite":"readonly");let c=l.store;return s&&(c=c.index(a.shift())),(await Promise.all([c[n](...a),r&&l.done]))[0]};return gw.set(e,i),i}zz(t=>({...t,get:(e,n,s)=>_D(e,n)||t.get(e,n,s),has:(e,n)=>!!_D(e,n)||t.has(e,n)}));const Jte=["continue","continuePrimaryKey","advance"],zD={},Vk=new WeakMap,Bz=new WeakMap,Yte={get(t,e){if(!Jte.includes(e))return t[e];let n=zD[e];return n||(n=zD[e]=function(...s){Vk.set(this,Bz.get(this)[e](...s))}),n}};async function*Qte(...t){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...t)),!e)return;e=e;const n=new Proxy(e,Yte);for(Bz.set(n,e),kb.set(n,jk(e));e;)yield n,e=await(Vk.get(n)||e.continue()),Vk.delete(n)}function BD(t,e){return e===Symbol.asyncIterator&&_k(t,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&_k(t,[IDBIndex,IDBObjectStore])}zz(t=>({...t,get(e,n,s){return BD(e,n)?Qte:t.get(e,n,s)},has(e,n){return BD(e,n)||t.has(e,n)}}));class Zte{constructor(){$e(this,"db",null);$e(this,"dbName","PalfrogChat");$e(this,"version",1)}async initialize(){try{this.db=await Kte(this.dbName,this.version,{upgrade(e){const n=e.createObjectStore("messages",{keyPath:"id"});n.createIndex("by-chatId","chatId"),n.createIndex("by-timestamp","timestamp"),e.createObjectStore("chats",{keyPath:"id"})}}),console.log("IndexedDB initialized successfully")}catch(e){console.error("Failed to initialize IndexedDB:",e)}}async saveMessage(e){var n;this.db||await this.initialize();try{await((n=this.db)==null?void 0:n.put("messages",{...e,encrypted:!1})),await this.updateChat(e.chatId,e,e.senderName)}catch(s){console.error("Failed to save message:",s)}}async getChatMessages(e,n=100){this.db||await this.initialize();try{return(await this.db.transaction("messages","readonly").objectStore("messages").index("by-chatId").getAll(e)).sort((a,l)=>new Date(a.timestamp).getTime()-new Date(l.timestamp).getTime()).slice(-n)}catch(s){return console.error("Failed to get messages:",s),[]}}async getChat(e){var n;this.db||await this.initialize();try{return await((n=this.db)==null?void 0:n.get("chats",e))}catch(s){console.error("Failed to get chat:",s);return}}async updateChat(e,n,s){var r,i;this.db||await this.initialize();try{const o=await((r=this.db)==null?void 0:r.get("chats",e)),a={id:e,participantId:e,participantName:n.sender==="me"?"Moi":s||(o==null?void 0:o.participantName)||n.sender,lastMessage:n.content,lastActivity:n.timestamp,unreadCount:n.sender==="me"?0:((o==null?void 0:o.unreadCount)||0)+1,avatarUrl:o==null?void 0:o.avatarUrl};await((i=this.db)==null?void 0:i.put("chats",a))}catch(o){console.error("Failed to update chat:",o)}}async updateChatAvatar(e,n){var s,r;this.db||await this.initialize();try{const i=await((s=this.db)==null?void 0:s.get("chats",e));i&&(i.avatarUrl=n,await((r=this.db)==null?void 0:r.put("chats",i)))}catch(i){console.error("Failed to update chat avatar:",i)}}async getAllChats(){var e;this.db||await this.initialize();try{return await((e=this.db)==null?void 0:e.getAll("chats"))||[]}catch(n){return console.error("Failed to get chats:",n),[]}}async clearChat(e){this.db||await this.initialize();try{const n=this.db.transaction(["messages","chats"],"readwrite");let i=await n.objectStore("messages").index("by-chatId").openCursor(IDBKeyRange.only(e));for(;i;)await i.delete(),i=await i.continue();await n.objectStore("chats").delete(e),await n.done}catch(n){console.error("Failed to clear chat:",n)}}}const Pn=new Zte,ene=Object.freeze(Object.defineProperty({__proto__:null,databaseService:Pn},Symbol.toStringTag,{value:"Module"})),tne="palfrog-secure-storage",nne=1,Io="cryptokeys";class sne{constructor(){$e(this,"db",null)}async init(){return this.db?this.db:new Promise((e,n)=>{const s=indexedDB.open(tne,nne);s.onerror=()=>n(new Error("Failed to open IndexedDB")),s.onsuccess=()=>{this.db=s.result,e(this.db)},s.onupgradeneeded=r=>{const i=r.target.result;i.objectStoreNames.contains(Io)||i.createObjectStore(Io,{keyPath:"id"})}})}async generateAndStoreKeyPair(e){await this.init();const n=await window.crypto.subtle.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey","deriveBits"]),s={id:`keypair-${e}`,publicKey:n.publicKey,privateKey:n.privateKey,createdAt:Date.now()};return await this.put(Io,s),{publicKey:await window.crypto.subtle.exportKey("jwk",n.publicKey),hasPrivateKey:!0}}async loadKeyPair(e){try{const n=await this.init(),s=await this.get(Io,`keypair-${e}`);return s?{publicKey:s.publicKey,privateKey:s.privateKey}:null}catch(n){return console.error("Failed to load key pair:",n),null}}async getPublicKeyJwk(e){const n=await this.loadKeyPair(e);return n?await window.crypto.subtle.exportKey("jwk",n.publicKey):null}async deleteKeyPair(e){await this.init(),await this.delete(Io,`keypair-${e}`)}async storeDerivedKey(e,n,s){await this.init(),await this.put(Io,{id:`derived-${e}-${n}`,key:s,createdAt:Date.now()})}async loadDerivedKey(e,n){const s=await this.get(Io,`derived-${e}-${n}`);return(s==null?void 0:s.key)||null}async clearAllKeys(e){const i=(await this.init()).transaction(Io,"readwrite").objectStore(Io).openCursor();await new Promise((o,a)=>{i.onsuccess=l=>{const c=l.target.result;c?(c.value.id.includes(e)&&c.delete(),c.continue()):o()},i.onerror=()=>a(i.error)})}async put(e,n){const s=await this.init();return new Promise((r,i)=>{const l=s.transaction(e,"readwrite").objectStore(e).put(n);l.onsuccess=()=>r(),l.onerror=()=>i(l.error)})}async get(e,n){const s=await this.init();return new Promise((r,i)=>{const l=s.transaction(e,"readonly").objectStore(e).get(n);l.onsuccess=()=>r(l.result||null),l.onerror=()=>i(l.error)})}async delete(e,n){const s=await this.init();return new Promise((r,i)=>{const l=s.transaction(e,"readwrite").objectStore(e).delete(n);l.onsuccess=()=>r(),l.onerror=()=>i(l.error)})}}const gu=new sne;class rne{constructor(){$e(this,"nativeKeyPair",null);$e(this,"peerKeys",{})}async initialize(){await this.ensureKeyPair()}async ensureKeyPair(){const{user:e}=_t.getState();if(!e)throw new Error("USER_NOT_AUTHENTICATED");if(this.nativeKeyPair=await gu.loadKeyPair(e.id),!this.nativeKeyPair&&(await gu.generateAndStoreKeyPair(e.id),this.nativeKeyPair=await gu.loadKeyPair(e.id),!this.nativeKeyPair))throw new Error("KEY_GENERATION_FAILED")}async getPublicKeyJwk(){if(await this.ensureKeyPair(),!this.nativeKeyPair)throw new Error("NO_KEYPAIR");return await window.crypto.subtle.exportKey("jwk",this.nativeKeyPair.publicKey)}async performKeyExchange(e,n){if(await this.ensureKeyPair(),!this.nativeKeyPair)throw new Error("NO_KEYPAIR");const{user:s}=_t.getState();if(!s)throw new Error("USER_NOT_AUTHENTICATED");try{const r=await window.crypto.subtle.importKey("jwk",n,{name:"ECDH",namedCurve:"P-256"},!1,[]),i=await window.crypto.subtle.deriveKey({name:"ECDH",public:r},this.nativeKeyPair.privateKey,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"]),o=await this.deriveEncryptionKey(i);return await gu.storeDerivedKey(s.id,e,o),this.peerKeys[e]={publicKey:n,sharedSecret:i,derivedKey:o},o}catch(r){throw console.error("Key exchange failed:",r),new Error("KEY_EXCHANGE_FAILED")}}async deriveEncryptionKey(e){const s=new TextEncoder().encode("palfrog-key-derivation");return await window.crypto.subtle.deriveKey({name:"PBKDF2",salt:s,iterations:1e5,hash:"SHA-256"},e,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])}async encryptMessage(e,n){const s=this.peerKeys[e];if(!(s!=null&&s.derivedKey))throw new Error("NO_SHARED_KEY");try{const r=window.crypto.getRandomValues(new Uint8Array(12)),i=new TextEncoder,o=i.encode(n),a=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:r,additionalData:i.encode(e)},s.derivedKey,o);return{encrypted:this.arrayBufferToBase64(a),iv:this.arrayBufferToBase64(r)}}catch(r){throw console.error("Encryption failed:",r),new Error("ENCRYPTION_FAILED")}}async decryptMessage(e,n,s){const r=this.peerKeys[e];if(!(r!=null&&r.derivedKey))throw new Error("NO_SHARED_KEY");try{const i=this.base64ToArrayBuffer(n),o=this.base64ToArrayBuffer(s),a=new TextEncoder,l=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:o,additionalData:a.encode(e)},r.derivedKey,i);return new TextDecoder().decode(l)}catch(i){throw console.error("Decryption failed:",i),new Error("DECRYPTION_FAILED")}}async sendPublicKey(e,n){const r={type:"key_exchange",publicKey:await this.getPublicKeyJwk(),timestamp:new Date().toISOString()};n.send(JSON.stringify(r))}async handlePublicKey(e,n){try{await this.performKeyExchange(e,n),console.log("Key exchange completed with:",e)}catch(s){console.error("Failed to handle public key:",s)}}hasSharedKey(e){var n;return!!((n=this.peerKeys[e])!=null&&n.derivedKey)}async loadDerivedKey(e){var r;const{user:n}=_t.getState();if(!n)return null;if((r=this.peerKeys[e])!=null&&r.derivedKey)return this.peerKeys[e].derivedKey;const s=await gu.loadDerivedKey(n.id,e);return s&&this.peerKeys[e]&&(this.peerKeys[e].derivedKey=s),s}arrayBufferToBase64(e){const n=e instanceof Uint8Array?e:new Uint8Array(e);let s="";for(let r=0;r<n.byteLength;r++)s+=String.fromCharCode(n[r]);return btoa(s)}base64ToArrayBuffer(e){const n=atob(e),s=new Uint8Array(n.length);for(let r=0;r<n.length;r++)s[r]=n.charCodeAt(r);return s.buffer}async clearKeys(){const{user:e}=_t.getState();this.nativeKeyPair=null,this.peerKeys={},e&&(await gu.clearAllKeys(e.id),localStorage.removeItem(`palfrog-keys-${e.id}`),localStorage.removeItem(`palfrog-peer-keys-${e.id}`))}}const yu=new rne,Vo={searchUsers:async t=>(await Fn.get(`/friends/search?q=${encodeURIComponent(t)}`)).data,getAllUsers:async()=>(await Fn.get("/friends/search?q=")).data,getFriends:async()=>(await Fn.get("/friends")).data,addFriend:async t=>(await Fn.post("/friends/add",{friendId:t})).data,blockUser:async t=>(await Fn.post("/friends/block",{friendId:t})).data,removeFriend:async t=>(await Fn.post("/friends/remove",{friendId:t})).data,unblockUser:async t=>(await Fn.post("/friends/unblock",{friendId:t})).data},Be=wo((t,e)=>({localStream:null,remoteStreams:new Map,peerConnections:new Map,dataChannels:new Map,pendingCandidates:new Map,messages:[],activeChat:null,isCallActive:!1,isConnecting:!1,onlineUsers:[],totalUnreadCount:0,onlineNotification:null,authorizedUsers:JSON.parse(localStorage.getItem("authorizedUsers")||"[]"),authorizeUser:n=>{const{authorizedUsers:s}=e();if(!s.includes(n)){const r=[...s,n];t({authorizedUsers:r}),localStorage.setItem("authorizedUsers",JSON.stringify(r))}},unauthorizeUser:n=>{const{authorizedUsers:s}=e(),r=s.filter(i=>i!==n);t({authorizedUsers:r}),localStorage.setItem("authorizedUsers",JSON.stringify(r))},acceptAuth:n=>{e().authorizeUser(n),t(i=>({messages:i.messages.map(o=>o.sender===n&&o.isPendingAuth?{...o,isPendingAuth:!1}:o)}));const{dataChannels:s}=e(),r=s.get(n);r&&r.readyState==="open"&&r.send(JSON.stringify({type:"auth_accepted"}))},rejectAuth:n=>{t(i=>({messages:i.messages.filter(o=>!(o.sender===n&&o.isPendingAuth))}));const{dataChannels:s}=e(),r=s.get(n);r&&r.readyState==="open"&&r.send(JSON.stringify({type:"auth_refused"}))},showOnlineNotification:(n,s="online",r)=>{t({onlineNotification:{username:n,status:s,userId:r}})},hideOnlineNotification:()=>{t({onlineNotification:null})},updateUnreadCount:async()=>{try{const s=(await Pn.getAllChats()).reduce((r,i)=>r+(i.unreadCount||0),0);t({totalUnreadCount:s})}catch(n){console.error("Failed to update unread count:",n)}},typingUsers:new Map,isTyping:!1,encryptionStatus:new Map,isEncryptionEnabled:!0,initializeEncryption:async n=>{const{dataChannels:s}=e();t(r=>{const i=new Map(r.encryptionStatus);return i.set(n,"pending"),{encryptionStatus:i}});try{if(await yu.initialize(),yu.hasSharedKey(n))t(r=>{const i=new Map(r.encryptionStatus);return i.set(n,"established"),{encryptionStatus:i}});else{const r=s.get(n);if(r&&r.readyState==="open")await yu.sendPublicKey(n,r);else throw new Error("DataChannel not ready")}}catch(r){console.error("Encryption initialization failed:",r),t(i=>{const o=new Map(i.encryptionStatus);return o.set(n,"failed"),{encryptionStatus:o}})}},sendEncryptedMessage:async(n,s)=>{const{activeChat:r,dataChannels:i,isEncryptionEnabled:o,addMessage:a}=e(),l=s||r;if(!l){console.error("No active chat");return}if(!o){e().sendPlainTextMessage(n,l);return}try{if(e().encryptionStatus.get(l)!=="established"&&!yu.hasSharedKey(l)){console.warn("Encryption not established, falling back to plain text"),e().sendPlainTextMessage(n,l);return}const{encrypted:u,iv:d}=await yu.encryptMessage(l,n),h=i.get(l);if(h&&h.readyState==="open"){const f={type:"encrypted_message",encrypted:u,iv:d,timestamp:new Date().toISOString()};h.send(JSON.stringify(f))}else throw new Error("DataChannel not available")}catch(c){console.error("Failed to send encrypted message:",c),e().sendPlainTextMessage(n,l)}},handleEncryptedMessage:async(n,s)=>{const{addMessage:r,isEncryptionEnabled:i}=e();if(!i){console.warn("Encryption disabled, cannot decrypt message");return}try{const o=await yu.decryptMessage(n,s.encrypted,s.iv);r({id:`${n}-${Date.now()}`,content:o,sender:n,timestamp:new Date(s.timestamp),type:"text"})}catch(o){console.error("Failed to decrypt message:",o),r({id:`${n}-${Date.now()}`,content:" Message chiffr non dchiffrable",sender:n,timestamp:new Date,type:"system"})}},startTyping:n=>{const{dataChannels:s,activeChat:r}=e();if(r!==n)return;const i=s.get(n);if(i&&i.readyState==="open"){const o={type:"typing_start",timestamp:new Date().toISOString()};i.send(JSON.stringify(o))}else Rs.sendTypingStart(n)},stopTyping:n=>{const{dataChannels:s,activeChat:r}=e(),i=s.get(n);if(i&&i.readyState==="open"&&r===n){const o={type:"typing_stop",timestamp:new Date().toISOString()};i.send(JSON.stringify(o))}else Rs.sendTypingStop(n)},setTypingIndicator:(n,s)=>{const{typingUsers:r}=e(),i=new Map(r);if(s){const o=setTimeout(()=>{e().setTypingIndicator(n,!1)},5e3);i.set(n,o)}else{const o=i.get(n);o&&(clearTimeout(o),i.delete(n))}t({typingUsers:i,isTyping:i.size>0})},setOnlineUsers:n=>{console.log("Store updating onlineUsers:",n),t({onlineUsers:n})},addUser:n=>t(s=>({onlineUsers:[...s.onlineUsers.filter(r=>r.userId!==n.userId),n]})),removeUser:n=>t(s=>({onlineUsers:s.onlineUsers.filter(r=>r.userId!==n)})),updateUserStatus:(n,s)=>t(r=>{if(console.log(" Store: updateUserStatus called for",n,"new status:",s),!r.onlineUsers.some(a=>a.userId===n))return console.warn(" Store: User",n,"not found in onlineUsers - adding with minimal info"),{onlineUsers:[...r.onlineUsers,{userId:n,username:"Unknown User",email:"",isOnline:s!=="offline",status:s}]};const o=r.onlineUsers.map(a=>a.userId===n?(console.log(" Store: Updating user",a.username,"from",a.status,"to",s),{...a,status:s,isOnline:s!=="offline"}):a);return console.log(" Store: Updated user:",o.find(a=>a.userId===n)),{onlineUsers:o}}),notifyUserStatus:(n,s)=>{s&&qo.notifyUserOnline(n)},loadChatHistory:async n=>{try{const s=await Pn.getChatMessages(n);t(r=>({messages:[...s,...r.messages].filter((i,o,a)=>o===a.findIndex(l=>l.id===i.id)).sort((i,o)=>new Date(i.timestamp).getTime()-new Date(o.timestamp).getTime())}))}catch(s){console.error("Failed to load chat history:",s)}},clearChatHistory:async n=>{try{await Pn.clearChat(n),t(s=>({messages:s.messages.filter(r=>!(r.sender===n||r.sender==="me"&&s.activeChat===n))}))}catch(s){console.error("Failed to clear chat history:",s)}},exportChat:async n=>{try{const s=await Pn.getChatMessages(n,1e4);if(s.length===0){const l=e().messages.filter(c=>c.sender===n||c.sender==="me"&&e().activeChat===n);if(l.length===0){console.warn("Aucun message  exporter");return}s.push(...l)}let r=`Conversation avec ${n}
`;r+=`Export le ${new Date().toLocaleString()}
`,r+=`----------------------------------------

`,s.forEach(l=>{const c=new Date(l.timestamp).toLocaleString(),u=l.sender==="me"?"Moi":l.sender===n?n:l.sender;r+=`[${c}] ${u}:
${l.content}

`}),r+=`----------------------------------------
`,r+=`Conversation exporte depuis PalFrog
`;const i=new Blob([r],{type:"text/plain;charset=utf-8"}),o=URL.createObjectURL(i),a=document.createElement("a");a.href=o,a.download=`conversation_${n}_${new Date().toISOString().split("T")[0]}.txt`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(o)}catch(s){console.error("Failed to export chat:",s)}},updateMessageStatus:(n,s)=>{t(r=>({messages:r.messages.map(i=>i.id===n?{...i,status:s}:i)}))},updateMessageContent:(n,s)=>{t(r=>{const i=r.messages.map(a=>a.id===n?{...a,content:s}:a),o=i.find(a=>a.id===n);if(o){const a={...o,chatId:r.activeChat||"unknown"};Pn.saveMessage(a)}return{messages:i}})},markAsRead:async n=>{try{const r=(await Pn.getAllChats()).find(i=>i.id===n);if(r){await Pn.updateChat(n,{sender:"me",content:r.lastMessage,timestamp:r.lastActivity}),await e().updateUnreadCount();const{dataChannels:i}=e(),o=i.get(n);o&&o.readyState==="open"&&o.send(JSON.stringify({type:"message_read",timestamp:new Date().toISOString()}))}}catch(s){console.error("Failed to mark as read:",s)}},initializeWebRTC:async()=>{try{const n={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:globalThis.stun.twilio.com:3478"}],iceCandidatePoolSize:10},s=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1});t({localStream:s,isCallActive:!0})}catch(n){console.error("WebRTC initialization failed:",n),t({isCallActive:!0})}},createPeerConnection:async n=>{const{peerConnections:s,localStream:r}=e();if(s.has(n))return s.get(n).connection;const i={iceServers:[{urls:"stun:stun.l.google.com:19302"}]},o=new RTCPeerConnection(i);r&&r.getTracks().forEach(f=>{o.addTrack(f,r)});const a=o.createDataChannel("chat",{ordered:!0,maxPacketLifeTime:3e3});a.onmessage=async f=>{try{const p=JSON.parse(f.data);if(p.type==="auth_accepted"){t(x=>({messages:x.messages.map(v=>v.sender==="me"&&v.status==="pending"?{...v,status:"delivered"}:v)}));return}if(p.type==="message_read"){t(x=>({messages:x.messages.map(v=>v.sender==="me"&&(v.status==="sent"||v.status==="delivered")?{...v,status:"read"}:v)}));return}if(p.type==="message_received"){p.messageId&&t(x=>({messages:x.messages.map(v=>v.id===p.messageId?{...v,status:"delivered"}:v)}));return}if(p.type==="auth_refused"){t(v=>({messages:v.messages.filter(w=>!(w.sender==="me"&&w.status==="pending"))}));const{showInAppNotification:x}=await bs(()=>Promise.resolve().then(()=>vd),void 0);x("Message refus","L'utilisateur a refus votre demande de conversation.",{type:"system"});return}if(p.type==="encrypted_message"){e().handleEncryptedMessage(n,p);return}if(p.type==="typing_start"){e().setTypingIndicator(n,!0);return}if(p.type==="typing_stop"){e().setTypingIndicator(n,!1);return}if(["file_metadata","file_chunk","file_transfer_ack","chunk_ack","file_offer","file_accept","file_reject","file_cancel"].includes(p.type)){qi.fileTransfer.handleFileMessage(n,p,a);return}const{authorizedUsers:m}=e(),g=m.includes(n),y=p.id||Date.now().toString();(p.type==="text"||!p.type)&&(e().addMessage({id:y,content:p.content||"",sender:n,timestamp:new Date,type:"text",isPendingAuth:!g}),g&&a.send(JSON.stringify({type:"message_received",messageId:y})))}catch(p){console.error("Error handling incoming message:",p)}},a.onopen=()=>{console.log("DataChannel ouvert avec",n);const f=new Map(e().dataChannels);f.set(n,a),t({dataChannels:f})},o.ontrack=f=>{const[p]=f.streams,m=new Map(e().remoteStreams);m.set(n,p),t({remoteStreams:m})},o.onicecandidate=f=>{f.candidate&&Rs.sendICECandidate(n,f.candidate)},o.oniceconnectionstatechange=()=>{console.log("ICE connection state:",o.iceConnectionState),o.iceConnectionState==="connected"&&console.log("Connexion P2P tablie avec",n)};const l={peerId:n,connection:o,dataChannel:a,isConnected:!1},c=new Map(s);c.set(n,l),t({peerConnections:c});const{pendingCandidates:u}=e(),d=u.get(n);if(d){console.log(`Processing ${d.length} queued ICE candidates for ${n} (initiator)`);for(const p of d)try{await o.addIceCandidate(new RTCIceCandidate(p))}catch(m){console.error("Error adding queued ice candidate",m)}const f=new Map(u);f.delete(n),t({pendingCandidates:f})}const h=await o.createOffer();return await o.setLocalDescription(h),Rs.sendOffer(n,h),o},handleOffer:async(n,s)=>{const{peerConnections:r,localStream:i}=e(),o={iceServers:[{urls:"stun:stun.l.google.com:19302"}]},a=new RTCPeerConnection(o);i&&i.getTracks().forEach(f=>{a.addTrack(f,i)}),a.ondatachannel=f=>{const p=f.channel;p.onmessage=m=>{try{const g=JSON.parse(m.data);if(g.type==="encrypted_message"){e().handleEncryptedMessage(n,g);return}if(g.type==="typing_start"){e().setTypingIndicator(n,!0);return}if(g.type==="typing_stop"){e().setTypingIndicator(n,!1);return}if(["file_metadata","file_chunk","file_transfer_ack","chunk_ack","file_offer","file_accept","file_reject","file_cancel"].includes(g.type)){qi.fileTransfer.handleFileMessage(n,g,p);return}(g.type==="text"||!g.type)&&e().addMessage({id:Date.now().toString(),content:g.content||"",sender:n,timestamp:new Date,type:"text"})}catch(g){console.error("Error handling incoming message (remote):",g)}},p.onopen=()=>{console.log("DataChannel (remote) ouvert avec",n);const m=new Map(e().dataChannels);m.set(n,p),t({dataChannels:m})}},a.ontrack=f=>{const[p]=f.streams,m=new Map(e().remoteStreams);m.set(n,p),t({remoteStreams:m})},a.onicecandidate=f=>{f.candidate&&Rs.sendICECandidate(n,f.candidate)},await a.setRemoteDescription(new RTCSessionDescription(s));const l=await a.createAnswer();await a.setLocalDescription(l),Rs.sendAnswer(n,l);const c={peerId:n,connection:a,dataChannel:null,isConnected:!1},u=new Map(r);u.set(n,c),t({peerConnections:u});const{pendingCandidates:d}=e(),h=d.get(n);if(h){console.log(`Processing ${h.length} queued ICE candidates for ${n}`);for(const p of h)try{await a.addIceCandidate(new RTCIceCandidate(p))}catch(m){console.error("Error adding queued ice candidate",m)}const f=new Map(d);f.delete(n),t({pendingCandidates:f})}},handleAnswer:async(n,s)=>{const{peerConnections:r}=e(),i=r.get(n);i&&await i.connection.setRemoteDescription(new RTCSessionDescription(s))},handleCandidate:async(n,s)=>{const{peerConnections:r,pendingCandidates:i}=e(),o=r.get(n);if(o)try{await o.connection.addIceCandidate(new RTCIceCandidate(s))}catch(a){console.error("Error adding received ice candidate",a)}else{console.log(`Queueing ICE candidate for ${n}`);const a=i.get(n)||[],l=new Map(i);l.set(n,[...a,s]),t({pendingCandidates:l})}},sendPlainTextMessage:(n,s)=>{const{dataChannels:r}=e(),i=r.get(s);if(i&&i.readyState==="open"){const o={type:"text",content:n,timestamp:new Date().toISOString(),sender:"me"};i.send(JSON.stringify(o))}else console.warn(`DataChannel not open for ${s}, cannot send plain text message`)},sendMessage:async(n,s)=>{const{activeChat:r,isEncryptionEnabled:i}=e(),o=s||r;if(!o){console.error("Aucun chat actif");return}const a={id:Date.now().toString(),content:n,sender:"me",timestamp:new Date,type:"text",status:"sent"};e().addMessage(a),i?await e().sendEncryptedMessage(n,o):e().sendPlainTextMessage(n,o)},addMessage:n=>{const{activeChat:s,messages:r,onlineUsers:i}=e();if(r.some(a=>a.id===n.id))return;const o=n.sender==="me"?s:n.sender;if(o&&!n.isPendingAuth){const a=i.find(c=>c.userId===n.sender),l=a?a.username:void 0;Pn.saveMessage({...n,chatId:o,type:n.type,senderName:l}).then(()=>{e().updateUnreadCount()})}n.sender!=="me"&&s!==n.sender&&!n.isPendingAuth&&(async()=>{let a=n.sender;const l=e().onlineUsers.find(c=>c.userId===n.sender);if(l)a=l.username;else{const c=await Pn.getChat(n.sender);if(c&&c.participantName&&c.participantName!==n.sender)a=c.participantName;else try{const d=(await Vo.getFriends()).find(h=>h.friend.id===n.sender);d&&(a=d.friend.username,Pn.updateChat(n.sender,{sender:n.sender,content:n.content,timestamp:n.timestamp},a))}catch{}}qo.notifyNewMessage({id:n.id,content:n.content,sender:a,chatId:n.sender})})(),t(a=>({messages:[...a.messages,n]}))},removeMessage:n=>{t(s=>({messages:s.messages.filter(r=>r.id!==n)}))},setActiveChat:n=>{t({activeChat:n})},disconnect:()=>{const{peerConnections:n,localStream:s}=e();n.forEach(r=>{r.connection.close()}),s==null||s.getTracks().forEach(r=>r.stop()),t({localStream:null,remoteStreams:new Map,peerConnections:new Map,dataChannels:new Map,isCallActive:!1,activeChat:null})},addReaction:(n,s)=>{t(r=>({messages:r.messages.map(i=>{if(i.id===n){const o=i.reactions||[],a=o.find(c=>c.emoji===s);let l;return a?l=o.map(c=>c.emoji===s?{...c,count:c.count+1,users:[...c.users,"me"]}:c):l=[...o,{emoji:s,count:1,users:["me"]}],{...i,reactions:l}}return i})}))}})),Vh=Object.freeze(Object.defineProperty({__proto__:null,useWebRTCStore:Be},Symbol.toStringTag,{value:"Module"}));class ine{constructor(){$e(this,"metrics",new Map);$e(this,"updateCallbacks",[]);this.initializeMetrics(),this.startPeriodicScoring()}initializeMetrics(){this.metrics.set("password_strength",{id:"password_strength",name:"Force du mot de passe",description:"Complexit et longueur de votre mot de passe",weight:15,currentValue:0,maxValue:100,improvementTips:["Utilisez un mot de passe de 12 caractres minimum","Combine lettres, chiffres et caractres spciaux","vitez les mots du dictionnaire"]}),this.metrics.set("two_factor",{id:"two_factor",name:"Double authentification",description:"Protection supplmentaire avec 2FA",weight:20,currentValue:0,maxValue:100,improvementTips:["Activez la double authentification","Utilisez une application d'authentification","Sauvegardez vos codes de rcupration"]}),this.metrics.set("encryption_usage",{id:"encryption_usage",name:"Chiffrement des messages",description:"Pourcentage de messages chiffrs",weight:25,currentValue:0,maxValue:100,improvementTips:["Activez le chiffrement de bout en bout","Vrifiez le statut de chiffrement avant d'envoyer","Utilisez des cls fortes"]}),this.metrics.set("file_security",{id:"file_security",name:"Scurit des fichiers",description:"Analyse des fichiers partags",weight:10,currentValue:0,maxValue:100,improvementTips:["Scannez les fichiers avant ouverture","vitez les excutables inconnus","Vrifiez les extensions de fichiers"]}),this.metrics.set("privacy_settings",{id:"privacy_settings",name:"Paramtres de confidentialit",description:"Configuration de vos prfrences de vie prive",weight:15,currentValue:0,maxValue:100,improvementTips:["Limitez les informations de profil publiques","Contrlez qui peut vous contacter","Dsactivez la collecte de donnes optionnelle"]}),this.metrics.set("update_habits",{id:"update_habits",name:"Mises  jour",description:"Dlai d'application des mises  jour de scurit",weight:10,currentValue:0,maxValue:100,improvementTips:["Activez les mises  jour automatiques","Installez les correctifs rapidement","Vrifiez rgulirement les nouvelles versions"]}),this.metrics.set("network_security",{id:"network_security",name:"Scurit rseau",description:"Utilisation de rseaux scuriss",weight:5,currentValue:0,maxValue:100,improvementTips:["vitez les rseaux WiFi publics","Utilisez un VPN sur rseaux non fiables","Vrifiez la scurit de votre connexion"]})}async calculateSecurityScore(){await this.updateAllMetrics();const e={authentication:this.calculateCategoryScore(["password_strength","two_factor"]),encryption:this.calculateCategoryScore(["encryption_usage"]),privacy:this.calculateCategoryScore(["privacy_settings"]),behavior:this.calculateCategoryScore(["file_security","update_habits"]),network:this.calculateCategoryScore(["network_security"])},n=Math.round((e.authentication+e.encryption+e.privacy+e.behavior+e.network)/5),s=this.getSecurityLevel(n),r={overall:n,breakdown:e,level:s,trends:await this.getTrends()};return this.notifyCallbacks(r),r}calculateCategoryScore(e){let n=0,s=0;return e.forEach(r=>{const i=this.metrics.get(r);i&&(n+=i.currentValue*i.weight,s+=i.weight)}),s>0?Math.round(n/s):0}getSecurityLevel(e){return e>=90?"excellent":e>=75?"good":e>=60?"fair":e>=40?"poor":"critical"}async updateAllMetrics(){this.metrics.get("password_strength").currentValue=70;const e=await this.check2FAStatus();this.metrics.get("two_factor").currentValue=e?100:0;const n=await this.calculateEncryptionUsage();this.metrics.get("encryption_usage").currentValue=n;const s=this.calculatePrivacyScore();this.metrics.get("privacy_settings").currentValue=s,this.metrics.get("update_habits").currentValue=80;const r=this.assessNetworkSecurity();this.metrics.get("network_security").currentValue=r;const i=await this.assessFileSecurity();this.metrics.get("file_security").currentValue=i}async check2FAStatus(){return localStorage.getItem("palfrog-2fa-enabled")==="true"}async calculateEncryptionUsage(){const{messages:e,isEncryptionEnabled:n}=Be.getState();if(!n)return 0;const s=e.filter(r=>r.type==="text"&&r.encrypted!==!1).length;return e.length>0?Math.round(s/e.length*100):100}calculatePrivacyScore(){let e=50;const n={profileVisibility:localStorage.getItem("palfrog-profile-visible")!=="public",contactRestrictions:localStorage.getItem("palfrog-contact-restrictions")==="enabled",dataCollection:localStorage.getItem("palfrog-data-collection")==="minimal"};return n.profileVisibility&&(e+=20),n.contactRestrictions&&(e+=20),n.dataCollection&&(e+=10),Math.min(e,100)}assessNetworkSecurity(){const e=navigator.connection;let n=70;return e&&(e.effectiveType==="4g"&&(n+=10),e.saveData&&(n+=10),this.isPublicWiFi()||(n+=10)),Math.min(n,100)}isPublicWiFi(){return["free","public","wifi","hotspot","guest"].some(n=>navigator.userAgent.toLowerCase().includes(n))}async assessFileSecurity(){const e=parseInt(localStorage.getItem("palfrog-dangerous-downloads")||"0"),n=parseInt(localStorage.getItem("palfrog-files-scanned")||"0");let s=80;return e>0&&(s-=e*10),n>10&&(s+=10),Math.max(0,Math.min(s,100))}async getTrends(){const e=localStorage.getItem("palfrog-security-trends");return e?JSON.parse(e):{daily:Array(7).fill(0).map(()=>Math.floor(Math.random()*30)+70),weekly:Array(4).fill(0).map(()=>Math.floor(Math.random()*20)+75),monthly:Array(6).fill(0).map(()=>Math.floor(Math.random()*15)+80)}}startPeriodicScoring(){setInterval(()=>{this.calculateSecurityScore()},60*60*1e3),window.addEventListener("online",()=>{this.calculateSecurityScore()})}onScoreUpdate(e){this.updateCallbacks.push(e)}notifyCallbacks(e){this.updateCallbacks.forEach(n=>n(e))}getImprovementTips(){const e=[];return this.metrics.forEach(n=>{n.currentValue<80&&e.push(...n.improvementTips.slice(0,1))}),[...new Set(e)].slice(0,3)}getMetrics(){return Array.from(this.metrics.values())}}const Uk=new ine,pFe=Object.freeze(Object.defineProperty({__proto__:null,securityScoreService:Uk},Symbol.toStringTag,{value:"Module"})),jz=wo((t,e)=>({score:0,level:"calculating",breakdown:{},isCalculating:!1,improvementTips:[],lastUpdate:null,calculateScore:async()=>{t({isCalculating:!0});try{const n=await Uk.calculateSecurityScore(),s=Uk.getImprovementTips();t({score:n.overall,level:n.level,breakdown:n.breakdown,improvementTips:s,lastUpdate:new Date,isCalculating:!1})}catch(n){console.error("Failed to calculate security score:",n),t({isCalculating:!1})}},dismissTip:n=>{t(r=>({improvementTips:r.improvementTips.filter(i=>i!==n)}));const s=JSON.parse(localStorage.getItem("palfrog-dismissed-tips")||"[]");s.push(n),localStorage.setItem("palfrog-dismissed-tips",JSON.stringify(s))},markTipCompleted:n=>{t(r=>({improvementTips:r.improvementTips.filter(i=>i!==n)}));const s=JSON.parse(localStorage.getItem("palfrog-completed-tips")||"[]");s.push(n),localStorage.setItem("palfrog-completed-tips",JSON.stringify(s))}})),Vz=({score:t})=>{const{score:e,level:n}=jz(),[s,r]=z.useState(!1),i=t??e,a=t!==void 0?(u=>u>=90?"excellent":u>=70?"good":u>=50?"fair":u>=30?"poor":"critical")(t):n;z.useEffect(()=>{r(t!==void 0?!0:a!=="excellent")},[a,t]);const l=()=>{switch(a){case"excellent":return"bg-green-500";case"good":return"bg-blue-500";case"fair":return"bg-yellow-500";case"poor":return"bg-orange-500";case"critical":return"bg-red-500";default:return"bg-gray-500"}},c=()=>{switch(a){case"excellent":return"";case"good":return"";case"fair":return"";case"poor":return"";case"critical":return"";default:return""}};return s?b.jsx("div",{className:`
            w-full px-4 py-2 rounded-xl text-white shadow-md mb-4
            ${l()} transition-all duration-300
        `,children:b.jsx("div",{className:"flex items-center justify-between",children:b.jsxs("div",{className:"flex items-center space-x-2",children:[b.jsx("span",{children:c()}),b.jsxs("span",{className:"text-sm font-medium",children:["Scurit: ",i,"/100"]})]})})}):null},Cb=({isOpen:t,onClose:e,user:n,isOnline:s})=>{const[r,i]=z.useState(n),[o,a]=z.useState(!1),l=_t(A=>A.user),c=_t(A=>A.updateUser),u=(l==null?void 0:l.id)===(n==null?void 0:n.id),[d,h]=z.useState(!1),[f,p]=z.useState({}),m=z.useRef(null);z.useEffect(()=>{t&&(n!=null&&n.id)?(a(!0),ed.getVisibleProfile(n.id).then(A=>{i(O=>({...O,...A})),p({...n,...A})}).catch(A=>console.error("Failed to fetch profile",A)).finally(()=>a(!1))):(i(n),p(n||{}))},[t,n]);const g=async()=>{if(r)try{a(!0);const A={firstName:f.firstName,lastName:f.lastName,country:f.country,profession:f.profession,maritalStatus:f.maritalStatus,phoneNumber:f.phoneNumber,bio:f.bio,avatarUrl:f.avatarUrl,firstNameVisibility:f.firstNameVisibility,lastNameVisibility:f.lastNameVisibility,countryVisibility:f.countryVisibility,professionVisibility:f.professionVisibility,maritalStatusVisibility:f.maritalStatusVisibility,birthDateVisibility:f.birthDateVisibility,genderVisibility:f.genderVisibility,emailVisibility:f.emailVisibility,phoneNumberVisibility:f.phoneNumberVisibility},O=Object.fromEntries(Object.entries(A).filter(([L,G])=>G!==void 0)),P=await ed.updateProfile(O);i(L=>({...L,...P})),u&&c(P),h(!1)}catch(A){console.error("Failed to update profile",A)}finally{a(!1)}},y=(A,O)=>{p(P=>({...P,[A]:O}))},x=A=>{var P;const O=(P=A.target.files)==null?void 0:P[0];if(O){const L=new FileReader;L.onloadend=()=>{y("avatarUrl",L.result)},L.readAsDataURL(O)}},v=()=>{var A;(A=m.current)==null||A.click()};if(!t||!r)return null;const w=A=>{const O=A.split("").reduce((U,K)=>U+K.charCodeAt(0),0),P=10+O%150,L=60+O%40,G=new Date;G.setDate(G.getDate()-O%730);const $=G.toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric"});return{friendCount:P,securityScore:L,joinDate:$}},{friendCount:S,securityScore:k}=w(r.id),C=r.createdAt?new Date(r.createdAt).toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric"}):w(r.id).joinDate,N=A=>{if(!A)return null;const O=new Date(A);if(isNaN(O.getTime()))return null;const P=new Date;let L=P.getFullYear()-O.getFullYear();const G=P.getMonth()-O.getMonth();return(G<0||G===0&&P.getDate()<O.getDate())&&L--,L},T=A=>A?A.charAt(0).toUpperCase()+A.slice(1):null,I=r.age!==void 0?r.age:N(r.birthDate),D=T(r.gender),F=(A,O)=>{const P=`${A}Visibility`;return b.jsxs("select",{value:O||"PUBLIC",onChange:L=>y(P,L.target.value),className:"text-xs border rounded p-1 ml-2",children:[b.jsx("option",{value:"PUBLIC",children:"Public"}),b.jsx("option",{value:"CONTACTS",children:"Contacts"}),b.jsx("option",{value:"PRIVATE",children:"Priv"})]})};return rT.createPortal(b.jsx("div",{className:"fixed inset-0 z-[9999] overflow-y-auto bg-black/50 backdrop-blur-sm",onClick:e,children:b.jsx("div",{className:"flex min-h-screen items-center justify-center p-4 text-center",children:b.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md overflow-hidden transform transition-all scale-100 animate-in fade-in zoom-in duration-200 relative text-left",onClick:A=>A.stopPropagation(),children:[b.jsxs("div",{className:"h-32 bg-gradient-to-r from-primary-500 to-accent-500 relative",children:[b.jsx("button",{onClick:e,className:"absolute top-4 right-4 text-white/80 hover:text-white bg-black/20 hover:bg-black/40 rounded-full p-2 transition-colors z-20",children:b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:b.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})}),u&&!d&&b.jsx("button",{onClick:()=>{p(r||{}),h(!0)},className:"absolute top-4 left-4 text-white/80 hover:text-white bg-black/20 hover:bg-black/40 rounded-full p-2 transition-colors z-20",children:b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:b.jsx("path",{d:"M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"})})})]}),b.jsxs("div",{className:"px-6 pb-6 relative flex flex-col items-center",children:[b.jsx("input",{type:"file",ref:m,className:"hidden",accept:"image/*",onChange:x}),b.jsx("div",{className:"-mt-16 mb-6 z-10 relative group",onClick:d?v:void 0,children:b.jsxs("div",{className:`w-32 h-32 rounded-full border-4 border-white bg-white shadow-lg flex items-center justify-center text-4xl font-bold text-primary-600 bg-gradient-to-br from-primary-100 to-accent-100 relative overflow-hidden ${d?"cursor-pointer":""}`,children:[f.avatarUrl||r.avatarUrl?b.jsx("img",{src:f.avatarUrl||r.avatarUrl,alt:r.username,className:"w-full h-full object-cover"}):b.jsx("span",{children:r.username[0].toUpperCase()}),s&&b.jsx("div",{className:`absolute bottom-2 right-2 w-6 h-6 ${r.status==="busy"?"bg-red-500":r.status==="away"?"bg-yellow-500":r.status==="dnd"?"bg-red-600":"bg-green-500"} border-4 border-white rounded-full`,title:r.status==="busy"?"Occup(e)":r.status==="away"?"Absent(e)":r.status==="dnd"?"Ne pas dranger":"En ligne"}),d&&b.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center transition-opacity opacity-0 group-hover:opacity-100",children:b.jsxs("div",{className:"text-center",children:[b.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-white mx-auto mb-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[b.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),b.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]}),b.jsx("span",{className:"text-white text-xs font-medium",children:"Modifier"})]})})]})}),"                        ",d?b.jsxs("div",{className:"w-full space-y-4",children:[b.jsxs("div",{children:[b.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Photo de profil (URL)"}),b.jsx("input",{type:"text",value:f.avatarUrl||"",onChange:A=>y("avatarUrl",A.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm border p-2",placeholder:"https://example.com/photo.jpg"})]}),b.jsxs("div",{children:[b.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Prnom"}),b.jsxs("div",{className:"flex",children:[b.jsx("input",{type:"text",value:f.firstName||"",onChange:A=>y("firstName",A.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm border p-2"}),F("firstName",f.firstNameVisibility)]})]}),b.jsxs("div",{children:[b.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Nom"}),b.jsxs("div",{className:"flex",children:[b.jsx("input",{type:"text",value:f.lastName||"",onChange:A=>y("lastName",A.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm border p-2"}),F("lastName",f.lastNameVisibility)]})]}),b.jsxs("div",{children:[b.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Bio"}),b.jsx("textarea",{value:f.bio||"",onChange:A=>y("bio",A.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm border p-2"})]}),b.jsxs("div",{children:[b.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Profession"}),b.jsxs("div",{className:"flex",children:[b.jsx("input",{type:"text",value:f.profession||"",onChange:A=>y("profession",A.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm border p-2"}),F("profession",f.professionVisibility)]})]}),b.jsxs("div",{children:[b.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Pays"}),b.jsxs("div",{className:"flex",children:[b.jsx("input",{type:"text",value:f.country||"",onChange:A=>y("country",A.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm border p-2"}),F("country",f.countryVisibility)]})]}),b.jsxs("div",{children:[b.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Tlphone"}),b.jsxs("div",{className:"flex",children:[b.jsx("input",{type:"text",value:f.phoneNumber||"",onChange:A=>y("phoneNumber",A.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm border p-2",placeholder:"+33 6 12 34 56 78"}),F("phoneNumber",f.phoneNumberVisibility)]})]}),b.jsxs("div",{children:[b.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Situation amoureuse"}),b.jsxs("div",{className:"flex",children:[b.jsxs("select",{value:f.maritalStatus||"",onChange:A=>y("maritalStatus",A.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm border p-2",children:[b.jsx("option",{value:"",children:"Non renseign"}),b.jsx("option",{value:"Clibataire",children:"Clibataire"}),b.jsx("option",{value:"En couple",children:"En couple"}),b.jsx("option",{value:"Mari(e)",children:"Mari(e)"}),b.jsx("option",{value:"Compliqu",children:"C'est compliqu"})]}),F("maritalStatus",f.maritalStatusVisibility)]})]}),b.jsxs("div",{className:"flex gap-2 pt-4",children:[b.jsx("button",{onClick:g,disabled:o,className:"flex-1 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700",children:o?"Enregistrement...":"Enregistrer"}),b.jsx("button",{onClick:()=>h(!1),className:"flex-1 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300",children:"Annuler"})]})]}):b.jsx(b.Fragment,{children:b.jsxs("div",{className:"text-center w-full",children:[b.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-1",children:r.firstName&&r.lastName?`${r.firstName} ${r.lastName}`:r.username}),r.firstName&&r.lastName&&b.jsxs("p",{className:"text-sm text-gray-500 mb-2",children:["@",r.username]}),r.profession&&b.jsx("p",{className:"text-primary-600 font-medium mb-2",children:r.profession}),r.bio&&b.jsxs("p",{className:"text-gray-600 text-sm italic mb-4 px-4",children:['"',r.bio,'"']}),b.jsx("div",{className:"flex items-center justify-center mb-6",children:s?b.jsxs("span",{className:`px-3 py-1 rounded-full text-sm font-medium flex items-center gap-2 ${r.status==="busy"?"bg-red-100 text-red-700":r.status==="away"?"bg-yellow-100 text-yellow-700":r.status==="dnd"?"bg-red-100 text-red-800":"bg-green-100 text-green-700"}`,children:[b.jsx("span",{className:`w-2 h-2 rounded-full animate-pulse ${r.status==="busy"?"bg-red-500":r.status==="away"?"bg-yellow-500":r.status==="dnd"?"bg-red-600":"bg-green-500"}`}),r.status==="busy"?"Occup(e)":r.status==="away"?"Absent(e)":r.status==="dnd"?"Ne pas dranger":"En ligne"]}):b.jsx("span",{className:"px-3 py-1 bg-gray-100 text-gray-500 rounded-full text-sm font-medium",children:"Hors ligne"})}),b.jsx("div",{className:"flex justify-center mb-8",children:b.jsx("div",{className:"w-full max-w-xs transform transition-transform hover:scale-105",children:b.jsx(Vz,{score:k})})}),b.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[b.jsxs("div",{className:"bg-gray-50 p-4 rounded-xl border border-gray-100",children:[b.jsx("div",{className:"text-gray-500 text-sm font-medium mb-1",children:"Amis"}),b.jsx("div",{className:"text-2xl font-bold text-gray-800",children:S})]}),b.jsxs("div",{className:"bg-gray-50 p-4 rounded-xl border border-gray-100",children:[b.jsx("div",{className:"text-gray-500 text-sm font-medium mb-1",children:"Membre depuis"}),b.jsx("div",{className:"text-lg font-bold text-gray-800",children:C})]})]}),b.jsxs("div",{className:"mt-6 space-y-3 text-left w-full max-w-xs mx-auto",children:[r.country&&b.jsxs("div",{className:"flex items-center gap-3 text-gray-600 p-3 hover:bg-gray-50 rounded-lg transition-colors",children:[b.jsx("span",{className:"text-xl",children:""}),b.jsx("span",{className:"text-sm",children:r.country})]}),r.maritalStatus&&b.jsxs("div",{className:"flex items-center gap-3 text-gray-600 p-3 hover:bg-gray-50 rounded-lg transition-colors",children:[b.jsx("span",{className:"text-xl",children:""}),b.jsx("span",{className:"text-sm",children:r.maritalStatus})]}),b.jsxs("div",{className:"flex items-center gap-3 text-gray-600 p-3 hover:bg-gray-50 rounded-lg transition-colors",children:[b.jsx("span",{className:"text-xl",children:""}),b.jsx("span",{className:"text-sm truncate",children:r.email||"Email masqu"})]}),r.phoneNumber&&b.jsxs("div",{className:"flex items-center gap-3 text-gray-600 p-3 hover:bg-gray-50 rounded-lg transition-colors",children:[b.jsx("span",{className:"text-xl",children:""}),b.jsx("span",{className:"text-sm",children:r.phoneNumber})]}),b.jsxs("div",{className:"flex items-center gap-3 text-gray-600 p-3 hover:bg-gray-50 rounded-lg transition-colors",children:[b.jsx("span",{className:"text-xl",children:""}),b.jsxs("span",{className:"text-sm",children:["Genre : ",D||b.jsx("span",{className:"text-gray-400 italic",children:"Non renseign"})]})]}),b.jsxs("div",{className:"flex items-center gap-3 text-gray-600 p-3 hover:bg-gray-50 rounded-lg transition-colors",children:[b.jsx("span",{className:"text-xl",children:""}),b.jsxs("span",{className:"text-sm",children:["ge : ",I!=null?`${I} ans`:b.jsx("span",{className:"text-gray-400 italic",children:"Non renseign"})]})]}),b.jsxs("div",{className:"flex items-center gap-3 text-gray-600 p-3 hover:bg-gray-50 rounded-lg transition-colors",children:[b.jsx("span",{className:"text-xl",children:""}),b.jsxs("span",{className:"text-sm",children:["Niveau de scurit: ",k,"/100"]})]})]}),b.jsx("div",{className:"mt-8 flex gap-3",children:b.jsx("button",{onClick:e,className:"flex-1 py-2.5 bg-gray-100 text-gray-700 font-medium rounded-xl hover:bg-gray-200 transition-colors",children:"Fermer"})})]})})]})]})})}),document.body)},one=({trigger:t})=>{const[e,n]=z.useState(!1),[s,r]=z.useState(0),i=[{title:"Bienvenue sur Palfrog",content:"Palfrog est une application de chat scurise peer-to-peer avec chiffrement de bout en bout."},{title:"Connexion Scurise",content:"Vos messages sont chiffrs avec AES-256. Seuls vous et votre destinataire pouvez les lire."},{title:"Appels Audio/Video",content:"Passez des appels directs P2P sans intermdiaire. Qualit optimise automatiquement."},{title:"Partage de Fichiers",content:"Envoyez des fichiers jusqu' 100MB directement entre appareils."},{title:"Mode Hors Ligne",content:"Vos messages sont sauvegards localement et synchroniss  la reconnexion."}];return e?b.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-start justify-center z-50 pt-40",children:b.jsx("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 max-h-96 overflow-hidden",children:b.jsxs("div",{className:"p-6",children:[b.jsxs("div",{className:"flex justify-between items-center mb-4",children:[b.jsx("h2",{className:"text-xl font-bold text-gray-900",children:i[s].title}),b.jsx("button",{onClick:()=>n(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:""})]}),b.jsx("div",{className:"mb-6",children:b.jsx("p",{className:"text-gray-700 leading-relaxed",children:i[s].content})}),b.jsxs("div",{className:"flex justify-between items-center",children:[b.jsx("button",{onClick:()=>r(o=>Math.max(0,o-1)),disabled:s===0,className:"px-4 py-2 text-gray-600 disabled:opacity-50 hover:text-gray-800 transition-colors",children:"Prcdent"}),b.jsx("div",{className:"flex space-x-2",children:i.map((o,a)=>b.jsx("div",{className:`w-2 h-2 rounded-full ${a===s?"bg-primary-500":"bg-gray-300"}`},a))}),s<i.length-1?b.jsx("button",{onClick:()=>r(o=>o+1),className:"px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors",children:"Suivant"}):b.jsx("button",{onClick:()=>n(!1),className:"px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors",children:"Commencer"})]})]})})}):b.jsx("div",{onClick:()=>n(!0),className:"cursor-pointer",children:t||b.jsx("button",{className:"fixed bottom-4 left-4 w-12 h-12 bg-primary-500 text-white rounded-full shadow-lg hover:bg-primary-600 transition-all duration-200 flex items-center justify-center z-30",title:"Guide d'utilisation",children:"?"})})},ane=()=>{const{user:t,logout:e,ui:n,toggleSidebar:s}=_t(),[r,i]=z.useState(!1);return b.jsxs("header",{className:"bg-white/80 backdrop-blur-md border-b border-gray-200/60 shadow-sm relative z-30",children:[t&&b.jsx(Cb,{isOpen:r,onClose:()=>i(!1),user:t,isOnline:!0}),b.jsx("div",{className:"px-4 sm:px-6 lg:px-8",children:b.jsxs("div",{className:"flex justify-between items-center h-16",children:[b.jsx("button",{onClick:s,className:"lg:hidden p-2 rounded-lg text-gray-600 hover:bg-gray-100 transition-colors duration-200",children:b.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:b.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),b.jsxs("div",{className:"flex items-center space-x-3",children:[b.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-primary-500 to-accent-400 rounded-lg flex items-center justify-center",children:b.jsx("span",{className:"text-white font-bold text-sm",children:"P"})}),b.jsx("h1",{className:"text-xl font-bold bg-gradient-to-r from-gray-800 to-primary-600 bg-clip-text text-transparent",children:"Palfrog"}),b.jsx(jX,{})]}),t&&b.jsxs("div",{className:"flex items-center space-x-4",children:[b.jsx(one,{trigger:b.jsx("div",{className:"w-10 h-10 bg-primary-500 text-white rounded-full flex items-center justify-center shadow-lg cursor-pointer hover:bg-primary-600 transition-all duration-200",title:"Guide d'utilisation",children:b.jsx("span",{className:"font-bold text-xl",children:"?"})})}),b.jsx(VX,{}),b.jsxs("div",{className:"hidden sm:flex items-center space-x-3",children:[b.jsxs("div",{className:"text-right",children:[b.jsx("p",{className:"text-sm font-medium text-gray-900",children:t.username}),b.jsx("p",{className:"text-xs text-gray-500 capitalize",children:t.role.toLowerCase()})]}),t.avatarUrl?b.jsx("img",{src:t.avatarUrl,alt:t.username,className:"w-10 h-10 rounded-full object-cover border-2 border-white shadow-sm"}):b.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-primary-500 to-accent-400 rounded-full flex items-center justify-center text-white font-semibold text-sm shadow-sm",children:t.username.charAt(0).toUpperCase()})]}),b.jsxs("div",{className:"relative group",children:[b.jsx("button",{className:"p-2 rounded-lg text-gray-400 hover:text-gray-600 hover:bg-gray-100 transition-all duration-200",children:b.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:b.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 12h.01M12 12h.01M19 12h.01M6 12a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0zm7 0a1 1 0 11-2 0 1 1 0 012 0z"})})}),b.jsxs("div",{className:"absolute right-0 top-12 w-48 py-2 bg-white rounded-xl shadow-lg border border-gray-200 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 transform translate-y-2 group-hover:translate-y-0",children:[b.jsxs("button",{onClick:()=>i(!0),className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-50 flex items-center space-x-2 transition-colors duration-150",children:[b.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:b.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),b.jsx("span",{children:"Mon Profil"})]}),b.jsxs("button",{onClick:e,className:"w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-50 flex items-center space-x-2 transition-colors duration-150",children:[b.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:b.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),b.jsx("span",{children:"Dconnexion"})]})]})]})]})]})})]})};class lne{constructor(){$e(this,"tiers",[{id:"free",name:"Gratuit",price:{monthly:0,yearly:0},features:{messages:!0,audioCalls:!0,videoCalls:!0,fileSharing:!0,maxFileSize:100,groupSize:10,basicAI:!0,securityScore:!0,basicAnalytics:!0,bridges:1,storage:5,support:"community"}},{id:"pro",name:"Pro",price:{monthly:9.99,yearly:99.99},popular:!0,features:{messages:!0,audioCalls:!0,videoCalls:!0,fileSharing:!0,maxFileSize:500,groupSize:50,advancedAI:!0,securityScore:!0,advancedAnalytics:!0,bridges:5,storage:50,customThemes:!0,prioritySupport:!0,voiceRooms:!0,advancedGamification:!0,exportAnalytics:!0}},{id:"enterprise",name:"Entreprise",price:{monthly:19.99,yearly:199.99},features:{messages:!0,audioCalls:!0,videoCalls:!0,fileSharing:!0,maxFileSize:1024,groupSize:500,premiumAI:!0,securityScore:!0,premiumAnalytics:!0,bridges:"unlimited",storage:500,customThemes:!0,dedicatedSupport:!0,voiceRooms:!0,advancedGamification:!0,exportAnalytics:!0,SSO:!0,adminPanel:!0,customBranding:!0,complianceReports:!0,APIaccess:!0,whiteLabel:!0}}]);$e(this,"currentSubscription",{tier:"free",status:"active",currentPeriodEnd:new Date("2030-12-31"),cancelAtPeriodEnd:!1})}canUseFeature(e){const n=this.tiers.find(r=>r.id===this.currentSubscription.tier);if(!n)return!1;const s=n.features[e];return typeof s=="boolean"?s:typeof s=="number"?this.checkFeatureLimits(e,s):s==="unlimited"?!0:!!s}checkFeatureLimits(e,n){switch(e){case"maxFileSize":return this.checkFileSizeLimit(n);case"groupSize":return this.checkGroupSizeLimit(n);case"storage":return this.checkStorageLimit(n);case"bridges":return this.checkBridgesLimit(n);default:return!0}}checkFileSizeLimit(e){return!0}checkGroupSizeLimit(e){return 0<e}checkStorageLimit(e){return this.getUsedStorage()<e*1024*1024*1024}checkBridgesLimit(e){return e==="unlimited"?!0:typeof e!="number"?!1:0<e}async subscribe(e,n,s){try{const r=await this.processPayment(e,n,s);return r.success?(this.currentSubscription={tier:e,status:"active",currentPeriodEnd:this.calculatePeriodEnd(n),cancelAtPeriodEnd:!1,priceId:r.priceId},this.saveSubscription(),this.triggerSubscriptionEvent("subscription_updated"),!0):!1}catch(r){return console.error("Subscription failed:",r),!1}}async cancelSubscription(){if(this.currentSubscription.tier==="free")return!0;try{return await this.cancelWithProvider(),this.currentSubscription.cancelAtPeriodEnd=!0,this.saveSubscription(),this.triggerSubscriptionEvent("subscription_canceled"),!0}catch(e){return console.error("Cancel failed:",e),!1}}async resumeSubscription(){try{return await this.resumeWithProvider(),this.currentSubscription.cancelAtPeriodEnd=!1,this.saveSubscription(),this.triggerSubscriptionEvent("subscription_resumed"),!0}catch(e){return console.error("Resume failed:",e),!1}}calculatePeriodEnd(e){const n=new Date;return e==="monthly"?n.setMonth(n.getMonth()+1):n.setFullYear(n.getFullYear()+1),n}getUsedStorage(){return 0}saveSubscription(){localStorage.setItem("palfrog-subscription",JSON.stringify(this.currentSubscription))}loadSubscription(){try{const e=localStorage.getItem("palfrog-subscription");e&&(this.currentSubscription=JSON.parse(e),this.currentSubscription.currentPeriodEnd=new Date(this.currentSubscription.currentPeriodEnd))}catch(e){console.error("Failed to load subscription:",e)}}triggerSubscriptionEvent(e){window.dispatchEvent(new CustomEvent("palfrog-subscription",{detail:{event:e,subscription:this.currentSubscription}}))}getCurrentSubscription(){return{...this.currentSubscription}}getTiers(){return[...this.tiers]}getTier(e){return this.tiers.find(n=>n.id===e)}getUpgradeBenefits(e,n){const s=this.getTier(e),r=this.getTier(n);if(!s||!r)return[];const i=[];return Object.keys(r.features).forEach(o=>{const a=s.features[o],l=r.features[o];a!==l&&(typeof l=="boolean"&&l?i.push(this.getFeatureDescription(o)):typeof l=="number"&&typeof a=="number"&&l>a&&i.push(`${this.getFeatureDescription(o)}: ${a}  ${l}`))}),i}getFeatureDescription(e){return{maxFileSize:"Taille maximale des fichiers",groupSize:"Taille des groupes",storage:"Stockage cloud",bridges:"Bridges d applications",advancedAI:"IA avance",premiumAI:"IA premium",customThemes:"Thmes personnaliss",prioritySupport:"Support prioritaire",dedicatedSupport:"Support ddi",voiceRooms:"Salons vocaux",advancedGamification:"Gamification avance",exportAnalytics:"Export analytics",SSO:"Authentification unique",adminPanel:"Panel administrateur",customBranding:"Branding personnalis",complianceReports:"Rapports de conformit",APIaccess:"Accs API",whiteLabel:"White-label"}[e]||e}async processPayment(e,n,s){return await new Promise(r=>setTimeout(r,2e3)),{success:!0,priceId:`price_${e}_${n}`}}async cancelWithProvider(){await new Promise(e=>setTimeout(e,1e3))}async resumeWithProvider(){await new Promise(e=>setTimeout(e,1e3))}}const fa=new lne,BT=wo((t,e)=>({currentTier:"free",isLoaded:!1,isLoading:!1,features:{},initialize:()=>{var s;fa.loadSubscription();const n=fa.getCurrentSubscription();t({currentTier:n.tier,isLoaded:!0,features:((s=fa.getTier(n.tier))==null?void 0:s.features)||{}})},canUseFeature:n=>fa.canUseFeature(n),subscribe:async(n,s,r)=>{t({isLoading:!0});try{const i=await fa.subscribe(n,s,r||{});return i&&e().initialize(),i}finally{t({isLoading:!1})}},cancelSubscription:async()=>{const n=await fa.cancelSubscription();return n&&e().initialize(),n},getUpgradeBenefits:n=>{const{currentTier:s}=e();return fa.getUpgradeBenefits(s,n)},getTiers:()=>fa.getTiers()})),cne=[{id:"chat",icon:"",label:"Messages"},{id:"contacts",icon:"",label:"Contacts"},{id:"friend-search",icon:"",label:"Recherche amis"},{id:"bridge",icon:"",label:"Bridges"},{id:"social",icon:"",label:"Arcade"},{id:"analytics",icon:"",label:"Analytics"},{id:"security",icon:"",label:"Scurit"},{id:"settings",icon:"",label:"Paramtres"}],une=()=>{const{ui:t,setCurrentView:e,user:n}=_t();BT();const{totalUnreadCount:s,updateUnreadCount:r}=Be();return z.useEffect(()=>{r()},[]),b.jsxs("nav",{className:"h-full bg-white/90 backdrop-blur-md border-r border-gray-200/60 shadow-sm flex flex-col",children:[b.jsx("div",{className:"p-4 border-b border-gray-200/60",children:b.jsxs("div",{className:`flex items-center space-x-3 transition-all duration-300 ${t.sidebarOpen?"opacity-100":"lg:opacity-0 xl:opacity-100"}`,children:[b.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-primary-500 to-accent-400 rounded-xl flex items-center justify-center shadow-md",children:b.jsx("span",{className:"text-white font-bold text-lg",children:"P"})}),b.jsxs("div",{className:"flex-1 min-w-0",children:[b.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-gray-800 to-primary-600 bg-clip-text text-transparent",children:"Palfrog"}),b.jsx("p",{className:"text-xs text-gray-500",children:"Connectez-vous librement"})]})]})}),b.jsx("div",{className:"flex-1 py-4 px-3 space-y-1",children:cne.map(i=>{const o=i.id==="chat"?s:0;return b.jsxs("button",{onClick:()=>e(i.id),className:`
              w-full flex items-center space-x-3 p-3 rounded-xl transition-all duration-200 group relative
              ${t.currentView===i.id?"bg-primary-50 text-primary-600 shadow-sm border border-primary-100":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"}
            `,children:[b.jsxs("div",{className:"relative flex items-center justify-center",children:[b.jsx("span",{className:"text-lg transform group-hover:scale-110 transition-transform duration-200",children:i.icon}),o>0&&b.jsx("span",{className:`
                                    absolute -top-1 -right-1 w-2 h-2 bg-red-500 rounded-full border-2 border-white
                                    transition-all duration-300 
                                    ${t.sidebarOpen?"opacity-0 scale-0":"lg:opacity-100 lg:scale-100 xl:opacity-0 xl:scale-0"}
                                `})]}),b.jsx("span",{className:`font-medium text-sm transition-all duration-300 ${t.sidebarOpen?"opacity-100":"lg:opacity-0 xl:opacity-100"}`,children:i.label}),o>0&&b.jsx("span",{className:`
                                ml-auto bg-red-500 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full min-w-[18px] flex items-center justify-center shadow-sm
                                transition-all duration-300 ${t.sidebarOpen?"opacity-100":"lg:opacity-0 xl:opacity-100"}
                            `,children:o})]},i.id)})})]})},dne=()=>{const{onlineNotification:t,hideOnlineNotification:e,setActiveChat:n,onlineUsers:s}=Be(),{setCurrentView:r}=_t(),[i,o]=z.useState(!1);z.useEffect(()=>{if(t){o(!0),a();const h=setTimeout(()=>{o(!1),setTimeout(e,500)},5e3);return()=>clearTimeout(h)}},[t,e]);const a=()=>{try{const h=new(window.AudioContext||window.webkitAudioContext),f=h.createOscillator(),p=h.createGain();f.type="sine",f.frequency.setValueAtTime(500,h.currentTime),f.frequency.exponentialRampToValueAtTime(1e3,h.currentTime+.1),p.gain.setValueAtTime(.1,h.currentTime),p.gain.exponentialRampToValueAtTime(.01,h.currentTime+.5),f.connect(p),p.connect(h.destination),f.start(),f.stop(h.currentTime+.5)}catch(h){console.error("Audio play failed",h)}},l=()=>{if(console.log("Notification clicked",t),t){if(t.userId){console.log("Opening chat with userId:",t.userId),n(t.userId),r("chat"),o(!1),setTimeout(e,300);return}console.log("Searching user by username:",t.username);const h=s.find(f=>f.username===t.username);h?(console.log("Found user:",h.userId),n(h.userId),r("chat"),o(!1),setTimeout(e,300)):console.warn("User not found for notification click")}};if(!t&&!i)return null;const c=(t==null?void 0:t.status)||"online";console.log(" UserOnlineNotification: Rendering with data:",{username:t==null?void 0:t.username,status:c,rawNotification:t});const u={online:{label:"est en ligne",badgeLabel:"En ligne",color:"bg-green-500",textColor:"text-green-700",message:"Cliquez pour discuter !",ringColor:"ring-green-500"},busy:{label:"est occup(e)",badgeLabel:"Occup",color:"bg-red-500",textColor:"text-red-700",message:"Revenez plus tard.",ringColor:"ring-red-500"},away:{label:"est absent(e)",badgeLabel:"Absent",color:"bg-yellow-500",textColor:"text-yellow-700",message:"Peut ne pas rpondre.",ringColor:"ring-yellow-500"},dnd:{label:"ne veut pas tre drang(e)",badgeLabel:"DND",color:"bg-red-600",textColor:"text-red-800",message:"Ne pas dranger.",ringColor:"ring-red-600"},offline:{label:"est hors ligne",badgeLabel:"Hors ligne",color:"bg-gray-400",textColor:"text-gray-600",message:"",ringColor:"ring-gray-400"}},d=u[c]||u.online;return b.jsx("div",{onClick:l,className:`fixed top-24 right-6 z-[100] transition-all duration-500 ease-out cursor-pointer transform
                ${i?"opacity-100 translate-y-0 scale-100":"opacity-0 -translate-y-8 scale-95 pointer-events-none"}
            `,children:b.jsxs("div",{className:`
                bg-white/90 backdrop-blur-xl 
                px-6 py-4 rounded-2xl shadow-2xl 
                border border-white/50
                flex items-center gap-4 
                hover:shadow-3xl hover:translate-y-1 hover:scale-[1.02] 
                active:scale-95
                transition-all duration-300 group
                max-w-sm w-full
            `,children:[b.jsxs("div",{className:"relative flex-shrink-0",children:[b.jsx("div",{className:`w-4 h-4 ${d.color} rounded-full animate-ping absolute top-0 left-0 opacity-50`}),b.jsx("div",{className:`w-4 h-4 ${d.color} rounded-full relative z-10 ring-2 ring-white shadow-sm`})]}),b.jsxs("div",{className:"flex flex-col flex-1 min-w-0",children:[b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsx("span",{className:"font-bold text-gray-900 truncate text-base",children:t==null?void 0:t.username}),b.jsx("span",{className:`text-xs font-bold px-2 py-0.5 rounded-full ${d.color} ${d.textColor} bg-opacity-20`,children:d.badgeLabel})]}),b.jsxs("span",{className:`text-sm ${d.textColor} font-medium mt-0.5 truncate`,children:[t==null?void 0:t.username," ",d.label]})]}),b.jsx("div",{className:"text-gray-400 group-hover:text-gray-600 transition-colors",children:b.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:b.jsx("path",{fillRule:"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z",clipRule:"evenodd"})})})]})})},hne=({children:t})=>{const{ui:e}=_t();return b.jsxs("div",{className:"flex h-screen bg-gradient-to-br from-gray-50 via-blue-50 to-cyan-50",children:[b.jsx(dne,{}),b.jsx("div",{className:`
        fixed lg:relative z-40 transform transition-all duration-300 ease-in-out
        ${e.sidebarOpen?"translate-x-0":"-translate-x-full lg:translate-x-0"}
        w-80 lg:w-20 xl:w-80
      `,children:b.jsx(une,{})}),e.sidebarOpen&&b.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-30 lg:hidden",onClick:()=>_t.getState().toggleSidebar()}),b.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[b.jsx(ane,{}),b.jsx("main",{className:"flex-1 overflow-hidden transition-all duration-300",children:t})]})]})},fne=()=>{const{initializeWebRTC:t}=Be(),{user:e}=_t(),n=e==null?void 0:e.id;return z.useEffect(()=>(n&&(t(),Rs.connect()),()=>{Rs.disconnect()}),[n,t]),null},pne=({peerId:t})=>{const e=z.useRef(null),{sendFile:n}=pr();Be();const s=o=>new Promise(a=>{const l=document.createElement("video");l.preload="metadata",l.src=URL.createObjectURL(o),l.muted=!0,l.playsInline=!0,l.currentTime=1,l.onloadeddata=()=>{l.readyState>=2?c():l.oncanplay=c};function c(){try{const u=document.createElement("canvas"),h=Math.min(1,320/l.videoWidth);u.width=l.videoWidth*h,u.height=l.videoHeight*h;const f=u.getContext("2d");f==null||f.drawImage(l,0,0,u.width,u.height);const p=u.toDataURL("image/jpeg",.7);URL.revokeObjectURL(l.src),a(p)}catch(u){console.error("Error generating thumbnail:",u),URL.revokeObjectURL(l.src),a(null)}}l.onerror=()=>{URL.revokeObjectURL(l.src),a(null)}}),r=async o=>{const a=o.target.files;if(!a||a.length===0)return;const l=a[0];let c;try{if(l.type.startsWith("video/")){const u=await s(l);u&&(c=u)}await n(t,l,c)}catch(u){console.error("File send failed:",u),Be.getState().addMessage({id:`file-error-${Date.now()}`,content:` Erreur lors de l'envoi de "${l.name}"`,sender:"system",timestamp:new Date,type:"system"})}e.current&&(e.current.value="")},i=()=>{var o;(o=e.current)==null||o.click()};return b.jsxs(b.Fragment,{children:[b.jsx("input",{type:"file",ref:e,onChange:r,className:"hidden",multiple:!1}),b.jsx("button",{type:"button",onClick:i,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",title:"Envoyer un fichier",children:b.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:b.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"})})})]})},mne=({isOpen:t,onClose:e})=>{const[n,s]=z.useState(""),{messages:r,activeChat:i}=Be(),o=z.useMemo(()=>n.trim()?r.filter(l=>l.sender===i||l.sender==="me").filter(l=>l.content&&l.content.toLowerCase().includes(n.toLowerCase())).slice(-50):[],[r,i,n]),a=l=>{l.key==="Escape"&&e()};return t?b.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-start justify-center z-40 pt-20",children:b.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-2xl mx-4 max-h-96 overflow-hidden",children:[b.jsx("div",{className:"p-4 border-b border-gray-200",children:b.jsxs("div",{className:"flex items-center space-x-3",children:[b.jsxs("div",{className:"flex-1 relative",children:[b.jsx("input",{type:"text",value:n,onChange:l=>s(l.target.value),onKeyDown:a,placeholder:"Rechercher dans les messages...",className:"w-full px-4 py-3 pl-10 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent",autoFocus:!0}),b.jsx("div",{className:"absolute left-3 top-3 text-gray-400",children:""})]}),b.jsx("button",{onClick:e,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:""})]})}),b.jsx("div",{className:"overflow-y-auto max-h-64",children:o.length===0?b.jsx("div",{className:"p-8 text-center text-gray-500",children:n?"Aucun message trouv":"Tapez pour rechercher..."}):b.jsx("div",{className:"divide-y divide-gray-100",children:o.map(l=>b.jsxs("div",{className:"p-4 hover:bg-gray-50 cursor-pointer",onClick:()=>{const c=document.getElementById(`message-${l.id}`);c==null||c.scrollIntoView({behavior:"smooth",block:"center"}),c==null||c.classList.add("bg-yellow-100","animate-pulse"),setTimeout(()=>{c==null||c.classList.remove("bg-yellow-100","animate-pulse")},2e3),e()},children:[b.jsxs("div",{className:"flex justify-between items-start mb-1",children:[b.jsx("span",{className:"text-sm font-medium text-gray-900",children:l.sender==="me"?"Vous":l.sender}),b.jsx("span",{className:"text-xs text-gray-500",children:new Date(l.timestamp).toLocaleString()})]}),b.jsx("p",{className:"text-sm text-gray-700",children:l.content})]},l.id))})}),b.jsx("div",{className:"p-3 bg-gray-50 border-t border-gray-200",children:b.jsxs("div",{className:"flex justify-between items-center text-xs text-gray-500",children:[b.jsxs("span",{children:[o.length," rsultat(s)"]}),b.jsx("span",{children:"ESC pour fermer"})]})})]})}):null};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gne=1e-7,yne=1e-4;class Uz{constructor(e,n){this.backend=e,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,n){this.dataIdsCount++,this.data.set(e,n)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class jT{refCount(e){return Xs("refCount")}incRef(e){return Xs("incRef")}timerAvailable(){return!0}time(e){return Xs("time")}read(e){return Xs("read")}readSync(e){return Xs("readSync")}readToGPU(e,n){return Xs("readToGPU")}numDataIds(){return Xs("numDataIds")}disposeData(e,n){return Xs("disposeData")}write(e,n,s){return Xs("write")}move(e,n,s,r,i){return Xs("move")}createTensorFromGPUData(e,n,s){return Xs("createTensorFromGPUData")}memory(){return Xs("memory")}floatPrecision(){return Xs("floatPrecision")}epsilon(){return this.floatPrecision()===32?gne:yne}dispose(){return Xs("dispose")}}function Xs(t){throw new Error(`'${t}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xne(t){let e=t.length,n=0;for(;e>0;)n=Math.random()*e|0,e--,ku(t,e,n)}function Cc(t,e,n){return Math.max(t,Math.min(e,n))}function VT(t){return t%2===0?t:t+1}function ku(t,e,n){const s=t[e];t[e]=t[n],t[n]=s}function bne(t){let e=0;for(let n=0;n<t.length;n++)e+=t[n];return e}function E(t,e){if(!t)throw new Error(typeof e=="string"?e:e())}function UT(t,e,n=""){E(ct(t,e),()=>n+` Shapes ${t} and ${e} must match`)}function Wz(t){E(t!=null,()=>"The input to the tensor constructor must be a non-null value.")}function Q(t){if(t.length===0)return 1;let e=t[0];for(let n=1;n<t.length;n++)e*=t[n];return e}function ct(t,e){if(t===e)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function wd(t){return t%1===0}function Wk(t){const e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]}function td(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function jD(t,e=r=>0,n,s){return new Promise((r,i)=>{let o=0;const a=()=>{if(t()){r();return}o++;const l=e(o);if(n!=null&&o>=n){i();return}s!=null?s(a,l):setTimeout(a,l)};a()})}function Hz(t,e){let n=1,s=-1;for(let i=0;i<t.length;++i)if(t[i]>=0)n*=t[i];else if(t[i]===-1){if(s!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${s} and dim ${i}`);s=i}else if(t[i]<0)throw Error(`Shapes can not be < 0. Found ${t[i]} at dim ${i}`);if(s===-1){if(e>0&&e!==n)throw Error(`Size(${e}) must match the product of shape ${t}`);return t}if(n===0)throw Error(`Cannot infer the missing size in [${t}] when there are 0 elements`);if(e%n!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${n}`);const r=t.slice();return r[s]=e/n,r}function Ge(t,e){const n=e.length;return t=t==null?e.map((s,r)=>r):[].concat(t),E(t.every(s=>s>=-n&&s<n),()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${t}`),E(t.every(s=>wd(s)),()=>`All values in axis param must be integers but got axis ${t}`),t.map(s=>s<0?n+s:s)}function bl(t,e){const n=[],s=[],r=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||r?null:Ge(e,t).sort();let o=0;for(let a=0;a<t.length;++a){if(i!=null){if(i[o]===a&&t[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${t[a]}' is not 1`);(i[o]==null||i[o]>a)&&t[a]===1&&(n.push(t[a]),s.push(a)),i[o]<=a&&o++}t[a]!==1&&(n.push(t[a]),s.push(a))}return{newShape:n,keptDims:s}}function ns(t,e){return Zt(t,e)}function Zt(t,e){let n=null;if(t==null||t==="float32")n=new Float32Array(e);else if(t==="int32")n=new Int32Array(e);else if(t==="bool")n=new Uint8Array(e);else if(t==="string")n=new Array(e);else throw new Error(`Unknown data type ${t}`);return n}function vne(t,e){for(let n=0;n<t.length;n++){const s=t[n];if(isNaN(s)||!isFinite(s))throw Error(`A tensor of type ${e} being uploaded contains ${s}.`)}}function wne(t){return t==="bool"||t==="complex64"||t==="float32"||t==="int32"||t==="string"}function Gz(t,e){return!(e==="complex64"||e==="float32"&&t!=="complex64"||e==="int32"&&t!=="float32"&&t!=="complex64"||e==="bool"&&t==="bool")}function k0(t){if(t==="float32"||t==="int32")return 4;if(t==="complex64")return 8;if(t==="bool")return 1;throw new Error(`Unknown dtype ${t}`)}function Sne(t){if(t==null)return 0;let e=0;return t.forEach(n=>e+=n.length),e}function Op(t){return typeof t=="string"||t instanceof String}function kne(t){return typeof t=="boolean"}function Hk(t){return typeof t=="number"}function Gd(t){return Array.isArray(t)?Gd(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray?"int32":Hk(t)?"float32":Op(t)?"string":kne(t)?"bool":"float32"}function Gk(t){return!!(t&&t.constructor&&t.call&&t.apply)}function Kk(t,e){for(let n=e;n<t;++n)if(t%n===0)return n;return t}function ke(t){const e=t.length;if(e<2)return[];const n=new Array(e-1);n[e-2]=t[e-1];for(let s=e-3;s>=0;--s)n[s]=n[s+1]*t[s+1];return n}function Kz(t,e,n,s=!1){const r=new Array;if(e.length===1){const i=e[0]*(s?2:1);for(let o=0;o<i;o++)r[o]=n[t+o]}else{const i=e[0],o=e.slice(1),a=o.reduce((l,c)=>l*c)*(s?2:1);for(let l=0;l<i;l++)r[l]=Kz(t+l*a,o,n,s)}return r}function Ei(t,e,n=!1){if(t.length===0)return e[0];const s=t.reduce((r,i)=>r*i)*(n?2:1);if(s===0)return[];if(s!==e.length)throw new Error(`[${t}] does not match the input size ${e.length}${n?" for a complex tensor":""}.`);return Kz(0,t,e,n)}function Cne(t,e){if(Array.isArray(t))return t;if(e==="float32")return t instanceof Float32Array?t:new Float32Array(t);if(e==="int32")return t instanceof Int32Array?t:new Int32Array(t);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(t));throw new Error(`Unknown dtype ${e}`)}function WT(t,e){const n=ss(t,e);for(let s=0;s<n.length;s++)n[s]=1;return n}function ss(t,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool")return new Uint8Array(t);throw new Error(`Unknown data type ${e}`)}function qz(t,e){const n=t.reduce((s,r)=>s*r,1);if(e==null||e==="float32")return Ei(t,new Float32Array(n));if(e==="int32")return Ei(t,new Int32Array(n));if(e==="bool")return Ei(t,new Uint8Array(n));throw new Error(`Unknown data type ${e}`)}function aa(t){t.forEach(e=>{E(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${t}].`)})}function oo(t,e,n){if(e===0)return 0;if(e===1)return t[0];let s=t[t.length-1];for(let r=0;r<t.length-1;++r)s+=n[r]*t[r];return s}function Kd(t,e,n){if(e===0)return[];if(e===1)return[t];const s=new Array(e);for(let r=0;r<s.length-1;++r)s[r]=Math.floor(t/n[r]),t-=s[r]*n[r];return s[s.length-1]=t,s}function HT(t){return t&&t.then&&typeof t.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VD="tfjsflags";class Nne{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=Tne,this.populateURLFlags()}setPlatform(e,n){this.platform!=null&&(X().getBool("IS_TEST")||X().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=n}registerFlag(e,n,s){if(this.flagRegistry[e]={evaluationFn:n,setHook:s},this.urlFlags[e]!=null){const r=this.urlFlags[e];X().getBool("IS_TEST")||X().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${r}.`),this.set(e,r)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const n=this.evaluateFlag(e);if(HT(n))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=n,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,n){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=n,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(n)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const e=this.getQueryParams(this.global.location.search);VD in e&&e[VD].split(",").forEach(s=>{const[r,i]=s.split(":");this.urlFlags[r]=Ine(r,i)})}}function Tne(t){const e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(n,...s)=>(Ene(e,s[0],s[1]),s.join("="))),e}function Ene(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}function Ine(t,e){const n=e.toLowerCase();return n==="true"||n==="false"?n==="true":`${+n}`===n?+n:e}function X(){return Xz}let Xz=null;function Ane(t){Xz=t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let yw;function Jz(){if(yw==null){let t;if(typeof window<"u")t=window;else if(typeof globalThis<"u")t=globalThis;else if(typeof process<"u")t=process;else if(typeof self<"u")t=self;else throw new Error("Could not find a globalThis object");yw=t}return yw}function $ne(){const t=Jz();return t._tfGlobals==null&&(t._tfGlobals=new Map),t._tfGlobals}function GT(t,e){const n=$ne();if(n.has(t))return n.get(t);{const s=e();return n.set(t,s),n.get(t)}}const Nb="Abs",Mp="Acos",Pp="Acosh",qd="Add",KT="AddN",qT="All",XT="Any",Tb="ArgMax",Eb="ArgMin",Lp="Asin",Fp="Asinh",_p="Atan",zp="Atanh",Bp="Atan2",Ib="AvgPool",JT="AvgPoolGrad",Ab="AvgPool3D",YT="AvgPool3DGrad",$b="BatchMatMul",Rb="BatchToSpaceND",QT="Bincount",ZT="BitwiseAnd",Rne="BroadcastTo",Yz="BroadcastArgs",jp="Cast",Vp="Ceil",Up="ClipByValue",eE="Complex",Db="ComplexAbs",Ob="Concat",Mb="Conv2D",tE="Conv2DBackpropFilter",Pb="Conv2DBackpropInput",Lb="Conv3D",nE="Conv3DBackpropFilterV2",sE="Conv3DBackpropInputV2",Wp="Cos",Hp="Cosh",rE="Cumprod",Fb="Cumsum",iE="CropAndResize",oE="DenseBincount",aE="DepthToSpace",_b="DepthwiseConv2dNative",lE="DepthwiseConv2dNativeBackpropFilter",cE="DepthwiseConv2dNativeBackpropInput",Qz="Diag",zb="Dilation2D",qk="Dilation2DBackpropInput",Xk="Dilation2DBackpropFilter",Dne="Draw",Gp="RealDiv",uE="Einsum",Kp="Elu",dE="EluGrad",qp="Erf",Bb="Equal",Xp="Exp",jb="ExpandDims",Jp="Expm1",hE="FFT",fE="Fill",pE="FlipLeftRight",Yp="Floor",Qp="FloorDiv",Vb="FusedBatchNorm",Ub="GatherV2",Zz="GatherNd",Wb="Greater",Zp="GreaterEqual",em="Identity",mE="IFFT",gE="Imag",tm="IsFinite",nm="IsInf",sm="IsNan",Hb="LeakyRelu",Gb="Less",Kb="LessEqual",eB="LinSpace",rm="Log",im="Log1p",qb="LogicalAnd",Xb="LogicalNot",Jb="LogicalOr",One="LogSoftmax",Yb="LRN",yE="LRNGrad",Qb="Max",om="Maximum",Zb="MaxPool",xE="MaxPoolGrad",ev="MaxPool3D",bE="MaxPool3DGrad",tB="MaxPoolWithArgmax",tv="Mean",nv="Min",am="Minimum",sv="MirrorPad",lm="Mod",nB="Multinomial",cm="Multiply",rv="Neg",iv="NotEqual",vE="NonMaxSuppressionV3",wE="NonMaxSuppressionV4",SE="NonMaxSuppressionV5",ov="OnesLike",av="OneHot",lv="Pack",cv="PadV2",um="Pow",uv="Prelu",dv="Prod",sB="RaggedGather",rB="RaggedRange",iB="RaggedTensorToTensor",kE="Range",CE="Real",dm="Reciprocal",hm="Relu",hv="Reshape",fv="ResizeNearestNeighbor",NE="ResizeNearestNeighborGrad",pv="ResizeBilinear",TE="ResizeBilinearGrad",fm="Relu6",mv="Reverse",pm="Round",mm="Rsqrt",oB="ScatterNd",aB="TensorScatterUpdate",lB="SearchSorted",gv="Select",gm="Selu",yv="Slice",ym="Sin",xm="Sinh",bm="Sign",vm="Sigmoid",wm="Softplus",Sm="Sqrt",xv="Sum",bv="SpaceToBatchND",vv="SplitV",wv="Softmax",cB="SparseFillEmptyRows",uB="SparseReshape",dB="SparseSegmentMean",hB="SparseSegmentSum",fB="SparseToDense",km="SquaredDifference",EE="Square",IE="StaticRegexReplace",AE="StridedSlice",pB="StringNGrams",mB="StringSplit",gB="StringToHashBucketFast",Cm="Sub",Nm="Tan",Tm="Tanh",Em="Tile",$E="TopK",RE="Transform",nd="Transpose",DE="Unique",Sv="Unpack",kv="UnsortedSegmentSum",Cv="ZerosLike",Im="Step",Mne="FromPixels",OE="RotateWithOffset",C0="_FusedMatMul",N0="FusedConv2D",yB="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gr(...t){X().getBool("IS_TEST")||X().getBool("PROD")||console.warn(...t)}function Pne(...t){X().getBool("IS_TEST")||X().getBool("PROD")||console.log(...t)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T0=GT("kernelRegistry",()=>new Map),Jk=GT("gradRegistry",()=>new Map);function UD(t,e){const n=bB(t,e);return T0.get(n)}function WD(t){return Jk.get(t)}function HD(t){const e=T0.entries(),n=[];for(;;){const{done:s,value:r}=e.next();if(s)break;const[i,o]=r,[a]=i.split("_");a===t&&n.push(o)}return n}function xB(t){const{kernelName:e,backendName:n}=t,s=bB(e,n);T0.has(s)&&gr(`The kernel '${e}' for backend '${n}' is already registered`),T0.set(s,t)}function Lne(t){const{kernelName:e}=t;Jk.has(e)&&X().getBool("DEBUG")&&gr(`Overriding the gradient for '${e}'`),Jk.set(e,t)}function bB(t,e){return`${e}_${t}`}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vB(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray}var wB=Et,Kr=null;try{Kr=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function Et(t,e,n){this.low=t|0,this.high=e|0,this.unsigned=!!n}Et.prototype.__isLong__;Object.defineProperty(Et.prototype,"__isLong__",{value:!0});function dr(t){return(t&&t.__isLong__)===!0}Et.isLong=dr;var GD={},KD={};function Xc(t,e){var n,s,r;return e?(t>>>=0,(r=0<=t&&t<256)&&(s=KD[t],s)?s:(n=It(t,(t|0)<0?-1:0,!0),r&&(KD[t]=n),n)):(t|=0,(r=-128<=t&&t<128)&&(s=GD[t],s)?s:(n=It(t,t<0?-1:0,!1),r&&(GD[t]=n),n))}Et.fromInt=Xc;function qr(t,e){if(isNaN(t))return e?ec:Xr;if(e){if(t<0)return ec;if(t>=SB)return NB}else{if(t<=-XD)return er;if(t+1>=XD)return CB}return t<0?qr(-t,e).neg():It(t%Sd|0,t/Sd|0,e)}Et.fromNumber=qr;function It(t,e,n){return new Et(t,e,n)}Et.fromBits=It;var E0=Math.pow;function ME(t,e,n){if(t.length===0)throw Error("empty string");if(t==="NaN"||t==="Infinity"||t==="+Infinity"||t==="-Infinity")return Xr;if(typeof e=="number"?(n=e,e=!1):e=!!e,n=n||10,n<2||36<n)throw RangeError("radix");var s;if((s=t.indexOf("-"))>0)throw Error("interior hyphen");if(s===0)return ME(t.substring(1),e,n).neg();for(var r=qr(E0(n,8)),i=Xr,o=0;o<t.length;o+=8){var a=Math.min(8,t.length-o),l=parseInt(t.substring(o,o+a),n);if(a<8){var c=qr(E0(n,a));i=i.mul(c).add(qr(l))}else i=i.mul(r),i=i.add(qr(l))}return i.unsigned=e,i}Et.fromString=ME;function Li(t,e){return typeof t=="number"?qr(t,e):typeof t=="string"?ME(t,e):It(t.low,t.high,typeof e=="boolean"?e:t.unsigned)}Et.fromValue=Li;var qD=65536,Fne=1<<24,Sd=qD*qD,SB=Sd*Sd,XD=SB/2,JD=Xc(Fne),Xr=Xc(0);Et.ZERO=Xr;var ec=Xc(0,!0);Et.UZERO=ec;var Gu=Xc(1);Et.ONE=Gu;var kB=Xc(1,!0);Et.UONE=kB;var Yk=Xc(-1);Et.NEG_ONE=Yk;var CB=It(-1,2147483647,!1);Et.MAX_VALUE=CB;var NB=It(-1,-1,!0);Et.MAX_UNSIGNED_VALUE=NB;var er=It(0,-2147483648,!1);Et.MIN_VALUE=er;var de=Et.prototype;de.toInt=function(){return this.unsigned?this.low>>>0:this.low};de.toNumber=function(){return this.unsigned?(this.high>>>0)*Sd+(this.low>>>0):this.high*Sd+(this.low>>>0)};de.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(er)){var n=qr(e),s=this.div(n),r=s.mul(n).sub(this);return s.toString(e)+r.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=qr(E0(e,6),this.unsigned),o=this,a="";;){var l=o.div(i),c=o.sub(l.mul(i)).toInt()>>>0,u=c.toString(e);if(o=l,o.isZero())return u+a;for(;u.length<6;)u="0"+u;a=""+u+a}};de.getHighBits=function(){return this.high};de.getHighBitsUnsigned=function(){return this.high>>>0};de.getLowBits=function(){return this.low};de.getLowBitsUnsigned=function(){return this.low>>>0};de.getNumBitsAbs=function(){if(this.isNegative())return this.eq(er)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,n=31;n>0&&!(e&1<<n);n--);return this.high!=0?n+33:n+1};de.isZero=function(){return this.high===0&&this.low===0};de.eqz=de.isZero;de.isNegative=function(){return!this.unsigned&&this.high<0};de.isPositive=function(){return this.unsigned||this.high>=0};de.isOdd=function(){return(this.low&1)===1};de.isEven=function(){return(this.low&1)===0};de.equals=function(e){return dr(e)||(e=Li(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};de.eq=de.equals;de.notEquals=function(e){return!this.eq(e)};de.neq=de.notEquals;de.ne=de.notEquals;de.lessThan=function(e){return this.comp(e)<0};de.lt=de.lessThan;de.lessThanOrEqual=function(e){return this.comp(e)<=0};de.lte=de.lessThanOrEqual;de.le=de.lessThanOrEqual;de.greaterThan=function(e){return this.comp(e)>0};de.gt=de.greaterThan;de.greaterThanOrEqual=function(e){return this.comp(e)>=0};de.gte=de.greaterThanOrEqual;de.ge=de.greaterThanOrEqual;de.compare=function(e){if(dr(e)||(e=Li(e)),this.eq(e))return 0;var n=this.isNegative(),s=e.isNegative();return n&&!s?-1:!n&&s?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};de.comp=de.compare;de.negate=function(){return!this.unsigned&&this.eq(er)?er:this.not().add(Gu)};de.neg=de.negate;de.add=function(e){dr(e)||(e=Li(e));var n=this.high>>>16,s=this.high&65535,r=this.low>>>16,i=this.low&65535,o=e.high>>>16,a=e.high&65535,l=e.low>>>16,c=e.low&65535,u=0,d=0,h=0,f=0;return f+=i+c,h+=f>>>16,f&=65535,h+=r+l,d+=h>>>16,h&=65535,d+=s+a,u+=d>>>16,d&=65535,u+=n+o,u&=65535,It(h<<16|f,u<<16|d,this.unsigned)};de.subtract=function(e){return dr(e)||(e=Li(e)),this.add(e.neg())};de.sub=de.subtract;de.multiply=function(e){if(this.isZero())return Xr;if(dr(e)||(e=Li(e)),Kr){var n=Kr.mul(this.low,this.high,e.low,e.high);return It(n,Kr.get_high(),this.unsigned)}if(e.isZero())return Xr;if(this.eq(er))return e.isOdd()?er:Xr;if(e.eq(er))return this.isOdd()?er:Xr;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(JD)&&e.lt(JD))return qr(this.toNumber()*e.toNumber(),this.unsigned);var s=this.high>>>16,r=this.high&65535,i=this.low>>>16,o=this.low&65535,a=e.high>>>16,l=e.high&65535,c=e.low>>>16,u=e.low&65535,d=0,h=0,f=0,p=0;return p+=o*u,f+=p>>>16,p&=65535,f+=i*u,h+=f>>>16,f&=65535,f+=o*c,h+=f>>>16,f&=65535,h+=r*u,d+=h>>>16,h&=65535,h+=i*c,d+=h>>>16,h&=65535,h+=o*l,d+=h>>>16,h&=65535,d+=s*u+r*c+i*l+o*a,d&=65535,It(f<<16|p,d<<16|h,this.unsigned)};de.mul=de.multiply;de.divide=function(e){if(dr(e)||(e=Li(e)),e.isZero())throw Error("division by zero");if(Kr){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var n=(this.unsigned?Kr.div_u:Kr.div_s)(this.low,this.high,e.low,e.high);return It(n,Kr.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?ec:Xr;var s,r,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return ec;if(e.gt(this.shru(1)))return kB;i=ec}else{if(this.eq(er)){if(e.eq(Gu)||e.eq(Yk))return er;if(e.eq(er))return Gu;var o=this.shr(1);return s=o.div(e).shl(1),s.eq(Xr)?e.isNegative()?Gu:Yk:(r=this.sub(e.mul(s)),i=s.add(r.div(e)),i)}else if(e.eq(er))return this.unsigned?ec:Xr;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=Xr}for(r=this;r.gte(e);){s=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(s)/Math.LN2),l=a<=48?1:E0(2,a-48),c=qr(s),u=c.mul(e);u.isNegative()||u.gt(r);)s-=l,c=qr(s,this.unsigned),u=c.mul(e);c.isZero()&&(c=Gu),i=i.add(c),r=r.sub(u)}return i};de.div=de.divide;de.modulo=function(e){if(dr(e)||(e=Li(e)),Kr){var n=(this.unsigned?Kr.rem_u:Kr.rem_s)(this.low,this.high,e.low,e.high);return It(n,Kr.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};de.mod=de.modulo;de.rem=de.modulo;de.not=function(){return It(~this.low,~this.high,this.unsigned)};de.and=function(e){return dr(e)||(e=Li(e)),It(this.low&e.low,this.high&e.high,this.unsigned)};de.or=function(e){return dr(e)||(e=Li(e)),It(this.low|e.low,this.high|e.high,this.unsigned)};de.xor=function(e){return dr(e)||(e=Li(e)),It(this.low^e.low,this.high^e.high,this.unsigned)};de.shiftLeft=function(e){return dr(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?It(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):It(0,this.low<<e-32,this.unsigned)};de.shl=de.shiftLeft;de.shiftRight=function(e){return dr(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?It(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):It(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};de.shr=de.shiftRight;de.shiftRightUnsigned=function(e){if(dr(e)&&(e=e.toInt()),e&=63,e===0)return this;var n=this.high;if(e<32){var s=this.low;return It(s>>>e|n<<32-e,n>>>e,this.unsigned)}else return e===32?It(n,0,this.unsigned):It(n>>>e-32,0,this.unsigned)};de.shru=de.shiftRightUnsigned;de.shr_u=de.shiftRightUnsigned;de.toSigned=function(){return this.unsigned?It(this.low,this.high,!1):this};de.toUnsigned=function(){return this.unsigned?this:It(this.low,this.high,!0)};de.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};de.toBytesLE=function(){var e=this.high,n=this.low;return[n&255,n>>>8&255,n>>>16&255,n>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};de.toBytesBE=function(){var e=this.high,n=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,n>>>24,n>>>16&255,n>>>8&255,n&255]};Et.fromBytes=function(e,n,s){return s?Et.fromBytesLE(e,n):Et.fromBytesBE(e,n)};Et.fromBytesLE=function(e,n){return new Et(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,n)};Et.fromBytesBE=function(e,n){return new Et(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],n)};const TB=bp(wB),_ne=y6({__proto__:null,default:TB},[wB]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hl=TB||_ne;function Nv(t){return Hl.fromString(t,!0,16)}const EB=Nv("c3a5c85c97cb3127"),Wl=Nv("b492b66fbe98f273"),gs=Nv("9ae16a3b2f90404f");function Qk(t){return t.xor(t.shru(47))}function IB(t,e,n){const s=t.slice(e,e+n);return Hl.fromBytes(Array.from(s),!0,!0)}function vt(t,e){return IB(t,e,8)}function YD(t,e){return IB(t,e,4)}function In(t,e){return e===0?t:t.shru(e).or(t.shl(64-e))}function qa(t,e,n=Nv("9ddfea08eb382d69")){let s=t.xor(e).mul(n);s=s.xor(s.shru(47));let r=e.xor(s).mul(n);return r=r.xor(r.shru(47)),r=r.mul(n),r}function zne(t,e,n,s,r,i){r=r.add(t),i=In(i.add(r).add(s),21);const o=r;return r=r.add(e),r=r.add(n),i=i.add(In(r,44)),[r.add(s),i.add(o)]}function $g(t,e,n,s){return zne(vt(t,e),vt(t,e+8),vt(t,e+16),vt(t,e+24),n,s)}function Bne(t,e=t.length){if(e>=8){const n=gs.add(e*2),s=vt(t,0).add(gs),r=vt(t,e-8),i=In(r,37).mul(n).add(s),o=In(s,25).add(r).mul(n);return qa(i,o,n)}if(e>=4){const n=gs.add(e*2),s=YD(t,0);return qa(s.shl(3).add(e),YD(t,e-4),n)}if(e>0){const n=t[0],s=t[e>>1],r=t[e-1],i=n+(s<<8),o=e+(r<<2);return Qk(gs.mul(i).xor(EB.mul(o))).mul(gs)}return gs}function jne(t,e=t.length){const n=gs.add(e*2),s=vt(t,0).mul(Wl),r=vt(t,8),i=vt(t,e-8).mul(n),o=vt(t,e-16).mul(gs);return qa(In(s.add(r),43).add(In(i,30)).add(o),s.add(In(r.add(gs),18)).add(i),n)}function Vne(t,e=t.length){const n=gs.add(e*2),s=vt(t,0).mul(gs),r=vt(t,8),i=vt(t,e-8).mul(n),o=vt(t,e-16).mul(gs),a=In(s.add(r),43).add(In(i,30)).add(o),l=qa(a,s.add(In(r.add(gs),18)).add(i),n),c=vt(t,16).mul(n),u=vt(t,24),d=a.add(vt(t,e-32)).mul(n),h=l.add(vt(t,e-24)).mul(n);return qa(In(c.add(u),43).add(In(d,30)).add(h),c.add(In(u.add(s),18)).add(d),n)}function Une(t,e=t.length){const n=Hl.fromNumber(81,!0);if(e<=32)return e<=16?Bne(t,e):jne(t,e);if(e<=64)return Vne(t,e);let s=n,r=n.mul(Wl).add(113),i=Qk(r.mul(gs).add(113)).mul(gs),o=[Hl.UZERO,Hl.UZERO],a=[Hl.UZERO,Hl.UZERO];s=s.mul(gs).add(vt(t,0));let l=0;const c=(e-1>>6)*64,u=c+(e-1&63)-63;do s=In(s.add(r).add(o[0]).add(vt(t,l+8)),37).mul(Wl),r=In(r.add(o[1]).add(vt(t,l+48)),42).mul(Wl),s=s.xor(a[1]),r=r.add(o[0]).add(vt(t,l+40)),i=In(i.add(a[0]),33).mul(Wl),o=$g(t,l,o[1].mul(Wl),s.add(a[0])),a=$g(t,l+32,i.add(a[1]),r.add(vt(t,l+16))),[i,s]=[s,i],l+=64;while(l!==c);const d=Wl.add(i.and(255).shl(1));return l=u,a[0]=a[0].add(e-1&63),o[0]=o[0].add(a[0]),a[0]=a[0].add(o[0]),s=In(s.add(r).add(o[0]).add(vt(t,l+8)),37).mul(d),r=In(r.add(o[1]).add(vt(t,l+48)),42).mul(d),s=s.xor(a[1].mul(9)),r=r.add(o[0].mul(9).add(vt(t,l+40))),i=In(i.add(a[0]),33).mul(d),o=$g(t,l,o[1].mul(d),s.add(a[0])),a=$g(t,l+32,i.add(a[1]),r.add(vt(t,l+16))),[i,s]=[s,i],qa(qa(o[0],a[0],d).add(Qk(r).mul(EB)).add(i),qa(o[1],a[1],d).add(s),d)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vl(t,e){return e==="string"?Xa(t):Jc([t],e)}function Wne(t,e){return t instanceof Float32Array&&e==="float32"||t instanceof Int32Array&&e==="int32"||t instanceof Uint8Array&&e==="bool"}function Jc(t,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=Nc(t)),X().getBool("DEBUG")&&vne(t,e),Wne(t,e))return t;if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool"){const n=new Uint8Array(t.length);for(let s=0;s<n.length;++s)Math.round(t[s])!==0&&(n[s]=1);return n}else throw new Error(`Unknown data type ${e}`)}function $s(){return X().platform.now()}function Xa(t,e="utf-8"){return e=e||"utf-8",X().platform.encode(t,e)}function ol(t,e="utf-8"){return e=e||"utf-8",X().platform.decode(t,e)}function ri(t){return X().platform.isTypedArray!=null?X().platform.isTypedArray(t):vB(t)}function Nc(t,e=[],n=!1){if(e==null&&(e=[]),typeof t=="boolean"||typeof t=="number"||typeof t=="string"||HT(t)||t==null||ri(t)&&n)e.push(t);else if(Array.isArray(t)||ri(t))for(let s=0;s<t.length;++s)Nc(t[s],e,n);else{let s=-1;for(const r of Object.keys(t))/^([1-9]+[0-9]*|0)$/.test(r)&&(s=Math.max(s,Number(r)));for(let r=0;r<=s;r++)Nc(t[r],e,n)}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Hne{constructor(e,n){this.backendTimer=e,this.logger=n,n==null&&(this.logger=new Kne)}profileKernel(e,n,s){let r;const i=()=>{r=s()};let o;const a=$s();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(i);else{i();for(const c of r)c.dataSync();o=Promise.resolve({kernelMs:$s()-a})}if(X().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let c=0;c<r.length;c++){const u=r[c];u.data().then(d=>{Gne(d,u.dtype,e)})}return{kernelName:e,outputs:r,inputs:n,timeMs:o.then(c=>c.kernelMs),extraInfo:o.then(c=>c.getExtraProfileInfo!=null?c.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:n,outputs:s,timeMs:r,inputs:i,extraInfo:o}=e;s.forEach(a=>{Promise.all([a.data(),r,o]).then(l=>{this.logger.logKernelProfile(n,a,l[0],l[1],i,l[2])})})}}function Gne(t,e,n){if(e!=="float32")return!1;for(let s=0;s<t.length;s++){const r=t[s];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${n}'`),!0}return!1}class Kne{logKernelProfile(e,n,s,r,i,o){const a=typeof r=="number"?td(`${r}ms`,9):r.error,l=td(e,25),c=n.rank,u=n.size,d=td(n.shape.toString(),14);let h="";for(const f in i){const p=i[f];if(p!=null){const m=p.shape||n.shape,g=m.length;h+=`${f}: ${g}D ${g>0?m:""} `}}console.log(`%c${l}	%c${a}	%c${c}D ${d}	%c${u}	%c${h}	%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qne(t,e,n){const s={},r={};for(let l=0;l<e.length;l++)s[e[l].id]=!0;for(let l=0;l<t.length;l++){const c=t[l],u=c.inputs;for(const d in u){const h=u[d];let f=!1;for(let p=0;p<e.length;p++)if(s[h.id]){c.outputs.forEach(m=>s[m.id]=!0),f=!0,r[c.id]=!0;break}if(f)break}}const i={};i[n.id]=!0;const o={};for(let l=t.length-1;l>=0;l--){const c=t[l],u=c.inputs;for(let d=0;d<c.outputs.length;d++)if(i[c.outputs[d].id]){for(const h in u)i[u[h].id]=!0,o[c.id]=!0;break}}const a=[];for(let l=0;l<t.length;l++){const c=t[l];if(r[c.id]&&o[c.id]){const u={};for(const h in c.inputs){const f=c.inputs[h];s[f.id]&&(u[h]=f)}const d=Object.assign({},c);d.inputs=u,d.outputs=c.outputs,a.push(d)}}return a}function Xne(t,e,n,s){for(let r=e.length-1;r>=0;r--){const i=e[r],o=[];if(i.outputs.forEach(l=>{const c=t[l.id];c!=null?o.push(c):o.push(null)}),i.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${i.kernelName}.`);const a=i.gradient(o);for(const l in i.inputs){if(!(l in a))throw new Error(`Cannot backprop through input ${l}. Available gradients found: ${Object.keys(a)}.`);const c=n(()=>a[l]());if(c.dtype!=="float32")throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input ${l} must have 'float32' dtype, but has '${c.dtype}'`);const u=i.inputs[l];if(!ct(c.shape,u.shape))throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input '${l}' has shape '${c.shape}', which does not match the shape of the input '${u.shape}'`);if(t[u.id]==null)t[u.id]=c;else{const d=t[u.id];t[u.id]=s(d,c),d.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QD=20,Nh=3,xw=7;function Jne(t,e,n,s){const r=ke(e),i=Yne(t,e,n,r),o=e.length,a=Ry(t,e,n,r,i),l=["Tensor"];return s&&(l.push(`  dtype: ${n}`),l.push(`  rank: ${o}`),l.push(`  shape: [${e}]`),l.push("  values:")),l.push(a.map(c=>"    "+c).join(`
`)),l.join(`
`)}function Yne(t,e,n,s){const r=Q(e),i=s[s.length-1],o=new Array(i).fill(0),a=e.length,l=n==="complex64"?Wh(t):t;if(a>1)for(let c=0;c<r/i;c++){const u=c*i;for(let d=0;d<i;d++)o[d]=Math.max(o[d],Uh(l[u+d],0,n).length)}return o}function Uh(t,e,n){let s;return Array.isArray(t)?s=`${parseFloat(t[0].toFixed(xw))} + ${parseFloat(t[1].toFixed(xw))}j`:Op(t)?s=`'${t}'`:n==="bool"?s=AB(t):s=parseFloat(t.toFixed(xw)).toString(),td(s,e)}function AB(t){return t===0?"false":"true"}function Ry(t,e,n,s,r,i=!0){const o=n==="complex64"?2:1,a=e[0],l=e.length;if(l===0){if(n==="complex64"){const m=Wh(t);return[Uh(m[0],0,n)]}return n==="bool"?[AB(t[0])]:[t[0].toString()]}if(l===1){if(a>QD){const g=Nh*o;let y=Array.from(t.slice(0,g)),x=Array.from(t.slice((a-Nh)*o,a*o));return n==="complex64"&&(y=Wh(y),x=Wh(x)),["["+y.map((v,w)=>Uh(v,r[w],n)).join(", ")+", ..., "+x.map((v,w)=>Uh(v,r[a-Nh+w],n)).join(", ")+"]"]}return["["+(n==="complex64"?Wh(t):Array.from(t)).map((g,y)=>Uh(g,r[y],n)).join(", ")+"]"]}const c=e.slice(1),u=s.slice(1),d=s[0]*o,h=[];if(a>QD){for(let m=0;m<Nh;m++){const g=m*d,y=g+d;h.push(...Ry(t.slice(g,y),c,n,u,r,!1))}h.push("...");for(let m=a-Nh;m<a;m++){const g=m*d,y=g+d;h.push(...Ry(t.slice(g,y),c,n,u,r,m===a-1))}}else for(let m=0;m<a;m++){const g=m*d,y=g+d;h.push(...Ry(t.slice(g,y),c,n,u,r,m===a-1))}const f=l===2?",":"";h[0]="["+(a>0?h[0]+f:"");for(let m=1;m<h.length-1;m++)h[m]=" "+h[m]+f;let p=`,
`;for(let m=2;m<l;m++)p+=`
`;return h[h.length-1]=" "+h[h.length-1]+"]"+(i?"":p),h}function Wh(t){const e=[];for(let n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jn{constructor(e,n,s){if(this.dtype=n,this.shape=e.slice(),this.size=Q(e),s!=null){const r=s.length;E(r===this.size,()=>`Length of values '${r}' does not match the size inferred by the shape '${this.size}'.`)}if(n==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=s||Zt(n,this.size),this.strides=ke(e)}set(e,...n){n.length===0&&(n=[0]),E(n.length===this.rank,()=>`The number of provided coordinates (${n.length}) must match the rank (${this.rank})`);const s=this.locToIndex(n);this.values[s]=e}get(...e){e.length===0&&(e=[0]);let n=0;for(const r of e){if(r<0||r>=this.shape[n]){const i=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(i)}n++}let s=e[e.length-1];for(let r=0;r<e.length-1;++r)s+=this.strides[r]*e[r];return this.values[s]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let n=e[e.length-1];for(let s=0;s<e.length-1;++s)n+=this.strides[s]*e[s];return n}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];const n=new Array(this.shape.length);for(let s=0;s<n.length-1;++s)n[s]=Math.floor(e/this.strides[s]),e-=n[s]*this.strides[s];return n[n.length-1]=e,n}get rank(){return this.shape.length}toTensor(){return bi().makeTensor(this.values,this.shape,this.dtype)}}let bi=null,Cu=null;function Qne(t){bi=t}function Zne(t){Cu=t}class pn{constructor(e,n,s,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=n||"float32",this.size=Q(e),this.strides=ke(e),this.dataId=s,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return Cu.buffer(this.shape,this.dtype,e)}bufferSync(){return Cu.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return Ei(this.shape,e,this.dtype==="complex64")}arraySync(){return Ei(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=bi().read(this.dataId);if(this.dtype==="string"){const n=await e;try{return n.map(s=>ol(s))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),bi().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=bi().readSync(this.dataId);if(this.dtype==="string")try{return e.map(n=>ol(n))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await bi().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),bi().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return Cu.print(this,e)}clone(){return this.throwIfDisposed(),Cu.clone(this)}toString(e=!1){const n=this.dataSync();return Jne(n,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),Cu.cast(this,e)}variable(e=!0,n,s){return this.throwIfDisposed(),bi().makeVariable(this,e,n,s)}}Object.defineProperty(pn,Symbol.hasInstance,{value:t=>!!t&&t.data!=null&&t.dataSync!=null&&t.throwIfDisposed!=null});function Y(){return GT("Tensor",()=>pn)}Y();class I0 extends pn{constructor(e,n,s,r){super(e.shape,e.dtype,e.dataId,r),this.trainable=n,this.name=s}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!ct(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);bi().disposeTensor(this),this.dataId=e.dataId,bi().incRef(this,null)}dispose(){bi().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(I0,Symbol.hasInstance,{value:t=>t instanceof pn&&t.assign!=null&&t.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var ZD;(function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"})(ZD||(ZD={}));var Zk;(function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"})(Zk||(Zk={}));var eC;(function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"})(eC||(eC={}));var tC;(function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"})(tC||(tC={}));var nC;(function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"})(nC||(nC={}));const ese={float32:tC,int32:Zk,bool:eC,complex64:nC};function lr(t,e){if(t==="string"||e==="string"){if(t==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${t} with ${e}`)}return ese[t][e]}function PE(t){return lr(t,"int32")}function $B(t){return t!=null&&typeof t=="object"&&"texture"in t&&t.texture instanceof WebGLTexture}function RB(t){return typeof GPUBuffer<"u"&&t!=null&&typeof t=="object"&&"buffer"in t&&t.buffer instanceof GPUBuffer}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tn(t,e){if(t.dtype===e.dtype)return[t,e];const n=lr(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function DB(t){const e=[];return OB(t,e,new Set),e}function OB(t,e,n){if(t==null)return;if(t instanceof pn){e.push(t);return}if(!tse(t))return;const s=t;for(const r in s){const i=s[r];n.has(i)||(n.add(i),OB(i,e,n))}}function tse(t){return Array.isArray(t)||typeof t=="object"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bw(t){return t.kernelName!=null}class eO{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class kd{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new eO}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let n=0;n<e.length;n++){const s=e[n];if(await this.initializeBackend(s).success){await this.setBackend(s);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:n}=this.initializeBackendsAndReturnBest();if(n)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:n}=this.initializeBackend(e);if(n)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,n,s=1){return e in this.registryFactory?(gr(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:n,priority:s},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:n,asyncInit:s}=this.initializeBackend(e);if(!(s?await n:n))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new Hne(this.backendInstance),!0}setupRegisteredKernels(){HD(this.backendName).forEach(n=>{n.setupFunc!=null&&n.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){HD(e).forEach(s=>{s.disposeFunc!=null&&s.disposeFunc(this.registry[e])})}initializeBackend(e){const n=this.registryFactory[e];if(n==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const s=n.factory();if(s&&!(s instanceof jT)&&typeof s.then=="function"){const r=++this.pendingBackendInitId,i=s.then(o=>r<this.pendingBackendInitId?!1:(this.registry[e]=o,this.pendingBackendInit=null,!0)).catch(o=>(r<this.pendingBackendInitId||(this.pendingBackendInit=null,gr(`Initialization of backend ${e} failed`),gr(o.stack||o.message)),!1));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}else return this.registry[e]=s,{success:!0,asyncInit:!1}}catch(s){return gr(`Initialization of backend ${e} failed`),gr(s.stack||s.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,n)=>this.registryFactory[n].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let n=0;n<e.length;n++){const s=e[n],{success:r,asyncInit:i}=this.initializeBackend(s);if(i||r)return{name:s,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,n){const s=this.state.tensorInfo.get(n),r=s.backend,i=this.readSync(n),o=r.refCount(n);r.disposeData(n,!0),s.backend=e,e.move(n,i,s.shape,s.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,n){let s=null;if(n==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");n=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof n!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");s=e}let r;return this.scopedRun(()=>this.startScope(s),()=>this.endScope(r),()=>(r=n(),r instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r))}scopedRun(e,n,s){e();try{const r=s();return n(),r}catch(r){throw n(),r}}nextTensorId(){return kd.nextTensorId++}nextVariableId(){return kd.nextVariableId++}clone(e){const n=V.runKernel(em,{x:e}),s={x:e},r=o=>({x:()=>{const a="float32",l={x:o},c={dtype:a};return V.runKernel(jp,l,c)}}),i=[];return this.addTapeNode(this.state.activeScope.name,s,[n],r,i,{}),n}runKernel(e,n,s){if(this.backendName==null&&this.backend,!(UD(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:n,attrs:s})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,n,s){const r=this.backend.numDataIds();let i=0;s.forEach(l=>{i+=l.dtype==="complex64"?3:1});const o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=r-n-i-o;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${e}'`)}runKernelFunc(e){let n,s=[];const r=this.isTapeOn(),i=this.state.numBytes,o=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let a;this.backendName==null&&this.backend;let l;const c=bw(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(bw(e)){const{kernelName:p,inputs:m,attrs:g}=e;this.backendName==null&&this.backend;const y=UD(p,this.backendName);E(y!=null,()=>`Cannot find registered kernel '${p}' for backend '${this.backendName}'`),a=()=>{const x=this.backend.numDataIds();l=y.kernelFunc({inputs:m,attrs:g,backend:this.backend});const v=Array.isArray(l)?l:[l];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(p,x,v);const w=v.map(S=>S.rank!=null?S:this.makeTensorFromTensorInfo(S));if(r){const S=this.getTensorsForGradient(p,m,w);s=this.saveTensorsForBackwardMode(S)}return w}}else{const{forwardFunc:p}=e,m=g=>{r&&(s=g.map(y=>this.keep(this.clone(y))))};a=()=>{const g=this.backend.numDataIds();l=this.tidy(()=>p(this.backend,m));const y=Array.isArray(l)?l:[l];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(c,g,y),y}}const{inputs:u,attrs:d}=e,h=bw(e)?null:e.backwardsFunc;let f;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?n=a():(f=this.profiler.profileKernel(c,u,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(f),n=f.outputs)}),r&&this.addTapeNode(c,u,n,h,s,d),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-i,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(u).map(p=>u[p]!=null?u[p].shape:null),outputShapes:n.map(p=>p.shape),kernelTimeMs:f.timeMs,extraInfo:f.extraInfo}),Array.isArray(l)?n:n[0]}saveTensorsForBackwardMode(e){return e.map(s=>this.keep(this.clone(s)))}getTensorsForGradient(e,n,s){const r=WD(e);if(r!=null){const i=r.inputsToSave||[],o=r.outputsToSave||[];let a;r.saveAllInputs?(E(Array.isArray(n),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(n).map(c=>n[c])):a=i.map(c=>n[c]);const l=s.filter((c,u)=>o[u]);return a.concat(l)}return[]}makeTensor(e,n,s,r){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");s=s||"float32",r=r||this.backend;let i=e;s==="string"&&Op(e[0])&&(i=e.map(l=>Xa(l)));const o=r.write(i,n,s),a=new pn(n,s,o,this.nextTensorId());if(this.trackTensor(a,r),s==="string"){const l=this.state.tensorInfo.get(o),c=Sne(i);this.state.numBytes+=c-l.bytes,l.bytes=c}return a}makeTensorFromDataId(e,n,s,r){s=s||"float32";const i={dataId:e,shape:n,dtype:s};return this.makeTensorFromTensorInfo(i,r)}makeTensorFromTensorInfo(e,n){const{dataId:s,shape:r,dtype:i}=e,o=new pn(r,i,s,this.nextTensorId());return this.trackTensor(o,n),o}makeVariable(e,n=!0,s,r){s=s||this.nextVariableId().toString(),r!=null&&r!==e.dtype&&(e=e.cast(r));const i=new I0(e,n,s,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error(`Variable with name ${i.name} was already registered`);return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i}trackTensor(e,n){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let s=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(s=e.size*k0(e.dtype)),this.state.numBytes+=s,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:n||this.backend,dtype:e.dtype,shape:e.shape,bytes:s})),e instanceof I0||this.track(e)}incRef(e,n){this.trackTensor(e,n),this.backend.incRef(e.dataId)}removeDataId(e,n){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===n&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const n=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=n.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const s=e.size*k0(e.dtype);this.state.numBytes-=s}n.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,n.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const n=this.state.registeredVariables[e];this.disposeVariable(n)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const n=this.state.numBytes,s=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(r=>r.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-s;for(const r of this.state.activeProfile.kernels)r.kernelTimeMs=await r.kernelTimeMs,r.extraInfo=await r.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,n,s,r,i,o){const a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:n,outputs:s,saved:i},l=WD(e);l!=null&&(r=l.gradFunc),r!=null&&(a.gradient=c=>(c=c.map((u,d)=>{if(u==null){const h=s[d],f=ss(h.size,h.dtype);return this.makeTensor(f,h.shape,h.dtype)}return u}),r(c.length>1?c:c[0],i,o))),this.state.activeTape.push(a)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const n={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(n.name=e),this.state.scopeStack.push(n),this.state.activeScope=n}endScope(e){const n=DB(e),s=new Set(n.map(i=>i.id));for(let i=0;i<this.state.activeScope.track.length;i++){const o=this.state.activeScope.track[i];!o.kept&&!s.has(o.id)&&o.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(i=>{!i.kept&&i.scopeId===r.id&&this.track(i)})}gradients(e,n,s,r=!1){if(E(n.length>0,()=>"gradients() received an empty list of xs."),s!=null&&s.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${s.dtype}'`);const i=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));E(i instanceof pn,()=>"The result y returned by f() must be a tensor.");const o=qne(this.state.activeTape,n,i);if(!r&&o.length===0&&n.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const a={};a[i.id]=s??nse(i.shape),Xne(a,o,c=>this.tidy(c),sse);const l=n.map(c=>a[c.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(c=>{for(const u of c.saved)u.dispose()}),this.state.activeTape=null),{value:i,grads:l}})}customGrad(e){return E(Gk(e),()=>"The f passed in customGrad(f) must be a function."),(...n)=>{E(n.every(a=>a instanceof pn),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let s;const r={};n.forEach((a,l)=>{r[l]=a});const i=(a,l)=>(s=e(...n,l),E(s.value instanceof pn,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),E(Gk(s.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),s.value),o=(a,l)=>{const c=s.gradFunc(a,l),u=Array.isArray(c)?c:[c];E(u.length===n.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),E(u.every(h=>h instanceof pn),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const d={};return u.forEach((h,f)=>{d[f]=()=>h}),d};return this.runKernelFunc({forwardFunc:i,backwardsFunc:o,inputs:r})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,n){return this.state.tensorInfo.get(e).backend.readToGPU(e,n)}async time(e){const n=$s(),s=await this.backend.time(e);return s.wallMs=$s()-n,s}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new eO;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}kd.nextTensorId=0;kd.nextVariableId=0;function nse(t){const e=WT(Q(t),"float32");return V.makeTensor(e,t,"float32")}function MB(){const t=Jz();if(t._tfengine==null){const e=new Nne(t);t._tfengine=new kd(e)}return Ane(t._tfengine.ENV),Qne(()=>t._tfengine),t._tfengine}const V=MB();function sse(t,e){const n={a:t,b:e};return V.runKernel(qd,n)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rse(){return typeof navigator<"u"&&navigator!=null}function PB(t){if(t||rse()){if(t||(t=navigator),t.product==="ReactNative")return!0;const e=t.userAgent||t.vendor||(typeof window<"u"?window.opera:"");if(!e){const n=t;return n.userAgentData&&n.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function LB(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _s=X();_s.registerFlag("DEBUG",()=>!1,t=>{t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});_s.registerFlag("IS_BROWSER",()=>LB());_s.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");_s.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));_s.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));_s.registerFlag("PROD",()=>!1);_s.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>_s.getBool("DEBUG"));_s.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);_s.registerFlag("IS_TEST",()=>!1);_s.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>_s.getBool("DEBUG"));_s.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);_s.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);_s.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tv(t,e){let n=t;if(ri(t))return e==="string"?[]:[t.length];if($B(t)){const r=t.channels||"RGBA";return[t.height,t.width*r.length]}else if(RB(t))return[t.buffer.size/(e==null?4:k0(e))];if(!Array.isArray(t))return[];const s=[];for(;Array.isArray(n)||ri(n)&&e!=="string";)s.push(n.length),n=n[0];return Array.isArray(t)&&X().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&FB(t,s,[]),s}function FB(t,e,n){if(n=n||[],!Array.isArray(t)&&!ri(t)){E(e.length===0,()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}E(e.length>0,()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${t.length} elements`),E(t.length===e[0],()=>`Element arr[${n.join("][")}] should have ${e[0]} elements, but has ${t.length} elements`);const s=e.slice(1);for(let r=0;r<t.length;++r)FB(t[r],s,n.concat(r))}function tO(t,e,n,s){if(t!=="string_or_numeric"){if(t==null)throw new Error("Expected dtype cannot be null.");if(t!=="numeric"&&t!==e||t==="numeric"&&e==="string")throw new Error(`Argument '${n}' passed to '${s}' must be ${t} tensor, but got ${e} tensor`)}}function R(t,e,n,s="numeric"){if(t instanceof Y())return tO(s,t.dtype,e,n),t;let r=Gd(t);if(r!=="string"&&["bool","int32","float32"].indexOf(s)>=0&&(r=s),tO(s,r,e,n),t==null||!ri(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string"){const l=t==null?"null":t.constructor.name;throw new Error(`Argument '${e}' passed to '${n}' must be a Tensor or TensorLike, but got '${l}'`)}const i=Tv(t,r);!ri(t)&&!Array.isArray(t)&&(t=[t]);const a=r!=="string"?Jc(t,r):Nc(t,[],!0);return V.makeTensor(a,i,r)}function _B(t,e,n,s="numeric"){if(!Array.isArray(t))throw new Error(`Argument ${e} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return t.map((i,o)=>R(i,`${e}[${o}]`,n,s))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ise="__op";function H(t){const e=Object.keys(t);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let n=e[0];const s=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n=n+ise;const r=(...i)=>{V.startScope(n);try{const o=s(...i);return HT(o)&&console.error("Cannot return a Promise inside of tidy."),V.endScope(o),o}catch(o){throw V.endScope(null),o}};return Object.defineProperty(r,"name",{value:n,configurable:!0}),r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ose(t,e){const n=R(t,"real","complex"),s=R(e,"imag","complex");UT(n.shape,s.shape,`real and imag shapes, ${n.shape} and ${s.shape}, must match in call to tf.complex().`);const r={real:n,imag:s};return V.runKernel(eE,r)}const Tc=H({complex_:ose});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ev(t,e,n,s){if(s==null)s=Gd(t);else if(s==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(RB(t)||$B(t)){if(s!=="float32"&&s!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${s}.`);return V.backend.createTensorFromGPUData(t,e||n,s)}if(!ri(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){aa(e);const r=Q(e),i=Q(n);E(r===i,()=>`Based on the provided shape, [${e}], the tensor should have ${r} values but has ${i}`);for(let o=0;o<n.length;++o){const a=n[o],l=o===n.length-1?a!==Q(e.slice(o)):!0;E(n[o]===e[o]||!l,()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${e}). `)}}return!ri(t)&&!Array.isArray(t)&&(t=[t]),e=e||n,t=s!=="string"?Jc(t,s):Nc(t,[],!0),V.makeTensor(t,e,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pf(t,e,n){const s=Tv(t,n);return Ev(t,e,s,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A0={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};class wl{static join(e){return new wl(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,e==null||(e instanceof Array||(e=[e]),e=e.map(s=>ri(s)?s.buffer:s),e.length===0))return;this.bufferUniformSize=e[0].byteLength;let n=0;for(let s=0;s<e.length;s++){const r=e[s];s!==e.length-1&&r.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const i=n+r.byteLength;this.shards.push({buffer:r,start:n,end:i}),n=i}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,n=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,n=isNaN(Number(n))?0:n,e=Math.max(0,e),n=Math.min(this.byteLength,n),n<=e)return new ArrayBuffer(0);const s=this.findShardForByte(e);if(s===-1)throw new Error(`Could not find start shard for byte ${e}`);const r=n-e,i=new ArrayBuffer(r),o=new Uint8Array(i);let a=0;for(let l=s;l<this.shards.length;l++){const c=this.shards[l],d=e+a-c.start,h=a,p=Math.min(n,c.end)-c.start,m=new Uint8Array(c.buffer,d,p-d);if(o.set(m,h),a+=m.length,n<c.end)break}return i}findShardForByte(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function n(r){return e<r.start?-1:e>=r.end?1:0}if(n(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const s=ase(this.shards,n);return s===-1?-1:(this.previousShardIndex=s,this.previousShardIndex)}}function ase(t,e){let n=0,s=t.length;for(;n<=s;){const r=Math.floor((s-n)/2)+n,i=e(t[r]);if(i===0)return r;i<0?s=r:n=r+1}return-1}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ui(){return V}function sC(){return V.memory()}function q(t,e){return V.tidy(t,e)}function Ve(t){DB(t).forEach(n=>n.dispose())}function ao(t){return V.keep(t)}function zB(t,e,n=1){return V.registerBackend(t,e,n)}function lse(){return V.backend}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cd=4;async function nO(t,e){const n=[],s=[],r=Array.isArray(t)?t.map(o=>o.name):Object.keys(t);for(let o=0;o<r.length;++o){const a=r[o],l=Array.isArray(t)?t[o].tensor:t[a];if(l.dtype!=="float32"&&l.dtype!=="int32"&&l.dtype!=="bool"&&l.dtype!=="string"&&l.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${l.dtype}`);const c={name:a,shape:l.shape,dtype:l.dtype};if(l.dtype==="string"){const u=new Promise(async d=>{const h=await l.bytes(),f=h.reduce((g,y)=>g+y.length,0)+Cd*h.length,p=new Uint8Array(f);let m=0;for(let g=0;g<h.length;g++){const y=h[g],x=new Uint8Array(new Uint32Array([y.length]).buffer);p.set(x,m),m+=Cd,p.set(y,m),m+=y.length}d(p)});s.push(u)}else s.push(l.data());e!=null&&(c.group=e),n.push(c)}const i=await Promise.all(s);return{data:hse(i),specs:n}}function cse(t,e){const n=new wl(t),s={};let r=0;for(const i of e){const o=use(i,(a,l)=>n.slice(r+a,r+l));s[i.name]=dse(i,n.slice(r,r+o)),r+=o}return s}function use(t,e){const n=Q(t.shape);let s;if("quantization"in t){const r=t.quantization;s=A0[r.dtype]}else if(t.dtype==="string"){let r=0;for(let i=0;i<n;i++)r+=Cd+new Uint32Array(e(r,r+Cd))[0];return r}else s=A0[t.dtype];return n*s}function dse(t,e){const n=t.name,s=t.dtype,r=t.shape,i=Q(r);let o,a=0;if("quantization"in t){const l=t.quantization;if(l.dtype==="uint8"||l.dtype==="uint16"){if(!("min"in l&&"scale"in l))throw new Error(`Weight ${t.name} with quantization ${l.dtype} doesn't have corresponding metadata min and scale.`)}else if(l.dtype==="float16"){if(s!=="float32")throw new Error(`Weight ${t.name} is quantized with ${l.dtype} which only supports weights of type float32 not ${s}.`)}else throw new Error(`Weight ${t.name} has unknown quantization dtype ${l.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);const c=A0[l.dtype],u=l.dtype==="uint8"?new Uint8Array(e):new Uint16Array(e);if(s==="float32")if(l.dtype==="uint8"||l.dtype==="uint16"){o=new Float32Array(u.length);for(let d=0;d<u.length;d++){const h=u[d];o[d]=h*l.scale+l.min}}else if(l.dtype==="float16")o=Sse()(u);else throw new Error(`Unsupported quantization type ${l.dtype} for weight type float32.`);else if(s==="int32"){if(l.dtype!=="uint8"&&l.dtype!=="uint16")throw new Error(`Unsupported quantization type ${l.dtype} for weight type int32.`);o=new Int32Array(u.length);for(let d=0;d<u.length;d++){const h=u[d];o[d]=Math.round(h*l.scale+l.min)}}else throw new Error(`Unsupported dtype in weight '${n}': ${s}`);a+=i*c}else if(s==="string"){const l=Q(t.shape);o=[];for(let c=0;c<l;c++){const u=new Uint32Array(e.slice(a,a+Cd))[0];a+=Cd;const d=new Uint8Array(e.slice(a,a+u));o.push(d),a+=u}}else{const l=A0[s];if(s==="float32")o=new Float32Array(e);else if(s==="int32")o=new Int32Array(e);else if(s==="bool")o=new Uint8Array(e);else if(s==="complex64"){o=new Float32Array(e);const c=new Float32Array(o.length/2),u=new Float32Array(o.length/2);for(let p=0;p<c.length;p++)c[p]=o[p*2],u[p]=o[p*2+1];const d=pf(c,r,"float32"),h=pf(u,r,"float32"),f=Tc(d,h);return d.dispose(),h.dispose(),f}else throw new Error(`Unsupported dtype in weight '${n}': ${s}`);a+=i*l}return pf(o,r,s)}function hse(t){if(t===null)throw new Error(`Invalid input value: ${JSON.stringify(t)}`);let e=0;const n=[];t.forEach(i=>{if(e+=i.byteLength,n.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${i.constructor.name}`)});const s=new Uint8Array(e);let r=0;return n.forEach(i=>{s.set(new Uint8Array(i.buffer),r),r+=i.byteLength}),s.buffer}const LE=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function sO(t){return LE?Buffer.byteLength(t,"utf8"):new Blob([t]).size}function fse(t){if(LE)return Buffer.from(t).toString("base64");const e=new Uint8Array(t);let n="";for(let s=0,r=e.length;s<r;s++)n+=String.fromCharCode(e[s]);return btoa(n)}function pse(t){if(LE){const s=Buffer.from(t,"base64");return s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)}const e=atob(t),n=new Uint8Array(e.length);for(let s=0;s<e.length;++s)n.set([e.charCodeAt(s)],s);return n.buffer}function mse(t){return wl.join(t)}function gse(t,e){const n={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:e};return t.signature!=null&&(n.signature=t.signature),t.userDefinedMetadata!=null&&(n.userDefinedMetadata=t.userDefinedMetadata),t.modelInitializer!=null&&(n.modelInitializer=t.modelInitializer),t.initializerSignature!=null&&(n.initializerSignature=t.initializerSignature),t.trainingConfig!=null&&(n.trainingConfig=t.trainingConfig),n}function yse(t,e,n){const s={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy};if(t.trainingConfig!=null&&(s.trainingConfig=t.trainingConfig),t.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!n)throw new Error("modelJSON has weightsManifest but weightData is null");s.weightSpecs=e,s.weightData=n}return t.signature!=null&&(s.signature=t.signature),t.userDefinedMetadata!=null&&(s.userDefinedMetadata=t.userDefinedMetadata),t.modelInitializer!=null&&(s.modelInitializer=t.modelInitializer),t.initializerSignature!=null&&(s.initializerSignature=t.initializerSignature),s}async function xse(t,e){let n,s;return t.weightsManifest!=null&&([n,s]=await e(t.weightsManifest)),yse(t,n,s)}function FE(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:t.modelTopology==null?0:sO(JSON.stringify(t.modelTopology)),weightSpecsBytes:t.weightSpecs==null?0:sO(JSON.stringify(t.weightSpecs)),weightDataBytes:t.weightData==null?0:new wl(t.weightData).byteLength}}function rO(t){const e=[];for(const n of t)e.push(...n.weights);return e}function bse(){const t=n=>{let s=n<<13,r=0;for(;!(s&8388608);)r-=8388608,s<<=1;return s&=-8388609,r+=947912704,s|r},e=new Uint32Array(2048);e[0]=0;for(let n=1;n<1024;n++)e[n]=t(n);for(let n=1024;n<2048;n++)e[n]=939524096+(n-1024<<13);return e}function vse(){const t=new Uint32Array(64);t[0]=0,t[31]=1199570944,t[32]=2147483648,t[63]=3347054592;for(let e=1;e<31;e++)t[e]=e<<23;for(let e=33;e<63;e++)t[e]=2147483648+(e-32<<23);return t}function wse(){const t=new Uint32Array(64);for(let e=0;e<64;e++)t[e]=1024;return t[0]=t[32]=0,t}function Sse(){const t=bse(),e=vse(),n=wse();return s=>{const r=new ArrayBuffer(4*s.length),i=new Uint32Array(r);for(let o=0;o<s.length;o++){const a=s[o],l=t[n[a>>10]+(a&1023)]+e[a>>10];i[o]=l}return new Float32Array(r)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Tn{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return Tn.instance==null&&(Tn.instance=new Tn),Tn.instance}static registerSaveRouter(e){Tn.getInstance().saveRouters.push(e)}static registerLoadRouter(e){Tn.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return Tn.getHandlers(e,"save")}static getLoadHandlers(e,n){return Tn.getHandlers(e,"load",n)}static getHandlers(e,n,s){const r=[];return(n==="load"?Tn.getInstance().loadRouters:Tn.getInstance().saveRouters).forEach(o=>{const a=o(e,s);a!==null&&r.push(a)}),r}}const kse=t=>Tn.getSaveHandlers(t),Cse=(t,e)=>Tn.getLoadHandlers(t,e);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rC="tensorflowjs",iC=1,tc="models_store",Ra="model_info_store";function BB(){if(!X().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const t=typeof window>"u"?self:window,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function oC(t){const e=t.result;e.createObjectStore(tc,{keyPath:"modelPath"}),e.createObjectStore(Ra,{keyPath:"modelPath"})}class Ec{constructor(e){if(this.indexedDB=BB(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,n){return new Promise((s,r)=>{const i=this.indexedDB.open(rC,iC);i.onupgradeneeded=()=>oC(i),i.onsuccess=()=>{const o=i.result;if(n==null){const a=o.transaction(tc,"readonly"),c=a.objectStore(tc).get(this.modelPath);c.onsuccess=()=>{if(c.result==null)return o.close(),r(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));s(c.result.modelArtifacts)},c.onerror=u=>(o.close(),r(c.error)),a.oncomplete=()=>o.close()}else{n.weightData=wl.join(n.weightData);const a=FE(n),l=o.transaction(Ra,"readwrite");let c=l.objectStore(Ra),u;try{u=c.put({modelPath:this.modelPath,modelArtifactsInfo:a})}catch(h){return r(h)}let d;u.onsuccess=()=>{d=o.transaction(tc,"readwrite");const h=d.objectStore(tc);let f;try{f=h.put({modelPath:this.modelPath,modelArtifacts:n,modelArtifactsInfo:a})}catch(p){return r(p)}f.onsuccess=()=>s({modelArtifactsInfo:a}),f.onerror=p=>{c=l.objectStore(Ra);const m=c.delete(this.modelPath);m.onsuccess=()=>(o.close(),r(f.error)),m.onerror=g=>(o.close(),r(f.error))}},u.onerror=h=>(o.close(),r(u.error)),l.oncomplete=()=>{d==null?o.close():d.oncomplete=()=>o.close()}}},i.onerror=o=>r(i.error)})}}Ec.URL_SCHEME="indexeddb://";const jB=t=>X().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Ec.URL_SCHEME)?Nse(t.slice(Ec.URL_SCHEME.length)):null;Tn.registerSaveRouter(jB);Tn.registerLoadRouter(jB);function Nse(t){return new Ec(t)}function Tse(t){return t.startsWith(Ec.URL_SCHEME)?t.slice(Ec.URL_SCHEME.length):t}class Ese{constructor(){this.indexedDB=BB()}async listModels(){return new Promise((e,n)=>{const s=this.indexedDB.open(rC,iC);s.onupgradeneeded=()=>oC(s),s.onsuccess=()=>{const r=s.result,i=r.transaction(Ra,"readonly"),a=i.objectStore(Ra).getAll();a.onsuccess=()=>{const l={};for(const c of a.result)l[c.modelPath]=c.modelArtifactsInfo;e(l)},a.onerror=l=>(r.close(),n(a.error)),i.oncomplete=()=>r.close()},s.onerror=r=>n(s.error)})}async removeModel(e){return e=Tse(e),new Promise((n,s)=>{const r=this.indexedDB.open(rC,iC);r.onupgradeneeded=()=>oC(r),r.onsuccess=()=>{const i=r.result,o=i.transaction(Ra,"readwrite"),a=o.objectStore(Ra),l=a.get(e);let c;l.onsuccess=()=>{if(l.result==null)return i.close(),s(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const u=a.delete(e),d=()=>{c=i.transaction(tc,"readwrite");const f=c.objectStore(tc).delete(e);f.onsuccess=()=>n(l.result.modelArtifactsInfo),f.onerror=p=>s(l.error)};u.onsuccess=d,u.onerror=h=>(d(),i.close(),s(l.error))}},l.onerror=u=>(i.close(),s(l.error)),o.oncomplete=()=>{c==null?i.close():c.oncomplete=()=>i.close()}},r.onerror=i=>s(r.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _o="/",Nu="tensorflowjs_models",VB="info",Ise="model_topology",Ase="weight_specs",$se="weight_data",Rse="model_metadata";function UB(t){return{info:[Nu,t,VB].join(_o),topology:[Nu,t,Ise].join(_o),weightSpecs:[Nu,t,Ase].join(_o),weightData:[Nu,t,$se].join(_o),modelMetadata:[Nu,t,Rse].join(_o)}}function WB(t){for(const e of Object.values(t))window.localStorage.removeItem(e)}function Dse(t){const e=t.split(_o);if(e.length<3)throw new Error(`Invalid key format: ${t}`);return e.slice(1,e.length-1).join(_o)}function Ose(t){return t.startsWith(Ic.URL_SCHEME)?t.slice(Ic.URL_SCHEME.length):t}class Ic{constructor(e){if(!X().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=UB(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const n=JSON.stringify(e.modelTopology),s=JSON.stringify(e.weightSpecs),r=FE(e),i=wl.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,s),this.LS.setItem(this.keys.weightData,fse(i));const o={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(o)),{modelArtifactsInfo:r}}catch{throw WB(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const n={},s=JSON.parse(this.LS.getItem(this.keys.topology));if(s==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);n.modelTopology=s;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(r==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);n.weightSpecs=r;const i=this.LS.getItem(this.keys.modelMetadata);if(i!=null){const a=JSON.parse(i);n.format=a.format,n.generatedBy=a.generatedBy,n.convertedBy=a.convertedBy,a.signature!=null&&(n.signature=a.signature),a.userDefinedMetadata!=null&&(n.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(n.modelInitializer=a.modelInitializer),a.initializerSignature!=null&&(n.initializerSignature=a.initializerSignature),a.trainingConfig!=null&&(n.trainingConfig=a.trainingConfig)}const o=this.LS.getItem(this.keys.weightData);if(o==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return n.weightData=pse(o),n}}Ic.URL_SCHEME="localstorage://";const HB=t=>X().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Ic.URL_SCHEME)?Mse(t.slice(Ic.URL_SCHEME.length)):null;Tn.registerSaveRouter(HB);Tn.registerLoadRouter(HB);function Mse(t){return new Ic(t)}class Pse{constructor(){E(X().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),E(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},n=Nu+_o,s=_o+VB;for(let r=0;r<this.LS.length;++r){const i=this.LS.key(r);if(i.startsWith(n)&&i.endsWith(s)){const o=Dse(i);e[o]=JSON.parse(this.LS.getItem(i))}}return e}async removeModel(e){e=Ose(e);const n=UB(e);if(this.LS.getItem(n.info)==null)throw new Error(`Cannot find model at path '${e}'`);const s=JSON.parse(this.LS.getItem(n.info));return WB(n),s}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iO="://";class Ki{constructor(){this.managers={}}static getInstance(){return Ki.instance==null&&(Ki.instance=new Ki),Ki.instance}static registerManager(e,n){E(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(iO)&&(e=e.slice(0,e.indexOf(iO))),E(e.length>0,()=>"scheme must not be an empty string.");const s=Ki.getInstance();E(s.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),s.managers[e]=n}static getManager(e){const n=Ki.getInstance().managers[e];if(n==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return n}static getSchemes(){return Object.keys(Ki.getInstance().managers)}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Lse{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,n){return fetch(e,n)}now(){return performance.now()}encode(e,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${n}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,n){return new TextDecoder(n).decode(e)}setTimeoutCustom(e,n){if(typeof window>"u"||!X().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,n);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},n),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",s=>{if(s.source===window&&s.data.name===this.messageName){s.stopPropagation();const r=this.functionRefs[s.data.index];r(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(e){return vB(e)}}if(X().get("IS_BROWSER")){X().setPlatform("browser",new Lse);try{Ki.registerManager(Ic.URL_SCHEME,new Pse)}catch{}try{Ki.registerManager(Ec.URL_SCHEME,new Ese)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fse={importFetch:()=>require("node-fetch")};let vw;class _se{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,n){return X().global.fetch!=null?X().global.fetch(e,n):(vw==null&&(vw=Fse.importFetch()),vw(e,n))}now(){const e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${n}`);return this.textEncoder.encode(e)}decode(e,n){return e.length===0?"":new this.util.TextDecoder(n).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}X().get("IS_NODE")&&!X().get("IS_BROWSER")&&X().setPlatform("node",new _se);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function He(t,e="float32",n){return e=e||"float32",aa(t),new jn(t,e,n)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zse(t,e){const n=R(t,"x","cast");if(!wne(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&n.dtype!=="string"||e!=="string"&&n.dtype==="string")throw new Error("Only strings can be casted to strings");const s={x:n},r={dtype:e};return V.runKernel(jp,s,r)}const fe=H({cast_:zse});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bse(t){const n={x:R(t,"x","clone","string_or_numeric")};return V.runKernel(em,n)}const uc=H({clone_:Bse});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jse(t,e=!1){console.log(t.toString(e))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */MB();const Vse={buffer:He,cast:fe,clone:uc,print:jse};Zne(Vse);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Use(t,e){let n=R(t,"a","add"),s=R(e,"b","add");[n,s]=tn(n,s);const r={a:n,b:s};return V.runKernel(qd,r)}const ie=H({add_:Use});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wse(t,e){let n=R(t,"a","floorDiv"),s=R(e,"b","floorDiv");[n,s]=tn(n,s);const r={a:n,b:s};return V.runKernel(Qp,r)}const GB=H({floorDiv_:Wse});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hse(t,e){let n=R(t,"a","div"),s=R(e,"b","div");if([n,s]=tn(n,s),n.dtype==="int32"&&s.dtype==="int32")return GB(n,s);const r={a:n,b:s},i={};return V.runKernel(Gp,r,i)}const Ie=H({div_:Hse});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gse(t,e){let n=R(t,"a","mul"),s=R(e,"b","mul");[n,s]=tn(n,s);const r={a:n,b:s};return V.runKernel(cm,r)}const B=H({mul_:Gse});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kse(t){const e=R(t,"x","abs");if(e.dtype==="complex64"){const n={x:e};return V.runKernel(Db,n)}else{const n={x:e};return V.runKernel(Nb,n)}}const ps=H({abs_:Kse});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qse(t){const n={x:R(t,"x","acos")};return V.runKernel(Mp,n)}const Xse=H({acos_:qse});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jse(t){const n={x:R(t,"x","acosh")};return V.runKernel(Pp,n)}const Yse=H({acosh_:Jse});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qse(t,e=null,n=!1){const r={x:R(t,"x","all","bool")},i={axis:e,keepDims:n};return V.runKernel(qT,r,i)}const KB=H({all_:Qse});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zse(t,e=null,n=!1){const r={x:R(t,"x","any","bool")},i={axis:e,keepDims:n};return V.runKernel(XT,r,i)}const aC=H({any_:Zse});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ere(t,e=0){const s={x:R(t,"x","argMax")},r={axis:e};return V.runKernel(Tb,s,r)}const Jf=H({argMax_:ere});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tre(t,e=0){const s={x:R(t,"x","argMin")},r={axis:e};return V.runKernel(Eb,s,r)}const nre=H({argMin_:tre});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sre(t){const n={x:R(t,"x","asin")};return V.runKernel(Lp,n)}const rre=H({asin_:sre});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ire(t){const n={x:R(t,"x","asinh")};return V.runKernel(Fp,n)}const ore=H({asinh_:ire});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function are(t){const n={x:R(t,"x","atan")};return V.runKernel(_p,n)}const lre=H({atan_:are});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cre(t,e){let n=R(t,"a","atan2"),s=R(e,"b","atan2");[n,s]=tn(n,s);const r={a:n,b:s};return V.runKernel(Bp,r)}const ure=H({atan2_:cre});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dre(t){const n={x:R(t,"x","atanh")};return V.runKernel(zp,n)}const hre=H({atanh_:dre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Am(t,e,n,s,r="NHWC",i){const o=t[3],a=[...e,o],l=ca(r);return Wn(t,a,n,i,s,null,null,l)}function ai(t,e,n,s,r,i,o="channelsLast"){const[a,l]=Yf(e);let c;if(o==="channelsLast")c=[a,l,t[3],t[3]];else if(o==="channelsFirst")c=[a,l,t[1],t[1]];else throw new Error(`Unknown dataFormat ${o}`);return Wn(t,c,n,s,r,i,!1,o)}function la(t,e,n,s,r,i,o="NDHWC"){const[a,l,c]=lC(e);let u,d;if(o==="NDHWC")d="channelsLast",u=[a,l,c,t[4],t[4]];else if(o==="NCDHW")d="channelsFirst",u=[a,l,c,t[1],t[1]];else throw new Error(`Unknown dataFormat ${o}`);return Sl(t,u,n,s,r,!1,d,i)}function Wn(t,e,n,s,r,i,o=!1,a="channelsLast"){let[l,c,u,d]=[-1,-1,-1,-1];if(a==="channelsLast")[l,c,u,d]=t;else if(a==="channelsFirst")[l,d,c,u]=t;else throw new Error(`Unknown dataFormat ${a}`);const[h,f,,p]=e,[m,g]=Yf(n),[y,x]=Yf(s),v=sd(h,y),w=sd(f,x),{padInfo:S,outHeight:k,outWidth:C}=mre(r,c,u,m,g,v,w,i,a),N=o?p*d:p;let T;return a==="channelsFirst"?T=[l,N,k,C]:a==="channelsLast"&&(T=[l,k,C,N]),{batchSize:l,dataFormat:a,inHeight:c,inWidth:u,inChannels:d,outHeight:k,outWidth:C,outChannels:N,padInfo:S,strideHeight:m,strideWidth:g,filterHeight:h,filterWidth:f,effectiveFilterHeight:v,effectiveFilterWidth:w,dilationHeight:y,dilationWidth:x,inShape:t,outShape:T,filterShape:e}}function Sl(t,e,n,s,r,i=!1,o="channelsLast",a){let[l,c,u,d,h]=[-1,-1,-1,-1,-1];if(o==="channelsLast")[l,c,u,d,h]=t;else if(o==="channelsFirst")[l,h,c,u,d]=t;else throw new Error(`Unknown dataFormat ${o}`);const[f,p,m,,g]=e,[y,x,v]=lC(n),[w,S,k]=lC(s),C=sd(f,w),N=sd(p,S),T=sd(m,k),{padInfo:I,outDepth:D,outHeight:F,outWidth:A}=gre(r,c,u,d,y,x,v,C,N,T,a),O=i?g*h:g;let P;return o==="channelsFirst"?P=[l,O,D,F,A]:o==="channelsLast"&&(P=[l,D,F,A,O]),{batchSize:l,dataFormat:o,inDepth:c,inHeight:u,inWidth:d,inChannels:h,outDepth:D,outHeight:F,outWidth:A,outChannels:O,padInfo:I,strideDepth:y,strideHeight:x,strideWidth:v,filterDepth:f,filterHeight:p,filterWidth:m,effectiveFilterDepth:C,effectiveFilterHeight:N,effectiveFilterWidth:T,dilationDepth:w,dilationHeight:S,dilationWidth:k,inShape:t,outShape:P,filterShape:e}}function fre(t,e,n,s,r){s==null&&(s=_E(t,e,n));const i=t[0],o=t[1],a=Qf((i-e+2*s)/n+1,r),l=Qf((o-e+2*s)/n+1,r);return[a,l]}function pre(t,e,n,s,r,i){r==null&&(r=_E(t,e[0],s[0]));const o=[0,0,0,n];for(let a=0;a<3;a++)t[a]+2*r>=e[a]&&(o[a]=Qf((t[a]-e[a]+2*r)/s[a]+1,i));return o}function _E(t,e,n,s=1){const r=sd(e,s);return Math.floor((t[0]*(n-1)-n+r)/2)}function Yf(t){return typeof t=="number"?[t,t,t]:t.length===2?[t[0],t[1],1]:t}function lC(t){return typeof t=="number"?[t,t,t]:t}function sd(t,e){return e<=1?t:t+(t-1)*(e-1)}function mre(t,e,n,s,r,i,o,a,l){let c,u,d;if(typeof t=="number"){c={top:t,bottom:t,left:t,right:t,type:t===0?"VALID":"NUMBER"};const f=fre([e,n],i,s,t,a);u=f[0],d=f[1]}else if(t==="same"){u=Math.ceil(e/s),d=Math.ceil(n/r);const h=Math.max(0,(u-1)*s+i-e),f=Math.max(0,(d-1)*r+o-n),p=Math.floor(h/2),m=h-p,g=Math.floor(f/2),y=f-g;c={top:p,bottom:m,left:g,right:y,type:"SAME"}}else if(t==="valid")c={top:0,bottom:0,left:0,right:0,type:"VALID"},u=Math.ceil((e-i+1)/s),d=Math.ceil((n-o+1)/r);else if(typeof t=="object"){const h=l==="channelsLast"?t[1][0]:t[2][0],f=l==="channelsLast"?t[1][1]:t[2][1],p=l==="channelsLast"?t[2][0]:t[3][0],m=l==="channelsLast"?t[2][1]:t[3][1];c={top:h,bottom:f,left:p,right:m,type:h===0&&f===0&&p===0&&m===0?"VALID":"EXPLICIT"},u=Qf((e-i+h+f)/s+1,a),d=Qf((n-o+p+m)/r+1,a)}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:c,outHeight:u,outWidth:d}}function gre(t,e,n,s,r,i,o,a,l,c,u){let d,h,f,p;if(t==="valid"&&(t=0),typeof t=="number"){d={top:t,bottom:t,left:t,right:t,front:t,back:t,type:t===0?"VALID":"NUMBER"};const g=pre([e,n,s,1],[a,l,c],1,[r,i,o],t,u);h=g[0],f=g[1],p=g[2]}else if(t==="same"){h=Math.ceil(e/r),f=Math.ceil(n/i),p=Math.ceil(s/o);const m=(h-1)*r+a-e,g=(f-1)*i+l-n,y=(p-1)*o+c-s,x=Math.floor(m/2),v=m-x,w=Math.floor(g/2),S=g-w,k=Math.floor(y/2),C=y-k;d={top:w,bottom:S,left:k,right:C,front:x,back:v,type:"SAME"}}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:d,outDepth:h,outHeight:f,outWidth:p}}function Qf(t,e){if(!e)return Math.trunc(t);switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error(`Unknown roundingMode ${e}`)}}function Ac(t){const[e,n,s]=Yf(t);return e===1&&n===1&&s===1}function is(t,e){return Ac(t)||Ac(e)}function $c(t){return Yf(t).every(e=>e>0)}function ca(t){if(t==="NHWC")return"channelsLast";if(t==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${t}`)}function Ks(t,e,n){if(n!=null){if(typeof e=="string")throw Error(`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);if(typeof e=="number")E(wd(e),()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);else if(typeof e=="object")e.forEach(s=>{s.forEach(r=>{E(wd(r),()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${r}.`)})});else throw Error(`Error in ${t}: Unknown padding parameter: ${e}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yre(t,e){const s={x:R(t,"x","reshape","string_or_numeric")},r={shape:e};return V.runKernel(hv,s,r)}const W=H({reshape_:yre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xre(t,e,n,s,r){const i=R(t,"x","avgPool","float32"),o=1;E(is(n,o),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`);let a=i,l=!1;i.rank===3&&(l=!0,a=W(i,[1,i.shape[0],i.shape[1],i.shape[2]])),E(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),Ks("avgPool",s,r);const c={x:a},u={filterSize:e,strides:n,pad:s,dimRoundingMode:r};let d=V.runKernel(Ib,c,u);return d=fe(d,i.dtype),l?W(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const zE=H({avgPool_:xre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bre(t,e,n,s,r,i="NDHWC"){const o=R(t,"x","avgPool3d","float32");let a=o,l=!1;o.rank===4&&(l=!0,a=W(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),E(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),E(i==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),E(typeof n=="number"&&n>0||Array.isArray(n)&&n[0]>0&&n[1]>0&&n[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${n}'`),Ks("avgPool3d",s,r);const c={x:a},u={filterSize:e,strides:n,pad:s,dimRoundingMode:r,dataFormat:i};let d=V.runKernel(Ab,c,u);return d=fe(d,a.dtype),l?W(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const vre=H({avgPool3d_:bre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wre(t,e=0){E(t.length>=1,()=>"Pass at least one tensor to concat");const n=_B(t,"tensors","concat","string_or_numeric");if(n[0].dtype==="complex64"&&n.forEach(i=>{if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${i.dtype}. `)}),n.length===1)return uc(n[0]);const s=n,r={axis:e};return V.runKernel(Ob,s,r)}const Ls=H({concat_:wre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sre(t,e,n=!1,s=!1){let r=R(t,"a","matMul"),i=R(e,"b","matMul");[r,i]=tn(r,i);const o={a:r,b:i},a={transposeA:n,transposeB:s};return V.runKernel($b,o,a)}const at=H({matMul_:Sre});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kre(t){const n={x:R(t,"x","sigmoid","float32")};return V.runKernel(vm,n)}const Xd=H({sigmoid_:kre});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cre(t,e,n){const s=R(t,"x","slice","string_or_numeric");if(s.rank===0)throw new Error("Slicing scalar is not possible");const r={x:s},i={begin:e,size:n};return V.runKernel(yv,r,i)}const wt=H({slice_:Cre});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nre(t){const n={x:R(t,"x","tanh","float32")};return V.runKernel(Tm,n)}const Iv=H({tanh_:Nre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tre(t,e,n){const s=R(t,"x","batchToSpaceND"),r=e.reduce((a,l)=>a*l);E(s.rank>=1+e.length,()=>`input rank is ${s.rank} but should be > than blockShape.length ${e.length}`),E(n.length===e.length,()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${e.length}`),E(s.shape[0]%r===0,()=>`input tensor batch is ${s.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${r}`);const i={x:s},o={blockShape:e,crops:n};return V.runKernel(Rb,i,o)}const BE=H({batchToSpaceND_:Tre});function Ere(t){let e;return t.rank===0||t.rank===1?e=W(t,[1,1,1,t.size]):t.rank===2?e=W(t,[1,1,t.shape[0],t.shape[1]]):t.rank===3?e=W(t,[1,t.shape[0],t.shape[1],t.shape[2]]):e=t,e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ire(t,e,n,s,r,i){i==null&&(i=.001);const o=R(t,"x","batchNorm"),a=R(e,"mean","batchNorm"),l=R(n,"variance","batchNorm");let c;r!=null&&(c=R(r,"scale","batchNorm"));let u;s!=null&&(u=R(s,"offset","batchNorm")),E(a.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),E(u==null||a.rank===u.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),E(c==null||a.rank===c.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const h={x:Ere(o),scale:c,offset:u,mean:a,variance:l},f={varianceEpsilon:i},p=V.runKernel(Vb,h,f);return W(p,o.shape)}const Av=H({batchNorm_:Ire});function Are(t,e,n,s,r,i){const o=R(t,"x","batchNorm"),a=R(e,"mean","batchNorm"),l=R(n,"variance","batchNorm");let c;r!=null&&(c=R(r,"scale","batchNorm"));let u;return s!=null&&(u=R(s,"offset","batchNorm")),E(o.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${o.rank}.`),E(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),E(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`),c!=null&&E(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${c.rank}.`),u!=null&&E(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${u.rank}.`),Av(o,a,l,u,c,i)}const $re=H({batchNorm2d_:Are});function Rre(t,e,n,s,r,i){const o=R(t,"x","batchNorm"),a=R(e,"mean","batchNorm"),l=R(n,"variance","batchNorm");let c;r!=null&&(c=R(r,"scale","batchNorm"));let u;return s!=null&&(u=R(s,"offset","batchNorm")),E(o.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${o.rank}.`),E(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),E(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`),c!=null&&E(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${c.rank}.`),u!=null&&E(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${u.rank}.`),Av(o,a,l,u,c,i)}const Dre=H({batchNorm3d_:Rre});function Ore(t,e,n,s,r,i){const o=R(t,"x","batchNorm"),a=R(e,"mean","batchNorm"),l=R(n,"variance","batchNorm");let c;r!=null&&(c=R(r,"scale","batchNorm"));let u;return s!=null&&(u=R(s,"offset","batchNorm")),E(o.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${o.rank}.`),E(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),E(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`),c!=null&&E(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${c.rank}.`),u!=null&&E(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${u.rank}.`),Av(o,a,l,u,c,i)}const Mre=H({batchNorm4d_:Ore});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pre(t,e,n){const s=R(t,"x","bincount"),r=R(e,"weights","bincount");E(s.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${s.dtype}`),E(n>=0,()=>`size must be non-negative, but got ${n}.`),E(r.size===s.size||r.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${s.shape}, weights shape: ${r.shape}.`);const i={x:s,weights:r},o={size:n};return V.runKernel(QT,i,o)}const Lre=H({bincount_:Pre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fre(t,e){let n=R(t,"broadcastTo","x");const s=n.shape;if(aa(e),e.length<n.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${n.rank}.`);if(e.length>n.rank){const c=n.shape.slice();for(;c.length<e.length;)c.unshift(1);n=W(n,c)}const r=n.shape,i=Array.from(e);for(let c=e.length-1;c>=0;c--)if(r[c]===e[c])i[c]=1;else if(n.shape[c]!==1)throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${e}].`);if(i.map((c,u)=>c>1?u:-1).filter(c=>c>=0).length===0)return uc(n);const a={x:n},l={reps:i};return V.runKernel(Em,a,l)}const mf=H({broadcastTo_:Fre});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _re(t){const n={x:R(t,"x","ceil","float32")};return V.runKernel(Vp,n)}const zre=H({ceil_:_re});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $v(t,e,n){aa(t),n=n||Gd(e);const s={shape:t,value:e,dtype:n};return V.runKernel(fE,{},s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bre(t,e,n){const s=R(t,"x","clipByValue");if(E(e<=n,()=>`Error in clip: min (${e}) must be less than or equal to max (${n}).`),e===n)return $v(s.shape,e,s.dtype);const r={x:s},i={clipValueMin:e,clipValueMax:n};return V.runKernel(Up,r,i)}const Cr=H({clipByValue_:Bre});function jre(t){return Ls(t,0)}const Vre=H({concat1d_:jre});function Ure(t,e){return Ls(t,e)}const Wre=H({concat2d_:Ure});function Hre(t,e){return Ls(t,e)}const Gre=H({concat3d_:Hre});function Kre(t,e){return Ls(t,e)}const qre=H({concat4d_:Kre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xre(t,e,n,s,r="NHWC",i=[1,1],o){const a=R(t,"x","conv2d","float32"),l=R(e,"filter","conv2d","float32");let c=a,u=!1;a.rank===3&&(u=!0,c=W(a,[1,a.shape[0],a.shape[1],a.shape[2]])),E(c.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${c.rank}.`),E(l.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`),Ks("conv2d",s,o);const d=r==="NHWC"?c.shape[3]:c.shape[1];E(d===l.shape[2],()=>`Error in conv2d: depth of input (${d}) must match input depth for filter ${l.shape[2]}.`),E(is(n,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${i}'`),E($c(i),()=>"Error in conv2D: Dilated rates should be larger than 0."),E($c(n),()=>"Error in conv2D: Strides should be larger than 0.");const h={x:c,filter:l},f={strides:n,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o},p=V.runKernel(Mb,h,f);return u?W(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const Rc=H({conv2d_:Xre});function Jre(t,e,n,s,r="NWC",i=1,o){const a=R(t,"x","conv1d"),l=R(e,"filter","conv1d");let c=a,u=!1;a.rank===2&&(u=!0,c=W(a,[1,a.shape[0],a.shape[1]])),E(c.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${c.rank}.`),E(l.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`),Ks("conv1d",s,o),E(c.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${c.shape[2]}) must match input depth for filter ${l.shape[1]}.`),E(is(n,i),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${i}'`),E($c(i),()=>"Error in conv1D: Dilated rates should be larger than 0."),E($c(n),()=>"Error in conv1D: Stride should be larger than 0."),E(r==="NWC",()=>`Error in conv1d: got dataFormat of ${r} but only NWC is currently supported.`);const d=W(l,[1,l.shape[0],l.shape[1],l.shape[2]]),h=W(c,[c.shape[0],1,c.shape[1],c.shape[2]]),g=Rc(h,d,[1,n],s,"NHWC",[1,i],o);return u?W(g,[g.shape[2],g.shape[3]]):W(g,[g.shape[0],g.shape[2],g.shape[3]])}const qB=H({conv1d_:Jre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yre(t,e,n,s,r,i="NHWC",o){E(t.length===e.rank,()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`);let a=t,l=e,c=!1;e.rank===3&&(c=!0,l=W(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,t[0],t[1],t[2]]),E(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),E(l.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`),E(n.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`);const u=i==="NHWC"?a[3]:a[1],d=i==="NHWC"?l.shape[3]:l.shape[1];E(u===n.shape[2],()=>`Error in conv2dDerInput: depth of input (${u}) must match input depth for filter ${n.shape[2]}.`),E(d===n.shape[3],()=>`Error in conv2dDerInput: depth of output (${d}) must match output depth for filter ${n.shape[3]}.`),Ks("conv2dDerInput",r,o);const h={dy:l,filter:n},f={strides:s,pad:r,dataFormat:i,dimRoundingMode:o,inputShape:a},p=V.runKernel(Pb,h,f);return c?W(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const jE=H({conv2DBackpropInput_:Yre});function Qre(t,e,n,s,r,i){const o=R(t,"x","conv2dTranspose"),a=R(e,"filter","conv2dTranspose");return jE(n,o,a,s,r,"NHWC",i)}const XB=H({conv2dTranspose_:Qre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zre(t,e,n,s,r="NDHWC",i=[1,1,1]){const o=R(t,"x","conv3d"),a=R(e,"filter","conv3d");let l=o,c=!1;o.rank===4&&(c=!0,l=W(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),E(l.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),E(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),E(l.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${a.shape[3]}.`),E(is(n,i),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${i}'`),E(r==="NDHWC",()=>`Error in conv3d: got dataFormat of ${r} but only NDHWC is currently supported.`),E($c(i),()=>"Error in conv3D: Dilated rates should be larger than 0."),E($c(n),()=>"Error in conv3D: Strides should be larger than 0.");const u={x:l,filter:a},d={strides:n,pad:s,dataFormat:r,dilations:i},h=V.runKernel(Lb,u,d);return c?W(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const eie=H({conv3d_:Zre});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tie(t,e,n,s,r){E(t.length===e.rank,()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`);let i=t,o=e,a=!1;e.rank===4&&(a=!0,o=W(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,t[0],t[1],t[2],t[3]]);const l=i[4],c=o.shape[4];E(i.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${i.length}.`),E(o.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${o.rank}`),E(n.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${n.rank}`),E(l===n.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${n.shape[3]}.`),E(c===n.shape[4],()=>`Error in conv3dDerInput: depth of output (${c}) must match output depth for filter ${n.shape[4]}.`);const u={dy:o,filter:n},d={pad:r,strides:s,inputShape:i},h=V.runKernel(sE,u,d);return a?W(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const JB=H({conv3DBackpropInput_:tie});function nie(t,e,n,s,r){const i=R(t,"x","conv3dTranspose"),o=R(e,"filter","conv3dTranspose");return JB(n,i,o,s,r)}const sie=H({conv3dTranspose_:nie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rie(t){const n={x:R(t,"x","cos","float32")};return V.runKernel(Wp,n)}const VE=H({cos_:rie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iie(t){const n={x:R(t,"x","cosh","float32")};return V.runKernel(Hp,n)}const YB=H({cosh_:iie});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oie(t,e=0,n=!1,s=!1){const i={x:R(t,"x","cumprod")},o={axis:e,exclusive:n,reverse:s};return V.runKernel(rE,i,o)}const cC=H({cumprod_:oie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aie(t,e=0,n=!1,s=!1){const i={x:R(t,"x","cumsum")},o={axis:e,exclusive:n,reverse:s};return V.runKernel(Fb,i,o)}const QB=H({cumsum_:aie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lie(t,e,n,s=!1){const r=R(t,"x","denseBincount"),i=R(e,"weights","denseBincount");E(r.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${r.dtype}`),E(r.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${r.rank}.`),E(n>=0,()=>`size must be non-negative, but got ${n}.`),E(i.size===r.size||i.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${r.shape}, weights shape: ${i.shape}.`);const o={x:r,weights:i},a={size:n,binaryOutput:s};return V.runKernel(oE,o,a)}const oO=H({denseBincount_:lie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cie(t,e,n="NHWC"){const s=R(t,"x","depthToSpace","float32"),r=n==="NHWC"?s.shape[1]:s.shape[2],i=n==="NHWC"?s.shape[2]:s.shape[3],o=n==="NHWC"?s.shape[3]:s.shape[1];E(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),E(r*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${r} and ${e}  for depthToSpace with input shape
    ${s.shape}`),E(i*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${e} for depthToSpace with input shape
        ${s.shape}`),E(o%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${o} for depthToSpace with input shape ${s.shape}`);const a={x:s},l={blockSize:e,dataFormat:n};return V.runKernel(aE,a,l)}const uie=H({depthToSpace_:cie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function die(t,e,n,s,r="NHWC",i=[1,1],o){const a=R(t,"x","depthwiseConv2d","float32"),l=R(e,"filter","depthwiseConv2d","float32");let c=a,u=!1;a.rank===3&&(u=!0,c=W(a,[1,a.shape[0],a.shape[1],a.shape[2]])),E(c.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${c.rank}.`),E(l.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`);const d=r==="NHWC"?c.shape[3]:c.shape[1];E(d===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${d}) must match the inChannels dimension in filter ${l.shape[2]}.`),Ks("depthwiseConv2d",s,o);const h={x:c,filter:l},f={strides:n,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o},p=V.runKernel(_b,h,f);return u?W(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const UE=H({depthwiseConv2d_:die});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hie(t,e,n,s,r=[1,1],i="NHWC"){const o=R(t,"x","dilation2d"),a=R(e,"filter","dilation2d");E(o.rank===3||o.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${o.rank}.`),E(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),E(i==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${i}`);let l=o,c=!1;o.rank===3&&(l=W(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=!0),E(l.shape[3]===a.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${l.shape[3]} vs ${a.shape[2]}`);const u={x:l,filter:a},d={strides:n,pad:s,dilations:r},h=V.runKernel(zb,u,d);return c?W(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const fie=H({dilation2d_:hie});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nd(t,e){const n=t.length,s=[];for(let r=0;r<n;r++){const i=n-1-r,o=t[i]||1;(e[e.length-1-r]||1)>1&&o===1&&s.unshift(i)}return s}function kn(t,e){const n=[];for(let s=0;s<e.length;s++){const r=t[t.length-s-1],i=e.length-s-1,o=e[i];(r==null||r===1&&o>1)&&n.unshift(i)}return n}function _e(t,e){const n=Math.max(t.length,e.length),s=new Array(n);for(let r=0;r<n;r++){let i=t[t.length-r-1];i==null&&(i=1);let o=e[e.length-r-1];if(o==null&&(o=1),i===1)s[n-r-1]=o;else if(o===1)s[n-r-1]=i;else if(i!==o){const a=`Operands could not be broadcast together with shapes ${t} and ${e}.`;throw Error(a)}else s[n-r-1]=i}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pie(t,e){let n=R(t,"a","equal","string_or_numeric"),s=R(e,"b","equal","string_or_numeric");[n,s]=tn(n,s),_e(n.shape,s.shape);const r={a:n,b:s};return V.runKernel(Bb,r)}const po=H({equal_:pie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mie(t,e,n){const s=R(e,"a","where"),r=R(n,"b","where"),i=R(t,"condition","where","bool"),o=_e(_e(i.shape,s.shape),r.shape),a=mf(i,o),l=mf(s,o),c=mf(r,o),u={condition:a,t:l,e:c};return V.runKernel(gv,u)}const ws=H({where_:mie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gie(t){const n={x:R(t,"x","zerosLike")};return V.runKernel(Cv,n)}const st=H({zerosLike_:gie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yie(t,e){let n=R(t,"a","div"),s=R(e,"b","div");[n,s]=tn(n,s);const r=Ie(n,s),i=st(r),o=po(s,i);return ws(o,i,r)}const xie=H({divNoNan_:yie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bie(t,e){const n=R(t,"t1","dot"),s=R(e,"t2","dot");E((n.rank===1||n.rank===2)&&(s.rank===1||s.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${s.rank}.`);const r=n.rank===1?n.size:n.shape[1],i=s.rank===1?s.size:s.shape[0];if(E(r===i,()=>`Error in dot: inner dimensions of inputs must match, but got ${r} and ${i}.`),n.rank===1&&s.rank===1){const o=W(n,[1,-1]),a=W(s,[-1,1]),l=at(o,a);return W(l,[])}else if(n.rank===1&&s.rank===2){const o=W(n,[1,-1]),a=W(s,[s.shape[0],s.shape[1]]),l=at(o,a);return W(l,[l.size])}else if(n.rank===2&&s.rank===1){const o=W(s,[-1,1]),a=at(n,o);return W(a,[a.size])}else{const o=W(s,[s.shape[0],s.shape[1]]);return at(n,o)}}const vie=H({dot_:bie});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wie(t,...e){const n=e.map((r,i)=>R(r,`tensors${i}`,"einsum")),s={equation:t};return V.runKernel(uE,n,s)}const Th=H({einsum_:wie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sie(t){const n={x:R(t,"x","elu","float32")};return V.runKernel(Kp,n)}const Rv=H({elu_:Sie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kie(t){let e=R(t,"x","erf");E(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=fe(e,"float32"));const n={x:e};return V.runKernel(qp,n)}const ZB=H({erf_:kie});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WE(t,e){for(let n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function ej(t,e,n){const s=t.length+e.length,r=[];let i=0,o=0;for(let a=0;a<s;a++)n.indexOf(a)===-1?r.push(t[i++]):r.push(e[o++]);return r}function Dn(t,e){const n=[],s=t.length;for(let i=0;i<s;i++)e.indexOf(i)===-1&&n.push(t[i]);const r=e.map(i=>t[i]);return[n,r]}function cn(t,e){const n=e.map(s=>1);return ej(t,n,e)}function Hn(t,e,n){E(WE(e,n),()=>`${t} supports only inner-most axes for now. Got axes ${e} and rank-${n} input.`)}function Bt(t,e){if(WE(t,e))return null;const n=[];for(let s=0;s<e;++s)t.indexOf(s)===-1&&n.push(s);return t.forEach(s=>n.push(s)),n}function kl(t){return t.map((e,n)=>[n,e]).sort((e,n)=>e[1]-n[1]).map(e=>e[0])}function nn(t,e){const n=[];for(let s=e-t;s<e;++s)n.push(s);return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cie(t,e=null,n=!1){const r={x:R(t,"x","max")},i={reductionIndices:e,keepDims:n};return V.runKernel(Qb,r,i)}const Ii=H({max_:Cie});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nie(t,e=null,n=!1){const r={x:R(t,"x","min")},i={axis:e,keepDims:n};return V.runKernel(nv,r,i)}const $0=H({min_:Nie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tie(t,e){let n=R(t,"base","pow"),s=R(e,"exp","pow");[n,s]=tn(n,s);const r={a:n,b:s};return V.runKernel(um,r)}const Dc=H({pow_:Tie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lt(t,e){if((ri(t)&&e!=="string"||Array.isArray(t))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&ri(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Ev(t,[],[],e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eie(t){const n={x:R(t,"x","sqrt","float32")};return V.runKernel(Sm,n)}const rs=H({sqrt_:Eie});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Iie(t){const e=R(t,"x","square"),n={};return V.runKernel("Square",{x:e},n)}const Tt=H({square_:Iie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Aie(t,e=null,n=!1){let s=R(t,"x","sum");s.dtype==="bool"&&(s=fe(s,"int32"));const r={x:s},i={axis:e,keepDims:n};return V.runKernel(xv,r,i)}const Ce=H({sum_:Aie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $ie(t,e="euclidean",n=null,s=!1){t=R(t,"x","norm");const r=tj(t,e,n);let i=r.shape;if(s){const o=Ge(n,t.shape);i=cn(r.shape,o)}return W(r,i)}function tj(t,e,n=null){if(t.rank===0)return ps(t);if(t.rank!==1&&n===null)return tj(W(t,[-1]),e,n);if(t.rank===1||typeof n=="number"||Array.isArray(n)&&n.length===1){if(e===1)return Ce(ps(t),n);if(e===1/0)return Ii(ps(t),n);if(e===-1/0)return $0(ps(t),n);if(e==="euclidean"||e===2)return rs(Ce(Dc(ps(t),lt(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(n)&&n.length===2){if(e===1)return Ii(Ce(ps(t),n[0]),n[1]-1);if(e===1/0)return Ii(Ce(ps(t),n[1]),n[0]);if(e===-1/0)return $0(Ce(ps(t),n[1]),n[0]);if(e==="fro"||e==="euclidean")return rs(Ce(Tt(t),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}const Dv=H({norm_:$ie});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rie(t,e=null,n=!1){return Dv(t,"euclidean",e,n)}const Die=H({euclideanNorm_:Rie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oie(t){const n={x:R(t,"x","exp")};return V.runKernel(Xp,n)}const mo=H({exp_:Oie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mie(t,e=0){const n=R(t,"x","expandDims","string_or_numeric");E(e<=n.rank,()=>"Axis must be <= rank of the tensor");const s={input:n},r={dim:e};return V.runKernel(jb,s,r)}const Ds=H({expandDims_:Mie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pie(t){const n={x:R(t,"x","expm1")};return V.runKernel(Jp,n)}const Lie=H({expm1_:Pie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fie(t,e){const n=R(t,"x","tile","string_or_numeric");E(n.rank===e.length,()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${e}.`);const s={x:n},r={reps:e};return V.runKernel(Em,s,r)}const Si=H({tile_:Fie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _ie(t,e,n,s="float32"){e==null&&(e=t);const r=He([t,e],s),i=t<=e?t:e;for(let a=0;a<i;++a)r.set(1,a,a);const o=W(r.toTensor(),[t,e]);if(n==null)return o;if(n.length===1)return Si(Ds(o,0),[n[0],1,1]);if(n.length===2)return Si(Ds(Ds(o,0),0),[n[0],n[1],1,1]);if(n.length===3)return Si(Ds(Ds(Ds(o,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}const nj=H({eye_:_ie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zie(t){const n={x:R(t,"x","floor","float32")};return V.runKernel(Yp,n)}const Ov=H({floor_:zie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bie(t,e,n=0,s=0){const r=R(t,"x","gather"),i=R(e,"indices","gather","int32"),o={x:r,indices:i},a={axis:n,batchDims:s};return V.runKernel(Ub,o,a)}const HE=H({gather_:Bie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jie(t,e){let n=R(t,"a","greater","string_or_numeric"),s=R(e,"b","greater","string_or_numeric");[n,s]=tn(n,s),_e(n.shape,s.shape);const r={a:n,b:s};return V.runKernel(Wb,r)}const Ir=H({greater_:jie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vie(t,e){let n=R(t,"a","greaterEqual","string_or_numeric"),s=R(e,"b","greaterEqual","string_or_numeric");[n,s]=tn(n,s),_e(n.shape,s.shape);const r={a:n,b:s};return V.runKernel(Zp,r)}const Yc=H({greaterEqual_:Vie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uie(t){const n={input:R(t,"input","imag")};return V.runKernel(gE,n)}const GE=H({imag_:Uie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wie(t){const n={x:R(t,"x","isFinite")};return V.runKernel(tm,n)}const Hie=H({isFinite_:Wie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gie(t){const n={x:R(t,"x","isInf")};return V.runKernel(nm,n)}const Kie=H({isInf_:Gie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qie(t){const n={x:R(t,"x","isNaN")};return V.runKernel(sm,n)}const Xie=H({isNaN_:qie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jie(t,e=.2){const s={x:R(t,"x","leakyRelu")},r={alpha:e};return V.runKernel(Hb,s,r)}const KE=H({leakyRelu_:Jie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yie(t,e){let n=R(t,"a","less","string_or_numeric"),s=R(e,"b","less","string_or_numeric");[n,s]=tn(n,s),_e(n.shape,s.shape);const r={a:n,b:s};return V.runKernel(Gb,r)}const R0=H({less_:Yie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qie(t,e){let n=R(t,"a","lessEqual","string_or_numeric"),s=R(e,"b","lessEqual","string_or_numeric");[n,s]=tn(n,s),_e(n.shape,s.shape);const r={a:n,b:s};return V.runKernel(Kb,r)}const Jd=H({lessEqual_:Qie});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zie(t,e=5,n=1,s=1,r=.5){const i=R(t,"x","localResponseNormalization");E(i.rank===4||i.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${i.rank}.`),E(wd(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let o=i,a=!1;i.rank===3&&(a=!0,o=W(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const l={x:o},c={depthRadius:e,bias:n,alpha:s,beta:r},u=V.runKernel(Yb,l,c);return a?W(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const eoe=H({localResponseNormalization_:Zie});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function toe(t){const n={x:R(t,"x","log","float32")};return V.runKernel(rm,n)}const go=H({log_:toe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function noe(t){const n={x:R(t,"x","log1p")};return V.runKernel(im,n)}const sj=H({log1p_:noe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function soe(t,e){E(Gk(t),()=>"The f passed in variableGrads(f) must be a function"),E(e==null||Array.isArray(e)&&e.every(c=>c instanceof I0),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const n=e!=null;if(!n){e=[];for(const c in V.registeredVariables)e.push(V.registeredVariables[c])}const s=n?e.filter(c=>!c.trainable):null,r=e.length;e=e.filter(c=>c.trainable),E(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${r} variables is trainable.`);const i=!0,{value:o,grads:a}=V.gradients(t,e,null,i);E(a.some(c=>c!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),E(o.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`);const l={};return e.forEach((c,u)=>{a[u]!=null&&(l[c.name]=a[u])}),s!=null&&s.forEach(c=>l[c.name]=null),{value:o,grads:l}}function Td(t){return V.customGrad(t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function roe(t){const n={x:R(t,"x","neg")};return V.runKernel(rv,n)}const en=H({neg_:roe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ioe(t){const n={x:R(t,"x","softplus")};return V.runKernel(wm,n)}const $m=H({softplus_:ioe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ooe(t){const e=R(t,"x","logSigmoid");return Td(s=>({value:en($m(en(s))),gradFunc:o=>B(o,Xd(en(s)))}))(e)}const aoe=H({logSigmoid_:ooe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function loe(t,e){let n=R(t,"a","sub"),s=R(e,"b","sub");[n,s]=tn(n,s);const r={a:n,b:s};return V.runKernel(Cm,r)}const De=H({sub_:loe});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function coe(t,e=-1){const n=R(t,"logits","logSoftmax");if(e===-1&&(e=n.rank-1),e!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${e}`);return Td((r,i)=>{const a=Ii(r,e,!0),l=De(r,a),c=De(fe(l,"float32"),go(Ce(mo(l),e,!0)));return i([c]),{value:c,gradFunc:(d,h)=>{const[f]=h,p=!0,m=mo(f);return De(d,B(Ce(d,e,p),m))}}})(n)}const rj=H({logSoftmax_:coe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uoe(t,e=null,n=!1){const s=R(t,"x","logSumExp"),r=Ge(e,s.shape),i=Ii(s,r,!0),o=De(s,i),a=mo(o),l=Ce(a,r),c=go(l),u=ie(W(i,c.shape),c);if(n){const d=cn(u.shape,r);return W(u,d)}return u}const ij=H({logSumExp_:uoe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function doe(t,e){const n=R(t,"a","logicalAnd","bool"),s=R(e,"b","logicalAnd","bool");_e(n.shape,s.shape);const r={a:n,b:s};return V.runKernel(qb,r)}const na=H({logicalAnd_:doe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hoe(t){const n={x:R(t,"x","logicalNot","bool")};return V.runKernel(Xb,n)}const qE=H({logicalNot_:hoe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function foe(t,e){const n=R(t,"a","logicalOr","bool"),s=R(e,"b","logicalOr","bool");_e(n.shape,s.shape);const r={a:n,b:s};return V.runKernel(Jb,r)}const oj=H({logicalOr_:foe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function poe(t,e){const n=R(t,"a","logicalXor","bool"),s=R(e,"b","logicalXor","bool");return _e(n.shape,s.shape),na(oj(t,e),qE(na(t,e)))}const moe=H({logicalXor_:poe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function goe(t,e,n,s,r){const i=R(t,"x","maxPool"),o=1;let a=i,l=!1;i.rank===3&&(l=!0,a=W(i,[1,i.shape[0],i.shape[1],i.shape[2]])),E(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),E(is(n,o),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`),Ks("maxPool",s,r);const c={x:a},u={filterSize:e,strides:n,pad:s,dimRoundingMode:r},d=V.runKernel(Zb,c,u);return l?W(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const XE=H({maxPool_:goe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yoe(t,e=[1,1,1],n,s,r,i="NDHWC"){const o=R(t,"x","maxPool3d");let a=o,l=!1;o.rank===4&&(l=!0,a=W(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),E(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),E(i==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),Ks("maxPool3d",s,r);const c={x:a},u={filterSize:e,strides:n,pad:s,dimRoundingMode:r,dataFormat:i},d=V.runKernel(ev,c,u);return l?W(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const xoe=H({maxPool3d_:yoe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function boe(t,e){let n=R(t,"a","maximum"),s=R(e,"b","maximum");[n,s]=tn(n,s),n.dtype==="bool"&&(n=fe(n,"int32"),s=fe(s,"int32")),_e(n.shape,s.shape);const r={a:n,b:s};return V.runKernel(om,r)}const Cl=H({maximum_:boe});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function voe(t,e=null,n=!1){const r={x:R(t,"x","mean")},i={axis:e,keepDims:n};return V.runKernel(tv,r,i)}const ln=H({mean_:voe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function An(t,e="float32"){if(aa(t),e==="complex64"){const s=An(t,"float32"),r=An(t,"float32");return Tc(s,r)}const n=ss(Q(t),e);return V.makeTensor(n,t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nl(t,e="float32"){if(aa(t),e==="complex64"){const s=Nl(t,"float32"),r=An(t,"float32");return Tc(s,r)}const n=WT(Q(t),e);return V.makeTensor(n,t,e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function woe(t,e){let n=R(t,"a","minimum"),s=R(e,"b","minimum");[n,s]=tn(n,s),n.dtype==="bool"&&(n=fe(n,"int32"),s=fe(s,"int32")),_e(n.shape,s.shape);const r={a:n,b:s};return V.runKernel(am,r)}const Zf=H({minimum_:woe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Soe(t,e,n){E(n==="reflect"||n==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`);const s=R(t,"x","mirrorPad");if(s.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");E(e.length===s.rank,()=>`Padding doesn't match input. Must be ${s.rank}. Got ${e.length}.`);const r=n==="reflect"?1:0;for(let a=0;a<s.rank;a++)E(e[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),E(e[a][0]>=0&&e[a][0]<=s.shape[a]-r&&e[a][1]>=0&&e[a][1]<=s.shape[a]-r,()=>`Padding in dimension ${a} cannot be greater than or equal to ${s.shape[a]-r} or less than 0 for input of shape ${s.shape}`);const i={paddings:e,mode:n},o={x:s};return V.runKernel(sv,o,i)}const koe=H({mirrorPad_:Soe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Coe(t,e){let n=R(t,"a","mod"),s=R(e,"b","mod");[n,s]=tn(n,s);const r={a:n,b:s};return V.runKernel(lm,r)}const Noe=H({mod_:Coe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Toe(t,e=null,n=!1){t=R(t,"x","moments");const s=Ge(e,t.shape),r=ln(t,s,n);let i=r.shape;n||(i=cn(r.shape,s));const o=Tt(De(fe(t,"float32"),W(r,i))),a=ln(o,s,n);return{mean:r,variance:a}}const JE=H({moments_:Toe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eoe(t,e){let n=R(t,"a","notEqual","string_or_numeric"),s=R(e,"b","notEqual","string_or_numeric");[n,s]=tn(n,s),_e(n.shape,s.shape);const r={a:n,b:s};return V.runKernel(iv,r)}const D0=H({notEqual_:Eoe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ioe(t,e,n=1,s=0,r="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const o={indices:R(t,"indices","oneHot","int32")},a={dtype:r,depth:e,onValue:n,offValue:s};return V.runKernel(av,o,a)}const aj=H({oneHot_:Ioe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Aoe(t){const n={x:R(t,"x","onesLike")};return V.runKernel(ov,n)}const ii=H({onesLike_:Aoe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $oe(t,e,n=0){const s=R(t,"x","pad");if(s.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const r={paddings:e,constantValue:n},i={x:s};return V.runKernel(cv,i,r)}const YE=H({pad_:$oe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Roe(t,e,n){const s=R(t,"x","spaceToBatchND");E(s.rank>=1+e.length,()=>`input rank ${s.rank} should be > than [blockShape] ${e.length}`),E(n.length===e.length,()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${e.length}`),E(s.shape.reduce((o,a,l)=>l>0&&l<=e.length?o&&(a+n[l-1][0]+n[l-1][1])%e[l-1]===0:o,!0),()=>`input spatial dimensions ${s.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${e.toString()}`);const r={x:s},i={blockShape:e,paddings:n};return V.runKernel(bv,r,i)}const QE=H({spaceToBatchND_:Roe});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Doe(t,e,n,s,r,i,o){r==null&&(r=[1,1]),i==null&&(i=1),s===0&&(s="valid");const a=R(t,"x","maxPool");let l=a,c=!1;a.rank===3&&(c=!0,l=W(a,[1,a.shape[0],a.shape[1],a.shape[2]])),E(is(i,r),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${i} and dilations '${r}'`);const u=ai(l.shape,e,i,r,s),d=[u.dilationHeight,u.dilationWidth];let h;s==="same"?h=Moe([u.filterHeight,u.filterWidth],d):h=[[0,0],[0,0]];const f=d[0]===1&&d[1]===1,[p,m]=Ooe([u.inHeight,u.inWidth],d,h),g=f?s:"valid",y=f?l:QE(l,d,p),v=(n==="avg"?()=>zE(y,e,i,g,o):()=>XE(y,e,i,g,o))(),w=f?v:BE(v,d,m);return c?W(w,[w.shape[1],w.shape[2],w.shape[3]]):w}function Ooe(t,e,n){const s=n.map(u=>u[0]),r=n.map(u=>u[1]),i=t.concat(s,r),o=e.map((u,d)=>(u-i[d]%u)%u),a=r.map((u,d)=>u+o[d]),l=e.map((u,d)=>[s[d],a[d]]),c=e.map((u,d)=>[0,o[d]]);return[l,c]}function Moe(t,e){const s=t.map((o,a)=>o+(o-1)*(e[a]-1)).map(o=>o-1),r=s.map(o=>Math.floor(o/2)),i=s.map((o,a)=>o-r[a]);return s.map((o,a)=>[r[a],i[a]])}const Poe=H({pool_:Doe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Loe(t,e){const n=R(t,"x","prelu"),s=R(e,"alpha","prelu"),r={x:n,alpha:s};return V.runKernel(uv,r)}const ZE=H({prelu_:Loe});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Foe(t,e=null,n=!1){let s=R(t,"x","prod");s.dtype==="bool"&&(s=fe(s,"int32"));const r={x:s},i={axis:e,keepDims:n};return V.runKernel(dv,r,i)}const _oe=H({prod_:Foe});var eI={exports:{}};eI.exports;(function(t){(function(e,n,s){function r(l){var c=this,u=a();c.next=function(){var d=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=d-(c.c=d|0)},c.c=1,c.s0=u(" "),c.s1=u(" "),c.s2=u(" "),c.s0-=u(l),c.s0<0&&(c.s0+=1),c.s1-=u(l),c.s1<0&&(c.s1+=1),c.s2-=u(l),c.s2<0&&(c.s2+=1),u=null}function i(l,c){return c.c=l.c,c.s0=l.s0,c.s1=l.s1,c.s2=l.s2,c}function o(l,c){var u=new r(l),d=c&&c.state,h=u.next;return h.int32=function(){return u.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,d&&(typeof d=="object"&&i(d,u),h.state=function(){return i(u,{})}),h}function a(){var l=4022871197,c=function(u){u=String(u);for(var d=0;d<u.length;d++){l+=u.charCodeAt(d);var h=.02519603282416938*l;l=h>>>0,h-=l,h*=l,l=h>>>0,h-=l,l+=h*4294967296}return(l>>>0)*23283064365386963e-26};return c}n&&n.exports?n.exports=o:s&&s.amd?s(function(){return o}):this.alea=o})(Wc,t,!1)})(eI);var zoe=eI.exports,tI={exports:{}};tI.exports;(function(t){(function(e,n,s){function r(a){var l=this,c="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var d=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^d^d>>>8},a===(a|0)?l.x=a:c+=a;for(var u=0;u<c.length+64;u++)l.x^=c.charCodeAt(u)|0,l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l}function o(a,l){var c=new r(a),u=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var h=c.next()>>>11,f=(c.next()>>>0)/4294967296,p=(h+f)/(1<<21);while(p===0);return p},d.int32=c.next,d.quick=d,u&&(typeof u=="object"&&i(u,c),d.state=function(){return i(c,{})}),d}n&&n.exports?n.exports=o:s&&s.amd?s(function(){return o}):this.xor128=o})(Wc,t,!1)})(tI);var Boe=tI.exports,nI={exports:{}};nI.exports;(function(t){(function(e,n,s){function r(a){var l=this,c="";l.next=function(){var d=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^(d^d<<1))|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,a===(a|0)?l.x=a:c+=a;for(var u=0;u<c.length+64;u++)l.x^=c.charCodeAt(u)|0,u==c.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function i(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l.v=a.v,l.d=a.d,l}function o(a,l){var c=new r(a),u=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var h=c.next()>>>11,f=(c.next()>>>0)/4294967296,p=(h+f)/(1<<21);while(p===0);return p},d.int32=c.next,d.quick=d,u&&(typeof u=="object"&&i(u,c),d.state=function(){return i(c,{})}),d}n&&n.exports?n.exports=o:s&&s.amd?s(function(){return o}):this.xorwow=o})(Wc,t,!1)})(nI);var joe=nI.exports,sI={exports:{}};sI.exports;(function(t){(function(e,n,s){function r(a){var l=this;l.next=function(){var u=l.x,d=l.i,h,f;return h=u[d],h^=h>>>7,f=h^h<<24,h=u[d+1&7],f^=h^h>>>10,h=u[d+3&7],f^=h^h>>>3,h=u[d+4&7],f^=h^h<<7,h=u[d+7&7],h=h^h<<13,f^=h^h<<9,u[d]=f,l.i=d+1&7,f};function c(u,d){var h,f=[];if(d===(d|0))f[0]=d;else for(d=""+d,h=0;h<d.length;++h)f[h&7]=f[h&7]<<15^d.charCodeAt(h)+f[h+1&7]<<13;for(;f.length<8;)f.push(0);for(h=0;h<8&&f[h]===0;++h);for(h==8?f[7]=-1:f[h],u.x=f,u.i=0,h=256;h>0;--h)u.next()}c(l,a)}function i(a,l){return l.x=a.x.slice(),l.i=a.i,l}function o(a,l){a==null&&(a=+new Date);var c=new r(a),u=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var h=c.next()>>>11,f=(c.next()>>>0)/4294967296,p=(h+f)/(1<<21);while(p===0);return p},d.int32=c.next,d.quick=d,u&&(u.x&&i(u,c),d.state=function(){return i(c,{})}),d}n&&n.exports?n.exports=o:s&&s.amd?s(function(){return o}):this.xorshift7=o})(Wc,t,!1)})(sI);var Voe=sI.exports,rI={exports:{}};rI.exports;(function(t){(function(e,n,s){function r(a){var l=this;l.next=function(){var u=l.w,d=l.X,h=l.i,f,p;return l.w=u=u+1640531527|0,p=d[h+34&127],f=d[h=h+1&127],p^=p<<13,f^=f<<17,p^=p>>>15,f^=f>>>12,p=d[h]=p^f,l.i=h,p+(u^u>>>16)|0};function c(u,d){var h,f,p,m,g,y=[],x=128;for(d===(d|0)?(f=d,d=null):(d=d+"\0",f=0,x=Math.max(x,d.length)),p=0,m=-32;m<x;++m)d&&(f^=d.charCodeAt((m+32)%d.length)),m===0&&(g=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,m>=0&&(g=g+1640531527|0,h=y[m&127]^=f+g,p=h==0?p+1:0);for(p>=128&&(y[(d&&d.length||0)&127]=-1),p=127,m=4*128;m>0;--m)f=y[p+34&127],h=y[p=p+1&127],f^=f<<13,h^=h<<17,f^=f>>>15,h^=h>>>12,y[p]=f^h;u.w=g,u.X=y,u.i=p}c(l,a)}function i(a,l){return l.i=a.i,l.w=a.w,l.X=a.X.slice(),l}function o(a,l){a==null&&(a=+new Date);var c=new r(a),u=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var h=c.next()>>>11,f=(c.next()>>>0)/4294967296,p=(h+f)/(1<<21);while(p===0);return p},d.int32=c.next,d.quick=d,u&&(u.X&&i(u,c),d.state=function(){return i(c,{})}),d}n&&n.exports?n.exports=o:s&&s.amd?s(function(){return o}):this.xor4096=o})(Wc,t,!1)})(rI);var Uoe=rI.exports,iI={exports:{}};iI.exports;(function(t){(function(e,n,s){function r(a){var l=this,c="";l.next=function(){var d=l.b,h=l.c,f=l.d,p=l.a;return d=d<<25^d>>>7^h,h=h-f|0,f=f<<24^f>>>8^p,p=p-d|0,l.b=d=d<<20^d>>>12^h,l.c=h=h-f|0,l.d=f<<16^h>>>16^p,l.a=p-d|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,a===Math.floor(a)?(l.a=a/4294967296|0,l.b=a|0):c+=a;for(var u=0;u<c.length+20;u++)l.b^=c.charCodeAt(u)|0,l.next()}function i(a,l){return l.a=a.a,l.b=a.b,l.c=a.c,l.d=a.d,l}function o(a,l){var c=new r(a),u=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var h=c.next()>>>11,f=(c.next()>>>0)/4294967296,p=(h+f)/(1<<21);while(p===0);return p},d.int32=c.next,d.quick=d,u&&(typeof u=="object"&&i(u,c),d.state=function(){return i(c,{})}),d}n&&n.exports?n.exports=o:s&&s.amd?s(function(){return o}):this.tychei=o})(Wc,t,!1)})(iI);var Woe=iI.exports,lj={exports:{}};const Hoe={},Goe=Object.freeze(Object.defineProperty({__proto__:null,default:Hoe},Symbol.toStringTag,{value:"Module"})),Koe=x6(Goe);(function(t){(function(e,n,s){var r=256,i=6,o=52,a="random",l=s.pow(r,i),c=s.pow(2,o),u=c*2,d=r-1,h;function f(w,S,k){var C=[];S=S==!0?{entropy:!0}:S||{};var N=y(g(S.entropy?[w,v(n)]:w??x(),3),C),T=new p(C),I=function(){for(var D=T.g(i),F=l,A=0;D<c;)D=(D+A)*r,F*=r,A=T.g(1);for(;D>=u;)D/=2,F/=2,A>>>=1;return(D+A)/F};return I.int32=function(){return T.g(4)|0},I.quick=function(){return T.g(4)/4294967296},I.double=I,y(v(T.S),n),(S.pass||k||function(D,F,A,O){return O&&(O.S&&m(O,T),D.state=function(){return m(T,{})}),A?(s[a]=D,F):D})(I,N,"globalThis"in S?S.global:this==s,S.state)}function p(w){var S,k=w.length,C=this,N=0,T=C.i=C.j=0,I=C.S=[];for(k||(w=[k++]);N<r;)I[N]=N++;for(N=0;N<r;N++)I[N]=I[T=d&T+w[N%k]+(S=I[N])],I[T]=S;(C.g=function(D){for(var F,A=0,O=C.i,P=C.j,L=C.S;D--;)F=L[O=d&O+1],A=A*r+L[d&(L[O]=L[P=d&P+F])+(L[P]=F)];return C.i=O,C.j=P,A})(r)}function m(w,S){return S.i=w.i,S.j=w.j,S.S=w.S.slice(),S}function g(w,S){var k=[],C=typeof w,N;if(S&&C=="object")for(N in w)try{k.push(g(w[N],S-1))}catch{}return k.length?k:C=="string"?w:w+"\0"}function y(w,S){for(var k=w+"",C,N=0;N<k.length;)S[d&N]=d&(C^=S[d&N]*19)+k.charCodeAt(N++);return v(S)}function x(){try{var w;return h&&(w=h.randomBytes)?w=w(r):(w=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(w)),v(w)}catch{var S=e.navigator,k=S&&S.plugins;return[+new Date,e,k,e.screen,v(n)]}}function v(w){return String.fromCharCode.apply(0,w)}if(y(s.random(),n),t.exports){t.exports=f;try{h=Koe}catch{}}else s["seed"+a]=f})(typeof self<"u"?self:Wc,[],Math)})(lj);var qoe=lj.exports,Xoe=zoe,Joe=Boe,Yoe=joe,Qoe=Voe,Zoe=Uoe,eae=Woe,Qc=qoe;Qc.alea=Xoe;Qc.xor128=Joe;Qc.xorwow=Yoe;Qc.xorshift7=Qoe;Qc.xor4096=Zoe;Qc.tychei=eae;var oI=Qc;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cj{constructor(e,n,s,r,i){this.mean=e,this.stdDev=n,this.dtype=s,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const o=i||Math.random();this.random=oI.alea(o.toString())}nextValue(){if(!isNaN(this.nextVal)){const r=this.nextVal;return this.nextVal=NaN,r}let e,n,s=!1;for(;!s;){let r,i,o;do r=2*this.random()-1,i=2*this.random()-1,o=r*r+i*i;while(o>=1||o===0);const a=Math.sqrt(-2*Math.log(o)/o);e=this.mean+this.stdDev*r*a,n=this.mean+this.stdDev*i*a,(!this.truncated||this.isValidTruncated(e))&&(s=!0)}return(!this.truncated||this.isValidTruncated(n))&&(this.nextVal=this.convertValue(n)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class tae{constructor(e=0,n=1,s,r){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=n-e,this.dtype=s,r==null&&(r=Math.random()),typeof r=="number"&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${n} <= 1 and dtype is not float`);this.random=oI.alea(r)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nae(t,e=0,n=1,s,r){if(aa(t),s!=null&&s==="bool")throw new Error(`Unsupported data type ${s}`);const i=new cj(e,n,s,!1,r),o=He(t,s);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const sae=H({randomNormal_:nae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rae(t,e=0,n=1,s="float32",r){aa(t);const i=He(t,s),o=new tae(e,n,null,r);for(let a=0;a<i.values.length;a++)i.values[a]=o.nextValue();return i.toTensor()}const Rm=H({randomUniform_:rae});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ep(t,e,n=1,s="float32"){if(n===0)throw new Error("Cannot have a step of zero");const r={start:t,stop:e,step:n,dtype:s};return V.runKernel(kE,{},r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iae(t){const n={input:R(t,"input","real")};return V.runKernel(CE,n)}const O0=H({real_:iae});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oae(t){const n={x:R(t,"x","reciprocal")};return V.runKernel(dm,n)}const aae=H({reciprocal_:oae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lae(t){const n={x:R(t,"x","relu")};return V.runKernel(hm,n)}const Zc=H({relu_:lae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cae(t){const n={x:R(t,"x","relu6")};return V.runKernel(fm,n)}const uj=H({relu6_:cae});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uae(t,e){const s={x:R(t,"x","reverse")},r={dims:e};return V.runKernel(mv,s,r)}const Oc=H({reverse_:uae});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dae(t){const n={x:R(t,"x","round")};return V.runKernel(pm,n)}const dj=H({round_:dae});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hae(t){const n={x:R(t,"x","rsqrt","float32")};return V.runKernel(mm,n)}const hj=H({rsqrt_:hae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fae(t){const n={x:R(t,"x","selu")};return V.runKernel(gm,n)}const fj=H({selu_:fae});function pae(t,e,n,s,r,i=[1,1],o="NHWC"){const a=R(t,"x","separableConv2d"),l=R(e,"depthwiseFilter","separableConv2d"),c=R(n,"pointwiseFilter","separableConv2d");let u=a,d=!1;if(a.rank===3&&(d=!0,u=W(a,[1,a.shape[0],a.shape[1],a.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");E(u.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${u.rank}.`),E(l.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),E(c.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),E(c.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${c.shape[0]}.`),E(c.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${c.shape[1]}.`);const h=l.shape[2],f=l.shape[3];E(c.shape[2]===h*f,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${h*f}, but got ${c.shape[2]}.`);const p=UE(u,l,s,r,o,i),g=Rc(p,c,1,"valid",o);return d?W(g,[g.shape[1],g.shape[2],g.shape[3]]):g}const pj=H({separableConv2d_:pae});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mae(t){const n={x:R(t,"x","sign")};return V.runKernel(bm,n)}const gae=H({sign_:mae});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yae(t){const n={x:R(t,"x","sin","float32")};return V.runKernel(ym,n)}const mj=H({sin_:yae});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xae(t){const n={x:R(t,"x","sinh")};return V.runKernel(xm,n)}const gj=H({sinh_:xae});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bae(t,e,n){const s=R(t,"x","slice1d");return E(s.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${s.rank} tensor`),wt(s,[e],[n])}const aI=H({slice1d_:bae});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vae(t,e,n){const s=R(t,"x","slice2d");return E(s.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${s.rank} tensor`),wt(s,e,n)}const yj=H({slice2d_:vae});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wae(t,e,n){const s=R(t,"x","slice3d");return E(s.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${s.rank} tensor`),wt(s,e,n)}const lI=H({slice3d_:wae});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sae(t,e,n){const s=R(t,"x","slice4d");return E(s.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${s.rank} tensor`),wt(s,e,n)}const M0=H({slice4d_:Sae});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kae(t,e=-1){const n=R(t,"logits","softmax","float32");if(e===-1&&(e=n.rank-1),e!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${e}`);const s={logits:n},r={dim:e};return V.runKernel(wv,s,r)}const cI=H({softmax_:kae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cae(t){E(t.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${t.dtype}.`);const e={input:t};return V.runKernel(hE,e)}const xj=H({fft_:Cae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nae(t){E(t.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${t.dtype}.`);const e={input:t};return V.runKernel(mE,e)}const uC=H({ifft_:Nae});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tae(t){const e=t.shape[t.shape.length-1],n=t.size/e;let s;if(e<=2){const r=W(t,[n,e]);s=uC(r)}else{const r=[n,2*(e-1)],i=W(O0(t),[n,e]),o=W(GE(t),[n,e]),a=Oc(wt(i,[0,1],[n,e-2]),1),l=B(Oc(wt(o,[0,1],[n,e-2]),1),lt(-1)),c=Ls([i,a],1),u=Ls([o,l],1),d=W(Tc(c,u),[r[0],r[1]]);s=uC(d)}if(s=O0(s),t.rank===3&&t.shape[0]!==0){const r=s,i=t.shape[0];s=W(s,[i,s.shape[0]/i,s.shape[1]]),r.dispose()}return s}const Eae=H({irfft_:Tae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Iae(t,e,n=0){const r={x:R(t,"x","split")},i={numOrSizeSplits:e,axis:n};return V.runKernel(vv,r,i)}const wr=H({split_:Iae});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Aae(t,e){E(t.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${t.dtype}`);let n=t.shape[t.shape.length-1];const s=t.size/n;let r;if(e!=null&&e<n){const p=t.shape.map(g=>0),m=t.shape.map(g=>g);m[t.shape.length-1]=e,r=wt(t,p,m),n=e}else if(e!=null&&e>n){const p=t.shape.map(m=>m);p[t.shape.length-1]=e-n,r=Ls([t,An(p)],t.shape.length-1),n=e}else r=t;const i=st(r),o=W(Tc(r,i),[s,n]),a=xj(o),l=Math.floor(n/2)+1,c=O0(a),u=GE(a),d=wr(c,[l,n-l],c.shape.length-1),h=wr(u,[l,n-l],u.shape.length-1),f=r.shape.slice();return f[r.shape.length-1]=l,W(Tc(d[0],h[0]),f)}const $ae=H({rfft_:Aae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rae(t,e){let n=R(t,"a","squaredDifference"),s=R(e,"b","squaredDifference");[n,s]=tn(n,s),_e(n.shape,s.shape);const r={a:n,b:s},i={};return V.runKernel(km,r,i)}const Dae=H({squaredDifference_:Rae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oae(t,e){const n=R(t,"x","squeeze","string_or_numeric");return W(n,bl(n.shape,e).newShape)}const Dm=H({squeeze_:Oae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mae(t,e=0){const n=_B(t,"tensors","stack","string_or_numeric");E(n.length>=1,()=>"Pass at least one tensor to tf.stack"),n.length>0&&E(e<=n[0].rank,()=>"Axis must be <= rank of the tensor");const s=n,r={axis:e};return V.runKernel(lv,s,r)}const sa=H({stack_:Mae});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pae(t,e=0){const s={x:R(t,"x","step")},r={alpha:e};return V.runKernel(Im,s,r)}const Om=H({step_:Pae});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lae(t,e,n,s,r=0,i=0,o=0,a=0,l=0){const u={x:R(t,"x","stridedSlice","string_or_numeric")},d={begin:e,end:n,strides:s,beginMask:r,endMask:i,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:l};return V.runKernel(AE,u,d)}const Fae=H({stridedSlice_:Lae});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _ae(t){const n={x:R(t,"x","tan","float32")};return V.runKernel(Nm,n)}const zae=H({tan_:_ae});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tr(t,e){Wz(t);const n=Tv(t,e);if(n.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Ev(t,null,n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ww(t,e,n){if(Wz(t),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const s=Tv(t,n);if(s.length!==2&&s.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Ev(t,e,s,n)}function bj(t,e,n){const s=e.rank>1?e.shape[e.rank-1]:1,r=e.rank>1?e.rank-1:1,i=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${e.shape}, shape: ${t}, sliceDim: ${s}, and batchDim: ${r}.`;if(n.rank<r)throw new Error(i+` update.rank < ${r}. `);if(t.length<s+(n.rank-r))throw new Error(i+` Output shape length < ${s+(n.rank-r)}`);if(n.rank!==r+t.length-s)throw new Error(i+` update.rank != ${r+t.length-s}`);for(let o=0;o<r;++o)if(n.shape[o]!==e.shape[o])throw new Error(i+` updates.shape[${o}] (${n.shape[o]}) != indices.shape[${o}] (${e.shape[o]}).`);for(let o=0;o<n.rank-r;++o)if(n.shape[o+r]!==t[o+s])throw new Error(i+` updates.shape[${o+r}] (${n.shape[o+r]}) != shape[${o+r}] (${t[o+r]})`)}function Bae(t,e,n){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(t.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${t.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(n.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(t.size===0)throw new Error(`Updates specified for empty output. updates shape: ${t.shape}`)}bj(n,e,t)}function eu(t,e,n){const s=e.shape.length,r=s>1?e.shape[s-1]:1,i=n.length;let o=1;for(let d=r;d<i;++d)o*=n[d];const a=r<1?1:r,l=Q(e.shape)/a,c=[...ke(n.slice(0,r)),1],u=Q(n);return{sliceRank:r,numUpdates:l,sliceSize:o,strides:c,outputSize:u}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jae(t,e=1,n=!0){const s=R(t,"x","topk");if(s.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const r=s.shape[s.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>r)throw new Error(`'k' passed to topk() must be <= the last dimension (${r}) but got ${e}`);const i={x:s},o={k:e,sorted:n},[a,l]=V.runKernel($E,i,o);return{values:a,indices:l}}const Vae=H({topk_:jae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uae(t,e=0,n=1,s,r){if(aa(t),s!=null&&s==="bool")throw new Error("Unsupported data type $ { dtype }");const i=new cj(e,n,s,!0,r),o=He(t,s);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const vj=H({truncatedNormal_:Uae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wae(t,e=0){const n=R(t,"x","unique","string_or_numeric");E(n.rank>0,()=>"The input tensor must be at least 1D");const s={x:n},r={axis:e},[i,o]=V.runKernel(DE,s,r);return{values:i,indices:o}}const Hae=H({unique_:Wae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gae(t,e,n){const s=R(t,"x","unsortedSegmentSum"),r=R(e,"segmentIds","unsortedSegmentSum","int32");E(wd(n),()=>"numSegments must be of dtype int");const i={x:s,segmentIds:r},o={numSegments:n};return V.runKernel(kv,i,o)}const wj=H({unsortedSegmentSum_:Gae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kae(t,e=0){const n=R(t,"x","unstack","string_or_numeric");E(e>=-n.shape.length&&e<n.shape.length,()=>`Axis = ${e} is not in [-${n.shape.length}, ${n.shape.length})`);const s={value:n},r={axis:e};return V.runKernel(Sv,s,r)}const Mc=H({unstack_:Kae});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qae(t,e=!0,n,s){return V.makeVariable(t,e,n,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sj(t,e){const n=[];for(let i=0;i<e.length;i++)e[i]&&n.push(i);const s=He(t,"int32"),r=He([n.length,t.length],"int32");for(let i=0;i<n.length;i++){const o=s.indexToLoc(n[i]),a=i*t.length;r.values.set(o,a)}return r.toTensor()}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xae(t,e,n){const s=R(t,"x","transpose");if(e==null&&(e=s.shape.map((o,a)=>a).reverse()),E(s.rank===e.length,()=>`Error in transpose: rank of input ${s.rank} must match length of perm ${e}.`),e.forEach(o=>{E(o>=0&&o<s.rank,()=>`All entries in 'perm' must be between 0 and ${s.rank-1} but got ${e}`)}),s.rank<=1)return s.clone();const r={x:s},i={perm:e};return s.dtype==="complex64"?q(()=>{let o=O0(s),a=GE(s);return o=V.runKernel(nd,{x:o},i),a=V.runKernel(nd,{x:a},i),n&&(a=en(a)),Tc(o,a)}):V.runKernel(nd,r,i)}const nt=H({transpose_:Xae});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jae(t,e){if(e==null)return t.shape.slice();if(ct(t.shape,e))return e;if(t.shape.length===e.length){const n=[];for(let s=0;s<t.shape.length;s++)e[s]==null&&t.shape[s]!=null?n.push(t.shape[s]):n.push(e[s]);return n}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yae(t,e,n,s){const r=R(t,"x","dropout");if(E(r.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${r.dtype} tensor instead.`),E(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return t instanceof pn?r.clone():r;const i=Jae(r,n),o=1-e,a=Ie(Ov(ie(Rm(i,0,1,"float32",s),o)),o);return B(r,a)}const Qae=H({dropout_:Yae});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zae(t,e,n,s,r,i="NHWC",o){let a=t;t.rank===3&&(a=W(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=e;l.rank===3&&(l=W(e,[1,e.shape[0],e.shape[1],e.shape[2]])),E(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),E(l.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`),E(n.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`);const c=i==="NHWC"?a.shape[3]:a.shape[1],u=i==="NHWC"?l.shape[3]:l.shape[1];E(c===n[2],()=>`Error in conv2dDerFilter: depth of input ${c}) must match input depth in filter (${n[2]}.`),E(u===n[3],()=>`Error in conv2dDerFilter: depth of dy (${u}) must match output depth for filter (${n[3]}).`),Ks("conv2dDerFilter",r,o);const d={x:a,dy:l},h={strides:s,pad:r,dataFormat:i,dimRoundingMode:o,filterShape:n};return V.runKernel(tE,d,h)}const uI=H({conv2DBackpropFilter_:Zae});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dI(t,e,n){if(n==null||n==="linear")return t;if(n==="relu")return B(t,Om(e));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function hI(t,e){let n=e;const s=kn(t.shape,e.shape);return s.length>0&&(n=Ce(n,s)),W(n,t.shape)}function fI(t,e,n,s){if(e==="linear")return t;if(e==="relu")return Zc(t);if(e==="elu")return Rv(t);if(e==="relu6")return uj(t);if(e==="prelu")return ZE(t,n);if(e==="leakyrelu")return KE(t,s);if(e==="sigmoid")return Xd(t);throw new Error(`Unknown fused activation ${e}.`)}const pI=(t,e)=>!(t>0)||e==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ele({x:t,filter:e,strides:n,pad:s,dataFormat:r="NHWC",dilations:i=[1,1],dimRoundingMode:o,bias:a,activation:l="linear",preluActivationWeights:c,leakyreluAlpha:u}){if(l=l||"linear",pI(V.state.gradientDepth,l)===!1){E(r==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${r} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let k=Rc(t,e,n,s,r,i,o);return a!=null&&(k=ie(k,a)),fI(k,l,c,u)}const d=R(t,"x","conv2d","float32"),h=R(e,"filter","conv2d","float32");let f=d,p=!1;d.rank===3&&(p=!0,f=W(d,[1,d.shape[0],d.shape[1],d.shape[2]])),E(f.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${f.rank}.`),E(h.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${h.rank}.`),Ks("fused conv2d",s,o);const m=r==="NHWC"?f.shape[3]:f.shape[1];E(h.shape[2]===m,()=>`Error in conv2d: depth of input (${m}) must match input depth for filter ${h.shape[2]}.`),E(is(n,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${i}'`);const g=Wn(f.shape,h.shape,n,i,s,o);let y;a!=null&&(y=R(a,"bias","fused conv2d"),[y]=tn(y,d),r==="NHWC"?_e(g.outShape,y.shape):(E(y.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${y.shape.length}.`),E(y.shape.length===0||y.shape[0]===g.outChannels||y.shape[0]===1,()=>`Error in fused conv2d: bias shape (${y.shape}) is not compatible with the number of output channels (${g.outChannels})`)));let x;if(c!=null){const k=c.shape;if(E(k.length<=1||k.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${k.length}.`),k.length===1)E(k[0]===1||k[0]===g.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${k}) is not compatible with the number of output channels (${g.outChannels}).`);else if(k.length===3)try{_e(k,g.outShape)}catch{const N=`Error in fused conv2d: PReLU activation weights (${k}) is not compatible with the output shape of the conv2d (${g.outShape}).`;throw Error(N)}x=R(c,"prelu weights","fused conv2d")}const v=(k,C)=>{E(r==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${r} but only NHWC is currently supported.`);const[N,T,I,D]=C,F=dI(k,I,l);E(Ac(i),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`);const A=jE(T.shape,F,N,n,s),O=uI(T,F,N.shape,n,s),P=[A,O];if(D!=null){const L=hI(D,F);P.push(L)}return P},w={x:f,filter:h,bias:y,preluActivationWeights:x},S={strides:n,pad:s,dataFormat:r,dilations:i,dimRoundingMode:o,activation:l,leakyreluAlpha:u};return a==null?Td((C,N,T)=>{let I=V.runKernel(N0,w,S);return T([N,C,I]),p&&(I=W(I,[I.shape[1],I.shape[2],I.shape[3]])),{value:I,gradFunc:v}})(f,h):Td((C,N,T,I)=>{let D=V.runKernel(N0,w,S);return I([N,C,D,T]),p&&(D=W(D,[D.shape[1],D.shape[2],D.shape[3]])),{value:D,gradFunc:v}})(f,h,y)}const tle=H({fusedConv2d_:ele});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nle(t,e,n,s,r,i=[1,1],o){let a=t;t.rank===3&&(a=W(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=e;l.rank===3&&(l=W(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={x:a,dy:l},u={strides:s,pad:r,dimRoundingMode:o,dilations:i,filterShape:n};return V.runKernel(lE,c,u)}const sle=H({depthwiseConv2dNativeBackpropFilter_:nle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rle(t,e,n,s,r,i=[1,1],o){let a=e,l=!1;e.rank===3&&(l=!0,a=W(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={dy:a,filter:n},u={strides:s,pad:r,dimRoundingMode:o,dilations:i,inputShape:t},d=V.runKernel(cE,c,u);return l?W(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const ile=H({depthwiseConv2dNativeBackpropInput_:rle});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ole({a:t,b:e,transposeA:n=!1,transposeB:s=!1,bias:r,activation:i="linear",preluActivationWeights:o,leakyreluAlpha:a=.2}){if(pI(V.state.gradientDepth,i)===!1){let D=at(t,e,n,s);return r!=null&&(D=ie(D,r)),fI(D,i,o,a)}let l=R(t,"a","fused matMul"),c=R(e,"b","fused matMul");[l,c]=tn(l,c);const u=n?l.shape[l.rank-2]:l.shape[l.rank-1],d=s?c.shape[c.rank-1]:c.shape[c.rank-2],h=n?l.shape[l.rank-1]:l.shape[l.rank-2],f=s?c.shape[c.rank-2]:c.shape[c.rank-1],p=l.shape.slice(0,-2),m=c.shape.slice(0,-2),g=Q(p),y=Q(m);E(u===d,()=>`Error in fused matMul: inner shapes (${u}) and (${d}) of Tensors with shapes ${l.shape} and ${c.shape} and transposeA=${n} and transposeB=${s} must match.`);const v=_e(l.shape.slice(0,-2),c.shape.slice(0,-2)).concat([h,f]),w=n?W(l,[g,u,h]):W(l,[g,h,u]),S=s?W(c,[y,f,d]):W(c,[y,d,f]);let k;r!=null&&(k=R(r,"bias","fused matMul"),[k]=tn(k,l),_e(v,k.shape));let C;o!=null&&(C=R(o,"prelu weights","fused matMul"));const N=(D,F)=>{const[A,O,P,L]=F,G=dI(W(D,P.shape),P,i);let $,U;if(!n&&!s?($=at(G,O,!1,!0),U=at(A,G,!0,!1)):!n&&s?($=at(G,O,!1,!1),U=at(G,A,!0,!1)):n&&!s?($=at(O,G,!1,!0),U=at(A,G,!1,!1)):($=at(O,G,!0,!0),U=at(G,A,!0,!0)),r!=null){const K=hI(L,G);return[$,U,K]}else return[$,U]},T={a:w,b:S,bias:k,preluActivationWeights:C},I={transposeA:n,transposeB:s,activation:i,leakyreluAlpha:a};return r==null?Td((F,A,O)=>{const P=V.runKernel(C0,T,I);return O([F,A,P]),{value:W(P,v),gradFunc:N}})(w,S):Td((F,A,O,P)=>{const L=V.runKernel(C0,T,I);return P([F,A,L,O]),{value:W(L,v),gradFunc:N}})(w,S,k)}const aO=H({fusedMatMul_:ole});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ale(t,e,n,s,r="bilinear",i=0){const o=R(t,"image","cropAndResize"),a=R(e,"boxes","cropAndResize","float32"),l=R(n,"boxInd","cropAndResize","int32"),c=a.shape[0];E(o.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${o.rank}.`),E(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${c},4] but had shape ${a.shape}.`),E(l.rank===1&&l.shape[0]===c,()=>`Error in cropAndResize: boxInd must be have size [${c}] but had shape ${a.shape}.`),E(s.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${s.length}.`),E(s[0]>=1&&s[1]>=1,()=>`cropSize must be atleast [1,1], but was ${s}`),E(r==="bilinear"||r==="nearest",()=>`method must be bilinear or nearest, but was ${r}`);const u={image:o,boxes:a,boxInd:l},d={method:r,extrapolationValue:i,cropSize:s};return V.runKernel(iE,u,d)}const lle=H({cropAndResize_:ale});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cle(t){const e=R(t,"image","flipLeftRight","float32");E(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);const n={image:e};return V.runKernel(pE,n,{})}const ule=H({flipLeftRight_:cle});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dle(t){const e=R(t,"image","grayscaleToRGB"),n=e.rank-1,s=e.shape[n];E(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),E(s===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${s}.`);const r=new Array(e.rank);return r.fill(1,0,n),r[n]=3,Si(e,r)}const hle=H({grayscaleToRGB_:dle});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fle(t){const e=R(t,"image","RGBToGrayscale"),n=e.rank-1,s=e.shape[n];E(e.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${e.rank}.`),E(s===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${s}.`);const r=e.dtype,i=fe(e,"float32"),o=tr([.2989,.587,.114]);let a;switch(e.rank){case 2:a=Th("ij,j->i",i,o);break;case 3:a=Th("ijk,k->ij",i,o);break;case 4:a=Th("ijkl,l->ijk",i,o);break;case 5:a=Th("ijklm,m->ijkl",i,o);break;case 6:a=Th("ijklmn,n->ijklm",i,o);break;default:throw new Error("Not a valid tensor rank.")}return a=Ds(a,-1),fe(a,r)}const ple=H({rgbToGrayscale_:fle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mle(t,e,n=0,s=.5){const r=R(t,"image","rotateWithOffset","float32");E(r.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${r.rank}.`);const i={image:r},o={radians:e,fillValue:n,center:s};return V.runKernel(OE,i,o)}const gle=H({rotateWithOffset_:mle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yd(t,e,n,s,r,i){s==null&&(s=.5),r==null&&(r=Number.NEGATIVE_INFINITY),i==null&&(i=0);const o=t.shape[0];return n=Math.min(n,o),E(0<=s&&s<=1,()=>`iouThreshold must be in [0, 1], but was '${s}'`),E(t.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${t.rank}'`),E(t.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${t.shape[1]}`),E(e.rank===1,()=>"scores must be a 1D tensor"),E(e.shape[0]===o,()=>`scores has incompatible shape with boxes. Expected ${o}, but was ${e.shape[0]}`),E(0<=i&&i<=1,()=>`softNmsSigma must be in [0, 1], but was '${i}'`),{maxOutputSize:n,iouThreshold:s,scoreThreshold:r,softNmsSigma:i}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yle(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY){const i=R(t,"boxes","nonMaxSuppression","float32"),o=R(e,"scores","nonMaxSuppression","float32"),a=Yd(i,o,n,s,r);n=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const l={maxOutputSize:n,iouThreshold:s,scoreThreshold:r};return V.runKernel(vE,{boxes:i,scores:o},l)}const xle=H({nonMaxSuppression_:yle});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ble(t,e,n){const s=vle(t,e,n),r=s<0?-(s+1):s;t.splice(r,0,e)}function vle(t,e,n){return Sle(t,e,n||wle)}function wle(t,e){return t>e?1:t<e?-1:0}function Sle(t,e,n){let s=0,r=t.length,i=0,o=!1;for(;s<r;){i=s+(r-s>>>1);const a=n(e,t[i]);a>0?s=i+1:(r=i,o=!a)}return o?s:-s-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mI(t,e,n,s,r){return xI(t,e,n,s,r,0)}function gI(t,e,n,s,r,i){return xI(t,e,n,s,r,0,!1,i,!0)}function yI(t,e,n,s,r,i){return xI(t,e,n,s,r,i,!0)}function xI(t,e,n,s,r,i,o=!1,a=!1,l=!1){const c=[];for(let g=0;g<e.length;g++)e[g]>r&&c.push({score:e[g],boxIndex:g,suppressBeginIndex:0});c.sort(lO);const u=i>0?-.5/i:0,d=[],h=[];for(;d.length<n&&c.length>0;){const g=c.pop(),{score:y,boxIndex:x,suppressBeginIndex:v}=g;if(y<r)break;let w=!1;for(let S=d.length-1;S>=v;--S){const k=kle(t,x,d[S]);if(k>=s){w=!0;break}if(g.score=g.score*Cle(s,u,k),g.score<=r)break}g.suppressBeginIndex=d.length,w||(g.score===y?(d.push(x),h.push(g.score)):g.score>r&&ble(c,g,lO))}const f=d.length,p=n-f;a&&p>0&&(d.push(...new Array(p).fill(0)),h.push(...new Array(p).fill(0)));const m={selectedIndices:d};return o&&(m.selectedScores=h),l&&(m.validOutputs=f),m}function kle(t,e,n){const s=t.subarray(e*4,e*4+4),r=t.subarray(n*4,n*4+4),i=Math.min(s[0],s[2]),o=Math.min(s[1],s[3]),a=Math.max(s[0],s[2]),l=Math.max(s[1],s[3]),c=Math.min(r[0],r[2]),u=Math.min(r[1],r[3]),d=Math.max(r[0],r[2]),h=Math.max(r[1],r[3]),f=(a-i)*(l-o),p=(d-c)*(h-u);if(f<=0||p<=0)return 0;const m=Math.max(i,c),g=Math.max(o,u),y=Math.min(a,d),x=Math.min(l,h),v=Math.max(y-m,0)*Math.max(x-g,0);return v/(f+p-v)}function Cle(t,e,n){const s=Math.exp(e*n*n);return n<=t?s:0}function lO(t,e){return t.score-e.score||t.score===e.score&&e.boxIndex-t.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Nle(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY){const i=R(t,"boxes","nonMaxSuppressionAsync"),o=R(e,"scores","nonMaxSuppressionAsync"),a=Yd(i,o,n,s,r);n=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const l=await Promise.all([i.data(),o.data()]),c=l[0],u=l[1],{selectedIndices:d}=mI(c,u,n,s,r);return i!==t&&i.dispose(),o!==e&&o.dispose(),tr(d,"int32")}const Tle=Nle;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ele(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY,i=0){const o=R(t,"boxes","nonMaxSuppression"),a=R(e,"scores","nonMaxSuppression"),l=Yd(o,a,n,s,r,i);n=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold,i=l.softNmsSigma;const c={boxes:o,scores:a},u={maxOutputSize:n,iouThreshold:s,scoreThreshold:r,softNmsSigma:i},d=V.runKernel(SE,c,u);return{selectedIndices:d[0],selectedScores:d[1]}}const Ile=H({nonMaxSuppressionWithScore_:Ele});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Ale(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY,i=0){const o=R(t,"boxes","nonMaxSuppressionAsync"),a=R(e,"scores","nonMaxSuppressionAsync"),l=Yd(o,a,n,s,r,i);n=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold,i=l.softNmsSigma;const c=await Promise.all([o.data(),a.data()]),u=c[0],d=c[1],{selectedIndices:h,selectedScores:f}=yI(u,d,n,s,r,i);return o!==t&&o.dispose(),a!==e&&a.dispose(),{selectedIndices:tr(h,"int32"),selectedScores:tr(f)}}const $le=Ale;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rle(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY,i=!1){const o=R(t,"boxes","nonMaxSuppression"),a=R(e,"scores","nonMaxSuppression"),l=Yd(o,a,n,s,r,null),c=l.maxOutputSize,u=l.iouThreshold,d=l.scoreThreshold,h={boxes:o,scores:a},f={maxOutputSize:c,iouThreshold:u,scoreThreshold:d,padToMaxOutputSize:i},p=V.runKernel(wE,h,f);return{selectedIndices:p[0],validOutputs:p[1]}}const Dle=H({nonMaxSuppressionPadded_:Rle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Ole(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY,i=!1){const o=R(t,"boxes","nonMaxSuppressionAsync"),a=R(e,"scores","nonMaxSuppressionAsync"),l=Yd(o,a,n,s,r,null),c=l.maxOutputSize,u=l.iouThreshold,d=l.scoreThreshold,[h,f]=await Promise.all([o.data(),a.data()]),{selectedIndices:p,validOutputs:m}=gI(h,f,c,u,d,i);return o!==t&&o.dispose(),a!==e&&a.dispose(),{selectedIndices:tr(p,"int32"),validOutputs:lt(m,"int32")}}const Mle=Ole;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ple(t,e,n=!1,s=!1){const r=R(t,"images","resizeBilinear");E(r.rank===3||r.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${r.rank}.`),E(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),E(s===!1||n===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let i=r,o=!1;r.rank===3&&(o=!0,i=W(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:i},l={alignCorners:n,halfPixelCenters:s,size:e},c=V.runKernel(pv,a,l);return o?W(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const kj=H({resizeBilinear_:Ple});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lle(t,e,n=!1,s=!1){const r=R(t,"images","resizeNearestNeighbor");E(r.rank===3||r.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${r.rank}.`),E(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),E(r.dtype==="float32"||r.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),E(s===!1||n===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let i=r,o=!1;r.rank===3&&(o=!0,i=W(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:i},l={alignCorners:n,halfPixelCenters:s,size:e},c=V.runKernel(fv,a,l);return o?W(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const Cj=H({resizeNearestNeighbor_:Lle});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fle(t,e="binary",n=!1,s=.5){const r=R(t,"image","threshold"),i=.2989,o=.587,a=.114,l=r.shape[0]*r.shape[1];let c=B(tr([s]),255),u,d,h,f;if(E(r.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${r.rank}.`),E(r.shape[2]===3||r.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${r.shape[2]}.`),E(r.dtype==="int32"||r.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${r.dtype}.`),E(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),r.shape[2]===3){[u,d,h]=wr(r,[1,1,1],-1);const g=B(u,i),y=B(d,o),x=B(h,a);f=ie(ie(g,y),x)}else f=t;if(e==="otsu"){const g=Lre(fe(dj(f),"int32"),pf([]),256);c=_le(g,l)}const p=n?Jd(f,c):Ir(f,c);return fe(B(p,255),"int32")}function _le(t,e){let n=tr([-1]),s=tr([0]),r=tr([0]),i,o,a,l,c,u;for(let d=0;d<t.size-1;d++){i=wt(t,0,d+1),o=wt(t,d+1),c=Ie(Ce(i),e),u=Ie(Ce(o),e);const h=Ce(B(i,ep(0,i.size)));a=Ie(h,Ce(i));const f=$v(o.shape,i.size),p=ie(ep(0,o.size),f),m=B(o,p);l=Ie(Ce(m),Ce(o));const g=De(a,l),y=De(a,l),x=B(c,u);r=B(B(x,g),y);const v=Ir(r,s);s=ws(v,r,s),n=ws(v,tr([d]),n)}return n}const zle=H({threshold_:Fle});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ble(t,e,n="nearest",s="constant",r=0,i){const o=R(t,"image","transform","float32"),a=R(e,"transforms","transform","float32");E(o.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${o.rank}.`),E(a.rank===2&&(a.shape[0]===o.shape[0]||a.shape[0]===1)&&a.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),E(i==null||i.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${i}.`);const l={image:o,transforms:a},c={interpolation:n,fillMode:s,fillValue:r,outputShape:i};return V.runKernel(RE,l,c)}const jle=H({transform_:Ble});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vle(t,e,n){const s=R(t,"a","bandPart");E(s.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${s.rank}.`);const r=s.shape,[i,o]=s.shape.slice(-2);let a,l;typeof e=="number"?(E(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),E(e<=i,()=>`bandPart(): numLower (${e}) must not be greater than the number of rows (${i}).`),a=R(e<0?i:e,"numLower","bandPart")):(E(e.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),a=ws(R0(e,0),i,Zf(e,i))),typeof n=="number"?(E(n%1===0,()=>`bandPart(): numUpper must be an integer, got ${n}.`),E(n<=o,()=>`bandPart(): numUpper (${n}) must not be greater than the number of columns (${o}).`),l=R(n<0?o:n,"numUpper","bandPart")):(E(n.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),l=ws(R0(n,0),o,Zf(n,o)));const c=W(ep(0,i,1,"int32"),[-1,1]),u=ep(0,o,1,"int32"),d=De(c,u),h=na(Jd(d,a),Yc(d,en(l))),f=An([i,o],s.dtype);return W(sa(Mc(W(s,[-1,i,o])).map(p=>ws(h,p,f))),r)}const Ule=H({bandPart_:Vle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wle(t){let e;if(Array.isArray(t)){e=!1,E(t!=null&&t.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const r=t[0].shape[0];for(let i=1;i<t.length;++i)E(t[i].shape[0]===r,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${t[i].shape[0]} vs. ${r})`)}else e=!0,t=wr(t,t.shape[0],0).map(r=>Dm(r,[0]));E(t.length<=t[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${t.length}) exceeds number of dimensions (${t[0].shape[0]}).`);const n=[],s=t;for(let r=0;r<t.length;++r)n.push(V.tidy(()=>{let i=s[r];if(r>0)for(let o=0;o<r;++o){const a=B(Ce(B(n[o],i)),n[o]);i=De(i,a)}return Ie(i,Dv(i,"euclidean"))}));return e?sa(n,0):n}const Hle=H({gramSchmidt_:Wle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gle(t,e=!1){if(E(t.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${t.rank}`),t.rank===2)return cO(t,e);{const n=t.shape.slice(0,t.shape.length-2).reduce((l,c)=>l*c),s=Mc(W(t,[n,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),r=[],i=[];s.forEach(l=>{const[c,u]=cO(l,e);r.push(c),i.push(u)});const o=W(sa(r,0),t.shape),a=W(sa(i,0),t.shape);return[o,a]}}function cO(t,e=!1){return V.tidy(()=>{E(t.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${t.shape.length}D Tensor.`);const n=t.shape[0],s=t.shape[1];let r=nj(n),i=uc(t);const o=ww([[1]],[1,1]);let a=uc(o);const l=n>=s?s:n;for(let c=0;c<l;++c){const u=i,d=a,h=r;[a,i,r]=V.tidy(()=>{const f=wt(i,[c,c],[n-c,1]),p=Dv(f),m=wt(i,[c,c],[1,1]),g=ws(Ir(m,0),ww([[-1]]),ww([[1]])),y=De(m,B(g,p)),x=Ie(f,y);x.shape[0]===1?a=uc(o):a=Ls([o,wt(x,[1,0],[x.shape[0]-1,x.shape[1]])],0);const v=en(Ie(at(g,y),p)),w=wt(i,[c,0],[n-c,s]),S=B(v,a),k=nt(a);if(c===0)i=De(w,at(S,at(k,w)));else{const T=De(w,at(S,at(k,w)));i=Ls([wt(i,[0,0],[c,s]),T],0)}const C=nt(S),N=wt(r,[0,c],[n,r.shape[1]-c]);if(c===0)r=De(N,at(at(N,a),C));else{const T=De(N,at(at(N,a),C));r=Ls([wt(r,[0,0],[n,c]),T],1)}return[a,i,r]}),Ve([u,d,h])}return!e&&n>s&&(r=wt(r,[0,0],[n,s]),i=wt(i,[0,0],[s,s])),[r,i]})}const Kle=H({qr_:Gle});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uo={flipLeftRight:ule,grayscaleToRGB:hle,resizeNearestNeighbor:Cj,resizeBilinear:kj,rgbToGrayscale:ple,rotateWithOffset:gle,cropAndResize:lle,nonMaxSuppression:xle,nonMaxSuppressionAsync:Tle,nonMaxSuppressionWithScore:Ile,nonMaxSuppressionWithScoreAsync:$le,nonMaxSuppressionPadded:Dle,nonMaxSuppressionPaddedAsync:Mle,threshold:zle,transform:jle},qle={bandPart:Ule,gramSchmidt:Hle,qr:Kle};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xle=new Map,Jle=new Map;class Qd{getClassName(){return this.constructor.className}static fromConfig(e,n){return new e(n)}}class Wr{constructor(){this.classNameMap={}}static getMap(){return Wr.instance==null&&(Wr.instance=new Wr),Wr.instance}static register(e){Wr.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function ne(t,e,n){E(t.className!=null,()=>"Class being registered does not have the static className property defined."),E(typeof t.className=="string",()=>"className is required to be a string, but got type "+typeof t.className),E(t.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof e>"u"&&(e="Custom"),typeof n>"u"&&(n=t.className);const s=n,r=e+">"+s;return Wr.register(t),Xle.set(r,t),Jle.set(t,r),t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Tl extends Qd{minimize(e,n=!1,s){const{value:r,grads:i}=this.computeGradients(e,s);if(s!=null){const o=s.map(a=>({name:a.name,tensor:i[a.name]}));this.applyGradients(o)}else this.applyGradients(i);return Ve(i),n?r:(r.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,n){return soe(e,n)}dispose(){this.iterations_!=null&&Ve(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:lt(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(Tl,Symbol.hasInstance,{value:t=>t.minimize!=null&&t.computeGradients!=null&&t.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Nj extends Tl{static get className(){return"Adadelta"}constructor(e,n,s=null){super(),this.learningRate=e,this.rho=n,this.epsilon=s,this.accumulatedGrads=[],this.accumulatedUpdates=[],s==null&&(this.epsilon=V.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=V.registeredVariables[s],o=!1;this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accum_grad`,variable:q(()=>st(i).variable(o))}),this.accumulatedUpdates[r]==null&&(this.accumulatedUpdates[r]={originalName:`${s}/accum_var`,variable:q(()=>st(i).variable(o))});const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const l=this.accumulatedGrads[r].variable,c=this.accumulatedUpdates[r].variable;q(()=>{const u=ie(B(l,this.rho),B(Tt(a),1-this.rho)),d=B(Ie(rs(ie(c,this.epsilon)),rs(ie(l,this.epsilon))),a),h=ie(B(c,this.rho),B(Tt(d),1-this.rho));l.assign(u),c.assign(h);const f=ie(B(d,-this.learningRate),i);i.assign(f)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(Ve(this.accumulatedGrads.map(e=>e.variable)),Ve(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=e.length/2,s=!1;this.accumulatedGrads=e.slice(0,n).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedUpdates=e.slice(n,n*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,n){return new e(n.learningRate,n.rho,n.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Tj extends Tl{static get className(){return"Adagrad"}constructor(e,n=.1){super(),this.learningRate=e,this.initialAccumulatorValue=n,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=V.registeredVariables[s];this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accumulator`,variable:q(()=>$v(i.shape,this.initialAccumulatorValue).variable(!1))});const o=Array.isArray(e)?e[r].tensor:e[s];if(o==null)return;const a=this.accumulatedGrads[r].variable;q(()=>{const l=ie(a,Tt(o));a.assign(l);const c=ie(B(Ie(o,rs(ie(l,V.backend.epsilon()))),-this.learningRate),i);i.assign(c)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&Ve(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=!1;this.accumulatedGrads=e.map(s=>({originalName:s.name,variable:s.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,n){return new e(n.learningRate,n.initialAccumulatorValue)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ej extends Tl{static get className(){return"Adam"}constructor(e,n,s,r=null){super(),this.learningRate=e,this.beta1=n,this.beta2=s,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],q(()=>{this.accBeta1=lt(n).variable(),this.accBeta2=lt(s).variable()}),r==null&&(this.epsilon=V.backend.epsilon())}applyGradients(e){const n=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);q(()=>{const s=De(1,this.accBeta1),r=De(1,this.accBeta2);n.forEach((i,o)=>{const a=V.registeredVariables[i],l=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${i}/m`,variable:q(()=>st(a).variable(l))}),this.accumulatedSecondMoment[o]==null&&(this.accumulatedSecondMoment[o]={originalName:`${i}/v`,variable:q(()=>st(a).variable(l))});const c=Array.isArray(e)?e[o].tensor:e[i];if(c==null)return;const u=this.accumulatedFirstMoment[o].variable,d=this.accumulatedSecondMoment[o].variable,h=ie(B(u,this.beta1),B(c,1-this.beta1)),f=ie(B(d,this.beta2),B(Tt(c),1-this.beta2)),p=Ie(h,s),m=Ie(f,r);u.assign(h),d.assign(f);const g=ie(B(Ie(p,ie(rs(m),this.epsilon)),-this.learningRate),a);a.assign(g)}),this.accBeta1.assign(B(this.accBeta1,this.beta1)),this.accBeta2.assign(B(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Ve(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&Ve(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e),q(()=>{this.accBeta1.assign(Dc(this.beta1,this.iterations_+1)),this.accBeta2.assign(Dc(this.beta2,this.iterations_+1))});const n=e.length/2,s=!1;this.accumulatedFirstMoment=e.slice(0,n).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedSecondMoment=e.slice(n,n*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,n){return new e(n.learningRate,n.beta1,n.beta2,n.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ij extends Tl{static get className(){return"Adamax"}constructor(e,n,s,r=null,i=0){super(),this.learningRate=e,this.beta1=n,this.beta2=s,this.epsilon=r,this.decay=i,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],q(()=>{this.iteration=lt(0).variable(),this.accBeta1=lt(n).variable()}),r==null&&(this.epsilon=V.backend.epsilon())}applyGradients(e){const n=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);q(()=>{const s=De(1,this.accBeta1),r=Ie(-this.learningRate,ie(B(this.iteration,this.decay),1));n.forEach((i,o)=>{const a=V.registeredVariables[i],l=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${i}/m`,variable:st(a).variable(l)}),this.accumulatedWeightedInfNorm[o]==null&&(this.accumulatedWeightedInfNorm[o]={originalName:`${i}/v`,variable:st(a).variable(l)});const c=Array.isArray(e)?e[o].tensor:e[i];if(c==null)return;const u=this.accumulatedFirstMoment[o].variable,d=this.accumulatedWeightedInfNorm[o].variable,h=ie(B(u,this.beta1),B(c,1-this.beta1)),f=B(d,this.beta2),p=ps(c),m=Cl(f,p);u.assign(h),d.assign(m);const g=ie(B(Ie(r,s),Ie(h,ie(m,this.epsilon))),a);a.assign(g)}),this.iteration.assign(ie(this.iteration,1)),this.accBeta1.assign(B(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Ve(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&Ve(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,n){return new e(n.learningRate,n.beta1,n.beta2,n.epsilon,n.decay)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bI extends Tl{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=Array.isArray(e)?e[r].tensor:e[s];if(i==null)return;const o=V.registeredVariables[s];q(()=>{const a=ie(B(this.c,i),o);o.assign(a)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=ao(lt(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,n){return new e(n.learningRate)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Aj extends bI{static get className(){return"Momentum"}constructor(e,n,s=!1){super(e),this.learningRate=e,this.momentum=n,this.useNesterov=s,this.accumulations=[],this.m=lt(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=V.registeredVariables[s];this.accumulations[r]==null&&(this.accumulations[r]={originalName:`${s}/momentum`,variable:q(()=>st(i).variable(!1))});const o=this.accumulations[r].variable,a=Array.isArray(e)?e[r].tensor:e[s];a!=null&&q(()=>{let l;const c=ie(B(this.m,o),a);this.useNesterov?l=ie(B(this.c,ie(a,B(c,this.m))),i):l=ie(B(this.c,c),i),o.assign(c),i.assign(l)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&Ve(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=!1;this.accumulations=e.map(s=>({originalName:s.name,variable:s.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,n){return new e(n.learningRate,n.momentum,n.useNesterov)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $j extends Tl{static get className(){return"RMSProp"}constructor(e,n=.9,s=0,r=null,i=!1){if(super(),this.learningRate=e,this.decay=n,this.momentum=s,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=i,r==null&&(this.epsilon=V.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const i=V.registeredVariables[s],o=!1;this.accumulatedMeanSquares[r]==null&&(this.accumulatedMeanSquares[r]={originalName:`${s}/rms`,variable:q(()=>st(i).variable(o))}),this.accumulatedMoments[r]==null&&(this.accumulatedMoments[r]={originalName:`${s}/momentum`,variable:q(()=>st(i).variable(o))}),this.accumulatedMeanGrads[r]==null&&this.centered&&(this.accumulatedMeanGrads[r]={originalName:`${s}/mg`,variable:q(()=>st(i).variable(o))});const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const l=this.accumulatedMeanSquares[r].variable,c=this.accumulatedMoments[r].variable;q(()=>{const u=ie(B(l,this.decay),B(Tt(a),1-this.decay));if(this.centered){const d=this.accumulatedMeanGrads[r].variable,h=ie(B(d,this.decay),B(a,1-this.decay)),f=Ie(B(a,this.learningRate),rs(De(u,ie(Tt(h),this.epsilon)))),p=ie(B(c,this.momentum),f);l.assign(u),d.assign(h),c.assign(p);const m=De(i,p);i.assign(m)}else{const d=ie(B(l,this.decay),B(Tt(a),1-this.decay)),h=ie(B(c,this.momentum),Ie(B(a,this.learningRate),rs(ie(d,this.epsilon))));l.assign(d),c.assign(h);const f=De(i,h);i.assign(f)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&Ve(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&Ve(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&Ve(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=this.centered?e.length/3:e.length/2,s=!1;this.accumulatedMeanSquares=e.slice(0,n).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedMoments=e.slice(n,n*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.centered&&(this.accumulatedMeanGrads=e.slice(n*2,n*3).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,n){return new e(n.learningRate,n.decay,n.momentum,n.epsilon,n.centered)}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yle=[Nj,Tj,Ej,Ij,Aj,$j,bI];function Qle(){for(const t of Yle)ne(t)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uO(t,e,n,s){o(t),n=n??0,s=s??1,a(n,s);let r=0;const i=l=>(l.then(c=>{const u=n+ ++r/t.length*(s-n);return e(u),c}),l);function o(l){E(l!=null&&Array.isArray(l)&&l.length>0,()=>"promises must be a none empty array")}function a(l,c){E(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${l}`),E(c>=0&&c<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${c}`),E(c>=l,()=>`startFraction must be no more than endFraction, but got startFraction ${l} and endFraction ${c}`)}return Promise.all(t.map(i))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function Zle(t,e){e==null&&(e={});const n=e.fetchFunc==null?X().platform.fetch:e.fetchFunc,s=t.map(d=>n(d,e.requestInit,{isBinary:!0})),r=0,i=.5,a=(e.onProgress==null?await Promise.all(s):await uO(s,e.onProgress,r,i)).map(d=>d.arrayBuffer()),l=.5,c=1;return e.onProgress==null?await Promise.all(a):await uO(a,e.onProgress,l,c)}function ece(t,e){var n;const s=e.fetchFunc==null?X().platform.fetch:e.fetchFunc;let r=0,i;return(n=e.onProgress)===null||n===void 0||n.call(e,0),new ReadableStream({pull:async o=>{for(var a;r<t.length;){i||(i=(await s(t[r],e.requestInit,{isBinary:!0})).body.getReader());const{done:l,value:c}=await i.read();if(l){r++,i=void 0,(a=e.onProgress)===null||a===void 0||a.call(e,r/t.length);continue}o.enqueue(c);return}o.close()}})}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tce="application/octet-stream",nce="application/json";class vI{constructor(e,n){if(this.DEFAULT_METHOD="POST",n==null&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.weightUrlConverter=n.weightUrlConverter,n.fetchFunc!=null?(E(typeof n.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=n.fetchFunc):this.fetch=X().platform.fetch,E(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&E(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,n.requestInit!=null&&n.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{},this.loadOptions=n}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);n.body=new FormData;const s=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r=gse(e,s);if(n.body.append("model.json",new Blob([JSON.stringify(r)],{type:nce}),"model.json"),e.weightData!=null){const o=wl.join(e.weightData);n.body.append("model.weights.bin",new Blob([o],{type:tce}),"model.weights.bin")}const i=await this.fetch(this.path,n);if(i.ok)return{modelArtifactsInfo:FE(e),responses:[i]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${i.status}.`)}async loadModelJSON(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let n;try{n=await e.json()}catch{let o=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?o+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":o+=" Please make sure the server is serving valid JSON for this request.",new Error(o)}const s=n.modelTopology,r=n.weightsManifest;if(s==null&&r==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return n}async load(){if(this.loadOptions.streamWeights)return this.loadStream();const e=await this.loadModelJSON();return xse(e,n=>this.loadWeights(n))}async loadStream(){const e=await this.loadModelJSON(),n=await this.getWeightUrls(e.weightsManifest),s=rO(e.weightsManifest),r=()=>ece(n,this.loadOptions);return Object.assign(Object.assign({},e),{weightSpecs:s,getWeightStream:r})}async getWeightUrls(e){const n=Array.isArray(this.path)?this.path[1]:this.path,[s,r]=sce(n),i=this.weightPathPrefix||s,o=[],a=[];for(const l of e)for(const c of l.paths)this.weightUrlConverter!=null?a.push(this.weightUrlConverter(c)):o.push(i+c+r);return this.weightUrlConverter&&o.push(...await Promise.all(a)),o}async loadWeights(e){const n=await this.getWeightUrls(e),s=rO(e),r=await Zle(n,this.loadOptions);return[s,r]}}vI.URL_SCHEME_REGEX=/^https?:\/\//;function sce(t){const e=t.lastIndexOf("/"),n=t.lastIndexOf("?"),s=t.substring(0,e),r=n>e?t.substring(n):"";return[s+"/",r]}function dO(t){return t.match(vI.URL_SCHEME_REGEX)!=null}const Rj=(t,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let n=!0;if(Array.isArray(t)?n=t.every(s=>dO(s)):n=dO(t),n)return Dj(t,e)}return null};Tn.registerSaveRouter(Rj);Tn.registerLoadRouter(Rj);function Dj(t,e){return new vI(t,e)}function rce(t,e){return Dj(t,e)}function wI(t,e){const n=t.shape.length,s=e.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(s<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${s}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[s-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[s-1]} vs. ${n}`);if(Q(t.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${t.shape}.`);const r=e.shape,i=r[r.length-1];let o=1;for(let d=0;d<r.length-1;++d)o*=r[d];const a=t.shape,l=r.slice();l.pop();let c=1;for(let d=i;d<n;++d)c*=a[d],l.push(a[d]);const u=[...ke(t.shape).map(d=>d/c),1].slice(0,i);return[l,o,c,u]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dC=-2,ice=-1;function SI(t,e,n){const s=t.shape.length;E(s===e.length,()=>`Error in slice${s}D: Length of begin ${e} must match the rank of the array (${s}).`),E(s===n.length,()=>`Error in slice${s}D: Length of size ${n} must match the rank of the array (${s}).`);for(let r=0;r<s;++r)E(e[r]+n[r]<=t.shape[r],()=>`Error in slice${s}D: begin[${r}] + size[${r}] (${e[r]+n[r]}) would overflow input.shape[${r}] (${t.shape[r]})`)}function oce(t){const e=[];let n=0;for(;t>0;)t&1&&e.push(n),t/=2,n++;return e}function kI(t,e,n){const s=[];for(let r=0;r<t.length;r++)s[r]=Math.ceil((e[r]-t[r])/n[r]);return s}function Oj(t,e,n,s){const r=[...t];for(let i=r.length;i<s.length;i++)r.push(1);for(let i=0;i<n;i++)i===0?r[e]=1:(r.splice(e,0,1),r.pop());return r}function Mj(t,e,n){return n<=t?n:n-(e-1)}function Pj(t,e){const n=[];for(let s=0;s<t;s++)n.push(e+s);return n}function ace(t,e,n,s,r,i,o,a,l){const c=t.length;let u=new Array(c),d=new Array(c),h=new Array(c);if(e.length&&n>0){const f=e[0],p=n+1;u=Lj(o,f,p,s,t),d=Fj(a,f,p,r,t),h=Oj(i,f,p,t)}else for(let f=0;f<c;f++)u[f]=zj(o,s,i,t,f,l),d[f]=Bj(a,r,i,t,f,l),h[f]=_j(i,f,l);return{begin:u,end:d,strides:h}}function Lj(t,e,n,s,r){const i=[...r],o=Pj(n,e);for(let a=0;a<i.length;a++)if(o.indexOf(a)>-1)i[a]=0;else{const l=Mj(e,n,a);let c=s[l];t&1<<l&&(c=0),i[a]=c}return i}function Fj(t,e,n,s,r){const i=[...r],o=Pj(n,e);for(let a=0;a<i.length;a++)if(o.indexOf(a)>-1)i[a]=Number.MAX_SAFE_INTEGER;else{const l=Mj(e,n,a);let c=s[l];t&1<<l&&(c=Number.MAX_SAFE_INTEGER),i[a]=c}for(let a=0;a<i.length;a++){const l=r[a];i[a]<0&&(i[a]+=l),i[a]=Cc(0,i[a],r[a])}return i}function _j(t,e,n){let s=t[e];return(n&1<<e||s==null)&&(s=1),s}function zj(t,e,n,s,r,i){let o=e[r];const a=n[r]||1;(t&1<<r||i&1<<r||o==null)&&(a>0?o=Number.MIN_SAFE_INTEGER:o=Number.MAX_SAFE_INTEGER);const l=s[r];return o<0&&(o+=l),o=Cc(0,o,l-1),o}function Bj(t,e,n,s,r,i){let o=e[r];const a=n[r]||1;(t&1<<r||i&1<<r||o==null)&&(a>0?o=Number.MAX_SAFE_INTEGER:o=Number.MIN_SAFE_INTEGER);const l=s[r];return o<0&&(o+=l),a>0?o=Cc(0,o,l):o=Cc(-1,o,l-1),o}function CI(t,e,n){let s=n.length;for(let r=0;r<n.length;r++)if(n[r]>1){s=r;break}for(let r=s+1;r<n.length;r++)if(e[r]>0||n[r]!==t[r])return!1;return!0}function NI(t,e){let n=t.length>0?t[t.length-1]:1;for(let s=0;s<t.length-1;s++)n+=t[s]*e[s];return n}function Mv(t,e,n){let s;const r=t.shape.length;typeof e=="number"?s=[e,...new Array(r-1).fill(0)]:e.length<r?s=e.concat(new Array(r-e.length).fill(0)):s=e.slice(),s.forEach(o=>{E(o!==-1,()=>"slice() does not support negative begin indexing.")});let i;return n==null?i=new Array(r).fill(-1):typeof n=="number"?i=[n,...new Array(r-1).fill(-1)]:n.length<r?i=n.concat(new Array(r-n.length).fill(-1)):i=n,i=i.map((o,a)=>o>=0?o:(E(o===-1,()=>`Negative size values should be exactly -1 but got ${o} for the slice() size at index ${a}.`),t.shape[a]-s[a])),[s,i]}function TI(t,e,n,s,r,i,o,a,l){let c;if(s==null?(c=new Array(e.length),c.fill(1)):c=s,o!=null&&o&o-1)throw new Error("Multiple ellipses in slice is not allowed.");let u=!1;const d={dims:c.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:n.slice(),strides:c.slice(),beginMask:r,endMask:i,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:l};for(let v=0;v<d.dims;v++)u&&1<<v&a&&d.numAddAxisAfterEllipsis++,1<<v&o&&(u=!0);u||(d.ellipsisMask|=1<<d.dims,d.dims++);const h={dims:t.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};lce(d,h);let f=!0,p=!0,m=!0;const g=[],y=[];for(let v=0;v<t.length;++v){if(h.strides[v]===0)throw Error(`strides[${v}] must be non-zero`);const w=!!(h.shrinkAxisMask&1<<v),S=t[v];if(S===-1){g.push(w?1:-1);continue}const k=[h.beginMask&1<<v,h.endMask&1<<v],C=[h.strides[v]>0?0:-1,h.strides[v]>0?S:S-1];if(w&&h.strides[v]<=0)throw Error("only stride 1 allowed on non-range indexing.");m=m&&h.strides[v]===1;const N=!!(h.beginMask&1<<v&&h.endMask&1<<v);if(h.beginValid&&h.endValid){if(w){const F=h.begin[v]<0?S+h.begin[v]:h.begin[v];if(h.begin[v]=F,h.end[v]=h.begin[v]+1,F<0||F>=S)throw Error(`slice index ${h.begin[v]} of dimension ${v} out of bounds.`)}else h.begin[v]=hO(h.begin[v],0,h.strides[v],S,k,C),h.end[v]=hO(h.end[v],1,h.strides[v],S,k,C);const D=h.strides[v]===1&&h.begin[v]===0&&h.end[v]===S;f=f&&D,p=p&&(v===0&&h.strides[v]===1||D)}else f=f&&h.strides[v]===1&&N,p=p&&(v===0&&h.strides[v]===1||N);let T,I=!1;if(h.beginValid&&h.endValid?(T=h.end[v]-h.begin[v],I=!0):w?(T=1,I=!0):N&&S>=0&&(h.strides[v]<0?T=-S:T=S,I=!0),I){let D;T===0||T<0!=h.strides[v]<0?D=0:D=Math.trunc(T/h.strides[v])+(T%h.strides[v]!==0?1:0),g.push(D)}else g.push(-1)}for(let v=0;v<h.finalShapeGatherIndices.length;++v){const w=h.finalShapeGatherIndices[v];w>=0?y.push(g[w]):w===dC&&y.push(1)}return{finalShapeSparse:y.filter((v,w)=>h.finalShapeGatherIndices[w]!==dC),finalShape:y,isIdentity:f,sliceDim0:p,isSimpleSlice:m,begin:h.begin,end:h.end,strides:h.strides}}function lce(t,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let n=0;e.beginValid=t.begin!=null,e.endValid=t.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let s=0;s<t.dims;s++)if(1<<s&t.ellipsisMask){const r=Math.min(e.dims-(t.dims-s)+1+t.numAddAxisAfterEllipsis,e.dims);for(;n<r;n++)e.begin[n]=0,e.end[n]=0,e.strides[n]=1,e.beginMask|=1<<n,e.endMask|=1<<n,e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[n]=s}else if(1<<s&t.newAxisMask)e.finalShapeGatherIndices.push(dC),e.finalShapeGatherIndicesSparse.push(-1);else{if(n===e.begin.length)throw Error(`Index out of range using input dim ${n}; input has only ${e.dims} dims, ${e.begin.length}.`);t.begin!=null&&(e.begin[n]=t.begin[s]),t.end!=null&&(e.end[n]=t.end[s]),e.strides[n]=t.strides[s],t.beginMask&1<<s&&(e.beginMask|=1<<n),t.endMask&1<<s&&(e.endMask|=1<<n),t.shrinkAxisMask&1<<s?(e.finalShapeGatherIndices.push(ice),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<n):(e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(s)),e.inputShapeGatherIndicesSparse[n]=s,n++}}function hO(t,e,n,s,r,i){if(r[e])return n>0?i[e]:i[e+1&1];{const o=t<0?s+t:t;return o<i[0]?i[0]:o>i[1]?i[1]:o}}const cce=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:SI,computeFlatOffset:NI,computeOutShape:kI,getNormalizedAxes:ace,isSliceContinous:CI,maskToAxes:oce,parseSliceParams:Mv,sliceInfo:TI,startForAxis:zj,startIndicesWithElidedDims:Lj,stopForAxis:Bj,stopIndicesWithElidedDims:Fj,stridesForAxis:_j,stridesWithElidedDims:Oj},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uce{static sgd(e){return new bI(e)}static momentum(e,n,s=!1){return new Aj(e,n,s)}static rmsprop(e,n=.9,s=0,r=null,i=!1){return new $j(e,n,s,r,i)}static adam(e=.001,n=.9,s=.999,r=null){return new Ej(e,n,s,r)}static adadelta(e=.001,n=.95,s=null){return new Nj(e,n,s)}static adamax(e=.002,n=.9,s=.999,r=null,i=0){return new Ij(e,n,s,r,i)}static adagrad(e,n=.1){return new Tj(e,n)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xu=uce;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dce=(()=>typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:t=>t())();function jj(){return new Promise(t=>dce(()=>t()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EI(t,e){const n=t[0].length;t.forEach((r,i)=>{E(r.length===n,()=>`Error in concat${n}D: rank of tensors[${i}] must be the same as the rank of the rest (${n})`)}),E(e>=0&&e<n,()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`);const s=t[0];t.forEach((r,i)=>{for(let o=0;o<n;o++)E(o===e||r[o]===s[o],()=>`Error in concat${n}D: Shape of tensors[${i}] (${r}) does not match the shape of the rest (${s}) along the non-concatenated axis ${i}.`)})}function lo(t,e){const n=t[0].slice();for(let s=1;s<t.length;s++)n[e]+=t[s][e];return n}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var vi;(function(t){t[t.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",t[t.VALUE_ROWIDS=1]="VALUE_ROWIDS",t[t.ROW_LENGTHS=2]="ROW_LENGTHS",t[t.ROW_SPLITS=3]="ROW_SPLITS",t[t.ROW_LIMITS=4]="ROW_LIMITS",t[t.ROW_STARTS=5]="ROW_STARTS"})(vi||(vi={}));function Vj(t,e,n){let s=new Array;if(n==null&&e==null)return s;if(e==null)for(;s.length<t+n.length;)s.push(-1);else s=e.slice();if(n==null)return s;if(t+n.length!==s.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${t+n.length}, but shape.rank = ${s.length}`);for(let r=1;r<n.length;++r){const i=n[r],o=s[s.length-n.length+r],a=s[o];if(i>=0)if(a>=0){if(a!==i)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${r+t}] = ${i} but shape[${r+t}] = ${a}`)}else s[o]=i}return s}function Uj(t){const e={FIRST_DIM_SIZE:vi.FIRST_DIM_SIZE,VALUE_ROWIDS:vi.VALUE_ROWIDS,ROW_LENGTHS:vi.ROW_LENGTHS,ROW_SPLITS:vi.ROW_SPLITS,ROW_LIMITS:vi.ROW_LIMITS,ROW_STARTS:vi.ROW_STARTS},n=[];for(const s of t)if(s in e)n.push(e[s]);else break;return n}function Wj(t){return t.length===0?0:t[0]===vi.FIRST_DIM_SIZE?t.length-1:t.length}function Hj(t,e){if(t==null||e==null)return;const n=t.length,s=e.length;if(n>=s)throw new Error(`defaultValue.shape=${t} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${n} must be less than ragged tensor input flatValues.rank = ${s})`);for(let r=0;r<Math.min(n,s-1);++r){const i=t[r],o=e[r+1];if(i>=0&&o>=0&&i!==1&&i!==o)throw new Error(`defaultValue.shape=${t}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${r-t.length}] = ${i} but ragged tensor input.flatValues.shape[${r-t.length}] = ${o}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const II=30;function Pv(t){return t<=II?t:Kk(t,Math.floor(Math.sqrt(t)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AI(t,e,n){const s=n*(typeof t=="number"?t:t[0]),r=e*(typeof t=="number"?t:t[1]);return[s,r]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mm(t,e,n,s=!0){let r=[];if(s)r=r.concat(e.slice(0)),r.push(t[0]/n),r=r.concat(t.slice(1));else{r=r.concat(t[0]);const i=e.length;for(let o=0;o<i;++o)r=r.concat([t[o+1]/e[o],e[o]]);r=r.concat(t.slice(i+1))}return r}function Pm(t,e,n=!0){const s=[];if(n){s.push(e);for(let r=e+1;r<t;++r)r<=2*e?(s.push(r),s.push(r-(e+1))):s.push(r)}else{const r=[],i=[];for(let o=1;o<t;++o)o>=e*2+1||o%2===1?i.push(o):r.push(o);s.push(...r),s.push(0),s.push(...i)}return s}function Lm(t,e,n,s=!0){const r=[];s?r.push(t[0]/n):r.push(t[0]*n);for(let i=1;i<t.length;++i)i<=e.length?s?r.push(e[i-1]*t[i]):r.push(t[i]/e[i-1]):r.push(t[i]);return r}function $I(t,e){const n=[0];for(let s=0;s<e;++s)n.push(t[s][0]);return n}function RI(t,e,n){const s=t.slice(0,1);for(let r=0;r<n;++r)s.push(t[r+1]-e[r][0]-e[r][1]);return s}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lv=1.7580993408473768,Fv=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DI=.3275911,OI=.254829592,MI=-.284496736,PI=1.421413741,LI=-1.453152027,FI=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ra(t,e){if(t.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${t.length}, imag: ${e.length}.`);const n=new Float32Array(t.length*2);for(let s=0;s<n.length;s+=2)n[s]=t[s/2],n[s+1]=e[s/2];return n}function Gj(t){const e=new Float32Array(t.length/2),n=new Float32Array(t.length/2);for(let s=0;s<t.length;s+=2)e[s/2]=t[s],n[s/2]=t[s+1];return{real:e,imag:n}}function Kj(t){const e=Math.ceil(t.length/4),n=new Float32Array(e),s=new Float32Array(e);for(let r=0;r<t.length;r+=4)n[Math.floor(r/4)]=t[r],s[Math.floor(r/4)]=t[r+1];return{real:n,imag:s}}function qj(t){const e=Math.floor(t.length/4),n=new Float32Array(e),s=new Float32Array(e);for(let r=2;r<t.length;r+=4)n[Math.floor(r/4)]=t[r],s[Math.floor(r/4)]=t[r+1];return{real:n,imag:s}}function _I(t,e){const n=t[e*2],s=t[e*2+1];return{real:n,imag:s}}function Xj(t,e,n,s){t[s*2]=e,t[s*2+1]=n}function Jj(t,e){const n=new Float32Array(t/2),s=new Float32Array(t/2);for(let r=0;r<Math.ceil(t/2);r++){const i=(e?2:-2)*Math.PI*(r/t);n[r]=Math.cos(i),s[r]=Math.sin(i)}return{real:n,imag:s}}function Yj(t,e,n){const s=(n?2:-2)*Math.PI*(t/e),r=Math.cos(s),i=Math.sin(s);return{real:r,imag:i}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sw="->",hce=/->/g,fO=",",pO="...";function zI(t,e){t=t.replace(/\s/g,"");const n=(t.length-t.replace(hce,"").length)/Sw.length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error(`Equation must contain exactly one arrow ("${Sw}").`);const[s,r]=t.split(Sw);E(s.indexOf(pO)===-1,()=>`The ellipsis notation ("${pO}") is not supported yet.`);const i=s.split(fO),o=i.length;if(e!==o)throw new Error(`Expected ${o} input tensors, received ${e}`);if(o>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let h=0;h<r.length;++h){const f=r[h];if(!i.some(p=>p.indexOf(f)!==-1))throw new Error(`Output subscripts contain the label ${f} not present in the input subscripts.`);a.indexOf(f)===-1&&a.push(f)}for(let h=0;h<s.length;++h){const f=s[h];a.indexOf(f)===-1&&f!==fO&&a.push(f)}const l=new Array(i.length);for(let h=0;h<o;++h){if(new Set(i[h].split("")).size!==i[h].length)throw new Error(`Found duplicate axes in input component ${i[h]}. Support for duplicate axes in input is not implemented yet.`);l[h]=[];for(let f=0;f<i[h].length;++f)l[h].push(a.indexOf(i[h][f]))}const c=a.length,u=r.length,d=[];for(let h=u;h<c;++h)d.push(h);return{allDims:a,summedDims:d,idDims:l}}function BI(t,e){let n=new Array(t);n.fill(-1);for(let r=0;r<e.length;++r)n[e[r]]=r;const s=[];for(let r=0;r<t;++r)n[r]===-1&&s.push(r);return n=n.filter(r=>r!==-1),{permutationIndices:n,expandDims:s}}function jI(t,e,n){const s=new Array(t);for(let r=0;r<n.length;++r){const i=n[r].shape;for(let o=0;o<e[r].length;++o)s[e[r][o]]===void 0?s[e[r][o]]=i[o]:E(s[e[r][o]]===i[o],()=>`Expected dimension ${s[e[r][o]]} at axis ${o} of input shaped ${JSON.stringify(i)}, but got dimension ${i[o]}`)}}function VI(t,e){const n=t,s=[];let r=0;t.length===0&&n.push(-1),r=t.length+1;for(let o=0;o<r;++o)s.push([]);const i=[];for(let o=0;o<n.length;++o){const a=n[o],l=fce(e,a);for(const c of l)i.indexOf(c)===-1&&(s[o].push(c),i.push(c))}return{path:n,steps:s}}function UI(t){return t.every((e,n)=>e===n)}function fce(t,e){const n=[];for(let s=0;s<t.length;++s)(t[s].length===0||t[s].indexOf(e)!==-1||e===-1)&&n.push(s);return n}function WI(t,e,n=0){let s=[];if(typeof e=="number")E(t.shape[n]%e===0,()=>"Number of splits must evenly divide the axis."),s=new Array(e).fill(t.shape[n]/e);else{const r=e.reduce((o,a)=>(a===-1&&(o+=1),o),0);E(r<=1,()=>"There should be only one negative value in split array.");const i=e.indexOf(-1);if(i!==-1){const o=e.reduce((a,l)=>l>0?a+l:a);e[i]=t.shape[n]-o}E(t.shape[n]===e.reduce((o,a)=>o+a),()=>"The sum of sizes must match the size of the axis dimension."),s=e}return s}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qj(t){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${t}`}function Zj(t,e){return`indices(${t}, 0) is invalid: ${e} < 0`}function eV(t,e,n){return`indices(${t}, 0) is invalid: ${e} >= ${n}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tV(t,e){return`only one output dimension may be -1, not both ${t} and ${e}`}function nV(t,e){return`size ${t} must be non-negative, not ${e}`}function sV(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function rV(t,e){const n=Q(t),s=Q(e);return`Input to reshape is a SparseTensor with ${n}
  dense values, but the requested shape requires a multiple of ${s}. inputShape=${t} outputShape= ${e}`}function iV(t,e){const n=Q(t),s=Q(e);return`Input to reshape is a tensor with ${n} dense values, but the requested shape has ${s}. inputShape=${t} outputShape=${e}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hC(){return"segment ids must be >= 0"}function oV(){return"segment ids are not increasing"}function aV(t,e){return`Segment id ${t} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function lV(t,e,n){return`Bad: indices[${t}] == ${e} out of range [0, ${n})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cV(t,e){let n=!1,s;for(t<=II?(s=t,n=!0):s=Kk(t,Math.floor(Math.sqrt(t)));!n;)s>e||s===t?n=!0:s=Kk(t,s+1);return s}function uV(t,e,n){const s=[],r=t.length;for(let i=0;i<r;i++)i!==e?s.push(t[i]):s.push(n);return s}function HI(t,e,n,s){const r=e.shape.length,i=t.shape.length;if(s!==0&&(s<-r||s>r))throw new Error(`Expect batchDims in the range of [-${r}, ${r}], but got ${s}`);if(s<0&&(s+=r),s>i)throw new Error(`batchDims (${s}) must be less than rank(x) (
    ${i}).`);if(n<s)throw new Error(`batchDims (${s}) must be less than or equal to axis (${n}).`);for(let d=0;d<s;++d)if(t.shape[d]!==e.shape[d])throw new Error(`x.shape[${d}]: ${t.shape[d]} should be equal to indices.shape[${d}]: ${e.shape[d]}.`);const o=t.shape[n],a=[];let l=1,c=1,u=1;for(let d=0;d<s;++d)a.push(t.shape[d]),l*=t.shape[d];for(let d=s;d<n;d++)a.push(t.shape[d]),c*=t.shape[d];for(let d=s;d<r;d++)a.push(e.shape[d]);for(let d=n+1;d<i;d++)a.push(t.shape[d]),u*=t.shape[d];return{batchSize:l,sliceSize:u,outerSize:c,dimSize:o,outputShape:a}}const pce=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:HI,computeOutShape:uV,segOpComputeOptimalWindowSize:cV},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ia(t){try{return t.map(e=>ol(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function dV(t){return t.map(e=>Xa(e))}const mce=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:OI,ERF_A2:MI,ERF_A3:PI,ERF_A4:LI,ERF_A5:FI,ERF_P:DI,PARALLELIZE_THRESHOLD:II,get RowPartitionType(){return vi},SELU_SCALE:Fv,SELU_SCALEALPHA:Lv,applyActivation:fI,assertAndGetBroadcastShape:_e,assertAxesAreInnerMostDims:Hn,assertParamsConsistent:EI,assignToTypedArray:Xj,axesAreInnerMostDims:WE,calculateShapes:eu,checkEinsumDimSizes:jI,checkPadOnDimRoundingMode:Ks,combineLocations:ej,combineRaggedTensorToTensorShapes:Vj,complexWithEvenIndex:Kj,complexWithOddIndex:qj,computeConv2DInfo:Wn,computeConv3DInfo:Sl,computeDefaultPad:_E,computeDilation2DInfo:Am,computeOptimalWindowSize:Pv,computeOutAndReduceShapes:Dn,computeOutShape:lo,computePool2DInfo:ai,computePool3DInfo:la,convertConv2DDataFormat:ca,decodeEinsumEquation:zI,eitherStridesOrDilationsAreOne:is,expandShapeToKeepDim:cn,exponent:Yj,exponents:Jj,fromStringArrayToUint8:dV,fromUint8ToStringArray:ia,getAxesPermutation:Bt,getBroadcastDims:Nd,getComplexWithIndex:_I,getEinsumComputePath:VI,getEinsumPermutation:BI,getFusedBiasGradient:hI,getFusedDyActivation:dI,getImageCenter:AI,getInnerMostAxes:nn,getPermuted:Pm,getRaggedRank:Wj,getReductionAxes:kn,getReshaped:Mm,getReshapedPermuted:Lm,getRowPartitionTypesHelper:Uj,getSliceBeginCoords:$I,getSliceSize:RI,getSparseFillEmptyRowsIndicesDenseShapeMismatch:Qj,getSparseFillEmptyRowsNegativeIndexErrorMessage:Zj,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:eV,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:sV,getSparseReshapeInputOutputMismatchErrorMessage:iV,getSparseReshapeInputOutputMultipleErrorMessage:rV,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:tV,getSparseReshapeNegativeOutputDimErrorMessage:nV,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:lV,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:hC,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:oV,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:aV,getUndoAxesPermutation:kl,isIdentityPermutation:UI,log:Pne,mergeRealAndImagArrays:ra,prepareAndValidate:wI,prepareSplitSize:WI,segment_util:pce,shouldFuse:pI,slice_util:cce,splitRealAndImagArrays:Gj,stridesOrDilationsArePositive:$c,tupleValuesAreOne:Ac,upcastType:lr,validateDefaultValueShape:Hj,validateInput:Bae,validateUpdateShape:bj,warn:gr},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Qle();/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hV={kernelName:Nb,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>B(t,Om(fe(n,"float32"),-1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gce={kernelName:Mp,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const s=Tt(fe(n,"float32")),r=rs(De(lt(1),s));return en(Ie(t,r))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yce={kernelName:Pp,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const s=rs(De(Tt(fe(n,"float32")),1));return Ie(t,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xce={kernelName:qd,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=_e(n.shape,s.shape);return{a:()=>{let a=t;const l=kn(n.shape,r);return l.length>0&&(a=Ce(a,l)),W(a,n.shape)},b:()=>{let a=t;const l=kn(s.shape,r);return l.length>0&&(a=Ce(a,l)),W(a,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bce={kernelName:KT,saveAllInputs:!0,gradFunc:(t,e)=>{const n={};return e.forEach((s,r)=>{n[r]=()=>t.clone()}),n}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vce={kernelName:Tb,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>st(n)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wce={kernelName:Eb,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>st(n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sce={kernelName:Lp,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Ie(t,rs(De(lt(1),Tt(fe(n,"float32")))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kce={kernelName:Fp,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const s=rs(ie(lt(1),Tt(fe(n,"float32"))));return Ie(t,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cce={kernelName:Bp,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=_e(n.shape,s.shape);return{a:()=>{const a=ie(Tt(n),Tt(s));let l=B(t,Ie(s,a));const c=kn(n.shape,r);return c.length>0&&(l=Ce(l,c)),W(l,n.shape)},b:()=>{const a=ie(Tt(n),Tt(s));let l=en(B(t,Ie(n,a)));const c=kn(s.shape,r);return c.length>0&&(l=Ce(l,c)),W(l,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nce={kernelName:_p,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Ie(t,ie(Tt(fe(n,"float32")),1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tce={kernelName:zp,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Ie(t,De(lt(1),Tt(fe(n,"float32"))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ece(t,e,n,s,r,i){const o=R(t,"dy","avgPool3dGrad"),a=R(e,"input","avgPool3dGrad");let l=o,c=a,u=!1;a.rank===4&&(u=!0,l=W(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),c=W(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),E(l.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),E(c.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${c.rank}.`),Ks("avgPool3dGrad",r,i);const d={dy:l,input:c},h={filterSize:n,strides:s,pad:r,dimRoundingMode:i},f=V.runKernel(YT,d,h);return u?W(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const Ice=H({avgPool3dGrad_:Ece});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ace={kernelName:Ab,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{filterSize:r,strides:i,pad:o,dimRoundingMode:a}=n;return{x:()=>Ice(t,s,r,i,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $ce(t,e,n,s,r){const i=R(t,"dy","avgPoolGrad"),o=R(e,"input","avgPoolGrad");E(o.rank===i.rank,()=>`Rank of input (${o.rank}) does not match rank of dy (${i.rank})`);let a=o,l=i,c=!1;o.rank===3&&(c=!0,a=W(o,[1,o.shape[0],o.shape[1],o.shape[2]]),l=W(i,[1,i.shape[0],i.shape[1],i.shape[2]])),E(l.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),E(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);const u={dy:l,input:a},d={filterSize:n,strides:s,pad:r},h=V.runKernel(JT,u,d);return c?W(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const Rce=H({avgPoolGrad_:$ce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dce={kernelName:Ib,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{filterSize:r,strides:i,pad:o}=n;return{x:()=>Rce(t,s,r,i,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oce={kernelName:$b,inputsToSave:["a","b"],gradFunc:(t,e,n)=>{const[s,r]=e,{transposeA:i,transposeB:o}=n;return!i&&!o?{a:()=>at(t,r,!1,!0),b:()=>at(s,t,!0,!1)}:!i&&o?{a:()=>at(t,r,!1,!1),b:()=>at(t,s,!0,!1)}:i&&!o?{a:()=>at(r,t,!1,!0),b:()=>at(s,t,!1,!1)}:{a:()=>at(r,t,!0,!0),b:()=>at(t,s,!0,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mce={kernelName:Rb,gradFunc:(t,e,n)=>{const{blockShape:s,crops:r}=n;return{x:()=>QE(t,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pce={kernelName:Rne,gradFunc:(t,e,n)=>{const s=n,r=s.inputShape,i=s.shape,o=Array.from(i);for(let l=r.length-1;l>=0;l--)if(r[l]===i[l])o[l]=1;else if(r[l]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${i}].`);const a=[];for(let l=0;l<o.length;l++)o[l]>1&&a.push(l);return{x:()=>Ce(t,a,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lce={kernelName:jp,gradFunc:t=>({x:()=>t.clone()})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fce={kernelName:Vp,gradFunc:t=>({x:()=>st(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _ce={kernelName:Up,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{clipValueMin:r,clipValueMax:i}=n;return{x:()=>ws(na(Yc(s,r),Jd(s,i)),t,st(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zce={kernelName:Db,inputsToSave:["x"],gradFunc:hV.gradFunc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bce={kernelName:Ob,saveAllInputs:!0,gradFunc:(t,e,n)=>{const s=e.map(l=>l.shape),{axis:r}=n,i=Ge(r,e[0].shape)[0],o=s.map(l=>l[i]);return wr(t,o,i).map(l=>()=>l)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jce={kernelName:Mb,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const[s,r]=e,{dilations:i,strides:o,pad:a,dataFormat:l}=n;return E(Ac(i),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`),{x:()=>jE(s.shape,t,r,o,a,l),filter:()=>uI(s,t,r.shape,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vce={kernelName:Pb,inputsToSave:["dy","filter"],gradFunc:(t,e,n)=>{const[s,r]=e,{strides:i,pad:o,dataFormat:a,dimRoundingMode:l}=n;return{dy:()=>Rc(t,r,i,o,a,1,l),filter:()=>uI(t,s,r.shape,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uce(t,e,n,s,r){let i=t;t.rank===4&&(i=W(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]));let o=e;o.rank===4&&(o=W(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),E(i.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${i.shape}.`),E(o.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${o.shape}.`),E(n.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${n}.`),E(i.shape[4]===n[3],()=>`Error in conv3dDerFilter: depth of input ${i.shape[4]}) must match input depth in filter (${n[3]}.`),E(o.shape[4]===n[4],()=>`Error in conv3dDerFilter: depth of dy (${o.shape[4]}) must match output depth for filter (${n[4]}).`);const a={x:i,dy:o},l={strides:s,pad:r,filterShape:n};return V.runKernel(nE,a,l)}const Wce=H({conv3DBackpropFilter_:Uce});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hce={kernelName:Lb,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const{dilations:s,strides:r,pad:i}=n;E(Ac(s),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);const[o,a]=e;return{x:()=>JB(o.shape,t,a,r,i),filter:()=>Wce(o,t,a.shape,r,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gce={kernelName:Wp,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>B(en(mj(fe(n,"float32"))),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kce={kernelName:Hp,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>B(gj(fe(n,"float32")),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qce={kernelName:Fb,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{axis:r,exclusive:i,reverse:o}=n;return{x:()=>{const a=Bt([r],s.rank);let l=QB(t,r,i,!o);return a!=null&&(l=nt(l,a)),l}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xce={kernelName:_b,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const{dilations:s,strides:r,pad:i,dimRoundingMode:o}=n,a=s??[1,1];E(Ac(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);const[l,c]=e;return E(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`),E(c.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${c.rank}.`),E(l.shape[3]===c.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${c.shape[2]}.`),E(is(r,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${r} and dilations '${a}'.`),Ks("depthwiseConv2d",i,o),{x:()=>ile(l.shape,t,c,r,i,a,o),filter:()=>sle(l,t,c.shape,r,i,a,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jce={kernelName:zb,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const[s,r]=e,i={x:s,filter:r,dy:t},o={x:s,filter:r,dy:t};return{x:()=>V.runKernel(qk,i,n),filter:()=>V.runKernel(Xk,o,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yce={kernelName:Kp,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e,s={dy:t,y:n};return{x:()=>V.runKernel(dE,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qce={kernelName:qp,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e,s=B(mo(en(Tt(n))),2/Math.sqrt(Math.PI));return{x:()=>B(t,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zce={kernelName:Xp,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>B(t,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eue={kernelName:jb,inputsToSave:["input"],gradFunc:(t,e)=>{const[n]=e;return{input:()=>W(t,n.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tue={kernelName:Jp,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>B(t,mo(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nue={kernelName:Yp,gradFunc:t=>({x:()=>st(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sue={kernelName:Qp,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=_e(n.shape,s.shape);return{a:()=>{const a=Ie(t,fe(s,"float32")),l=kn(n.shape,r);return l.length>0?W(Ce(a,l),n.shape):a},b:()=>{let a=B(t,fe(n,"float32"));const l=kn(s.shape,r);l.length>0&&(a=W(Ce(a,l),s.shape));const c=Tt(s);return en(Ie(a,fe(c,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rue={kernelName:Vb,inputsToSave:["x","mean","variance","scale"],gradFunc:(t,e,n)=>{const{varianceEpsilon:s}=n,[r,i,o,a]=e,l=a??lt(1),c=kn(i.shape,r.shape),u=[];if(i.rank===1){for(let w=0;w<r.shape.length-1;++w)u.push(r.shape[w]);u.push(1)}const d=De(r,i),h=B(t,l),f=hj(ie(o,lt(s))),p=B(B(B(f,f),f),lt(-.5));return{x:()=>i.rank===1?W(B(B(t,Si(W(f,[1,1,1,i.shape[0]]),u)),l),r.shape):W(B(B(t,f),l),r.shape),mean:()=>{let w=B(B(f,lt(-1)),h);return i.rank===1&&(w=Ce(w,c)),W(w,i.shape)},variance:()=>{let w=B(B(p,d),h);return i.rank===1&&(w=Ce(w,c)),W(w,i.shape)},scale:()=>{const w=B(d,f);let S=B(t,w);return i.rank===1&&(S=Ce(S,c)),W(S,i.shape)},offset:()=>{let w=t;return i.rank===1&&(w=Ce(w,c)),W(w,i.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iue={kernelName:Ub,inputsToSave:["x","indices"],gradFunc:(t,e,n)=>{const[s,r]=e,{axis:i,batchDims:o}=n,a=Ge(i,s.shape)[0],l=(c,u,d)=>()=>{const h=c.shape,f=u.size,p=h.slice(0,a),m=p.length,g=h.slice(i,h.length).slice(1),y=g.length,x=mO(0,m),v=mO(m+1,m+1+y),w=gO([p,[f],g]),S=W(d,w),k=W(u,[f]),C=gO([[m],x,v]),N=nt(S,C);let T=wj(N,k,c.shape[a]);const I=kl(C);return T=nt(T,I),T};if(o===1){const c=s.shape[0],u=s.split(c,0);return{x:()=>sa(u.map((f,p)=>l(f,r.slice(p,1),t.slice(p,1))())).reshape(s.shape),indices:()=>r}}else return{x:l(s,r,t),indices:()=>r}}};function mO(t,e){const n=[];for(let s=t;s<e;++s)n.push(s);return n}function gO(t){const e=[];for(let n=0;n<t.length;++n)for(let s=0;s<t[n].length;++s)e.push(t[n][s]);return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oue={kernelName:Zp,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e;return{a:()=>st(n),b:()=>st(s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aue={kernelName:em,gradFunc:t=>({x:()=>fe(t,"float32")})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lue={kernelName:tm,gradFunc:t=>({x:()=>st(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cue={kernelName:nm,gradFunc:t=>({x:()=>st(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uue={kernelName:sm,gradFunc:t=>({x:()=>st(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const due={kernelName:Hb,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{alpha:r}=n,i=Ir(s,0);return{x:()=>ws(i,t,B(t,r))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hue={kernelName:im,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Ie(t,ie(n,1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fue={kernelName:rm,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Ie(t,fe(n,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pue={kernelName:One,inputsToSave:[],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s]=e,{axis:r}=n;return{logits:()=>{const o=mo(s);return De(t,B(Ce(t,r,!0),o))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mue(t,e,n,s=5,r=1,i=1,o=.5){const a={x:t,y:e,dy:n},l={depthRadius:s,bias:r,alpha:i,beta:o};return V.runKernel(yE,a,l)}const gue=H({localResponseNormalizationBackprop_:mue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yue={kernelName:Yb,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s,r]=e,{depthRadius:i,bias:o,alpha:a,beta:l}=n;return{x:()=>gue(s,r,t,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fV(t,e,n,s){return e.rank<n.rank&&(e=W(e,cn(e.shape,s))),t.rank<n.rank&&(t=W(t,cn(t.shape,s))),{x:()=>B(t,fe(po(n,e),t.dtype))}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yO={kernelName:Qb,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const s=n,{reductionIndices:r}=s,i=e[0],o=e[1],a=Ge(r,i.shape),l=fV(t,o,i,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xue={kernelName:om,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e;return{a:()=>B(t,fe(Yc(n,s),"float32")),b:()=>B(t,fe(R0(n,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bue(t,e,n,s,r,i,o){const a=R(t,"dy","maxPool3dGrad"),l=R(e,"input","maxPool3dGrad"),c=R(n,"output","maxPool3dGrad");let u=a,d=l,h=c,f=!1;l.rank===4&&(f=!0,u=W(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),d=W(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),h=W(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),E(u.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${u.rank}.`),E(d.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${d.rank}.`),E(h.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${h.rank}.`),Ks("maxPool3dGrad",i,o);const p={dy:u,input:d,output:h},m={filterSize:s,strides:r,pad:i,dimRoundingMode:o},g=V.runKernel(bE,p,m);return f?W(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}const vue=H({maxPool3dGrad_:bue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wue={kernelName:ev,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s,r]=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=n;return{x:()=>vue(t,s,r,i,o,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sue(t,e,n,s,r,i,o){const a=R(t,"dy","maxPoolGrad"),l=R(e,"input","maxPoolGrad"),c=R(n,"output","maxPoolGrad");E(l.rank===a.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${a.rank})`),E(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),E(l.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`),Ks("maxPoolGrad",i,o);const u={dy:a,input:l,output:c},d={filterSize:s,strides:r,pad:i,dimRoundingMode:o};return V.runKernel(xE,u,d)}const kue=H({maxPoolGrad_:Sue});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cue={kernelName:Zb,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s,r]=e,{filterSize:i,strides:o,pad:a}=n;return{x:()=>kue(t,s,r,i,o,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nue={kernelName:tv,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{axis:r}=n,i=Ge(r,s.shape),a=Dn(s.shape,i)[1],l=Q(a);return{x:()=>{const u=s.shape.slice();i.forEach(f=>{u[f]=1});const d=W(t,u);return Ie(B(d,Nl(s.shape,"float32")),l)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tue={kernelName:nv,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const s=n,{axis:r}=s,[i,o]=e,a=Ge(r,i.shape),l=fV(t,o,i,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eue={kernelName:am,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e;return{a:()=>B(t,fe(Jd(n,s),"float32")),b:()=>B(t,fe(Ir(n,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Iue={kernelName:sv,inputsToSave:["x"],gradFunc:(t,e,n)=>{const s=e[0],{paddings:r}=n,i=r.map(o=>o[0]);return{x:()=>wt(t,i,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Aue={kernelName:lm,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=_e(n.shape,s.shape);return{a:()=>{const a=kn(n.shape,r);return a.length>0?W(Ce(t,a),n.shape):t},b:()=>{const a=B(t,en(Ov(Ie(n,s)))),l=kn(s.shape,r);return l.length>0?W(Ce(a,l),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $ue={kernelName:cm,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=_e(n.shape,s.shape);return{a:()=>{const a=B(t,fe(s,"float32")),l=kn(n.shape,r);return l.length>0?W(Ce(a,l),n.shape):a},b:()=>{const a=B(t,fe(n,"float32")),l=kn(s.shape,r);return l.length>0?W(Ce(a,l),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rue={kernelName:rv,gradFunc:t=>({x:()=>en(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Due={kernelName:av,inputsToSave:["indices"],gradFunc:(t,e)=>{const n=e[0];return{indices:()=>An(n.shape,"float32")}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oue={kernelName:ov,gradFunc:t=>({x:()=>st(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mue={kernelName:lv,saveAllInputs:!0,gradFunc:(t,e,n)=>{const{axis:s}=n;return Mc(t,s).map(i=>()=>i)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xO={kernelName:cv,inputsToSave:["x"],gradFunc:(t,e,n)=>{const s=e[0],{paddings:r}=n,i=r.map(o=>o[0]);return{x:()=>wt(t,i,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pue={kernelName:um,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(t,e)=>{const[n,s,r]=e,i=n,o=s,a=_e(i.shape,o.shape);return{a:()=>{const u=fe(o,"float32");let d=B(t,B(u,Dc(i,De(u,lt(1)))));const h=kn(i.shape,a);return h.length>0&&(d=Ce(d,h)),W(d,i.shape)},b:()=>{const u=Ir(i,0),d=ws(u,go(i),st(i));let h=B(t,B(r,d));const f=kn(o.shape,a);return f.length>0&&(h=Ce(h,f)),W(h,o.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lue={kernelName:uv,inputsToSave:["x","alpha"],gradFunc:(t,e)=>{const[n,s]=e,r=Ir(n,0);return{x:()=>ws(r,t,B(t,s)),alpha:()=>{let i=ws(r,st(t),B(t,n));const o=kn(s.shape,t.shape);return o.length>0&&(i=Ce(i,o)),W(i,s.shape)}}}};/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fue(t,e,n){const s=t.shape.slice();s[n]=1;const r=W(e,s),i=cC(t,n,!0,!1),o=cC(t,n,!0,!0),a=B(i,o);return B(r,a)}function _ue(t,e,n){const s=t.shape.length,r=s-n.length,i=Bt(n,s);let o=t;i!=null&&(o=nt(t,i));const a=o.shape.slice(),c=a.splice(s-n.length,n.length).reduce((h,f)=>h*f,1);a.push(c);const u=o.reshape(a);let d=Fue(u,e,r);if(d=d.reshape(o.shape),i!=null){const h=kl(i);d=nt(d,h)}return d}const zue={kernelName:dv,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{axis:r}=n;let i=[];return r==null?i=s.shape.map((o,a)=>a):typeof r=="number"?i=[r]:i=r,{x:()=>_ue(s,t,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bue={kernelName:Gp,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=_e(n.shape,s.shape);return{a:()=>{const a=Ie(t,fe(s,"float32")),l=kn(n.shape,r);return l.length>0?W(Ce(a,l),n.shape):a},b:()=>{let a=B(t,fe(n,"float32"));const l=kn(s.shape,r);l.length>0&&(a=W(Ce(a,l),s.shape));const c=Tt(s);return en(Ie(a,fe(c,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jue={kernelName:dm,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Ie(t,en(Tt(n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vue={kernelName:fm,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e,s=B(Jd(n,6),Om(n));return{x:()=>B(t,fe(s,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uue={kernelName:hm,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>B(t,fe(Om(n),"float32"))}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wue={kernelName:hv,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>W(t,n.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hue={kernelName:pv,inputsToSave:["images"],gradFunc:(t,e,n)=>{const[s]=e,r={dy:t,images:s};return{images:()=>V.runKernel(TE,r,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gue={kernelName:fv,inputsToSave:["images"],gradFunc:(t,e,n)=>{const[s]=e,r={dy:t,images:s};return{images:()=>V.runKernel(NE,r,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kue={kernelName:mv,gradFunc:(t,e,n)=>{const{dims:s}=n,r=Ge(s,t.shape);return{x:()=>Oc(t,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const que={kernelName:pm,gradFunc:t=>({x:()=>st(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xue={kernelName:mm,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>en(Ie(t,B(Dc(n,1.5),2)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jue={kernelName:gv,inputsToSave:["condition"],gradFunc:(t,e)=>{const[n]=e;return{condition:()=>fe(st(n),"float32"),t:()=>B(t,fe(n,t.dtype)),e:()=>B(t,fe(qE(n),t.dtype))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yue={kernelName:gm,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const s=Ir(n,lt(0)),r=lt(Lv),i=lt(Fv),o=B(t,i),a=B(B(t,r),mo(fe(n,"float32")));return ws(s,o,a)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Que={kernelName:vm,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>B(t,B(n,De(lt(1),n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zue={kernelName:bm,gradFunc:t=>({x:()=>st(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ede={kernelName:ym,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>B(VE(fe(n,"float32")),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tde={kernelName:xm,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>B(YB(fe(n,"float32")),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nde={kernelName:yv,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{begin:r,size:i}=n,o=s.shape,[a,l]=Mv(s,r,i),c=[];for(let u=0;u<t.rank;u++)c.push([a[u],o[u]-a[u]-l[u]]);return{x:()=>YE(t,c)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sde={kernelName:wv,outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s]=e,{dim:r}=n,i=!0,o=B(t,s);return{logits:()=>De(o,B(Ce(o,[r],i),s))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rde={kernelName:wm,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>B(t,Xd(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bO={kernelName:bv,gradFunc:(t,e,n)=>{const{blockShape:s,paddings:r}=n;return{x:()=>BE(t,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vO={kernelName:vv,gradFunc:(t,e,n)=>{const{axis:s}=n;return{x:()=>Ls(t,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ide={kernelName:Sm,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Ie(t,B(rs(fe(n,"float32")),2))}}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ode={kernelName:EE,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>B(t,B(fe(n,"float32"),2))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ade={kernelName:km,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=lt(2);return{a:()=>B(t,B(r,De(n,s))),b:()=>B(t,B(r,De(s,n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lde={kernelName:Im,gradFunc:t=>({x:()=>st(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cde={kernelName:Cm,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=_e(n.shape,s.shape);return{a:()=>{let a=t;const l=kn(n.shape,r);return l.length>0&&(a=Ce(a,l)),W(a,n.shape)},b:()=>{let a=t;const l=kn(s.shape,r);return l.length>0&&(a=Ce(a,l)),W(en(a),s.shape)}}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ude={kernelName:xv,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,r=s.shape.slice(),{axis:i}=n;Ge(i,s.shape).forEach(c=>{r[c]=1});const a=W(t,r),l=B(a,Nl(s.shape,"float32"));return{x:()=>l}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dde={kernelName:Nm,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Ie(t,Tt(VE(n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hde={kernelName:Tm,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>B(De(lt(1),Tt(n)),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fde={kernelName:Em,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{reps:r}=n;return{x:()=>{let o=st(s);if(s.rank===1)for(let a=0;a<r[0];++a)o=ie(o,wt(t,[a*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)o=ie(o,wt(t,[a*s.shape[0],l*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)for(let c=0;c<r[2];++c)o=ie(o,wt(t,[a*s.shape[0],l*s.shape[1],c*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else if(s.rank===4)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)for(let c=0;c<r[2];++c)for(let u=0;u<r[3];++u)o=ie(o,wt(t,[a*s.shape[0],l*s.shape[1],c*s.shape[2],u*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${s.rank} tensors yet.`);return o}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pde={kernelName:nd,gradFunc:(t,e,n)=>{const s=n,{perm:r}=s,i=kl(r);return{x:()=>nt(t,i)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mde={kernelName:Sv,gradFunc:(t,e,n)=>{const s=n,{axis:r}=s;return{value:()=>sa(t,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gde={kernelName:kv,inputsToSave:["segmentIds"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>yde(t,n)}}};function yde(t,e){const n=Cl(e,st(e)),s=HE(t,n);let r=Yc(e,lt(0,"int32"));const i=s.rank-r.rank;for(let a=0;a<i;++a)r=Ds(r,a+1);r=na(r,Nl(s.shape,"bool"));const o=st(s);return ws(r,s,o)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xde={kernelName:Cv,gradFunc:t=>({x:()=>st(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bde=[hV,gce,yce,xce,bce,vce,wce,Sce,kce,Cce,Nce,Tce,Ace,Dce,Oce,Mce,Pce,Lce,Fce,_ce,zce,Bce,Vce,jce,Hce,Gce,Kce,qce,Xce,Jce,Bue,Yce,Qce,Zce,eue,tue,sue,nue,rue,iue,oue,aue,lue,cue,uue,due,hue,fue,pue,yue,yO,yO,xue,wue,Cue,Nue,Tue,Eue,Iue,Aue,$ue,Rue,Due,Oue,Mue,xO,xO,Pue,Lue,zue,jue,Vue,Uue,Wue,Hue,Gue,Kue,que,Xue,Jue,Yue,Que,Zue,ede,tde,nde,sde,rde,bO,bO,vO,vO,ide,ade,ode,lde,cde,ude,dde,hde,fde,pde,mde,gde,xde];for(const t of bde)Lne(t);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.abs=function(){return this.throwIfDisposed(),ps(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.acos=function(){return this.throwIfDisposed(),Xse(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.acosh=function(){return this.throwIfDisposed(),Yse(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.add=function(t){return this.throwIfDisposed(),ie(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.all=function(t,e){return this.throwIfDisposed(),KB(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.any=function(t,e){return this.throwIfDisposed(),aC(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.argMax=function(t){return this.throwIfDisposed(),Jf(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.argMin=function(t){return this.throwIfDisposed(),nre(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.asScalar=function(){return this.throwIfDisposed(),E(this.size===1,()=>"The array must have only 1 element."),W(this,[])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.asType=function(t){return this.throwIfDisposed(),fe(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.as1D=function(){return this.throwIfDisposed(),W(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.as2D=function(t,e){return this.throwIfDisposed(),W(this,[t,e])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.as3D=function(t,e,n){return this.throwIfDisposed(),W(this,[t,e,n])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.as4D=function(t,e,n,s){return this.throwIfDisposed(),W(this,[t,e,n,s])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.as5D=function(t,e,n,s,r){return this.throwIfDisposed(),W(this,[t,e,n,s,r])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.asin=function(){return this.throwIfDisposed(),rre(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.asinh=function(){return this.throwIfDisposed(),ore(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.atan=function(){return this.throwIfDisposed(),lre(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.atan2=function(t){return this.throwIfDisposed(),ure(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.atanh=function(){return this.throwIfDisposed(),hre(this)};Y().prototype.avgPool=function(t,e,n,s){return this.throwIfDisposed(),zE(this,t,e,n,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.batchToSpaceND=function(t,e){return this.throwIfDisposed(),BE(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.batchNorm=function(t,e,n,s,r){return this.throwIfDisposed(),Av(this,t,e,n,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.broadcastTo=function(t){return this.throwIfDisposed(),mf(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.cast=function(t){return this.throwIfDisposed(),fe(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.ceil=function(){return this.throwIfDisposed(),zre(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.clipByValue=function(t,e){return this.throwIfDisposed(),Cr(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.concat=function(t,e){return this.throwIfDisposed(),t instanceof pn&&(t=[t]),Ls([this,...t],e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.conv1d=function(t,e,n,s,r,i){return this.throwIfDisposed(),qB(this,t,e,n,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.conv2dTranspose=function(t,e,n,s,r){return this.throwIfDisposed(),XB(this,t,e,n,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.conv2d=function(t,e,n,s,r,i){return this.throwIfDisposed(),Rc(this,t,e,n,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.cos=function(){return this.throwIfDisposed(),VE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.cosh=function(){return this.throwIfDisposed(),YB(this)};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.cumprod=function(t,e,n){return this.throwIfDisposed(),cC(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.cumsum=function(t,e,n){return this.throwIfDisposed(),QB(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.depthToSpace=function(t,e){return this.throwIfDisposed(),uie(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.depthwiseConv2d=function(t,e,n,s,r,i){return this.throwIfDisposed(),UE(this,t,e,n,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.dilation2d=function(t,e,n,s,r){return this.throwIfDisposed(),fie(this,t,e,n,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.divNoNan=function(t){return this.throwIfDisposed(),xie(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.div=function(t){return this.throwIfDisposed(),Ie(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.dot=function(t){return this.throwIfDisposed(),vie(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.elu=function(){return this.throwIfDisposed(),Rv(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.equal=function(t){return this.throwIfDisposed(),po(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.erf=function(){return this.throwIfDisposed(),ZB(this)};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.euclideanNorm=function(t,e){return this.throwIfDisposed(),Die(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.exp=function(){return this.throwIfDisposed(),mo(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.expandDims=function(t){return this.throwIfDisposed(),Ds(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.expm1=function(){return this.throwIfDisposed(),Lie(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.fft=function(){return this.throwIfDisposed(),xj(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.flatten=function(){return this.throwIfDisposed(),W(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.floor=function(){return this.throwIfDisposed(),Ov(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.floorDiv=function(t){return this.throwIfDisposed(),GB(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.gather=function(t,e,n){return this.throwIfDisposed(),HE(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.greaterEqual=function(t){return this.throwIfDisposed(),Yc(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.greater=function(t){return this.throwIfDisposed(),Ir(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.ifft=function(){return this.throwIfDisposed(),uC(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.irfft=function(){return this.throwIfDisposed(),Eae(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.isFinite=function(){return this.throwIfDisposed(),Hie(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.isInf=function(){return this.throwIfDisposed(),Kie(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.isNaN=function(){return this.throwIfDisposed(),Xie(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.leakyRelu=function(t){return this.throwIfDisposed(),KE(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.lessEqual=function(t){return this.throwIfDisposed(),Jd(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.less=function(t){return this.throwIfDisposed(),R0(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.localResponseNormalization=function(t,e,n,s){return this.throwIfDisposed(),eoe(this,t,e,n,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.logSigmoid=function(){return this.throwIfDisposed(),aoe(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.logSoftmax=function(t){return this.throwIfDisposed(),rj(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.logSumExp=function(t,e){return this.throwIfDisposed(),ij(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.log=function(){return this.throwIfDisposed(),go(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.log1p=function(){return this.throwIfDisposed(),sj(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.logicalAnd=function(t){return this.throwIfDisposed(),na(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.logicalNot=function(){return this.throwIfDisposed(),qE(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.logicalOr=function(t){return this.throwIfDisposed(),oj(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.logicalXor=function(t){return this.throwIfDisposed(),moe(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.matMul=function(t,e,n){return this.throwIfDisposed(),at(this,t,e,n)};Y().prototype.maxPool=function(t,e,n,s){return this.throwIfDisposed(),XE(this,t,e,n,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.max=function(t,e){return this.throwIfDisposed(),Ii(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.maximum=function(t){return this.throwIfDisposed(),Cl(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.mean=function(t,e){return this.throwIfDisposed(),ln(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.min=function(t,e){return this.throwIfDisposed(),$0(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.minimum=function(t){return this.throwIfDisposed(),Zf(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.mirrorPad=function(t,e){return this.throwIfDisposed(),koe(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.mod=function(t){return this.throwIfDisposed(),Noe(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.mul=function(t){return this.throwIfDisposed(),B(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.neg=function(){return this.throwIfDisposed(),en(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.norm=function(t,e,n){return this.throwIfDisposed(),Dv(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.notEqual=function(t){return this.throwIfDisposed(),D0(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.oneHot=function(t,e=1,n=0){return this.throwIfDisposed(),aj(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.onesLike=function(){return this.throwIfDisposed(),ii(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.pad=function(t,e){return this.throwIfDisposed(),YE(this,t,e)};Y().prototype.pool=function(t,e,n,s,r,i){return this.throwIfDisposed(),Poe(this,t,e,n,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.pow=function(t){return this.throwIfDisposed(),Dc(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.prelu=function(t){return this.throwIfDisposed(),ZE(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.prod=function(t,e){return this.throwIfDisposed(),_oe(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.reciprocal=function(){return this.throwIfDisposed(),aae(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.relu=function(){return this.throwIfDisposed(),Zc(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.relu6=function(){return this.throwIfDisposed(),uj(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.reshapeAs=function(t){return this.throwIfDisposed(),W(this,t.shape)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.reshape=function(t){return this.throwIfDisposed(),W(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.resizeBilinear=function(t,e,n){return this.throwIfDisposed(),kj(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.resizeNearestNeighbor=function(t,e,n){return this.throwIfDisposed(),Cj(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.reverse=function(t){return this.throwIfDisposed(),Oc(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.rfft=function(){return this.throwIfDisposed(),$ae(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.round=function(){return this.throwIfDisposed(),dj(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.rsqrt=function(){return this.throwIfDisposed(),hj(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.selu=function(){return this.throwIfDisposed(),fj(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.separableConv2d=function(t,e,n,s,r,i){return this.throwIfDisposed(),pj(this,t,e,n,s,r,i)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.sigmoid=function(){return this.throwIfDisposed(),Xd(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.sign=function(){return this.throwIfDisposed(),gae(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.sin=function(){return this.throwIfDisposed(),mj(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.sinh=function(){return this.throwIfDisposed(),gj(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.slice=function(t,e){return this.throwIfDisposed(),wt(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.softmax=function(t){return this.throwIfDisposed(),cI(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.softplus=function(){return this.throwIfDisposed(),$m(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.spaceToBatchND=function(t,e){return this.throwIfDisposed(),QE(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.split=function(t,e){return this.throwIfDisposed(),wr(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.sqrt=function(){return this.throwIfDisposed(),rs(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.square=function(){return this.throwIfDisposed(),Tt(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.squaredDifference=function(t){return this.throwIfDisposed(),Dae(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.squeeze=function(t){return this.throwIfDisposed(),Dm(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.stack=function(t,e){this.throwIfDisposed();const n=t instanceof pn?[this,t]:[this,...t];return sa(n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.step=function(t){return this.throwIfDisposed(),Om(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.stridedSlice=function(t,e,n,s,r,i,o,a){return this.throwIfDisposed(),Fae(this,t,e,n,s,r,i,o,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.sub=function(t){return this.throwIfDisposed(),De(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.sum=function(t,e){return this.throwIfDisposed(),Ce(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.tan=function(){return this.throwIfDisposed(),zae(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.tanh=function(){return this.throwIfDisposed(),Iv(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.tile=function(t){return this.throwIfDisposed(),Si(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.toBool=function(){return this.throwIfDisposed(),fe(this,"bool")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.toFloat=function(){return this.throwIfDisposed(),fe(this,"float32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.toInt=function(){return this.throwIfDisposed(),fe(this,"int32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.topk=function(t,e){return this.throwIfDisposed(),Vae(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.transpose=function(t){return this.throwIfDisposed(),nt(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.unique=function(t){return this.throwIfDisposed(),Hae(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.unsortedSegmentSum=function(t,e){return this.throwIfDisposed(),wj(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.unstack=function(t){return this.throwIfDisposed(),Mc(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.where=function(t,e){return this.throwIfDisposed(),ws(t,this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */Y().prototype.zerosLike=function(){return this.throwIfDisposed(),st(this)};/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Xi extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Xi.prototype)}}class Jr extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Jr.prototype)}}class M extends Error{constructor(e){super(e),Object.setPrototypeOf(this,M.prototype)}}class ze extends Error{constructor(e){super(e),Object.setPrototypeOf(this,ze.prototype)}}class GI extends Error{constructor(e){super(e),Object.setPrototypeOf(this,GI.prototype)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class pV{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let n;return this.cache.has(e)&&(n=this.cache.get(e),this.cache.delete(e),this.cache.set(e,n)),n}put(e,n){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){const s=this.cache.keys().next().value;this.cache.delete(s)}this.cache.set(e,n)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let n=0;n<this.maxEntries-e;n++){const s=this.cache.keys().next().value;this.cache.delete(s)}this.maxEntries=e}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Pc(t,e){if(Array.isArray(t)){let n=[];for(let s=0;s<e;s++)n=n.concat(t);return n}else{const n=new Array(e);return n.fill(t),n}}function Ji(t,e){if(!t)throw new GI(e)}function wO(t,e){let n=0;for(const s of t)s===e&&n++;return n}function Os(t){return t.length===1?t[0]:t}function dt(t){return Array.isArray(t)?t:[t]}function Fo(t){const n=t.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return n[0]!=="_"?n:"private"+n}function Gl(t){return t.length<=1||t.indexOf("_")===-1?t:t.replace(/[_]+(\w|$)/g,(e,n)=>n.toUpperCase())}let Dr={};function KI(t){if(t==null)return null;const e={};return e.className=t.getClassName(),e.config=t.getConfig(),e}function fC(t){if(!(t==null||typeof t!="object"))if(Array.isArray(t))t.forEach(e=>fC(e));else{const e=Object.keys(t);for(const n of e){const s=t[n];s!=null&&typeof s=="object"&&(!Array.isArray(s)&&s.type==="ndarray"&&typeof s.value=="number"?t[n]=s.value:fC(s))}}}function Fm(t,e={},n={},s="object",r=!1){if(typeof t=="string"){const i=t;let o;if(i in n)o=n[i];else if(i in Dr)o=Dr[i];else if(o=e[i],o==null)throw new M(`Unknown ${s}: ${t}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return o}else{const i=t;if(i.className==null||i.config==null)throw new M(`${s}: Improper config format: ${JSON.stringify(i)}.
'className' and 'config' must set.`);const o=i.className;let a,l;if(o in n?[a,l]=n[o]:o in Dr?[a,l]=Dr.className:o in e&&([a,l]=e[o]),a==null)throw new M(`Unknown ${s}: ${o}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(l!=null){const c={};for(const f of Object.keys(Dr))c[f]=Dr[f];for(const f of Object.keys(n))c[f]=n[f];const u=i.config;u.customObjects=c;const d=Object.assign({},Dr);for(const f of Object.keys(n))Dr[f]=n[f];fC(i.config);const h=l(a,i.config,n,r);return Dr=Object.assign({},d),h}else{const c=Object.assign({},Dr);for(const d of Object.keys(n))Dr[d]=n[d];const u=new a(i.config);return Dr=Object.assign({},c),u}}}function vde(t,e){return t<e?-1:t>e?1:0}function Rg(t,e){return-1*vde(t,e)}function Ja(t){if(t==null)return t;const e=[];for(const n of t)e.indexOf(n)===-1&&e.push(n);return e}function wde(t){if(t==null)throw new M(`Invalid value in obj: ${JSON.stringify(t)}`);for(const e in t)if(t.hasOwnProperty(e))return!1;return!0}function tu(t,e,n){if(n!=null&&t.indexOf(n)<0)throw new M(`${n} is not a valid ${e}.  Valid values are ${t} or null/undefined.`)}function qI(t,e,n=0,s=1/0){return Ji(n>=0),Ji(s>=n),Array.isArray(t)&&t.length>=n&&t.length<=s&&t.every(r=>typeof r===e)}function Rn(t,e){Array.isArray(t)?(E(t.length>0,()=>`${e} is unexpectedly an empty array.`),t.forEach((n,s)=>Rn(n,`element ${s+1} of ${e}`))):E(Number.isInteger(t)&&t>0,()=>`Expected ${e} to be a positive integer, but got ${mV(t)}.`)}function mV(t){return t===null?"null":Array.isArray(t)?"["+t.map(e=>mV(e)).join(",")+"]":typeof t=="string"?`"${t}"`:`${t}`}function Sde(t,e,n){let s=n!=null?n():$s(),r;return(...o)=>{const a=n!=null?n():$s();return a-s<e||(s=a,r=t(...o)),r}}function gV(t){return t==="relu"?"relu":t==="linear"?"linear":t==="elu"?"elu":null}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let kde=0;function yV(){return kde++}const Dg={};function _v(t=""){return t in Dg||(Dg[t]=0),Dg[t]+=1,t+Dg[t].toString()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Cde=["channelsFirst","channelsLast"],Nde=["nearest","bilinear"],Tde=["valid","same","causal"],Ede=["max","avg"],Ide=["sum","mul","concat","ave"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const bu=new Map;function sn(t){tu(Cde,"DataFormat",t)}function Ade(t){tu(Nde,"InterpolationFormat",t)}function Ar(t){tu(Tde,"PaddingMode",t)}function xV(t){tu(Ede,"PoolMode",t)}const gf=[],SO="/";function dc(t,e){gf.push(t);try{const n=e();return gf.pop(),n}catch(n){throw gf.pop(),n}}function $de(){return gf.length===0?"":gf.join(SO)+SO}function bV(t){if(!wV(t))throw new Error("Not a valid tensor name: '"+t+"'");return $de()+t}function vV(t){if(!wV(t))throw new Error("Not a valid tensor name: '"+t+"'");bu.has(t)||bu.set(t,0);const e=bu.get(t);if(bu.set(t,bu.get(t)+1),e>0){const n=`${t}_${e}`;return bu.set(n,1),n}else return t}const Rde=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function wV(t){return!!t.match(Rde)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Dde(t){return t===parseInt(t.toString(),10)}function Ya(t,e,n){e==null&&(e=0),n==null&&(n=t.length);let s=1;for(let r=e;r<n;++r)s*=t[r];return s}function Ed(t){if(t.length===0)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let n=0;n<t.length;n++){const s=t[n];s<e&&(e=s)}return e}function al(t){if(t.length===0)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let n=0;n<t.length;n++){const s=t[n];s>e&&(e=s)}return e}function Di(t,e){if(e<t)throw new M(`end (${e}) < begin (${t}) is forbidden.`);const n=[];for(let s=t;s<e;++s)n.push(s);return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let kw;function yn(){return kw==null&&(kw=lse().epsilon()),kw}function Oi(){return"channelsLast"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function co(t,e){return fe(t,e)}function _m(t,e=-1){const n=t.shape.slice();return e<0&&(e=n.length+e+1),n.splice(e,0,1),W(t,n)}function Ode(t,e){return q(()=>{if(t.shape.length!==2)throw new M(`repeat() expects a rank-2 tensor, but received a rank-${t.shape.length} tensor.`);const n=_m(t,1);return pC(n,[1,e,1])})}function Mde(t){const e=[Ya(t.shape)];return W(t,e)}function Pde(t){if(t.rank<=1)throw new M(`batchFlatten requires a minimum rank of 2. Got rank: ${t.rank}.`);const e=[t.shape[0],Ya(t.shape,1)];return W(t,e)}function hc(t,e,n){return q(()=>{switch(t.rank){case 1:return aI(t,e,n);case 2:return yj(t,[e,0],[n,t.shape[1]]);case 3:return lI(t,[e,0,0],[n,t.shape[1],t.shape[2]]);case 4:return M0(t,[e,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3]]);case 5:return wt(t,[e,0,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3],t.shape[4]]);case 6:return wt(t,[e,0,0,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3],t.shape[4],t.shape[5]]);default:throw new M(`sliceAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}})}function Cw(t,e,n){return q(()=>{switch(t.rank){case 1:return aI(t,e,n);case 2:return yj(t,[0,e],[t.shape[0],n]);case 3:return lI(t,[0,0,e],[t.shape[0],t.shape[1],n]);case 4:return M0(t,[0,0,0,e],[t.shape[0],t.shape[1],t.shape[2],n]);default:throw new M(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}})}function Og(t,e,n,s){return q(()=>{switch(t.rank){case 1:return aI(t,e,n);case 2:switch(s){case 1:return hc(t,e,n);case 2:return Cw(t,e,n);default:throw new M(`The axis is not within the rank of the tensor ${s}`)}case 3:switch(s){case 1:return hc(t,e,n);case 2:return lI(t,[0,e,0],[t.shape[0],n,t.shape[2]]);case 3:return Cw(t,e,n);default:throw new M(`The axis is not within the rank of the tensor ${s}`)}case 4:switch(s){case 1:return hc(t,e,n);case 2:return M0(t,[0,e,0,0],[t.shape[0],n,t.shape[2],t.shape[3]]);case 3:return M0(t,[0,0,e,0],[t.shape[0],t.shape[1],n,t.shape[3]]);case 4:return Cw(t,e,n);default:throw new M(`The axis is not within the rank of the tensor ${s}`)}default:throw new M(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}})}function XI(t,e=-1){let n;return e<0&&(n=t[0].rank,n!==0?e=n:e=0),e===t[0].rank&&(e=-1),Ls(t,e)}function kO(t,e){switch(t.rank){case 1:return Vre([t,e]);case 2:return Wre([t,e],0);case 3:return Gre([t,e],0);case 4:return qre([t,e],0);default:throw new M(`concatAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}}function pC(t,e){if(Array.isArray(e)||(e=[e]),t.rank!==e.length)throw new M(`The length of input n (${e.length}) does not match the number of dimensions in input x (${t.rank})`);return Si(t,e)}function zv(t,e=0,n=1,s,r){return sae(t,e,n,s,r)}function uo(t,e,n,s){if(t.rank<2||e.rank<2)throw new ze(`dot requires both inputs to be rank >= 2 but got x shape = ${t.shape} and y shape = ${e.shape}`);if(e.rank>=3){const r=t.shape.slice(-1)[0],i=e.shape.slice(-2)[0];if(r!==i)throw new ze(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${t.shape} and  y shape = ${e.shape}`)}if(t.rank===2&&e.rank===2)return aO({a:t,b:e,transposeA:!1,transposeB:!1,bias:s?mC(t.rank,s,Oi()):null,activation:n});{const r=t.shape.slice(),i=r.pop();t=W(t,[-1,i]);const o=e.shape.slice(),a=o.pop(),l=o.pop(),c=[...o,a],u=Array.from({length:e.rank},(p,m)=>m===0?e.rank-2:m<=e.rank-2?m-1:m);e=W(nt(e,u),[l,-1]);const d=[...r,...c];return W(aO({a:t,b:e,transposeA:!1,transposeB:!1,bias:s?mC(t.rank,s,Oi()):null,activation:n}),d)}}function SV(t,e,n){return q(()=>(Array.isArray(e)?e=tr(e,"int32"):e=fe(e,"int32"),HE(t,e,n)))}function zm(t){return B(t,t)}function mC(t,e,n){const s=e.shape;if(e.rank!==1&&e.rank!==t)throw new M(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${t}`);if(t===5){if(n==="channelsFirst")return s.length===1?W(e,[1,s[0],1,1,1]):W(e,[1,s[3],s[0],s[1],s[2]]);if(n==="channelsLast")return s.length===1?W(e,[1,1,1,1,s[0]]):W(e,[1].concat(s))}else if(t===4){if(n==="channelsFirst")return s.length===1?W(e,[1,s[0],1,1]):W(e,[1,s[2],s[0],s[1]]);if(n==="channelsLast")return s.length===1?W(e,[1,1,1,s[0]]):W(e,[1].concat(s))}else if(t===3){if(n==="channelsFirst")return s.length===1?W(e,[1,s[0],1]):W(e,[1,s[1],s[0]]);if(n==="channelsLast")return s.length===1?W(e,[1,1,s[0]]):W(e,[1].concat(s))}else if(t<3)return e;throw new M(`Unsupported input rank by biasAdd: ${e.rank}`)}function Fi(t,e,n){return q(()=>(n==null&&(n=Oi()),sn(n),ie(t,mC(t.rank,e,n))))}function Lde(t,e=1){if(e!==1)throw new ze(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return Rv(t)}function Fde(t){return q(()=>Ie(t,ie(ps(t),1)))}function kV(t,e,n,s){return q(()=>Qae(t,e,n,s))}function _de(t){return q(()=>{const e=ie(.5,B(.2,t));return Cr(e,0,1)})}function Bm(t,e,n=!1){return n?t():e()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const zde=["fanIn","fanOut","fanAvg"],Bde=["normal","uniform","truncatedNormal"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function jde(t){tu(zde,"FanMode",t)}function Vde(t){tu(Bde,"Distribution",t)}class li extends Qd{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class CV extends li{apply(e,n){return An(e,n)}}CV.className="Zeros";ne(CV);class JI extends li{apply(e,n){return Nl(e,n)}}JI.className="Ones";ne(JI);class NV extends li{constructor(e){if(super(),typeof e!="object")throw new M(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new M(`config must have value set but got ${e}`);this.value=e.value}apply(e,n){return q(()=>B(lt(this.value),Nl(e,n)))}getConfig(){return{value:this.value}}}NV.className="Constant";ne(NV);class TV extends li{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,n){return Rm(e,this.minval,this.maxval,n,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}TV.className="RandomUniform";ne(TV);class EV extends li{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new ze(`randomNormal does not support dType ${n}.`);return zv(e,this.mean,this.stddev,n,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}EV.className="RandomNormal";ne(EV);class IV extends li{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new ze(`truncatedNormal does not support dType ${n}.`);return vj(e,this.mean,this.stddev,n,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}IV.className="TruncatedNormal";ne(IV);class AV extends li{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,n){return q(()=>{if(e.length!==2||e[0]!==e[1])throw new M("Identity matrix initializer can only be used for 2D square matrices.");return B(this.gain,nj(e[0]))})}getConfig(){return{gain:this.gain}}}AV.className="Identity";ne(AV);function Ude(t,e="channelsLast"){let n,s;if(sn(e),t.length===2)n=t[0],s=t[1];else if([3,4,5].indexOf(t.length)!==-1){if(e==="channelsFirst"){const r=Ya(t,2);n=t[1]*r,s=t[0]*r}else if(e==="channelsLast"){const r=Ya(t,0,t.length-2);n=t[t.length-2]*r,s=t[t.length-1]*r}}else{const r=Ya(t);n=Math.sqrt(r),s=Math.sqrt(r)}return[n,s]}class cr extends li{constructor(e){if(super(),e.scale<0)throw new M(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,jde(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,Vde(this.distribution),this.seed=e.seed}apply(e,n){const s=Ude(e),r=s[0],i=s[1];let o=this.scale;if(this.mode==="fanIn"?o/=Math.max(1,r):this.mode==="fanOut"?o/=Math.max(1,i):o/=Math.max(1,(r+i)/2),this.distribution==="normal"){const a=Math.sqrt(o);if(n=n||"float32",n!=="float32"&&n!=="int32")throw new ze(`${this.getClassName()} does not support dType ${n}.`);return vj(e,0,a,n,this.seed)}else{const a=Math.sqrt(3*o);return Rm(e,-a,a,n,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}cr.className="VarianceScaling";ne(cr);class YI extends cr{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return cr.className}}YI.className="GlorotUniform";ne(YI);class QI extends cr{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return cr.className}}QI.className="GlorotNormal";ne(QI);class ZI extends cr{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return cr.className}}ZI.className="HeNormal";ne(ZI);class e2 extends cr{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return cr.className}}e2.className="HeUniform";ne(e2);class t2 extends cr{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return cr.className}}t2.className="LeCunNormal";ne(t2);class n2 extends cr{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return cr.className}}n2.className="LeCunUniform";ne(n2);class $V extends li{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,n){return q(()=>{if(e.length<2)throw new ze("Shape must be at least 2D.");if(n!=="int32"&&n!=="float32"&&n!==void 0)throw new TypeError(`Unsupported data type ${n}.`);n=n;const s=Q(e.slice(0,-1)),r=e[e.length-1],i=s*r;i>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${i}) elements: Slowness may result.`);const o=[Math.max(r,s),Math.min(r,s)],a=zv(o,0,1,n,this.seed),l=qle.qr(a,!1);let c=l[0];const d=l[1].flatten().stridedSlice([0],[Math.min(r,s)*Math.min(r,s)],[Math.min(r,s)+1]);return c=B(c,d.sign()),s<r&&(c=c.transpose()),B(lt(this.gain),c.reshape(e))})}getConfig(){return{gain:this.gain,seed:this.seed}}}$V.className="Orthogonal";ne($V);const CO={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function NO(t,e={}){return Fm(t,Wr.getMap().classNameMap,e,"initializer")}function zt(t){return KI(t)}function Ot(t){if(typeof t=="string"){const e=t in CO?CO[t]:t;if(e==="GlorotNormal")return new QI;if(e==="GlorotUniform")return new YI;if(e==="HeNormal")return new ZI;if(e==="HeUniform")return new e2;if(e==="LeCunNormal")return new t2;if(e==="LeCunUniform")return new n2;{const n={};return n.className=e,n.config={},NO(n)}}else return t instanceof li?t:NO(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function gC(t){return Array.isArray(t)&&Array.isArray(t[0])}function P0(t){return t.length===0?[]:Array.isArray(t[0])?t:[t]}function Oe(t){let e;if(Array.isArray(t)){if(t.length!==1)throw new M(`Expected Tensor length to be 1; got ${t.length}`);e=t[0]}else e=t;return e}function it(t){if(Array.isArray(t)&&Array.isArray(t[0])){if(t.length===1)return t=t,t[0];throw new M(`Expected exactly 1 Shape; got ${t.length}`)}else return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function L0(t){let e=0;for(const n of t)n.shape.length===0?e+=1:e+=n.shape.reduce((s,r)=>s*r);return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const TO="Variable";class Wde{constructor(e,n="float32",s=TO,r=!0,i=null){this.dtype=n??"float32",this.shape=e.shape,this.id=yV(),s=s??TO,this.originalName=bV(s),this.name=vV(this.originalName),this.trainable_=r,this.constraint=i,this.val=qae(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),Hde(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function Hde(t,e){if(t.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(t.shape)+" vs. "+JSON.stringify(e.shape))}function yC(t){return t.map(e=>e.read())}function s2(t){t.forEach(e=>{e[0].write(e[1])})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class xn{constructor(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class yo{constructor(e,n,s,r,i,o,a){this.dtype=e,this.shape=n,this.sourceLayer=s,this.inputs=r,this.callArgs=i,this.outputTensorIndex=a,this.id=yV(),o!=null&&(this.originalName=bV(o),this.name=vV(this.originalName)),this.rank=n.length}}let Gde=0,Bv=class{constructor(e,n){this.callArgs=n,this.id=Gde++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const s of e.inboundLayers)s!=null&&s.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const n of this.inboundLayers)n!=null?e.push(n.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}},Kde=0;class Ke extends Qd{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=Kde++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let n=e.name;if(!n){const s=this.getClassName();n=Fo(s)+"_"+_v(s)}if(this.name=n,this.trainable_=e.trainable==null?!0:e.trainable,e.inputShape!=null||e.batchInputShape!=null){let s;if(e.batchInputShape!=null)s=e.batchInputShape;else if(e.inputShape!=null){let i=null;e.batchSize!=null&&(i=e.batchSize),s=[i].concat(e.inputShape)}this.batchInputShape=s;let r=e.dtype;r==null&&(r=e.inputDType),r==null&&(r="float32"),this.dtype=r}e.weights!=null?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,n){return e.name+"_ib-"+n.toString()}getNodeAtIndex(e,n){if(this.inboundNodes.length===0)throw new Jr(`The layer has never been called and thus has no defined ${n}.`);if(this.inboundNodes.length<=e)throw new M(`Asked to get ${n} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return Os(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return Os(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new Xi(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new Xi(`Layer ${this.name} is not connected, no input to return.`);return Os(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new Xi(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new Xi(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return Os(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(n=>n.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){const n=dt(e);if(this.inputSpec==null||this.inputSpec.length===0)return;const s=dt(this.inputSpec);if(n.length!==s.length)throw new M(`Layer ${this.name} expects ${s.length} inputs, but it received ${n.length} input tensors. Input received: ${e}`);for(let r=0;r<n.length;r++){const i=n[r],o=s[r];if(o==null)continue;const a=i.rank;if(o.ndim!=null&&a!==o.ndim)throw new M(`Input ${r} is incompatible with layer ${this.name}: expected ndim=${o.ndim}, found ndim=${a}`);if(o.maxNDim!=null&&a>o.maxNDim)throw new M(`Input ${r} is incompatible with layer ${this.name}: expected max_ndim=${o.maxNDim}, found ndim=${a}`);if(o.minNDim!=null&&a<o.minNDim)throw new M(`Input ${r} is incompatible with layer ${this.name}: expected min_ndim=${o.minNDim}, found ndim=${a}.`);if(o.dtype!=null&&i.dtype!==o.dtype)throw new M(`Input ${r} is incompatible with layer ${this.name} : expected dtype=${o.dtype}, found dtype=${i.dtype}.`);if(o.axes){const l=i.shape;for(const c in o.axes){const u=Number(c),d=o.axes[c],h=u>=0?l[u]:l[l.length+u];if(d!=null&&[d,null].indexOf(h)===-1)throw new M(`Input ${r} is incompatible with layer ${this.name}: expected axis ${u} of input shape to have value ${d} but got shape ${l}.`)}}if(o.shape!=null)for(let l=0;l<o.shape.length;++l){const c=o.shape[l],u=i.shape[l];if(c!=null&&u!=null&&c!==u)throw new M(`Input ${r} is incompatible with layer ${this.name}: expected shape=${o.shape}, found shape=${i.shape}.`)}}}call(e,n){return e}invokeCallHook(e,n){this._callHook!=null&&this._callHook(e,n)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,n){n=n||{},this.assertNotDisposed();const s=dt(e),r=Jde(e),i=Yde(e);if(r===i)throw new M("Arguments to apply() must be all SymbolicTensors or all Tensors");return dc(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);const o=[];for(const a of dt(e))o.push(a.shape);this.build(Os(o)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&i&&(this._refCount=1)}if(this.assertInputCompatibility(e),i){let o=this.call(e,n);this.supportsMasking&&this.setMaskMetadata(e,o);const a=dt(o),l=[];for(let c of a)s.indexOf(c)!==-1&&(c=c.clone()),l.push(c);if(o=Os(l),this.activityRegularizer!=null)throw new ze("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return o}else{const o=qde(e),a=this.computeOutputShape(o);let l;const c=Xde(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?o[0]:o),a!=null&&a.length>0&&Array.isArray(a[0])?l=a.map((u,d)=>new yo(c,u,this,dt(e),n,this.name,d)):l=new yo(c,a,this,dt(e),n,this.name),this.addInboundNode(e,l,null,null,o,a,n),this._refCount++,this.activityRegularizer!=null)throw new ze("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}})}warnOnIncompatibleInputShape(e){if(this.batchInputShape!=null)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let n=!1;this.batchInputShape.forEach((s,r)=>{s!=null&&e[r]!=null&&e[r]!==s&&(n=!0)}),n&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new Xi(`The layer ${this.name} has never been called and thus has no defined output shape.`);const e=[];for(const n of this.inboundNodes){const s=JSON.stringify(n.outputShapes);e.indexOf(s)===-1&&e.push(s)}if(e.length===1){const n=this.inboundNodes[0].outputShapes;return Array.isArray(n)&&Array.isArray(n[0])&&n.length===1?n[0]:n}else throw new Xi(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new Jr(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return L0(this.weights)}build(e){this.built=!0}getWeights(e=!1){return yC(e?this.trainableWeights:this.weights)}setWeights(e){q(()=>{const n=this.weights;if(n.length!==e.length)throw new M(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${n.length} weights. Provided weights: ${e}...`);if(n.length===0)return;const s=[],r=yC(n);for(let i=0;i<r.length;++i){const o=r[i],a=n[i],l=e[i];if(!ct(o.shape,l.shape))throw new M(`Layer weight shape ${o.shape} not compatible with provided weight shape ${l.shape}`);s.push([a,l])}s2(s)})}addWeight(e,n,s,r,i,o,a,l){if(this._addedWeightNames.indexOf(e)!==-1)throw new M(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),s==null&&(s="float32"),this.fastWeightInitDuringBuild&&(r=l!=null?l():Ot("zeros"));const c=r.apply(n,s),u=new Wde(c,s,e,o,a);return c.dispose(),i!=null&&this.addLoss(()=>i.apply(u.read())),o==null&&(o=!0),o?this._trainableWeights.push(u):this._nonTrainableWeights.push(u),u}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){e==null||Array.isArray(e)&&e.length===0||(e=dt(e),this._losses!==void 0&&this._losses!==null&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,n){if(!this.supportsMasking){if(n!=null)if(Array.isArray(n))n.forEach(s=>{if(s!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return n}setMaskMetadata(e,n,s){if(!this.supportsMasking)return;const r=this.computeMask(e,s),i=dt(n),o=dt(r);if(i.length!==o.length)throw new Error(`${this.name} outputs ${i.length} tensors but ${i.length} masks for those tensors`);for(let a=0;a<i.length;a++)i[a].kerasMask=o[a]}addInboundNode(e,n,s,r,i,o,a=null){const l=dt(e);n=dt(n),s=dt(s),r=dt(r),i=P0(i),o=P0(o);const c=[],u=[],d=[];for(const h of l)c.push(h.sourceLayer),u.push(h.nodeIndex),d.push(h.tensorIndex);new Bv({outboundLayer:this,inboundLayers:c,nodeIndices:u,tensorIndices:d,inputTensors:l,outputTensors:n,inputMasks:s,outputMasks:r,inputShapes:i,outputShapes:o},a);for(let h=0;h<n.length;h++)n[h].sourceLayer=this,n[h].nodeIndex=this.inboundNodes.length-1,n[h].tensorIndex=h}getConfig(){const e={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(e.batchInputShape=this.batchInputShape),this.dtype!=null&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return--this._refCount===0&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function qde(t){t=dt(t);const e=[];for(const n of t)e.push(n.shape);return Os(e)}function Xde(t){return"float32"}function RV(t,e,n){if((e==null||n!=null&&n>0)&&(e=t.sourceLayer,n=t.nodeIndex),e.inboundNodes.length===0)return[t];{const s=e.inboundNodes[n];if(s.inboundLayers.length===0)return s.inputTensors;{const r=[];for(let i=0;i<s.inboundLayers.length;i++){const o=s.inputTensors[i],a=s.inboundLayers[i],l=s.nodeIndices[i],c=RV(o,a,l);for(const u of c)r.indexOf(u)===-1&&r.push(u)}return r}}}function Jde(t){let e=!0;for(const n of dt(t))if(!(n instanceof yo)){e=!1;break}return e}function Yde(t){let e=!0;for(const n of dt(t))if(n instanceof yo){e=!1;break}return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class jm extends Ke{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:_v("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new M("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let n=e.batchInputShape;if(n==null){if(e.inputShape==null)throw new M("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");n=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new M("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const s=e.dtype||"float32";this.batchInputShape=n,this.dtype=s,this.inputSpec=[{shape:n}];const r=new yo(this.dtype,this.batchInputShape,this,[],{},this.name);r.nodeIndex=0,r.tensorIndex=0,new Bv({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[r],outputTensors:[r],inputMasks:[null],outputMasks:[null],inputShapes:[n],outputShapes:[n]})}apply(e,n){throw new M(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}jm.className="InputLayer";ne(jm);function Qde(t){if(t.batchShape==null&&t.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(t.batchShape!=null&&t.shape!=null)throw new M("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=t.batchShape;t.shape!=null&&e==null&&(e=[null].concat(t.shape));let n=t.dtype;return n==null&&(n="float32"),new jm({batchInputShape:e,name:t.name,dtype:n,sparse:t.sparse}).inboundNodes[0].outputTensors[0]}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Zde(t,e){if(t.dtype==null||t.dtype===e.dtype)return e;try{return fe(e,t.dtype)}catch{throw new M(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${t.name}' (${t.dtype}).`)}}class Da{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof Da)for(const n in e.id2Value)this.id2Value[n]=e.id2Value[n],n in e.id2Mask&&(this.id2Mask[n]=e.id2Mask[n]);else{if(e==null)return;for(const n of e)this.add(n.key,n.value)}}add(e,n,s){if(this.id2Value[e.id]==null)this.id2Value[e.id]=Zde(e,n),this.name2Id[e.name]=e.id,s!=null&&(this.id2Mask[e.id]=s);else throw new M(`Duplicate key: name=${e.name}, id=${e.id}`);return this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return this.id2Value[e.id]!=null}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof yo){if(this.id2Value[e.id]==null)throw new M(`Nonexistent key: ${e.name}`);return this.id2Value[e.id]}else{const n=this.name2Id[e];if(n==null)throw new M(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[n]}}getMask(e){if(e instanceof yo){if(this.id2Value[e.id]==null)throw new M(`Nonexistent key: ${e.name}`);return this.id2Mask[e.id]}else{const n=this.name2Id[e];if(n==null)throw new M(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[n]}}disposeMasks(){this.id2Mask!=null&&Ve(this.id2Mask)}}const F0=new pV,_0=new pV;function ehe(t){F0!=null&&F0.setMaxEntries(t),_0!=null&&_0.setMaxEntries(t)}function Hh(t,e,n,s){const r=n==null?!1:n.training,i=Array.isArray(t),o=i?t:[t],a=o.map(p=>p.name),l=[],c=e.names();for(const p of a)c.indexOf(p)!==-1?l.push(e.getValue(p)):l.push(null);s!=null&&(s.maxNumTensors=-1/0,s.minNumTensors=1/0);const u=a.join(",")+"|"+e.names().sort().join(",");let d=F0.get(u),h;if(d==null){const p=the(o,e);d=p.sorted,h=p.recipientCounts,F0.put(u,d),_0.put(u,h)}h={},r||Object.assign(h,_0.get(u));const f=new Da(e);for(let p=0;p<d.length;++p){if(s!=null){const T=sC().numTensors;T>s.maxNumTensors&&(s.maxNumTensors=T),T<s.minNumTensors&&(s.minNumTensors=T)}const m=d[p],g=m.sourceLayer;if(g instanceof jm)continue;const y=[],x=[],v=[];let w=!1;for(const T of m.inputs){const I=f.getValue(T),D=f.getMask(T);y.push(I),x.push(D),D!=null&&(w=!0),r||(h[T.name]--,h[T.name]===0&&!e.hasKey(T)&&a.indexOf(T.name)===-1&&!I.isDisposed&&T.sourceLayer.stateful!==!0&&v.push(I))}w&&(n=n||{},n.mask=x[0]);const S=dt(g.apply(y,n));let k=null;g.supportsMasking&&(k=g.computeMask(y,x));const C=she(m),N=Array.isArray(C)?C:[C];for(let T=0;T<N.length;++T){f.hasKey(N[T])||f.add(N[T],S[T],Array.isArray(k)?k[0]:k);const I=a.indexOf(N[T].name);I!==-1&&(l[I]=S[T])}r||Ve(v)}return f.disposeMasks(),i?l:l[0]}function the(t,e){E(t!=null&&t.length>0,()=>"Expected at least one fetch, got none");let n=[],s={};if(t.length===1){const r=EO(t[0],e);n=r.sorted,s=r.recipientMap}else{const r=new Set;for(const i of t){const{sorted:o,recipientMap:a}=EO(i,e);for(const l of o)r.has(l.name)||(n.push(l),r.add(l.name));for(const l in a)s[l]==null&&(s[l]=new Set),a[l].forEach(c=>s[l].add(c))}}return{sorted:n,recipientCounts:nhe(s)}}function nhe(t){const e={};for(const n in t)e[n]=t[n].size;return e}function EO(t,e){const n=new Set,s=[],r={};for(const a of e.names())n.add(a);const i=[],o=[];for(i.push(t);i.length>0;){const a=i[i.length-1];if(n.has(a.name)){i.pop();continue}const l=o[o.length-1]===i.length-1;if(a.inputs.length===0||l)i.pop(),s.push(a),n.add(a.name),l&&o.pop();else{o.push(i.length-1);for(const c of a.inputs)r[c.name]==null&&(r[c.name]=new Set),r[c.name].add(a.name),!n.has(c.name)&&i.push(c)}}return{sorted:s,recipientMap:r}}function she(t){let e;if(t.sourceLayer.inboundNodes.length===1)e=t.sourceLayer.output;else{let n=null;for(let s=0;s<t.sourceLayer.inboundNodes.length;++s)for(const r of t.sourceLayer.inboundNodes[s].outputTensors)if(r.id===t.id){n=s;break}e=t.sourceLayer.getOutputAt(n)}return e}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rhe=X();rhe.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,ehe);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function r2(t,e){return q(()=>rs(Ce(B(t,t),e,!0)))}class Vm extends Qd{getConfig(){return{}}}class DV extends Vm{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return q(()=>{const n=r2(e,this.axis),s=Cr(n,0,this.maxValue);return B(e,Ie(s,ie(yn(),n)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}DV.className="MaxNorm";ne(DV);class OV extends Vm{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return q(()=>Ie(e,ie(yn(),r2(e,this.axis))))}getConfig(){return{axis:this.axis}}}OV.className="UnitNorm";ne(OV);class MV extends Vm{apply(e){return Zc(e)}}MV.className="NonNeg";ne(MV);class PV extends Vm{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return q(()=>{const n=r2(e,this.axis),s=ie(B(this.rate,Cr(n,this.minValue,this.maxValue)),B(1-this.rate,n));return B(e,Ie(s,ie(yn(),n)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}PV.className="MinMaxNorm";ne(PV);const IO={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function vn(t){return KI(t)}function AO(t,e={}){return Fm(t,Wr.getMap().classNameMap,e,"constraint")}function wn(t){if(t==null)return null;if(typeof t=="string"){const n={className:t in IO?IO[t]:t,config:{}};return AO(n)}else return t instanceof Vm?t:AO(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function Ll(t){if(t==null)return;const e=[],n=[],s=[];for(const r in t){const i=t[r];if(typeof i!="number"){const o=i;e.push(o.data()),n.push(r),s.push(o)}}if(e.length>0){const r=await Promise.all(e);for(let i=0;i<r.length;++i)t[n[i]]=r[i][0];Ve(s)}}function LV(t){if(t!=null)for(const e in t){const n=t[e];typeof n!="number"&&n.dispose()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var $O;(function(t){t[t.SILENT=0]="SILENT",t[t.VERBOSE=1]="VERBOSE"})($O||($O={}));const ihe=125;class tp{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,n){}async onEpochEnd(e,n){}async onBatchBegin(e,n){}async onBatchEnd(e,n){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class ohe{constructor(e,n=10){e==null&&(e=[]),this.callbacks=e,this.queueLength=n}append(e){this.callbacks.push(e)}setParams(e){for(const n of this.callbacks)n.setParams(e)}setModel(e){for(const n of this.callbacks)n.setModel(e)}async onEpochBegin(e,n){n==null&&(n={});for(const s of this.callbacks)await s.onEpochBegin(e,n)}async onEpochEnd(e,n){n==null&&(n={});for(const s of this.callbacks)await s.onEpochEnd(e,n)}async onBatchBegin(e,n){n==null&&(n={});for(const s of this.callbacks)await s.onBatchBegin(e,n)}async onBatchEnd(e,n){n==null&&(n={});for(const s of this.callbacks)await s.onBatchEnd(e,n)}async onTrainBegin(e){e==null&&(e={});for(const n of this.callbacks)await n.onTrainBegin(e)}async onTrainEnd(e){e==null&&(e={});for(const n of this.callbacks)await n.onTrainEnd(e)}}class ahe extends tp{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,n){n==null&&(n={});const s=n.size==null?0:n.size;this.seen+=s;for(const r in n){const i=n[r];if(typeof i=="number")this.totals.hasOwnProperty(r)||(this.totals[r]=0),this.totals[r]=this.totals[r]+i*s;else{let o;r in this.totals?o=this.totals[r]:this.totals[r]=0;const a=q(()=>ie(this.totals[r],B(i,s)));this.totals[r]=a,o!=null&&o.dispose()}}}async onEpochEnd(e,n){if(n!=null)for(const s of this.params.metrics)this.totals[s]!=null&&(typeof this.totals[s]=="number"?n[s]=this.totals[s]/this.seen:q(()=>{const r=B(Ie(1,this.seen),this.totals[s]);n[s]=r,this.totals[s].dispose(),ao(n[s])}))}}class lhe extends tp{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,n){n==null&&(n={}),this.epoch.push(e);for(const s in n)this.history[s]==null&&(this.history[s]=[]),this.history[s].push(n[s])}async syncData(){const e=[],n=[],s=[];for(const i in this.history){const o=this.history[i];for(let a=0;a<o.length;++a)if(typeof o[a]!="number"){const l=o[a];e.push(l.data()),n.push(i),s.push(a)}}const r=await Promise.all(e);for(let i=0;i<r.length;++i)this.history[n[i]][s[i]].dispose(),this.history[n[i]][s[i]]=r[i][0]}}class che extends tp{constructor(e,n){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||jj,this.yieldEvery=n||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=ihe),this.yieldEvery==="never"&&e.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");Hk(this.yieldEvery)&&(this.maybeWait=Sde(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,n,s){const r=[];this.yield!=null&&(await Ll(s),r.push(this.yield(e,n,s))),r.push(this.nextFrameFunc()),await Promise.all(r)}async onEpochBegin(e,n){this.currentEpoch=e,this.epochBegin!=null&&(await Ll(n),await this.epochBegin(e,n))}async onEpochEnd(e,n){const s=[];this.epochEnd!=null&&(await Ll(n),s.push(this.epochEnd(e,n))),this.yieldEvery==="epoch"&&s.push(this.nextFrameFunc()),await Promise.all(s)}async onBatchBegin(e,n){this.batchBegin!=null&&(await Ll(n),await this.batchBegin(e,n))}async onBatchEnd(e,n){const s=[];this.batchEnd!=null&&(await Ll(n),s.push(this.batchEnd(e,n))),this.yieldEvery==="batch"?s.push(this.nextFrameFunc()):Hk(this.yieldEvery)&&s.push(this.maybeWait(this.currentEpoch,e,n)),await Promise.all(s)}async onTrainBegin(e){this.trainBegin!=null&&(await Ll(e),await this.trainBegin(e))}async onTrainEnd(e){this.trainEnd!=null&&(await Ll(e),await this.trainEnd(e))}}function FV(t,e){return t==null&&(t={}),t instanceof tp?[t]:Array.isArray(t)&&t[0]instanceof tp?t:dt(t).map(s=>new che(s,e))}class _r{constructor(){}static registerCallbackConstructor(e,n){E(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),_r.checkForDuplicate(n),_r.constructors[e]==null&&(_r.constructors[e]=[]),_r.constructors[e].push(n)}static checkForDuplicate(e){for(const n in _r.constructors)_r.constructors[+n].forEach(r=>{if(r===e)throw new M("Duplicate callback constructor.")})}static clear(){_r.constructors={}}static createCallbacks(e){const n=[];for(const s in _r.constructors){const r=+s;e>=r&&n.push(..._r.constructors[r])}return n.map(s=>new s)}}_r.constructors={};function _V(t,e,n,s,r,i,o,a,l){const c=new lhe,u=[new ahe,..._r.createCallbacks(e)];t!=null&&u.push(...t),u.push(c);const d=new ohe(u);return d.setParams({epochs:n,initialEpoch:s,samples:r,steps:i,batchSize:o,verbose:e,doValidation:a,metrics:l}),{callbackList:d,history:c}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ho(t,e={},n=!1){return Fm(t,Wr.getMap().classNameMap,e,"layer",n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function z0(t,e){return q(()=>{t.dtype!=="float32"&&(t=fe(t,"float32"));const n=Ce(zm(t),e,!0),s=$v(n.shape,yn()),r=rs(Cl(n,s));return Ie(t,r)})}function jv(t,e){return q(()=>ln(zm(De(e,t)),-1))}function i2(t,e){return q(()=>ln(ps(De(e,t)),-1))}function o2(t,e){return q(()=>{const n=De(t,e),s=Cr(ps(t),yn(),Number.MAX_VALUE),r=ps(Ie(n,s));return B(100,ln(r,-1))})}function uhe(t,e){return q(()=>{const n=Cr(e,yn(),Number.MAX_VALUE),s=go(ie(1,n)),r=Cr(t,yn(),Number.MAX_VALUE),i=go(ie(1,r));return ln(zm(De(s,i)),-1)})}function dhe(t,e){return q(()=>{const n=Cl(0,De(1,B(t,e)));return ln(zm(n),-1)})}function hhe(t,e){return q(()=>{const n=Cl(0,De(1,B(t,e)));return ln(n,-1)})}function fhe(t,e){return q(()=>{const n=Ce(B(t,e),-1),s=Ii(B(De(1,t),e),-1);return Cl(0,ie(1,De(s,n)))})}function phe(t,e){return q(()=>{const n=Math.log(2),s=De(e,t),r=De(ie(s,$m(B(-2,s))),n);return ln(r,-1)})}function np(t,e,n=!1){return q(()=>{if(n)e=cI(e);else{const s=Ce(e,e.shape.length-1,!0);e=Ie(e,s)}return e=Cr(e,yn(),1-yn()),en(Ce(B(fe(t,"float32"),go(e)),e.shape.length-1))})}function B0(t,e,n=!1){return q(()=>{const s=fe(Ov(Mde(t)),"int32");e=Cr(e,yn(),1-yn());const r=e.shape,i=W(aj(s,r[r.length-1]),r);return np(i,e,n)})}function mhe(t,e){if(!ct(t.shape,e.shape))throw new M(`logits and labels must have the same shape, but got shapes ${JSON.stringify(t.shape)} and ${JSON.stringify(e.shape)}`);return q(()=>{const n=Zc(e),s=en(ps(e));return ie(De(n,B(e,t)),sj(mo(s)))})}function Vv(t,e){return q(()=>{let n;return n=Cr(e,yn(),1-yn()),n=go(Ie(n,De(1,n))),ln(mhe(t,n),-1)})}function ghe(t,e){return q(()=>{const n=Cr(t,yn(),1),s=Cr(e,yn(),1);return Ce(B(t,go(Ie(n,s))),-1)})}function yhe(t,e){return q(()=>{const n=go(ie(yn(),e));return ln(De(e,B(t,n)),-1)})}function zV(t,e){return q(()=>{const n=z0(t,-1),s=z0(e,-1),r=B(n,s);return en(Ce(r,-1))})}const j0={meanSquaredError:jv,meanAbsoluteError:i2,meanAbsolutePercentageError:o2,meanSquaredLogarithmicError:uhe,squaredHinge:dhe,hinge:hhe,categoricalHinge:fhe,logcosh:phe,categoricalCrossentropy:np,sparseCategoricalCrossentropy:B0,binaryCrossentropy:Vv,kullbackLeiblerDivergence:ghe,poisson:yhe,cosineProximity:zV};function Nw(t){if(typeof t=="string"){if(t in j0)return j0[t];let e=`Unknown loss ${t}`;throw t.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${t}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new M(e)}else return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function BV(t,e){return q(()=>{const n=B(.5,ii(e)),s=co(Ir(e,n),t.dtype);return ln(po(t,s),-1)})}function jV(t,e){return q(()=>co(po(Jf(t,-1),Jf(e,-1)),"float32"))}function xhe(t,e){return q(()=>fe(Ce(na(po(t,1),po(e,1))),"float32"))}function bhe(t,e){return q(()=>fe(Ce(na(po(t,0),po(e,1))),"float32"))}function vhe(t,e){return q(()=>{const n=xhe(t,e),s=bhe(t,e),r=ie(n,s);return fe(ws(Ir(r,0),Ie(n,r),0),"float32")})}function whe(t,e){return Vv(t,e)}function She(t,e){return t.rank===e.rank&&(t=Dm(t,[t.rank-1])),e=Jf(e,-1),e.dtype!==t.dtype&&(e=fe(e,t.dtype)),fe(po(t,e),"float32")}const khe=jv,Che=jv,Nhe=i2,The=i2,Ehe=o2,Ihe=o2,VV=np,Ahe=zV,UV=B0,V0={binaryAccuracy:BV,categoricalAccuracy:jV,precision:vhe,categoricalCrossentropy:VV,sparseCategoricalCrossentropy:UV,mse:khe,MSE:Che,mae:Nhe,MAE:The,mape:Ehe,MAPE:Ihe,cosine:Ahe};function $he(t){if(typeof t=="string"&&t in V0)return V0[t];if(typeof t!="string"&&t!=null)return t;throw new M(`Unknown metric ${t}`)}function Mg(t){if(Ji(t!==null,`Unknown LossOrMetricFn ${t}`),typeof t=="string")return t;{let e;for(const n of Object.keys(j0))if(j0[n]===t){e=n;break}if(e!==void 0)return e;for(const n of Object.keys(V0))if(V0[n]===t){e=n;break}return e!==void 0?e:t.name}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Rhe(t){const e={Adagrad:()=>xu.adagrad(.01),Adadelta:()=>xu.adadelta(1,.95,yn()),Adam:()=>xu.adam(.001,.9,.999,yn()),Adamax:()=>xu.adamax(.002,.9,.999,yn(),0),RMSProp:()=>xu.rmsprop(.001,.9,0,yn()),SGD:()=>xu.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,t in e)return e[t]();throw new M(`Unknown Optimizer ${t}`)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const RO=1*1024*1024;function DO(t,e,n=!1){if(t==null||typeof t!="object"||Object.getPrototypeOf(t)!==Object.prototype||!xC(t))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){const s=JSON.stringify(t);s.length>RO&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${s.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${RO}.`)}}function xC(t){if(t===null)return!0;if(typeof t=="object")if(Object.getPrototypeOf(t)===Object.prototype){const e=Object.keys(t);for(const n of e)if(typeof n!="string"||!xC(t[n]))return!1;return!0}else if(Array.isArray(t)){for(const e of t)if(!xC(e))return!1;return!0}else return!1;else{const e=typeof t;return e==="string"||e==="number"||e==="boolean"}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Dhe(t,e,n,s=console.log){const r=Mhe(t),i=["Layer (type)","Input Shape","Output shape","Param #"];r?(e=e||90,n=n||[.32,.61,.89,1]):(e=e||115,n=n||[.24,.48,.7,.8,1]),n[n.length-1]<=1&&(n=n.map(u=>Math.floor(e*u)));let o;if(!r){i.push("Receives inputs"),o=[];for(const u in t.nodesByDepth)o.push(...t.nodesByDepth[u])}s("_".repeat(e)),U0(i,n,s),s("=".repeat(e));const a=t.layers;for(let u=0;u<a.length;++u)r?Phe(a[u],n,s):Lhe(a[u],n,o,s),s((u===a.length-1?"=":"_").repeat(e));t.checkTrainableWeightsConsistency();const l=Ohe(t),c=L0(t.nonTrainableWeights);s(`Total params: ${l+c}`),s(`Trainable params: ${l}`),s(`Non-trainable params: ${c}`),s("_".repeat(e))}function Ohe(t){let e;return t.collectedTrainableWeights!=null?e=L0(t.collectedTrainableWeights):e=L0(t.trainableWeights),e}function Mhe(t){let e=!0;const n=[],s=[];for(const r in t.nodesByDepth)n.push(t.nodesByDepth[r]);for(const r of n){if(r.length>1||r.length===1&&r[0].inboundLayers.length>1){e=!1;break}s.push(...r)}if(e)for(const r of t.layers){let i=!1;for(const o of r.inboundNodes)if(s.indexOf(o)!==-1)if(i){e=!1;break}else i=!0;if(!e)break}return e}function U0(t,e,n=console.log){let s="";for(let r=0;r<t.length;++r)r>0&&(s=s.slice(0,s.length-1)+" "),s+=t[r],s=s.slice(0,e[r]),s+=" ".repeat(e[r]-s.length);n(s)}function Phe(t,e,n){let s,r;try{r=t.inboundNodes.map(l=>JSON.stringify(l.inputShapes)).join(",")}catch{r="multiple"}try{s=JSON.stringify(t.outputShape)}catch{s="multiple"}const i=t.name,o=t.getClassName(),a=[`${i} (${o})`,r,s,t.countParams().toString()];U0(a,e,n)}function Lhe(t,e,n,s){let r,i;try{i=t.inboundNodes.map(d=>JSON.stringify(d.inputShapes)).join(",")}catch{i="multiple"}try{r=JSON.stringify(t.outputShape)}catch{r="multiple"}const o=[];for(const d of t.inboundNodes)if(!(n!=null&&n.length>0&&n.indexOf(d)===-1))for(let h=0;h<d.inboundLayers.length;++h){const f=d.inboundLayers[h].name,p=d.nodeIndices[h],m=d.tensorIndices[h];o.push(`${f}[${p}][${m}]`)}const a=t.name,l=t.getClassName(),c=o.length===0?"":o[0],u=[`${a} (${l})`,i,r,t.countParams().toString(),c];U0(u,e,s);for(let d=1;d<o.length;++d)U0(["","","","",o[d]],e,s)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function WV(t,e,n){return(t==="inboundNodes"||t==="outputLayers"||t==="inputLayers")&&e===0&&typeof n=="string"}function W0(t,e){if(t===null)return null;if(typeof t=="string")return Gl(t);if(typeof t=="number"||typeof t=="boolean")return t;if(t instanceof Array){const n=[],s=t.length;for(let r=0;r<s;++r){const i=t[r];WV(e,r,i)?n.push(i):n.push(W0(i,e))}return n}else{const n={};for(const s of Object.keys(t)){const r=t[s];if(s==="name"&&typeof r=="string")n[s]=r;else{const i=Gl(s);n[i]=W0(r,i)}}return n}}function bC(t,e){if(t==null)return null;if(typeof t=="string")return Fo(t);if(typeof t=="number"||typeof t=="boolean")return t;if(t instanceof Array){const n=[],s=t.length;for(let r=0;r<s;++r){const i=t[r];WV(e,r,i)?n.push(i):n.push(bC(i,e))}return n}else{const n={};for(const s of Object.keys(t)){const r=t[s],i=Fo(s);(s==="name"||s==="className")&&typeof r=="string"?n[i]=r:n[i]=bC(r,s)}return n}}/** @license See the LICENSE file. */const HV="4.22.0";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Fhe=t=>{const e=Object.keys(t);if(e.length===0)return!1;const n=e[0].split("/");return!isNaN(parseInt(n[n.length-1],10))};class fi extends Ke{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,this.name==null){const x=this.getClassName().toLowerCase();this.name=_v(x)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],Ja(this.inputs).length!==this.inputs.length)throw new M(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(x=>x.name)}`);Ja(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(x=>x.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const x of this.outputs){const v=x.sourceLayer,w=x.nodeIndex,S=x.tensorIndex;this.outputLayers.push(v),this.outputLayersNodeIndices.push(w),this.outputLayersTensorIndices.push(S)}for(const x of this.inputs){const v=x.sourceLayer,w=x.nodeIndex,S=x.tensorIndex;Ji(w===0,"input layer has >1 nodes"),Ji(S===0,"input layer has >1 tensors"),this.inputLayers.push(v),this.inputLayersNodeIndices.push(w),this.inputLayersTensorIndices.push(S)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let x=0;x<this.inputLayers.length;x++){const v=this.inputLayers[x];if(!(v instanceof jm))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${x} (0-based) originates from layer type ${v.getClassName()}.`);this.inputNames.push(v.name),this.feedInputShapes.push(v.batchInputShape),this.feedInputNames.push(v.name)}for(const x of this.outputLayers)this.outputNames.push(x.name);this.internalInputShapes=this.inputs.map(x=>x.shape),this.internalOutputShapes=this.outputs.map(x=>x.shape);const n={},s={},r={},i={},o={},a=[],l=(x,v,w,S,k,C)=>{(S==null||k==null||C==null)&&(S=x.sourceLayer,k=x.nodeIndex,C=x.tensorIndex);const N=S.inboundNodes[k];if(w.indexOf(N)!==-1)throw new Jr(`The tensor ${x.name} at layer "${S.name}" is part of a cycle.`);if(v.indexOf(N)!==-1)return;this.containerNodes.add(fi.nodeKey(S,k)),S.id in o||(o[S.id]=Object.keys(o).length),w.indexOf(N)===-1&&w.push(N);const T=N.inboundLayers.length;for(let I=0;I<T;I++){const D=N.inputTensors[I],F=N.inboundLayers[I],A=N.nodeIndices[I],O=N.tensorIndices[I];l(D,v,w,F,A,O)}for(v.push(N);w.indexOf(N)>=0;)w.splice(w.indexOf(N),1);a.push(N)},c=[],u=[];for(const x of this.outputs)l(x,c,u);const d=a.slice().reverse();for(const x of d){s[x.id]=x,x.id in n||(n[x.id]=0);let v=n[x.id];const w=r[x.outboundLayer.id]==null?0:r[x.outboundLayer.id];v=Math.max(v,w),r[x.outboundLayer.id]=v,i[x.outboundLayer.id]=x.outboundLayer,n[x.id]=v;for(let S=0;S<x.inboundLayers.length;S++){const k=x.inboundLayers[S],C=x.nodeIndices[S],N=k.inboundNodes[C],T=n[N.id]==null?0:n[N.id];n[N.id]=Math.max(v+1,T),s[N.id]=N}}const h={};for(const x in n){const v=n[x];v in h||(h[v]=[]),h[v].push(s[x])}const f={};for(const x in r){const v=r[x];v in f||(f[v]=[]),f[v].push(i[x])}let p=Object.keys(f).map(x=>parseInt(x,10)).sort(Rg);this.layers=[];for(const x of p){const v=f[x];v.sort((w,S)=>{const k=o[w.id],C=o[S.id];return k<C?-1:k>C?1:0});for(const w of v)w instanceof fi&&this.internalContainerRefs.push(w),this.layers.push(w)}this.layersByDepth=f,p=Object.keys(h).map(x=>parseInt(x,10)).sort(Rg);const m=this.inputs.slice(),g=[];for(const x of p)for(const v of h[x]){const w=v.outboundLayer;if(w!=null){for(const S of v.inputTensors)if(m.indexOf(S)===-1)throw new Jr(`Graph disconnected: cannot obtain value for tensor ${S} at layer "${w.name}". The following previous layers were accessed without issue: ${g}`);for(const S of v.outputTensors)m.push(S);g.push(w.name)}}this.nodesByDepth=h;const y=this.layers.map(x=>x.name);for(const x of y){const v=y.filter(w=>w===x).length;if(v!==1)throw new Jr(`The name "${x}" is used ${v} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(y))}this.outboundNodes=[],this.inboundNodes=[],new Bv({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(x=>null),outputMasks:this.outputs.map(x=>null),inputShapes:this.inputs.map(x=>x.shape),outputShapes:this.outputs.map(x=>x.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const n of this.layers)e.numDisposedVariables+=n.dispose().numDisposedVariables;for(const n of this.internalContainerRefs)e.numDisposedVariables+=n.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(n=>{n._trainableWeights.forEach(s=>s.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new M("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const n of this.layers)e=e.concat(n.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const n of this.layers)e.push(...n.nonTrainableWeights);if(!this.trainable){const n=[];for(const s of this.layers)n.push(...s.trainableWeights);return n.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,n=!0){const s={};let r=0;const i=Fhe(e);i&&this.parseWeights(e);for(const a of this.layers)for(const[l,c]of a.weights.entries()){const u=i?`${c.name.split("/").slice(0,-1).join("/")+"/"}${l}`:c.originalName;if(s[u]!=null)throw new M(`Duplicate weight name: ${u}`);s[u]=c,r++}const o=[];for(const a in e){let l=a;if(s[a]==null){const c=a.split("/");l=c.slice(0,-2).concat([c[c.length-1]]).join("/")}if(s[l]!=null)o.push([s[l],e[a]]);else if(n)throw new M(`Provided weight data has no target variable: ${a}`);delete s[l]}if(n){const a=[];for(const l in s)a.push(l);if(a.length>0)throw new M(`${a.length} of ${r} weights are not set: ${a}`)}s2(o)}parseWeights(e){for(const n in Object.keys(e)){const s=n.split("/"),r=["vars","layer_checkpoint_dependencies"],i=s.map(o=>o.startsWith("_")?o.slice(1):o).filter(o=>!r.includes(o)).join("/");i!==n&&(e[i]=e[n],delete e[n])}}updatedConfig(){const e=this.getConfig(),n={};return n.className=this.getClassName(),n.config=e,n.kerasVersion=`tfjs-layers ${HV}`,n.backend="TensorFlow.js",n}toJSON(e,n=!0){const s=bC(this.updatedConfig());return n?JSON.stringify(s):s}call(e,n){return q(()=>{e=dt(e);const s=new Da;for(let r=0;r<this.inputs.length;++r)s.add(this.inputs[r],e[r]);return Hh(this.outputs,s,n)})}computeMask(e,n){return q(()=>{e=dt(e);let s;return n==null?s=Pc(null,e.length):s=dt(n),this.runInternalGraph(e,s)[1]})}computeOutputShape(e){const n=P0(e);if(n.length!==this.inputLayers.length)throw new M(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);const s={};for(let a=0;a<n.length;a++){const l=this.inputLayers[a],c=n[a],u=l.name+"_0_0";s[u]=c}const r=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(Rg);if(r.length>1)for(const a of r){const l=this.nodesByDepth[a];for(const c of l){const u=c.outboundLayer;if(this.inputLayers.map(m=>m.id).indexOf(u.id)!==-1)continue;const d=[];for(let m=0;m<c.inboundLayers.length;m++){const g=c.inboundLayers[m],y=c.nodeIndices[m],x=c.tensorIndices[m],v=`${g.name}_${y}_${x}`,w=s[v];d.push(w)}const h=u.computeOutputShape(Os(d)),f=P0(h),p=u.inboundNodes.indexOf(c);for(let m=0;m<f.length;m++){const g=`${u.name}_${p}_${m}`;s[g]=f[m]}}}const i=[],o=[];for(let a=0;a<this.outputLayers.length;a++){const l=this.outputLayers[a],c=this.outputLayersNodeIndices[a],u=this.outputLayersTensorIndices[a],d=`${l.name}_${c}_${u}`;o.push(d)}for(let a=0;a<o.length;a++){const l=o[a];Ji(l in s),i.push(s[l])}return Os(i)}runInternalGraph(e,n){n==null&&(n=Pc(null,e.length));const s={};for(let l=0;l<this.inputs.length;++l){const c=this.inputs[l],u=e[l],d=n[l];s[c.id]=[u,d]}const r=Object.keys(this.nodesByDepth).map(l=>parseInt(l,10)).sort(Rg);for(const l of r){const c=this.nodesByDepth[l];for(const u of c){const d=u.outboundLayer,h=u.inputTensors,f=u.outputTensors,p=new Array;for(const m of h)m.id in s&&p.push(s[m.id]);if(p.length===h.length){let m={},g,y,x,v;if(u.callArgs!=null&&(m=u.callArgs),p.length===1){const[w,S]=p[0];m.mask==null&&(m.mask=S),x=dt(d.call(w,m)),v=dt(d.computeMask(w,S)),g=[w],y=[S]}else g=p.map(w=>w[0]),y=p.map(w=>w[1]),m.mask==null&&(m.mask=y),x=dt(d.call(g,m)),v=dt(d.computeMask(g,y));if(d.activityRegularizer)throw new ze("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let w=0;w<f.length;++w){const S=f[w],k=x[w],C=v[w];s[S.id]=[k,C]}}}}const i=[],o=[],a=[];for(const l of this.outputs){Ji(l.id in s,`Could not compute output ${l.name} : ${l.id}`);const[c,u]=s[l.id];a.push(c.shape),i.push(c),o.push(u)}return[i,o,a]}buildNodeConversionMap(e){const n={};let s;for(const r of this.layers){s=r instanceof fi?1:0;for(let i=0;i<r.inboundNodes.length;i++){const o=fi.nodeKey(r,i);this.containerNodes.has(o)&&(n[o]=s,s+=1)}}return n}getLayer(e,n){if(n!=null)return this.findLayer(n);if(e==null)throw new M("Provide either a layer name or layer index");if(typeof e=="number")return this.findLayer(e);for(const s of this.layers)if(s.name===e)return s;throw new M(`No such layer: ${e}`)}findLayer(e){if(this.layers.length<=e)throw new M(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}calculateLosses(){return q(()=>{const e=[];for(const n of this.layers)for(let s=0;s<n.inboundNodes.length;++s){const r=fi.nodeKey(n,s);this.containerNodes.has(r)&&e.push(...n.calculateLosses())}return e})}getConfig(){const e={name:this.name},n=this.buildNodeConversionMap(this.layers),s=[];for(const o of this.layers){const a=o.getClassName(),l=o.getConfig(),c=[];for(let d=0;d<o.inboundNodes.length;d++){const h=o.inboundNodes[d],f=fi.nodeKey(o,d);let p={};if(this.containerNodes.has(f)){if(h.callArgs)try{JSON.stringify(h.callArgs),p=h.callArgs}catch{console.warn(`Layer ${o.name} was passed non-serializable keyword arguments: ${h.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),p={}}if(h.inboundLayers.length>0){const m=[];for(let g=0;g<h.inboundLayers.length;g++){const y=h.inboundLayers[g],x=h.nodeIndices[g],v=h.tensorIndices[g],w=fi.nodeKey(y,x);let S=n[w];S==null&&(S=0),m.push([y.name,S,v,p])}c.push(m)}}}const u={};u.name=o.name,u.className=a,u.config=l,u.inboundNodes=c,s.push(u)}e.layers=s;const r=[];for(let o=0;o<this.inputLayers.length;o++){const a=this.inputLayers[o],l=this.inputLayersNodeIndices[o],c=fi.nodeKey(a,l);if(!this.containerNodes.has(c))continue;let u=n[c];u==null&&(u=0);const d=this.inputLayersTensorIndices[o];r.push([a.name,u,d])}e.inputLayers=r;const i=[];for(let o=0;o<this.outputLayers.length;o++){const a=this.outputLayers[o],l=this.outputLayersNodeIndices[o],c=fi.nodeKey(a,l);if(!this.containerNodes.has(c))continue;let u=n[c];u==null&&(u=0);const d=this.outputLayersTensorIndices[o];i.push([a.name,u,d])}return e.outputLayers=i,e}static fromConfig(e,n,s={},r=!1){const i={},o={};function a(g,y){g.name in o?o[g.name].push(y):o[g.name]=[y]}function l(g,y){const x=[];let v;for(const w of y){const S=w[0],k=w[1],C=w[2];if(v=w[3]==null?{}:w[3],!(S in i)){a(g,y);return}const N=i[S];if(N.inboundNodes.length<=k){a(g,y);return}const T=N.inboundNodes[k];x.push(T.outputTensors[C])}x.length>0&&g.apply(Os(x),v)}function c(g){const y=g.name,x=ho(g,n.customObjects!=null?n.customObjects:{});x.setFastWeightInitDuringBuild(r),i[y]=x,g.inboundNodes.forEach(w=>{if(!(w instanceof Array))throw new M(`Corrupted configuration, expected array for nodeData: ${w}`);a(x,w)})}const u=n.name,d=n.layers;for(const g of d)c(g);for(;!wde(o);)for(const g of d){const y=i[g.name];if(y.name in o){const x=o[y.name];delete o[y.name];for(const v of x)l(y,v)}}const h=[],f=[],p=n.inputLayers;for(const g of p){const y=g[0],x=g[1],v=g[2];Ji(y in i);const S=i[y].inboundNodes[x].outputTensors;h.push(S[v])}const m=n.outputLayers;for(const g of m){const y=g[0],x=g[1],v=g[2];Ji(y in i);const S=i[y].inboundNodes[x].outputTensors;f.push(S[v])}return new e({inputs:h,outputs:f,name:u})}get stateful(){if(this._stateful)throw new M("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){q(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function _he(t,e,n){const s=e.length;if(t==null||Array.isArray(t)&&t.length===0)return e.map(r=>null);if(s===1)return Array.isArray(t)&&t.length===1?t:typeof t=="object"&&e[0]in t?[t[e[0]]]:[t];if(Array.isArray(t)){if(t.length!==s)throw new Error(`Provided ${n} is an array of ${t.length} element(s), but the model has ${s} outputs. Make sure a set of weights is provided for each model output.`);return t}else if(typeof t=="object"&&Object.keys(t).length>0&&typeof t[Object.keys(t)[0]]=="object"){const r=[];return e.forEach(i=>{i in t?r.push(t[i]):r.push(null)}),r}else throw new Error(`The model has multiple (${s}) outputs, so ${n} must be either an array with ${s} elements or an object with ${e} keys. Provided ${n} not understood: ${JSON.stringify(t)}`)}function GV(t,e){return _he(t,e,"classWeight")}async function KV(t,e,n,s){if(e!=null||s!=null)throw new Error("Support sampleWeight is not implemented yet");if(n!=null){const r=q(()=>{if(t.shape.length===1)return uc(t);if(t.shape.length===2){if(t.shape[1]>1)return Jf(t,1);if(t.shape[1]===1)return W(t,[t.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${t.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${t.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),i=Array.from(await r.data());Ve(r);const o=[];return i.forEach(a=>{if(n[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);o.push(n[a])}),tr(o,"float32")}else return null}function zhe(t,e){return B(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Bhe=32;function qV(t,e){let n,s;const r=e;n=r.xs,s=r.ys,E(n!=null&&s!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`);const i=OO("input",t.inputNames,n),o=OO("output",t.outputNames,s),a=i[0].shape[0];E(i.length===t.inputs.length,()=>`LayersModel has ${t.inputs.length} inputs, but the dataset provides ${i.length} inputs.  (Expected input keys: ${JSON.stringify(t.inputNames)})`),E(o.length===t.outputs.length,()=>`LayersModel has ${t.outputs.length} outputs, but the dataset provides ${o.length} outputs.  (Expected output keys: ${JSON.stringify(t.outputNames)})`);for(let l=0;l<i.length;l++)E(i[l].shape[0]===a,()=>`Batch size mismatch: input ${t.inputNames[l]} has ${i[l].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`);for(let l=0;l<o.length;l++)E(o[l].shape[0]===a,()=>`Batch size mismatch: output ${t.outputNames[l]} has ${o[l].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`);return{xs:i,ys:o}}function OO(t,e,n){if(n instanceof pn)return[n];if(Array.isArray(n))return E(n.length===e.length,()=>`Received an array of ${n.length} Tensors, but expected ${e.length} to match the ${t} keys ${e}.`),n;{const s=[];for(const r of e){if(n[r]==null)throw new M(`The feature data generated by the dataset lacks the required ${t} key '${r}'.`);s.push(n[r])}return s}}function jhe(t){if(t.length===3)throw new ze("Validation with sample weights is not implemented yet.");return{xs:t[0],ys:t[1]}}async function Vhe(t,e,n){const s=n.batchesPerEpoch!=null;if(E(t.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),E(n!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),E(n.epochs!=null&&n.epochs>0&&Number.isInteger(n.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${n.epochs}`),E(!s||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${n.batchesPerEpoch}`),E(n.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");t.isTraining=!0;try{const r=n.validationData!=null;let i,o;if(r)if(MO(n.validationData))E(n.validationBatches==null||n.validationBatches>0&&Number.isInteger(n.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${n.validationBatches}`);else{const g=jhe(n.validationData);i=g.xs,o=g.ys}const a=t.makeTrainFunction(),l=t.getDedupedMetricsNames();let c;r?c=l.slice().concat(l.map(g=>"val_"+g)):c=l.slice();const u=FV(n.callbacks,n.yieldEvery),d=n.verbose==null?1:n.verbose,{callbackList:h,history:f}=_V(u,d,n.epochs,null,null,Uhe(e,n),null,r,c);h.setModel(t),t.history=f,await h.onTrainBegin(),t.stopTraining_=!1;let p=n.initialEpoch==null?0:n.initialEpoch,m=await e.iterator();for(;p<n.epochs;){const g={};await h.onEpochBegin(p);let y=0,x=0;for(s||(m=await e.iterator());!s||y<n.batchesPerEpoch;){const v=await m.next();if(s&&v.done){console.warn(`You provided \`batchesPerEpoch\` as ${n.batchesPerEpoch}, but your dataset iterator ran out of data after ${y} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${n.batchesPerEpoch*n.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(v.value!=null){const{xs:w,ys:S}=qV(t,v.value),k={};k.batch=x,k.size=w[0].shape[0],await h.onBatchBegin(x,k);const C=[];if(n.classWeight!=null){const I=GV(n.classWeight,t.outputNames);for(let D=0;D<I.length;++D)C.push(await KV(S[D],null,I[D]))}const N=w.concat(S).concat(C),T=a(N);Ve(N);for(let I=0;I<l.length;++I){const D=l[I],F=T[I];k[D]=F,ao(F)}await h.onBatchEnd(x,k),LV(k),x++,y++}if(s?y>=n.batchesPerEpoch:v.done){if(r){let w;MO(n.validationData)?w=dt(await t.evaluateDataset(n.validationData,{batches:n.validationBatches})):w=dt(t.evaluate(i,o,{batchSize:n.validationBatchSize==null?Bhe:n.validationBatchSize,verbose:0}));for(let S=0;S<t.metricsNames.length;++S)g[`val_${t.metricsNames[S]}`]=w[S]}break}if(t.stopTraining_)break}if(await h.onEpochEnd(p,g),p++,t.stopTraining_)break}return await h.onTrainEnd(),await t.history.syncData(),t.history}finally{t.isTraining=!1}}function Uhe(t,e){let n=null;return e.batchesPerEpoch!=null?n=e.batchesPerEpoch:Number.isFinite(t.size)&&(n=t.size),n}function MO(t){return typeof t.iterator=="function"}function Whe(t){return typeof t.next=="function"}async function Hhe(t,e,n){n=n||{};const s=n.batches!=null,r=t.testFunction;let i=[];if(n.verbose>0)throw new ze("Verbose mode is not implemented yet.");E(!s||n.batches>0&&Number.isInteger(n.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(n.batches)}`);const o=Whe(e)?e:await e.iterator();let a=0,l=0;for(;!s||l<n.batches;){const c=await o.next();if(i=q(()=>{if(c.value){const{xs:u,ys:d}=qV(t,c.value),h=u.concat(d),f=q(()=>r(h));if(Ve(h),l===0)for(let m=0;m<f.length;++m)i.push(lt(0));const p=h[0].shape[0];for(let m=0;m<f.length;++m){const g=f[m],y=i[m];i[m]=q(()=>ie(i[m],B(p,g))),l>0&&Ve(y)}Ve(f),a+=p,++l}return i}),c.done){s&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${n.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let c=0;c<i.length;++c){const u=i[c];i[c]=Ie(i[c],a),Ve(u)}return Os(i)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Tw(t){E(t>0&&Number.isInteger(t),()=>`batchSize is required to be a positive integer, but got ${t}`)}function Eh(t,e,n){return t==null?[null]:Array.isArray(t)?t.map(s=>hc(s,e,n-e)):hc(t,e,n-e)}function vC(t,e){return q(()=>t==null?null:Array.isArray(t)?t.map(n=>vC(n,e)):SV(t,e.dtype==="int32"?e:fe(e,"int32")))}function Ew(t,e){const n=[];let s=0,r=null;for(;s<t;)r=s+e,r>=t&&(r=t),n.push([s,r]),s=r;return n}function XV(t){const e=[];t instanceof pn&&(t=[t]);for(let n=0;n<t.length;++n){const s=t[n];if(s.rank===1)e.push(_m(s,1));else{if(s.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(s)}}return e}function hi(t,e){if(t==null)return;const n=[];if(e instanceof pn)n.push(e.id);else if(Array.isArray(e))e.forEach(r=>n.push(r.id));else if(e!=null)for(const r in e){const i=e[r];n.push(i.id)}const s=[];if(t instanceof pn)n.indexOf(t.id)===-1&&s.push(t);else if(Array.isArray(t))t.forEach(r=>{n.indexOf(r.id)===-1&&s.push(r)});else if(t!=null)for(const r in t){const i=t[r];n.indexOf(i.id)===-1&&s.push(i)}s.forEach(r=>{r.isDisposed||r.dispose()})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Ghe(t){return t instanceof pn}function wC(t){return Array.isArray(t)}function PO(t){return!Ghe(t)&&!wC(t)}function LO(t,e,n,s=!0,r=""){if(e==null||e.length===0){if(t!=null){let o=!1;if(wC(t)&&t.length>0)o=!0;else if(PO(t)){for(const a in t)if(t.hasOwnProperty(a)){o=!0;break}}else o=!0;if(o)throw new M(`Error when checking model ${r} expected no data, but got ${t}`)}return[]}if(t==null)return e.map(o=>null);let i;if(PO(t)){t=t,i=[];for(const o of e){if(t[o]==null)throw new M(`No data provided for "${o}". Need data for each key in: ${e}`);i.push(t[o])}}else if(wC(t)){if(t=t,t.length!==e.length)throw new M(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${t}`);i=t}else{if(t=t,e.length>1)throw new M(`The model ${r} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${t.shape}`);i=[t]}if(i=XV(i),n!=null)for(let o=0;o<e.length;++o){if(n[o]==null)continue;const a=i[o];if(a.shape.length!==n[o].length)throw new M(`Error when checking ${r}: expected ${e[o]} to have ${n[o].length} dimension(s). but got array with shape ${a.shape}`);for(let l=0;l<n[o].length;++l){if(l===0&&!s)continue;const c=a.shape[l],u=n[o][l];if(u!=null&&u>=0&&c!==u)throw new M(`${r} expected a batch of elements where each example has shape [${n[o].slice(1,n[o].length)}] (i.e.,tensor shape [*,${n[o].slice(1,n[o].length)}]) but the ${r} received an input with ${a.shape[0]} examples, each with shape [${a.shape.slice(1,a.shape.length)}] (tensor shape [${a.shape}])`)}}return i}function Khe(t,e,n){const s=Ja(t.map(i=>i.shape[0]));s.sort();const r=Ja(e.map(i=>i.shape[0]));if(r.sort(),s.length>1)throw new M(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map(i=>i.shape))}`);if(r.length>1)throw new M(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(i=>i.shape))}`);if(s.length>0&&r.length>0&&!ct(s,r))throw new M(`Input Tensors should have the same number of samples as target Tensors. Found ${s[0]} input sample(s) and ${r[0]} target sample(s).`)}function qhe(t,e,n){const s=[jv,Vv,np];for(let r=0;r<t.length;++r){const i=t[r],o=e[r],a=n[r];if(o!=null){if(o===np&&i.shape[i.shape.length-1]===1)throw new M(`You are passing a target array of shape ${i.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(s.indexOf(o)!==-1){const l=i.shape.slice(1),c=a.slice(1);for(let u=0;u<l.length;++u){const d=l[u],h=c[u];if(h!=null&&d!==h)throw new M(`A target Tensor with shape ${i.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function FO(t,e,n,s=!0,r=""){let i;if(Array.isArray(t)){if(t.length!==e.length)throw new M(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${t.length} Tensors(s).`);i=t}else{if(e.length>1)throw new M(`The model expects ${e.length} ${r} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(t.shape)}.`);i=[t]}if(n!=null)for(let o=0;o<e.length;++o){if(n[o]==null)continue;const a=i[o];if(a.shape.length!==n[o].length)throw new M(`Error when checking ${r}: expected ${e[o]} to have ${n[o].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let l=0;l<n[o].length;++l){if(l===0&&!s)continue;const c=a.shape[l],u=n[o][l];if(u!=null&&u!==c)throw new M(`Error when checking ${r}: expected ${e[o]} to have shape ${JSON.stringify(n[o])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function Xhe(t,e){if(t==null||Array.isArray(t)&&t.length===0)return e.map(s=>[]);let n;if(typeof t=="string"||typeof t=="function")n=[t];else if(Array.isArray(t)||typeof t=="object")n=t;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${t}`);if(Array.isArray(n))return e.map(s=>n);{const s=[];for(const r of e){let i=n.hasOwnProperty(r)?n[r]:[];Array.isArray(i)||(i=[i]),s.push(i)}return s}}const Jhe="layers-model";class rd extends fi{constructor(e){super(e),this.isTraining=!1}summary(e,n,s=console.log){if(!this.built)throw new M("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");Dhe(this,e,n,s)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=Rhe(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof Tl))throw new M("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let n=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(const o in e.loss)if(this.outputNames.indexOf(o)===-1)throw new M(`Unknown entry in loss dictionary: "${o}". Only expected the following keys: ${this.outputNames}`);for(const o of this.outputNames)e.loss[o]==null&&console.warn(`Output "${o}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${o} during training`),n.push(Nw(e.loss[o]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new M(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);n=e.loss.map(a=>Nw(a))}else{const o=Nw(e.loss);this.outputs.forEach(a=>{n.push(o)})}this.lossFunctions=n,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let o=0;o<this.outputs.length;++o){const a=this.internalOutputShapes[o],l=this.outputNames[o];this.feedOutputNames.push(l),this.feedOutputShapes.push(a),this.feedLossFns.push(this.lossFunctions[o])}const s=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],dc("loss",()=>{for(let o=0;o<this.outputs.length;++o){if(s.indexOf(o)!==-1)continue;const a=this.lossFunctions[o];this.outputs.length>1&&(this.metricsTensors.push([a,o]),this.metricsNames.push(this.outputNames[o]+"_loss"))}});const r=Xhe(e.metrics,this.outputNames),i=(o,a,l)=>{this.outputNames.length>1&&(a=this.outputNames[o]+"_"+a),this.metricsNames.push(a),this.metricsTensors.push([l,o])};dc("metric",()=>{for(let o=0;o<this.outputs.length;++o){if(s.indexOf(o)!==-1)continue;const a=r[o];(c=>{const u="";let d,h,f;for(const p of c){if(typeof p=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(p)!==-1){const g=this.internalOutputShapes[o];g[g.length-1]===1||this.lossFunctions[o]===Vv?["accuracy","acc"].indexOf(p)!==-1?h=BV:["crossentropy","ce"].indexOf(p)!==-1&&(h=whe):this.lossFunctions[o]===B0?["accuracy","acc"].indexOf(p)!==-1?h=She:["crossentropy","ce"].indexOf(p)!==-1&&(h=UV):["accuracy","acc"].indexOf(p)!==-1?h=jV:["crossentropy","ce"].indexOf(p)!==-1&&(h=VV);let y;["accuracy","acc"].indexOf(p)!==-1?y="acc":["crossentropy","ce"].indexOf(p)!==-1&&(y="ce"),f=h,d=u+y}else f=$he(p),d=u+Mg(p);let m;dc(d,()=>{m=f}),i(o,d,m)}})(a)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,n,s={}){const r=s.batchSize==null?32:s.batchSize;Tw(r);const i=!0,o=this.standardizeUserDataXY(e,n,i,r);try{const a=o[0].concat(o[1]);this.makeTestFunction();const l=this.testFunction,c=this.testLoop(l,a,r,s.verbose,s.steps);return Os(c)}finally{hi(o[0],e),hi(o[1],n)}}async evaluateDataset(e,n){return this.makeTestFunction(),Hhe(this,e,n)}checkNumSamples(e,n,s,r="steps"){let i;if(s!=null){if(i=null,n!=null)throw new M(`If ${r} is set, batchSize must be null or undefined.Got batchSize = ${n}`)}else if(e!=null)Array.isArray(e)?i=e[0].shape[0]:i=e.shape[0];else throw new M(`Either the input data should have a defined shape, or ${r} shoud be specified.`);return i}execute(e,n){if(Array.isArray(n)&&n.length===0)throw new M("`outputs` is an empty Array, which is not allowed.");const s=Array.isArray(n),r=s?n:[n],i=this.retrieveSymbolicTensors(r),o=new Da;if(e instanceof pn&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new M(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let l=0;l<this.inputs.length;++l)o.add(this.inputs[l],e[l])}else for(const l of this.inputs){const c=e[l.name];if(c==null)throw new M(`No value is provided for the model's input ${l.name}`);o.add(l,c)}const a=Hh(i,o);return s?a:a[0]}retrieveSymbolicTensors(e){const n=Pc(null,e.length);let s=e.length;for(const r of this.layers){const i=Array.isArray(r.output)?r.output:[r.output],o=i.map(a=>a.name);for(let a=0;a<e.length;++a){const l=o.indexOf(e[a]);if(l!==-1&&(n[a]=i[l],s--),s===0)break}if(s===0)break}if(s>0){const r=[];throw n.forEach((i,o)=>{i==null&&r.push(e[o])}),new M(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(r)}`)}return n}predictLoop(e,n=32,s=!1){return q(()=>{const r=this.checkNumSamples(e);if(s)throw new ze("Verbose predictLoop() is not implemented yet.");const i=Ew(r,n),o=this.outputs.map(a=>[]);for(let a=0;a<i.length;++a)q(()=>{const c=i[a][0],u=i[a][1],d=Eh(e,c,u),h=[];if(Array.isArray(d))for(let p=0;p<d.length;++p)h.push({key:this.inputs[p],value:d[p]});else h.push({key:this.inputs[0],value:d});const f=new Da(h);return Hh(this.outputs,f)}).forEach((c,u)=>o[u].push(c));return Os(o.map(a=>Ls(a,0)))})}predict(e,n={}){const s=XV(e);FO(s,this.inputNames,this.feedInputShapes,!1);try{const r=n.batchSize==null?32:n.batchSize;return Tw(r),this.predictLoop(s,r)}finally{hi(s,e)}}predictOnBatch(e){FO(e,this.inputNames,this.feedInputShapes,!0);const n=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,n)}standardizeUserDataXY(e,n,s=!0,r){if(this.optimizer_==null)throw new Jr("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const i=[];for(let o=0;o<this.feedOutputShapes.length;++o){const a=this.feedOutputShapes[o];this.feedLossFns[o]===B0?i.push(a.slice(0,a.length-1).concat([1])):i.push(a)}if(e=LO(e,this.feedInputNames,this.feedInputShapes,!1,"input"),n=LO(n,this.feedOutputNames,i,!1,"target"),Khe(e,n),qhe(n,this.feedLossFns,this.feedOutputShapes),this.stateful&&r!=null&&r>0&&e[0].shape[0]%r!==0)throw new M(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${r}. Found: ${e[0].shape[0]} sample(s).`);return[e,n]}async standardizeUserData(e,n,s,r,i=!0,o){const[a,l]=this.standardizeUserDataXY(e,n,i,o);if(s!=null)throw new Error("sample weight is not supported yet.");let c=null;if(r!=null){const u=GV(r,this.outputNames);c=[];for(let d=0;d<u.length;++d)c.push(await KV(l[d],null,u[d]))}return[a,l,c]}testLoop(e,n,s,r=0,i){return q(()=>{const o=this.checkNumSamples(n,s,i,"steps"),a=[];if(r>0)throw new ze("Verbose mode is not implemented yet.");if(i!=null)throw new ze("steps mode in testLoop() is not implemented yet");{const l=Ew(o,s),c=tr(Di(0,o));for(let u=0;u<l.length;++u){const d=l[u][0],h=l[u][1],f=hc(c,d,h-d),p=vC(n,f),m=e(p);if(u===0)for(let g=0;g<m.length;++g)a.push(lt(0));for(let g=0;g<m.length;++g){const y=m[g];a[g]=ie(a[g],B(h-d,y))}}for(let u=0;u<a.length;++u)a[u]=Ie(a[u],o)}return a})}getDedupedMetricsNames(){const e=this.metricsNames,n=[];for(let s=0;s<e.length;++s){const r=e[s];let i=r;if(wO(e,r)>1){const o=wO(e.slice(0,s),r);i+=`_${o}`}n.push(i)}return n}makeTrainFunction(){return e=>{const n=[],s=e.slice(0,this.inputs.length),r=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),o=[],a=()=>{const d=[];for(let m=0;m<this.inputs.length;++m)d.push({key:this.inputs[m],value:s[m]});const h=new Da(d),f=Hh(this.outputs,h,{training:!0});let p;for(let m=0;m<this.lossFunctions.length;++m){const g=this.lossFunctions[m];let y=g(r[m],f[m]);i[m]!=null&&(y=zhe(y,i[m]));const x=ln(y);n.push(x),m===0?p=y:p=ie(p,y)}for(let m=0;m<this.metricsTensors.length;++m){let g;if(this.outputs.length>1&&m<this.outputs.length)g=n[m];else{const y=this.metricsTensors[m][0],x=this.metricsTensors[m][1];g=ln(y(r[x],f[x]))}ao(g),o.push(g)}return p=ln(p),this.calculateLosses().forEach(m=>{p=ie(p,m)}),p},l=this.collectedTrainableWeights.map(d=>d.read()),c=!0;return[this.optimizer_.minimize(a,c,l)].concat(o)}}makeTestFunction(){this.testFunction=e=>q(()=>{const n=[];let s;const r=e.slice(0,this.inputs.length),i=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=[];for(let c=0;c<this.inputs.length;++c)o.push({key:this.inputs[c],value:r[c]});const a=new Da(o),l=Hh(this.outputs,a);for(let c=0;c<this.lossFunctions.length;++c){const u=this.lossFunctions[c],d=ln(u(i[c],l[c]));c===0?s=d:s=ie(s,d),n.push(s)}for(let c=0;c<this.metricsTensors.length;++c){const u=this.metricsTensors[c][0],d=this.metricsTensors[c][1],h=ln(u(i[d],l[d]));n.push(h)}return n})}async fit(e,n,s={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let r,i,o,a,l,c,u,d,h;try{const f=s.batchSize==null?32:s.batchSize;Tw(f);const p=!1,m=await this.standardizeUserData(e,n,s.sampleWeight,s.classWeight,p,f);r=m[0],i=m[1],h=m[2];let g=!1,y;if(s.validationData!=null&&s.validationData.length>0){if(g=!0,s.validationData.length===2)l=s.validationData[0],c=s.validationData[1];else throw s.validationData.length===3?new ze("validationData including sample weights is not supported yet."):new M(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${s.validationData} is invalid.`);const T=!0,I=await this.standardizeUserData(l,c,null,null,T,f);u=I[0],d=I[1],y=u.concat(d)}else if(s.validationSplit!=null&&s.validationSplit>0&&s.validationSplit<1){g=!0;const T=Math.floor(r[0].shape[0]*(1-s.validationSplit)),I=r[0].shape[0];u=Eh(r,T,I),o=r,r=Eh(r,0,T),d=Eh(i,T,I),a=i,i=Eh(i,0,T),y=u.concat(d)}else s.validationSteps!=null&&(g=!0);const x=r.concat(i).concat(h);this.checkTrainableWeightsConsistency();const v=this.makeTrainFunction(),w=this.getDedupedMetricsNames();let S,k;g?(this.makeTestFunction(),S=this.testFunction,k=w.slice().concat(w.map(T=>"val_"+T))):(S=null,y=[],k=w.slice());const C=FV(s.callbacks,s.yieldEvery);return await this.fitLoop(v,x,w,f,s.epochs,s.verbose,C,S,y,s.shuffle,k,s.initialEpoch,null,null)}finally{this.isTraining=!1,hi(r,e),hi(i,n),hi(o,e),hi(a,n),hi(u,l),hi(d,c),h!=null&&Ve(h)}}async fitLoop(e,n,s,r,i,o,a,l,c,u,d,h,f,p){r==null&&(r=32),i==null&&(i=1),u==null&&(u=!0),h==null&&(h=0);let m=!1;if(l!=null&&c!=null&&(m=!0),p!=null&&(m=!0,f==null))throw new M("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const g=this.checkNumSamples(n,r,f,"steps_per_epoch");let y;g!=null&&(y=Di(0,g)),o==null&&(o=1);const{callbackList:x,history:v}=_V(a,o,i,h,g,f,r,m,d);x.setModel(this),this.history=v,await x.onTrainBegin(),this.stopTraining_=!1;for(let w=h;w<i;++w){await x.onEpochBegin(w);const S={};if(f!=null)throw new ze("stepsPerEpoch mode is not implemented yet.");{if(u==="batch")throw new ze("batch shuffling is not implemneted yet");u&&xne(y);const k=tr(y),C=Ew(g,r);for(let N=0;N<C.length;++N){const T={};if(await x.onBatchBegin(N,T),q(()=>{const I=C[N][0],D=C[N][1],F=hc(k,I,D-I);T.batch=N,T.size=D-I;const A=vC(n,F),O=e(A);for(let P=0;P<s.length;++P){const L=s[P],G=O[P];T[L]=G,ao(G)}if(N===C.length-1&&m){const P=this.testLoop(l,c,r);for(let L=0;L<s.length;++L){const G=s[L],$=P[L];ao($),S["val_"+G]=$}}}),await x.onBatchEnd(N,T),LV(T),this.stopTraining_)break}k.dispose()}if(await x.onEpochEnd(w,S),this.stopTraining_)break}return await x.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,n){return Vhe(this,e,n)}async trainOnBatch(e,n){const s=await this.standardizeUserData(e,n),r=s[0],i=s[1],a=this.makeTrainFunction()(r.concat(i)),l=[];for(const c of a){const u=await c.data();l.push(u[0])}return Ve(a),hi(s[0],e),hi(s[1],n),Os(l)}getNamedWeights(e){const n=[],s=e!=null&&e.trainableOnly,r=s?this.trainableWeights:this.weights,i=this.getWeights(s);for(let o=0;o<r.length;++o)s&&!r[o].trainable||n.push({name:r[o].originalName,tensor:i[o]});return n}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const n=sC().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=n-sC().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=Fo(this.loss);else if(Array.isArray(this.loss)){for(const n of this.loss)if(typeof n!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(n=>Fo(n))}else{const n=Object.keys(this.loss);e={};const s=this.loss;for(const r of n)if(typeof s[r]=="string")e[r]=Fo(s[r]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[Fo(Mg(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>Fo(Mg(e)));{const e={};for(const n in this.metrics)e[n]=Fo(Mg(this.metrics[n]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const n=W0(e.optimizer_config),s=ho(n);let r;if(typeof e.loss=="string")r=Gl(e.loss);else if(Array.isArray(e.loss))r=e.loss.map(o=>Gl(o));else if(e.loss!=null){r={};for(const o in e.loss)r[o]=Gl(e.loss[o])}let i;if(Array.isArray(e.metrics))i=e.metrics.map(o=>Gl(o));else if(e.metrics!=null){i={};for(const o in e.metrics)i[o]=Gl(e.metrics[o])}this.compile({loss:r,metrics:i,optimizer:s})}async save(e,n){if(typeof e=="string"){const c=kse(e);if(c.length===0)throw new M(`Cannot find any save handlers for URL '${e}'`);if(c.length>1)throw new M(`Found more than one (${c.length}) save handlers for URL '${e}'`);e=c[0]}if(e.save==null)throw new M("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const s=await nO(this.getNamedWeights(n)),r=!1,i=null,a={modelTopology:this.toJSON(i,r),format:Jhe,generatedBy:`TensorFlow.js tfjs-layers v${HV}`,convertedBy:null};if((n==null?!1:n.includeOptimizer)&&this.optimizer!=null){a.trainingConfig=this.getTrainingConfig();const c="optimizer",{data:u,specs:d}=await nO(await this.optimizer.getWeights(),c);s.specs.push(...d),s.data=mse([s.data,u])}return this.userDefinedMetadata!=null&&(DO(this.userDefinedMetadata,this.name,!0),a.userDefinedMetadata=this.userDefinedMetadata),a.weightData=s.data,a.weightSpecs=s.specs,e.save(a)}setUserDefinedMetadata(e){DO(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}rd.className="Model";ne(rd);class JV extends rd{}JV.className="Functional";ne(JV);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function Yhe(t,e){if(e==null&&(e={}),typeof t=="string"){const n=Cse(t,e);if(n.length===0)n.push(rce(t,e));else if(n.length>1)throw new M(`Found more than one (${n.length}) load handlers for URL '${t}'`);t=n[0]}return Qhe(t,void 0,e)}async function Qhe(t,e,n){if(n==null&&(n={}),t.load==null)throw new M("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const s=await t.load();let r=s.modelTopology;r.model_config!=null&&(r=r.model_config);const i=n.strict==null?!0:n.strict,o=s.weightData!=null&&s.weightSpecs!=null&&i,a=ho(W0(r),e,o),l=s.trainingConfig;if(l!=null&&a.loadTrainingConfig(l),s.userDefinedMetadata!=null&&a.setUserDefinedMetadata(s.userDefinedMetadata),s.weightData!=null){if(s.weightSpecs==null)throw new M("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");const{modelWeights:c,optimizerWeights:u}=Zhe(s.weightData,s.weightSpecs);a.loadWeights(c,i),a.optimizer!=null&&u.length>0&&await a.optimizer.setWeights(u),Ve(c),Ve(u.map(d=>d.tensor))}return a}function Zhe(t,e){const n=cse(t,e),s={},r=[];return e.forEach(i=>{i.group==="optimizer"?r.push({name:i.name,tensor:n[i.name]}):s[i.name]=n[i.name]}),{modelWeights:s,optimizerWeights:r}}class sp extends rd{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:_v("sequential_"),e.layers!=null)for(const n of e.layers)this.add(n)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(s=>s<0))throw new M(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){const n=e instanceof sp||e instanceof rd;let s;if(n){if(s=e,s.outputs.length!==1)throw new M("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(s.inputs.length!==1)throw new M("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new M("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const r=Qde({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(r)}if(n)this.outputs=s.outputs,this.inputs=s.inputs;else{if(e.inboundNodes.length!==1)throw new M(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new M("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=RV(this.outputs[0])}this.inboundNodes=[],new Bv({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Pc(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(r=>r.shape),outputShapes:this.outputs[0].shape})}else{const r=e.apply(this.outputs[0]);if(Array.isArray(r))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[r],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,n){return this.model==null&&this.build(),this.model.call(e,n)}build(e){if(it(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new rd({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,n,s=console.log){this.built||this.build(),super.summary(e,n,s)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,n,s={}){if(!this.built)throw new Jr("The model needs to be compiled before being used.");return this.model.evaluate(e,n,s)}async evaluateDataset(e,n){if(!this.built)throw new Jr("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,n)}predict(e,n={}){return this.model==null&&this.build(),this.model.predict(e,n)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,n,s={}){if(!this.built)throw new Jr("The model needs to be compiled before being used.");return this.model.fit(e,n,s)}async fitDataset(e,n){if(!this.built)throw new Jr("The model needs to be compiled before being used.");return this.model.fitDataset(e,n)}async trainOnBatch(e,n){return this.model.trainOnBatch(e,n)}static fromConfig(e,n,s={},r=!1){let i,o={};if(n instanceof Array){if(n[0].className==null||n[0].className==="Merge")throw new M("Legacy serialization format not supported yet.");i=n}else E(n.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),i=n.layers,delete n.layers,o=n;const a=new e(o);if(!(a instanceof sp))throw new ze(`Sequential.fromConfig called on non-Sequential input: ${a}`);for(const l of i){const u=ho(l,void 0,r);r&&u.setFastWeightInitDuringBuild(!0),a.add(u)}return a}set stopTraining(e){if(this.model==null)throw new M("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new M("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const n of this.layers){const s={};s.className=n.getClassName(),s.config=n.getConfig(),e.push(s)}return{name:this.name,layers:e}}}sp.className="Sequential";ne(sp);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let as=class extends Qd{getConfig(){return{}}};class YV extends as{apply(e,n=1){return Lde(e,n)}}YV.className="elu";ne(YV);class QV extends as{apply(e){return fj(e)}}QV.className="selu";ne(QV);class ZV extends as{apply(e){return Zc(e)}}ZV.className="relu";ne(ZV);class e4 extends as{apply(e){return q(()=>Zf(6,Zc(e)))}}e4.className="relu6";ne(e4);class t4 extends as{apply(e){return e}}t4.className="linear";ne(t4);class n4 extends as{apply(e){return Xd(e)}}n4.className="sigmoid";ne(n4);class s4 extends as{apply(e){return _de(e)}}s4.className="hardSigmoid";ne(s4);class r4 extends as{apply(e){return $m(e)}}r4.className="softplus";ne(r4);class i4 extends as{apply(e){return Fde(e)}}i4.className="softsign";ne(i4);class o4 extends as{apply(e){return Iv(e)}}o4.className="tanh";ne(o4);let a2=class extends as{apply(e,n=-1){return cI(e,n)}};a2.className="softmax";ne(a2);class a4 extends as{apply(e,n=-1){return rj(e,n)}}a4.className="logSoftmax";ne(a4);class l4 extends as{apply(e){return q(()=>q(()=>{const n=Math.sqrt(2),s=B(.5,ie(1,ZB(Ie(e,n))));return B(e,s)}))}}l4.className="gelu";ne(l4);class c4 extends as{apply(e){return q(()=>B(.5,B(e,ie(1,Iv(B(rs(Ie(2,Math.PI)),ie(e,B(.044715,Dc(e,3)))))))))}}c4.className="gelu_new";ne(c4);class u4 extends as{apply(e){return q(()=>B(e,Iv($m(e))))}}u4.className="mish";ne(u4);class d4 extends as{apply(e,n=1){return q(()=>B(Xd(B(e,n)),e))}}d4.className="swish";ne(d4);function ll(t){return t.getClassName()}function Iw(t,e={}){return Fm(t,Wr.getMap().classNameMap,e,"activation")}function cl(t){if(t==null){const e={};return e.className="linear",e.config={},Iw(e)}if(typeof t=="string"){const e={};return e.className=t,e.config={},Iw(e)}else return t instanceof as?t:Iw(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function efe(t){if(t!=null&&typeof t!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${t}`)}class h4 extends Qd{}class f4 extends h4{constructor(e){super(),efe(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return q(()=>{let n=An([1]);return this.hasL1&&(n=ie(n,Ce(B(this.l1,ps(e))))),this.hasL2&&(n=ie(n,Ce(B(this.l2,zm(e))))),W(n,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,n){return new e({l1:n.l1,l2:n.l2})}}f4.className="L1L2";ne(f4);const _O={l1l2:"L1L2"};function xt(t){return KI(t)}function zO(t,e={}){return Fm(t,Wr.getMap().classNameMap,e,"regularizer")}function Mt(t){if(t==null)return null;if(typeof t=="string"){const n={className:t in _O?_O[t]:t,config:{}};return zO(n)}else return t instanceof h4?t:zO(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class p4 extends Ke{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,n){e=Oe(e);let s=Zc(e);return this.maxValue!=null&&(s=Cr(s,0,this.maxValue)),s}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},n=super.getConfig();return Object.assign(e,n),e}}p4.className="ReLU";ne(p4);class m4 extends Ke{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,n){const s=Oe(e);return KE(s,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},n=super.getConfig();return Object.assign(e,n),e}}m4.className="LeakyReLU";ne(m4);class g4 extends Ke{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=Ot(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=Mt(e.alphaRegularizer),this.alphaConstraint=wn(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new M(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=it(e);const n=e.slice(1);if(this.sharedAxes!=null)for(const r of this.sharedAxes)n[r-1]=1;this.alpha=this.addWeight("alpha",n,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const s={};if(this.sharedAxes!=null)for(let r=1;r<e.length;++r)s[r]=e[r];this.inputSpec=[new xn({ndim:e.length,axes:s})],this.built=!0}call(e,n){return e=Oe(e),ZE(e,this.alpha.read())}getConfig(){const e={alphaInitializer:zt(this.alphaInitializer),alphaRegularizer:xt(this.alphaRegularizer),alphaConstraint:vn(this.alphaConstraint),sharedAxes:this.sharedAxes},n=super.getConfig();return Object.assign(e,n),e}}g4.className="PReLU";ne(g4);let y4=class extends Ke{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new ze(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,n){const s=Oe(e);return Rv(s)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},n=super.getConfig();return Object.assign(e,n),e}};y4.className="ELU";ne(y4);class x4 extends Ke{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,n){const s=Oe(e);return B(s,fe(Ir(s,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},n=super.getConfig();return Object.assign(e,n),e}}x4.className="ThresholdedReLU";ne(x4);class b4 extends Ke{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new a2().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,n){return q(()=>{let s=Oe(e);const r=n.mask;if(r!=null){const i=B(De(Nl(s.shape),fe(r,s.dtype)),lt(-1e9));s=ie(s,i)}return this.axis instanceof Array?this.axis.length>1?mo(De(s,ij(s,this.axis,!0))):this.softmax(s,this.axis[0]):this.softmax(s,this.axis)})}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},n=super.getConfig();return Object.assign(e,n),e}}b4.className="Softmax";ne(b4);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function id(t,e,n){if(typeof t=="number")return Pc(t,e);if(t.length!==e)throw new M(`The ${n} argument must be an integer or tuple of ${e} integers. Received: ${t.length} elements.`);for(let s=0;s<e;++s){const r=t[s];if(!Dde(r))throw new M(`The ${n} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(t)} including a non-integer number ${r}`)}return t}function Ai(t,e,n,s,r=1){if(t==null)return t;const i=e+(e-1)*(r-1);let o;return n==="same"?o=t:o=t-i+1,Math.floor((o+s-1)/s)}function Yi(t,e,n,s){if(t==null)return null;if(s==="valid")t=t*e+al([n-e,0]);else if(s==="same")t=t*e;else throw new M(`Unsupport padding mode: ${s}.`);return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function l2(t,e){return q(()=>(sn(e),e==="channelsFirst"?nt(t,[0,2,3,1]):t))}function v4(t,e){return q(()=>(sn(e),e==="channelsFirst"?nt(t,[0,2,3,4,1]):t))}function tfe(t,e,n,s=1,r="valid",i,o=1){return q(()=>{if(i==null&&(i=Oi()),sn(i),t.shape.length!==3)throw new M(`The input of a conv1dWithBias operation should be 3, but is ${t.shape.length} instead.`);if(e.shape.length!==3)throw new M(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(n!=null&&n.shape.length!==1)throw new M(`The bias for a conv1dWithBias operation should be 1, but is ${n.shape.length} instead`);if(i==="channelsFirst"&&(t=nt(t,[0,2,1])),r==="causal")throw new ze("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=qB(t,e,s,r==="same"?"same":"valid","NWC",o);return n!=null&&(a=Fi(a,n)),a})}function BO(t,e,n,s=[1,1],r="valid",i,o,a=null){return q(()=>{if(i==null&&(i=Oi()),sn(i),t.rank!==3&&t.rank!==4)throw new M(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${t.rank}.`);if(e.rank!==3&&e.rank!==4)throw new M(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${t.rank}.`);let l=l2(t,i);if(r==="causal")throw new ze("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=tle({x:l,filter:e,strides:s,pad:r==="same"?"same":"valid",dilations:o,dataFormat:"NHWC",bias:n,activation:a}),i==="channelsFirst"&&(l=nt(l,[0,3,1,2])),l})}function nfe(t,e,n,s=[1,1,1],r="valid",i,o){return q(()=>{if(i==null&&(i=Oi()),sn(i),t.rank!==4&&t.rank!==5)throw new M(`conv3dWithBias expects input to be of rank 4 or 5, but received ${t.rank}.`);if(e.rank!==4&&e.rank!==5)throw new M(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${t.rank}.`);let a=v4(t,i);if(r==="causal")throw new ze("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=eie(a,e,s,r==="same"?"same":"valid","NDHWC",o),n!=null&&(a=Fi(a,n)),i==="channelsFirst"&&(a=nt(a,[0,4,1,2,3])),a})}class Uv extends Ke{constructor(e,n){if(super(n),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",Uv.verifyArgs(n),this.rank=e,Rn(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new ze(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=id(n.kernelSize,e,"kernelSize"),this.strides=id(n.strides==null?1:n.strides,e,"strides"),this.padding=n.padding==null?"valid":n.padding,Ar(this.padding),this.dataFormat=n.dataFormat==null?"channelsLast":n.dataFormat,sn(this.dataFormat),this.activation=cl(n.activation),this.useBias=n.useBias==null?!0:n.useBias,this.biasInitializer=Ot(n.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=wn(n.biasConstraint),this.biasRegularizer=Mt(n.biasRegularizer),this.activityRegularizer=Mt(n.activityRegularizer),this.dilationRate=id(n.dilationRate==null?1:n.dilationRate,e,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new M(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new M(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new M(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(e){if(Ji("kernelSize"in e,"required key 'kernelSize' not in config"),typeof e.kernelSize!="number"&&!qI(e.kernelSize,"number",1,3))throw new M(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:ll(this.activation),useBias:this.useBias,biasInitializer:zt(this.biasInitializer),biasRegularizer:xt(this.biasRegularizer),activityRegularizer:xt(this.activityRegularizer),biasConstraint:vn(this.biasConstraint)},n=super.getConfig();return Object.assign(e,n),e}}class Zd extends Uv{constructor(e,n){super(e,n),this.kernel=null,Zd.verifyArgs(n),this.filters=n.filters,Rn(this.filters,"filters"),this.kernelInitializer=Ot(n.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=wn(n.kernelConstraint),this.kernelRegularizer=Mt(n.kernelRegularizer)}build(e){e=it(e);const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null)throw new M(`The channel dimension of the input should be defined. Found ${e[n]}`);const s=e[n],r=this.kernelSize.concat([s,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[n]:s}}],this.built=!0}call(e,n){return q(()=>{e=Oe(e);let s;const r=this.bias==null?null:this.bias.read(),i=gV(this.activation.getClassName());if(i!=null&&this.rank===2)s=BO(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate,i);else{if(this.rank===1)s=tfe(e,this.kernel.read(),r,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)s=BO(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)s=nfe(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new ze("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(s=this.activation.apply(s))}return s})}computeOutputShape(e){e=it(e);const n=[],s=this.dataFormat==="channelsLast"?e.slice(1,e.length-1):e.slice(2);for(let i=0;i<s.length;++i){const o=Ai(s[i],this.kernelSize[i],this.padding,this.strides[i],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[i]);n.push(o)}let r=[e[0]];return this.dataFormat==="channelsLast"?(r=r.concat(n),r.push(this.filters)):(r.push(this.filters),r=r.concat(n)),r}getConfig(){const e={filters:this.filters,kernelInitializer:zt(this.kernelInitializer),kernelRegularizer:xt(this.kernelRegularizer),kernelConstraint:vn(this.kernelConstraint)},n=super.getConfig();return Object.assign(e,n),e}static verifyArgs(e){if(!("filters"in e)||typeof e.filters!="number"||e.filters<1)throw new M(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}}class Um extends Zd{constructor(e){super(2,e),Um.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!qI(e.kernelSize,"number",1,2))throw new M(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}Um.className="Conv2D";ne(Um);class Wm extends Zd{constructor(e){super(3,e),Wm.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new M(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}Wm.className="Conv3D";ne(Wm);class w4 extends Um{constructor(e){if(super(e),this.inputSpec=[new xn({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new M(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=it(e),e.length!==4)throw new M("Input should have rank 4; Received input shape: "+JSON.stringify(e));const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null)throw new M("The channel dimension of the inputs should be defined. Found `None`.");const s=e[n],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new xn({ndim:4,axes:{[n]:s}})],this.built=!0}call(e,n){return q(()=>{let s=Oe(e);if(s.shape.length!==4)throw new M(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,i=r[0];let o,a;this.dataFormat==="channelsFirst"?(o=2,a=3):(o=1,a=2);const l=r[o],c=r[a],u=this.kernelSize[0],d=this.kernelSize[1],h=this.strides[0],f=this.strides[1],p=Yi(l,h,u,this.padding),m=Yi(c,f,d,this.padding),g=[i,p,m,this.filters];this.dataFormat!=="channelsLast"&&(s=nt(s,[0,2,3,1]));let y=XB(s,this.kernel.read(),g,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(y=nt(y,[0,3,1,2])),this.bias!=null&&(y=Fi(y,this.bias.read(),this.dataFormat)),this.activation!=null&&(y=this.activation.apply(y)),y})}computeOutputShape(e){e=it(e);const n=e.slice();let s,r,i;this.dataFormat==="channelsFirst"?(s=1,r=2,i=3):(s=3,r=1,i=2);const o=this.kernelSize[0],a=this.kernelSize[1],l=this.strides[0],c=this.strides[1];return n[s]=this.filters,n[r]=Yi(n[r],l,o,this.padding),n[i]=Yi(n[i],c,a,this.padding),n}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}w4.className="Conv2DTranspose";ne(w4);class S4 extends Wm{constructor(e){if(super(e),this.inputSpec=[new xn({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new M(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=it(e),e.length!==5)throw new M("Input should have rank 5; Received input shape: "+JSON.stringify(e));const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null)throw new M("The channel dimension of the inputs should be defined. Found `None`.");const s=e[n],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new xn({ndim:5,axes:{[n]:s}})],this.built=!0}call(e,n){return q(()=>{let s=Oe(e);if(s.shape.length!==5)throw new M(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,i=r[0];let o,a,l;this.dataFormat==="channelsFirst"?(l=2,o=3,a=4):(l=1,o=2,a=3);const c=r[l],u=r[o],d=r[a],h=this.kernelSize[0],f=this.kernelSize[1],p=this.kernelSize[2],m=this.strides[0],g=this.strides[1],y=this.strides[2],x=Yi(c,m,h,this.padding),v=Yi(u,g,f,this.padding),w=Yi(d,y,p,this.padding),S=[i,x,v,w,this.filters];this.dataFormat!=="channelsLast"&&(s=nt(s,[0,2,3,4,1]));let k=sie(s,this.kernel.read(),S,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(k=nt(k,[0,4,1,2,3])),this.bias!==null&&(k=Fi(k,this.bias.read(),this.dataFormat)),this.activation!==null&&(k=this.activation.apply(k)),k})}computeOutputShape(e){e=it(e);const n=e.slice();let s,r,i,o;this.dataFormat==="channelsFirst"?(s=1,r=2,i=3,o=4):(s=4,r=1,i=2,o=3);const a=this.kernelSize[0],l=this.kernelSize[1],c=this.kernelSize[2],u=this.strides[0],d=this.strides[1],h=this.strides[2];return n[s]=this.filters,n[r]=Yi(n[r],u,a,this.padding),n[i]=Yi(n[i],d,l,this.padding),n[o]=Yi(n[o],h,c,this.padding),n}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}S4.className="Conv3DTranspose";ne(S4);class k4 extends Zd{constructor(e,n){if(super(e,n),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,n.filters==null)throw new M("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(n.kernelInitializer!=null||n.kernelRegularizer!=null||n.kernelConstraint!=null)throw new M("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(n.padding!=null&&n.padding!=="same"&&n.padding!=="valid")throw new M(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(n.padding)}`);this.depthMultiplier=n.depthMultiplier==null?1:n.depthMultiplier,this.depthwiseInitializer=Ot(n.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=Mt(n.depthwiseRegularizer),this.depthwiseConstraint=wn(n.depthwiseConstraint),this.pointwiseInitializer=Ot(n.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=Mt(n.pointwiseRegularizer),this.pointwiseConstraint=wn(n.pointwiseConstraint)}build(e){if(e=it(e),e.length<this.rank+2)throw new M(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null||e[n]<0)throw new M(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[n])}`);const s=e[n],r=this.kernelSize.concat([s,this.depthMultiplier]),i=[];for(let a=0;a<this.rank;++a)i.push(1);i.push(s*this.depthMultiplier,this.filters);const o=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,o,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",i,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,o,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,o,this.biasConstraint):this.bias=null,this.inputSpec=[new xn({ndim:this.rank+2,axes:{[n]:s}})],this.built=!0}call(e,n){return q(()=>{e=Oe(e);let s;if(this.rank===1)throw new ze("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=nt(e,[0,2,3,1])),s=pj(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(s=Fi(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),this.dataFormat==="channelsFirst"&&(s=nt(s,[0,3,1,2])),s})}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=zt(this.depthwiseInitializer),e.pointwiseInitializer=zt(this.pointwiseInitializer),e.depthwiseRegularizer=xt(this.depthwiseRegularizer),e.pointwiseRegularizer=xt(this.pointwiseRegularizer),e.depthwiseConstraint=vn(this.depthwiseConstraint),e.pointwiseConstraint=vn(this.pointwiseConstraint),e}}k4.className="SeparableConv";class C4 extends k4{constructor(e){super(2,e)}}C4.className="SeparableConv2D";ne(C4);class Wv extends Zd{constructor(e){super(1,e),Wv.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!qI(e.kernelSize,"number",1,1))throw new M(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}Wv.className="Conv1D";ne(Wv);class N4 extends Ke{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,n){return q(()=>{if(e=Oe(e),this.dataFormat==="channelsLast"){const s=Og(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return Og(s,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const s=Og(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return Og(s,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}N4.className="Cropping2D";ne(N4);class T4 extends Ke{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,sn(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,Ade(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){const n=e[2]==null?null:this.size[0]*e[2],s=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],n,s]}else{const n=e[1]==null?null:this.size[0]*e[1],s=e[2]==null?null:this.size[1]*e[2];return[e[0],n,s,e[3]]}}call(e,n){return q(()=>{let s=Oe(e);const r=s.shape;if(this.dataFormat==="channelsFirst"){s=nt(s,[0,2,3,1]);const i=this.size[0]*r[2],o=this.size[1]*r[3],a=this.interpolation==="nearest"?Uo.resizeNearestNeighbor(s,[i,o]):Uo.resizeBilinear(s,[i,o]);return nt(a,[0,3,1,2])}else{const i=this.size[0]*r[1],o=this.size[1]*r[2];return this.interpolation==="nearest"?Uo.resizeNearestNeighbor(s,[i,o]):Uo.resizeBilinear(s,[i,o])}})}getConfig(){const e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},n=super.getConfig();return Object.assign(e,n),e}}T4.className="UpSampling2D";ne(T4);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function sfe(t,e,n=[1,1],s="valid",r,i){return q(()=>{r==null&&(r=Oi()),sn(r);let o=l2(t,r);if(t.rank!==4)throw new M(`Input for depthwiseConv2d is required to be 4-D, but is instead ${t.rank}-D`);if(e.rank!==4)throw new M(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return o=UE(o,e,n,s==="same"?"same":"valid","NHWC",i),r==="channelsFirst"&&(o=nt(o,[0,3,1,2])),o})}class E4 extends Uv{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=Ot(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=wn(e.depthwiseConstraint),this.depthwiseRegularizer=Mt(e.depthwiseRegularizer)}build(e){if(e=it(e),e.length<4)throw new M(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);const n=this.dataFormat==="channelsFirst"?1:3;if(e[n]==null||e[n]<0)throw new M(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[n]}).`);const s=e[n],r=[this.kernelSize[0],this.kernelSize[1],s,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[s*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,n){return q(()=>{e=Oe(e);let s=sfe(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(s=Fi(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),s})}computeOutputShape(e){e=it(e);const n=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,i=Ai(n,this.kernelSize[0],this.padding,this.strides[0]),o=Ai(s,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],r,i,o]:[e[0],i,o,r]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=zt(this.depthwiseInitializer),e.depthwiseRegularizer=xt(this.depthwiseRegularizer),e.depthwiseConstraint=vn(this.depthwiseRegularizer),e}}E4.className="DepthwiseConv2D";ne(E4);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function I4(t,e,n,s){if(Array.isArray(t)){if(e!=null||n!=null)throw new M("When inputs is an array, neither initialState or constants should be provided");s!=null&&(n=t.slice(t.length-s,t.length),t=t.slice(0,t.length-s)),t.length>1&&(e=t.slice(1,t.length)),t=t[0]}function r(i){return i==null||Array.isArray(i)?i:[i]}return e=r(e),n=r(n),{inputs:t,initialState:e,constants:n}}function A4(t,e,n,s=!1,r,i,o=!1,a=!1){return q(()=>{const l=e.shape.length;if(l<3)throw new M(`Input should be at least 3D, but is ${l}D.`);const c=[1,0].concat(Di(2,l));if(e=nt(e,c),i!=null)throw new ze("The rnn() functoin of the deeplearn.js backend does not support constants yet.");o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),r!=null&&(r=fe(fe(r,"bool"),"float32"),r.rank===l-1&&(r=Ds(r,-1)),r=nt(r,c)),s&&(e=Oc(e,0),r!=null&&(r=Oc(r,0)));const u=[];let d,h=n;const f=e.shape[0],p=Mc(e);let m;r!=null&&(m=Mc(r));for(let y=0;y<f;++y){const x=p[y],v=q(()=>t(x,h));if(r==null)d=v[0],h=v[1];else{const w=q(()=>{const S=m[y],k=De(ii(S),S),C=ie(B(v[0],S),B(h[0],k)),N=h.map((T,I)=>ie(B(v[1][I],S),B(T,k)));return{output:C,newStates:N}});d=w.output,h=w.newStates}a&&u.push(d)}let g;return a&&(g=sa(u,1)),[d,g,h]})}class El extends Ke{constructor(e){super(e);let n;if(e.cell==null)throw new M("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?n=new d2({cells:e.cell}):n=e.cell,n.stateSize==null)throw new M("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=n,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new xn({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return Di(0,e).map(n=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){gC(e)&&(e=e[0]),e=e;let n=this.cell.stateSize;Array.isArray(n)||(n=[n]);const s=n[0];let r;if(this.returnSequences?r=[e[0],e[1],s]:r=[e[0],s],this.returnState){const i=[];for(const o of n)i.push([e[0],o]);return[r].concat(i)}else return r}computeMask(e,n){return q(()=>{Array.isArray(n)&&(n=n[0]);const s=this.returnSequences?n:null;if(this.returnState){const r=this.states.map(i=>null);return[s].concat(r)}else return s})}get states(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,n=[];for(let s=0;s<e;++s)n.push(null);return n}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new ze("Constants support is not implemented in RNN yet.");gC(e)&&(e=e[0]),e=e;const n=this.stateful?e[0]:null,s=e.slice(2);this.inputSpec[0]=new xn({shape:[n,null,...s]});const r=[e[0]].concat(e.slice(2));this.cell.build(r);let i;if(Array.isArray(this.cell.stateSize)?i=this.cell.stateSize:i=[this.cell.stateSize],this.stateSpec!=null){if(!ct(this.stateSpec.map(o=>o.shape[o.shape.length-1]),i))throw new M(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=i.map(o=>new xn({shape:[null,o]}));this.stateful&&this.resetStates()}resetStates(e,n=!1){q(()=>{if(!this.stateful)throw new Xi("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape[0];if(s==null)throw new M("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>An([s,r])):this.states_=[An([s,this.cell.stateSize])];else if(e==null)Ve(this.states_),this.keptStates!=null&&(Ve(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>An([s,r])):this.states_[0]=An([s,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new M(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);n===!0?this.keptStates.push(this.states_.slice()):Ve(this.states_);for(let r=0;r<this.states_.length;++r){const i=e[r],o=Array.isArray(this.cell.stateSize)?this.cell.stateSize[r]:this.cell.stateSize,a=[s,o];if(!ct(i.shape,a))throw new M(`State ${r} is incompatible with layer ${this.name}: expected shape=${a}, received shape=${i.shape}`);this.states_[r]=i}}this.states_=this.states_.map(r=>ao(r.clone()))})}apply(e,n){let s=n==null?null:n.initialState,r=n==null?null:n.constants;n==null&&(n={});const i=I4(e,s,r,this.numConstants);e=i.inputs,s=i.initialState,r=i.constants;let o=[],a=[];if(s!=null){n.initialState=s,o=o.concat(s),this.stateSpec=[];for(const c of s)this.stateSpec.push(new xn({shape:c.shape}));a=a.concat(this.stateSpec)}if(r!=null&&(n.constants=r,o=o.concat(r),this.numConstants=r.length),o[0]instanceof yo){const c=[e].concat(o),u=this.inputSpec.concat(a),d=this.inputSpec;this.inputSpec=u;const h=super.apply(c,n);return this.inputSpec=d,h}else return super.apply(e,n)}call(e,n){return q(()=>{const s=n==null?null:n.mask,r=n==null?null:n.training;let i=n==null?null:n.initialState;e=Oe(e),i==null&&(this.stateful?i=this.states_:i=this.getInitialState(e));const o=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(i.length!==o)throw new M(`RNN Layer has ${o} state(s) but was passed ${i.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const a={training:r},c=A4((p,m)=>{const g=this.cell.call([p].concat(m),a);return[g[0],g.slice(1)]},e,i,this.goBackwards,s,null,this.unroll,this.returnSequences),u=c[0],d=c[1],h=c[2];this.stateful&&this.resetStates(h,r);const f=this.returnSequences?d:u;return this.returnState?[f].concat(h):f})}getInitialState(e){return q(()=>{let n=An(e.shape);return n=Ce(n,[1,2]),n=_m(n),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(s=>s>1?pC(n,[1,s]):n):this.cell.stateSize>1?[pC(n,[1,this.cell.stateSize])]:[n]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),n={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(n.numConstants=this.numConstants);const s=this.cell.getConfig();return this.getClassName()===El.className&&(n.cell={className:this.cell.getClassName(),config:s}),Object.assign(Object.assign(Object.assign({},s),e),n)}static fromConfig(e,n,s={}){const r=n.cell,i=ho(r,s);return new e(Object.assign(n,{cell:i}))}}El.className="RNN";ne(El);class Hv extends Ke{}class c2 extends Hv{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Rn(this.units,"units"),this.activation=cl(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Ot(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Ot(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Ot(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Mt(e.kernelRegularizer),this.recurrentRegularizer=Mt(e.recurrentRegularizer),this.biasRegularizer=Mt(e.biasRegularizer),this.kernelConstraint=wn(e.kernelConstraint),this.recurrentConstraint=wn(e.recurrentConstraint),this.biasConstraint=wn(e.biasConstraint),this.dropout=Ed([1,al([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Ed([1,al([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=it(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,n){return q(()=>{if(e=e,e.length!==2)throw new M(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let s=e[1];e=e[0];const r=n.training==null?!1:n.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=ul({ones:()=>ii(e),rate:this.dropout,training:r,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=ul({ones:()=>ii(s),rate:this.recurrentDropout,training:r,dropoutFunc:this.dropoutFunc}));let i;const o=this.dropoutMask,a=this.recurrentDropoutMask;o!=null?i=uo(B(e,o),this.kernel.read()):i=uo(e,this.kernel.read()),this.bias!=null&&(i=Fi(i,this.bias.read())),a!=null&&(s=B(s,a));let l=ie(i,uo(s,this.recurrentKernel.read()));return this.activation!=null&&(l=this.activation.apply(l)),[l,l]})}getConfig(){const e=super.getConfig(),n={units:this.units,activation:ll(this.activation),useBias:this.useBias,kernelInitializer:zt(this.kernelInitializer),recurrentInitializer:zt(this.recurrentInitializer),biasInitializer:zt(this.biasInitializer),kernelRegularizer:xt(this.kernelRegularizer),recurrentRegularizer:xt(this.recurrentRegularizer),biasRegularizer:xt(this.biasRegularizer),activityRegularizer:xt(this.activityRegularizer),kernelConstraint:vn(this.kernelConstraint),recurrentConstraint:vn(this.recurrentConstraint),biasConstraint:vn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),n)}}c2.className="SimpleRNNCell";ne(c2);class $4 extends El{constructor(e){e.cell=new c2(e),super(e)}call(e,n){return q(()=>{this.cell.dropoutMask!=null&&(Ve(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Ve(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=n==null?null:n.mask,r=n==null?null:n.training,i=n==null?null:n.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}static fromConfig(e,n){return new e(n)}}$4.className="SimpleRNN";ne($4);class u2 extends Hv{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new M("GRUCell does not support reset_after parameter set to true.");this.units=e.units,Rn(this.units,"units"),this.activation=cl(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=cl(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Ot(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Ot(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Ot(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Mt(e.kernelRegularizer),this.recurrentRegularizer=Mt(e.recurrentRegularizer),this.biasRegularizer=Mt(e.biasRegularizer),this.kernelConstraint=wn(e.kernelConstraint),this.recurrentConstraint=wn(e.recurrentConstraint),this.biasConstraint=wn(e.biasConstraint),this.dropout=Ed([1,al([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Ed([1,al([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=it(e);const n=e[e.length-1];this.kernel=this.addWeight("kernel",[n,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,n){return q(()=>{if(e=e,e.length!==2)throw new M(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);const s=n.training==null?!1:n.training;let r=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=ul({ones:()=>ii(e),rate:this.dropout,training:s,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=ul({ones:()=>ii(r),rate:this.recurrentDropout,training:s,count:3,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,o=this.recurrentDropoutMask;let a,l,c;0<this.dropout&&this.dropout<1&&(e=B(e,i[0]));let u=uo(e,this.kernel.read());this.useBias&&(u=Fi(u,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(r=B(r,o[0]));const d=this.recurrentKernel.read(),[h,f]=wr(d,[2*this.units,this.units],d.rank-1),p=uo(r,h),[m,g,y]=wr(u,3,u.rank-1),[x,v]=wr(p,2,p.rank-1);a=this.recurrentActivation.apply(ie(m,x)),l=this.recurrentActivation.apply(ie(g,v));const w=uo(B(l,r),f);c=this.activation.apply(ie(y,w));const S=ie(B(a,r),B(ie(1,en(a)),c));return[S,S]})}getConfig(){const e=super.getConfig(),n={units:this.units,activation:ll(this.activation),recurrentActivation:ll(this.recurrentActivation),useBias:this.useBias,kernelInitializer:zt(this.kernelInitializer),recurrentInitializer:zt(this.recurrentInitializer),biasInitializer:zt(this.biasInitializer),kernelRegularizer:xt(this.kernelRegularizer),recurrentRegularizer:xt(this.recurrentRegularizer),biasRegularizer:xt(this.biasRegularizer),activityRegularizer:xt(this.activityRegularizer),kernelConstraint:vn(this.kernelConstraint),recurrentConstraint:vn(this.recurrentConstraint),biasConstraint:vn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),n)}}u2.className="GRUCell";ne(u2);class R4 extends El{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new u2(e),super(e)}call(e,n){return q(()=>{this.cell.dropoutMask!=null&&(Ve(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Ve(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=n==null?null:n.mask,r=n==null?null:n.training,i=n==null?null:n.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}static fromConfig(e,n){return n.implmentation===0&&(n.implementation=1),new e(n)}}R4.className="GRU";ne(R4);class Gv extends Hv{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,Rn(this.units,"units"),this.activation=cl(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=cl(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Ot(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Ot(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Ot(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=Mt(e.kernelRegularizer),this.recurrentRegularizer=Mt(e.recurrentRegularizer),this.biasRegularizer=Mt(e.biasRegularizer),this.kernelConstraint=wn(e.kernelConstraint),this.recurrentConstraint=wn(e.recurrentConstraint),this.biasConstraint=wn(e.biasConstraint),this.dropout=Ed([1,al([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Ed([1,al([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var n;e=it(e);const s=e[e.length-1];this.kernel=this.addWeight("kernel",[s,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let r;if(this.useBias){if(this.unitForgetBias){const i=this.biasInitializer,o=this.units;r=new(n=class extends li{apply(l,c){const u=i.apply([o]),d=new JI().apply([o]),h=i.apply([o*2]);return kO(kO(u,d),h)}},n.className="CustomInit",n)}else r=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,r,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,n){return q(()=>{const s=n.training==null?!1:n.training;if(e=e,e.length!==3)throw new M(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let r=e[1];const i=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=ul({ones:()=>ii(e),rate:this.dropout,training:s,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=ul({ones:()=>ii(r),rate:this.recurrentDropout,training:s,count:4,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,a=this.recurrentDropoutMask;let l,c,u,d;0<this.dropout&&this.dropout<1&&(e=B(e,o[0]));let h=uo(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(r=B(r,a[0])),h=ie(h,uo(r,this.recurrentKernel.read())),this.useBias&&(h=Fi(h,this.bias.read()));const[f,p,m,g]=wr(h,4,h.rank-1);l=this.recurrentActivation.apply(f),c=this.recurrentActivation.apply(p),u=ie(B(c,i),B(l,this.activation.apply(m))),d=this.recurrentActivation.apply(g);const y=B(d,this.activation.apply(u));return[y,y,u]})}getConfig(){const e=super.getConfig(),n={units:this.units,activation:ll(this.activation),recurrentActivation:ll(this.recurrentActivation),useBias:this.useBias,kernelInitializer:zt(this.kernelInitializer),recurrentInitializer:zt(this.recurrentInitializer),biasInitializer:zt(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:xt(this.kernelRegularizer),recurrentRegularizer:xt(this.recurrentRegularizer),biasRegularizer:xt(this.biasRegularizer),activityRegularizer:xt(this.activityRegularizer),kernelConstraint:vn(this.kernelConstraint),recurrentConstraint:vn(this.recurrentConstraint),biasConstraint:vn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),n)}}Gv.className="LSTMCell";ne(Gv);class D4 extends El{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Gv(e),super(e)}call(e,n){return q(()=>{this.cell.dropoutMask!=null&&(Ve(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Ve(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=n==null?null:n.mask,r=n==null?null:n.training,i=n==null?null:n.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}static fromConfig(e,n){return n.implmentation===0&&(n.implementation=1),new e(n)}}D4.className="LSTM";ne(D4);class d2 extends Hv{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const n of this.cells.slice().reverse())Array.isArray(n.stateSize)?e.push(...n.stateSize):e.push(n.stateSize);return e}call(e,n){return q(()=>{e=e;let s=e.slice(1);const r=[];for(const a of this.cells.slice().reverse())Array.isArray(a.stateSize)?r.push(s.splice(0,a.stateSize.length)):r.push(s.splice(0,1));r.reverse();const i=[];let o;for(let a=0;a<this.cells.length;++a){const l=this.cells[a];s=r[a],a===0?o=[e[0]].concat(s):o=[o[0]].concat(s),o=l.call(o,n),i.push(o.slice(1))}s=[];for(const a of i.slice().reverse())s.push(...a);return[o[0]].concat(s)})}build(e){gC(e)&&(e=e[0]),e=e;let n;this.cells.forEach((s,r)=>{dc(`RNNCell_${r}`,()=>{s.build(e),Array.isArray(s.stateSize)?n=s.stateSize[0]:n=s.stateSize,e=[e[0],n]})}),this.built=!0}getConfig(){const e=super.getConfig(),n=i=>({className:i.getClassName(),config:i.getConfig()}),r={cells:this.cells.map(n)};return Object.assign(Object.assign({},e),r)}static fromConfig(e,n,s={}){const r=[];for(const i of n.cells)r.push(ho(i,s));return new e({cells:r})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const n of this.cells)e.push(...n.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const n of this.cells)e.push(...n.nonTrainableWeights);if(!this.trainable){const n=[];for(const s of this.cells)n.push(...s.trainableWeights);return n.concat(e)}return e}getWeights(){const e=[];for(const n of this.cells)e.push(...n.weights);return yC(e)}setWeights(e){const n=[];for(const s of this.cells){const r=s.weights.length,i=e.splice(r);for(let o=0;o<s.weights.length;++o)n.push([s.weights[o],i[o]])}s2(n)}}d2.className="StackedRNNCells";ne(d2);function ul(t){const{ones:e,rate:n,training:s=!1,count:r=1,dropoutFunc:i}=t,o=()=>i!=null?i(e(),n):kV(e(),n),a=()=>Bm(o,e,s);return!r||r<=1?ao(a().clone()):Array(r).fill(void 0).map(a).map(c=>ao(c.clone()))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var rfe=globalThis&&globalThis.__rest||function(t,e){var n={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(n[s]=t[s]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(t);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(t,s[r])&&(n[s[r]]=t[s[r]]);return n};class O4 extends El{constructor(e){if(e.unroll)throw new ze("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new ze("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new xn({ndim:5})]}call(e,n){return q(()=>{if(this.cell.dropoutMask!=null&&(Ve(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Ve(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),n&&n.constants)throw new M("ConvRNN2D cell does not support constants");const s=n==null?null:n.mask,r=n==null?null:n.training,i=n==null?null:n.initialState;return super.call(e,{mask:s,training:r,initialState:i})})}computeOutputShape(e){let n=this.computeSingleOutputShape(e);return this.returnSequences||(n=[n[0],...n.slice(2)]),this.returnState&&(n=[n,...Array(2).fill([e[0],...n.slice(-3)])]),n}getInitialState(e){return q(()=>{const{stateSize:n}=this.cell,s=e.shape,r=this.computeSingleOutputShape(s),i=[r[0],...r.slice(2)],o=An(i);return Array.isArray(n)?Array(n.length).fill(o):[o]})}resetStates(e,n=!1){q(()=>{if(!this.stateful)throw new Xi("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape,r=this.computeSingleOutputShape(s),i=[r[0],...r.slice(2)];if(s[0]==null)throw new M("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>An(i)):this.states_=[An(i)];else if(e==null)Ve(this.states_),this.keptStates!=null&&(Ve(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>An(i)):this.states_[0]=An(i);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new M(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);n?this.keptStates.push(this.states_.slice()):Ve(this.states_);for(let a=0;a<this.states_.length;++a){const l=e[a],c=i;if(!ct(l.shape,c))throw new M(`State ${a} is incompatible with layer ${this.name}: expected shape=${c}, received shape=${l.shape}`);this.states_[a]=l}}this.states_=this.states_.map(a=>ao(a.clone()))})}computeSingleOutputShape(e){const{dataFormat:n,filters:s,kernelSize:r,padding:i,strides:o,dilationRate:a}=this.cell,l=n==="channelsFirst",c=e[l?3:2],u=e[l?4:3],d=Ai(c,r[0],i,o[0],a[0]),h=Ai(u,r[1],i,o[1],a[1]);return[...e.slice(0,2),...l?[s,d,h]:[d,h,s]]}}O4.className="ConvRNN2D";class h2 extends Gv{constructor(e){const{filters:n,kernelSize:s,strides:r,padding:i,dataFormat:o,dilationRate:a}=e;super(Object.assign(Object.assign({},e),{units:n})),this.filters=n,Rn(this.filters,"filters"),this.kernelSize=id(s,2,"kernelSize"),this.kernelSize.forEach(l=>Rn(l,"kernelSize")),this.strides=id(r||1,2,"strides"),this.strides.forEach(l=>Rn(l,"strides")),this.padding=i||"valid",Ar(this.padding),this.dataFormat=o||"channelsLast",sn(this.dataFormat),this.dilationRate=id(a||1,2,"dilationRate"),this.dilationRate.forEach(l=>Rn(l,"dilationRate"))}build(e){var n;e=it(e);const s=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[s]==null)throw new M(`The channel dimension of the input should be defined. Found ${e[s]}`);const r=e[s],i=4,o=this.kernelSize.concat([r,this.filters*i]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const a=this.kernelSize.concat([this.filters,this.filters*i]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let l;if(this.unitForgetBias){const c=this.biasInitializer,u=this.filters;l=new(n=class extends li{apply(h,f){const p=c.apply([u]),m=Nl([u]),g=c.apply([u*2]);return XI([p,m,g])}},n.className="CustomInit",n)}else l=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*i],null,l,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,n){return q(()=>{if(e.length!==3)throw new M(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);const s=n.training||!1,r=e[0],i=e[1],o=e[2],a=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=ul({ones:()=>ii(r),rate:this.dropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const l=this.dropoutMask,c=(K,j,ee)=>!j||!j[ee]?K:B(j[ee],K);let u=c(r,l,0),d=c(r,l,1),h=c(r,l,2),f=c(r,l,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=ul({ones:()=>ii(i),rate:this.recurrentDropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const p=this.recurrentDropoutMask;let m=c(i,p,0),g=c(i,p,1),y=c(i,p,2),x=c(i,p,3);const v=3,[w,S,k,C]=wr(this.kernel.read(),a,v),[N,T,I,D]=this.useBias?wr(this.bias.read(),a):[null,null,null,null];u=this.inputConv(u,w,N,this.padding),d=this.inputConv(d,S,T,this.padding),h=this.inputConv(h,k,I,this.padding),f=this.inputConv(f,C,D,this.padding);const[F,A,O,P]=wr(this.recurrentKernel.read(),a,v);m=this.recurrentConv(m,F),g=this.recurrentConv(g,A),y=this.recurrentConv(y,O),x=this.recurrentConv(x,P);const L=this.recurrentActivation.apply(ie(u,m)),G=this.recurrentActivation.apply(ie(d,g)),$=ie(B(G,o),B(L,this.activation.apply(ie(h,y)))),U=B(this.recurrentActivation.apply(ie(f,x)),this.activation.apply($));return[U,U,$]})}getConfig(){const e=super.getConfig(),n=rfe(e,["units"]),s={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},n),s)}inputConv(e,n,s,r){const i=Rc(e,n,this.strides,r||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return s?Fi(i,s,this.dataFormat):i}recurrentConv(e,n){return Rc(e,n,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}h2.className="ConvLSTM2DCell";ne(h2);class M4 extends O4{constructor(e){const n=new h2(e);super(Object.assign(Object.assign({},e),{cell:n}))}static fromConfig(e,n){return new e(n)}}M4.className="ConvLSTM2D";ne(M4);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class f2 extends Ke{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;const n=e.shape,s=[];for(let r=0;r<this.noiseShape.length;++r)s.push(this.noiseShape[r]==null?n[r]:this.noiseShape[r]);return s}call(e,n){return q(()=>{this.invokeCallHook(e,n);const s=Oe(e);if(0<this.rate&&this.rate<1){const r=n.training==null?!1:n.training,i=this.getNoiseShape(s);return Bm(()=>kV(s,this.rate,i,this.seed),()=>s,r)}return e})}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},n=super.getConfig();return Object.assign(e,n),e}dispose(){return super.dispose()}}f2.className="Dropout";ne(f2);class P4 extends f2{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const n=e.shape;return[n[0],1,n[2]]}}P4.className="SpatialDropout1D";ne(P4);class L4 extends Ke{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let n=null;e.batchSize!=null&&(n=e.batchSize),this.batchInputShape=[n,e.inputDim]}this.units=e.units,Rn(this.units,"units"),this.activation=cl(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=Ot(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=Ot(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=wn(e.kernelConstraint),this.biasConstraint=wn(e.biasConstraint),this.kernelRegularizer=Mt(e.kernelRegularizer),this.biasRegularizer=Mt(e.biasRegularizer),this.activityRegularizer=Mt(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=it(e);const n=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[n,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:n}}],this.built=!0}computeOutputShape(e){e=it(e);const n=e.slice();return n[n.length-1]=this.units,n}call(e,n){return q(()=>{this.invokeCallHook(e,n);const s=Oe(e),r=gV(this.activation.getClassName());let i;return r!=null?i=uo(s,this.kernel.read(),r,this.bias?this.bias.read():null):(i=uo(s,this.kernel.read()),this.bias!=null&&(i=Fi(i,this.bias.read())),this.activation!=null&&(i=this.activation.apply(i))),i})}getConfig(){const e={units:this.units,activation:ll(this.activation),useBias:this.useBias,kernelInitializer:zt(this.kernelInitializer),biasInitializer:zt(this.biasInitializer),kernelRegularizer:xt(this.kernelRegularizer),biasRegularizer:xt(this.biasRegularizer),activityRegularizer:xt(this.activityRegularizer),kernelConstraint:vn(this.kernelConstraint),biasConstraint:vn(this.biasConstraint)},n=super.getConfig();return Object.assign(e,n),e}}L4.className="Dense";ne(L4);class F4 extends Ke{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=it(e);for(const n of e.slice(1))if(n==null)throw new M(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],Ya(e,1)]}call(e,n){return q(()=>{this.invokeCallHook(e,n);let s=Oe(e);if(this.dataFormat==="channelsFirst"&&s.rank>1){const r=[0];for(let i=2;i<s.rank;++i)r.push(i);r.push(1),s=nt(s,r)}return Pde(s)})}getConfig(){const e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);const n=super.getConfig();return Object.assign(e,n),e}}F4.className="Flatten";ne(F4);class _4 extends Ke{constructor(e){super(e),this.supportsMasking=!0,this.activation=cl(e.activation)}call(e,n){return q(()=>{this.invokeCallHook(e,n);const s=Oe(e);return this.activation.apply(s)})}getConfig(){const e={activation:ll(this.activation)},n=super.getConfig();return Object.assign(e,n),e}}_4.className="Activation";ne(_4);class z4 extends Ke{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,n){return q(()=>(e=Oe(e),Ode(e,this.n)))}getConfig(){const e={n:this.n},n=super.getConfig();return Object.assign(e,n),e}}z4.className="RepeatVector";ne(z4);class B4 extends Ke{constructor(e){super(e),this.targetShape=e.targetShape;for(let n=0;n<this.targetShape.length;++n)this.isUnknown(this.targetShape[n])&&(this.targetShape[n]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,n){const s="Total size of new array must be unchanged.",r=n.slice();let i=1,o=null;for(let l=0;l<r.length;++l){const c=r[l];if(this.isUnknown(c))if(o===null)o=l;else throw new M("Can only specifiy one unknown dimension.");else i*=c}const a=Ya(e);if(o!==null){if(i===0||a%i!==0)throw new M(s);r[o]=a/i}else if(a!==i)throw new M(s);return r}computeOutputShape(e){let n=!1;for(let s=0;s<e.length;++s)if(this.isUnknown(e[s])){n=!0;break}return n?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,n){return q(()=>{this.invokeCallHook(e,n);const s=Oe(e),r=s.shape,i=r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape));return W(s,i)})}getConfig(){const e={targetShape:this.targetShape},n=super.getConfig();return Object.assign(e,n),e}}B4.className="Reshape";ne(B4);class j4 extends Ke{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);const n=Di(1,e.dims.length+1);if(!ct(e.dims.slice().sort(),n))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new xn({ndim:this.dims.length+1})]}computeOutputShape(e){e=it(e);const n=e.slice();return this.dims.forEach((s,r)=>{n[r+1]=e[s]}),n}call(e,n){return nt(Oe(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},n=super.getConfig();return Object.assign(e,n),e}}j4.className="Permute";ne(j4);class V4 extends Ke{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={maskValue:this.maskValue};return Object.assign(n,e),n}computeMask(e,n){const s=Oe(e),r=-1;return aC(D0(s,this.maskValue),r)}call(e,n){return q(()=>{this.invokeCallHook(e,n);const s=Oe(e),r=-1,i=!0,o=aC(D0(s,this.maskValue),r,i);return B(s,fe(o,s.dtype))})}}V4.className="Masking";ne(V4);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class U4 extends Ke{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let n=null;e.batchSize!=null&&(n=e.batchSize),e.inputLength==null?this.batchInputShape=[n,null]:this.batchInputShape=[n].concat(dt(e.inputLength))}this.inputDim=e.inputDim,Rn(this.inputDim,"inputDim"),this.outputDim=e.outputDim,Rn(this.outputDim,"outputDim"),this.embeddingsInitializer=Ot(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=Mt(e.embeddingsRegularizer),this.activityRegularizer=Mt(e.activityRegularizer),this.embeddingsConstraint=wn(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,n){return q(()=>this.maskZero?(e=Oe(e),D0(e,st(e))):null)}computeOutputShape(e){if(e=it(e),this.inputLength==null)return[...e,this.outputDim];const n=dt(this.inputLength);if(n.length!==e.length-1)throw new M(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let s=0;for(let r=0;r<n.length;++r){const i=n[r],o=e[r+1];if(i!=null&&o!=null&&i!==o)throw new M(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);i==null&&(n[s]=o),s++}}return[e[0],...n,this.outputDim]}call(e,n){return q(()=>{this.invokeCallHook(e,n);let s=Oe(e);s.dtype!=="int32"&&(s=co(s,"int32"));const r=SV(this.embeddings.read(),W(s,[s.size]));return W(r,it(this.computeOutputShape(s.shape)))})}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:zt(this.embeddingsInitializer),embeddingsRegularizer:xt(this.embeddingsRegularizer),activityRegularizer:xt(this.activityRegularizer),embeddingsConstraint:vn(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},n=super.getConfig();return Object.assign(e,n),e}}U4.className="Embedding";ne(U4);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class nu extends Ke{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new ze}computeElementwiseOpOutputShape(e,n){if(e==null||n==null)return null;if(e.length<n.length)return this.computeElementwiseOpOutputShape(n,e);if(n.length===0)return e;const s=e.slice(0,e.length-n.length);for(let r=0;r<n.length;++r){const i=e[e.length-n.length+r],o=n[r];if(i==null||o==null||i<0||o<0)s.push(null);else if(i===1)s.push(o);else if(o===1)s.push(i);else{if(i!==o)throw new M("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(n));s.push(i)}}return s}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[it(e)]),e=e,e.length<2)throw new M(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let n=[];for(const i of e)i!=null&&i[0]!==null&&n.push(i[0]);if(n=Ja(n),n.length>1)throw new M(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let s=e[0]==null?null:e[0].slice(1);for(let i=1;i<e.length;++i){const o=e[i]==null?null:e[i].slice(1);s=this.computeElementwiseOpOutputShape(s,o)}const r=e.map(i=>i.length);e.indexOf(null)===-1&&Ja(r).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,n){return q(()=>{if(e=e,this.reshapeRequired){const s=[],r=e.map(i=>i.rank);if(r.indexOf(null)===-1){const i=al(r);for(let o of e){const a=o.rank;for(let l=0;l<i-a;++l)o=_m(o,1);s.push(o)}return this.mergeFunction(s)}else{let i=!1;for(const l of e){const c=l.rank;if(c==null){const u=l.shape,d=u[0],h=u.slice(1).concat([d]);let f=W(l,[d].concat(Ya(u.slice(1))));f=nt(f,[1,0]),f=W(f,h),s.push(f),i=!0}else if(c>1){const u=Di(1,c).concat([0]);s.push(nt(l,u)),i=!0}else s.push(l)}let o=this.mergeFunction(s);const a=o.rank;if(i){if(a==null){const l=o.shape,c=l.length,u=l[c-1],d=[u].concat(l.slice(0,l.length-1));o=W(nt(W(o,[-1,u]),[1,0]),d)}else if(a>1){const l=[a-1].concat(Di(0,a-1));o=nt(o,l)}}return o}}else return this.mergeFunction(e)})}computeOutputShape(e){e=e;let n;e[0]==null?n=null:n=e[0].slice(1);for(let r=1;r<e.length;++r){const i=e[r]==null?null:e[r].slice(1);n=this.computeElementwiseOpOutputShape(n,i)}let s=[];for(const r of e)r!=null&&r[0]!==null&&s.push(r[0]);return s=Ja(s),s.length===1?n=s.concat(n):n=[null].concat(n),n}computeMask(e,n){return q(()=>{if(n==null)return null;if(!Array.isArray(n))throw new M("`mask` should be an Array");if(!Array.isArray(e))throw new M("`inputs` should be an Array");if(n.length!==e.length)throw new M(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${n.length})`);if(n.every(r=>r==null))return null;n=n.map(r=>r==null?r:Ds(r,0));let s=n[0];for(let r=1;r<n.length-1;++r)s=na(s,n[r]);return s})}}class W4 extends nu{constructor(e){super(e)}mergeFunction(e){return q(()=>{let n=e[0].clone();for(let s=1;s<e.length;++s)n=ie(n,e[s]);return n})}}W4.className="Add";ne(W4);class H4 extends nu{constructor(e){super(e)}mergeFunction(e){return q(()=>{let n=e[0].clone();for(let s=1;s<e.length;++s)n=B(n,e[s]);return n})}}H4.className="Multiply";ne(H4);class G4 extends nu{constructor(e){super(e)}mergeFunction(e){return q(()=>{let n=e[0].clone();for(let s=1;s<e.length;++s)n=ie(n,e[s]);return B(1/e.length,n)})}}G4.className="Average";ne(G4);class K4 extends nu{constructor(e){super(e)}mergeFunction(e){return q(()=>{let n=e[0];for(let s=1;s<e.length;++s)n=Cl(n,e[s]);return n})}}K4.className="Maximum";ne(K4);class q4 extends nu{constructor(e){super(e)}mergeFunction(e){return q(()=>{let n=e[0];for(let s=1;s<e.length;++s)n=Zf(n,e[s]);return n})}}q4.className="Minimum";ne(q4);class X4 extends nu{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new M("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let n=!0;for(const r of e)if(r!=null){n=!1;break}if(n)return;const s=[];for(let r=0;r<e.length;++r){const i=e[r].slice();i.splice(this.axis,1);let o=!1;for(const a of s)if(ct(a,i)){o=!0;break}o||s.push(i)}if(s.length>1)throw new M("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return q(()=>XI(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new M("A `Concatenate` layer should be called on a list of inputs.");const n=e,s=n[0].slice(),r=this.axis<0?s.length+this.axis:this.axis;for(const i of n.slice(1)){if(s[r]==null||i[r]==null){s[r]=null;break}s[r]+=i[r]}return s}computeMask(e,n){if(n==null)return null;if(!Array.isArray(n))throw new M("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new M("`inputs` should be an array for Concatenate");if(n.length!==e.length)throw new M(`Mismatch in the length of mask (${n.length}) and the legnth of inputs (${e.length})`);return q(()=>{let s=!0;if(n.forEach(o=>{if(o!=null){s=!1;return}}),s)return null;const r=[];for(let o=0;o<e.length;++o)n[o]==null?r.push(fe(ii(e[o]),"bool")):n[o].rank<e[o].rank?r.push(Ds(n[o],-1)):r.push(n[o]);const i=Ls(r,this.axis);return KB(i,-1,!1)})}getConfig(){const e={axis:this.axis},n=super.getConfig();return Object.assign(e,n),e}}X4.className="Concatenate";ne(X4);function Ih(t,e){for(;t<0;)t+=e;return t}function ife(t,e,n){if(t.shape.length>3||e.shape.length>3)throw new ze("batchDot is not implemented for tensors of 4D or higher rank yet");if(E(t.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${t.shape.length}`),E(t.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`),typeof n=="number"&&(n=[n,n]),t.dtype==="complex64"||e.dtype==="complex64")throw new ze("batchDot is not implemented for complex64-type Tensors yet.");const s=t.shape.length,r=e.shape.length;n==null&&(n=[s-1,r-2]);const i=n;return q(()=>{let o;if(s>r){o=s-r;const l=[];for(let c=0;c<o;++c)l.push(1);e=W(e,e.shape.concat(l))}else if(r>s){o=r-s;const l=[];for(let c=0;c<o;++c)l.push(1);t=W(t,t.shape.concat(l))}else o=0;let a;if(t.shape.length===2&&e.shape.length===2)i[0]===i[1]?a=Ce(B(t,e),i[0]):a=Ce(B(nt(t,[1,0]),e),i[1]);else{const l=i[0]!==t.shape.length-1,c=i[1]===e.shape.length-1;a=at(t,e,l,c)}if(o>0){let l;s>r?l=s+r-3:l=s-1;const c=[];for(let u=l;u<l+o;++u)c.push(u);a=Dm(a,c)}return a.shape.length===1&&(a=Ds(a,1)),a})}class J4 extends nu{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){E(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const n=e[0],s=e[1];if(n.length>3||s.length>3)throw new ze("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(n,s);if(n[r[0]]!==s[r[1]])throw new M(`Dimension incompatibility: ${n[r[0]]} !== ${s[r[1]]}`)}mergeFunction(e){if(e.length!==2)throw new M(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let n=e[0],s=e[1],r;return Array.isArray(this.axes)?r=this.axes.map((i,o)=>Ih(i,e[o].shape.length)):r=[Ih(this.axes,n.shape.length),Ih(this.axes,s.shape.length)],this.normalize&&(n=z0(n,r[0]),s=z0(s,r[1])),ife(n,s,r)}interpretAxes(e,n){let s;return Array.isArray(this.axes)?s=this.axes:s=[Ih(this.axes,e.length),Ih(this.axes,n.length)],s}computeOutputShape(e){E(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const n=e[0].slice(),s=e[1].slice();if(n.length>3||s.length>3)throw new ze("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(n,s);n.splice(r[0],1),s.splice(r[1],1),s.splice(0,1);const i=n.concat(s);return i.length===1&&i.push(1),i}computeMask(e,n){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},n=super.getConfig();return Object.assign(e,n),e}}J4.className="Dot";ne(J4);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Y4 extends Ke{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={stddev:this.stddev};return Object.assign(n,e),n}call(e,n){return q(()=>{this.invokeCallHook(e,n);const s=Oe(e);return Bm(()=>ie(zv(s.shape,0,this.stddev),s),()=>s,n.training||!1)})}}Y4.className="GaussianNoise";ne(Y4);class Q4 extends Ke{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={rate:this.rate};return Object.assign(n,e),n}call(e,n){return q(()=>{this.invokeCallHook(e,n);const s=Oe(e);return this.rate>0&&this.rate<1?Bm(()=>{const i=Math.sqrt(this.rate/(1-this.rate));return B(s,zv(s.shape,1,i))},()=>s,n.training||!1):s})}}Q4.className="GaussianDropout";ne(Q4);class Z4 extends Ke{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||Oe(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={rate:this.rate};return Object.assign(n,e),n}call(e,n){return q(()=>{if(this.rate<1&&this.rate>0){const s=this._getNoiseShape(e);return Bm(()=>{const i=Oe(e),o=1.6732632423543772,a=1.0507009873554805,l=-o*a;let c=Yc(Rm(s),this.rate);c=co(c,"float32");const u=((1-this.rate)*(1+this.rate*l**2))**-.5,d=-u*l*this.rate,h=ie(B(i,c),B(ie(c,-1),l));return ie(B(h,u),d)},()=>Oe(e),n.training||!1)}return e})}}Z4.className="AlphaDropout";ne(Z4);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function rp(t,e,n,s,r,i=.001){let o;if(t.rank===2)o=$re(t,e,n,s,r,i);else if(t.rank===3)o=Dre(t,e,n,s,r,i);else if(t.rank===4)o=Mre(t,e,n,s,r,i);else throw new ze(`batchNormalization is not implemented for array of rank ${t.rank} yet`);return o}function ofe(t,e,n,s,r=.001){return q(()=>{const i=JE(t,s),o=i.mean,a=i.variance;return[rp(t,o,a,n,e,r),o,a]})}function afe(t,e,n,s,r=.001){return q(()=>{const i=JE(t,s),o=i.mean,a=i.variance,l=[];for(const p of Di(0,t.rank))s.indexOf(p)!==-1?l.push(1):l.push(t.shape[p]);const c=W(o,l),u=W(a,l),d=e==null?null:W(e,l),h=n==null?null:W(n,l);return[rp(t,c,u,h,d,r),o,a]})}function lfe(t,e,n,s,r=.001){return ct(s.slice().sort(),Di(0,t.rank-1))?ofe(t,e,n,s,r):afe(t,e,n,s,r)}class eU extends Ke{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=Ot(e.betaInitializer||"zeros"),this.gammaInitializer=Ot(e.gammaInitializer||"ones"),this.movingMeanInitializer=Ot(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=Ot(e.movingVarianceInitializer||"ones"),this.betaConstraint=wn(e.betaConstraint),this.gammaConstraint=wn(e.gammaConstraint),this.betaRegularizer=Mt(e.betaRegularizer),this.gammaRegularizer=Mt(e.gammaRegularizer)}build(e){e=it(e);const n=this.axis>=0?this.axis:this.axis+e.length,s=e[n];if(s==null)throw new M(`Axis ${n} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new xn({ndim:e.length,axes:{[n]:s}})];const r=[s];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,n){return q(()=>{const s=n.training==null?!1:n.training,r=Oe(e),i=r.shape,o=i.length,a=Di(0,o),l=this.axis>=0?this.axis:this.axis+o;a.splice(l,1);const c=Pc(1,o);c[l]=i[l];const u=a.slice();u.sort();const d=!ct(u,Di(0,o).slice(0,o-1)),h=()=>{if(d){const x=W(this.movingMean.read(),c),v=W(this.movingVariance.read(),c),w=this.center?W(this.beta.read(),c):null,S=this.scale?W(this.gamma.read(),c):null;return rp(r,x,v,w,S,this.epsilon)}else return rp(r,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!s)return h();const[f,p,m]=lfe(r,this.gamma.read(),this.beta.read(),a,this.epsilon),g=(x,v,w)=>{q(()=>{const S=1-w,k=x.read(),C=B(De(k,v),S);x.write(De(k,C))})};return(()=>{g(this.movingMean,p,this.momentum),g(this.movingVariance,m,this.momentum)})(),f})}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:zt(this.betaInitializer),gammaInitializer:zt(this.gammaInitializer),movingMeanInitializer:zt(this.movingMeanInitializer),movingVarianceInitializer:zt(this.movingVarianceInitializer),betaRegularizer:xt(this.betaRegularizer),gammaRegularizer:xt(this.gammaRegularizer),betaConstraint:vn(this.betaConstraint),gammaConstraint:vn(this.gammaConstraint)},n=super.getConfig();return Object.assign(e,n),e}}eU.className="BatchNormalization";ne(eU);class tU extends Ke{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const n of this.axis)if(!Number.isInteger(n))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=Ot(e.betaInitializer||"zeros"),this.gammaInitializer=Ot(e.gammaInitializer||"ones"),this.betaRegularizer=Mt(e.betaRegularizer),this.gammaRegularizer=Mt(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=it(e);const n=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let i=0;i<this.axis.length;++i)this.axis[i]<0&&(this.axis[i]+=n);for(const i of this.axis)if(i<0||i>=n)throw new Error(`Invalid axis: ${i}`);if(this.axis.length!==Ja(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const s=this.axis.map(i=>e[i]),r=!0;this.scale?this.gamma=this.addWeight("gamma",s,"float32",this.gammaInitializer,this.gammaRegularizer,r):this.gamma=null,this.center?this.beta=this.addWeight("beta",s,"float32",this.betaInitializer,this.betaRegularizer,r):this.beta=null,this.built=!0}call(e,n){const s=Oe(e),r=s.shape,i=r.length;return q(()=>{let{mean:a,variance:l}=JE(s,this.axis,!0);const c=Pc(1,i);for(const m of this.axis)c[m]=r[m];const u=m=>m!=null&&m.shape.length!==i?W(m,c):m;let d=this.scale?u(this.gamma.read()):null,h=this.center?u(this.beta.read()):null;const f=[],p=[];for(let m=0;m<i;++m)this.axis.indexOf(m)!==-1?(f.push(r[m]),p.push(1)):(f.push(1),p.push(r[m]));return a=Si(a,f),l=Si(l,f),d!=null&&(d=Si(d,p)),h!=null&&(h=Si(h,p)),rp(s,a,l,h,d,this.epsilon)})}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:zt(this.betaInitializer),gammaInitializer:zt(this.gammaInitializer),betaRegularizer:xt(this.betaRegularizer),gammaRegularizer:xt(this.gammaRegularizer)},n=super.getConfig();return Object.assign(e,n),e}}tU.className="LayerNormalization";ne(tU);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function cfe(t,e,n){return q(()=>{if(t.rank!==4)throw new M(`temporalPadding expects input tensor to be 4-D, but received a ${t.rank}-D tensor.`);if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new M("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(n==null&&(n=Oi()),n!=="channelsLast"&&n!=="channelsFirst")throw new M(`Unknown data format: ${n}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let s;return n==="channelsFirst"?s=[[0,0],[0,0],e[0],e[1]]:s=[[0,0],e[0],e[1],[0,0]],YE(t,s)})}class nU extends Ke{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?Oi():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new M(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let n,s;if(typeof e.padding[0]=="number")n=[e.padding[0],e.padding[0]],s=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new M(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(n=e.padding[0],e.padding[1].length!==2)throw new M(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);s=e.padding[1]}this.padding=[n,s]}this.inputSpec=[new xn({ndim:4})]}computeOutputShape(e){e=it(e);let n,s;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?n=e[2]+this.padding[0][0]+this.padding[0][1]:n=null,e[3]!=null&&e[3]>=0?s=e[3]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],e[1],n,s]):(e[1]!=null&&e[1]>=0?n=e[1]+this.padding[0][0]+this.padding[0][1]:n=null,e[2]!=null&&e[2]>=0?s=e[2]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],n,s,e[3]])}call(e,n){return q(()=>cfe(Oe(e),this.padding,this.dataFormat))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}nU.className="ZeroPadding2D";ne(nU);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Kv(t,e,n,s,r,i){return q(()=>{sn(r),xV(i),Ar(s),n==null&&(n=[1,1]),s==null&&(s="valid"),r==null&&(r=Oi()),i==null&&(i="max"),t=l2(t,r);let o;const a=s==="same"?"same":"valid";return i==="max"?o=XE(t,e,n,a):o=zE(t,e,n,a),r==="channelsFirst"&&(o=nt(o,[0,3,1,2])),o})}function sU(t,e,n,s,r,i){return q(()=>{sn(r),xV(i),Ar(s),n==null&&(n=[1,1,1]),s==null&&(s="valid"),r==null&&(r=Oi()),i==null&&(i="max"),t=v4(t,r);let o;const a=s==="same"?"same":"valid";return i==="max"?o=xoe(t,e,n,a):o=vre(t,e,n,a),r==="channelsFirst"&&(o=nt(o,[0,4,1,2,3])),o})}class rU extends Ke{constructor(e){if(e.poolSize==null&&(e.poolSize=2),super(e),typeof e.poolSize=="number")this.poolSize=[e.poolSize];else if(Array.isArray(e.poolSize)&&e.poolSize.length===1&&typeof e.poolSize[0]=="number")this.poolSize=e.poolSize;else throw new M(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);if(Rn(this.poolSize,"poolSize"),e.strides==null)this.strides=this.poolSize;else if(typeof e.strides=="number")this.strides=[e.strides];else if(Array.isArray(e.strides)&&e.strides.length===1&&typeof e.strides[0]=="number")this.strides=e.strides;else throw new M(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);Rn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,Ar(this.padding),this.inputSpec=[new xn({ndim:3})]}computeOutputShape(e){e=it(e);const n=Ai(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],n,e[2]]}call(e,n){return q(()=>{this.invokeCallHook(e,n),e=_m(Oe(e),2);const s=this.poolingFunction(Oe(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return Dm(s,[2])})}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},n=super.getConfig();return Object.assign(e,n),e}}class iU extends rU{constructor(e){super(e)}poolingFunction(e,n,s,r,i){return sn(i),Ar(r),Kv(e,n,s,r,i,"max")}}iU.className="MaxPooling1D";ne(iU);class oU extends rU{constructor(e){super(e)}poolingFunction(e,n,s,r,i){return sn(i),Ar(r),Kv(e,n,s,r,i,"avg")}}oU.className="AveragePooling1D";ne(oU);class aU extends Ke{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==2)throw new M(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];Rn(this.poolSize,"poolSize"),Rn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,sn(this.dataFormat),Ar(this.padding),this.inputSpec=[new xn({ndim:4})]}computeOutputShape(e){e=it(e);let n=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2];return n=Ai(n,this.poolSize[0],this.padding,this.strides[0]),s=Ai(s,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[e[0],e[1],n,s]:[e[0],n,s,e[3]]}call(e,n){return q(()=>(this.invokeCallHook(e,n),this.poolingFunction(Oe(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}class lU extends aU{constructor(e){super(e)}poolingFunction(e,n,s,r,i){return sn(i),Ar(r),Kv(e,n,s,r,i,"max")}}lU.className="MaxPooling2D";ne(lU);class cU extends aU{constructor(e){super(e)}poolingFunction(e,n,s,r,i){return sn(i),Ar(r),Kv(e,n,s,r,i,"avg")}}cU.className="AveragePooling2D";ne(cU);class uU extends Ke{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==3)throw new M(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];Rn(this.poolSize,"poolSize"),Rn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,sn(this.dataFormat),Ar(this.padding),this.inputSpec=[new xn({ndim:5})]}computeOutputShape(e){e=it(e);let n=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[4]:e[3];return n=Ai(n,this.poolSize[0],this.padding,this.strides[0]),s=Ai(s,this.poolSize[1],this.padding,this.strides[1]),r=Ai(r,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[e[0],e[1],n,s,r]:[e[0],n,s,r,e[4]]}call(e,n){return q(()=>(this.invokeCallHook(e,n),this.poolingFunction(Oe(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}class dU extends uU{constructor(e){super(e)}poolingFunction(e,n,s,r,i){return sn(i),Ar(r),sU(e,n,s,r,i,"max")}}dU.className="MaxPooling3D";ne(dU);class hU extends uU{constructor(e){super(e)}poolingFunction(e,n,s,r,i){return sn(i),Ar(r),sU(e,n,s,r,i,"avg")}}hU.className="AveragePooling3D";ne(hU);class fU extends Ke{constructor(e){super(e),this.inputSpec=[new xn({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,n){throw new ze}}class pU extends fU{constructor(e){super(e||{})}call(e,n){return q(()=>{const s=Oe(e);return ln(s,1)})}}pU.className="GlobalAveragePooling1D";ne(pU);class mU extends fU{constructor(e){super(e||{})}call(e,n){return q(()=>{const s=Oe(e);return Ii(s,1)})}}mU.className="GlobalMaxPooling1D";ne(mU);class gU extends Ke{constructor(e){super(e),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,sn(this.dataFormat),this.inputSpec=[new xn({ndim:4})]}computeOutputShape(e){return e=e,this.dataFormat==="channelsLast"?[e[0],e[3]]:[e[0],e[1]]}call(e,n){throw new ze}getConfig(){const e={dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}class yU extends gU{call(e,n){return q(()=>{const s=Oe(e);return this.dataFormat==="channelsLast"?ln(s,[1,2]):ln(s,[2,3])})}}yU.className="GlobalAveragePooling2D";ne(yU);class xU extends gU{call(e,n){return q(()=>{const s=Oe(e);return this.dataFormat==="channelsLast"?Ii(s,[1,2]):Ii(s,[2,3])})}}xU.className="GlobalMaxPooling2D";ne(xU);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class bU extends Ke{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(e){this.layer!=null&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},n=super.getConfig();return Object.assign(e,n),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,n,s={}){const r=n.layer,i=ho(r,s);delete n.layer;const o={layer:i};return Object.assign(o,n),new e(o)}}class vU extends bU{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=it(e),e.length<3)throw new M(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];const n=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(n),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=it(e);const n=[e[0]].concat(e.slice(2)),s=this.layer.computeOutputShape(n),r=e[1];return[s[0],r].concat(s.slice(1))}call(e,n){return q(()=>(e=Oe(e),A4((o,a)=>[Oe(this.layer.call(o,n)),[]],e,[],!1,null,null,!1,!0)[1]))}}vU.className="TimeDistributed";ne(vU);function ufe(t){tu(Ide,"BidirectionalMergeMode",t)}const dfe="concat";class wU extends bU{constructor(e){super(e);const n=e.layer.getConfig(),s={};s.className=e.layer.getClassName(),s.config=n,this.forwardLayer=ho(s),n.goBackwards=n.goBackwards!==!0;const r={};if(r.className=e.layer.getClassName(),r.config=n,this.backwardLayer=ho(r),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?dfe:e.mergeMode,ufe(this.mergeMode),e.weights)throw new ze("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const n=e.length,s=Math.floor(n/2);this.forwardLayer.setWeights(e.slice(0,s)),this.backwardLayer.setWeights(e.slice(s))}computeOutputShape(e){let n=this.forwardLayer.computeOutputShape(e);Array.isArray(n)&&Array.isArray(n[0])||(n=[n]),n=n;let s,r,i;return this.returnState&&(i=n.slice(1)),s=n[0],s=s,this.mergeMode==="concat"?(s[s.length-1]*=2,r=[s]):this.mergeMode==null?r=[s,s.slice()]:r=[s],this.returnState?this.mergeMode==null?r.concat(i).concat(i.slice()):[s].concat(i).concat(i.slice()):Os(r)}apply(e,n){let s=n==null?null:n.initialState,r=n==null?null:n.constants;n==null&&(n={});const i=I4(e,s,r,this.numConstants);if(e=i.inputs,s=i.initialState,r=i.constants,Array.isArray(e)&&(s=e.slice(1),e=e[0]),(s==null||s.length===0)&&r==null)return super.apply(e,n);const o=[],a=[];if(s!=null){const c=s.length;if(c%2>0)throw new M("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");n.initialState=s,o.push(...s);const u=s.map(d=>new xn({shape:d.shape}));this.forwardLayer.stateSpec=u.slice(0,c/2),this.backwardLayer.stateSpec=u.slice(c/2),a.push(...u)}if(r!=null)throw new ze("Support for constants in Bidirectional layers is not implemented yet.");const l=o[0]instanceof yo;for(const c of o)if(c instanceof yo!==l)throw new M("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(l){const c=[e].concat(o),u=this.inputSpec.concat(a),d=this.inputSpec;this.inputSpec=u;const h=super.apply(c,n);return this.inputSpec=d,h}else return super.apply(e,n)}call(e,n){return q(()=>{const s=n.initialState;let r,i;if(s==null)r=this.forwardLayer.call(e,n),i=this.backwardLayer.call(e,n);else{const l=s.slice(0,s.length/2),c=s.slice(s.length/2);r=this.forwardLayer.call(e,Object.assign(n,{initialState:l})),i=this.backwardLayer.call(e,Object.assign(n,{initialState:c}))}let o;this.returnState&&(Array.isArray(r)&&(o=r.slice(1).concat(i.slice(1))),r=r[0],i=i[0]),this.returnSequences&&(i=Oc(i,1));let a;return this.mergeMode==="concat"?a=XI([r,i]):this.mergeMode==="sum"?a=ie(r,i):this.mergeMode==="ave"?a=B(.5,ie(r,i)):this.mergeMode==="mul"?a=B(r,i):this.mergeMode==null&&(a=[r,i]),this.returnState?this.mergeMode==null?a.concat(o):[a].concat(o):a})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){dc(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),dc(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,n){Array.isArray(n)&&(n=n[0]);let s;if(this.returnSequences?this.mergeMode==null?s=[n,n]:s=n:this.mergeMode==null?s=[null,null]:s=null,this.returnState){const i=this.forwardLayer.states.map(o=>null);return Array.isArray(s)?s.concat(i).concat(i):[s].concat(i).concat(i)}else return s}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},n=super.getConfig();return Object.assign(e,n),e}static fromConfig(e,n){const s=ho(n.layer);if(delete n.layer,n.numConstants!=null)throw new ze("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const r=n;return r.layer=s,new e(r)}}wU.className="Bidirectional";ne(wU);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class SU extends Ke{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){const e={scale:this.scale,offset:this.offset},n=super.getConfig();return Object.assign(e,n),e}call(e,n){return q(()=>(e=Oe(e),e.dtype!=="float32"&&(e=co(e,"float32")),ie(B(e,this.scale),this.offset)))}}SU.className="Rescaling";ne(SU);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const{resizeBilinear:hfe,cropAndResize:ffe}=Uo;class kU extends Ke{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,n,s,r,i,o,a,l){return q(()=>{let c,u=!1;const d=n/o,h=s/a,f=(r+n)/o,p=(i+s)/a,m=[d,h,f,p],g=[];e.rank===3?(u=!0,c=sa([e])):c=e;for(let S=0;S<c.shape[0];S++)g.push(m);const y=pf(g,[g.length,4]),x=ep(0,g.length,1,"int32"),w=ffe(c,y,x,[r,i],"nearest");return co(u?Oe(Mc(w)):w,l)})}upsize(e,n,s,r){return q(()=>{const i=hfe(e,[n,s]);return co(i,r)})}call(e,n){return q(()=>{const s=Oe(e),r=s.dtype,i=s.shape,o=i[i.length-3],a=i[i.length-2];let l=0;o!==this.height&&(l=Math.floor((o-this.height)/2));let c=0;return a!==this.width&&(c=Math.floor((a-this.width)/2),c===0&&(c=1)),l>=0&&c>=0?this.centerCrop(s,l,c,this.height,this.width,o,a,r):this.upsize(e,this.height,this.width,r)})}getConfig(){const e={height:this.height,width:this.width},n=super.getConfig();return Object.assign(e,n),e}computeOutputShape(e){e=it(e);const n=e.length-3,s=e.length-2;return e[n]=this.height,e[s]=this.width,e}}kU.className="CenterCrop";ne(kU);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function pfe(t,e,n,s){let r=Oe(t);if(r.dtype!=="int32"&&(r=co(r,"int32")),e==="int")return r;const i=r.shape;if(r.rank===0&&(r=Ds(r,-1)),e==="oneHot"&&r.shape[r.shape.length-1]!==1&&(r=Ds(r,-1)),r.rank>2)throw new M(`When outputMode is not int, maximum output rank is 2 Received outputMode ${e} and input shape ${i} which would result in output rank ${r.rank}.`);const o=["multiHot","oneHot"].includes(e),a=r;let l;if(typeof s<"u"&&e==="count"?l=oO(a,s,n,o):l=oO(a,[],n,o),e!=="tfIdf")return l;if(s)return B(l,s);throw new M("When outputMode is 'tfIdf', weights must be provided.")}/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class CU extends Ke{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){const e={numTokens:this.numTokens,outputMode:this.outputMode},n=super.getConfig();return Object.assign(e,n),e}computeOutputShape(e){return e=it(e),e==null?[this.numTokens]:this.outputMode==="oneHot"&&e[e.length-1]!==1?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,n){return q(()=>{e=Oe(e),e.dtype!=="int32"&&(e=co(e,"int32"));let s;if(typeof n.countWeights<"u"){if(this.outputMode!=="count")throw new M(`countWeights is not used when outputMode !== count.
              Received countWeights=${n.countWeights}`);s=Oe(n.countWeights)}const r=Ii(e),i=$0(e),o=Ir(this.numTokens,r).bufferSync().get(0),a=Yc(i,0).bufferSync().get(0);if(!(o&&a))throw new M(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return pfe(e,this.outputMode,this.numTokens,s)})}}CU.className="CategoryEncoding";ne(CU);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const mfe=["bilinear","nearest"],jO=new Set(mfe);class NU extends Ke{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation)if(jO.has(e.interpolation))this.interpolation=e.interpolation;else throw new M(`Invalid interpolation parameter: ${e.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!e.cropToAspectRatio}computeOutputShape(e){e=it(e);const n=e[2];return[this.height,this.width,n]}getConfig(){const e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},n=super.getConfig();return Object.assign(e,n),e}call(e,n){return q(()=>{const s=[this.height,this.width];if(this.interpolation==="bilinear")return Uo.resizeBilinear(e,s,!this.cropToAspectRatio);if(this.interpolation==="nearest")return Uo.resizeNearestNeighbor(e,s,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...jO]} are supported`)})}}NU.className="Resizing";ne(NU);/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class TU{constructor(e){this.seed=e}next(){if(this.seed!==void 0)return this.seed++}}TU.className="RandomSeed";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class EU extends Ke{constructor(e){super(e),this.randomGenerator=new TU(e.seed)}getConfig(){const e={seed:this.randomGenerator.seed},n=super.getConfig();return Object.assign(e,n),e}}EU.className="BaseRandomLayer";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const gfe=["bilinear","nearest"],VO=new Set(gfe);class IU extends EU{constructor(e){super(e);const{factor:n,interpolation:s="bilinear"}=e;if(this.factor=n,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new M(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new M(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new M(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(s)if(VO.has(s))this.interpolation=s;else throw new M(`Invalid interpolation parameter: ${s} is not implemented`)}getConfig(){const e={factor:this.factor,interpolation:this.interpolation},n=super.getConfig();return Object.assign(e,n),e}computeOutputShape(e){e=it(e);const n=e[2];return[this.imgHeight,-1,n]}call(e,n){return q(()=>{const s=Oe(e);this.imgHeight=s.shape[s.shape.length-3];const r=s.shape[s.shape.length-2];this.widthFactor=Rm([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let i=this.widthFactor.dataSync()[0]*r;i=Math.round(i);const o=[this.imgHeight,i];switch(this.interpolation){case"bilinear":return Uo.resizeBilinear(e,o);case"nearest":return Uo.resizeNearestNeighbor(e,o);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...VO]} are supported`)}})}}IU.className="RandomWidth";ne(IU);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yfe=X();yfe.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,t=>{t&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var UO;(function(t){t[t.DT_INVALID=0]="DT_INVALID",t[t.DT_FLOAT=1]="DT_FLOAT",t[t.DT_DOUBLE=2]="DT_DOUBLE",t[t.DT_INT32=3]="DT_INT32",t[t.DT_UINT8=4]="DT_UINT8",t[t.DT_INT16=5]="DT_INT16",t[t.DT_INT8=6]="DT_INT8",t[t.DT_STRING=7]="DT_STRING",t[t.DT_COMPLEX64=8]="DT_COMPLEX64",t[t.DT_INT64=9]="DT_INT64",t[t.DT_BOOL=10]="DT_BOOL",t[t.DT_QINT8=11]="DT_QINT8",t[t.DT_QUINT8=12]="DT_QUINT8",t[t.DT_QINT32=13]="DT_QINT32",t[t.DT_BFLOAT16=14]="DT_BFLOAT16",t[t.DT_QINT16=15]="DT_QINT16",t[t.DT_QUINT16=16]="DT_QUINT16",t[t.DT_UINT16=17]="DT_UINT16",t[t.DT_COMPLEX128=18]="DT_COMPLEX128",t[t.DT_HALF=19]="DT_HALF",t[t.DT_RESOURCE=20]="DT_RESOURCE",t[t.DT_VARIANT=21]="DT_VARIANT",t[t.DT_UINT32=22]="DT_UINT32",t[t.DT_UINT64=23]="DT_UINT64",t[t.DT_FLOAT_REF=101]="DT_FLOAT_REF",t[t.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",t[t.DT_INT32_REF=103]="DT_INT32_REF",t[t.DT_UINT8_REF=104]="DT_UINT8_REF",t[t.DT_INT16_REF=105]="DT_INT16_REF",t[t.DT_INT8_REF=106]="DT_INT8_REF",t[t.DT_STRING_REF=107]="DT_STRING_REF",t[t.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",t[t.DT_INT64_REF=109]="DT_INT64_REF",t[t.DT_BOOL_REF=110]="DT_BOOL_REF",t[t.DT_QINT8_REF=111]="DT_QINT8_REF",t[t.DT_QUINT8_REF=112]="DT_QUINT8_REF",t[t.DT_QINT32_REF=113]="DT_QINT32_REF",t[t.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",t[t.DT_QINT16_REF=115]="DT_QINT16_REF",t[t.DT_QUINT16_REF=116]="DT_QUINT16_REF",t[t.DT_UINT16_REF=117]="DT_UINT16_REF",t[t.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",t[t.DT_HALF_REF=119]="DT_HALF_REF",t[t.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",t[t.DT_VARIANT_REF=121]="DT_VARIANT_REF",t[t.DT_UINT32_REF=122]="DT_UINT32_REF",t[t.DT_UINT64_REF=123]="DT_UINT64_REF"})(UO||(UO={}));var WO;(function(t){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(t.CheckpointFormatVersion||(t.CheckpointFormatVersion={}))})(WO||(WO={}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var HO;(function(t){t[t.FAIL=0]="FAIL",t[t.SHORTEST=1]="SHORTEST",t[t.LONGEST=2]="LONGEST"})(HO||(HO={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function be(t,e){Array.isArray(t)||(t=[t]),t.forEach(n=>{n!=null&&E(n.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the CPU backend.`)})}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xfe=Sj;class qv extends jT{nextDataId(){return qv.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new Uz(this,Ui())}write(e,n,s){this.firstUse&&(this.firstUse=!1,X().get("IS_NODE")&&gr(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:s,refCount:1}),r}makeTensorInfo(e,n,s){let r;if(n==="string"&&s!=null&&s.length>0&&Op(s[0])){const i=s.map(o=>Xa(o));r=this.write(i,e,n)}else r=this.write(s,e,n);return{dataId:r,shape:e,dtype:n}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){const n=this.data.get(e);n.refCount++}decRef(e){if(this.data.has(e)){const n=this.data.get(e);n.refCount--}}move(e,n,s,r,i){this.data.set(e,{values:n,dtype:r,refCount:i})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:n,complexTensorInfos:s}=this.data.get(e);if(n==="complex64"){const r=this.readSync(s.real.dataId),i=this.readSync(s.imag.dataId);return ra(r,i)}return Cne(this.data.get(e).values,n)}bufferSync(e){const n=this.readSync(e.dataId);if(e.dtype==="string")try{const s=n.map(r=>ol(r));return He(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return He(e.shape,e.dtype,n)}makeOutput(e,n,s){return Ui().makeTensorFromTensorInfo(this.makeTensorInfo(n,s,e),this)}disposeData(e,n=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!n&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:s}=this.data.get(e);s!=null&&(this.disposeData(s.real.dataId,!0),this.disposeData(s.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const n=$s();return e(),{kernelMs:$s()-n}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){be([e],"where");const n=this.readSync(e.dataId);return xfe(e.shape,n)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}qv.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AU(t){const e=new Float32Array(t.length);for(let n=0;n<t.length;++n)e[n]=Math.abs(t[n]);return e}const bfe=t=>{const{x:e}=t.inputs,n=t.backend;be(e,"abs");let s=new Float32Array(Q(e.shape));const r=n.data.get(e.dataId).values;return s=AU(r),n.makeOutput(s,e.shape,e.dtype)},vfe={kernelName:Nb,backendName:"cpu",kernelFunc:bfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rn(t){return(e,n,s,r,i)=>{const o=_e(e,n),a=o.length,l=ke(o),c=Q(o),u=ns(i,c),d=e.length,h=n.length,f=ke(e),p=ke(n),m=Nd(e,o),g=Nd(n,o);if(m.length+g.length===0)for(let y=0;y<u.length;++y)u[y]=t(s[y%s.length],r[y%r.length]);else for(let y=0;y<u.length;++y){const x=Kd(y,a,l),v=x.slice(-d);m.forEach(C=>v[C]=0);const w=oo(v,d,f),S=x.slice(-h);g.forEach(C=>S[C]=0);const k=oo(S,h,p);u[y]=t(s[w],r[k])}return[u,o]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qs(t){const{inputs:e,backend:n}=t,{real:s,imag:r}=e,i=n.data.get(s.dataId).values,o=n.data.get(r.dataId).values,a=n.makeTensorInfo(s.shape,"complex64"),l=n.data.get(a.dataId);return l.complexTensorInfos={real:n.makeTensorInfo(s.shape,"float32",i),imag:n.makeTensorInfo(r.shape,"float32",o)},a}const wfe={kernelName:eE,backendName:"cpu",kernelFunc:Qs};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H0(t,e,n="float32"){if(n==="complex64"){const r=H0(t,e,"float32"),i=H0(t,e,"float32");return Qs({inputs:{real:r,imag:i},backend:t})}const s=ss(Q(e),n);return t.makeTensorInfo(e,n,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xo(t){const{inputs:e,backend:n}=t,{x:s}=e;return n.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const Sfe={kernelName:em,backendName:"cpu",kernelFunc:xo};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lc(t){const{inputs:e,backend:n}=t,{input:s}=e,r=n.data.get(s.dataId).complexTensorInfos.real,i=n.data.get(r.dataId).values;return n.makeTensorInfo(r.shape,r.dtype,i)}const kfe={kernelName:CE,backendName:"cpu",kernelFunc:Lc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $U(t,e,n,s){if(s==="int32"){const r=Int32Array.from(t);return[e,"int32",r]}if(s==="bool"){const r=Jc([0],n),[i,o]=rn((a,l)=>a!==l?1:0)(e,[],t,r,"bool");return[o,"bool",i]}throw new Error(`Error in Cast: failed to cast ${n} to ${s}`)}function dl(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{dtype:i}=s;if(i==="complex64"){if(r.dtype==="complex64")return xo({inputs:{x:r},backend:n});const u=H0(n,r.shape,r.dtype),d=dl({inputs:{x:r},backend:n,attrs:{dtype:"float32"}}),h=Qs({inputs:{real:d,imag:u},backend:n});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(d),h}if(r.dtype==="complex64"){const u=Lc({inputs:{input:r},backend:n}),d=dl({inputs:{x:u},backend:n,attrs:{dtype:i}});return n.disposeIntermediateTensorInfo(u),d}if(!Gz(r.dtype,i)){const u=xo({inputs:{x:r},backend:n});return{dataId:u.dataId,shape:u.shape,dtype:i}}const o=n.data.get(r.dataId).values,[a,l,c]=$U(o,r.shape,r.dtype,i);return n.makeTensorInfo(a,l,c)}const Cfe={kernelName:jp,backendName:"cpu",kernelFunc:dl};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nn(t,e,n,s){return n==null?({inputs:r,backend:i})=>{const{a:o,b:a}=r,l=i;be([o,a],t);const c=l.data.get(o.dataId).values,u=l.data.get(a.dataId).values,d=o.dtype==="string"?ia(c):c,h=o.dtype==="string"?ia(u):u,f=s||o.dtype,[p,m]=e(o.shape,a.shape,d,h,f);return l.makeTensorInfo(m,f,p)}:({inputs:r,backend:i})=>{const{a:o,b:a}=r,l=i;if(o.dtype==="complex64"||a.dtype==="complex64"){const c=dl({inputs:{x:o},backend:l,attrs:{dtype:"complex64"}}),u=l.data.get(c.dataId),d=u.complexTensorInfos.real,h=u.complexTensorInfos.imag,f=l.data.get(d.dataId).values,p=l.data.get(h.dataId).values,m=dl({inputs:{x:a},backend:l,attrs:{dtype:"complex64"}}),g=l.data.get(m.dataId),y=g.complexTensorInfos.real,x=g.complexTensorInfos.imag,v=l.data.get(y.dataId).values,w=l.data.get(x.dataId).values,[S,k,C]=n(o.shape,a.shape,f,p,v,w),N=l.makeTensorInfo(C,"float32",S),T=l.makeTensorInfo(C,"float32",k),I=Qs({inputs:{real:N,imag:T},backend:l});return l.disposeIntermediateTensorInfo(c),l.disposeIntermediateTensorInfo(m),l.disposeIntermediateTensorInfo(N),l.disposeIntermediateTensorInfo(T),I}else{const c=l.data.get(o.dataId).values,u=l.data.get(a.dataId).values,d=s||o.dtype,[h,f]=e(o.shape,a.shape,c,u,d);return l.makeTensorInfo(f,d,h)}}}function p2(t){return(e,n,s,r,i,o)=>{const a=_e(e,n),l=Q(a),c=a.length,u=ke(a),d=ns("float32",l),h=ns("float32",l),f=Nd(e,a),p=Nd(n,a),m=ra(s,r),g=ra(i,o),y=e.length,x=ke(e),v=n.length,w=ke(n);if(f.length+p.length===0)for(let S=0;S<d.length;S++){const k=S%m.length,C=S%g.length,N=t(m[k*2],m[k*2+1],g[C*2],g[C*2+1]);d[S]=N.real,h[S]=N.imag}else for(let S=0;S<d.length;S++){const k=Kd(S,c,u),C=k.slice(-y);f.forEach(F=>C[F]=0);const N=oo(C,y,x),T=k.slice(-v);p.forEach(F=>T[F]=0);const I=oo(T,v,w),D=t(m[N*2],m[N*2+1],g[I*2],g[I*2+1]);d[S]=D.real,h[S]=D.imag}return[d,h,a]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RU=rn((t,e)=>t+e),Nfe=p2((t,e,n,s)=>({real:t+n,imag:e+s})),Id=Nn(qd,RU,Nfe),Tfe={kernelName:qd,backendName:"cpu",kernelFunc:Id};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m2(t,e,n,s,r){const i=Q(s),o=ss(r,n);for(let a=0;a<t.length;a++){const l=t[a];if(l<0)throw new Error("Input x must be non-negative!");l>=r||(i>0?o[l]+=e[a]:o[l]+=1)}return o}function DU(t,e,n,s=!1){const r=t.shape[0],i=t.shape[1],o=He([r,n],e.dtype);for(let a=0;a<r;a++)for(let l=0;l<i;l++){const c=t.get(a,l);if(c<0)throw new Error("Input x must be non-negative!");c>=n||(s?o.set(1,a,c):e.size>0?o.set(o.get(a,c)+e.get(a,l),a,c):o.set(o.get(a,c)+1,a,c))}return o}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OU=rn((t,e)=>t&e),Efe=Nn(ZT,OU),Ife={kernelName:ZT,backendName:"cpu",kernelFunc:Efe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function So(t){return(e,n,s)=>{const r=Zt(n,e.length);for(let i=0;i<e.length;++i)r[i]=t(e[i],s);return r}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ht(t,e,n){const s=So(e);return Il(t,s,n)}function Il(t,e,n){return({inputs:s,attrs:r,backend:i})=>{const{x:o}=s;be(o,t);const a=i,l=a.data.get(o.dataId).values;let c;if(o.dtype==="string"){if(!Array.isArray(l))throw new Error("String tensor's value was not an instance of Array");c=ia(l)}else c=l;const u=n||o.dtype,d=e(c,u,r);return a.makeTensorInfo(o.shape,u,d)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MU=So(t=>Math.ceil(t)),Afe=Il(Vp,MU),$fe={kernelName:Vp,backendName:"cpu",kernelFunc:Afe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PU(t,e,n,s){const r=Zt(n,Q(e));if(s&&n!=="string"){let i=0;t.forEach(o=>{const a=Q(o.shape);r.set(o.vals,i),i+=a})}else{let i=0;t.forEach(o=>{const a=n==="string"?ia(o.vals):o.vals;let l=0;for(let c=0;c<o.shape[0];++c){const u=c*e[1]+i;for(let d=0;d<o.shape[1];++d)r[u+d]=a[l++]}i+=o.shape[1]})}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LU=rn((t,e)=>t===e?1:0),FU=Nn(Bb,LU,null,"bool"),Rfe={kernelName:Bb,backendName:"cpu",kernelFunc:FU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _U=So(t=>Math.exp(t)),zU=Il(Xp,_U,"float32"),Dfe={kernelName:Xp,backendName:"cpu",kernelFunc:zU};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BU=So(t=>Math.expm1(t)),Ofe=Il(Jp,BU),Mfe={kernelName:Jp,backendName:"cpu",kernelFunc:Ofe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jU=So(t=>Math.floor(t)),Pfe=Il(Yp,jU),Lfe={kernelName:Yp,backendName:"cpu",kernelFunc:Pfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VU=rn((t,e)=>Math.floor(t/e)),Ffe=Nn(Qp,VU,null,"int32"),_fe={kernelName:Qp,backendName:"cpu",kernelFunc:Ffe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UU(t,e,n,s,r,i,o,a,l){const c=He([s,i],n);for(let u=0;u<s;u++){const d=[];let h=0;for(let f=0;f<r;f++){const p=t[u*r+f];h+=p*o[f],d.push(p)}if(h<0||h>=l/i)throw new Error(`Invalid indices: ${d} does not index into ${a}`);for(let f=0;f<i;f++)c.values[u*i+f]=e.get(...e.indexToLoc(h*i+f))}return c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WU(t,e,n){const s=He(n,t.dtype);for(let r=0;r<s.size;++r){const o=s.indexToLoc(r).slice(),a=o[0],l=o[2],c=e.locToIndex([a,l]);o[2]=e.values[c];const u=t.locToIndex(o);0<=u&&u<t.values.length&&(s.values[r]=t.values[u])}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HU=rn((t,e)=>t>e?1:0),zfe=Nn(Wb,HU,null,"bool"),Bfe={kernelName:Wb,backendName:"cpu",kernelFunc:zfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GU=rn((t,e)=>t>=e?1:0),jfe=Nn(Zp,GU,null,"bool"),Vfe={kernelName:Zp,backendName:"cpu",kernelFunc:jfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KU=rn((t,e)=>t<e?1:0),Ufe=Nn(Gb,KU,null,"bool"),Wfe={kernelName:Gb,backendName:"cpu",kernelFunc:Ufe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qU=rn((t,e)=>t<=e?1:0),Hfe=Nn(Kb,qU,null,"bool"),Gfe={kernelName:Kb,backendName:"cpu",kernelFunc:Hfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XU(t,e,n){const s=(e-t)/(n-1),r=ss(n,"float32");r[0]=t;for(let i=1;i<r.length;i++)r[i]=r[i-1]+s;return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JU=So(t=>Math.log(t)),Kfe=Il(rm,JU),qfe={kernelName:rm,backendName:"cpu",kernelFunc:Kfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YU(t,e,n,s){const r=ns(s,Q(n));for(let i=0;i<r.length;++i){const o=i*e;let a=t[o];for(let l=0;l<e;++l){const c=t[o+l];(Number.isNaN(c)||c>a)&&(a=c)}r[i]=a}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QU=rn((t,e)=>Math.max(t,e)),Xfe=Nn(om,QU),Jfe={kernelName:om,backendName:"cpu",kernelFunc:Xfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZU=rn((t,e)=>Math.min(t,e)),Yfe=Nn(am,ZU),Qfe={kernelName:am,backendName:"cpu",kernelFunc:Yfe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g2=rn((t,e)=>t*e),Zfe=p2((t,e,n,s)=>({real:t*n-e*s,imag:t*s+e*n})),Xv=Nn(cm,g2,Zfe),epe={kernelName:cm,backendName:"cpu",kernelFunc:Xv};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eW(t,e,n){const s=vl(-1,n);return g2([],e,s,t,n)}function tpe(t){const{inputs:e,backend:n}=t,{x:s}=e;be(s,"neg");const r=n.data.get(s.dataId).values,[i,o]=eW(r,s.shape,s.dtype);return n.makeTensorInfo(o,s.dtype,i)}const npe={kernelName:rv,backendName:"cpu",kernelFunc:tpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tW=rn((t,e)=>t!==e?1:0),spe=Nn(iv,tW,null,"bool"),rpe={kernelName:iv,backendName:"cpu",kernelFunc:spe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y2(t,e,n,s,r){const i=e.length,o=Q(e),a=ke(e),l=ke(r),c=ns(n,Q(r));for(let u=0;u<o;++u){const d=Kd(u,i,a),h=new Array(d.length);for(let p=0;p<h.length;p++)h[p]=d[s[p]];const f=oo(h,i,l);c[f]=t[u]}return c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zs(t){const{inputs:e,attrs:n,backend:s}=t,{x:r}=e,{perm:i}=n;be(r,"transpose");const o=r.shape.length,a=new Array(o);for(let d=0;d<a.length;d++)a[d]=r.shape[i[d]];const l=s.data.get(r.dataId).values,c=y2(l,r.shape,r.dtype,i,a);return{dataId:s.write(c,a,r.dtype),shape:a,dtype:r.dtype}}const ipe={kernelName:nd,backendName:"cpu",kernelFunc:zs};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nW(t,e,n,s){const[r,i]=Dn(t,s),o=lr(e,"int32"),a=ss(Q(r),o),l=Q(i);for(let c=0;c<a.length;++c){const u=c*l;let d=1;for(let h=0;h<l;++h)d*=n[u+h];a[c]=d}return{outVals:a,outShape:r,outDtype:o}}function ope(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s;be(r,"prod");const a=r.shape.length,l=Ge(i,r.shape),c=Bt(l,a);let u=l,d=r;const h=[];c!=null&&(d=zs({inputs:{x:r},backend:n,attrs:{perm:c}}),h.push(d),u=nn(u.length,a));const f=n.data.get(d.dataId).values,{outVals:p,outShape:m,outDtype:g}=nW(d.shape,d.dtype,f,u);let y=m;return o&&(y=cn(m,l)),h.forEach(x=>n.disposeIntermediateTensorInfo(x)),n.makeTensorInfo(y,g,p)}const ape={kernelName:dv,backendName:"cpu",kernelFunc:ope};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lpe(t,e,n){t.forEach((s,r)=>{if(s<0||s>=n){const i=Kd(r,e.length,ke(e)).join(",");throw new Error(`indices[${i}] = ${s} is not in [0, ${n})`)}})}function cpe(t,e){for(let n=0;n<t.length;++n){const s=t[n],r=n===t.length-1?e:t[n+1].length;if(s.length===0)throw new Error("Ragged splits may not be empty");if(s[0]<0)throw new Error("Ragged splits must be non-negative");if(s[s.length-1]>r)throw new Error("Ragged splits must not point past values");for(let i=1;i<s.length;++i)if(s[i-1]>s[i])throw new Error("Ragged splits must be sorted in ascending order")}}function upe(t,e,n,s){const r=[];let i=0;const o=e.length-1+n.length,a=new Array(o).fill(null).map(()=>[0]);cpe(n,s);let l=1;for(let c=0;c<e.length-1;++c){l*=e[c];const u=e[c+1];for(let d=1;d<l+1;++d)a[c].push(d*u)}for(let c=0;c<t.length;++c){let u=t[c],d=t[c]+1;for(let h=0;h<n.length;++h){const f=n[h],p=h+e.length-1;if(p>=0){const m=a[p],g=m[m.length-1]-f[u];for(let y=u;y<d;++y)a[p].push(f[y+1]+g)}u=f[u],d=f[d]}d!==u&&(r.push([u,d]),i+=d-u)}return{outSplits:a,valueSlices:r,numValues:i}}function dpe(t){const e=[];for(let n=0;n<t.length;++n){const s=t[n].length,r=Zt("int32",s);e.push(r),t[n].forEach((i,o)=>r[o]=i)}return e}function GO(t,e){const n=t.slice(0,e);for(;n.length<e;)n.push(1);for(let s=e;s<t.length;s++)n[e-1]*=t[s];return n}function hpe(t,e,n,s,r,i){const o=GO(e,2)[1],a=GO(i,2)[1];let l=0;for(const c of n)for(let u=c[0];u<c[1];++u){for(let d=0;d<s;++d)r[l*a+d]=t[u*o+d];++l}}function fpe(t,e,n,s,r){const i=e.slice();i[0]=r;const o=Zt(n,Q(i)),a=t.length,l=a===0?0:a/e[0];return hpe(t,e,s,l,o,i),[o,i]}function sW(t,e,n,s,r,i,o,a){if(t.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");const l=e[0][0]-1;if(lpe(i,o,l),s.length===0)throw new Error("params.rank must be nonzero");const c=s[0],{outSplits:u,valueSlices:d,numValues:h}=upe(i,o,t,c),f=dpe(u),p=fpe(n,s,r,d,h);return[f,p[0],p[1]]}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KO=2147483647;function rW(t,e,n,s,r,i,o){if(e.length>1)throw new Error("starts must be a scalar or vector");if(r.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");const a=e.length===0,l=r.length===0,c=o.length===0,u=[];a||u.push(e[0]),l||u.push(r[0]),c||u.push(o[0]);for(let g=1;g<u.length;++g)if(u[g]!==u[g-1])throw new Error("starts, limits, and deltas must have the same shape");const d=u.length===0?1:u[0],h=Zt("int32",d+1);h[0]=0;for(let g=0;g<d;++g){const y=a?t[0]:t[g],x=l?s[0]:s[g],v=c?i[0]:i[g];if(v===0)throw new Error("Requires delta != 0");let w;if(v>0&&x<y||v<0&&x>y)w=0;else if(w=Math.ceil(Math.abs((x-y)/v)),w>KO)throw new Error(`Requires ((limit - start) / delta) <= ${KO}`);h[g+1]=h[g]+w}const f=h[d],p=Zt(n,f);let m=0;for(let g=0;g<d;++g){const y=h[g+1]-h[g];let x=a?t[0]:t[g];const v=c?i[0]:i[g];for(let w=0;w<y;++w)p[m++]=x,x+=v}return[h,p]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Or=vi;class G0{constructor(e,n,s,r,i,o,a,l,c,u){this.shape=e,this.shapeShape=n,this.values=s,this.valuesShape=r,this.valuesDType=i,this.defaultValue=o,this.defaultValueShape=a,this.rowPartitionValues=l,this.rowPartitionValuesShapes=c,this.rowPartitionTypes=Uj(u),this.raggedRank=Wj(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===Or.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===Or.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const n=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case Or.VALUE_ROWIDS:return G0.getMaxWidthValueRowID(n);case Or.ROW_SPLITS:return G0.getMaxWidthRowSplit(n);default:throw new Error(`Cannot handle partition type ${Or[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const n=e.length;if(n===0||n===1)return 0;let s=0;for(let r=0;r<n-1;++r){const i=e[r+1]-e[r];i>s&&(s=i)}return s}static getMaxWidthValueRowID(e){const n=e.length;if(n===0)return 0;let s=0,r=e[0],i=0;for(let o=1;o<n;++o){const a=e[o];a!==r&&(r=a,i=Math.max(o-s,i),s=o)}return Math.max(n-s,i)}tensorShapeFromTensor(e,n,s=!0){if(n.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return XO(e,s)}calculateOutputSize(e){const n=this.valuesShape,s=this.defaultValueShape;Hj(s,n);const r=this.tensorShapeFromTensor(this.shape,this.shapeShape),o=Vj(this.raggedRank,r,n);o[0]<0&&(o[0]=e);for(let a=1;a<=this.raggedRank;++a)o[a]<0&&(o[a]=this.getMaxWidth(a));return o}calculateFirstParentOutputIndex(e,n,s){const r=Math.min(e,s),i=[];let o=0;for(let a=0;a<r;++a,o+=n)i.push(o);for(let a=r;a<e;++a)i.push(-1);return E(i.length===e,()=>"Final length of result must be equal to firstDimension."),i}calculateOutputIndexRowSplit(e,n,s,r){const i=e.length,o=[];for(let a=0;a<i-1;++a){const l=e[a+1]-e[a];let c=Math.min(r,l),u=n[a];u===-1&&(c=0);for(let d=0;d<c;++d)o.push(u),u+=s;for(let d=0;d<l-c;++d)o.push(-1)}if(i>0&&o.length!==e[i-1])throw new Error("Invalid row split size.");return o}calculateOutputIndexValueRowID(e,n,s,r){const i=e.length,o=[];if(i===0)return[];let a=0,l=e[0];if(l>=n.length)throw new Error(`Got currentValueRowId=${l}, which is not less than ${n.length}`);let c=n[l];o.push(c);for(let u=1;u<i;++u){const d=e[u];if(d===l)c>=0&&(++a,a<r?c+=s:c=-1);else{if(a=0,l=d,d>=n.length)throw new Error(`Got nextValueRowId=${d} which is not less than ${n.length}`);c=n[d]}o.push(c)}if(o.length!==e.length)throw new Error("Invalid row ids.");return o}calculateOutputIndex(e,n,s,r){const i=this.getRowPartitionTensor(e),o=this.getRowPartitionTypeByDimension(e);switch(o){case Or.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(i,n,s,r);case Or.ROW_SPLITS:if(i.length-1>n.length)throw new Error(`Row partition size is greater than output size: ${i.length-1} > ${n.length}`);return this.calculateOutputIndexRowSplit(i,n,s,r);default:throw new Error(`Unsupported partition type: ${Or[o]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const n=this.rowPartitionTypes[0];switch(n){case Or.FIRST_DIM_SIZE:return e[0];case Or.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case Or.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${Or[n]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const n=this.getFirstDimensionSize(),s=this.calculateOutputSize(n),r=new Array(this.raggedRank+1);r[r.length-1]=1;for(let l=r.length-2;l>=0;--l)r[l]=r[l+1]*s[l+1];const i=XO(s,!1),o=Zt(this.valuesDType,Q(i));if(r[0]*s[0]>0){let l=this.calculateFirstParentOutputIndex(n,r[0],s[0]);for(let c=1;c<=this.raggedRank;++c)l=this.calculateOutputIndex(c-1,l,r[c],s[c]);this.setOutput(this.raggedRank,l,o,i)}return[i,o]}setOutput(e,n,s,r){if(s.length===0)return;const i=this.values,o=s;let a=r.slice();a=a.slice(e+1);const l=Q(a),c=n.length;let u=this.defaultValue;if(u.length!==l&&u.length!==1){const p=this.defaultValueShape;q(()=>{const m=W(u,p);u=mf(m,a).dataSync()})}let d=0,h=0,f=0;for(let p=0;p<=c;++p){let m=p<c?n[p]:-1;if(m===f){++f;continue}if(h<f){const g=i.subarray(d*l),y=o.subarray(h*l),x=(f-h)*l;qO(y,g,x)}if(p>=c){const g=s.length;m=Math.floor(g/l)}if(m>f)if(this.defaultValue.length===1)o.subarray(f*l,m*l).fill(this.defaultValue[0]),f=m;else for(;m>f;){const g=o.slice(f*l);qO(g,u,l),++f}m<0?(d=p+1,h=f):(d=p,h=f,f=h+1)}}}function qO(t,e,n){for(let s=0;s<n;s++)t[s]=e[s]}function XO(t,e){const n=[];for(let s of t){if(s<0){if(!e)throw new Error(`Dimension ${s} must be >= 0`);if(s<-1)throw new Error(`Dimension ${s} must be >= -1`);s=-1}n.push(s)}return n}function iW(t,e,n,s,r,i,o,a,l,c){return new G0(t,e,n,s,r,i,o,a,l,c).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oW(t,e,n,s){const r=t===e,i=t<e&&n<0,o=e<t&&n>1;if(r||i||o)return ss(0,s);const a=Math.abs(Math.ceil((e-t)/n)),l=ss(a,s);e<t&&n===1&&(n=-1),l[0]=t;for(let c=1;c<l.length;c++)l[c]=l[c-1]+n;return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aW=So(t=>1/Math.sqrt(t)),ppe=Il(mm,aW),mpe={kernelName:mm,backendName:"cpu",kernelFunc:ppe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nc(t,e,n,s,r,i,o,a,l,c){const u=[s/r,r],d=t.values,h=e.values;if(s===0)return He(n,e.dtype);const f=l instanceof jn?l:He(u,e.dtype);typeof l=="string"||typeof l=="number"?f.values.fill(l):typeof l=="boolean"&&f.values.fill(+l);for(let p=0;p<i;p++){const m=[];let g=0;for(let y=0;y<o;y++){const x=d[p*o+y];m.push(x),g+=x*a[y]}if(g<0||g>=s/r)throw new Error(`Invalid indices: ${m} does not index into ${n}`);for(let y=0;y<r;y++)c?f.values[g*r+y]+=h[p*r+y]:f.values[g*r+y]=e.rank===0?h[0]:h[p*r+y]}return f}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gpe=So(t=>1/(1+Math.exp(-t))),lW=ht(vm,t=>1/(1+Math.exp(-t))),ype={kernelName:vm,backendName:"cpu",kernelFunc:lW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cW(t,e,n,s,r){const i=CI(s,e,n),o=Q(n),a=ke(s);if(i){const d=NI(e,a);return r==="string"?t.slice(d,d+o):t.subarray(d,d+o)}const l=r==="string"?ia(t):t,c=He(s,r,l),u=He(n,r);for(let d=0;d<u.size;++d){const h=u.indexToLoc(d),f=h.map((p,m)=>p+e[m]);u.set(c.get(...f),...h)}return r==="string"?dV(u.values):u.values}function Fc(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{begin:i,size:o}=s;be(r,"slice");const[a,l]=Mv(r,i,o);SI(r,a,l);const c=n.data.get(r.dataId).values,u=cW(c,a,l,r.shape,r.dtype);return n.makeTensorInfo(l,r.dtype,u)}const xpe={kernelName:yv,backendName:"cpu",kernelFunc:Fc};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uW(t,e,n,s,r,i,o){const a=e[0],l=i[0],c=new Array(l),u=new Array(a),d=e[1];if(l===0){if(a!==0)throw new Error(Qj(a));const g=Zt(n,0),y=Zt(r,0);return[g,[0,d],y,c,u]}let h=!0,f=0;const p=new Array(l).fill(0);for(let g=0;g<a;++g){const y=t[g*d];if(y<0)throw new Error(Zj(g,y));if(y>=l)throw new Error(eV(g,y,l));++p[y],h=h&&y>=f,f=y}let m=!0;for(let g=0;g<l;++g){const y=p[g]===0;c[g]=y,m=m&&!y,p[g]=Math.max(p[g],1),g>0&&(p[g]+=p[g-1])}if(m&&h){const g=t,y=s;for(let x=0;x<a;++x)u[x]=x;return[g,[a,d],y,c,u]}else{const g=p[l-1],y=Zt(n,g*d),x=Zt(r,g),v=new Array(l).fill(0);for(let w=0;w<a;++w){const S=t[w*d],k=v[S],C=(S===0?0:p[S-1])+k;v[S]++;for(let N=0;N<d;++N)y[C*d+N]=t[w*d+N];x[C]=s[w],u[w]=C}for(let w=0;w<l;++w)if(v[w]===0){const k=w===0?0:p[w-1];y[k*d+0]=w;for(let C=1;C<d;++C)y[k*d+C]=0;x[k]=o}return[y,[g,d],x,c,u]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dW(t,e,n,s,r){const i=Q(s),o=e[0],a=r.length,l=[];let c=1,u=-1;for(let g=0;g<a;++g){const y=r[g];if(y===-1){if(u!==-1)throw new Error(tV(u,g));u=g,l.push(1)}else{if(y<0)throw new Error(nV(g,y));c*=y,l.push(y)}}if(u!==-1){if(c<=0)throw new Error(sV());const g=Math.trunc(i/c);if(c*g!==i)throw new Error(rV(s,l));l[u]=g}if(Q(l)!==i)throw new Error(iV(s,l));const h=s.length,f=[];if(h>0){f[h-1]=1;for(let g=h-2;g>=0;--g)f[g]=f[g+1]*s[g+1]}const p=[];if(a>0){p[a-1]=1;for(let g=a-2;g>=0;--g)p[g]=p[g+1]*l[g+1]}const m=Zt(n,o*a);for(let g=0;g<o;++g){let y=0;for(let x=0;x<h;++x)y+=t[g*h+x]*f[x];for(let x=0;x<a;++x)m[g*a+x]=Math.trunc(y/p[x]),y%=p[x]}return[m,[o,a],l]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x2(t,e,n,s,r,i=!1,o=0){const a=s.length,l=[e[0],t.length/e[0]],c=l[1],d=a>0?r[a-1]+1:0;if(d<0)throw new Error(hC());const h=e.slice();h[0]=d;const f=h.reduce((v,w)=>v*w,1),p=Zt(n,f);if(a===0)return d>0&&p.fill(o),[p,h];if(d<=0)throw new Error(hC());let m=0,g=1,y=0,x=r[m];for(;;){let v=0;if(g<a){if(v=r[g],x===v){++g;continue}if(x>=v)throw new Error(oV())}if(x<0||x>=d)throw new Error(aV(x,d));x>y&&p.fill(o,y*c,x*c);for(let w=m;w<g;++w){const S=s[w];if(S<0||S>=l[0])throw new Error(lV(w,s[w],l[0]));for(let k=0;k<c;k++)p[x*c+k]+=t[S*c+k]}if(i)for(let w=0;w<c;w++)p[x*c+w]/=g-m;if(m=g,++g,y=x+1,x=v,g>a)break}return y<d&&p.fill(o,y*c,d*c),[p,h]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bpe=So(t=>Math.sqrt(t)),vpe=ht(Sm,t=>Math.sqrt(t)),wpe={kernelName:Sm,backendName:"cpu",kernelFunc:vpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hW=rn((t,e)=>{const n=t-e;return n*n}),Spe=Nn(km,hW),kpe={kernelName:km,backendName:"cpu",kernelFunc:Spe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fW=So((t,e)=>{const{pattern:n,replaceGlobal:s,rewrite:r}=e;return t.replace(new RegExp(n,s?"g":""),r)}),Cpe=Il(IE,fW),Npe={kernelName:IE,backendName:"cpu",kernelFunc:Cpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pW(t,e,n,s){const r=He(t,e.dtype);for(let i=0;i<r.size;i++){const o=r.indexToLoc(i),a=new Array(o.length);for(let l=0;l<a.length;l++)a[l]=o[l]*n[l]+s[l];r.set(e.get(...a),...o)}return r}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Tpe{constructor(e,n,s,r,i,o){this.separator=Xa(e),this.nGramWidths=n,this.leftPad=Xa(s),this.rightPad=Xa(r),this.padWidth=i,this.preserveShort=o}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,n){const s=this.getPadWidth(n);return Math.max(0,e+2*s-n+1)}createNGrams(e,n,s,r,i,o){for(let a=0;a<i;++a){const l=this.getPadWidth(o),c=Math.max(0,l-a),u=Math.max(0,l-(i-(a+1))),d=o-(c+u),h=n+(c>0?0:a-l);let f=0;f+=c*this.leftPad.length;for(let x=0;x<d;++x)f+=e[h+x].length;f+=u*this.rightPad.length;const p=c+u+d-1;f+=p*this.separator.length,s[r+a]=new Uint8Array(f);const m=s[r+a];let g=0;const y=x=>x.forEach(v=>m[g++]=v);for(let x=0;x<c;++x)y(this.leftPad),y(this.separator);for(let x=0;x<d-1;++x)y(e[h+x]),y(this.separator);if(d>0){y(e[h+d-1]);for(let x=0;x<u;++x)y(this.separator),y(this.rightPad)}else{for(let x=0;x<u-1;++x)y(this.rightPad),y(this.separator);y(this.rightPad)}}}compute(e,n){const s=e.length,r=n.length;if(r>0){let l=n[0];if(l!==0)throw new Error(`First split value must be 0, got ${l}`);for(let c=1;c<r;++c){let u=n[c]>=l;if(u=u&&n[c]<=s,!u)throw new Error(`Invalid split value ${n[c]}, must be in [${l}, ${s}]`);l=n[c]}if(l!==s)throw new Error(`Last split value must be data size. Expected ${s}, got ${l}`)}const i=r-1,o=Zt("int32",r);if(s===0||r===0){const l=new Array(s);for(let c=0;c<=i;++c)o[c]=0;return[l,o]}o[0]=0;for(let l=1;l<=i;++l){const c=n[l]-n[l-1];let u=0;this.nGramWidths.forEach(d=>{u+=this.getNumNGrams(c,d)}),this.preserveShort&&c>0&&u===0&&(u=1),o[l]=o[l-1]+u}const a=new Array(o[i]);for(let l=0;l<i;++l){const c=n[l];let u=o[l];if(this.nGramWidths.forEach(d=>{const h=n[l+1]-n[l],f=this.getNumNGrams(h,d);this.createNGrams(e,c,a,u,f,d),u+=f}),this.preserveShort&&u===o[l]){const d=n[l+1]-n[l];if(d===0)continue;const h=d+2*this.padWidth,f=1;this.createNGrams(e,c,a,u,f,h)}}return[a,o]}}function mW(t,e,n,s,r,i,o,a){return new Tpe(n,s,r,i,o,a).compute(t,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Epe(t,e,n,s){if(!t.length)return;if(e.length===0){for(let i=0;i<t.length;++i)s.push(t.subarray(i,i+1));return}if(e.length===1){const i=e[0];let o=t.indexOf(i);for(;o!==-1;){const a=t.subarray(0,o);(!n||a.length!==0)&&s.push(a),t=t.subarray(o+1),o=t.indexOf(i)}(!n||t.length!==0)&&s.push(t);return}let r=0;for(let i=0;i<t.length+1;i++)if(i===t.length||e.indexOf(t[i])!==-1){const o=t.subarray(r,i);(!n||o.length!==0)&&s.push(o),r=i+1}}function gW(t,e,n){const s=t.length,r=[];let i=0,o=0;const a=new Array(s);for(let h=0;h<s;++h){const f=r.length;Epe(t[h],e,n,r);const p=r.length-f;a[h]=p,i+=p,o=Math.max(o,p)}const l=Zt("int32",i*2),c=new Array(i),u=[s,o];let d=0;for(let h=0;h<s;++h)for(let f=0;f<a[h];++f)l[d*2]=h,l[d*2+1]=f,c[d]=r[d],++d;return[l,c,u]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yW(t,e){const n=Zt("int32",t.length);for(let s=0;s<t.length;++s)n[s]=Une(t[s]).modulo(e).getLowBitsUnsigned();return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xW=rn((t,e)=>t-e),Ipe=p2((t,e,n,s)=>({real:t-n,imag:e-s})),b2=Nn(Cm,xW,Ipe),Ape={kernelName:Cm,backendName:"cpu",kernelFunc:b2};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bW(t,e){const n=new Array(t.rank);for(let r=0;r<n.length;r++)n[r]=t.shape[r]*e[r];const s=He(n,t.dtype);for(let r=0;r<s.values.length;++r){const i=s.indexToLoc(r),o=new Array(t.rank);for(let l=0;l<o.length;l++)o[l]=i[l]%t.shape[l];const a=t.locToIndex(o);s.values[r]=t.values[a]}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gh=(t,e)=>{const n=e.value-t.value;return n===0?t.index-e.index:n};function vW(t,e,n=0,s=t.length-1){for(;s>n;){if(s-n>600){const a=s-n+1,l=e-n+1,c=Math.log(a),u=.5*Math.exp(2*c/3),d=.5*Math.sqrt(c*u*(a-u)/a)*Math.sign(l-a/2),h=Math.max(n,Math.floor(e-l*u/a+d)),f=Math.min(s,Math.floor(e+(a-l)*u/a+d));vW(t,e,h,f)}const r=t[e];let i=n,o=s;for(ku(t,n,e),Gh(t[s],r)>0&&ku(t,n,s);i<o;){for(ku(t,i,o),i++,o--;Gh(t[i],r)<0;)i=i+1;for(;Gh(t[o],r)>0;)o=o-1}Gh(t[n],r)===0?ku(t,n,o):(o=o+1,ku(t,o,s)),o<=e&&(n=o+1),e<=o&&(s=o-1)}}function wW(t,e,n,s,r){const i=e[e.length-1],[o,a]=[t.length/i,i],l=ns(n,o*s),c=ns("int32",o*s);for(let d=0;d<o;d++){const h=d*a,f=t.subarray(h,h+a);let p=new Array(f.length);f.forEach((x,v)=>p[v]={value:x,index:v}),s<p.length&&(vW(p,s),p=p.slice(0,s)),r&&p.sort(Gh);const m=d*s,g=l.subarray(m,m+s),y=c.subarray(m,m+s);for(let x=0;x<s;x++)g[x]=p[x].value,y[x]=p[x].index}const u=e.slice();return u[u.length-1]=s,[He(u,n,l),He(u,"int32",c)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SW(t,e,n,s){const r=Ge(e,n)[0],i=[1,n[0],1];for(let p=0;p<r;p++)i[0]*=n[p];i[1]=n[r];for(let p=r+1;p<n.length;p++)i[2]*=n[p];const o=new Map,a=new Int32Array(n[r]),l=new jn(i,s,t),c=[],u=i[0]===1&&i[2]===1;for(let p=0;p<n[r];p++){let m;if(u)m=t[p].toString();else{const y=[];for(let x=0;x<i[0];x++)for(let v=0;v<i[2];v++)y.push(l.get(x,p,v));m=y.join(",")}const g=o.get(m);if(g!=null)a[p]=g;else{const y=o.size;o.set(m,y),a[p]=y,c.push(p)}}const d=i.slice();d[1]=o.size;const h=new jn(d,s);c.forEach((p,m)=>{for(let g=0;g<i[0];g++)for(let y=0;y<i[2];y++)h.set(l.get(g,p,y),g,m,y)});const f=n.slice();return f[r]=d[1],{outputValues:h.values,outputShape:f,indices:a}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $pe=Object.freeze(Object.defineProperty({__proto__:null,addImpl:RU,bincountImpl:m2,bincountReduceImpl:DU,bitwiseAndImpl:OU,castImpl:$U,ceilImpl:MU,concatImpl:PU,equalImpl:LU,expImpl:_U,expm1Impl:BU,floorDivImpl:VU,floorImpl:jU,gatherNdImpl:UU,gatherV2Impl:WU,greaterEqualImpl:GU,greaterImpl:HU,lessEqualImpl:qU,lessImpl:KU,linSpaceImpl:XU,logImpl:JU,maxImpl:YU,maximumImpl:QU,minimumImpl:ZU,multiplyImpl:g2,negImpl:eW,notEqualImpl:tW,prodImpl:nW,raggedGatherImpl:sW,raggedRangeImpl:rW,raggedTensorToTensorImpl:iW,rangeImpl:oW,rsqrtImpl:aW,scatterImpl:nc,sigmoidImpl:gpe,simpleAbsImpl:AU,sliceImpl:cW,sparseFillEmptyRowsImpl:uW,sparseReshapeImpl:dW,sparseSegmentReductionImpl:x2,sqrtImpl:bpe,squaredDifferenceImpl:hW,staticRegexReplaceImpl:fW,stridedSliceImpl:pW,stringNGramsImpl:mW,stringSplitImpl:gW,stringToHashBucketFastImpl:yW,subImpl:xW,tileImpl:bW,topKImpl:wW,transposeImpl:y2,uniqueImpl:SW},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */zB("cpu",()=>new qv,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kW=ht(Kp,t=>t>=0?t:Math.exp(t)-1),Rpe={kernelName:Kp,backendName:"cpu",kernelFunc:kW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CW(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{alpha:i}=s;be([r],"leakyRelu");const o=Q(r.shape),a=n.data.get(r.dataId).values,l=ns("float32",o);for(let c=0;c<a.length;c++)l[c]=a[c]<0?i*a[c]:a[c];return n.makeTensorInfo(r.shape,"float32",l)}const Dpe={kernelName:Hb,backendName:"cpu",kernelFunc:CW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ope=rn((t,e)=>t<0?e*t:t);function NW(t){const{inputs:e,backend:n}=t,{x:s,alpha:r}=e;be([s,r],"prelu");const i=n.data.get(s.dataId).values,o=n.data.get(r.dataId).values,[a,l]=Ope(s.shape,r.shape,i,o,"float32");return n.makeTensorInfo(l,"float32",a)}const Mpe={kernelName:uv,backendName:"cpu",kernelFunc:NW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TW=ht(hm,t=>Math.max(0,t)),Ppe={kernelName:hm,backendName:"cpu",kernelFunc:TW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EW=ht(fm,t=>Math.min(Math.max(0,t),6)),Lpe={kernelName:fm,backendName:"cpu",kernelFunc:EW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K0(t,e,n,s,r){if(n==="linear")return xo({inputs:{x:e},backend:t});if(n==="relu")return TW({inputs:{x:e},backend:t});if(n==="elu")return kW({inputs:{x:e},backend:t});if(n==="relu6")return EW({inputs:{x:e},backend:t});if(n==="prelu")return NW({inputs:{x:e,alpha:s},backend:t});if(n==="leakyrelu")return CW({inputs:{x:e},backend:t,attrs:{alpha:r}});if(n==="sigmoid")return lW({inputs:{x:e},backend:t});throw new Error(`Activation ${n} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kt(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{shape:i}=s,o=Q(r.shape),a=Hz(i,o),l=Q(a);E(o===l,()=>`The new shape (${a}) has ${l} elements and the old shape (${r.shape}) has ${o} elements. The new shape and old shape must have the same number of elements.`),n.incRef(r.dataId);const c=n.data.get(r.dataId);if(c.complexTensorInfos!=null){const u=c.complexTensorInfos.real,d=c.complexTensorInfos.imag;u.shape=a,d.shape=a}return{dataId:r.dataId,shape:a,dtype:r.dtype}}const Fpe={kernelName:hv,backendName:"cpu",kernelFunc:kt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IW(t){const{inputs:e,backend:n,attrs:s}=t,{a:r,b:i}=e,{transposeA:o,transposeB:a}=s;be([r,i],"matMul");const l=r.shape.length,c=i.shape.length,u=o?r.shape[l-2]:r.shape[l-1],d=a?i.shape[c-1]:i.shape[c-2],h=o?r.shape[l-1]:r.shape[l-2],f=a?i.shape[c-2]:i.shape[c-1],p=r.shape.slice(0,-2),m=i.shape.slice(0,-2),g=Q(p),y=Q(m),v=_e(r.shape.slice(0,-2),i.shape.slice(0,-2)).concat([h,f]);E(u===d,()=>`Error in matMul: inner shapes (${u}) and (${d}) of Tensors with shapes ${r.shape} and ${i.shape} and transposeA=${o} and transposeB=${a} must match.`);const w=o?[g,u,h]:[g,h,u],S=a?[y,f,d]:[y,d,f],k=kt({inputs:{x:r},backend:n,attrs:{shape:w}}),C=kt({inputs:{x:i},backend:n,attrs:{shape:S}}),N=o?k.shape[1]:k.shape[2],T=o?k.shape[2]:k.shape[1],I=a?C.shape[1]:C.shape[2],D=Math.max(g,y),F=n.data.get(k.dataId).values,A=n.data.get(C.dataId).values,O=ke(k.shape),P=ke(C.shape),[L,G,$]=o?[O[0],1,O[1]]:[O[0],O[1],1],[U,K,j]=a?[1,P[1],P[0]]:[P[1],1,P[0]],ee=T*I,Z=He([D,T,I],k.dtype),re=Z.values,te=n.blockSize;for(let le=0;le<D;le++){const pe=le%g,we=le%y;for(let xe=0;xe<T;xe+=te){const Ne=Math.min(xe+te,T);for(let Ae=0;Ae<I;Ae+=te){const Qe=Math.min(Ae+te,I);for(let Xe=0;Xe<N;Xe+=te){const ft=Math.min(Xe+te,N);for(let qe=xe;qe<Ne;qe++)for(let Ze=Ae;Ze<Qe;Ze++){let ut=0;for(let et=Xe;et<ft;et++){const ge=F[pe*L+qe*G+et*$],Fe=A[et*U+Ze*K+we*j];ut+=ge*Fe}re[le*ee+(qe*I+Ze)]+=ut}}}}}return n.disposeIntermediateTensorInfo(k),n.disposeIntermediateTensorInfo(C),n.makeTensorInfo(v,Z.dtype,Z.values)}const _pe={kernelName:$b,backendName:"cpu",kernelFunc:IW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zpe(t){const{inputs:e,backend:n,attrs:s}=t,{a:r,b:i,bias:o,preluActivationWeights:a}=e,{transposeA:l,transposeB:c,activation:u,leakyreluAlpha:d}=s;let h,f,p;const m=[];h=IW({inputs:{a:r,b:i},attrs:{transposeA:l,transposeB:c},backend:n}),o&&(f=Id({inputs:{a:h,b:o},backend:n}),m.push(h),h=f),u&&(p=K0(n,h,u,a,d),m.push(h),h=p);for(const y of m)n.disposeIntermediateTensorInfo(y);return h}const Bpe={kernelName:C0,backendName:"cpu",kernelFunc:zpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jpe=ht(Mp,t=>Math.acos(t)),Vpe={kernelName:Mp,backendName:"cpu",kernelFunc:jpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Upe=ht(Pp,t=>Math.acosh(t)),Wpe={kernelName:Pp,backendName:"cpu",kernelFunc:Upe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hpe(t){const{inputs:e,backend:n}=t,s=e;be(e,"addN");const r=s.map(a=>n.data.get(a.dataId).values),i=He(s[0].shape,s[0].dtype),o=i.values;for(let a=0;a<s.length;a++){const l=r[a];for(let c=0;c<o.length;c++)o[c]+=l[c]}return n.makeTensorInfo(i.shape,i.dtype,i.values)}const Gpe={kernelName:KT,backendName:"cpu",kernelFunc:Hpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kpe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s;be(r,"all");const a=Ge(i,r.shape);let l=a;const c=Bt(l,r.shape.length);let u=r;c!=null&&(u=zs({inputs:{x:r},backend:n,attrs:{perm:c}}),l=nn(l.length,r.shape.length)),Hn("all",l,u.shape.length);const[d,h]=Dn(u.shape,l),f=Q(h),p=ss(Q(d),u.dtype),m=n.data.get(u.dataId).values;for(let y=0;y<p.length;++y){const x=y*f;let v=m[x];for(let w=0;w<f;++w){const S=m[x+w];v=v&&S}p[y]=v}c!=null&&n.disposeIntermediateTensorInfo(u);const g=n.makeTensorInfo(d,u.dtype,p);if(o){const y=cn(d,a),x=kt({inputs:{x:g},backend:n,attrs:{shape:y}});return n.disposeIntermediateTensorInfo(g),x}return g}const qpe={kernelName:qT,backendName:"cpu",kernelFunc:Kpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xpe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s;be(r,"any");const a=Ge(i,r.shape);let l=a;const c=Bt(l,r.shape.length);let u=r;c!=null&&(u=zs({inputs:{x:r},backend:n,attrs:{perm:c}}),l=nn(l.length,r.shape.length)),Hn("any",l,u.shape.length);const[d,h]=Dn(u.shape,l),f=Q(h),p=ss(Q(d),u.dtype),m=n.data.get(u.dataId).values;for(let y=0;y<p.length;++y){const x=y*f;let v=m[x];for(let w=0;w<f;++w){const S=m[x+w];v=v||S}p[y]=v}c!=null&&n.disposeIntermediateTensorInfo(u);const g=n.makeTensorInfo(d,u.dtype,p);if(o){const y=cn(d,a),x=kt({inputs:{x:g},backend:n,attrs:{shape:y}});return n.disposeIntermediateTensorInfo(g),x}return g}const Jpe={kernelName:XT,backendName:"cpu",kernelFunc:Xpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ype(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i}=s;be(r,"argMax");let o=Ge(i,r.shape);const a=Bt(o,r.shape.length);let l=r;const c=[];a!=null&&(l=zs({inputs:{x:r},backend:n,attrs:{perm:a}}),c.push(l),o=nn(o.length,l.shape.length)),o=[o[0]],Hn("argMax",o,l.shape.length);const[u,d]=Dn(l.shape,o),h=Q(u),f=ss(h,"int32"),p=Q(d),m=n.data.get(l.dataId).values;for(let g=0;g<f.length;++g){const y=g*p;let x=m[y],v=0;for(let w=0;w<p;++w){const S=m[y+w];S>x&&(x=S,v=w)}f[g]=v}return c.forEach(g=>n.disposeIntermediateTensorInfo(g)),n.makeTensorInfo(u,"int32",f)}const Qpe={kernelName:Tb,backendName:"cpu",kernelFunc:Ype};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zpe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i}=s;be(r,"argMin");let o=Ge(i,r.shape);const a=Bt(o,r.shape.length);let l=r;const c=[];a!=null&&(l=zs({inputs:{x:r},backend:n,attrs:{perm:a}}),c.push(l),o=nn(o.length,l.shape.length)),o=[o[0]],Hn("argMin",o,l.shape.length);const[u,d]=Dn(l.shape,o),h=Q(u),f=ss(h,"int32"),p=Q(d),m=n.data.get(l.dataId).values;for(let g=0;g<f.length;++g){const y=g*p;let x=m[y],v=0;for(let w=0;w<p;++w){const S=m[y+w];S<x&&(x=S,v=w)}f[g]=v}return c.forEach(g=>n.disposeIntermediateTensorInfo(g)),n.makeTensorInfo(u,"int32",f)}const eme={kernelName:Eb,backendName:"cpu",kernelFunc:Zpe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tme=ht(Lp,t=>Math.asin(t)),nme={kernelName:Lp,backendName:"cpu",kernelFunc:tme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sme=ht(Fp,t=>Math.asinh(t)),rme={kernelName:Fp,backendName:"cpu",kernelFunc:sme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ime=ht(_p,t=>Math.atan(t)),ome={kernelName:_p,backendName:"cpu",kernelFunc:ime};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ame=rn((t,e)=>Math.atan2(t,e)),lme=Nn(Bp,ame),cme={kernelName:Bp,backendName:"cpu",kernelFunc:lme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ume=ht(zp,t=>Math.atanh(t)),dme={kernelName:zp,backendName:"cpu",kernelFunc:ume};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v2(t,e,n,s,r,i){const o=r.strideHeight,a=r.strideWidth,l=r.dilationHeight,c=r.dilationWidth,u=r.effectiveFilterHeight,d=r.effectiveFilterWidth,h=r.padInfo.top,f=r.padInfo.left,p=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=He(r.outShape,n),g=m.values,y=r.outShape[1]*r.outShape[2]*r.outShape[3],x=r.outShape[2]*r.outShape[3],v=r.outShape[3];for(let w=0;w<r.batchSize;++w){const S=w*y,k=w*s[0];for(let C=0;C<r.inChannels;++C)for(let N=0;N<r.outHeight;++N){const T=N*o-h,I=Math.max(0,T),D=Math.min(r.inHeight,u+T),F=S+N*x;for(let A=0;A<r.outWidth;++A){const O=A*a-f,P=Math.max(0,O),L=Math.min(r.inWidth,d+O);let G=p,$=0,U=0;for(let j=I;j<D;j+=l){const ee=k+j*s[1];for(let Z=P;Z<L;Z+=c){const re=ee+Z*s[2],te=t[re+C];i==="max"&&te>G?G=te:i==="avg"&&($+=te,U++)}if(isNaN(G))break}const K=F+A*v+C;g[K]=i==="avg"?$/U:G}}}return m}function AW(t,e,n,s,r=!1,i=!1){const o=He(s.outShape,"int32"),a=s.strideHeight,l=s.strideWidth,c=s.dilationHeight,u=s.dilationWidth,d=s.effectiveFilterHeight,h=s.effectiveFilterWidth,f=s.padInfo.top,p=s.padInfo.left,m=He(e,n,t);for(let g=0;g<s.batchSize;++g)for(let y=0;y<s.inChannels;++y)for(let x=0;x<s.outHeight;++x){const v=x*a-f;let w=v;for(;w<0;)w+=c;const S=Math.min(s.inHeight,d+v);for(let k=0;k<s.outWidth;++k){const C=k*l-p;let N=C;for(;N<0;)N+=u;const T=Math.min(s.inWidth,h+C);let I=Number.NEGATIVE_INFINITY,D=-1;for(let F=w;F<S;F+=c){const A=F-v;for(let O=N;O<T;O+=u){const P=O-C,L=m.get(g,F,O,y);L>I&&(I=L,r?D=i?((g*s.inHeight+F)*s.inWidth+O)*s.inChannels+y:(F*s.inWidth+O)*s.inChannels+y:D=A*h+P)}}o.set(D,g,x,k,y)}}return o}function $W(t,e,n,s,r,i){const o=r.strideDepth,a=r.strideHeight,l=r.strideWidth,c=r.dilationDepth,u=r.dilationHeight,d=r.dilationWidth,h=r.effectiveFilterDepth,f=r.effectiveFilterHeight,p=r.effectiveFilterWidth,m=r.padInfo.front,g=r.padInfo.top,y=r.padInfo.left,x=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=He(r.outShape,n),w=v.values,S=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],k=r.outShape[2]*r.outShape[3]*r.outShape[4],C=r.outShape[3]*r.outShape[4],N=r.outShape[4];for(let T=0;T<r.batchSize;++T){const I=T*S,D=T*s[0];for(let F=0;F<r.inChannels;++F)for(let A=0;A<r.outDepth;++A){const O=A*o-m;let P=O;for(;P<0;)P+=c;const L=Math.min(r.inDepth,h+O),G=I+A*k;for(let $=0;$<r.outHeight;++$){const U=$*a-g;let K=U;for(;K<0;)K+=u;const j=Math.min(r.inHeight,f+U),ee=G+$*C;for(let Z=0;Z<r.outWidth;++Z){const re=Z*l-y;let te=re;for(;te<0;)te+=d;const le=Math.min(r.inWidth,p+re),pe=ee+Z*N;let we=x,xe=0,Ne=0;for(let Qe=P;Qe<L;Qe+=c){const Xe=D+Qe*s[1];for(let ft=K;ft<j;ft+=u){const qe=Xe+ft*s[2];for(let Ze=te;Ze<le;Ze+=d){const ut=qe+Ze*s[3],et=t[ut+F];if(i==="max"&&et>we?we=et:i==="avg"&&(xe+=et,Ne++),isNaN(we))break}if(isNaN(we))break}if(isNaN(we))break}const Ae=pe+F;w[Ae]=i==="avg"?xe/Math.max(Ne,1):we}}}}return v}function hme(t,e){const n=He(e.outShape,"int32"),s=e.strideDepth,r=e.strideHeight,i=e.strideWidth,o=e.dilationDepth,a=e.dilationHeight,l=e.dilationWidth,c=e.effectiveFilterDepth,u=e.effectiveFilterHeight,d=e.effectiveFilterWidth,h=e.padInfo.front,f=e.padInfo.top,p=e.padInfo.left;for(let m=0;m<e.batchSize;++m)for(let g=0;g<e.inChannels;++g)for(let y=0;y<e.outDepth;++y){const x=y*s-h;let v=x;for(;v<0;)v+=o;const w=Math.min(e.inDepth,c+x);for(let S=0;S<e.outHeight;++S){const k=S*r-f;let C=k;for(;C<0;)C+=a;const N=Math.min(e.inHeight,u+k);for(let T=0;T<e.outWidth;++T){const I=T*i-p;let D=I;for(;D<0;)D+=l;const F=Math.min(e.inWidth,d+I);let A=Number.NEGATIVE_INFINITY,O=-1;for(let P=v;P<w;P+=o){const L=P-x;for(let G=C;G<N;G+=a){const $=G-k;for(let U=D;U<F;U+=l){const K=U-I,j=t.get(m,P,G,U,g);j>=A&&(A=j,O=L*u*d+$*u+K)}}}n.set(O,m,y,S,T,g)}}}return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fme(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e;be(r,"avgPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,c=1;E(is(o,c),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);const u=ai(r.shape,i,o,c,a,l);let d;if(u.filterWidth===1&&u.filterHeight===1&&ct(u.inShape,u.outShape))d=xo({inputs:{x:r},backend:n});else{const h=n.data.get(r.dataId).values,f=ke(r.shape),p=v2(h,r.shape,r.dtype,f,u,"avg");d=n.makeTensorInfo(u.outShape,r.dtype,p.values)}return d}const pme={kernelName:Ib,backendName:"cpu",kernelFunc:fme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mme(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:c}=s;be(r,"avgPool3d");const u=la(r.shape,i,o,1,a,l,c),d=n.data.get(r.dataId).values,h=$W(d,r.shape,r.dtype,ke(r.shape),u,"avg");return n.makeTensorInfo(h.shape,"float32",h.values)}const gme={kernelName:Ab,backendName:"cpu",kernelFunc:mme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yme(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:i}=e,{filterSize:o,strides:a,pad:l,dimRoundingMode:c}=s;be([r,i],"avgPool3DGrad");const u=la(i.shape,o,a,1,l,c),d=u.strideDepth,h=u.strideHeight,f=u.strideWidth,p=u.filterDepth,m=u.filterHeight,g=u.filterWidth,y=u.dilationDepth,x=u.dilationHeight,v=u.dilationWidth,w=u.effectiveFilterDepth,S=u.effectiveFilterHeight,k=u.effectiveFilterWidth,C=w-1-u.padInfo.front,N=k-1-u.padInfo.left,T=S-1-u.padInfo.top,I=He(i.shape,"float32"),D=1/(p*m*g),F=n.bufferSync(r);for(let A=0;A<u.batchSize;++A)for(let O=0;O<u.inChannels;++O)for(let P=0;P<u.inDepth;++P)for(let L=0;L<u.inHeight;++L)for(let G=0;G<u.inWidth;++G){const $=P-C,U=L-T,K=G-N;let j=0;for(let ee=0;ee<w;ee+=y){const Z=($+ee)/d;if(!(Z<0||Z>=u.outDepth||Math.floor(Z)!==Z))for(let re=0;re<S;re+=x){const te=(U+re)/h;if(!(te<0||te>=u.outHeight||Math.floor(te)!==te))for(let le=0;le<k;le+=v){const pe=(K+le)/f;if(pe<0||pe>=u.outWidth||Math.floor(pe)!==pe)continue;const we=F.get(A,Z,te,pe,O);j+=we}}}I.set(j*D,A,P,L,G,O)}return n.makeTensorInfo(I.shape,I.dtype,I.values)}const xme={kernelName:YT,backendName:"cpu",kernelFunc:yme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bme(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:i}=e,o=i;be([r,i],"avgPoolGrad");const{filterSize:a,strides:l,pad:c}=s,u=ai(o.shape,a,l,1,c),d=u.strideHeight,h=u.strideWidth,f=u.filterHeight,p=u.filterWidth,m=u.dilationHeight,g=u.dilationWidth,y=u.effectiveFilterHeight,x=u.effectiveFilterWidth,v=x-1-u.padInfo.left,w=y-1-u.padInfo.top,S=He(o.shape,"float32"),k=1/(f*p),C=n.data.get(r.dataId).values,N=He(r.shape,"float32",C);for(let T=0;T<u.batchSize;++T)for(let I=0;I<u.inChannels;++I)for(let D=0;D<u.inHeight;++D)for(let F=0;F<u.inWidth;++F){const A=D-w,O=F-v;let P=0;for(let L=0;L<y;L+=m){const G=(A+L)/d;if(!(G<0||G>=u.outHeight||Math.floor(G)!==G))for(let $=0;$<x;$+=g){const U=(O+$)/h;if(U<0||U>=u.outWidth||Math.floor(U)!==U)continue;const K=N.get(T,G,U,I);P+=K}}S.set(P*k,T,D,F,I)}return n.makeTensorInfo(S.shape,S.dtype,S.values)}const vme={kernelName:JT,backendName:"cpu",kernelFunc:bme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wme(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,scale:i,offset:o,mean:a,variance:l}=e;E(a.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),E(o==null||a.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),E(i==null||a.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),be([r,a,l,i,o],"batchNorm");let{varianceEpsilon:c}=s;c==null&&(c=.001);const u=n.data.get(r.dataId).values,d=n.data.get(a.dataId).values,h=n.data.get(l.dataId).values,f=i?n.data.get(i.dataId).values:new Float32Array([1]),p=o?n.data.get(o.dataId).values:new Float32Array([0]),m=new Float32Array(u.length),g=p.length,y=f.length,x=h.length,v=d.length;let w=0,S=0,k=0,C=0;for(let N=0;N<u.length;++N)m[N]=p[w++]+(u[N]-d[S++])*f[k++]/Math.sqrt(h[C++]+c),w>=g&&(w=0),S>=v&&(S=0),k>=y&&(k=0),C>=x&&(C=0);return n.makeTensorInfo(r.shape,r.dtype,m)}const Sme={kernelName:Vb,backendName:"cpu",kernelFunc:wme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kme(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockShape:i,crops:o}=s;be([r],"batchToSpaceND");const a=i.reduce((y,x)=>y*x),l=Mm(r.shape,i,a),c=Pm(l.length,i.length),u=Lm(r.shape,i,a),d=$I(o,i.length),h=RI(u,o,i.length),f=kt({inputs:{x:r},backend:n,attrs:{shape:l}}),p=zs({inputs:{x:f},backend:n,attrs:{perm:c}}),m=kt({inputs:{x:p},backend:n,attrs:{shape:u}}),g=Fc({inputs:{x:m},backend:n,attrs:{begin:d,size:h}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),g}const Cme={kernelName:Rb,backendName:"cpu",kernelFunc:kme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nme(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,weights:i}=e,{size:o}=s,a=n.data.get(r.dataId).values,l=n.data.get(i.dataId).values,c=m2(a,l,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,c)}const Tme={kernelName:QT,backendName:"cpu",kernelFunc:Nme};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eme(t){const{inputs:e,backend:n}=t,{s0:s,s1:r}=e,i=n.data.get(s.dataId).values,o=n.data.get(r.dataId).values,a=_e(Array.from(i),Array.from(o));return n.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const Ime={kernelName:Yz,backendName:"cpu",kernelFunc:Eme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ame=ht(Up,(t,e)=>{const n=e;return t>n.clipValueMax?n.clipValueMax:t<n.clipValueMin?n.clipValueMin:t}),$me={kernelName:Up,backendName:"cpu",kernelFunc:Ame};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rme=t=>{const{x:e}=t.inputs,n=t.backend,s=new Float32Array(Q(e.shape)),r=n.data.get(e.dataId),i=r.complexTensorInfos.real,o=r.complexTensorInfos.imag,a=n.data.get(i.dataId).values,l=n.data.get(o.dataId).values;for(let c=0;c<a.length;c++){const u=a[c],d=l[c];s[c]=Math.hypot(u,d)}return n.makeOutput(s,e.shape,"float32")},Dme={kernelName:Db,backendName:"cpu",kernelFunc:Rme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ad(t){const{inputs:e,backend:n}=t,{input:s}=e,r=n.data.get(s.dataId).complexTensorInfos.imag,i=n.data.get(r.dataId).values;return n.makeTensorInfo(r.shape,r.dtype,i)}const Ome={kernelName:gE,backendName:"cpu",kernelFunc:Ad};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $d(t){const{inputs:e,backend:n,attrs:s}=t,{axis:r}=s,i=Ge(r,e[0].shape)[0],o=e.map(m=>m.shape);EI(o,i);let a=lo(e.map(m=>m.shape),i);if(Q(a)===0)return n.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(m=>Q(m.shape)>0);if(l.length===1)return xo({inputs:{x:l[0]},backend:n});if(l[0].dtype==="complex64"){const m=l.map(w=>Lc({inputs:{input:w},backend:n})),g=l.map(w=>Ad({inputs:{input:w},backend:n})),y=$d({inputs:m,backend:n,attrs:{axis:i}}),x=$d({inputs:g,backend:n,attrs:{axis:i}}),v=Qs({inputs:{real:y,imag:x},backend:n});return m.forEach(w=>n.disposeIntermediateTensorInfo(w)),g.forEach(w=>n.disposeIntermediateTensorInfo(w)),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(x),v}const c=l.map(m=>{const y=[-1,Q(m.shape.slice(i))];return kt({inputs:{x:m},backend:n,attrs:{shape:y}})}),u=c.map(m=>({vals:n.data.get(m.dataId).values,shape:m.shape}));a=lo(c.map(m=>m.shape),1);const d=c[0].shape[0]===1,h=PU(u,a,e[0].dtype,d),f=lo(l.map(m=>m.shape),i),p=n.makeTensorInfo(f,e[0].dtype,h);return c.forEach(m=>n.disposeIntermediateTensorInfo(m)),p}const Mme={kernelName:Ob,backendName:"cpu",kernelFunc:$d};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RW(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i}=e,{strides:o,pad:a,dataFormat:l,dilations:c,dimRoundingMode:u}=s;be([r,i],"conv2d");const d=ca(l),h=Wn(r.shape,i.shape,o,c,a,u,!1,d),f=h.filterHeight,p=h.filterWidth,m=h.dilationHeight,g=h.dilationWidth,y=h.padInfo.left,x=h.padInfo.top,v=h.dataFormat==="channelsLast",w=new jn(h.outShape,r.dtype),S=ke(r.shape),k=ke(i.shape),C=S[0],N=v?S[1]:S[2],T=v?S[2]:1,I=v?1:S[1],D=w.strides[0],F=v?w.strides[1]:w.strides[2],A=v?w.strides[2]:1,O=v?1:w.strides[1],P=n.data.get(r.dataId).values,L=n.data.get(i.dataId).values,G=w.values;for(let $=0;$<h.batchSize;++$){const U=$*C,K=$*D;for(let j=0;j<h.outHeight;++j){const ee=K+j*F,Z=j*h.strideHeight-x;for(let re=0;re<f;++re){const te=Z+re*m;if(te<0||te>=h.inHeight)continue;const le=re*k[0],pe=U+te*N;for(let we=0;we<h.outWidth;++we){const xe=ee+we*A,Ne=we*h.strideWidth-y;for(let Ae=0;Ae<p;++Ae){const Qe=Ne+Ae*g;if(Qe<0||Qe>=h.inWidth)continue;const Xe=le+Ae*k[1],ft=pe+Qe*T;let qe=Xe;for(let Ze=0;Ze<h.inChannels;++Ze){const ut=P[ft+Ze*I];for(let et=0;et<h.outChannels;++et)G[xe+et*O]+=ut*L[qe+et];qe+=h.outChannels}}}}}}return n.makeTensorInfo(w.shape,w.dtype,G)}const Pme={kernelName:Mb,backendName:"cpu",kernelFunc:RW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lme(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:i}=e,{strides:o,pad:a,dataFormat:l,dimRoundingMode:c,filterShape:u}=s;be([r,i],"conv2dBackpropFilter");const d=ca(l),h=Wn(r.shape,u,o,1,a,c,!1,d),{strideHeight:f,strideWidth:p,filterHeight:m,filterWidth:g}=h,y=h.dataFormat==="channelsLast",x=new jn(h.filterShape,"float32"),v=h.padInfo.left,w=h.padInfo.top,S=n.data.get(r.dataId).values,k=n.data.get(i.dataId).values,C=new jn(r.shape,r.dtype,S),N=new jn(i.shape,i.dtype,k);for(let T=0;T<m;++T){const I=Math.max(0,Math.ceil((w-T)/f)),D=Math.min(h.outHeight,(h.inHeight+w-T)/f);for(let F=0;F<g;++F){const A=Math.max(0,Math.ceil((v-F)/p)),O=Math.min(h.outWidth,(h.inWidth+v-F)/p);for(let P=0;P<h.inChannels;++P)for(let L=0;L<h.outChannels;++L){let G=0;for(let $=0;$<h.batchSize;++$)for(let U=I;U<D;++U){const K=T+U*f-w;for(let j=A;j<O;++j){const ee=F+j*p-v;y?G+=C.get($,K,ee,P)*N.get($,U,j,L):G+=C.get($,P,K,ee)*N.get($,L,U,j)}}x.set(G,T,F,P,L)}}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}const Fme={kernelName:tE,backendName:"cpu",kernelFunc:Lme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _me(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:i}=e,{inputShape:o,strides:a,pad:l,dataFormat:c,dimRoundingMode:u}=s;be([r,i],"conv2dBackpropInput");const d=ke(i.shape),h=ke(r.shape);let f=ca(c);const p=Wn(o,i.shape,a,1,l,u,!1,f),m=new jn(p.inShape,"float32"),g=m.values,y=n.data.get(r.dataId).values,x=n.data.get(i.dataId).values,[v,w,S]=d,{batchSize:k,filterHeight:C,filterWidth:N,inChannels:T,inHeight:I,inWidth:D,outChannels:F,outHeight:A,outWidth:O,strideHeight:P,strideWidth:L}=p;f=p.dataFormat;const G=C-1-p.padInfo.top,$=N-1-p.padInfo.left,U=f==="channelsLast",K=m.strides[0],j=U?m.strides[1]:m.strides[2],ee=U?m.strides[2]:1,Z=U?1:m.strides[1],re=h[0],te=U?h[1]:h[2],le=U?h[2]:1,pe=U?1:h[1];for(let we=0;we<k;++we)for(let xe=0;xe<T;++xe)for(let Ne=0;Ne<I;++Ne){const Ae=Ne-G,Qe=Math.max(0,Math.ceil(Ae/P)),Xe=Math.min(A,(C+Ae)/P);for(let ft=0;ft<D;++ft){const qe=ft-$,Ze=Math.max(0,Math.ceil(qe/L)),ut=Math.min(O,(N+qe)/L);let et=0;for(let Fe=Qe;Fe<Xe;++Fe){const Pt=Fe*P-Ae;for(let yt=Ze;yt<ut;++yt){const dn=yt*L-qe,Ct=re*we+te*Fe+le*yt,Kn=v*(C-1-Pt)+w*(N-1-dn)+S*xe;for(let qn=0;qn<F;++qn){const on=y[Ct+pe*qn],hr=x[Kn+qn];et+=on*hr}}}const ge=K*we+j*Ne+ee*ft+Z*xe;g[ge]=et}}return n.makeTensorInfo(m.shape,m.dtype,m.values)}const zme={kernelName:Pb,backendName:"cpu",kernelFunc:_me};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bme(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l}=s;be([r,i],"conv3d");const c=Sl(r.shape,i.shape,o,l,a),{filterDepth:u,filterHeight:d,filterWidth:h,dilationDepth:f,dilationHeight:p,dilationWidth:m,padInfo:g}=c,y=g.front,x=g.left,v=g.top,w=new jn(c.outShape,r.dtype),S=n.data.get(r.dataId).values,k=n.data.get(i.dataId).values,C=w.values,N=ke(r.shape),T=ke(i.shape);for(let I=0;I<c.batchSize;++I){const D=I*N[0],F=I*w.strides[0];for(let A=0;A<c.outDepth;++A){const O=F+A*w.strides[1],P=A*c.strideDepth-y;for(let L=0;L<u;++L){const G=P+L*f;if(G<0||G>=c.inDepth)continue;const $=L*T[0],U=D+G*N[1];for(let K=0;K<c.outHeight;++K){const j=O+K*w.strides[2],ee=K*c.strideHeight-v;for(let Z=0;Z<d;++Z){const re=ee+Z*p;if(re<0||re>=c.inHeight)continue;const te=$+Z*T[1],le=U+re*N[2];for(let pe=0;pe<c.outWidth;++pe){const we=j+pe*c.outChannels,xe=pe*c.strideWidth-x;for(let Ne=0;Ne<h;++Ne){const Ae=xe+Ne*m;if(Ae<0||Ae>=c.inWidth)continue;const Qe=te+Ne*T[2],Xe=le+Ae*c.inChannels;let ft=Qe;for(let qe=0;qe<c.inChannels;++qe){const Ze=S[Xe+qe];for(let ut=0;ut<c.outChannels;++ut)C[we+ut]+=Ze*k[ft+ut];ft+=c.outChannels}}}}}}}}return n.makeTensorInfo(w.shape,w.dtype,w.values)}const jme={kernelName:Lb,backendName:"cpu",kernelFunc:Bme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vme(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:i}=e,{strides:o,pad:a,filterShape:l}=s;be([r,i],"conv3dBackpropFilterV2");const c=ke(r.shape),u=ke(i.shape),d=Sl(r.shape,l,o,1,a),h=d.strideDepth,f=d.strideHeight,p=d.strideWidth,m=d.filterDepth,g=d.filterHeight,y=d.filterWidth,x=new jn(d.filterShape,"float32"),v=x.values,[w,S,k,C]=x.strides,N=n.data.get(i.dataId).values,[T,I,D,F]=u,A=n.data.get(r.dataId).values,[O,P,L,G]=c,$=d.padInfo.front,U=d.padInfo.left,K=d.padInfo.top;for(let j=0;j<m;++j){const ee=Math.max(0,Math.ceil(($-j)/h)),Z=Math.min(d.outDepth,(d.inDepth+$-j)/h),re=j*w;for(let te=0;te<g;++te){const le=Math.max(0,Math.ceil((K-te)/f)),pe=Math.min(d.outHeight,(d.inHeight+K-te)/f),we=te*S+re;for(let xe=0;xe<y;++xe){const Ne=Math.max(0,Math.ceil((U-xe)/p)),Ae=Math.min(d.outWidth,(d.inWidth+U-xe)/p),Qe=xe*k+we;for(let Xe=0;Xe<d.inChannels;++Xe){const ft=Xe*C+Qe;for(let qe=0;qe<d.outChannels;++qe){let Ze=0;for(let ut=0;ut<d.batchSize;++ut){const et=ut*O,ge=ut*T;for(let Fe=ee;Fe<Z;++Fe){const yt=(j+Fe*h-$)*P+et,dn=Fe*I+ge;for(let Ct=le;Ct<pe;++Ct){const qn=(te+Ct*f-K)*L+yt,on=Ct*D+dn;for(let hr=Ne;hr<Ae;++hr){const ko=(xe+hr*p-U)*G+qn,Ol=hr*F+on;Ze+=A[ko+Xe]*N[Ol+qe]}}}}v[ft+qe]=Ze}}}}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}const Ume={kernelName:nE,backendName:"cpu",kernelFunc:Vme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wme(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:i}=e,{pad:o,strides:a,inputShape:l}=s;be([r],"conv3dBackpropInputV2");const c=ke(r.shape),u=ke(i.shape),d=Sl(l,i.shape,a,1,o),h=new jn(d.inShape,"float32"),f=h.values,[p,m,g,y]=h.strides,x=n.data.get(r.dataId).values,[v,w,S,k]=c,C=n.data.get(i.dataId).values,[N,T,I,D]=u,{batchSize:F,filterDepth:A,filterHeight:O,filterWidth:P,inChannels:L,inDepth:G,inHeight:$,inWidth:U,outChannels:K,outDepth:j,outHeight:ee,outWidth:Z,strideDepth:re,strideHeight:te,strideWidth:le}=d,pe=A-1-d.padInfo.front,we=O-1-d.padInfo.top,xe=P-1-d.padInfo.left;for(let Ne=0;Ne<F;++Ne)for(let Ae=0;Ae<L;++Ae)for(let Qe=0;Qe<G;++Qe){const Xe=Qe-pe,ft=Math.max(0,Math.ceil(Xe/re)),qe=Math.min(j,(A+Xe)/re);for(let Ze=0;Ze<$;++Ze){const ut=Ze-we,et=Math.max(0,Math.ceil(ut/te)),ge=Math.min(ee,(O+ut)/te);for(let Fe=0;Fe<U;++Fe){const Pt=Fe-xe,yt=Math.max(0,Math.ceil(Pt/le)),dn=Math.min(Z,(P+Pt)/le);let Ct=0;for(let Kn=ft;Kn<qe;++Kn){const qn=Kn*re-Xe;for(let on=et;on<ge;++on){const hr=on*te-ut;for(let _i=yt;_i<dn;++_i){const ko=_i*le-Pt,Ol=v*Ne+w*Kn+S*on+k*_i,tg=N*(A-1-qn)+T*(O-1-hr)+I*(P-1-ko)+D*Ae;for(let Co=0;Co<K;++Co){const lu=x[Ol+Co],ui=C[tg+Co];Ct+=lu*ui}}}}f[p*Ne+m*Qe+g*Ze+y*Fe+Ae]=Ct}}}return n.makeTensorInfo(h.shape,h.dtype,h.values)}const Hme={kernelName:sE,backendName:"cpu",kernelFunc:Wme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gme=ht(Wp,t=>Math.cos(t)),Kme={kernelName:Wp,backendName:"cpu",kernelFunc:Gme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qme=ht(Hp,t=>Math.cosh(t)),Xme={kernelName:Hp,backendName:"cpu",kernelFunc:qme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jme(t){const{inputs:e,backend:n,attrs:s}=t,{image:r,boxes:i,boxInd:o}=e,{cropSize:a,method:l,extrapolationValue:c}=s,[u,d,h,f]=r.shape,p=i.shape[0],[m,g]=a,y=He([p,m,g,f],"float32"),x=n.data.get(i.dataId).values,v=n.data.get(o.dataId).values,w=n.data.get(r.dataId).values,S=ke(r.shape),k=ke(y.shape);for(let C=0;C<p;C++){const N=C*4,T=x[N],I=x[N+1],D=x[N+2],F=x[N+3],A=v[C];if(A>=u)continue;const O=m>1?(D-T)*(d-1)/(m-1):0,P=g>1?(F-I)*(h-1)/(g-1):0;for(let L=0;L<m;L++){const G=m>1?T*(d-1)+L*O:.5*(T+D)*(d-1);if(G<0||G>d-1){for(let $=0;$<g;$++)for(let U=0;U<f;U++){const K=U+$*k[2]+L*k[1]+C*k[0];y.values[K]=c}continue}if(l==="bilinear"){const $=Math.floor(G),U=Math.ceil(G),K=G-$;for(let j=0;j<g;j++){const ee=g>1?I*(h-1)+j*P:.5*(I+F)*(h-1);if(ee<0||ee>h-1){for(let le=0;le<f;le++){const pe=le+j*k[2]+L*k[1]+C*k[0];y.values[pe]=c}continue}const Z=Math.floor(ee),re=Math.ceil(ee),te=ee-Z;for(let le=0;le<f;le++){let pe=le+Z*S[2]+$*S[1]+A*S[0];const we=w[pe];pe=le+re*S[2]+$*S[1]+A*S[0];const xe=w[pe];pe=le+Z*S[2]+U*S[1]+A*S[0];const Ne=w[pe];pe=le+re*S[2]+U*S[1]+A*S[0];const Ae=w[pe],Qe=we+(xe-we)*te,Xe=Ne+(Ae-Ne)*te;pe=le+j*k[2]+L*k[1]+C*k[0],y.values[pe]=Qe+(Xe-Qe)*K}}}else for(let $=0;$<g;++$){const U=g>1?I*(h-1)+$*P:.5*(I+F)*(h-1);if(U<0||U>h-1){for(let ee=0;ee<f;ee++){const Z=ee+$*k[2]+L*k[1]+C*k[0];y.values[Z]=c}continue}const K=Math.round(U),j=Math.round(G);for(let ee=0;ee<f;ee++){const Z=ee+K*S[2]+j*S[1]+A*S[0],re=ee+$*k[2]+L*k[1]+C*k[0];y.values[re]=w[Z]}}}}return n.makeTensorInfo(y.shape,y.dtype,y.values)}const Yme={kernelName:iE,backendName:"cpu",kernelFunc:Jme};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qme(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;be(r,"cumprod");const l=Bt([i],r.shape.length);let c=r;l!=null&&(c=zs({inputs:{x:r},backend:n,attrs:{perm:l}}));const u=nn(1,r.shape.length)[0];if(u!==c.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${c.shape.length-1} but got axis=${u}`);const d=lr(c.dtype,"int32"),h=WT(Q(c.shape),d),f=n.data.get(c.dataId).values,p=c.shape[c.shape.length-1],m=a?(y,x)=>y+p-x-1:(y,x)=>y+x;for(let y=0;y<f.length;y+=p)for(let x=0;x<p;x++){const v=m(y,x);if(x===0)h[v]=o?1:f[v];else{const w=m(y,x-1);h[v]=o?f[w]*h[w]:f[v]*h[w]}}const g=n.makeTensorInfo(c.shape,d,h);if(l!=null){const y=kl(l),x=zs({inputs:{x:g},backend:n,attrs:{perm:y}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(c),x}return g}const Zme={kernelName:rE,backendName:"cpu",kernelFunc:Qme};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ege(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;be(r,"cumsum");const l=Bt([i],r.shape.length);let c=r;l!=null&&(c=zs({inputs:{x:r},backend:n,attrs:{perm:l}}));const u=nn(1,r.shape.length)[0];if(u!==c.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${c.shape.length-1} but got axis=${u}`);const d=lr(c.dtype,"int32"),h=ss(Q(c.shape),d),f=n.data.get(c.dataId).values,p=c.shape[c.shape.length-1],m=a?(y,x)=>y+p-x-1:(y,x)=>y+x;for(let y=0;y<f.length;y+=p)for(let x=0;x<p;x++){const v=m(y,x);if(x===0)h[v]=o?0:f[v];else{const w=m(y,x-1);h[v]=o?f[w]+h[w]:f[v]+h[w]}}const g=n.makeTensorInfo(c.shape,d,h);if(l!=null){const y=kl(l),x=zs({inputs:{x:g},backend:n,attrs:{perm:y}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(c),x}return g}const tge={kernelName:Fb,backendName:"cpu",kernelFunc:ege};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nge(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,weights:i}=e,{size:o,binaryOutput:a}=s;if(r.shape.length===1){const l=n.data.get(r.dataId).values,c=n.data.get(i.dataId).values,u=m2(l,c,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,u)}else if(r.shape.length===2){const l=n.bufferSync(r),c=n.bufferSync(i),u=DU(l,c,o,a);return n.makeTensorInfo(u.shape,i.dtype,u.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const sge={kernelName:oE,backendName:"cpu",kernelFunc:nge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rge(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockSize:i,dataFormat:o}=s;E(o==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${o}`);const a=r.shape[0],l=r.shape[1],c=r.shape[2],u=r.shape[3],d=l*i,h=c*i,f=u/(i*i),p=n.data.get(r.dataId).values,m=new Float32Array(a*d*h*f);let g=0;for(let y=0;y<a;++y)for(let x=0;x<d;++x){const v=Math.floor(x/i),w=x%i;for(let S=0;S<h;++S){const k=Math.floor(S/i),C=S%i,N=(w*i+C)*f;for(let T=0;T<f;++T){const D=T+N+u*(k+c*(v+l*y));m[g++]=p[D]}}}return n.makeTensorInfo([a,d,h,f],r.dtype,m)}const ige={kernelName:aE,backendName:"cpu",kernelFunc:rge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DW(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l,dimRoundingMode:c}=s;be([r,i],"depthwiseConv2DNative");const u=ke(r.shape),d=ke(i.shape);let h=l;h==null&&(h=[1,1]),E(is(o,h),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${h}'`);const f=Wn(r.shape,i.shape,o,h,a,c,!0),{filterHeight:p,filterWidth:m,dilationHeight:g,dilationWidth:y,padInfo:x}=f,v=x.left,w=x.top,S=f.outChannels/f.inChannels,k=new jn(f.outShape,r.dtype),C=n.data.get(r.dataId).values,N=n.data.get(i.dataId).values,T=k.values;for(let I=0;I<f.batchSize;++I){const D=I*u[0],F=I*k.strides[0];for(let A=0;A<f.outHeight;++A){const O=F+A*k.strides[1],P=A*f.strideHeight-w;for(let L=0;L<p;++L){const G=P+L*g;if(G<0||G>=f.inHeight)continue;const $=L*d[0],U=D+G*u[1];for(let K=0;K<f.outWidth;++K){const j=O+K*k.strides[2],ee=K*f.strideWidth-v;for(let Z=0;Z<m;++Z){const re=ee+Z*y;if(re<0||re>=f.inWidth)continue;const te=$+Z*d[1],le=U+re*f.inChannels;let pe=j,we=te;for(let xe=0;xe<f.inChannels;++xe){const Ne=C[le+xe];for(let Ae=0;Ae<S;++Ae)T[pe+Ae]+=Ne*N[we+Ae];pe+=S,we+=S}}}}}}return n.makeTensorInfo(k.shape,k.dtype,k.values)}const oge={kernelName:_b,backendName:"cpu",kernelFunc:DW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function age(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:c,filterShape:u}=s;be([r,i],"depthwiseConv2dNativeBackpropFilter");const d=Wn(r.shape,u,o,a,l,c,!0),{strideHeight:h,strideWidth:f,filterHeight:p,filterWidth:m}=d,g=new jn(d.filterShape,"float32"),y=d.padInfo.left,x=d.padInfo.top,v=d.outChannels/d.inChannels,w=n.data.get(r.dataId).values,S=new jn(r.shape,r.dtype,w),k=n.data.get(i.dataId).values,C=new jn(i.shape,i.dtype,k);for(let N=0;N<p;++N){const T=Math.max(0,Math.ceil((x-N)/h)),I=Math.min(d.outHeight,(d.inHeight+x-N)/h);for(let D=0;D<m;++D){const F=Math.max(0,Math.ceil((y-D)/f)),A=Math.min(d.outWidth,(d.inWidth+y-D)/f);for(let O=0;O<d.outChannels;++O){const P=Math.trunc(O/v),L=O%v;let G=0;for(let $=0;$<d.batchSize;++$)for(let U=T;U<I;++U){const K=N+U*h-x;for(let j=F;j<A;++j){const ee=D+j*f-y;G+=S.get($,K,ee,P)*C.get($,U,j,O)}}g.set(G,N,D,P,L)}}}return n.makeTensorInfo(g.shape,g.dtype,g.values)}const lge={kernelName:lE,backendName:"cpu",kernelFunc:age};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cge(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:c,inputShape:u}=s;be([r,i],"depthwiseConv2DNativeBackpropInput");const d=ke(r.shape),h=ke(i.shape),f=Wn(u,i.shape,o,a,l,c,!0),p=new jn(f.inShape,"float32"),m=p.values,[g,y,x]=p.strides,v=n.data.get(r.dataId).values,[w,S,k]=d,C=n.data.get(i.dataId).values,[N,T,I]=h,{batchSize:D,filterHeight:F,filterWidth:A,inChannels:O,inHeight:P,inWidth:L,outChannels:G,outHeight:$,outWidth:U,strideHeight:K,strideWidth:j}=f,ee=F-1-f.padInfo.top,Z=A-1-f.padInfo.left,re=G/O;for(let te=0;te<D;++te)for(let le=0;le<O;++le)for(let pe=0;pe<P;++pe){const we=pe-ee,xe=Math.max(0,Math.ceil(we/K)),Ne=Math.min($,(F+we)/K);for(let Ae=0;Ae<L;++Ae){const Qe=Ae-Z,Xe=Math.max(0,Math.ceil(Qe/j)),ft=Math.min(U,(A+Qe)/j);let qe=0;for(let Ze=xe;Ze<Ne;++Ze){const ut=Ze*K-we;for(let et=Xe;et<ft;++et){const ge=et*j-Qe,Fe=w*te+S*Ze+k*et,Pt=N*(F-1-ut)+T*(A-1-ge)+I*le;for(let yt=0;yt<re;++yt){const dn=le*re+yt,Ct=v[Fe+dn],Kn=C[Pt+yt];qe+=Ct*Kn}}}m[g*te+y*pe+x*Ae+le]=qe}}return n.makeTensorInfo(p.shape,p.dtype,p.values)}const uge={kernelName:cE,backendName:"cpu",kernelFunc:cge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dge(t){const{inputs:e,backend:n}=t,{x:s}=e,r=Q(s.shape),i=n.data.get(s.dataId).values,o=He([r,r],s.dtype),a=o.values;for(let c=0;c<i.length;c++)a[c*r+c]=i[c];const l=[...s.shape,...s.shape];return n.makeTensorInfo(l,o.dtype,o.values)}const hge={kernelName:Qz,backendName:"cpu",kernelFunc:dge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fge={kernelName:zb,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:s,filter:r}=t,{strides:i,pad:o,dilations:a}=n,l=e,c=l.data.get(s.dataId).values,u=s.shape.length,d=l.data.get(r.dataId).values,h=r.shape.length,{batchSize:f,inHeight:p,inWidth:m,inChannels:g,outHeight:y,outWidth:x,padInfo:v,strideHeight:w,strideWidth:S,filterHeight:k,filterWidth:C,dilationHeight:N,dilationWidth:T,outShape:I}=Am(s.shape,r.shape,i,o,"NHWC",a),D=Q(I),F=I.length,A=Zt(s.dtype,D);for(let P=0;P<f;++P)for(let L=0;L<y;++L){const G=L*w-v.top;for(let $=0;$<x;++$){const U=$*S-v.left;for(let K=0;K<g;++K){let j=Number.MIN_SAFE_INTEGER;for(let Z=0;Z<k;++Z){const re=G+Z*N;if(re>=0&&re<p)for(let te=0;te<C;++te){const le=U+te*T;if(le>=0&&le<m){const pe=oo([P,re,le,K],u,ke(s.shape)),we=oo([Z,te,K],h,ke(r.shape)),xe=c[pe]+d[we];xe>j&&(j=xe)}}}const ee=oo([P,L,$,K],F,ke(I));A[ee]=j}}}return{dataId:l.write(Jc(A,s.dtype),I,s.dtype),shape:I,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pge={kernelName:Xk,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:s,filter:r,dy:i}=t,{strides:o,pad:a,dilations:l}=n,c=e,u=Ei(s.shape,c.data.get(s.dataId).values),d=Ei(r.shape,c.data.get(r.dataId).values),{batchSize:h,inHeight:f,inWidth:p,inChannels:m,outHeight:g,outWidth:y,padInfo:x,strideHeight:v,strideWidth:w,filterHeight:S,filterWidth:k,dilationHeight:C,dilationWidth:N,outShape:T}=Am(s.shape,r.shape,o,a,"NHWC",l);E(i.rank===T.length,()=>`Error in ${Xk}, dy must have the same rank as output ${T.length}, but got ${i.rank}`);const I=Ei(T,c.data.get(i.dataId).values),D=qz(r.shape,r.dtype);for(let A=0;A<h;++A)for(let O=0;O<g;++O){const P=O*v-x.top;for(let L=0;L<y;++L){const G=L*w-x.left;for(let $=0;$<m;++$){let U=Number.MIN_SAFE_INTEGER,K=0,j=0;for(let ee=0;ee<S;++ee){const Z=P+ee*C;if(Z>=0&&Z<f)for(let re=0;re<k;++re){const te=G+re*N;if(te>=0&&te<p){const le=u[A][Z][te][$]+d[ee][re][$];le>U&&(U=le,K=ee,j=re)}}}D[K][j][$]+=I[A][O][L][$]}}}return{dataId:c.write(Jc(D,s.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mge={kernelName:qk,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:s,filter:r,dy:i}=t,{strides:o,pad:a,dilations:l}=n,c=e,u=Ei(s.shape,c.data.get(s.dataId).values),d=Ei(r.shape,c.data.get(r.dataId).values),{batchSize:h,inHeight:f,inWidth:p,inChannels:m,outHeight:g,outWidth:y,padInfo:x,strideHeight:v,strideWidth:w,filterHeight:S,filterWidth:k,dilationHeight:C,dilationWidth:N,outShape:T}=Am(s.shape,r.shape,o,a,"NHWC",l);E(i.rank===T.length,()=>`Error in ${qk}, dy must have the same rank as output ${T.length}, but got ${i.rank}`);const I=Ei(T,c.data.get(i.dataId).values),D=qz(s.shape,s.dtype);for(let A=0;A<h;++A)for(let O=0;O<g;++O){const P=O*v-x.top;for(let L=0;L<y;++L){const G=L*w-x.left;for(let $=0;$<m;++$){let U=Number.MIN_SAFE_INTEGER,K=P<0?0:P,j=G<0?0:G;for(let ee=0;ee<S;++ee){const Z=P+ee*C;if(Z>=0&&Z<f)for(let re=0;re<k;++re){const te=G+re*N;if(te>=0&&te<p){const le=u[A][Z][te][$]+d[ee][re][$];le>U&&(U=le,K=Z,j=te)}}}D[A][K][j][$]+=I[A][O][L][$]}}}return{dataId:c.write(Jc(D,s.dtype),s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gge(t){const{inputs:e,backend:n,attrs:s}=t,{image:r}=e,{canvas:i,options:o}=s,{contextOptions:a,imageOptions:l}=o||{},c=(l==null?void 0:l.alpha)||1,u=(a==null?void 0:a.contextType)||"2d";if(u!=="2d")throw new Error(`Context type ${a.contextType} is not supported by the CPU backend.`);const d=i.getContext(u,(a==null?void 0:a.contextAttributes)||{});if(d==null)throw new Error(`Could not get the context with ${u} type.`);const[h,f]=r.shape.slice(0,2),p=r.shape.length===2?1:r.shape[2],m=n.data.get(r.dataId).values,g=r.dtype==="float32"?255:1,y=new Uint8ClampedArray(f*h*4);for(let v=0;v<h*f;++v){const w=[0,0,0,255*c];for(let k=0;k<p;k++){const C=m[v*p+k];if(r.dtype==="float32"){if(C<0||C>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${C}.`)}else if(r.dtype==="int32"&&(C<0||C>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${C}.`);p===1?(w[0]=C*g,w[1]=C*g,w[2]=C*g):w[k]=C*g}const S=v*4;y[S+0]=Math.round(w[0]),y[S+1]=Math.round(w[1]),y[S+2]=Math.round(w[2]),y[S+3]=Math.round(w[3])}i.width=f,i.height=h;const x=new ImageData(y,f,h);return d.putImageData(x,0,0),r}const yge={kernelName:Dne,backendName:"cpu",kernelFunc:gge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hm(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s;be(r,"sum");let a;r.dtype==="bool"?a=dl({inputs:{x:r},backend:n,attrs:{dtype:"int32"}}):a=xo({inputs:{x:r},backend:n});const l=a.shape.length,c=Ge(i,a.shape),u=Bt(c,l);let d=c,h=a;u!=null&&(h=zs({inputs:{x:a},backend:n,attrs:{perm:u}}),d=nn(d.length,l)),Hn("sum",d,h.shape.length);const[f,p]=Dn(h.shape,d),m=lr(h.dtype,"int32");let g=H0(n,f,m);const y=Q(p),x=n.data.get(g.dataId).values,v=n.data.get(h.dataId).values;for(let w=0;w<x.length;++w){const S=w*y;let k=0;for(let C=0;C<y;++C)k+=v[S+C];x[w]=k}if(o){const w=cn(g.shape,c),S=g;g=kt({inputs:{x:g},backend:n,attrs:{shape:w}}),n.disposeIntermediateTensorInfo(S)}return n.disposeIntermediateTensorInfo(a),u!=null&&n.disposeIntermediateTensorInfo(h),g}const xge={kernelName:xv,backendName:"cpu",kernelFunc:Hm};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bge(t){const{inputs:e,backend:n,attrs:s}=t,{equation:r}=s,i=e,{allDims:o,summedDims:a,idDims:l}=zI(r,i.length);jI(o.length,l,i);const{path:c,steps:u}=VI(a,l),d=u.length;let h=null,f=o.length;const p=[];for(let m=0;m<d;++m){for(const g of u[m]){const{permutationIndices:y,expandDims:x}=BI(f,l[g]);let v;UI(y)?v=i[g]:(v=zs({inputs:{x:i[g]},backend:n,attrs:{perm:y}}),p.push(v));const w=v.shape.slice();for(let S=0;S<x.length;++S)w.splice(x[S],0,1);ct(v.shape,w)||(v=kt({inputs:{x:v},backend:n,attrs:{shape:w}}),p.push(v)),h===null?h=v:(h=Xv({inputs:{a:v,b:h},backend:n}),p.push(h))}m<d-1&&(c[m]>=0&&(h=Hm({inputs:{x:h},backend:n,attrs:{axis:c[m]-(o.length-f),keepDims:!1}}),p.push(h)),f--)}for(const m of p)m!==h&&n.disposeIntermediateTensorInfo(m);return h}const vge={kernelName:uE,backendName:"cpu",kernelFunc:bge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wge(t){const{inputs:e,backend:n}=t,{dy:s,y:r}=e;be([s,r],"eluGrad");const i=new Float32Array(Q(r.shape)),o=n.data.get(r.dataId).values,a=n.data.get(s.dataId).values;for(let l=0;l<o.length;++l){const c=o[l];c>=0?i[l]=a[l]:i[l]=a[l]*(c+1)}return n.makeTensorInfo(r.shape,"float32",i)}const Sge={kernelName:dE,backendName:"cpu",kernelFunc:wge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kge=DI,Cge=OI,Nge=MI,Tge=PI,Ege=LI,Ige=FI,Age=ht(qp,t=>{const e=Math.sign(t),n=Math.abs(t),s=1/(1+kge*n);return e*(1-((((Ige*s+Ege)*s+Tge)*s+Nge)*s+Cge)*s*Math.exp(-n*n))}),$ge={kernelName:qp,backendName:"cpu",kernelFunc:Age};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q0(t){const{inputs:e,backend:n,attrs:s}=t,{input:r}=e,{dim:i}=s,o=r.shape.length,a=r.shape.slice();let l=i;return i<0&&(E(-(o+1)<=i,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),l=o+i+1),a.splice(l,0,1),kt({inputs:{x:r},backend:n,attrs:{shape:a}})}const Rge={kernelName:jb,backendName:"cpu",kernelFunc:q0};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dge=rn((t,e)=>t/e),w2=Nn(Gp,Dge),SC={kernelName:Gp,backendName:"cpu",kernelFunc:w2};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OW(t,e,n){const s=t.shape,r=s[0],i=s[1],o=n.data.get(t.dataId),a=o.complexTensorInfos.real,l=o.complexTensorInfos.imag,c=[r,i],u=Q(c),d=ns("float32",u),h=ns("float32",u);for(let g=0;g<r;g++){const y=Fc({inputs:{x:a},backend:n,attrs:{begin:[g,0],size:[1,i]}}),x=Fc({inputs:{x:l},backend:n,attrs:{begin:[g,0],size:[1,i]}}),v=Qs({inputs:{real:y,imag:x},backend:n}),{real:w,imag:S}=Oge(v,e,n),k=ra(w,S);for(let C=0;C<i;C++){const N=_I(k,C);d[g*i+C]=N.real,h[g*i+C]=N.imag}n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(v)}const f=n.makeTensorInfo(c,"float32",d),p=n.makeTensorInfo(c,"float32",h),m=Qs({inputs:{real:f,imag:p},backend:n});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),m}function Oge(t,e,n){const s=Q(t.shape),r=n.data.get(t.dataId),i=n.data.get(r.complexTensorInfos.real.dataId).values,o=n.data.get(r.complexTensorInfos.imag.dataId).values;if(Mge(s)){const a=kC(i,o,s,e,n),l=[t.shape[0],t.shape[1]];if(e){const c=n.makeTensorInfo(l,"float32",a.real),u=n.makeTensorInfo(l,"float32",a.imag),d=n.makeTensorInfo([],"float32",vl(s,"float32")),h=xo({inputs:{x:d},backend:n}),f=SC.kernelFunc({inputs:{a:c,b:d},backend:n}),p=SC.kernelFunc({inputs:{a:u,b:h},backend:n}),m=n.data.get(f.dataId).values,g=n.data.get(p.dataId).values;return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),{real:m,imag:g}}return a}else{const a=ra(i,o),l=Pge(a,s,e);return Gj(l)}}function Mge(t){return(t&t-1)===0}function kC(t,e,n,s,r){if(n===1)return{real:t,imag:e};const i=ra(t,e),o=n/2,a=Kj(i),l=a.real,c=a.imag,u=[l.length],d=r.makeTensorInfo(u,"float32",l),h=r.makeTensorInfo(u,"float32",c),f=Qs({inputs:{real:d,imag:h},backend:r}),p=qj(i),m=p.real,g=p.imag,y=[m.length],x=r.makeTensorInfo(y,"float32",m),v=r.makeTensorInfo(y,"float32",g),w=Qs({inputs:{real:x,imag:v},backend:r}),S=kC(l,c,o,s,r),k=S.real,C=S.imag,N=[k.length],T=r.makeTensorInfo(N,"float32",k),I=r.makeTensorInfo(N,"float32",C),D=Qs({inputs:{real:T,imag:I},backend:r}),F=kC(m,g,o,s,r),A=F.real,O=F.imag,P=[A.length],L=r.makeTensorInfo(P,"float32",A),G=r.makeTensorInfo(P,"float32",O),$=Qs({inputs:{real:L,imag:G},backend:r}),U=Jj(n,s),K=[U.real.length],j=r.makeTensorInfo(K,"float32",U.real),ee=r.makeTensorInfo(K,"float32",U.imag),Z=Qs({inputs:{real:j,imag:ee},backend:r}),re=Xv({inputs:{a:Z,b:$},backend:r}),te=Id({inputs:{a:D,b:re},backend:r}),le=b2({inputs:{a:D,b:re},backend:r}),pe=Lc({inputs:{input:te},backend:r}),we=Lc({inputs:{input:le},backend:r}),xe=Ad({inputs:{input:te},backend:r}),Ne=Ad({inputs:{input:le},backend:r}),Ae=$d({inputs:[pe,we],backend:r,attrs:{axis:0}}),Qe=$d({inputs:[xe,Ne],backend:r,attrs:{axis:0}}),Xe=r.data.get(Ae.dataId).values,ft=r.data.get(Qe.dataId).values;return r.disposeIntermediateTensorInfo(d),r.disposeIntermediateTensorInfo(h),r.disposeIntermediateTensorInfo(f),r.disposeIntermediateTensorInfo(x),r.disposeIntermediateTensorInfo(v),r.disposeIntermediateTensorInfo(w),r.disposeIntermediateTensorInfo(T),r.disposeIntermediateTensorInfo(I),r.disposeIntermediateTensorInfo(D),r.disposeIntermediateTensorInfo(L),r.disposeIntermediateTensorInfo(G),r.disposeIntermediateTensorInfo($),r.disposeIntermediateTensorInfo(j),r.disposeIntermediateTensorInfo(ee),r.disposeIntermediateTensorInfo(Z),r.disposeIntermediateTensorInfo(re),r.disposeIntermediateTensorInfo(te),r.disposeIntermediateTensorInfo(le),r.disposeIntermediateTensorInfo(pe),r.disposeIntermediateTensorInfo(xe),r.disposeIntermediateTensorInfo(we),r.disposeIntermediateTensorInfo(Ne),r.disposeIntermediateTensorInfo(Ae),r.disposeIntermediateTensorInfo(Qe),{real:Xe,imag:ft}}function Pge(t,e,n){const s=new Float32Array(e*2);for(let r=0;r<e;r++){let i=0,o=0;for(let a=0;a<e;a++){const l=Yj(r*a,e,n),c=_I(t,a);i+=c.real*l.real-c.imag*l.imag,o+=c.real*l.imag+c.imag*l.real}n&&(i/=e,o/=e),Xj(s,i,o,r)}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lge(t){const{inputs:e,backend:n}=t,{input:s}=e,r=Q(s.shape),i=s.shape[s.shape.length-1],o=r/i,a=kt({inputs:{x:s},backend:n,attrs:{shape:[o,i]}}),l=OW(a,!1,n),c=kt({inputs:{x:l},backend:n,attrs:{shape:s.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),c}const Fge={kernelName:hE,backendName:"cpu",kernelFunc:Lge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S2(t){const{backend:e,attrs:n}=t,{shape:s,value:r,dtype:i}=n,o=i||Gd(r),a=Zt(o,Q(s));return zge(a,r,o),e.makeTensorInfo(s,o,a)}const _ge={kernelName:fE,backendName:"cpu",kernelFunc:S2};function zge(t,e,n){t.fill(e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bge={kernelName:pE,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:s}=t,r=n,i=ns(s.dtype,Q(s.shape)),[o,a,l,c]=s.shape,u=r.data.get(s.dataId).values;for(let h=0;h<o;h++){const f=h*l*a*c;for(let p=0;p<a;p++){const m=p*(l*c);for(let g=0;g<l;g++){const y=g*c;for(let x=0;x<c;x++){const v=Math.round(l-g-1),w=f+m+y+x;let S=u[w];if(v>=0&&v<l){const k=v*c,C=f+m+k+x;S=u[C]}i[w]=S}}}}return{dataId:r.write(i,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jge(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:h,activation:f,leakyreluAlpha:p}=s;let m=RW({inputs:{x:r,filter:i},backend:n,attrs:{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:h}});if(o){const g=m;if(u==="NCHW"&&o.shape.length===1&&o.shape[0]!==1){const y=kt({inputs:{x:o},backend:n,attrs:{shape:[o.shape[0],1,1]}});m=Id({inputs:{a:m,b:y},backend:n}),n.disposeIntermediateTensorInfo(y)}else m=Id({inputs:{a:m,b:o},backend:n});n.disposeIntermediateTensorInfo(g)}if(f){const g=m;if(u==="NCHW"&&f==="prelu"&&a.shape.length===1&&a.shape[0]!==1){const y=kt({inputs:{x:a},backend:n,attrs:{shape:[a.shape[0],1,1]}});m=K0(n,m,f,y,p),n.disposeIntermediateTensorInfo(y)}else m=K0(n,m,f,a,p);n.disposeIntermediateTensorInfo(g)}return m}const Vge={kernelName:N0,backendName:"cpu",kernelFunc:jge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uge(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:h,activation:f,leakyreluAlpha:p}=s;let m=DW({inputs:{x:r,filter:i},backend:n,attrs:{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:h}});if(o){const g=m;m=Id({inputs:{a:m,b:o},backend:n}),n.disposeIntermediateTensorInfo(g)}if(f){const g=m;m=K0(n,m,f,a,p),n.disposeIntermediateTensorInfo(g)}return m}const Wge={kernelName:yB,backendName:"cpu",kernelFunc:Uge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hge(t){const{inputs:e,backend:n}=t,{params:s,indices:r}=e,i=Q(s.shape),o=r.shape,a=o[o.length-1],[l,c,u,d]=wI(s,r);if(c===0)return n.makeTensorInfo(l,s.dtype,[]);const h=n.data.get(r.dataId).values,f=n.bufferSync(s),p=UU(h,f,s.dtype,c,a,u,d,s.shape,i);return n.makeTensorInfo(l,s.dtype,p.values)}const Gge={kernelName:Zz,backendName:"cpu",kernelFunc:Hge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kge(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,indices:i}=e,{axis:o,batchDims:a}=s;be([r,i],"gatherV2");const l=Ge(o,r.shape)[0],c=n.data.get(i.dataId).values,u=r.shape[l];for(let w=0;w<c.length;++w){const S=c[w];E(S<=u-1&&S>=0,()=>`GatherV2: the index value ${S} is not in [0, ${u-1}]`)}let d=a;a==null&&(d=0);const h=Q(i.shape),f=HI(r,i,l,d),p=kt({inputs:{x:r},backend:n,attrs:{shape:[f.batchSize,f.outerSize,f.dimSize,f.sliceSize]}}),m=kt({inputs:{x:i},backend:n,attrs:{shape:[f.batchSize,h/f.batchSize]}}),g=[f.batchSize,f.outerSize,h/f.batchSize,f.sliceSize],y=n.bufferSync(m),x=n.bufferSync(p),v=WU(x,y,g);return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),n.makeTensorInfo(f.outputShape,v.dtype,v.values)}const qge={kernelName:Ub,backendName:"cpu",kernelFunc:Kge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xge(t){const{inputs:e,backend:n}=t,{input:s}=e,r=Q(s.shape),i=s.shape[s.shape.length-1],o=r/i,a=kt({inputs:{x:s},backend:n,attrs:{shape:[o,i]}}),l=OW(a,!0,n),c=kt({inputs:{x:l},backend:n,attrs:{shape:s.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),c}const Jge={kernelName:mE,backendName:"cpu",kernelFunc:Xge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yge=ht(tm,t=>Number.isFinite(t)?1:0,"bool"),Qge={kernelName:tm,backendName:"cpu",kernelFunc:Yge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zge=ht(nm,t=>Math.abs(t)===1/0?1:0,"bool"),eye={kernelName:nm,backendName:"cpu",kernelFunc:Zge};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tye=ht(sm,t=>Number.isNaN(t)?1:0,"bool"),nye={kernelName:sm,backendName:"cpu",kernelFunc:tye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sye(t){const{backend:e,attrs:n}=t,{start:s,stop:r,num:i}=n,o=XU(s,r,i);return e.makeTensorInfo([o.length],"float32",o)}const rye={kernelName:eB,backendName:"cpu",kernelFunc:sye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iye=ht(im,t=>Math.log1p(t)),oye={kernelName:im,backendName:"cpu",kernelFunc:iye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aye=rn((t,e)=>t&&e),lye=Nn(qb,aye,null,"bool"),cye={kernelName:qb,backendName:"cpu",kernelFunc:lye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uye=ht(Xb,t=>t?0:1,"bool"),dye={kernelName:Xb,backendName:"cpu",kernelFunc:uye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hye=rn((t,e)=>t||e),fye=Nn(Jb,hye,null,"bool"),pye={kernelName:Jb,backendName:"cpu",kernelFunc:fye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mye(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{depthRadius:i,bias:o,alpha:a,beta:l}=s;be(r,"LRN");const c=r.shape[3],u=c-1,d=n.data.get(r.dataId).values,h=Q(r.shape),f=new Float32Array(h);function p(m){const g=m%c;let y=m-g+Math.max(0,g-i);const x=m-g+Math.min(g+i,u);let v=0;for(;y<=x;y++){const w=d[y];v+=w*w}return v}for(let m=0;m<h;m++){const g=p(m),y=d[m]*Math.pow(o+a*g,-l);f[m]=y}return n.makeTensorInfo(r.shape,r.dtype,f)}const gye={kernelName:Yb,backendName:"cpu",kernelFunc:mye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yye(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,y:i,dy:o}=e,{depthRadius:a,bias:l,alpha:c,beta:u}=s;be(o,"LRNGrad");const d=Q(o.shape),h=o.shape[3],f=n.data.get(o.dataId).values,p=n.data.get(r.dataId).values,m=n.data.get(i.dataId).values,g=new Float32Array(d),y=d;for(let x=0;x<y;x++){const v=x%h,w=x-v+Math.max(0,v-a),S=x-v+Math.min(h,v+a+1);let k=0;for(let C=w;C<S;C++)k+=Math.pow(p[C],2);k=c*k+l;for(let C=w;C<S;C++){let N=-2*c*u*p[C]*m[x]/k;x===C&&(N+=Math.pow(k,-u)),N*=f[x],g[C]+=N}}return n.makeTensorInfo(o.shape,r.dtype,g)}const xye={kernelName:yE,backendName:"cpu",kernelFunc:yye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MW(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{reductionIndices:i,keepDims:o}=s,a=n;let l=r.shape;const c=l.length,u=Ge(i,l);let d=u;const h=Bt(d,c);let f=a.data.get(r.dataId).values;if(h!=null){const w=new Array(c);for(let S=0;S<w.length;S++)w[S]=l[h[S]];f=y2(f,l,r.dtype,h,w),d=nn(d.length,c),l=w}be(r,"max"),Hn("max",d,c);const[p,m]=Dn(l,d),g=Q(m),y=YU(f,g,p,r.dtype),x=a.write(y,p,r.dtype);let v=p;return o&&(v=cn(p,u)),{dataId:x,shape:v,dtype:r.dtype}}const bye={kernelName:Qb,backendName:"cpu",kernelFunc:MW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vye(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e;be(r,"maxPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,c=1;E(is(o,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);const u=ai(r.shape,i,o,c,a,l);let d;if(u.filterWidth===1&&u.filterHeight===1&&ct(u.inShape,u.outShape))d=xo({inputs:{x:r},backend:n});else{const h=n.data.get(r.dataId).values,f=ke(r.shape),p=v2(h,r.shape,r.dtype,f,u,"max");d=n.makeTensorInfo(u.outShape,r.dtype,p.values)}return d}const wye={kernelName:Zb,backendName:"cpu",kernelFunc:vye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sye(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:c}=s;be(r,"maxPool3d");const u=la(r.shape,i,o,1,a,l,c),d=n.data.get(r.dataId).values,h=$W(d,r.shape,r.dtype,ke(r.shape),u,"max");return n.makeTensorInfo(h.shape,"float32",h.values)}const kye={kernelName:ev,backendName:"cpu",kernelFunc:Sye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cye(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:i}=e,{filterSize:o,strides:a,pad:l,dimRoundingMode:c}=s;be([r,i],"maxPool3DGrad");const u=la(i.shape,o,a,1,l,c),d=n.bufferSync(i),h=hme(d,u),f=u.strideDepth,p=u.strideHeight,m=u.strideWidth,g=u.dilationDepth,y=u.dilationHeight,x=u.dilationWidth,v=u.effectiveFilterDepth,w=u.effectiveFilterHeight,S=u.effectiveFilterWidth,k=v-1-u.padInfo.front,C=S-1-u.padInfo.left,N=w-1-u.padInfo.top,T=He(i.shape,"float32"),I=n.bufferSync(r);for(let D=0;D<u.batchSize;++D)for(let F=0;F<u.inChannels;++F)for(let A=0;A<u.inDepth;++A)for(let O=0;O<u.inHeight;++O)for(let P=0;P<u.inWidth;++P){const L=A-k,G=O-N,$=P-C;let U=0;for(let K=0;K<v;K+=g){const j=(L+K)/f;if(!(j<0||j>=u.outDepth||Math.floor(j)!==j))for(let ee=0;ee<w;ee+=y){const Z=(G+ee)/p;if(!(Z<0||Z>=u.outHeight||Math.floor(Z)!==Z))for(let re=0;re<S;re+=x){const te=($+re)/m;if(te<0||te>=u.outWidth||Math.floor(te)!==te)continue;const le=v*w*S-1-h.get(D,j,Z,te,F),pe=K*w*S+ee*S+re,we=le===pe?1:0;if(we===0)continue;const xe=I.get(D,j,Z,te,F);U+=xe*we}}}T.set(U,D,A,O,P,F)}return n.makeTensorInfo(T.shape,T.dtype,T.values)}const Nye={kernelName:bE,backendName:"cpu",kernelFunc:Cye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tye(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:i,output:o}=e,a=i;be([i,o],"maxPoolGrad");const{filterSize:l,strides:c,pad:u,dimRoundingMode:d}=s,h=ai(a.shape,l,c,1,u,d),f=n.data.get(a.dataId).values,p=He(h.outShape,a.dtype,AW(f,a.shape,a.dtype,h).values),m=h.strideHeight,g=h.strideWidth,y=h.dilationHeight,x=h.dilationWidth,v=h.effectiveFilterHeight,w=h.effectiveFilterWidth,S=w-1-h.padInfo.left,k=v-1-h.padInfo.top,C=He(a.shape,"float32"),N=n.data.get(r.dataId).values,T=He(r.shape,"float32",N);for(let I=0;I<h.batchSize;++I)for(let D=0;D<h.inChannels;++D)for(let F=0;F<h.inHeight;++F)for(let A=0;A<h.inWidth;++A){const O=F-k,P=A-S;let L=0;for(let G=0;G<v;G+=y){const $=(O+G)/m;if(!($<0||$>=h.outHeight||Math.floor($)!==$))for(let U=0;U<w;U+=x){const K=(P+U)/g;if(K<0||K>=h.outWidth||Math.floor(K)!==K)continue;const j=v*w-1-p.get(I,$,K,D),ee=G*w+U,Z=j===ee?1:0;if(Z===0)continue;const re=T.get(I,$,K,D);L+=re*Z}}C.set(L,I,F,A,D)}return n.makeTensorInfo(C.shape,C.dtype,C.values)}const Eye={kernelName:xE,backendName:"cpu",kernelFunc:Tye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Iye(t,e,n,s,r){const i=ke(e),o=v2(t,e,n,i,r,"max"),a=AW(t,e,n,r,!0,s);return[o.values,a.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Aye={kernelName:tB,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:s}=t,{filterSize:r,strides:i,pad:o,includeBatchInIndex:a}=e,l=n;be(s,"MaxPoolWithArgmax");const c=l.data.get(s.dataId).values,u=ai(s.shape,r,i,[1,1],o),[d,h]=Iye(c,s.shape,s.dtype,a,u),f=l.write(d,u.outShape,s.dtype),p=l.write(h,u.outShape,s.dtype);return[{dataId:f,shape:u.outShape,dtype:s.dtype},{dataId:p,shape:u.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $ye(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s,a=Ge(i,r.shape),c=Dn(r.shape,a)[1],u=Q(c),d=[],h=n.makeTensorInfo([],"float32",new Float32Array([u]));d.push(h);const f=dl({inputs:{x:r},backend:n,attrs:{dtype:"float32"}});d.push(f);const p=w2({inputs:{a:f,b:h},backend:n});d.push(p);const m=Hm({inputs:{x:p},backend:n,attrs:{axis:i,keepDims:o}});return d.forEach(g=>n.disposeIntermediateTensorInfo(g)),m}const Rye={kernelName:tv,backendName:"cpu",kernelFunc:$ye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dye(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s;be(r,"min");const a=Ge(i,r.shape);let l=a;const c=Bt(l,r.shape.length);let u=r;c!=null&&(u=zs({inputs:{x:r},backend:n,attrs:{perm:c}}),l=nn(l.length,r.shape.length)),Hn("min",l,u.shape.length);const[d,h]=Dn(u.shape,l),f=Q(h),p=ss(Q(d),u.dtype),m=n.data.get(u.dataId).values;for(let y=0;y<p.length;++y){const x=y*f;let v=m[x];for(let w=0;w<f;++w){const S=m[x+w];(Number.isNaN(S)||S<v)&&(v=S)}p[y]=v}c!=null&&n.disposeIntermediateTensorInfo(u);const g=n.makeTensorInfo(d,u.dtype,p);if(o){const y=cn(d,a),x=kt({inputs:{x:g},backend:n,attrs:{shape:y}});return n.disposeIntermediateTensorInfo(g),x}return g}const Oye={kernelName:nv,backendName:"cpu",kernelFunc:Dye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mye(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{paddings:i,mode:o}=s;be(r,"mirrorPad");const a=i.map((v,w)=>v[0]+r.shape[w]+v[1]),l=i.map(v=>v[0]),c=i.map((v,w)=>v[0]+r.shape[w]),u=o==="reflect"?0:1,d=n.data.get(r.dataId).values,h=r.shape.length,f=ke(r.shape),p=Q(a),m=a.length,g=ke(a),y=ns(r.dtype,p);for(let v=0;v<p;v++){let w=Kd(v,m,g);for(let k=0;k<m;k++)w[k]<l[k]?w[k]=l[k]*2-w[k]-u:w[k]>=c[k]&&(w[k]=(c[k]-1)*2-w[k]+u);w=w.map((k,C)=>k-l[C]);const S=oo(w,h,f);y[v]=d[S]}return{dataId:n.write(y,a,r.dtype),shape:a,dtype:r.dtype}}const Pye={kernelName:sv,backendName:"cpu",kernelFunc:Mye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lye=rn((t,e)=>{const n=t%e;return t<0&&e<0||t>=0&&e>=0?n:(n+e)%e}),Fye=Nn(lm,Lye),_ye={kernelName:lm,backendName:"cpu",kernelFunc:Fye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PW(t){const{inputs:e,backend:n,attrs:s}=t,{logits:r}=e,{dim:i}=s,o=r.shape.length;let a=i;if(a===-1&&(a=o-1),a!==o-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${o} and dim was ${a}`);const l=Ge([a],r.shape),c=MW({inputs:{x:r},backend:n,attrs:{reductionIndices:l,keepDims:!1}}),u=cn(c.shape,l),d=kt({inputs:{x:c},backend:n,attrs:{shape:u}}),h=b2({inputs:{a:r,b:d},backend:n}),f=zU({inputs:{x:h},backend:n}),p=Hm({inputs:{x:f},backend:n,attrs:{axis:l,keepDims:!1}}),m=kt({inputs:{x:p},backend:n,attrs:{shape:u}}),g=w2({inputs:{a:f,b:m},backend:n});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),g}const zye={kernelName:wv,backendName:"cpu",kernelFunc:PW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bye(t){const{inputs:e,backend:n,attrs:s}=t,{logits:r}=e,{numSamples:i,seed:o,normalized:a}=s;be(r,"multinomial");const l=a?r:PW({inputs:{logits:r},backend:n,attrs:{dim:-1}}),c=l.shape[0],u=l.shape[1],d=n.data.get(l.dataId).values,h=[c,i],f=ss(Q(h),"int32");for(let p=0;p<c;++p){const m=p*u,g=new Float32Array(u-1);g[0]=d[m];for(let v=1;v<g.length;++v)g[v]=g[v-1]+d[m+v];const y=oI.alea(o.toString()),x=p*i;for(let v=0;v<i;++v){const w=y();f[x+v]=g.length;for(let S=0;S<g.length;S++)if(w<g[S]){f[x+v]=S;break}}}return a||n.disposeIntermediateTensorInfo(l),n.makeTensorInfo(h,"int32",f)}const jye={kernelName:nB,backendName:"cpu",kernelFunc:Bye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vye=mI;function Uye(t){const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l}=s;be(r,"NonMaxSuppression");const c=n.data.get(r.dataId).values,u=n.data.get(i.dataId).values,{selectedIndices:d}=Vye(c,u,o,a,l);return n.makeTensorInfo([d.length],"int32",new Int32Array(d))}const Wye={kernelName:vE,backendName:"cpu",kernelFunc:Uye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hye=gI;function Gye(t){const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:c}=s;be(r,"NonMaxSuppressionPadded");const u=n.data.get(r.dataId).values,d=n.data.get(i.dataId).values,{selectedIndices:h,validOutputs:f}=Hye(u,d,o,a,l,c);return[n.makeTensorInfo([h.length],"int32",new Int32Array(h)),n.makeTensorInfo([],"int32",new Int32Array([f]))]}const Kye={kernelName:wE,backendName:"cpu",kernelFunc:Gye};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qye=yI;function Xye(t){const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,softNmsSigma:c}=s;be(r,"NonMaxSuppressionWithScore");const u=n.data.get(r.dataId).values,d=n.data.get(i.dataId).values,h=o,f=a,p=l,m=c,{selectedIndices:g,selectedScores:y}=qye(u,d,h,f,p,m);return[n.makeTensorInfo([g.length],"int32",new Int32Array(g)),n.makeTensorInfo([y.length],"float32",new Float32Array(y))]}const Jye={kernelName:SE,backendName:"cpu",kernelFunc:Xye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yye(t){const{inputs:e,backend:n,attrs:s}=t,{indices:r}=e,{dtype:i,depth:o,onValue:a,offValue:l}=s;be(r,"oneHot");const c=Q(r.shape),u=new Float32Array(c*o);u.fill(l);const d=n.data.get(r.dataId).values;for(let h=0;h<c;++h)d[h]>=0&&d[h]<o&&(u[h*o+d[h]]=a);return n.makeTensorInfo([...r.shape,o],i,u)}const Qye={kernelName:av,backendName:"cpu",kernelFunc:Yye};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X0(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(s.dtype==="complex64"){const r=Lc({inputs:{input:s},backend:n}),i=X0({inputs:{x:r},backend:n}),o=Ad({inputs:{input:s},backend:n}),a=X0({inputs:{x:o},backend:n}),l=Qs({inputs:{real:i,imag:a},backend:n});return n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),l}else return S2({backend:n,attrs:{shape:s.shape,value:0,dtype:s.dtype}})}const Zye={kernelName:Cv,backendName:"cpu",kernelFunc:X0};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LW(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(s.dtype==="complex64"){const r=Lc({inputs:{input:s},backend:n}),i=LW({inputs:{x:r},backend:n}),o=Ad({inputs:{input:s},backend:n}),a=X0({inputs:{x:o},backend:n}),l=Qs({inputs:{real:i,imag:a},backend:n});return n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),l}else return S2({backend:n,attrs:{shape:s.shape,value:1,dtype:s.dtype}})}const e0e={kernelName:ov,backendName:"cpu",kernelFunc:LW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FW(t){const{inputs:e,backend:n,attrs:s}=t,{axis:r}=s;if(e.length===1)return q0({inputs:{input:e[0]},backend:n,attrs:{dim:r}});const i=e[0].shape,o=e[0].dtype;e.forEach(u=>{UT(i,u.shape,"All tensors passed to stack must have matching shapes"),E(o===u.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(u=>{const d=q0({inputs:{input:u},backend:n,attrs:{dim:r}});return a.push(d),d}),c=$d({inputs:l,backend:n,attrs:{axis:r}});return a.forEach(u=>n.disposeIntermediateTensorInfo(u)),c}const t0e={kernelName:lv,backendName:"cpu",kernelFunc:FW};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n0e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{paddings:i,constantValue:o}=s;be(r,"pad");const a=i.map((x,v)=>x[0]+r.shape[v]+x[1]),l=i.map(x=>x[0]),c=n.data.get(r.dataId).values,u=Q(r.shape),d=r.shape.length,h=ke(r.shape),f=Q(a),p=a.length,m=ke(a),g=ns(r.dtype,f);o!==0&&g.fill(o);for(let x=0;x<u;x++){const w=Kd(x,d,h).map((k,C)=>k+l[C]),S=oo(w,p,m);g[S]=c[x]}return{dataId:n.write(g,a,r.dtype),shape:a,dtype:r.dtype}}const _W={kernelName:cv,backendName:"cpu",kernelFunc:n0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s0e=rn((t,e)=>Math.pow(t,e)),r0e=Nn(um,s0e),i0e={kernelName:um,backendName:"cpu",kernelFunc:r0e};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o0e(t){const{inputs:e,backend:n,attrs:s}=t,{paramsNestedSplits:r,paramsDenseValues:i,indices:o}=e,a=r.map(g=>n.data.get(g.dataId).values),l=r.map(g=>g.shape),c=n.data.get(i.dataId).values,u=n.data.get(o.dataId).values,[d,h,f]=sW(a,l,c,i.shape,i.dtype,u,o.shape),p=d.map(g=>n.makeTensorInfo([g.length],"int32",g)),m=n.makeTensorInfo(f,i.dtype,h);return p.concat([m])}const a0e={kernelName:sB,backendName:"cpu",kernelFunc:o0e};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l0e(t){const{inputs:e,backend:n}=t,{starts:s,limits:r,deltas:i}=e,o=n.data.get(s.dataId).values,a=n.data.get(r.dataId).values,l=n.data.get(i.dataId).values,[c,u]=rW(o,s.shape,s.dtype,a,r.shape,l,i.shape),d=n.makeTensorInfo([c.length],"int32",c),h=n.makeTensorInfo([u.length],s.dtype,u);return[d,h]}const c0e={kernelName:rB,backendName:"cpu",kernelFunc:l0e};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u0e(t){const{inputs:e,backend:n,attrs:s}=t,{shape:r,values:i,defaultValue:o,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=s,c=n.data.get(r.dataId).values,u=n.data.get(i.dataId).values,d=n.data.get(o.dataId).values,h=a.map(g=>n.data.get(g.dataId).values),f=a.map(g=>g.shape),[p,m]=iW(c,r.shape,u,i.shape,i.dtype,d,o.shape,h,f,l);return n.makeTensorInfo(p,i.dtype,m)}const d0e={kernelName:iB,backendName:"cpu",kernelFunc:u0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h0e(t){const{backend:e,attrs:n}=t,{start:s,stop:r,dtype:i,step:o}=n,a=oW(s,r,o,i);return e.makeTensorInfo([a.length],i,a)}const f0e={kernelName:kE,backendName:"cpu",kernelFunc:h0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p0e=ht(dm,t=>1/t),m0e={kernelName:dm,backendName:"cpu",kernelFunc:p0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g0e(t){const{inputs:e,backend:n,attrs:s}=t,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s;be(r,"resizeBilinear");const l=ke(r.shape),[c,u]=a,[d,h,f,p]=r.shape,m=n.data.get(r.dataId).values,g=new Float32Array(Q([d,c,u,p])),y=[i&&c>1?h-1:h,i&&u>1?f-1:f],x=[i&&c>1?c-1:c,i&&u>1?u-1:u];let v=0;const w=y[0]/x[0],S=y[1]/x[1];for(let k=0;k<d;k++)for(let C=0;C<c;C++){let N;o?N=w*(C+.5)-.5:N=w*C;const T=Math.max(0,Math.floor(N)),I=N-T,D=Math.min(h-1,Math.ceil(N)),F=k*l[0]+T*l[1],A=k*l[0]+D*l[1];for(let O=0;O<u;O++){let P;o?P=S*(O+.5)-.5:P=S*O;const L=Math.max(0,Math.floor(P)),G=P-L,$=Math.min(f-1,Math.ceil(P)),U=F+L*l[2],K=A+L*l[2],j=F+$*l[2],ee=A+$*l[2];for(let Z=0;Z<p;Z++){const re=m[U+Z],te=m[K+Z],le=m[j+Z],pe=m[ee+Z],we=re+(le-re)*G,xe=te+(pe-te)*G,Ne=we+(xe-we)*I;g[v++]=Ne}}}return n.makeTensorInfo([d,c,u,p],"float32",g)}const y0e={kernelName:pv,backendName:"cpu",kernelFunc:g0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x0e(t){const{inputs:e,backend:n,attrs:s}=t,{images:r,dy:i}=e,{alignCorners:o}=s;be([i,r],"resizeBilinearGrad");const a=ke(r.shape),[l,c,u,d]=r.shape,[,h,f]=i.shape,p=new Float32Array(l*c*u*d),m=[o&&h>1?c-1:c,o&&f>1?u-1:u],g=[o&&h>1?h-1:h,o&&f>1?f-1:f],y=m[0]/g[0],x=m[1]/g[1],v=n.data.get(i.dataId).values;let w=0;for(let S=0;S<l;S++){const k=S*a[0];for(let C=0;C<h;C++){const N=C*y,T=Math.floor(N),I=Math.min(Math.ceil(N),c-1),D=k+T*a[1],F=k+I*a[1],A=N-T,O=1-A;for(let P=0;P<f;P++){const L=P*x,G=Math.floor(L),$=Math.min(Math.ceil(L),u-1),U=L-G,K=1-U,j=D+G*a[2],ee=D+$*a[2],Z=F+G*a[2],re=F+$*a[2],te=O*K,le=O*U,pe=A*K,we=A*U;for(let xe=0;xe<d;xe++){const Ne=v[w++];p[j+xe]+=Ne*te,p[ee+xe]+=Ne*le,p[Z+xe]+=Ne*pe,p[re+xe]+=Ne*we}}}}return n.makeTensorInfo([l,u,c,d],"float32",p)}const b0e={kernelName:TE,backendName:"cpu",kernelFunc:x0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v0e(t){const{inputs:e,backend:n,attrs:s}=t,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s;be(r,"resizeNearestNeighbor");const l=ke(r.shape),[c,u]=a,[d,h,f,p]=r.shape,m=n.data.get(r.dataId).values,g=new Float32Array(d*c*u*p),y=[i&&c>1?h-1:h,i&&u>1?f-1:f],x=[i&&c>1?c-1:c,i&&u>1?u-1:u],v=y[0]/x[0],w=y[1]/x[1];let S=0;for(let k=0;k<d;k++){const C=k*l[0];for(let N=0;N<c;N++){const T=o?v*(N+.5):v*N;let I=Math.min(h-1,i?Math.round(T):Math.floor(T));o&&(I=Math.max(0,I));const D=C+I*l[1];for(let F=0;F<u;F++){const A=o?w*(F+.5):w*F;let O=Math.min(f-1,i?Math.round(A):Math.floor(A));o&&(O=Math.max(0,O));const P=D+O*l[2];for(let L=0;L<p;L++){const G=m[P+L];g[S++]=G}}}}return n.makeTensorInfo([d,c,u,p],r.dtype,g)}const w0e={kernelName:fv,backendName:"cpu",kernelFunc:v0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S0e(t){const{inputs:e,backend:n,attrs:s}=t,{images:r,dy:i}=e,{alignCorners:o}=s;be([i,r],"resizeNearestNeighborGrad");const a=ke(r.shape),l=ke(i.shape),[c,u,d,h]=r.shape,[,f,p]=i.shape,m=new Float32Array(c*u*d*h),g=n.data.get(i.dataId).values,y=[o&&f>1?u-1:u,o&&p>1?d-1:d],x=[o&&f>1?f-1:f,o&&p>1?p-1:p],v=y[0]/x[0],w=y[1]/x[1],S=1/v,k=1/w,C=Math.ceil(S)*2+2,N=Math.ceil(k)*2+2;for(let T=0;T<c;T++){const I=T*a[0];for(let D=0;D<u;D++){const F=I+D*a[1],A=Math.floor(D*S),O=Math.floor(A-C/2);for(let P=0;P<d;P++){const L=F+P*a[2],G=Math.floor(P*k),$=Math.floor(G-N/2);for(let U=0;U<h;U++){let K=0;for(let j=0;j<C;j++){const ee=j+O;if(ee<0||ee>=f)continue;const Z=I+ee*l[1],re=ee*v,te=Math.min(u-1,o?Math.round(re):Math.floor(re));if(D===te)for(let le=0;le<N;le++){const pe=le+$;if(pe<0||pe>=p)continue;const we=Z+pe*l[2],xe=pe*w,Ne=Math.min(d-1,o?Math.round(xe):Math.floor(xe));P===Ne&&(K+=g[we+U])}}m[L+U]=K}}}}return n.makeTensorInfo(r.shape,r.dtype,m)}const k0e={kernelName:NE,backendName:"cpu",kernelFunc:S0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C0e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{dims:i}=s;be(r,"reverse");const o=r.shape.length,a=Ge(i,r.shape);if(o===0)return xo({inputs:{x:r},backend:n});const l=new jn(r.shape,r.dtype),c=n.bufferSync(r);for(let u=0;u<l.size;u++){const d=l.indexToLoc(u),h=d.slice();a.forEach(f=>h[f]=r.shape[f]-1-h[f]),l.set(c.get(...h),...d)}return n.makeTensorInfo(l.shape,l.dtype,l.values)}const N0e={kernelName:mv,backendName:"cpu",kernelFunc:C0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T0e={kernelName:OE,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:s}=t,{radians:r,fillValue:i,center:o}=e,a=n,l=ns(s.dtype,Q(s.shape)),[c,u,d,h]=s.shape,[f,p]=AI(o,u,d),m=255,g=Math.sin(r),y=Math.cos(r),x=a.data.get(s.dataId).values;for(let w=0;w<c;w++){const S=w*d*u*h;for(let k=0;k<u;k++){const C=k*(d*h);for(let N=0;N<d;N++){const T=N*h;for(let I=0;I<h;I++){const D=[c,k,N,I],F=D[2],A=D[1];let O=(F-f)*y-(A-p)*g,P=(F-f)*g+(A-p)*y;O=Math.round(O+f),P=Math.round(P+p);let L=i;if(typeof i!="number"&&(I===3?L=m:L=i[I]),O>=0&&O<d&&P>=0&&P<u){const $=P*(d*h),U=O*h,K=S+$+U+I;L=x[K]}const G=S+C+T+I;l[G]=L}}}}return{dataId:a.write(l,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E0e=ht(pm,t=>{const e=Math.floor(t);return t-e<.5?Math.floor(t):t-e>.5?Math.ceil(t):e%2===0?e:e+1}),I0e={kernelName:pm,backendName:"cpu",kernelFunc:E0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A0e(t){const{inputs:e,backend:n,attrs:s}=t,{indices:r,updates:i}=e,{shape:o}=s,{sliceRank:a,numUpdates:l,sliceSize:c,strides:u,outputSize:d}=eu(i,r,o),h=!0,f=n.bufferSync(r),p=n.bufferSync(i),m=nc(f,p,o,d,c,l,a,u,0,h);return n.makeTensorInfo(o,m.dtype,m.values)}const $0e={kernelName:oB,backendName:"cpu",kernelFunc:A0e};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R0e(t,e){let n=0,s=t.length,r=0;for(;n<s;)r=Math.floor((n+s)/2),t[r]<e?n=r+1:s=r;return s}function D0e(t,e){let n=0,s=t.length,r=0;for(;n<s;)r=Math.floor((n+s)/2),t[r]<=e?n=r+1:s=r;return s}function O0e(t,e,n,s,r,i){const o=Zt("int32",n*r);for(let a=0;a<n;++a){const l=t.slice(a*s,(a+1)*s),c=a*r;for(let u=0;u<r;++u)o[c+u]=i==="left"?R0e(l,e[u+c]):D0e(l,e[u+c])}return o}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M0e(t){const{inputs:e,backend:n,attrs:s}=t,{sortedSequence:r,values:i}=e,{side:o}=s,a=n.data.get(r.dataId).values,l=n.data.get(i.dataId).values,c=O0e(a,l,r.shape[0],r.shape[1],i.shape[1],o);return n.makeTensorInfo(i.shape,"int32",c)}const P0e={kernelName:lB,backendName:"cpu",kernelFunc:M0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L0e(t){const{inputs:e,backend:n}=t,{condition:s,t:r,e:i}=e;be([s,r,i],"select");const o=s.shape.length,a=n.data.get(s.dataId).values,l=n.data.get(r.dataId).values,c=n.data.get(i.dataId).values,u=lr(r.dtype,i.dtype),d=ss(Q(r.shape),u);let h=0;const f=o===0||o>1||r.shape.length===1?1:Q(r.shape.slice(1));for(let p=0;p<a.length;p++)for(let m=0;m<f;m++)a[p]===1?d[h++]=l[p]:d[h++]=c[p];return n.makeTensorInfo(r.shape,u,d)}const F0e={kernelName:gv,backendName:"cpu",kernelFunc:L0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _0e=Lv,z0e=Fv,B0e=ht(gm,t=>t>=0?z0e*t:_0e*(Math.exp(t)-1)),j0e={kernelName:gm,backendName:"cpu",kernelFunc:B0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V0e=ht(bm,t=>t<0?-1:t>0?1:0),U0e={kernelName:bm,backendName:"cpu",kernelFunc:V0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W0e=ht(ym,t=>Math.sin(t)),H0e={kernelName:ym,backendName:"cpu",kernelFunc:W0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G0e=ht(xm,t=>Math.sinh(t)),K0e={kernelName:xm,backendName:"cpu",kernelFunc:G0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const q0e=11920928955078125e-23,JO=Math.log(q0e)+2,X0e=ht(wm,t=>{const e=t>-JO,n=t<JO,s=Math.exp(t);let r;return n?r=s:e?r=t:r=Math.log(1+s),r}),J0e={kernelName:wm,backendName:"cpu",kernelFunc:X0e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y0e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockShape:i,paddings:o}=s;be([r],"spaceToBatchND");const a=Q(i),l=[[0,0]];l.push(...o);for(let k=1+i.length;k<r.shape.length;++k)l.push([0,0]);const c=_W.kernelFunc({inputs:{x:r},backend:n,attrs:{paddings:l,constantValue:0}}),u=Mm(c.shape,i,a,!1),d=Pm(u.length,i.length,!1),h=Lm(c.shape,i,a,!1),m=kt({inputs:{x:c},backend:n,attrs:{shape:u}}),x=zs({inputs:{x:m},backend:n,attrs:{perm:d}}),S=kt({inputs:{x},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(x),S}const Q0e={kernelName:bv,backendName:"cpu",kernelFunc:Y0e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z0e(t){const{inputs:e,backend:n}=t,{indices:s,values:r,denseShape:i,defaultValue:o}=e;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${i.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${r.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=n.data.get(s.dataId).values,l=n.data.get(r.dataId).values,c=n.data.get(i.dataId).values,u=n.data.get(o.dataId).values[0],[d,h,f,p,m]=uW(a,s.shape,s.dtype,l,r.dtype,c,u);return[n.makeTensorInfo(h,s.dtype,d),n.makeTensorInfo([h[0]],r.dtype,f),n.makeTensorInfo([p.length],"bool",new Uint8Array(p.map(g=>Number(g)))),n.makeTensorInfo([m.length],s.dtype,new Int32Array(m))]}const exe={kernelName:cB,backendName:"cpu",kernelFunc:Z0e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function txe(t){const{inputs:e,backend:n}=t,{inputIndices:s,inputShape:r,newShape:i}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${r.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);const o=Array.from(n.data.get(r.dataId).values),a=n.data.get(s.dataId).values,l=Array.from(n.data.get(i.dataId).values),[c,u,d]=dW(a,s.shape,s.dtype,o,l);return[n.makeTensorInfo(u,s.dtype,c),n.makeTensorInfo([d.length],i.dtype,new Int32Array(d))]}const nxe={kernelName:uB,backendName:"cpu",kernelFunc:txe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sxe(t){const{inputs:e,backend:n}=t,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${i.shape}`);if(r.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const o=n.data.get(s.dataId).values,a=n.data.get(r.dataId).values,l=n.data.get(i.dataId).values,[c,u]=x2(o,s.shape,s.dtype,a,l,!0);return n.makeTensorInfo(u,s.dtype,c)}const rxe={kernelName:dB,backendName:"cpu",kernelFunc:sxe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ixe(t){const{inputs:e,backend:n}=t,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${i.shape}`);if(r.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");const o=n.data.get(s.dataId).values,a=n.data.get(r.dataId).values,l=n.data.get(i.dataId).values,[c,u]=x2(o,s.shape,s.dtype,a,l);return n.makeTensorInfo(u,s.dtype,c)}const oxe={kernelName:hB,backendName:"cpu",kernelFunc:ixe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function axe(t){const{inputs:e,backend:n,attrs:s}=t,{sparseIndices:r,sparseValues:i,defaultValue:o}=e,{outputShape:a}=s,{sliceRank:l,numUpdates:c,sliceSize:u,strides:d,outputSize:h}=eu(i,r,a),f=!1,p=n.bufferSync(r);let m;switch(i.dtype){case"bool":{const g=n.bufferSync(i),y=!!n.data.get(o.dataId).values[0];m=nc(p,g,a,h,u,c,l,d,y,f);break}case"float32":{const g=n.bufferSync(i),y=n.data.get(o.dataId).values[0];m=nc(p,g,a,h,u,c,l,d,y,f);break}case"int32":{const g=n.bufferSync(i),y=n.data.get(o.dataId).values[0];m=nc(p,g,a,h,u,c,l,d,y,f);break}case"string":{const g=n.bufferSync(i),y=ol(n.data.get(o.dataId).values[0]);m=nc(p,g,a,h,u,c,l,d,y,f);break}default:throw new Error(`Unsupported type ${i.dtype}`)}return n.makeTensorInfo(a,m.dtype,m.values)}const lxe={kernelName:fB,backendName:"cpu",kernelFunc:axe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cxe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{numOrSizeSplits:i,axis:o}=s,a=Ge(o,r.shape)[0],l=WI(r,i,a),c=new Array(r.shape.length).fill(0),u=r.shape.slice();return l.map(d=>{const h=[...u];h[a]=d;const f=Fc({inputs:{x:r},backend:n,attrs:{begin:c,size:h}});return c[a]+=d,f})}const uxe={kernelName:vv,backendName:"cpu",kernelFunc:cxe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dxe={kernelName:EE,backendName:"cpu",kernelFunc:({inputs:t,backend:e})=>{const{x:n}=t,s=e;be(n,"square");const r=s.data.get(n.dataId).values,i=new Float32Array(r.length);for(let a=0;a<r.length;++a){const l=r[a];i[a]=l*l}return{dataId:s.write(i,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hxe=ht(Im,(t,e)=>{const n=e;return isNaN(t)?NaN:t>0?1:n.alpha}),fxe={kernelName:Im,backendName:"cpu",kernelFunc:hxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pxe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{begin:i,end:o,strides:a,beginMask:l,endMask:c,ellipsisMask:u,newAxisMask:d,shrinkAxisMask:h}=s;be(r,"stridedSlice");const{finalShapeSparse:f,finalShape:p,isIdentity:m,sliceDim0:g,isSimpleSlice:y,begin:x,end:v,strides:w}=TI(r.shape,i,o,a,l,c,u,d,h);let S;if(m)S=kt({inputs:{x:r},backend:n,attrs:{shape:p}});else if(g||y){E(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const k=kI(x,v,w),C=Fc({inputs:{x:r},backend:n,attrs:{begin:x,size:k}});S=kt({inputs:{x:C},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo(C)}else{const k=n.bufferSync(r),C=pW(f,k,w,x);S=n.makeTensorInfo(p,C.dtype,C.values)}return S}const mxe={kernelName:AE,backendName:"cpu",kernelFunc:pxe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gxe(t){const{inputs:e,backend:n,attrs:s}=t,{separator:r,nGramWidths:i,leftPad:o,rightPad:a,padWidth:l,preserveShortSequences:c}=s,{data:u,dataSplits:d}=e,h=n.data.get(u.dataId).values,f=n.data.get(d.dataId).values,[p,m]=mW(h,f,r,i,o,a,l,c);return[n.makeTensorInfo([p.length],"string",p),n.makeTensorInfo(d.shape,"int32",m)]}const yxe={kernelName:pB,backendName:"cpu",kernelFunc:gxe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xxe(t){const{inputs:e,backend:n,attrs:s}=t,{skipEmpty:r}=s,{input:i,delimiter:o}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=n.data.get(i.dataId).values,l=n.data.get(o.dataId).values[0],[c,u,d]=gW(a,l,r),h=u.length;return[n.makeTensorInfo([h,2],"int32",c),n.makeTensorInfo([h],"string",u),n.makeTensorInfo([2],"int32",new Int32Array(d))]}const bxe={kernelName:mB,backendName:"cpu",kernelFunc:xxe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vxe(t){const{inputs:e,backend:n,attrs:s}=t,{numBuckets:r}=s,{input:i}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const o=n.data.get(i.dataId).values,a=yW(o,r);return n.makeTensorInfo(i.shape,"int32",a)}const wxe={kernelName:gB,backendName:"cpu",kernelFunc:vxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sxe=ht(Nm,t=>Math.tan(t)),kxe={kernelName:Nm,backendName:"cpu",kernelFunc:Sxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cxe=ht(Tm,t=>Math.tanh(t)),Nxe={kernelName:Tm,backendName:"cpu",kernelFunc:Cxe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Txe(t){const{inputs:e,backend:n}=t,{tensor:s,indices:r,updates:i}=e,{sliceRank:o,numUpdates:a,sliceSize:l,strides:c,outputSize:u}=eu(i,r,s.shape),d=!1,h=n.bufferSync(r),f=n.bufferSync(i),p=n.bufferSync(s),m=nc(h,f,s.shape,u,l,a,o,c,p,d);return n.makeTensorInfo(s.shape,m.dtype,m.values)}const Exe={kernelName:aB,backendName:"cpu",kernelFunc:Txe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ixe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{reps:i}=s;be(r,"tile");const o=bW(n.bufferSync(r),i);return n.makeTensorInfo(o.shape,o.dtype,o.values)}const Axe={kernelName:Em,backendName:"cpu",kernelFunc:Ixe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $xe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{k:i,sorted:o}=s;be(r,"topk");const a=n.data.get(r.dataId).values,[l,c]=wW(a,r.shape,r.dtype,i,o);return[n.makeTensorInfo(l.shape,l.dtype,l.values),n.makeTensorInfo(c.shape,c.dtype,c.values)]}const Rxe={kernelName:$E,backendName:"cpu",kernelFunc:$xe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dxe(t){const{inputs:e,attrs:n,backend:s}=t,{image:r,transforms:i}=e,{interpolation:o,fillMode:a,fillValue:l,outputShape:c}=n,[u,d,h,f]=r.shape,[p,m]=c??[d,h],g=[u,p,m,f],y=ke(r.shape),x=y[0],v=y[1],w=y[2],S=ke(g),k=S[0],C=S[1],N=S[2],T=ns(r.dtype,Q(g));T.fill(l);const I=s.data.get(r.dataId).values,D=s.data.get(i.dataId).values;for(let A=0;A<u;++A){const O=i.shape[0]===1?D:D.subarray(A*8,A*8+8);for(let P=0;P<p;++P)for(let L=0;L<m;++L)for(let G=0;G<f;++G){let $;const U=O[6]*L+O[7]*P+1;if(U===0)continue;const K=(O[0]*L+O[1]*P+O[2])/U,j=(O[3]*L+O[4]*P+O[5])/U,ee=YO(K,h,a),Z=YO(j,d,a);switch(o){case"nearest":$=_xe(I,d,h,x,v,w,A,Z,ee,G,l);break;case"bilinear":$=zxe(I,d,h,x,v,w,A,Z,ee,G,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${o}`)}const re=A*k+P*C+L*N+G;T[re]=$}return s.makeTensorInfo(g,r.dtype,T)}return{dataId:s.write(T,g,r.dtype),shape:r.shape,dtype:r.dtype}}const Oxe={kernelName:RE,backendName:"cpu",kernelFunc:Dxe};function YO(t,e,n){switch(n){case"reflect":return Mxe(t,e);case"wrap":return Pxe(t,e);case"nearest":return Fxe(t,e);case"constant":default:return Lxe(t)}}function Mxe(t,e){let n=t;if(n<0)if(e<=1)n=0;else{const s=2*e;n<s&&(n=s*Math.trunc(-n/s)+n),n=n<-e?n+s:-n-1}else if(n>e-1)if(e<=1)n=0;else{const s=2*e;n-=s*Math.trunc(n/s),n>=e&&(n=s-n-1)}return Cc(0,n,e-1)}function Pxe(t,e){let n=t;if(n<0)if(e<=1)n=0;else{const s=e-1;n+=e*(Math.trunc(-n/s)+1)}else if(n>e-1)if(e<=1)n=0;else{const s=e-1;n-=e*Math.trunc(n/s)}return Cc(0,n,e-1)}function Lxe(t,e){return t}function Fxe(t,e){return Cc(0,t,e-1)}function Kh(t,e,n,s,r,i,o,a,l,c,u){const d=o*s+a*r+l*i+c;return 0<=a&&a<e&&0<=l&&l<n?t[d]:u}function _xe(t,e,n,s,r,i,o,a,l,c,u){const d=Math.round(a),h=Math.round(l);return Kh(t,e,n,s,r,i,o,d,h,c,u)}function zxe(t,e,n,s,r,i,o,a,l,c,u){const d=Math.floor(a),h=Math.floor(l),f=d+1,p=h+1,m=(p-l)*Kh(t,e,n,s,r,i,o,d,h,c,u)+(l-h)*Kh(t,e,n,s,r,i,o,d,p,c,u),g=(p-l)*Kh(t,e,n,s,r,i,o,f,h,c,u)+(l-h)*Kh(t,e,n,s,r,i,o,f,p,c,u);return(f-a)*m+(a-d)*g}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bxe(t){const{inputs:e,attrs:n,backend:s}=t,{axis:r}=n,{x:i}=e;be(i,"unique");const o=s.data.get(i.dataId).values,{outputValues:a,outputShape:l,indices:c}=SW(o,r,i.shape,i.dtype);return[s.makeTensorInfo(l,i.dtype,a),s.makeTensorInfo([c.length],"int32",c)]}const jxe={kernelName:DE,backendName:"cpu",kernelFunc:Bxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vxe(t){const{inputs:e,backend:n,attrs:s}=t,{value:r}=e;let{axis:i}=s;i<0&&(i+=r.shape.length);const o=r.shape.length,a=r.shape[i],l=new Array(o-1);let c=0;for(let f=0;f<o;f++)f!==i&&(l[c++]=r.shape[f]);const u=new Array(o).fill(0),d=r.shape.slice();d[i]=1;const h=new Array(a);for(let f=0;f<h.length;f++){u[i]=f;const p=Fc({inputs:{x:r},backend:n,attrs:{begin:u,size:d}});h[f]=kt({inputs:{x:p},backend:n,attrs:{shape:l}}),n.disposeIntermediateTensorInfo(p)}return h}const Uxe={kernelName:Sv,backendName:"cpu",kernelFunc:Vxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wxe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,segmentIds:i}=e,{numSegments:o}=s;be(r,"unsortedSegmentSum");const a=r.shape.length,l=i.shape.length,c=[],u=[],d=a-l;let h=i;for(let p=0;p<d;++p){const m=q0({inputs:{input:h},backend:n,attrs:{dim:p+1}});h=m,u.push(m)}for(let p=0;p<o;++p){const m=vl(p,"int32"),g=n.makeTensorInfo([],"int32",m),y=FU({inputs:{a:g,b:h},backend:n}),x=dl({inputs:{x:y},backend:n,attrs:{dtype:"float32"}}),v=Xv({inputs:{a:x,b:r},backend:n}),w=Hm({inputs:{x:v},backend:n,attrs:{axis:0,keepDims:!1}});c.push(w),u.push(g),u.push(y),u.push(x),u.push(v),u.push(w)}const f=FW({inputs:c,backend:n,attrs:{axis:0}});return u.forEach(p=>n.disposeIntermediateTensorInfo(p)),f}const Hxe={kernelName:kv,backendName:"cpu",kernelFunc:Wxe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gxe=[Bpe,vfe,Vpe,Wpe,Tfe,Gpe,qpe,Jpe,Qpe,eme,nme,rme,ome,cme,dme,pme,gme,xme,vme,_pe,Sme,Cme,Tme,Ife,Ime,Cfe,$fe,$me,wfe,Dme,Mme,Pme,Fme,zme,jme,Ume,Hme,Kme,Xme,Yme,Zme,tge,sge,ige,oge,lge,uge,hge,fge,pge,mge,yge,vge,Rpe,Sge,Rfe,$ge,Dfe,Rge,Mfe,Fge,_ge,Bge,Lfe,_fe,Vge,Wge,Gge,qge,Bfe,Vfe,Sfe,Jge,Ome,Qge,eye,nye,Dpe,Wfe,Gfe,rye,qfe,oye,cye,dye,pye,gye,xye,bye,Jfe,wye,kye,Nye,Eye,Aye,Rye,Oye,Qfe,Pye,_ye,jye,epe,npe,Wye,Kye,Jye,rpe,Qye,e0e,t0e,_W,i0e,Mpe,ape,a0e,c0e,d0e,f0e,kfe,SC,m0e,Ppe,Lpe,Fpe,y0e,b0e,w0e,k0e,N0e,T0e,I0e,mpe,$0e,P0e,F0e,j0e,ype,U0e,H0e,K0e,xpe,zye,J0e,Q0e,exe,nxe,rxe,oxe,lxe,uxe,wpe,dxe,kpe,Npe,fxe,mxe,yxe,bxe,wxe,Ape,xge,kxe,Nxe,Exe,Axe,Rxe,Oxe,ipe,jxe,Uxe,Hxe,Zye];for(const t of Gxe)xB(t);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kl={},Pg={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function Kxe(t,e){Kl[t]=e}function Mi(t,e){if(!(t in Kl)||e!=null){const s=Xxe(t,e);if(s!==null)Kl[t]=s;else return console.log("Could not get context for WebGL version",t),null}const n=Kl[t];return n==null||n.isContextLost()?(delete Kl[t],Mi(t)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),Kl[t])}function qxe(t){if(!X().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&t===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function Xxe(t,e){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const n=e??qxe(t);return n.addEventListener("webglcontextlost",s=>{s.preventDefault(),delete Kl[t]},!1),X().getBool("SOFTWARE_WEBGL_ENABLED")&&(Pg.failIfMajorPerformanceCaveat=!1),t===1?n.getContext("webgl",Pg)||n.getContext("experimental-webgl",Pg):n.getContext("webgl2",Pg)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var ip;(function(t){t[t.DENSE=0]="DENSE",t[t.SHARED_BATCH=1]="SHARED_BATCH"})(ip||(ip={}));var br;(function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"})(br||(br={}));var zn;(function(t){t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(zn||(zn={}));function Gm(t,e){return[e,t]}function Jxe(t,e){return t*e}function Lg(t){const e=Q(t),n=Math.ceil(e/4);return Wk(n)}function eh(t,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(t/2))]}function Yxe(t,e){const[n,s]=eh(t,e);return n*s*4}function k2(t,e){const n=t;let s,r,i,o,a,l,c,u,d,h;return X().getNumber("WEBGL_VERSION")===2?(s=n.R32F,r=n.R16F,i=n.RGBA16F,o=n.RGBA32F,a=n.RED,c=4,u=1,d=n.HALF_FLOAT,h=n.FLOAT,l=n.RGBA8):(s=t.RGBA,r=t.RGBA,i=t.RGBA,o=n.RGBA,a=t.RGBA,c=4,u=4,d=e!=null?e.HALF_FLOAT_OES:null,h=t.FLOAT,l=t.RGBA),{internalFormatFloat:s,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:a,downloadTextureFormat:l,downloadUnpackNumChannels:c,defaultNumChannels:u,textureTypeHalfFloat:d,textureTypeFloat:h}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function he(t,e){const n=e();return X().getBool("DEBUG")&&Qxe(t),n}function Qxe(t){const e=t.getError();if(e!==t.NO_ERROR)throw new Error("WebGL Error: "+nbe(t,e))}const Zxe=596e-10,ebe=65504;function tbe(t){return!!(X().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||t===0||Zxe<Math.abs(t)&&Math.abs(t)<ebe)}function nbe(t,e){switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function Fg(t,e){return ua(t,()=>t.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function sbe(t,e){const n=ua(t,()=>t.createShader(t.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(he(t,()=>t.shaderSource(n,e)),he(t,()=>t.compileShader(n)),t.getShaderParameter(n,t.COMPILE_STATUS)===!1)throw console.log(t.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function rbe(t,e){const n=ua(t,()=>t.createShader(t.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(he(t,()=>t.shaderSource(n,e)),he(t,()=>t.compileShader(n)),X().get("ENGINE_COMPILE_ONLY"))return n;if(t.getShaderParameter(n,t.COMPILE_STATUS)===!1)throw zW(e,t.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}const ibe=/ERROR: [0-9]+:([0-9]+):/g;function zW(t,e){const n=ibe.exec(e);if(n==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(t);return}const s=+n[1],r=t.split(`
`),i=r.length.toString().length+2,o=r.map((d,h)=>td((h+1).toString(),i)+d);let a=0;for(let d=0;d<o.length;d++)a=Math.max(o[d].length,a);const l=o.slice(0,s-1),c=o.slice(s-1,s),u=o.slice(s);console.log(l.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${td(c[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(u.join(`
`))}function obe(t){return ua(t,()=>t.createProgram(),"Unable to create WebGLProgram.")}function abe(t,e){if(he(t,()=>t.linkProgram(e)),!X().get("ENGINE_COMPILE_ONLY")&&t.getProgramParameter(e,t.LINK_STATUS)===!1)throw console.log(t.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function Aw(t,e){if(he(t,()=>t.validateProgram(e)),t.getProgramParameter(e,t.VALIDATE_STATUS)===!1)throw console.log(t.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function lbe(t,e){const n=ua(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return he(t,()=>t.bindBuffer(t.ARRAY_BUFFER,n)),he(t,()=>t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW)),n}function cbe(t,e){const n=ua(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return he(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n)),he(t,()=>t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW)),n}function ube(t){return ua(t,()=>t.createTexture(),"Unable to create WebGLTexture.")}function dbe(t,e){const n=X().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||e<=0){const s=`[${t}x${e}]`;throw new Error("Requested texture size "+s+" is invalid.")}if(t>n||e>n){const s=`[${t}x${e}]`,r=`[${n}x${n}]`;throw new Error("Requested texture size "+s+" greater than WebGL maximum on this browser / GPU "+r+".")}}function hbe(t){return ua(t,()=>t.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function QO(t,e,n,s,r,i,o){const a=t.getAttribLocation(e,n);return a===-1?!1:(he(t,()=>t.bindBuffer(t.ARRAY_BUFFER,s)),he(t,()=>t.vertexAttribPointer(a,r,t.FLOAT,!1,i,o)),he(t,()=>t.enableVertexAttribArray(a)),!0)}function fbe(t,e,n){xbe(t,n),he(t,()=>t.activeTexture(t.TEXTURE0+n)),he(t,()=>t.bindTexture(t.TEXTURE_2D,e))}function pbe(t,e,n){return ua(t,()=>t.getUniformLocation(e,n),'uniform "'+n+'" not present in program.')}function mbe(t,e,n){return t.getUniformLocation(e,n)}function gbe(t,e,n,s){he(t,()=>fbe(t,e,s)),he(t,()=>t.uniform1i(n,s))}function $w(t,e,n){he(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,n)),he(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0))}function ZO(t,e){he(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,e)),he(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0))}function _g(t){const e=t.checkFramebufferStatus(t.FRAMEBUFFER);if(e!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+ybe(t,e))}function ybe(t,e){switch(e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function ua(t,e,n){const s=he(t,()=>e());if(s==null)throw new Error(n);return s}function xbe(t,e){const n=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,s=e+t.TEXTURE0;if(s<t.TEXTURE0||s>n){const r=`[gl.TEXTURE0, gl.TEXTURE${n}]`;throw new Error(`textureUnit must be in ${r}.`)}}function Rd(t,e=2){return Q(t.slice(0,t.length-e))}function Dd(t){if(t.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function zg(t){let e=[1,1,1];return t.length===0||t.length===1&&t[0]===1||(e=[Rd(t),...Dd(t)]),e}function bbe(t,e=!1){let n=X().getNumber("WEBGL_MAX_TEXTURE_SIZE"),s=X().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");s===1/0&&X().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(s=n/2),e&&(n=n*2,s=s*2,t=t.map((a,l)=>l>=t.length-2?VT(t[l]):t[l]),t.length===1&&(t=[2,t[0]])),t.length!==2&&(t=bl(t).newShape);let r=Q(t),i=null;t.length<=1&&r<=n?i=[1,r]:t.length===2&&t[0]<=n&&t[1]<=n?i=t:t.length===3&&t[0]*t[1]<=n&&t[2]<=n?i=[t[0]*t[1],t[2]]:t.length===3&&t[0]<=n&&t[1]*t[2]<=n?i=[t[0],t[1]*t[2]]:t.length===4&&t[0]*t[1]*t[2]<=n&&t[3]<=n?i=[t[0]*t[1]*t[2],t[3]]:t.length===4&&t[0]<=n&&t[1]*t[2]*t[3]<=n&&(i=[t[0],t[1]*t[2]*t[3]]);const o=i!=null&&Math.max(...i)>s&&Math.min(...i)<=(e?2:1)&&Math.min(...i)>0;if(i==null||o)if(e){const a=Rd(t);let l=2,c=2;t.length&&([l,c]=Dd(t)),r=a*(l/2)*(c/2),i=Wk(r).map(u=>u*2)}else i=Wk(r);return i}function Bg(t){return t%2===0}function J0(t,e){if(t=t.slice(-2),e=e.slice(-2),ct(t,e)||!t.length||!e.length||t[0]===0||t[1]===0||e[0]===0||e[1]===0)return!0;if(t.length!==e.length){const n=t[t.length-1],s=e[e.length-1];if(n===s||Bg(n)&&Bg(s)&&(t[0]===1||e[0]===1))return!0}return t[1]===e[1]&&Bg(t[0])&&Bg(e[0])}let Rw,Dw;function vbe(t){if(Rw==null){const e=Mi(t);Rw=e.getParameter(e.MAX_TEXTURE_SIZE)}return Rw}function wbe(t){if(Dw==null){const e=Mi(t);Dw=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Dw)}function Sbe(t){if(t===0)return 0;let e;const n=Mi(t);return Yr(n,"EXT_disjoint_timer_query_webgl2")&&t===2?e=2:Yr(n,"EXT_disjoint_timer_query")?e=1:e=0,e}function Yr(t,e){return t.getExtension(e)!=null}function eM(t){try{if(Mi(t)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function kbe(t){if(t===0)return!1;const e=Mi(t);if(t===1){if(!Yr(e,"OES_texture_float"))return!1}else if(!Yr(e,"EXT_color_buffer_float"))return!1;return CC(e)}function Cbe(t){if(t===0)return!1;const e=Mi(t);if(t===1){if(!Yr(e,"OES_texture_float")||!Yr(e,"WEBGL_color_buffer_float"))return!1}else{if(Yr(e,"EXT_color_buffer_float"))return CC(e);const s="EXT_color_buffer_half_float";if(Yr(e,s)){const r=e.getExtension(s);return Nbe(e,r)}return!1}return CC(e)}function CC(t){const e=k2(t),n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n);const s=1,r=1;t.texImage2D(t.TEXTURE_2D,0,e.internalFormatFloat,s,r,0,e.textureFormatFloat,e.textureTypeFloat,null);const i=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);const o=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(n),t.deleteFramebuffer(i),o}function Nbe(t,e){const n=k2(t,e),s=t.createTexture();t.bindTexture(t.TEXTURE_2D,s);const r=1,i=1;t.texImage2D(t.TEXTURE_2D,0,n.internalFormatHalfFloat,r,i,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);const o=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,o),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,s,0);const a=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(s),t.deleteFramebuffer(o),a}function Tbe(t){return t!==2?!1:Mi(t).fenceSync!=null}function Km(t,e){Array.isArray(t)||(t=[t]),t.forEach(n=>{n!=null&&E(n.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ve=X();ve.registerFlag("HAS_WEBGL",()=>ve.getNumber("WEBGL_VERSION")>0);ve.registerFlag("WEBGL_VERSION",()=>eM(2)?2:eM(1)?1:0);ve.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);ve.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>ve.get("WEBGL_VERSION")===2);ve.registerFlag("WEBGL_CPU_FORWARD",()=>!0);ve.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);ve.registerFlag("WEBGL_PACK",()=>ve.getBool("HAS_WEBGL"));ve.registerFlag("WEBGL_PACK_NORMALIZATION",()=>ve.getBool("WEBGL_PACK"));ve.registerFlag("WEBGL_PACK_CLIP",()=>ve.getBool("WEBGL_PACK"));ve.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>ve.getBool("WEBGL_PACK"));ve.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>ve.getBool("WEBGL_PACK"));ve.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>ve.getBool("WEBGL_PACK"));ve.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>ve.getBool("WEBGL_PACK"));ve.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>ve.getBool("WEBGL_PACK"));ve.registerFlag("WEBGL_PACK_REDUCE",()=>ve.getBool("WEBGL_PACK"));ve.registerFlag("WEBGL_LAZILY_UNPACK",()=>ve.getBool("WEBGL_PACK"));ve.registerFlag("WEBGL_CONV_IM2COL",()=>ve.getBool("WEBGL_PACK"));ve.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>ve.getBool("WEBGL_PACK"));ve.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>vbe(ve.getNumber("WEBGL_VERSION")));ve.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>wbe(ve.getNumber("WEBGL_VERSION")));ve.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const t=ve.getNumber("WEBGL_VERSION");return t===0?0:Sbe(t)});ve.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>ve.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!PB());ve.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>kbe(ve.getNumber("WEBGL_VERSION")));ve.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>ve.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:ve.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));ve.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>Cbe(ve.getNumber("WEBGL_VERSION")));ve.registerFlag("WEBGL_FENCE_API_ENABLED",()=>Tbe(ve.getNumber("WEBGL_VERSION")));ve.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>ve.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);ve.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,t=>{if(typeof t!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${t}.`);if(t<0&&t!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${t}.`)});ve.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>PB()?1:-1,t=>{if(typeof t!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${t}.`);if(t<0&&t!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${t}.`)});ve.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);ve.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);ve.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);ve.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);ve.registerFlag("WEBGL_EXP_CONV",()=>!1);ve.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>ve.getBool("IS_TEST"));ve.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);ve.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);ve.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);ve.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ns(){let t,e,n,s,r,i,o,a,l,c;return X().getNumber("WEBGL_VERSION")===2?(t="#version 300 es",e="in",n="out",s="in",r="texture",i="outputColor",o="out vec4 outputColor;",a=X().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",l="",c=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(t="",e="attribute",n="varying",s="varying",r="texture2D",i="gl_FragColor",o="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,c=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:t,attribute:e,varyingVs:n,varyingFs:s,texture2D:r,output:i,defineOutput:o,defineSpecialNaN:a,defineSpecialInf:l,defineRound:c}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function su(t,e,n="index"){const s=ke(e);return s.map((r,i)=>{const o=`int ${t[i]} = ${n} / ${r}`,a=i===s.length-1?`int ${t[i+1]} = ${n} - ${t[i]} * ${r}`:`index -= ${t[i]} * ${r}`;return`${o}; ${a};`}).join("")}function Jv(t,e,n="index"){const s=ke(e);return s.map((r,i)=>{const o=`int ${t[i]} = ${n} / outShapeStrides[${i}]`,a=i===s.length-1?`int ${t[i+1]} = ${n} - ${t[i]} * outShapeStrides[${i}]`:`index -= ${t[i]} * outShapeStrides[${i}]`;return`${o}; ${a};`}).join("")}function Ebe(t,e){const n=t.length,s=t.map(i=>`${e}[${i}]`),r=new Array(n-1);r[n-2]=s[n-1];for(let i=n-3;i>=0;--i)r[i]=`(${r[i+1]} * ${s[i+1]})`;return r}function Ibe(t,e,n="index"){const s=t.map((i,o)=>o),r=Ebe(s,e);return r.map((i,o)=>{const a=`int ${t[o]} = ${n} / ${r[o]}`,l=o===r.length-1?`int ${t[o+1]} = ${n} - ${t[o]} * ${r[o]}`:`index -= ${t[o]} * ${r[o]}`;return`${a}; ${l};`}).join("")}function C2(t){const e=ke(t).map(n=>n.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function N2(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const BW=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:jW}=mce;function Abe(t,e,n){const s=[];if(t.forEach(f=>{const p=Q(f.shapeInfo.logicalShape);if(f.shapeInfo.isUniform?s.push(`uniform float ${f.name}${p>1?`[${p}]`:""};`):(s.push(`uniform sampler2D ${f.name};`),s.push(`uniform int offset${f.name};`)),n.enableShapeUniforms){const{uniformShape:m}=T2(n.packedInputs,f.shapeInfo.logicalShape,f.shapeInfo.texShape);switch(m.length){case 1:s.push(`uniform int ${f.name}Shape;`);break;case 2:s.push(`uniform ivec2 ${f.name}Shape;`);break;case 3:s.push(`uniform ivec3 ${f.name}Shape;`);break;case 4:s.push(`uniform ivec4 ${f.name}Shape;`);break}s.push(`uniform ivec2 ${f.name}TexShape;`)}}),n.enableShapeUniforms){switch(e.logicalShape.length){case 1:s.push("uniform int outShape;");break;case 2:s.push("uniform ivec2 outShape;"),s.push("uniform int outShapeStrides;");break;case 3:s.push("uniform ivec3 outShape;"),s.push("uniform ivec2 outShapeStrides;");break;case 4:s.push("uniform ivec4 outShape;"),s.push("uniform ivec3 outShapeStrides;");break}s.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach(f=>{s.push(`uniform ${f.type} ${f.name}${f.arrayIndex?`[${f.arrayIndex}]`:""};`)});const r=s.join(`
`),i=t.map(f=>$be(f,e,n.packedInputs,n.enableShapeUniforms)).join(`
`),o=e.texShape,a=Ns(),l=Obe(a);let c,u,d=Lbe(a);return e.isPacked?(c=Rbe(e.logicalShape,o,n.enableShapeUniforms),u=Pbe(a)):(c=Dbe(e.logicalShape,o,n.enableShapeUniforms),u=Mbe(a)),n.packedInputs&&(d+=Bbe),[d,l,u,r,c,i,n.userCode].join(`
`)}function th(t,e=!1){const n=t.shapeInfo.logicalShape;switch(n.length){case 0:return Qbe(t,e);case 1:return eve(t,e);case 2:return nve(t,e);case 3:return rve(t,e);case 4:return ove(t,e);case 5:return ave(t);case 6:return lve(t);default:throw new Error(`${n.length}-D input sampling is not yet supported`)}}function VW(t,e){switch(t.shapeInfo.logicalShape.length){case 0:return Ybe(t);case 1:return Zbe(t,e);case 2:return tve(t,e);case 3:return sve(t,e);default:return ive(t,e)}}function $be(t,e,n=!1,s){let r="";n?r+=VW(t,s):r+=th(t,s);const i=t.shapeInfo.logicalShape,o=e.logicalShape;return i.length<=o.length&&(n?r+=cve(t,e):r+=uve(t,e)),r}function Rbe(t,e,n){switch(t.length){case 0:return UW();case 1:return jbe(t,e,n);case 2:return Xbe(t,e,n);case 3:return Ube(t,e,n);default:return Hbe(t,e,n)}}function Dbe(t,e,n){switch(t.length){case 0:return UW();case 1:return Vbe(t,e,n);case 2:return Jbe(t,e,n);case 3:return Wbe(t,e,n);case 4:return Gbe(t,e,n);case 5:return Kbe(t,e);case 6:return qbe(t,e);default:throw new Error(`${t.length}-D output sampling is not yet supported`)}}function Obe(t){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${t.texture2D}(textureSampler, uv).r;
    }
  `}function Mbe(t){return`
    void setOutput(float val) {
      ${t.output} = vec4(val, 0, 0, 0);
    }
  `}function Pbe(t){return`
    void setOutput(vec4 val) {
      ${t.output} = val;
    }
  `}function Lbe(t){return`${t.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${t.varyingFs} vec2 resultUV;
    ${t.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${t.defineSpecialNaN}
    ${t.defineSpecialInf}
    ${t.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${Fbe}
    ${_be}
    ${zbe}
  `}const Fbe=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,_be=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,zbe=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Bbe=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function UW(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function jbe(t,e,n){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return s[0]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${s[1]}.0);
      }
    `:s[1]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${s[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      return 2 * (resTexRC.x * ${s[1]} + resTexRC.y);
    }
  `}function Vbe(t,e,n){return e[0]===1?n?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?n?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function Ube(t,e,n){if(n)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(t[2]/2),i=r*Math.ceil(t[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      int b = index / ${i};
      index -= b * ${i};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec3(b, r, c);
    }
  `}function Wbe(t,e,n){if(n)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${Jv(["r","c","d"],t)}
    return ivec3(r, c, d);
  }
`;const s=su(["r","c","d"],t);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec3(r, c, d);
    }
  `}function Hbe(t,e,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(t[t.length-1]/2),i=r*Math.ceil(t[t.length-2]/2);let o=i,a="",l="b, r, c";for(let c=2;c<t.length-1;c++)o*=t[t.length-c-1],a=`
      int b${c} = index / ${o};
      index -= b${c} * ${o};
    `+a,l=`b${c}, `+l;return`
    ivec${t.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      ${a}

      int b = index / ${i};
      index -= b * ${i};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec${t.length}(${l});
    }
  `}function Gbe(t,e,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${Jv(["r","c","d","d2"],t)}
      return ivec4(r, c, d, d2);
    }
  `;const s=su(["r","c","d","d2"],t);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec4(r, c, d, d2);
    }
  `}function Kbe(t,e){const n=su(["r","c","d","d2","d3"],t);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${n}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function qbe(t,e){const n=su(["r","c","d","d2","d3","d4"],t);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${n}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function Xbe(t,e,n){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(ct(t,e))return n?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${s[0]}, ${s[1]}));
      }
    `;const r=Math.ceil(t[1]/2);return n?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));

      int index = resTexRC.x * ${s[1]} + resTexRC.y;
      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec2(r, c);
    }
  `}function Jbe(t,e,n){return ct(t,e)?n?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:t[1]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:t[0]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:n?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${t[1]};
      int c = index - r * ${t[1]};
      return ivec2(r, c);
    }
  `}function ru(t){return`offset${t}`}function Ybe(t){const e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1),s=Ns();return`
    vec4 ${n}() {
      return ${s.texture2D}(${e}, halfCR);
    }
  `}function Qbe(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`float ${s}() {return ${n};}`;const[r,i]=t.shapeInfo.texShape;if(r===1&&i===1)return`
      float ${s}() {
        return sampleTexture(${n}, halfCR);
      }
    `;const o=ru(n);if(e)return`
    float ${s}() {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], ${o});
      return sampleTexture(${n}, uv);
    }
  `;const[a,l]=t.shapeInfo.texShape;return`
    float ${s}() {
      vec2 uv = uvFromFlat(${a}, ${l}, ${o});
      return sampleTexture(${n}, uv);
    }
  `}function Zbe(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),r=t.shapeInfo.texShape,i=Ns();if(e)return`
    vec4 ${s}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${i.texture2D}(${n}, uv);
    }
  `;const o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];return`
    vec4 ${s}(int index) {
      vec2 uv = packedUVfrom1D(
        ${o[0]}, ${o[1]}, index);
      return ${i.texture2D}(${n}, uv);
    }
  `}function eve(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`
      float ${s}(int index) {
        ${nh(t)}
      }
    `;const r=t.shapeInfo.texShape,i=r[0],o=r[1];if(o===1&&i===1)return`
      float ${s}(int index) {
        return sampleTexture(${n}, halfCR);
      }
    `;const a=ru(n);return o===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${n}TexShape[0]));
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${i}.0);
        return sampleTexture(${n}, uv);
      }
    `:i===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${n}TexShape[1]), 0.5);
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${o}.0, 0.5);
        return sampleTexture(${n}, uv);
      }
    `:e?`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index + ${a});
      return sampleTexture(${n}, uv);
    }
  `:`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${i}, ${o}, index + ${a});
      return sampleTexture(${n}, uv);
    }
  `}function tve(t,e){const n=t.shapeInfo.logicalShape,s=t.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=t.shapeInfo.texShape,o=i[0],a=i[1],l=Ns();if(i!=null&&ct(n,i))return e?`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);

        return ${l.texture2D}(${s}, uv);
      }
    `:`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${o}.0);

        return ${l.texture2D}(${s}, uv);
      }
    `;if(e)return`
    vec4 ${r}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `;const c=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],u=Math.ceil(n[1]/2);return`
    vec4 ${r}(int row, int col) {
      vec2 uv = packedUVfrom2D(${u}, ${c[0]}, ${c[1]}, row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `}function nve(t,e){const n=t.shapeInfo.logicalShape,s=t.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=t.shapeInfo.texShape;if(i!=null&&ct(n,i)){if(e)return`
      float ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `;const h=i[0],f=i[1];return`
    float ${r}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${f}.0, ${h}.0);
      return sampleTexture(${s}, uv);
    }
  `}const{newShape:o,keptDims:a}=bl(n),l=o;if(l.length<n.length){const h=sh(t,l),f=["row","col"];return`
      ${th(h,e)}
      float ${r}(int row, int col) {
        return ${r}(${rh(f,a)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${n[1]}, 1)));
        ${nh(t)}
      }
    `;const c=i[0],u=i[1],d=ru(s);return u===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${d}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${s}TexShape[0]));
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${d}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${c}.0);
      return sampleTexture(${s}, uv);
    }
  `:c===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${d}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${s}TexShape[1]), 0.5);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${d}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${u}.0, 0.5);
      return sampleTexture(${s}, uv);
    }
  `:e?`
      float ${r}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s}Shape[1] + col + ${d};
        vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
        return sampleTexture(${s}, uv);
      }
    `:`
  float ${r}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${n[1]} + col + ${d};
    vec2 uv = uvFromFlat(${c}, ${u}, index);
    return sampleTexture(${s}, uv);
  }
`}function sve(t,e){const n=t.shapeInfo.logicalShape,s=t.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=t.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(n[0]===1){const h=n.slice(1),f=[1,2],p=sh(t,h),m=["b","row","col"];return`
        ${VW(p,e)}
        vec4 ${r}(int b, int row, int col) {
          return ${r}(${rh(m,f)});
        }
      `}const a=Ns();if(e)return`
    vec4 ${r}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `;const l=o[0],c=o[1],u=Math.ceil(n[2]/2),d=u*Math.ceil(n[1]/2);return`
    vec4 ${r}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${l}, ${c}, ${d}, ${u}, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `}function rve(t,e){const n=t.shapeInfo.logicalShape,s=t.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=n[1]*n[2],o=n[2],{newShape:a,keptDims:l}=bl(n),c=a;if(c.length<n.length){const m=sh(t,c),g=["row","col","depth"];return`
        ${th(m,e)}
        float ${r}(int row, int col, int depth) {
          return ${r}(${rh(g,l)});
        }
      `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${i}, ${o}, 1)));
        ${nh(t)}
      }
    `;const u=t.shapeInfo.texShape,d=u[0],h=u[1],f=t.shapeInfo.flatOffset;if(h===i&&f==null)return e?`
      float ${r}(int row, int col, int depth) {
        int stride1 = ${s}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
        float ${r}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${o}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${h}.0, ${d}.0);
          return sampleTexture(${s}, uv);
        }
      `;if(h===o&&f==null)return e?`
      float ${r}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${s}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${n[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${h}.0, ${d}.0);
      return sampleTexture(${s}, uv);
    }
  `;const p=ru(s);return e?`
    float ${r}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${s}Shape[1] * ${s}Shape[2];
      int stride1 = ${s}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${p};
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
      return sampleTexture(${s}, uv);
    }
    `:`
      float ${r}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${i} + col * ${o} + depth + ${p};
        vec2 uv = uvFromFlat(${d}, ${h}, index);
        return sampleTexture(${s}, uv);
      }
  `}function ive(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),r=Ns();if(e)return`
    vec4 ${s}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${n}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${n}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${n}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${r.texture2D}(${n}, uv);
    }
  `;const i=t.shapeInfo.logicalShape,o=i.length,a=t.shapeInfo.texShape,l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],c=l[0],u=l[1],d=Math.ceil(i[o-1]/2);let h=d*Math.ceil(i[o-2]/2),f="int b, int row, int col",p=`b * ${h} + (row / 2) * ${d} + (col / 2)`;for(let m=2;m<o-1;m++)f=`int b${m}, `+f,h*=i[o-m-1],p=`b${m} * ${h} + `+p;return`
    vec4 ${s}(${f}) {
      int index = ${p};
      int texR = index / ${u};
      int texC = index - texR * ${u};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${u}, ${c});
      return ${r.texture2D}(${n}, uv);
    }
  `}function ove(t,e){const n=t.shapeInfo.logicalShape,s=t.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),i=n[3],o=n[2]*i,a=n[1]*o,{newShape:l,keptDims:c}=bl(n);if(l.length<n.length){const x=sh(t,l),v=["row","col","depth","depth2"];return`
      ${th(x,e)}
      float ${r}(int row, int col, int depth, int depth2) {
        return ${r}(${rh(v,c)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${o}, ${i}, 1)));
        ${nh(t)}
      }
    `;const u=t.shapeInfo.flatOffset,d=t.shapeInfo.texShape,h=d[0],f=d[1],p=`int stride2 = ${s}Shape[3];`,m=`int stride1 = ${s}Shape[2] * stride2;`,g=`int stride0 = ${s}Shape[1] * stride1;`;if(f===a&&u==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        ${p}
        ${m}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${o}, ${i}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${f}.0, ${h}.0);
        return sampleTexture(${s}, uv);
      }
    `;if(f===i&&u==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${s}Shape[1] * ${s}Shape[2], ${s}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${n[1]*n[2]}, ${n[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${f}.0, ${h}.0);
        return sampleTexture(${s}, uv);
      }
    `;const y=ru(s);return e?`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${p}
      ${m}
      ${g}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index + ${y});
      return sampleTexture(${s}, uv);
    }
  `:`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} +
          depth * ${i} + depth2;
      vec2 uv = uvFromFlat(${h}, ${f}, index + ${y});
      return sampleTexture(${s}, uv);
    }
  `}function ave(t){const e=t.shapeInfo.logicalShape,n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),r=e[4],i=e[3]*r,o=e[2]*i,a=e[1]*o,{newShape:l,keptDims:c}=bl(e);if(l.length<e.length){const m=sh(t,l),g=["row","col","depth","depth2","depth3"];return`
      ${th(m)}
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        return ${s}(${rh(g,c)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${o}, ${i}, ${r})) +
          depth3;
        ${nh(t)}
      }
    `;const u=t.shapeInfo.flatOffset,d=t.shapeInfo.texShape,h=d[0],f=d[1];if(f===a&&u==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${o}, ${i}, ${r}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${f}.0, ${h}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(f===r&&u==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${f}.0, ${h}.0);
        return sampleTexture(${n}, uv);
      }
    `;const p=ru(n);return`
    float ${s}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${o} + depth * ${i} +
          depth2 * ${r} + depth3 + ${p};
      vec2 uv = uvFromFlat(${h}, ${f}, index);
      return sampleTexture(${n}, uv);
    }
  `}function lve(t){const e=t.shapeInfo.logicalShape,n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:r,keptDims:i}=bl(e);if(r.length<e.length){const g=sh(t,r),y=["row","col","depth","depth2","depth3","depth4"];return`
      ${th(g)}
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${s}(${rh(y,i)});
      }
    `}const o=e[5],a=e[4]*o,l=e[3]*a,c=e[2]*l,u=e[1]*c;if(t.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${u}, ${c}, ${l}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${o}, 1)));
        ${nh(t)}
      }
    `;const d=t.shapeInfo.flatOffset,h=t.shapeInfo.texShape,f=h[0],p=h[1];if(p===u&&d==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${c}, ${l}, ${a}, ${o})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${p}.0, ${f}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(p===o&&d==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${p}.0, ${f}.0);
        return sampleTexture(${n}, uv);
      }
    `;const m=ru(n);return`
    float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${u} + col * ${c} + depth * ${l} +
          depth2 * ${a} + depth3 * ${o} + depth4 + ${m};
      vec2 uv = uvFromFlat(${f}, ${p}, index);
      return sampleTexture(${n}, uv);
    }
  `}function nh(t){const e=t.name,n=Q(t.shapeInfo.logicalShape);return n<2?`return ${e};`:`
    for (int i = 0; i < ${n}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function cve(t,e){const n=t.name,s=n.charAt(0).toUpperCase()+n.slice(1),r="get"+s+"AtOutCoords",i=t.shapeInfo.logicalShape.length,o=e.logicalShape.length,a=jW(t.shapeInfo.logicalShape,e.logicalShape),l=gt(o),c=o-i;let u;const d=["x","y","z","w","u","v"];i===0?u="":o<2&&a.length>=1?u="coords = 0;":u=a.map(x=>`coords.${d[x+c]} = 0;`).join(`
`);let h="";o<2&&i>0?h="coords":h=t.shapeInfo.logicalShape.map((x,v)=>`coords.${d[v+c]}`).join(", ");let f="return outputValue;";const m=Q(t.shapeInfo.logicalShape)===1,y=Q(e.logicalShape)===1;if(i===1&&!m&&!y)f=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(m&&!y)o===1?f=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:f=`
        return vec4(outputValue.x);
      `;else if(a.length){const x=i-2,v=i-1;a.indexOf(x)>-1&&a.indexOf(v)>-1?f="return vec4(outputValue.x);":a.indexOf(x)>-1?f="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(v)>-1&&(f="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${r}() {
      ${l} coords = getOutputCoords();
      ${u}
      vec4 outputValue = get${s}(${h});
      ${f}
    }
  `}function uve(t,e){const n=t.name,s=n.charAt(0).toUpperCase()+n.slice(1),r="get"+s+"AtOutCoords",i=e.texShape,o=t.shapeInfo.texShape,a=t.shapeInfo.logicalShape.length,l=e.logicalShape.length;if(!t.shapeInfo.isUniform&&a===l&&t.shapeInfo.flatOffset==null&&ct(o,i))return`
      float ${r}() {
        return sampleTexture(${n}, resultUV);
      }
    `;const c=gt(l),u=jW(t.shapeInfo.logicalShape,e.logicalShape),d=l-a;let h;const f=["x","y","z","w","u","v"];a===0?h="":l<2&&u.length>=1?h="coords = 0;":h=u.map(m=>`coords.${f[m+d]} = 0;`).join(`
`);let p="";return l<2&&a>0?p="coords":p=t.shapeInfo.logicalShape.map((m,g)=>`coords.${f[g+d]}`).join(", "),`
    float ${r}() {
      ${c} coords = getOutputCoords();
      ${h}
      return get${s}(${p});
    }
  `}function gt(t){if(t<=1)return"int";if(t===2)return"ivec2";if(t===3)return"ivec3";if(t===4)return"ivec4";if(t===5)return"ivec5";if(t===6)return"ivec6";throw Error(`GPU for rank ${t} is not yet supported`)}function T2(t,e,n){const{newShape:s,keptDims:r}=bl(e),i=e.length,o=t&&i===3&&e[0]===1,a=o?e.slice(1):s,l=!t&&i>1&&!ct(e,n)&&s.length<i||o;return{useSqueezeShape:l,uniformShape:l?a:e,keptDims:r}}function sh(t,e){const n=JSON.parse(JSON.stringify(t));return n.shapeInfo.logicalShape=e,n}function rh(t,e){return e.map(n=>t[n]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dve(t,e,n,s){const r=n.map((u,d)=>{const h={logicalShape:u.shape,texShape:u.isUniform?null:u.texData.texShape,isUniform:u.isUniform,isPacked:u.isUniform?!1:u.texData.isPacked,flatOffset:null};return u.texData!=null&&u.texData.slice!=null&&u.texData.slice.flatOffset>0&&(h.flatOffset=u.texData.slice.flatOffset),{name:e.variableNames[d],shapeInfo:h}}),i=r.map(u=>u.shapeInfo),o={logicalShape:s.shape,texShape:s.texData.texShape,isUniform:!1,isPacked:s.texData.isPacked,flatOffset:null},a=Abe(r,o,e),l=rbe(t.gl,a),c=t.createProgram(l);return X().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:l,source:a,webGLProgram:c,inShapeInfos:i,outShapeInfo:o,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(t.buildVao(c),Object.assign({program:e,fragmentShader:l,source:a,webGLProgram:c,inShapeInfos:i,outShapeInfo:o},WW(t,e,c)))}function WW(t,e,n){const s=[],r=[];let i,o,a,l=null,c=null;c=t.getUniformLocation(n,"NAN",!1),X().getNumber("WEBGL_VERSION")===1&&(l=t.getUniformLocation(n,"INFINITY",!1));const u=!1;for(const d of e.variableNames){const h={name:d,uniform:t.getUniformLocation(n,d,u),offset:t.getUniformLocation(n,`offset${d}`,u)};e.enableShapeUniforms&&(h.shape=t.getUniformLocation(n,`${d}Shape`,u),h.texShape=t.getUniformLocation(n,`${d}TexShape`,u)),s.push(h)}if(e.enableShapeUniforms&&(i=t.getUniformLocation(n,"outShape",u),a=t.getUniformLocation(n,"outShapeStrides",u),o=t.getUniformLocation(n,"outTexShape",u)),e.customUniforms)for(const d of e.customUniforms)r.push(t.getUniformLocation(n,d.name,u));return{variablesLocations:s,customUniformLocations:r,infLoc:l,nanLoc:c,outShapeLocation:i,outShapeStridesLocation:a,outTexShapeLocation:o}}function tM(t,e){if(t.length!==e.length)throw Error(`Binary was compiled with ${t.length} inputs, but was executed with ${e.length} inputs`);t.forEach((n,s)=>{const r=n.logicalShape,i=e[s],o=i.shape;if(!ct(r,o))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${r} and ${o} must match`);if(n.isUniform&&i.isUniform)return;const a=n.texShape,l=i.isUniform?null:i.texData.texShape;if(!ct(a,l))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${l} must match`)})}function hve(t,e,n,s,r){e.program.enableShapeUniforms||(tM(e.inShapeInfos,n),tM([e.outShapeInfo],[s]));const i=s.texData.texture,o=s.texData.texShape;s.texData.isPacked?t.setOutputPackedMatrixTexture(i.texture,o[0],o[1]):t.setOutputMatrixTexture(i.texture,o[0],o[1]),t.setProgram(e.webGLProgram),t.bindVertexArray(e.webGLProgram.vao),X().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&t.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&t.gl.uniform1f(e.nanLoc,NaN);for(let l=0;l<n.length;++l){const c=n[l],{uniform:u,offset:d,shape:h,texShape:f}=e.variablesLocations[l];if(h){const{uniformShape:p}=T2(e.program.packedInputs,c.shape,c.texData.texShape);switch(p.length){case 1:t.gl.uniform1iv(h,new Int32Array(p));break;case 2:t.gl.uniform2iv(h,new Int32Array(p));break;case 3:t.gl.uniform3iv(h,new Int32Array(p));break;case 4:t.gl.uniform4iv(h,new Int32Array(p));break}}if(f&&t.gl.uniform2i(f,c.texData.texShape[0],c.texData.texShape[1]),u!=null){if(c.isUniform){if(Q(c.shape)<2)t.gl.uniform1f(u,c.uniformValues[0]);else{let p=c.uniformValues;p instanceof Float32Array||(p=new Float32Array(p)),t.gl.uniform1fv(u,p)}continue}c.texData.slice!=null&&d!=null&&t.gl.uniform1i(d,c.texData.slice.flatOffset),t.setInputMatrixTexture(c.texData.texture.texture,u,l)}}const a=e.outShapeLocation;if(a)switch(s.shape.length){case 1:t.gl.uniform1iv(a,new Int32Array(s.shape));break;case 2:t.gl.uniform2iv(a,new Int32Array(s.shape));break;case 3:t.gl.uniform3iv(a,new Int32Array(s.shape));break;case 4:t.gl.uniform4iv(a,new Int32Array(s.shape));break}if(e.outShapeStridesLocation){const l=ke(s.shape);switch(s.shape.length){case 2:t.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(l));break;case 3:t.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(l));break;case 4:t.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(l));break}}if(e.outTexShapeLocation&&t.gl.uniform2i(e.outTexShapeLocation,s.texData.texShape[0],s.texData.texShape[1]),e.program.customUniforms&&r)for(let l=0;l<e.program.customUniforms.length;++l){const c=e.program.customUniforms[l],u=e.customUniformLocations[l],d=r[l];if(c.type==="float")t.gl.uniform1fv(u,d);else if(c.type==="vec2")t.gl.uniform2fv(u,d);else if(c.type==="vec3")t.gl.uniform3fv(u,d);else if(c.type==="vec4")t.gl.uniform4fv(u,d);else if(c.type==="int")t.gl.uniform1iv(u,d);else if(c.type==="ivec2")t.gl.uniform2iv(u,d);else if(c.type==="ivec3")t.gl.uniform3iv(u,d);else if(c.type==="ivec4")t.gl.uniform4iv(u,d);else throw Error(`uniform type ${c.type} is not supported yet.`)}t.executeProgram()}function fve(t,e,n){let s="";e.concat(n).forEach(o=>{const a=o.texData!=null&&o.texData.slice!=null&&o.texData.slice.flatOffset>0;if(t.enableShapeUniforms&&!o.isUniform){const l=o.texData.texShape,{useSqueezeShape:c,uniformShape:u,keptDims:d}=T2(t.packedInputs,o.shape,l);let h="",f="",p="";if(u.length===1&&t.packedInputs){const S=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)];h=`${S[0]>1}_${S[1]>1}`}else if(u.length===2&&!t.packedInputs)f=`${u[0]>1}_${u[1]>1}`;else if(u.length>2&&!t.packedInputs){const S=ke(u);p=`${S[0]===l[1]}_${S[S.length-1]===l[1]}`}const m=o.shape.length,g=u.length===2&&ct(o.shape,l),y=Q(o.shape)===1,x=Nd(o.shape,n.shape),v=!t.packedInputs&&m===n.shape.length&&ct(l,n.texData.texShape),w=t.packedInputs||u.length>2?"":`${l[0]>1}_${l[1]>1}`;s+=`${m}_${v}_${c?d:""}_${u.length}_${y}_${x}_${g}_${h}_${f}_${p}_${w}_${a}`}else{const l=o.isUniform?"uniform":o.texData.texShape;s+=`${o.shape}_${l}_${a}`}});const r=t.userCode;let i=t.constructor.name;return i+="_"+s+"_"+r+`${X().getNumber("WEBGL_VERSION")}`,i}function ls(t){return X().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&t<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pve{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=ip.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=Ns();this.outputShape=e,this.enableShapeUniforms=ls(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Jv(["r","c","d"],e):su(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mve{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=ip.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=Ns();this.outputShape=e,this.enableShapeUniforms=ls(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Jv(["r","c","d"],e):su(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gve{constructor(e){this.variableNames=["A"],this.outTexUsage=br.DOWNLOAD;const n=Ns();this.outputShape=e,this.userCode=`
      ${BW}

      void main() {
        float x = getAAtOutCoords();
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yve{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=br.DOWNLOAD;const n=Ns();this.outputShape=e,this.userCode=`
      ${BW}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xve={R:0,G:1,B:2,A:3};class nM{constructor(e,n=!1,s="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=Ns();this.outputShape=e,this.enableShapeUniforms=ls(this.outputShape.length);let i="result";n&&(i="floor(result * 255. + 0.5)");let o="";for(let a=0;a<s.length;a++){const l=s[a];o+=`
          if(offset == ${a}) {
            result = values[${xve[l]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?N2():C2(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${s.length});

        flatIndex = idiv(flatIndex, ${s.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${r.texture2D}(A, uv);
          ${o}
        }
        ${r.output} = vec4(${i}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bve{constructor(e,n=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=Ns();this.outputShape=e,this.enableShapeUniforms=ls(this.outputShape.length);let r="",i="result";n&&(i="floor(result * 255. + 0.5)");for(let o=0;o<=1;o++)for(let a=0;a<=1;a++){const l=o*2+a;r+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${o} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${o};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${s.texture2D}(A, uv);

            if (offset == 0) {
              result[${l}] = values[0];
            } else if (offset == 1) {
              result[${l}] = values[1];
            } else if (offset == 2) {
              result[${l}] = values[2];
            } else {
              result[${l}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?N2():C2(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${r}

          ${s.output} = ${i};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vve(t){const e=Ns(),n=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return sbe(t,n)}function wve(t){const e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return lbe(t,e)}function Sve(t){const e=new Uint16Array([0,1,2,2,1,3]);return cbe(t,e)}function qm(t,e,n,s,r,i){dbe(e,n);const o=ube(t),a=t.TEXTURE_2D;return he(t,()=>t.bindTexture(a,o)),he(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)),he(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),he(t,()=>t.texParameteri(a,t.TEXTURE_MIN_FILTER,t.NEAREST)),he(t,()=>t.texParameteri(a,t.TEXTURE_MAG_FILTER,t.NEAREST)),X().getNumber("WEBGL_VERSION")===1?he(t,()=>t.texImage2D(a,0,s,e,n,0,r,i,null)):he(t,()=>t.texStorage2D(a,1,s,e,n)),he(t,()=>t.bindTexture(t.TEXTURE_2D,null)),{texture:o,texShape:[n,e]}}function HW(t){return t.internalFormatFloat}function kve(t,e,n,s){const[r,i]=Gm(e,n);return qm(t,r,i,HW(s),s.textureFormatFloat,t.FLOAT)}function GW(t){return t.internalFormatHalfFloat}function Cve(t,e,n,s){const[r,i]=Gm(e,n);return qm(t,r,i,GW(s),s.textureFormatFloat,s.textureTypeHalfFloat)}function KW(t){return t.downloadTextureFormat}function Nve(t,e,n,s){const[r,i]=Gm(e,n);return qm(t,r,i,KW(s),t.RGBA,t.UNSIGNED_BYTE)}function qW(t){return t.internalFormatPackedFloat}function Tve(t,e,n,s){const[r,i]=eh(e,n);return qm(t,r,i,qW(s),t.RGBA,t.FLOAT)}function XW(t){return t.internalFormatPackedHalfFloat}function Eve(t,e,n,s){const[r,i]=eh(e,n);return qm(t,r,i,XW(s),t.RGBA,s.textureTypeHalfFloat)}function Ive(t,e,n){return he(t,()=>t.bindBuffer(t.ARRAY_BUFFER,n)),QO(t,e,"clipSpacePos",n,3,20,0)&&QO(t,e,"uv",n,2,20,12)}function Ave(t,e,n,s,r,i){he(t,()=>t.bindTexture(t.TEXTURE_2D,e));let o,a,l;r instanceof Uint8Array?(o=new Uint8Array(n*s*4),a=t.UNSIGNED_BYTE,l=t.RGBA):(o=new Float32Array(n*s*4),a=t.FLOAT,l=i.internalFormatPackedFloat),o.set(r),X().getNumber("WEBGL_VERSION")===2?he(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n,s,t.RGBA,a,o)):he(t,()=>t.texImage2D(t.TEXTURE_2D,0,l,n,s,0,t.RGBA,a,o)),he(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function $ve(t,e,n){he(t,()=>t.bindTexture(t.TEXTURE_2D,e)),n.data instanceof Uint8Array?X().getNumber("WEBGL_VERSION")===2?he(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n.width,n.height,t.RGBA,t.UNSIGNED_BYTE,n.data)):he(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n.width,n.height,0,t.RGBA,t.UNSIGNED_BYTE,n.data)):X().getNumber("WEBGL_VERSION")===2?he(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,n)):he(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n)),he(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function Rve(t,e,n,s){const r=t.createBuffer();he(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,r));const a=4*4*e*n;return he(t,()=>t.bufferData(t.PIXEL_PACK_BUFFER,a,t.STREAM_READ)),he(t,()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,0)),he(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,null)),r}function Dve(t,e,n){const s=t,r=new Float32Array(n);return s.bindBuffer(s.PIXEL_PACK_BUFFER,e),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,r),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),r}function Ove(t,e,n,s){const[r,i]=Gm(e,n),o=4,a=new Uint8Array(Jxe(e*n,o));return he(t,()=>t.readPixels(0,0,r,i,s.downloadTextureFormat,t.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function Mve(t,e,n,s,r,i,o,a){const l=t,c=new Float32Array(Yxe(i,o));return l.bindBuffer(l.PIXEL_PACK_BUFFER,e),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,c),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),c}function Pve(t,e,n){const s=new Float32Array(e*n*4);return he(t,()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,s)),s}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ow{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const n=X().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,Kxe(n,e)):this.gl=Mi(n),e=this.gl,X().getNumber("WEBGL_VERSION")===2){const i=e;this.createVertexArray=()=>he(i,()=>i.createVertexArray()),this.bindVertexArray=o=>he(i,()=>i.bindVertexArray(o)),this.deleteVertexArray=o=>he(i,()=>i.deleteVertexArray(o)),this.getVertexArray=()=>he(i,()=>i.getParameter(i.VERTEX_ARRAY_BINDING))}else if(e!=null){const i=e.getExtension("OES_vertex_array_object");if(i==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>he(e,()=>i.createVertexArrayOES()),this.bindVertexArray=o=>he(e,()=>i.bindVertexArrayOES(o)),this.deleteVertexArray=o=>he(e,()=>i.deleteVertexArrayOES(o)),this.getVertexArray=()=>he(e,()=>e.getParameter(i.VERTEX_ARRAY_BINDING_OES))}let s="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),X().getNumber("WEBGL_VERSION")===1){const i="OES_texture_float",o="OES_texture_half_float";if(this.textureFloatExtension=Fg(this.gl,i),Yr(this.gl,o))this.textureHalfFloatExtension=Fg(this.gl,o);else if(X().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(s),Yr(this.gl,r))this.colorBufferHalfFloatExtension=Fg(this.gl,r);else if(X().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(s="EXT_color_buffer_float",Yr(this.gl,s))this.colorBufferFloatExtension=this.gl.getExtension(s);else if(Yr(this.gl,r))this.colorBufferHalfFloatExtension=this.gl.getExtension(r);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=wve(this.gl),this.indexBuffer=Sve(this.gl),this.framebuffer=hbe(this.gl),this.textureConfig=k2(this.gl,this.textureHalfFloatExtension)}get debug(){return X().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;he(e,()=>e.finish()),he(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),he(e,()=>e.deleteFramebuffer(this.framebuffer)),he(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),he(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),he(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,n){return this.throwIfDisposed(),kve(this.gl,e,n,this.textureConfig)}createFloat16MatrixTexture(e,n){return this.throwIfDisposed(),Cve(this.gl,e,n,this.textureConfig)}createUnsignedBytesMatrixTexture(e,n){return this.throwIfDisposed(),Nve(this.gl,e,n,this.textureConfig)}uploadPixelDataToTexture(e,n){this.throwIfDisposed(),$ve(this.gl,e,n)}uploadDenseMatrixToTexture(e,n,s,r){this.throwIfDisposed(),Ave(this.gl,e,n,s,r,this.textureConfig)}createFloat16PackedMatrixTexture(e,n){return this.throwIfDisposed(),Eve(this.gl,e,n,this.textureConfig)}createPackedMatrixTexture(e,n){return this.throwIfDisposed(),Tve(this.gl,e,n,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(ZO(this.gl,this.framebuffer),this.outputTexture=null),he(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,n,s){return this.downloadMatrixDriver(e,()=>Ove(this.gl,n,s,this.textureConfig))}downloadPackedMatrixFromBuffer(e,n,s,r,i,o){return Mve(this.gl,e,n,s,r,i,o,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,n){return Dve(this.gl,e,n)}createBufferFromTexture(e,n,s){this.bindTextureToFrameBuffer(e);const r=Rve(this.gl,n,s,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let n,s;if(X().getBool("WEBGL_FENCE_API_ENABLED")){const r=e,i=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),s=()=>{const o=r.clientWaitSync(i,0,0);return o===r.ALREADY_SIGNALED||o===r.CONDITION_SATISFIED},n=i}else X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(n=this.beginQuery(),this.endQuery(),s=()=>this.isQueryAvailable(n,X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):s=()=>!0;return{query:n,isFencePassed:s}}downloadMatrixFromPackedTexture(e,n,s){return this.downloadMatrixDriver(e,()=>Pve(this.gl,n,s))}createProgram(e){this.throwIfDisposed();const n=this.gl;this.vertexShader==null&&(this.vertexShader=vve(n));const s=obe(n);he(n,()=>n.attachShader(s,this.vertexShader)),he(n,()=>n.attachShader(s,e)),abe(n,s);const r=Object.assign(s,{vao:this.createVertexArray()});return this.debug&&Aw(n,r),r}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const n=this.gl;he(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),Ive(n,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(he(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&Aw(this.gl,this.program),he(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,n,s=!0){return this.throwIfDisposed(),s?pbe(this.gl,e,n):mbe(this.gl,e,n)}getAttributeLocation(e,n){return this.throwIfDisposed(),he(this.gl,()=>this.gl.getAttribLocation(e,n))}getUniformLocationNoThrow(e,n){return this.throwIfDisposed(),this.gl.getUniformLocation(e,n)}setInputMatrixTexture(e,n,s){this.throwIfDisposed(),this.throwIfNoProgram(),gbe(this.gl,e,n,s)}setOutputMatrixTexture(e,n,s){this.setOutputMatrixTextureDriver(e,s,n)}setOutputPackedMatrixTexture(e,n,s){this.throwIfDisposed();const[r,i]=eh(n,s);this.setOutputMatrixTextureDriver(e,r,i)}setOutputMatrixWriteRegion(e,n,s,r){this.setOutputMatrixWriteRegionDriver(s,e,r,n)}setOutputPackedMatrixWriteRegion(e,n,s,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&Aw(this.gl,this.program),_g(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const n=this.getVertexArray();console.assert(n===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}he(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),he(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Fg(this.gl,X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),i=s.createQuery();return s.beginQuery(r.TIME_ELAPSED_EXT,i),i}const e=this.getQueryTimerExtensionWebGL1(),n=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,n),n}endQuery(){if(X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const n=this.gl,s=this.getQueryTimerExtensionWebGL2();n.endQuery(s.TIME_ELAPSED_EXT);return}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await jD(()=>this.disposed||this.isQueryAvailable(e,X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,n){if(n===0)return null;if(n===2){const s=this.gl;return s.getQueryParameter(e,s.QUERY_RESULT)/1e6}else{const s=this.getQueryTimerExtensionWebGL1();return s.getQueryObjectEXT(e,s.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,n){if(n===0)return!0;if(n===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),i=s.getQueryParameter(e,s.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),i&&!this.disjoint}else{const s=this.getQueryTimerExtensionWebGL1(),r=s.getQueryObjectEXT(e,s.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),r&&!this.disjoint}}pollFence(e){return new Promise(n=>{this.addItemToPoll(()=>e.isFencePassed(),()=>n())})}pollItems(){const e=Lve(this.itemsToPoll.map(n=>n.isDoneFn));for(let n=0;n<=e;++n){const{resolveFn:s}=this.itemsToPoll[n];s()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,n){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:n}),this.itemsToPoll.length>1)return;let s;"setTimeoutCustom"in X().platform&&(s=X().platform.setTimeoutCustom.bind(X().platform)),jD(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,s)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),$w(this.gl,e,this.framebuffer),this.debug&&_g(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?($w(this.gl,this.outputTexture,this.framebuffer),this.debug&&_g(this.gl)):ZO(this.gl,this.framebuffer)}downloadMatrixDriver(e,n){this.bindTextureToFrameBuffer(e);const s=n();return this.unbindTextureToFrameBuffer(),s}setOutputMatrixTextureDriver(e,n,s){this.throwIfDisposed();const r=this.gl;$w(r,e,this.framebuffer),this.debug&&_g(r),this.outputTexture=e,he(r,()=>r.viewport(0,0,n,s)),he(r,()=>r.scissor(0,0,n,s))}setOutputMatrixWriteRegionDriver(e,n,s,r){this.throwIfDisposed(),he(this.gl,()=>this.gl.scissor(e,n,s,r))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function Lve(t){let e=0;for(;e<t.length&&t[e]();++e);return e-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:Fve,bincountImpl:JW,bincountReduceImpl:_ve,bitwiseAndImpl:zve,castImpl:Bve,ceilImpl:jve,concatImpl:Vve,equalImpl:Uve,expImpl:Wve,expm1Impl:Hve,floorImpl:Gve,gatherNdImpl:Kve,gatherV2Impl:qve,greaterImpl:Xve,greaterEqualImpl:Jve,lessImpl:Yve,lessEqualImpl:Qve,linSpaceImpl:Zve,logImpl:e1e,maxImpl:t1e,maximumImpl:n1e,minimumImpl:s1e,multiplyImpl:r1e,negImpl:i1e,notEqualImpl:o1e,prodImpl:a1e,raggedGatherImpl:l1e,raggedRangeImpl:c1e,raggedTensorToTensorImpl:u1e,rangeImpl:d1e,rsqrtImpl:h1e,scatterImpl:f1e,sigmoidImpl:p1e,simpleAbsImpl:YW,sliceImpl:m1e,sparseFillEmptyRowsImpl:g1e,sparseReshapeImpl:y1e,sparseSegmentReductionImpl:QW,sqrtImpl:x1e,staticRegexReplaceImpl:b1e,stridedSliceImpl:v1e,stringNGramsImpl:w1e,stringSplitImpl:S1e,stringToHashBucketFastImpl:k1e,subImpl:C1e,tileImpl:N1e,topKImpl:T1e,transposeImpl:E2,uniqueImpl:E1e}=$pe;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZW(t,e){return["x","y","z","w","u","v"].slice(0,e).map(n=>`${t}.${n}`)}function xs(t,e){return e===1?[t]:ZW(t,e)}function I1e(t,e){if(t===1)return"rc";let n="";for(let s=0;s<t;s++)n+=e[s],s<t-1&&(n+=",");return n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class A1e{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=ls(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const n=xs("rc",this.rank),s=gt(this.rank),r=this.getOutOfBoundsCondition(n),i=this.getSetup(n),o=this.getOutput(n);this.userCode=`
        void main() {
          ${s} rc = getOutputCoords();

          if(${r}) {
            setOutput(vec4(0));
          } else {
            ${i}

            setOutput(vec4(${o}));
          }
        }
      `}}getSourceCoordsArr(e){const n=[];for(let s=0;s<=1;s++)for(let r=0;r<=1;r++){let i=`${s===0?"r":"rp1"}, ${r===0?"c":"cp1"}`;for(let o=2;o<this.rank;o++)i=`${e[e.length-1-o]},`+i;n.push(i)}return n}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let n="";for(let s=this.rank-2;s<this.rank;s++)n+=`${e[s]} >= ${this.enableShapeUniforms?`outShape[${s}]`:this.outputShape[s]}`,s<this.rank-1&&(n+="||");return n}getSetup(e){if(this.rank===1)return"";const n=e.slice(-2),s=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],r=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${n[0]};
      int c = ${n[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${s};
      bool rEdge = rp1 >= ${r};
    `}getOutput(e){const n=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${n[0]}),
            cEdge ? 0. : getA(${n[1]}),
            rEdge ? 0. : getA(${n[2]}),
            rEdge || cEdge ? 0. : getA(${n[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class e5{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=ls(this.outputShape.length);let s="";for(let r=0;r<4;r++){let i="thisRC = rc;";r%2===1&&(i+="thisRC.z += 1;"),r>1&&(i+="thisRC.y += 1;"),s+=`
        ${i}
        ${r>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${r}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${r>0?"}":""}
      `}this.userCode=`
      ${$1e(n,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?N2():C2(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${s}

        setOutput(result);
      }
    `}}function $1e(t,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?Ibe(["r","c","d"],"inputShape"):su(["r","c","d"],t)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class R1e{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,n,s){const r=rM(n,s),i=iM(e,r,s);i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]);const o=sM(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,s);if(this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();const l=this.freeTextures[i].pop();return this.usedTextures[i].push(l),l}let a;return r===zn.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===zn.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===zn.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===zn.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===zn.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[i].push(a),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),a}releaseTexture(e,n,s,r){if(this.freeTextures==null)return;const i=rM(s,r),o=iM(n,i,r);o in this.freeTextures||(this.freeTextures[o]=[]);const a=sM(n,i,this.gpgpu.gl,this.gpgpu.textureConfig,r),l=X().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");l!==-1&&this._numBytesAllocated>l?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=a):(this.freeTextures[o].push(e),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;const c=this.usedTextures[o],u=c&&c.indexOf(e);if(u==null||u<0)throw new Error("Cannot release a texture that was never provided by this texture manager");c[u]=c[c.length-1],c.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const n=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*n)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const e in this.freeTextures)this.freeTextures[e].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function D1e(t,e){const n=t;if(e===n.R32F)return 4;if(e===n.R16F)return 2;if(e===n.RGBA32F)return 16;if(e===t.RGBA)return 16;if(e===n.RGBA16F)return 8;if(e===n.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function sM(t,e,n,s,r){const i=O1e(e,s);let o;if(r){const[l,c]=eh(t[0],t[1]);o=l*c}else{const[l,c]=Gm(t[0],t[1]);o=l*c}const a=D1e(n,i);return o*a}function O1e(t,e){switch(t){case zn.PACKED_2X2_FLOAT32:return qW(e);case zn.PACKED_2X2_FLOAT16:return XW(e);case zn.UNPACKED_FLOAT32:return HW(e);case zn.UNPACKED_FLOAT16:return GW(e);case zn.PACKED_4X1_UNSIGNED_BYTE:return KW(e);default:throw new Error(`Unknown physical texture type ${t}`)}}function M1e(t){return X().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?zn.PACKED_2X2_FLOAT32:zn.UNPACKED_FLOAT32:t?zn.PACKED_2X2_FLOAT16:zn.UNPACKED_FLOAT16}function rM(t,e){if(t===br.UPLOAD)return zn.PACKED_2X2_FLOAT32;if(t===br.RENDER||t==null)return M1e(e);if(t===br.DOWNLOAD||t===br.PIXELS)return zn.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${t}`)}function iM(t,e,n){return`${t[0]}_${t[1]}_${e}_${n}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class to{constructor(e,n){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=ls(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${n}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const ci="if (isnan(x)) return x;",P1e="return x;",oM="return abs(x);",L1e="return (x >= 0.0) ? x : (exp(x) - 1.0);",F1e=ci+`
  return (x < 0.0) ? 0.0 : x;
`,_1e=ci+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,va="return x;",z1e="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B1e="return x;",j1e=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,V1e=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,U1e=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,W1e="return 1.0 / (1.0 + exp(-1.0 * x));";class Oa{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=ls(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${n}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class H1e{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=ls(this.outputShape.length);const n=e.length,s=xs("rc",n),r=gt(n),i=I1e(n,s),o=s.slice(-2),a=n<=1?"rc":`vec2(${o.join(",")})`;this.userCode=`
      void main() {
        ${r} rc = getOutputCoords();
        vec4 packedInput = getA(${i});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const G1e=Sj,K1e=1e-7,q1e=1e-4,jg={};function X1e(t){return t in jg||(jg[t]={}),jg[t]}const J1e=X().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),Y1e=600;function Q1e(){return X().global.screen==null?1024:X().global.screen.height*X().global.screen.width*window.devicePixelRatio*Y1e/1024/1024}class Yv extends jT{nextDataId(){return Yv.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!X().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let n;if(e!=null){if(e instanceof Ow)n=e;else{const s=Mi(X().getNumber("WEBGL_VERSION"),e);n=new Ow(s)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const s=Mi(X().getNumber("WEBGL_VERSION"));n=new Ow(s),this.binaryCache=X1e(X().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=n,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new R1e(this.gpgpu),this.numMBBeforeWarning=Q1e(),this.texData=new Uz(this,Ui())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,n,s,r,i,o){const a=this.makeTensorInfo(n,s),l=this.texData.get(a.dataId);l.isPacked=!1,l.texture={texture:e,texShape:[r,i]},l.texShape=[r,i];const c=zg(n),u=new nM(c,!1,o),d=this.runWebGLProgram(u,[a],s,[[r,i]]);return d.shape=n,l.texture=null,this.disposeIntermediateTensorInfo(a),d.dataId}write(e,n,s){if((X().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||X().getBool("DEBUG"))&&this.checkNumericalProblems(e),s==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={id:this.nextDataId()};return this.texData.set(r,{shape:n,dtype:s,values:e,usage:br.UPLOAD,refCount:1}),r}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){const n=this.texData.get(e);n.refCount++}decRef(e){if(this.texData.has(e)){const n=this.texData.get(e);n.refCount--}}move(e,n,s,r,i){if(X().getBool("DEBUG")&&this.checkNumericalProblems(n),r==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:s,dtype:r,values:n,usage:br.UPLOAD,refCount:i})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const n=this.texData.get(e),{values:s,dtype:r,complexTensorInfos:i,slice:o,shape:a,isPacked:l}=n;if(o!=null){let h;l?h=new Oa(a,va):h=new to(a,va);const f=this.runWebGLProgram(h,[{dataId:e,shape:a,dtype:r}],r),p=this.readSync(f.dataId);return this.disposeIntermediateTensorInfo(f),p}if(s!=null)return this.convertAndCacheOnCPU(e);if(r==="string")return s;const c=this.activeTimers!=null;let u;c&&(u=$s());let d;if(r==="complex64"){const h=this.readSync(i.real.dataId),f=this.readSync(i.imag.dataId);d=ra(h,f)}else d=this.getValuesFromTexture(e);return c&&(this.downloadWaitMs+=$s()-u),this.convertAndCacheOnCPU(e,d)}async read(e){if(this.pendingRead.has(e)){const p=this.pendingRead.get(e);return new Promise(m=>p.push(m))}const n=this.texData.get(e),{values:s,shape:r,slice:i,dtype:o,complexTensorInfos:a,isPacked:l}=n;if(i!=null){let p;l?p=new Oa(r,va):p=new to(r,va);const m=this.runWebGLProgram(p,[{dataId:e,shape:r,dtype:o}],o),g=this.read(m.dataId);return this.disposeIntermediateTensorInfo(m),g}if(s!=null)return this.convertAndCacheOnCPU(e);if(X().getBool("DEBUG")&&!X().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&X().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let c=null,u;if(o!=="complex64"&&X().get("WEBGL_BUFFER_SUPPORTED")){u=this.decode(e);const p=this.texData.get(u.dataId);c=this.gpgpu.createBufferFromTexture(p.texture.texture,...Lg(r))}this.pendingRead.set(e,[]),o!=="complex64"&&await this.gpgpu.createAndWaitForFence();let d;if(o==="complex64"){const p=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]),m=p[0],g=p[1];d=ra(m,g)}else if(c==null)d=this.getValuesFromTexture(e);else{const p=Q(r);d=this.gpgpu.downloadFloat32MatrixFromBuffer(c,p)}if(u!=null&&this.disposeIntermediateTensorInfo(u),c!=null){const p=this.gpgpu.gl;he(p,()=>p.deleteBuffer(c))}const h=this.convertAndCacheOnCPU(e,d),f=this.pendingRead.get(e);return this.pendingRead.delete(e),f.forEach(p=>p(h)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&Ui().removeDataId(e,this),this.pendingDeletes--),h}readToGPU(e,n={}){const s=this.texData.get(e),{values:r,shape:i,slice:o,dtype:a,isPacked:l,texture:c}=s;if(a==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(o!=null){let f;l?f=new Oa(i,va):f=new to(i,va);const p=this.runWebGLProgram(f,[{dataId:e,shape:i,dtype:a}],a),m=this.readToGPU(p,n);return this.disposeIntermediateTensorInfo(p),m}if(c==null)throw r!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const u=this.decode(e,n.customTexShape),d=Ui().makeTensorFromTensorInfo(u),h=this.texData.get(u.dataId);return Object.assign({tensorRef:d},h.texture)}bufferSync(e){const n=this.readSync(e.dataId);if(e.dtype==="string")try{const s=n.map(r=>ol(r));return He(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return He(e.shape,e.dtype,n)}checkNumericalProblems(e){if(e!=null)for(let n=0;n<e.length;n++){const s=e[n];if(!tbe(s))throw X().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${s} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${s} cannot be represented on this device.`)}}getValuesFromTexture(e){const{shape:n,dtype:s,isPacked:r}=this.texData.get(e),i=Q(n);if(X().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const h=this.decode(e),f=this.texData.get(h.dataId),p=this.gpgpu.downloadMatrixFromPackedTexture(f.texture.texture,...Lg(n)).subarray(0,i);return this.disposeIntermediateTensorInfo(h),p}const o=X().getBool("WEBGL_PACK")&&r===!0,a=o?zg(n):n,l=o?new yve(a):new gve(a),c=this.runWebGLProgram(l,[{shape:a,dtype:s,dataId:e}],"float32"),u=this.texData.get(c.dataId),d=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(u.texture.texture,u.texShape[0],u.texShape[1]).subarray(0,i);return this.disposeIntermediateTensorInfo(c),d}timerAvailable(){return X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const n=this.activeTimers,s=[];let r=!1;this.programTimersStack==null?(this.programTimersStack=s,r=!0):this.activeTimers.push(s),this.activeTimers=s,e();const i=Nc(this.activeTimers.map(l=>l.query)).filter(l=>l!=null),o=Nc(this.activeTimers.map(l=>l.name)).filter(l=>l!=null);this.activeTimers=n,r&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const l=await Promise.all(i);a.kernelMs=bne(l),a.getExtraProfileInfo=()=>l.map((c,u)=>({name:o[u],ms:c})).map(c=>`${c.name}: ${c.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:$s(),endMs:null}}endTimer(e){return X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=$s(),e)}async getQueryTime(e){if(X().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const n=e;return n.endMs-n.startMs}disposeData(e,n=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(n?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!n&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:s}=this.texData.get(e);return s!=null&&(this.disposeData(s.real.dataId,n),this.disposeData(s.imag.dataId,n)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:n,dtype:s,texShape:r,usage:i,isPacked:o,slice:a}=this.texData.get(e),l=a&&a.origDataId||e,c=this.dataRefCount.get(l);c>1?this.dataRefCount.set(l,c-1):(this.dataRefCount.delete(l),n!=null&&(this.numBytesInGPU-=this.computeBytes(r,s),this.textureManager.releaseTexture(n,r,i,o)));const u=this.texData.get(e);u.texture=null,u.texShape=null,u.isPacked=!1,u.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,n=J1e){return X().getBool("WEBGL_CPU_FORWARD")&&e.every(s=>this.texData.get(s.dataId).texture==null&&Q(s.shape)<n)}getGPGPUContext(){return this.gpgpu}where(e){gr("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const n=e.dataSync();return G1e(e.shape,n)}packedUnaryOp(e,n,s){const r=new Oa(e.shape,n),i=this.compileAndRun(r,[e],s);return Ui().makeTensorFromTensorInfo(i)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){const r=YW(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,r)}if(X().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,oM,e.dtype);const n=new to(e.shape,oM),s=this.compileAndRun(n,[e]);return Ui().makeTensorFromTensorInfo(s)}makeTensorInfo(e,n,s){let r;if(n==="string"&&s!=null&&s.length>0&&Op(s[0])){const i=s.map(o=>Xa(o));r=this.write(i,e,n)}else r=this.write(s,e,n);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:n}}makeOutput(e,n,s){return Ui().makeTensorFromTensorInfo(this.makeTensorInfo(e,n,s),this)}unpackTensor(e){const n=new H1e(e.shape);return this.runWebGLProgram(n,[e],e.dtype)}packTensor(e){const n=new A1e(e.shape),s=!0;return this.runWebGLProgram(n,[e],e.dtype,null,s)}packedReshape(e,n){const s=[Rd(e.shape),...Dd(e.shape)],r={dtype:e.dtype,shape:s,dataId:e.dataId},i=[Rd(n),...Dd(n)],o=new e5(i,s),a=!0,l=[s],c=this.runWebGLProgram(o,[r],e.dtype,l,a);return{dataId:c.dataId,shape:n,dtype:c.dtype}}decode(e,n){const s=this.texData.get(e),{isPacked:r,shape:i,dtype:o}=s;if(n!=null){const h=Q(i),f=n[0]*n[1]*4;E(h<=f,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const a=zg(i);let l;r?l=new mve(a):l=new pve(a);const c=!0,u=[n??Lg(a)],d=this.runWebGLProgram(l,[{shape:a,dtype:o,dataId:e}],o,u,c,n);return{dtype:o,shape:i,dataId:d.dataId}}runWebGLProgram(e,n,s,r,i=!1,o){const a=this.makeTensorInfo(e.outputShape,s),l=this.texData.get(a.dataId);if(e.packedOutput&&(l.isPacked=!0),e.outPackingScheme===ip.DENSE){const y=o??Lg(e.outputShape);l.texShape=y.map(x=>x*2)}if(e.outTexUsage!=null&&(l.usage=e.outTexUsage),Q(a.shape)===0)return l.values=ns(a.dtype,0),a;const c=[],u=n.map(y=>{if(y.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let x=this.texData.get(y.dataId);if(x.texture==null){if(!e.packedInputs&&Q(y.shape)<=X().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:y.shape,texData:null,isUniform:!0,uniformValues:x.values};e.packedInputs&&(x.isPacked=!0,x.shape=y.shape)}if(this.uploadToGPU(y.dataId),!!x.isPacked!=!!e.packedInputs)y=x.isPacked?this.unpackTensor(y):this.packTensor(y),c.push(y),x=this.texData.get(y.dataId);else if(x.isPacked&&!J0(x.shape,y.shape)){const v=y,w=y.shape;y.shape=x.shape,y=this.packedReshape(y,w),c.push(y),x=this.texData.get(y.dataId),v.shape=w}return{shape:y.shape,texData:x,isUniform:!1}});this.uploadToGPU(a.dataId);const d={shape:a.shape,texData:l,isUniform:!1},h=fve(e,u,d),f=this.getAndSaveBinary(h,()=>dve(this.gpgpu,e,u,d)),p=this.activeTimers!=null;let m;p&&(m=this.startTimer()),X().get("ENGINE_COMPILE_ONLY")||hve(this.gpgpu,f,u,d,r),c.forEach(y=>this.disposeIntermediateTensorInfo(y)),p&&(m=this.endTimer(m),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(m)}));const g=X().getNumber("WEBGL_FLUSH_THRESHOLD");if(g>0){const y=$s();y-this.lastGlFlushTime>g&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=y)}if(!X().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&i===!1){const y=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),y}return a}compileAndRun(e,n,s,r,i=!1){return s=s||n[0].dtype,this.runWebGLProgram(e,n,s,r,i)}getAndSaveBinary(e,n){return e in this.binaryCache||(this.binaryCache[e]=n()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(X().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(n=>{this.gpgpu.deleteProgram(this.binaryCache[n].webGLProgram),delete this.binaryCache[n]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=q(()=>{if(!X().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=X().getBool("DEBUG");X().set("DEBUG",!1);const n=this.abs(lt(1e-8)).dataSync()[0];if(X().set("DEBUG",e),n>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?K1e:q1e}uploadToGPU(e){const n=this.texData.get(e),{shape:s,dtype:r,values:i,texture:o,usage:a,isPacked:l}=n;if(o!=null)return;const c=this.activeTimers!=null;let u;c&&(u=$s());let d=n.texShape;if(d==null&&(d=bbe(s,l),n.texShape=d),i!=null){const h=zg(s);let f,p=d[1],m=d[0];const g=i instanceof Uint8Array||i instanceof Uint8ClampedArray;(l||!g)&&([p,m]=eh(d[0],d[1])),l?f=new bve(h,g):f=new nM(h,g);const y=g?[m,p]:d,x=this.makeTensorInfo(y,r),v=this.texData.get(x.dataId);g?v.usage=br.PIXELS:v.usage=br.UPLOAD,v.texShape=y,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(x.dataId),p,m,i);const w=[[m,p]],S=!0,k=this.runWebGLProgram(f,[x],r,w,S),C=this.texData.get(k.dataId);n.texShape=C.texShape,n.isPacked=C.isPacked,n.usage=C.usage,X().get("ENGINE_COMPILE_ONLY")?this.disposeData(k.dataId):(n.texture=C.texture,n.values=null,this.texData.delete(k.dataId)),this.disposeIntermediateTensorInfo(x),c&&(this.uploadWaitMs+=$s()-u)}else{const h=this.acquireTexture(d,a,r,l);n.texture=h}}convertAndCacheOnCPU(e,n){const s=this.texData.get(e),{dtype:r}=s;return n!=null&&(s.values=Z1e(n,r)),s.values}acquireTexture(e,n,s,r){if(this.numBytesInGPU+=this.computeBytes(e,s),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const i=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${i} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,n,r)}computeBytes(e,n){return e[0]*e[1]*k0(n)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,n]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(n));return Promise.all(e)}else{for(const[,n]of Object.entries(this.binaryCache)){const s=new Promise(r=>{try{this.checkCompletion_(n),r(!0)}catch(i){throw i}});e.push(s)}return Promise.all(e)}}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await jj(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(zW(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:n,customUniformLocations:s,infLoc:r,nanLoc:i,outShapeLocation:o,outShapeStridesLocation:a,outTexShapeLocation:l}=WW(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=n,e.customUniformLocations=s,e.infLoc=r,e.nanLoc=i,e.outShapeLocation=o,e.outShapeStridesLocation=a,e.outTexShapeLocation=l}}createTensorFromGPUData(e,n,s){e.channels=e.channels||"RGBA";const{texture:r,height:i,width:o,channels:a}=e,l=Ui().backend;if(!l.gpgpu.gl.isTexture(r))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const c=l.writeTexture(r,n,s,i,o,a);return Ui().makeTensorFromDataId(c,n,s,l)}}Yv.nextDataId=0;function Z1e(t,e){if(e==="float32"||e==="complex64")return t;if(e==="int32"||e==="bool"){const n=e==="int32"?new Int32Array(t.length):new Uint8Array(t.length);for(let s=0;s<n.length;++s)n[s]=Math.round(t[s]);return n}else throw new Error(`Unknown dtype ${e}`)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */LB()&&zB("webgl",()=>new Yv,2);/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I2=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class _c{constructor(e,n,s){this.variableNames=["A","B"],this.outputShape=_e(n,s),this.enableShapeUniforms=ls(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iu=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class ih{constructor(e,n,s,r=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=_e(n,s);const i=this.outputShape.length;this.enableShapeUniforms=ls(i);let o="";if(r)if(i===0||Q(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(o=`
          ${gt(i)} coords = getOutputCoords();
        `,i===1)this.enableShapeUniforms?o+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:o+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const l=xs("coords",i);this.enableShapeUniforms?o+=`
            bool nextRowOutOfBounds =
              (${l[i-2]} + 1) >= outShape[${i} - 2];
            bool nextColOutOfBounds =
              (${l[i-1]} + 1) >= outShape[${i} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:o+=`
            bool nextRowOutOfBounds =
              (${l[i-2]} + 1) >= ${this.outputShape[i-2]};
            bool nextColOutOfBounds =
              (${l[i-1]} + 1) >= ${this.outputShape[i-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${o}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ur(t){const{inputs:e,backend:n}=t,{x:s}=e;return n.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const ewe={kernelName:em,backendName:"webgl",kernelFunc:ur};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Al(t){const{inputs:e,backend:n}=t,{real:s,imag:r}=e,i=n.makeTensorInfo(s.shape,"complex64"),o=n.texData.get(i.dataId),a=ur({inputs:{x:s},backend:n}),l=ur({inputs:{x:r},backend:n});return o.complexTensorInfos={real:a,imag:l},i}const twe={kernelName:eE,backendName:"webgl",kernelFunc:Al};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t5="return (a < 0.) ? b * a : a;",n5=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function nwe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{alpha:i}=s,o=n.makeTensorInfo([],"float32",vl(i,"float32")),a=X().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ih(n5,r.shape,o.shape):new _c(t5,r.shape,o.shape),l=n.runWebGLProgram(a,[r,o],"float32");return n.disposeIntermediateTensorInfo(o),l}const swe={kernelName:Hb,backendName:"webgl",kernelFunc:nwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s5="return (a < 0.) ? b * a : a;",r5=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function rwe(t){const{inputs:e,backend:n}=t,{x:s,alpha:r}=e,i=X().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ih(r5,s.shape,r.shape):new _c(s5,s.shape,r.shape);return n.runWebGLProgram(i,[s,r],"float32")}const iwe={kernelName:uv,backendName:"webgl",kernelFunc:rwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oh="if (isnan(x)) return x;";function rt({opSnippet:t,packedOpSnippet:e,cpuKernelImpl:n,dtype:s}){return({inputs:r,backend:i})=>{const{x:o}=r,a=i,l=s||o.dtype;if(a.shouldExecuteOnCPU([o])&&n!=null){const d=a.texData.get(o.dataId),h=n(d.values,l);return a.makeTensorInfo(o.shape,l,h)}const c=X().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null;let u;return c?u=new Oa(o.shape,e):u=new to(o.shape,t),a.runWebGLProgram(u,[o],l)}}function Gn({opSnippet:t,packedOpSnippet:e,checkOutOfBounds:n=!1,supportsComplex:s=!1,cpuKernelImpl:r,dtype:i}){return({inputs:o,backend:a})=>{const{a:l,b:c}=o,u=a;if(s&&l.dtype==="complex64"){const p=u.texData.get(l.dataId),m=u.texData.get(c.dataId),[g,y]=[[p.complexTensorInfos.real,m.complexTensorInfos.real],[p.complexTensorInfos.imag,m.complexTensorInfos.imag]].map(v=>{const[w,S]=v,k={dataId:w.dataId,dtype:w.dtype,shape:l.shape},C={dataId:S.dataId,dtype:S.dtype,shape:c.shape},N=new _c(t,l.shape,c.shape);return u.runWebGLProgram(N,[k,C],lr(w.dtype,S.dtype))}),x=Al({inputs:{real:g,imag:y},backend:u});return u.disposeIntermediateTensorInfo(g),u.disposeIntermediateTensorInfo(y),x}const d=i||lr(l.dtype,c.dtype);if((l.dtype==="string"||c.dtype==="string"||u.shouldExecuteOnCPU([l,c]))&&r!=null){const p=u.texData.get(l.dataId).values,m=u.texData.get(c.dataId).values,g=l.dtype==="string"?ia(p):p,y=l.dtype==="string"?ia(m):m,[x,v]=r(l.shape,c.shape,g,y,d),w=u.makeTensorInfo(v,d),S=u.texData.get(w.dataId);return S.values=x,w}const h=X().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null;let f;return h?f=new ih(e,l.shape,c.shape,n):f=new _c(t,l.shape,c.shape),u.runWebGLProgram(f,[l,c],d)}}function op(t,e=!1){if(t==="linear")return e?B1e:P1e;if(t==="relu")return e?V1e:F1e;if(t==="elu")return e?j1e:L1e;if(t==="relu6")return e?U1e:_1e;if(t==="prelu")return e?r5:s5;if(t==="leakyrelu")return e?n5:t5;if(t==="sigmoid")return e?W1e:z1e;throw new Error(`Activation ${t} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class i5{constructor(e,n,s,r=!1,i=!1,o=!1,a=null,l=!1,c=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s,this.enableShapeUniforms=ls(this.outputShape.length);const u=r?e[1]:e[2],d=Math.ceil(u/2),h=r?"i * 2, rc.y":"rc.y, i * 2",f=i?"rc.z, i * 2":"i * 2, rc.z",p=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],m=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let g="",y="";a&&(l?g=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:c?g=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:g=`vec4 activation(vec4 x) {
          ${a}
        }`,y="result = activation(result);");const x=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");let v="rc.x",w="rc.x";e[0]<n[0]?v=`imod(rc.x, ${e[0]})`:n[0]<e[0]&&(w=`imod(rc.x, ${n[0]})`),this.userCode=`
      ${g}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${d}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${v};
        int batchB = ${w};
        for (int i = 0; i < ${d}; i++) {
          vec4 a = getMatrixA(batchA, ${h});
          vec4 b = getMatrixB(batchB, ${f});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${p[0]} * ${m[0]});
          result += (${p[1]} * ${m[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${x}

        ${y}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aM={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class lM{constructor(e,n,s){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=_e(n,s),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cM="return a * b;";function A2(t){const{inputs:e,backend:n}=t,{a:s,b:r}=e,i=lr(s.dtype,r.dtype);if(s.dtype==="complex64"){const a=n.texData.get(s.dataId),l=n.texData.get(r.dataId),c=new lM(aM.REAL,s.shape,r.shape),u=new lM(aM.IMAG,s.shape,r.shape),d=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:s.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:s.shape},{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:r.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:r.shape}],h=n.runWebGLProgram(c,d,"float32"),f=n.runWebGLProgram(u,d,"float32"),p=Al({inputs:{real:h,imag:f},backend:n});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),p}if(n.shouldExecuteOnCPU([s,r])){const a=n.texData.get(s.dataId),l=n.texData.get(r.dataId),[c,u]=r1e(s.shape,r.shape,a.values,l.values,i),d=n.makeTensorInfo(u,i),h=n.texData.get(d.dataId);return h.values=c,d}let o;return X().getBool("WEBGL_PACK_BINARY_OPERATIONS")?o=new ih(cM,s.shape,r.shape):o=new _c(cM,s.shape,r.shape),n.runWebGLProgram(o,[s,r],i)}const owe={kernelName:cm,backendName:"webgl",kernelFunc:A2};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function awe(t,e,n){const s=[Rd(t.shape),...Dd(t.shape)],r={dtype:t.dtype,shape:s,dataId:t.dataId},i=[Rd(e),...Dd(e)],o=new e5(i,s),a=!0,l=[s],c=n.runWebGLProgram(o,[r],t.dtype,l,a);return{dataId:c.dataId,shape:e,dtype:c.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ue(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{shape:i}=s,o=n,a=Q(r.shape),l=Hz(i,a),c=Q(l);E(a===c,()=>`The new shape (${l}) has ${c} elements and the old shape (${r.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);const u=o.texData.get(r.dataId);return u.isPacked&&!J0(r.shape,l)&&!(u.texture!==null&&J0(u.shape,l))?awe(r,l,o):(o.incRef(r.dataId),{dataId:r.dataId,shape:l,dtype:r.dtype})}const lwe={kernelName:hv,backendName:"webgl",kernelFunc:ue};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uM{constructor(e,n){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:i,outSize:o}=e;this.outputShape=[r,o];const a=Math.floor(s/4)*4,l=s%4;let c="sumValue += dot(values, ones);";if(n!=null){const d=1/n;c=`sumValue += dot(values * ${wd(d)?d.toPrecision(2):d}, ones);`}let u="";i%s>0&&(u=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${u}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${c}
        }

        int inIdx = inOffset + ${a};
        if (${l===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${c}
        } else if (${l===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${c}
        } else if (${l===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${c}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cwe{constructor(e,n){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:i,outSize:o}=e;this.outputShape=[r,o];let a="0.0",l="";n==="prod"?a="1.0":n==="min"?(a="1.0 / 1e-20",l="min"):n==="max"&&(a="-1.0 / 1e-20",l="max");let c=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="sum"?c="sumValue":n==="prod"?c="prodValue":n==="all"?c="allValue":n==="any"&&(c="anyValue");const u=Math.floor(s/4)*4,d=s%4;let h=`
      if (${n==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${n==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${l}(values, minMaxValue);
        if (${n==="min"} || ${n==="max"}) {
          minMaxValue = ${l}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,f="vec4";n==="all"?(a="1.0",h=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,f="bvec4"):n==="any"&&(a="0.0",h=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,f="bvec4");let p="";i%s>0&&(p=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${p}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${u}; i += 4) {
          int inIdx = inOffset + i;
          ${f} values = ${f}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${h}
        }

        int inIdx = inOffset + ${u};
        if (${d===1}) {
          ${f} values = ${f}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${h}
        } else if (${d===2}) {
          ${f} values = ${f}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${h}
        } else if (${d===3}) {
          ${f} values = ${f}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${h}
        }
        setOutput(${c});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uwe(t){const e=[];for(;e.length===0||e[e.length-1].outSize!==1;){const n=e.length?e[e.length-1].outSize:t[1],s=Pv(n);e.push({inSize:n,windowSize:s,outSize:Math.ceil(n/s)})}return e}function ou(t,e,n,s){const r=uwe(t.shape);let i=t;for(let o=0;o<r.length;o++){const{inSize:a,windowSize:l,outSize:c}=r[o];let u,d;n==="mean"?u=o===0?new uM({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:c},a):new uM({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:c}):u=new cwe({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:c},n),d=i,i=s.runWebGLProgram(u,[i],e),d.dataId!==t.dataId&&s.disposeIntermediateTensorInfo(d)}return i}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dwe{constructor(e,n){this.variableNames=["A"];const s=new Array(e.length);for(let o=0;o<s.length;o++)s[o]=e[n[o]];this.outputShape=s,this.rank=s.length;const r=gt(this.rank),i=hwe(n);this.userCode=`
    void main() {
      ${r} resRC = getOutputCoords();
      setOutput(getA(${i}));
    }
    `}}function hwe(t){const e=t.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],s=new Array(e);for(let r=0;r<t.length;r++)s[t[r]]=n[r];return s.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fwe{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const s=new Array(e.length);for(let u=0;u<s.length;u++)s[u]=e[n[u]];if(this.outputShape=s,this.rank=s.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const r=gt(this.rank),i=ZW("rc",this.rank),o=new Array(this.rank);for(let u=0;u<n.length;u++)o[n[u]]=i[u];const a=`vec2(${o.slice(-2).join()})`,l=`++${i[this.rank-1]} < ${s[this.rank-1]}`,c=`getChannel(getA(${o.join()}), ${a})`;this.userCode=`
    void main() {
      ${r} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${c};
      if(${l}) {
        result[1] = ${c};
      }
      --${i[this.rank-1]};
      if(++${i[this.rank-2]} < ${s[this.rank-2]}) {
        result[2] = ${c};
        if(${l}) {
          result[3] = ${c};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qv(t,e,n){const s=X().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new fwe(t.shape,e):new dwe(t.shape,e);return n.runWebGLProgram(s,[t],t.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pwe(t,e,n,s){const r=e,i=t.shape.length,o=Ge(r,t.shape);let a=o;const l=Bt(a,i),c=l!=null;let u=t;c&&(u=Qv(t,l,s),a=nn(a.length,i)),Hn("sum",a,i);const[d,h]=Dn(u.shape,a);let f=d;n&&(f=cn(d,o));const p=Q(h),g=Q(t.shape)/p,y=ue({inputs:{x:u},attrs:{shape:[g,p]},backend:s}),x=PE(t.dtype),v=ou(y,x,"sum",s),w=ue({inputs:{x:v},attrs:{shape:f},backend:s});return s.disposeIntermediateTensorInfo(y),s.disposeIntermediateTensorInfo(v),c&&s.disposeIntermediateTensorInfo(u),w}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zv(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s;return pwe(r,i,o,n)}const mwe={kernelName:xv,backendName:"webgl",kernelFunc:Zv};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ks(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{perm:i}=s,o=n,a=r.shape.length,l=new Array(a);for(let u=0;u<l.length;u++)l[u]=r.shape[i[u]];let c;if(o.shouldExecuteOnCPU([r])){const d=o.texData.get(r.dataId).values,h=E2(d,r.shape,r.dtype,i,l);c=o.makeTensorInfo(l,r.dtype);const f=o.texData.get(c.dataId);f.values=h}else c=Qv(r,i,o);return c}const gwe={kernelName:nd,backendName:"webgl",kernelFunc:ks};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o5=1e3;function Y0({a:t,b:e,transposeA:n,transposeB:s,backend:r,bias:i=null,preluActivationWeights:o=null,leakyreluAlpha:a=0,activation:l=null}){const c=t.shape.length,u=e.shape.length,d=n?t.shape[c-2]:t.shape[c-1],h=s?e.shape[u-1]:e.shape[u-2],f=n?t.shape[c-1]:t.shape[c-2],p=s?e.shape[u-2]:e.shape[u-1],m=t.shape.slice(0,-2),g=e.shape.slice(0,-2),y=Q(m),x=Q(g),w=_e(t.shape.slice(0,-2),e.shape.slice(0,-2)).concat([f,p]);E(d===h,()=>`Error in matMul: inner shapes (${d}) and (${h}) of Tensors with shapes ${t.shape} and ${e.shape} and transposeA=${n} and transposeB=${s} must match.`);const S=n?[y,d,f]:[y,f,d],k=s?[x,p,h]:[x,h,p],C=ue({inputs:{x:t},backend:r,attrs:{shape:S}}),N=ue({inputs:{x:e},backend:r,attrs:{shape:k}}),T=[C,N],I=Math.max(y,x),D=n?C.shape[1]:C.shape[2],F=i!=null,A=o!=null,O=l==="leakyrelu",P=l!=null?op(l,!0):null,L=F||A||O||P!=null;let G;if((f===1||p===1)&&D>o5&&L===!1){let U=C,K=N;n&&(U=ks({inputs:{x:C},backend:r,attrs:{perm:[0,2,1]}}),T.push(U)),s&&(K=ks({inputs:{x:N},backend:r,attrs:{perm:[0,2,1]}}),T.push(K));const j=p!==1,ee=p===1;let Z=U;j&&(Z=ue({inputs:{x:U},backend:r,attrs:{shape:[I,D,1]}}),T.push(Z));const re=p===1?2:1;let te=K;ee&&(te=ue({inputs:{x:K},backend:r,attrs:{shape:[I,1,D]}}),T.push(te));const le=A2({inputs:{a:Z,b:te},backend:r});G=Zv({inputs:{x:le},backend:r,attrs:{axis:re,keepDims:!0}}),T.push(le)}else{const U=lr(t.dtype,e.dtype),K=new i5(S,k,[I,f,p],n,s,F,P,A,O),j=[C,N];if(i!=null&&j.push(i),A&&j.push(o),O){const ee=r.makeTensorInfo([],"float32",vl(a,"float32"));j.push(ee),T.push(ee)}G=r.runWebGLProgram(K,j,U)}const $=ue({inputs:{x:G},backend:r,attrs:{shape:w}});T.push(G);for(const U of T)r.disposeIntermediateTensorInfo(U);return $}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ywe(t){const{inputs:e,backend:n,attrs:s}=t,{a:r,b:i,bias:o,preluActivationWeights:a}=e,{transposeA:l,transposeB:c,activation:u,leakyreluAlpha:d}=s;return Y0({a:r,b:i,transposeA:l,transposeB:c,backend:n,bias:o,preluActivationWeights:a,leakyreluAlpha:d,activation:u})}const xwe={kernelName:C0,backendName:"webgl",kernelFunc:ywe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dM="return abs(x);";function bwe(t){const{inputs:e,backend:n}=t,{x:s}=e;if(n.shouldExecuteOnCPU([s])&&s.dtype!=="complex64"){const i=n.texData.get(s.dataId),o=YW(i.values);return n.makeTensorInfo(s.shape,s.dtype,o)}let r;return X().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new Oa(s.shape,dM):r=new to(s.shape,dM),n.runWebGLProgram(r,[s],s.dtype)}const vwe={kernelName:Nb,backendName:"webgl",kernelFunc:bwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wwe=ci+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,Swe=rt({opSnippet:wwe}),kwe={kernelName:Mp,backendName:"webgl",kernelFunc:Swe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cwe=ci+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,Nwe=rt({opSnippet:Cwe}),Twe={kernelName:Pp,backendName:"webgl",kernelFunc:Nwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hM="return a + b;",Ewe=Gn({opSnippet:hM,packedOpSnippet:hM,supportsComplex:!0,cpuKernelImpl:Fve}),Iwe={kernelName:qd,backendName:"webgl",kernelFunc:Ewe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Awe{constructor(e,n){this.outputShape=[],this.outputShape=e,this.variableNames=n.map((i,o)=>`T${o}`);const s=[];this.variableNames.forEach(i=>{s.push(`float v${i} = get${i}AtOutCoords();`)});const r=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        float result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $we{constructor(e,n){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=n.map((i,o)=>`T${o}`);const s=[];this.variableNames.forEach(i=>{s.push(`vec4 v${i} = get${i}AtOutCoords();`)});const r=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        vec4 result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dy(t){const{inputs:e,backend:n}=t,s=e;if(s.length===1)return ur({inputs:{x:s[0]},backend:n});if(s.length>X().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const l=Math.floor(s.length/2),c=Dy({inputs:s.slice(0,l),backend:n}),u=Dy({inputs:s.slice(l),backend:n});return Dy({inputs:[c,u],backend:n})}const r=s.map(l=>l.dtype).reduce((l,c)=>lr(l,c)),i=s.map(l=>l.shape),a=X().getBool("WEBGL_PACK")?new $we(s[0].shape,i):new Awe(s[0].shape,i);return n.runWebGLProgram(a,s,r)}const Rwe={kernelName:KT,backendName:"webgl",kernelFunc:Dy};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dwe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=Ge(i,r.shape);let c=l;const u=Bt(c,a);let d=r;u!=null&&(d=ks({inputs:{x:r},backend:n,attrs:{perm:u}}),c=nn(c.length,a)),Hn("all",c,a);const[h,f]=Dn(d.shape,c),p=Q(f),m=ue({inputs:{x:d},backend:n,attrs:{shape:[-1,p]}}),g=ou(m,m.dtype,"all",n);let y;if(o){const x=cn(h,l);y=ue({inputs:{x:g},backend:n,attrs:{shape:x}})}else y=ue({inputs:{x:g},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),u!=null&&n.disposeIntermediateTensorInfo(d),y}const Owe={kernelName:qT,backendName:"webgl",kernelFunc:Dwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mwe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=Ge(i,r.shape);let c=l;const u=Bt(c,a);let d=r;u!=null&&(d=ks({inputs:{x:r},backend:n,attrs:{perm:u}}),c=nn(c.length,a)),Hn("any",c,a);const[h,f]=Dn(d.shape,c),p=Q(f),m=ue({inputs:{x:d},backend:n,attrs:{shape:[-1,p]}}),g=ou(m,m.dtype,"any",n);let y;if(o){const x=cn(h,l);y=ue({inputs:{x:g},backend:n,attrs:{shape:x}})}else y=ue({inputs:{x:g},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),u!=null&&n.disposeIntermediateTensorInfo(d),y}const Pwe={kernelName:XT,backendName:"webgl",kernelFunc:Mwe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Lwe{constructor(e,n,s){this.variableNames=["A"];const{windowSize:r,batchSize:i,outSize:o}=e;s||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];const a=n==="max"?">":"<",l=s?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${r}; i++) {
          int inIdx = ${l};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Fwe{constructor(e,n,s,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,E(e.length>2,()=>`Packed arg${s.charAt(0).toUpperCase()+s.slice(1)} supports only inputs with rank above 2.`);const i=e[e.length-1],o=Math.ceil(i/n);this.outputShape=e.slice(0,-1),o>1&&this.outputShape.push(o),r||this.variableNames.push("bestIndicesA");const a=this.outputShape,l=a.length,c=gt(l),u=xs("coords",l);let d,h;if(o===1){h=l+1;const N=gt(h);d=`
        ${N} sourceLocR = ${N}(${u.join()}, 0);
        ++${u[l-1]};
        ${N} sourceLocG = ${N}(${u.join()}, 0);
        ++${u[l-2]};
        ${N} sourceLocA = ${N}(${u.join()}, 0);
        --${u[l-1]};
        ${N} sourceLocB = ${N}(${u.join()}, 0);
        --${u[l-2]};`}else h=l,d=`
        ${c} sourceLocR = coords;
        ++${u[l-1]};
        ${c} sourceLocG = coords;
        ++${u[l-2]};
        ${c} sourceLocA = coords;
        --${u[l-1]};
        ${c} sourceLocB = coords;
        --${u[l-2]};`;const f=["x","y","z","w","u","v"].slice(0,h),p="."+f[h-1],m=f.map(N=>"int "+N),g=xs("sourceLocR",h-1).concat("inIdx.r"),y=xs("sourceLocG",h-1).concat("inIdx.g"),x=xs("sourceLocB",h-1).concat("inIdx.b"),v=xs("sourceLocA",h-1).concat("inIdx.a"),w=s==="max"?"greaterThan":"lessThan",S=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${g.join()}),
                             getBestIndicesAChannel(${y.join()}),
                             getBestIndicesAChannel(${x.join()}),
                             getBestIndicesAChannel(${v.join()})));`,k=`vec4(
            getAChannel(${g.join()}),
            hasNextCol ? getAChannel(${y.join()}) : 0.,
            hasNextRow ? getAChannel(${x.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${v.join()}) : 0.)`,C=r?"":`
      float getBestIndicesAChannel(${m.join()}) {
        return getChannel(getBestIndicesA(${f.join()}),
                                          vec2(${f.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${m.join()}) {
        return getChannel(getA(${f.join()}),
                               vec2(${f.slice(-2).join()}));
      }
      ${C}
      void main() {
        ${c} coords = getOutputCoords();
        bool hasNextCol = ${u[l-1]} < ${a[l-1]-1};
        bool hasNextRow = ${u[l-2]} < ${a[l-2]-1};
        ${d}
        ivec4 srcIdx = ivec4(sourceLocR${p}, sourceLocG${p},
          sourceLocB${p}, sourceLocA${p}) * ${n};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${k};

        for (int i = 0; i < ${n}; i++) {
          inIdx = srcIdx;
          ${S}
          vec4 candidate = ${k};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${w}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a5(t,e,n,s=null){let r=e.shape[0],i=e.shape[1];s!=null&&(r=s.shape[0],i=s.shape[1]);const o=Pv(i),a={windowSize:o,inSize:i,batchSize:r,outSize:Math.ceil(i/o)},l=new Lwe(a,n,s==null),c=[e];s!=null&&c.push(s);const u=t.runWebGLProgram(l,c,"int32");if(u.shape[1]===1)return u;const d=a5(t,e,n,u);return t.disposeIntermediateTensorInfo(u),d}function l5(t,e,n,s=null){const r=s!=null?s.shape:e.shape,i=r[r.length-1],o=Pv(i),a=new Fwe(r,o,n,s==null),l=s==null?[e]:[e,s],c=t.runWebGLProgram(a,l,"int32");if(c.shape.length===e.shape.length){const u=l5(t,e,n,c);return t.disposeIntermediateTensorInfo(c),u}return c}function c5(t,e,n,s){const r=[n];if(Hn("arg"+s.charAt(0).toUpperCase()+s.slice(1),r,e.shape.length),!X().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const i=[],o=t.texData.get(e.dataId),a=o!==null&&o.isPacked;let l=e;a&&(l=t.unpackTensor(e),i.push(l));const[c,u]=Dn(l.shape,r),d=Q(u),h=ue({inputs:{x:l},backend:t,attrs:{shape:[-1,d]}});i.push(h);const f=a5(t,h,s);i.push(f);const p=ue({inputs:{x:f},backend:t,attrs:{shape:c}});return i.forEach(m=>t.disposeIntermediateTensorInfo(m)),p}return l5(t,e,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _we(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i}=s;let o=Ge(i,r.shape);const a=Bt(o,r.shape.length);let l=r;const c=[];a!=null&&(l=ks({inputs:{x:r},backend:n,attrs:{perm:a}}),c.push(l),o=nn(o.length,l.shape.length)),Hn("argMax",[o[0]],l.shape.length);const u=c5(n,l,o[0],"max");return c.forEach(d=>n.disposeIntermediateTensorInfo(d)),u}const zwe={kernelName:Tb,backendName:"webgl",kernelFunc:_we};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bwe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i}=s;let o=Ge(i,r.shape);const a=Bt(o,r.shape.length);let l=r;const c=[];a!=null&&(l=ks({inputs:{x:r},backend:n,attrs:{perm:a}}),c.push(l),o=nn(o.length,l.shape.length)),Hn("argMin",[o[0]],l.shape.length);const u=c5(n,l,o[0],"min");return c.forEach(d=>n.disposeIntermediateTensorInfo(d)),u}const jwe={kernelName:Eb,backendName:"webgl",kernelFunc:Bwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vwe=ci+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,Uwe=rt({opSnippet:Vwe}),Wwe={kernelName:Lp,backendName:"webgl",kernelFunc:Uwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hwe=ci+"return log(x + sqrt(x * x + 1.0));",Gwe=rt({opSnippet:Hwe}),Kwe={kernelName:Fp,backendName:"webgl",kernelFunc:Gwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qwe=ci+`
  return atan(x);
`,Xwe=rt({opSnippet:qwe}),Jwe={kernelName:_p,backendName:"webgl",kernelFunc:Xwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ywe=I2+`
  return atan(a, b);
`,Qwe=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+iu+`
  return result;
`,Zwe=Gn({opSnippet:Ywe,packedOpSnippet:Qwe}),eSe={kernelName:Bp,backendName:"webgl",kernelFunc:Zwe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tSe=ci+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,nSe=rt({opSnippet:tSe}),sSe={kernelName:zp,backendName:"webgl",kernelFunc:nSe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ap{constructor(e,n,s,r=!1,i=!1){if(this.variableNames=["x"],n==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,a=e.strideHeight,l=e.strideWidth,c=e.dilationHeight,u=e.dilationWidth,d=e.effectiveFilterHeight,h=e.effectiveFilterWidth,f=e.padInfo.top,p=e.padInfo.left;this.outputShape=e.outShape;const m=n==="avg",g=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,y=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let x="0.0";if(m||(x="-1.0 / 1e-20"),s){const N=">=";this.userCode=`
        const ivec2 strides = ivec2(${a}, ${l});
        const ivec2 pads = ivec2(${f}, ${p});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${d};
              wR += ${c}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${h};
                wC += ${u}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${N} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${r?i?g:y:`wR * ${h} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const v="max";let w=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&(w="avgValue / max(count, 1.0)");const S=Math.floor(o/4)*4,k=o%4,C=`
      if (${m}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${v}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${l});
      const ivec2 pads = ivec2(${f}, ${p});
      const float initializationValue = ${x};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${x});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${d};
            wR += ${c}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${S}; wC += 4) {
            int xC = xCCorner + wC * ${u};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              getValue(batch, xR, xC + 2 * ${u}, d),
              getValue(batch, xR, xC + 3 * ${u}, d)
            );

            ${C}
          }

          int xC = xCCorner + ${S};
          if (${k===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${C}
          } else if (${k===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              initializationValue,
              initializationValue
            );

            ${C}
          } else if (${k===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              getValue(batch, xR, xC + 2 * ${u}, d),
              initializationValue
            );

            ${C}
          }
        }
        setOutput(${w});
      }
    `}}class $2{constructor(e,n,s,r=!1,i=!1){if(this.variableNames=["x"],n==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const o=e.filterWidth,a=e.strideDepth,l=e.strideHeight,c=e.strideWidth,u=e.dilationDepth,d=e.dilationHeight,h=e.dilationWidth,f=e.effectiveFilterDepth,p=e.effectiveFilterHeight,m=e.effectiveFilterWidth,g=e.padInfo.front,y=e.padInfo.top,x=e.padInfo.left;this.outputShape=e.outShape;const v=n==="avg";let w="0.0";if(v||(w="-1.0 / 1e-20"),s){const I=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${l}, ${c});
        const ivec3 pads = ivec3(${g}, ${y}, ${x});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${f};
              wD += ${u}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${p};
                wR += ${d}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${m};
                  wC += ${h}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${I} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${r?i?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${p} * ${m} +
                      wR * ${m} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const S="max";let k=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&(k="avgValue / max(count, 1.0)");const C=Math.floor(o/4)*4,N=o%4,T=`
      if (${v}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${S}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${l}, ${c});
      const ivec3 pads = ivec3(${g}, ${y}, ${x});
      const float initializationValue = ${w};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${w});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${f};
            wD += ${u}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${p};
            wR += ${d}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${C}; wC += 4) {
              int xC = xCCorner + wC * ${h};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${h}, ch),
                getValue(batch, xD, xR, xC + 2 * ${h}, ch),
                getValue(batch, xD, xR, xC + 3 * ${h}, ch)
              );

              ${T}
            }

            int xC = xCCorner + ${C};
            if (${N===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${T}
            } else if (${N===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${h}, ch),
                initializationValue,
                initializationValue
              );

              ${T}
            } else if (${N===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${h}, ch),
                getValue(batch, xD, xR, xC + 2 * ${h}, ch),
                initializationValue
              );

              ${T}
            }
          }
        }
        setOutput(${k});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rSe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e;Km(r,"avgPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,c=1;E(is(o,c),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);const u=ai(r.shape,i,o,c,a,l);if(u.filterWidth===1&&u.filterHeight===1&&ct(u.inShape,u.outShape))return ur({inputs:{x:r},backend:n});const d=new ap(u,"avg",!1);return n.runWebGLProgram(d,[r],"float32")}const iSe={kernelName:Ib,backendName:"webgl",kernelFunc:rSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oSe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{filterSize:i,strides:o,pad:a,dimRoundingMode:l,dataFormat:c}=s,u=[1,1,1],d=la(r.shape,i,o,u,a,l,c),h=new $2(d,"avg",!1);return n.runWebGLProgram(h,[r],"float32")}const aSe={kernelName:Ab,backendName:"webgl",kernelFunc:oSe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class lSe{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const n=e.filterHeight,s=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterHeight,c=e.effectiveFilterWidth,u=l-1-e.padInfo.top,d=c-1-e.padInfo.left,h=1/(n*s);this.userCode=`
      const ivec2 pads = ivec2(${u}, ${d});
      const float avgMultiplier = float(${h});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${l};
            wR += ${o}) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${c};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class cSe{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const n=e.filterDepth,s=e.filterHeight,r=e.filterWidth,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,c=e.dilationHeight,u=e.dilationWidth,d=e.effectiveFilterDepth,h=e.effectiveFilterHeight,f=e.effectiveFilterWidth,p=d-1-e.padInfo.front,m=h-1-e.padInfo.top,g=f-1-e.padInfo.left,y=1/(n*s*r);this.userCode=`
      const ivec3 pads = ivec3(${p}, ${m}, ${g});
      const float avgMultiplier = float(${y});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${d};
            wD += ${l}) {
          float dyD = float(dyDCorner + wD) / ${i}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${h};
              wR += ${c}) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${f};
                wC += ${u}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uSe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:i}=e,o=i,{filterSize:a,strides:l,pad:c,dimRoundingMode:u}=s,d=[1,1,1],h=la(o.shape,a,l,d,c,u),f=new cSe(h);return n.runWebGLProgram(f,[r],o.dtype)}const dSe={kernelName:YT,backendName:"webgl",kernelFunc:uSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hSe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:i}=e,o=i;Km([r,i],"avgPoolGrad");const{filterSize:a,strides:l,pad:c}=s,u=ai(o.shape,a,l,1,c),d=new lSe(u);return n.runWebGLProgram(d,[r],o.dtype)}const fSe={kernelName:JT,backendName:"webgl",kernelFunc:hSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pSe(t){const{inputs:e,backend:n,attrs:s}=t,{a:r,b:i}=e,{transposeA:o,transposeB:a}=s;return Y0({a:r,b:i,transposeA:o,transposeB:a,backend:n})}const mSe={kernelName:$b,backendName:"webgl",kernelFunc:pSe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gSe{constructor(e,n,s,r,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],_e(e,n),_e(e,s);let a="0.0";r!=null&&(_e(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="1.0";i!=null&&(_e(e,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${l};
        float inv = scale * inversesqrt(variance + float(${o}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ySe{constructor(e,n,s,r,i,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],_e(e,n),_e(e,s);let a="vec4(0.0)";r!=null&&(_e(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="vec4(1.0)";i!=null&&(_e(e,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${l};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${o}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xSe=({inputs:t,backend:e,attrs:n})=>{const{x:s,mean:r,variance:i,offset:o,scale:a}=t;E(r.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),E(o==null||r.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),E(a==null||r.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:l}=n;l==null&&(l=.001);const c=[s,r,i];let u=null;o!=null&&(u=o.shape,c.push(o));let d=null;a!=null&&(d=a.shape,c.push(a));const h=X().getBool("WEBGL_PACK_NORMALIZATION")?new ySe(s.shape,r.shape,i.shape,u,d,l):new gSe(s.shape,r.shape,i.shape,u,d,l);return e.runWebGLProgram(h,c,c[0].dtype)},bSe={kernelName:Vb,backendName:"webgl",kernelFunc:xSe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vSe{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const n=gt(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const s=wSe(this.rank);let r;const i=e.map((o,a)=>`sourceLoc.${NC[a]} = start[${a}] + coords.${NC[a]};`);r=`
        ${n} sourceLoc;
        ${n} coords = getOutputCoords();
        ${i.join(`
`)}
      `,this.userCode=`
      void main() {
        ${r}
        setOutput(getSource(${s}));
      }
    `}}const NC=["x","y","z","w","u","v"];function wSe(t){if(t===1)return"sourceLoc";if(t<=6)return NC.slice(0,t).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${t} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class SSe{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const n=gt(this.rank),s=xs("coords",this.rank),r=xs("sourceLoc",this.rank),i=this.rank===1?"sourceLoc":`vec2(${r.slice(-2).join()})`,o=`getChannel(getSource(${r.join()}), ${i})`,a=`
      result.x = ${o};
      if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
        ++${r[this.rank-1]};
        result.y = ${o};
        --${r[this.rank-1]};
      }
    `,l=this.rank===1?"":`
      --${s[this.rank-1]};
      if (++${s[this.rank-2]} < ${e[this.rank-2]}) {
        ++${r[this.rank-2]};
        result.z = ${o};
        if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
          ++${r[this.rank-1]};
          result.w = ${o};
        }
      }
    `,c=this.rank<=4?`sourceLoc = coords +
            ${n}(${e.map((u,d)=>`start[${d}]`).join()});`:e.map((u,d)=>`${r[d]} = ${s[d]} + start[${d}];`).join(`
`);this.userCode=`
      void main() {
        ${n} coords = getOutputCoords();
        ${n} sourceLoc;
        ${c}
        vec4 result = vec4(0.);
        ${a}
        ${l}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kSe(t,e,n,s){const r=s.texData.get(t.dataId),i=s.makeTensorInfo(n,t.dtype),o=s.texData.get(i.dataId);Object.assign(o,r),o.refCount=1,o.shape=n,o.dtype=t.dtype;let a=NI(e,ke(t.shape));r.slice&&(a+=r.slice.flatOffset),o.slice={flatOffset:a,origDataId:r.slice&&r.slice.origDataId||t.dataId};const l=s.dataRefCount.get(o.slice.origDataId)||1;return s.dataRefCount.set(o.slice.origDataId,l+1),i}function ah(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{begin:i,size:o}=s,[a,l]=Mv(r,i,o);if(SI(r,a,l),Q(l)===0)return n.makeTensorInfo(l,r.dtype,[]);if(n.shouldExecuteOnCPU([r])||r.dtype==="string"){const d=n.texData.get(r.dataId),h=m1e(d.values,a,l,r.shape,r.dtype);return n.makeTensorInfo(l,r.dtype,h)}const{isPacked:c}=n.texData.get(r.dataId),u=CI(r.shape,a,l);if(c||!u){const d=X().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new SSe(l):new vSe(l),h=[a];return n.runWebGLProgram(d,[r],r.dtype,h)}return n.uploadToGPU(r.dataId),kSe(r,a,l,n)}const CSe={kernelName:yv,backendName:"webgl",kernelFunc:ah};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NSe=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockShape:i,crops:o}=s;E(r.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const a=i.reduce((x,v)=>x*v),l=Mm(r.shape,i,a),c=Pm(l.length,i.length),u=Lm(r.shape,i,a),d=$I(o,i.length),h=RI(u,o,i.length),f=[],p=ue({inputs:{x:r},backend:n,attrs:{shape:l}}),m=ks({inputs:{x:p},backend:n,attrs:{perm:c}}),g=ue({inputs:{x:m},backend:n,attrs:{shape:u}}),y=ah({inputs:{x:g},backend:n,attrs:{begin:d,size:h}});return f.push(p),f.push(m),f.push(g),f.forEach(x=>n.disposeIntermediateTensorInfo(x)),y},TSe={kernelName:Rb,backendName:"webgl",kernelFunc:NSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ESe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,weights:i}=e,{size:o}=s,a=n.readSync(r.dataId),l=n.readSync(i.dataId),c=JW(a,l,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,c)}const ISe={kernelName:QT,backendName:"webgl",kernelFunc:ESe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ASe=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,$Se=`
  return float(int(a.r) & int(b.r));
`;function RSe(t){const{inputs:e,backend:n}=t,{a:s,b:r}=e,i=X().getBool("WEBGL_PACK_BINARY_OPERATIONS"),o=X().getNumber("WEBGL_VERSION");if(n.shouldExecuteOnCPU([s,r])||o===1){const l=n.texData.get(s.dataId).values,c=n.texData.get(r.dataId).values,[u,d]=zve(s.shape,r.shape,l,c,s.dtype),h=n.makeTensorInfo(d,s.dtype),f=n.texData.get(h.dataId);return f.values=u,h}let a;return i?a=new ih(ASe,s.shape,r.shape,!1):a=new _c($Se,s.shape,r.shape),n.runWebGLProgram(a,[s,r],s.dtype)}const DSe={kernelName:ZT,backendName:"webgl",kernelFunc:RSe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OSe(t){const{inputs:e,backend:n}=t,{s0:s,s1:r}=e,i=n.readSync(s.dataId),o=n.readSync(r.dataId),a=_e(Array.from(i),Array.from(o));return n.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const MSe={kernelName:Yz,backendName:"webgl",kernelFunc:OSe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PSe="return float(a != b);",u5=Gn({opSnippet:PSe,cpuKernelImpl:o1e,dtype:"bool"}),LSe={kernelName:iv,backendName:"webgl",kernelFunc:u5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xm(t){const{inputs:e,backend:n}=t,{input:s}=e,r=n.texData.get(s.dataId);return ur({inputs:{x:r.complexTensorInfos.real},backend:n})}const FSe={kernelName:CE,backendName:"webgl",kernelFunc:Xm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _Se="return float(int(x));";function zSe(t,e){const n=new to(t.shape,_Se),s=e.runWebGLProgram(n,[t],"int32");return{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TC(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{dtype:i}=s;if(i==="complex64"){if(r.dtype==="complex64")return ur({inputs:{x:r},backend:n});const o=An(r.shape),a=TC({inputs:{x:r},backend:n,attrs:{dtype:"float32"}}),l=Al({inputs:{real:a,imag:o},backend:n});return o.dispose(),n.disposeIntermediateTensorInfo(a),l}if(r.dtype==="complex64"){const o=Xm({inputs:{input:r},backend:n}),a=TC({inputs:{x:o},backend:n,attrs:{dtype:i}});return n.disposeIntermediateTensorInfo(o),a}if(!Gz(r.dtype,i)){const o=ur({inputs:{x:r},backend:n});return{dataId:o.dataId,shape:o.shape,dtype:i}}if(n.shouldExecuteOnCPU([r])){const o=n.texData.get(r.dataId).values,[a,l,c]=Bve(o,r.shape,r.dtype,i);return n.makeTensorInfo(a,l,c)}if(i==="int32")return zSe(r,n);if(i==="bool"){const o=n.makeTensorInfo([],"bool",ns("bool",1)),l=u5({inputs:{a:r,b:o},backend:n});return n.disposeIntermediateTensorInfo(o),l}throw new Error(`Error in Cast: failed to cast ${r.dtype} to ${i}`)}const BSe={kernelName:jp,backendName:"webgl",kernelFunc:TC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fM="return ceil(x);",jSe=rt({opSnippet:fM,packedOpSnippet:fM,cpuKernelImpl:jve}),VSe={kernelName:Vp,backendName:"webgl",kernelFunc:jSe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class USe{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class WSe{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HSe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{clipValueMin:i,clipValueMax:o}=s;let a;X().getBool("WEBGL_PACK_CLIP")?a=new WSe(r.shape):a=new USe(r.shape);const l=[[i],[o]];return n.runWebGLProgram(a,[r],r.dtype,l)}const GSe={kernelName:Up,backendName:"webgl",kernelFunc:HSe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class KSe{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pM(t,e){return{dataId:e.dataId,dtype:e.dtype,shape:t.shape}}function qSe(t){const{inputs:e,backend:n}=t,{x:s}=e,r=n.texData.get(s.dataId),i=new KSe(s.shape),o=[pM(s,r.complexTensorInfos.real),pM(s,r.complexTensorInfos.imag)];return n.runWebGLProgram(i,o,o[0].dtype)}const XSe={kernelName:Db,backendName:"webgl",kernelFunc:qSe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class JSe{constructor(e){this.outputShape=[],this.outputShape=lo(e,1),this.variableNames=e.map((o,a)=>`T${a}`);const n=new Array(e.length-1);n[0]=e[0][1];for(let o=1;o<n.length;o++)n[o]=n[o-1]+e[o][1];const s=[`if (yC < ${n[0]}) setOutput(getT0(yR, yC));`];for(let o=1;o<n.length;o++){const a=n[o-1];s.push(`else if (yC < ${n[o]}) setOutput(getT${o}(yR, yC-${a}));`)}const r=n.length,i=n[n.length-1];s.push(`else setOutput(getT${r}(yR, yC-${i}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${s.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class YSe{constructor(e,n){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=lo(e,n);const s=this.outputShape,r=s.length,i=gt(r),o=xs("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((m,g)=>`T${g}`);const l=new Array(e.length-1);l[0]=e[0][n];for(let m=1;m<l.length;m++)l[m]=l[m-1]+e[m][n];const c=a[n],u=a.slice(-2),d=a.join();let h=`if (${c} < ${l[0]}) {
        return getChannel(
            getT0(${d}), vec2(${u.join()}));
        }`;for(let m=1;m<l.length;m++){const g=l[m-1];h+=`
        if (${c} < ${l[m]}  && ${c} >= ${l[m-1]}) {
          return getChannel(
            getT${m}(${Vg(a,c,g)}),
            vec2(${Vg(u,c,g)}));
        }`}const f=l.length,p=l[l.length-1];h+=`
        return getChannel(
          getT${f}(${Vg(a,c,p)}),
          vec2(${Vg(u,c,p)}));`,this.userCode=`
      float getValue(${a.map(m=>"int "+m)}) {
        ${h}
      }

      void main() {
        ${i} coords = getOutputCoords();
        vec4 result = vec4(getValue(${o}), 0., 0., 0.);

        ${o[r-1]} = ${o[r-1]} + 1;
        if (${o[r-1]} < ${s[r-1]}) {
          result.g = getValue(${o});
        }

        ${o[r-2]} = ${o[r-2]} + 1;
        if (${o[r-2]} < ${s[r-2]}) {
          result.a = getValue(${o});
        }

        ${o[r-1]} = ${o[r-1]} - 1;
        if (${o[r-2]} < ${s[r-2]} &&
            ${o[r-1]} < ${s[r-1]}) {
          result.b = getValue(${o});
        }
        setOutput(result);
      }
    `}}function Vg(t,e,n){const s=t.indexOf(e);return t.map((i,o)=>o===s?`${i} - ${n}`:i).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e1(t){const{inputs:e,backend:n}=t,{input:s}=e,r=n.texData.get(s.dataId);return ur({inputs:{x:r.complexTensorInfos.imag},backend:n})}const QSe={kernelName:gE,backendName:"webgl",kernelFunc:e1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qh(t,e,n){const s=t[0].dtype;if(s==="complex64"){const f=t.map(x=>Xm({inputs:{input:x},backend:n})),p=t.map(x=>e1({inputs:{input:x},backend:n})),m=qh(f,e,n),g=qh(p,e,n),y=Al({inputs:{real:m,imag:g},backend:n});return f.forEach(x=>n.disposeIntermediateTensorInfo(x)),p.forEach(x=>n.disposeIntermediateTensorInfo(x)),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),y}let r=n.shouldExecuteOnCPU(t);if(s==="string"&&(r=!0),r){const f=t.map(w=>{const k=[-1,Q(w.shape.slice(e))];return ue({inputs:{x:w},backend:n,attrs:{shape:k}})}),p=f.map(w=>({vals:n.readSync(w.dataId),shape:w.shape})),m=lo(f.map(w=>w.shape),1),g=f[0].shape[0]===1,y=Vve(p,m,s,g),x=lo(t.map(w=>w.shape),e),v=n.makeTensorInfo(x,s,y);return f.forEach(w=>n.disposeIntermediateTensorInfo(w)),v}const i=t.filter(f=>Q(f.shape)>0),o=X().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&i[0].shape.length>1;if(i.length===1){const f=o?new to(t[0].shape,va):new Oa(t[0].shape,va);return n.runWebGLProgram(f,t,s)}const a=X().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(i.length>a){const f=[];for(let m=0;m<i.length;m+=a){const g=i.slice(m,m+a);f.push(qh(g,e,n))}const p=qh(f,e,n);for(const m of f)n.disposeIntermediateTensorInfo(m);return p}if(o){const f=new YSe(i.map(p=>p.shape),e);return n.runWebGLProgram(f,i,s)}const{tensors2D:l,outShape:c}=ZSe(i,e,n),u=new JSe(l.map(f=>f.shape)),d=n.runWebGLProgram(u,l,s);l.forEach(f=>n.disposeIntermediateTensorInfo(f));const h=ue({inputs:{x:d},attrs:{shape:c},backend:n});return n.disposeIntermediateTensorInfo(d),h}function ZSe(t,e,n){const s=lo(t.map(i=>i.shape),e);return{tensors2D:t.map(i=>ue({inputs:{x:i},attrs:{shape:[-1,Q(i.shape.slice(e))]},backend:n})),outShape:s}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d5(t){const{inputs:e,backend:n,attrs:s}=t,{axis:r}=s,i=Ge(r,e[0].shape)[0],o=e.map(c=>c.shape);EI(o,i);const a=lo(e.map(c=>c.shape),i);if(Q(a)===0)return n.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(c=>Q(c.shape)>0);return l.length===1?ur({inputs:{x:l[0]},backend:n}):qh(l,i,n)}const eke={kernelName:Ob,backendName:"webgl",kernelFunc:d5};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class h5{constructor(e,n=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const o=e.padInfo.top,a=e.padInfo.left,l=e.strideHeight,c=e.strideWidth,u=e.dilationHeight,d=e.dilationWidth,h=e.filterHeight,f=e.filterWidth,p=Math.floor(e.inChannels/4)*4,m=e.inChannels%4,g=e.dataFormat==="channelsLast",y=g?1:2,x=g?2:3,v=g?3:1;let w="",S="";s&&(r?w=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:i?w=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:w=`
          float activation(float x) {
            ${s}
          }
        `,S="result = activation(result);");const k=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${w}

      const ivec2 strides = ivec2(${l}, ${c});
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${v}];

        ivec2 xRCCorner =
            ivec2(coords[${y}], coords[${x}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${h}; wR++) {
          int xR = xRCorner + wR * ${u};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${f}; wC++) {
            int xC = xCCorner + wC * ${d};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${p}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${g}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${m===1}) {

              if (${g}) {
                dotProd +=
                    getX(batch, xR, xC, ${p}) *
                    getW(wR, wC, ${p}, d2);
              } else {
                dotProd +=
                    getX(batch, ${p}, xR, xC) *
                    getW(wR, wC, ${p}, d2);
              }

            } else if (${m===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${p}, d2),
                getW(wR, wC, ${p} + 1, d2)
              );

              if (${g}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${p}),
                  getX(batch, xR, xC, ${p} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${p}, xR, xC),
                  getX(batch, ${p} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${m===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${p}, d2),
                getW(wR, wC, ${p} + 1, d2),
                getW(wR, wC, ${p} + 2, d2)
              );

              if (${g}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${p}),
                  getX(batch, xR, xC, ${p} + 1),
                  getX(batch, xR, xC, ${p} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${p}, xR, xC),
                  getX(batch, ${p} + 1, xR, xC),
                  getX(batch, ${p} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${k}
        ${S}
        setOutput(result);
      }
    `}}class tke{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const n=e.padInfo.front,s=e.padInfo.top,r=e.padInfo.left,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,c=e.dilationHeight,u=e.dilationWidth,d=e.filterDepth,h=e.filterHeight,f=e.filterWidth,p=Math.floor(e.inChannels/4)*4,m=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${i}, ${o}, ${a});
      const ivec3 pads = ivec3(${n}, ${s}, ${r});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${d}; wF++) {
          int xF = xFCorner + wF * ${l};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${h}; wR++) {
            int xR = xRCorner + wR * ${c};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${f}; wC++) {
              int xC = xCCorner + wC * ${u};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${p}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${m===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${p}) *
                  getW(wF, wR, wC, ${p}, d2);
              } else if (${m===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${p}),
                  getX(batch, xF, xR, xC, ${p} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${p}, d2),
                  getW(wF, wR, wC, ${p} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${m===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${p}),
                  getX(batch, xF, xR, xC, ${p} + 1),
                  getX(batch, xF, xR, xC, ${p} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${p}, d2),
                  getW(wF, wR, wC, ${p} + 1, d2),
                  getW(wF, wR, wC, ${p} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class f5{constructor(e,n=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=ls(this.outputShape.length);const o=e.padInfo.left,a=e.strideWidth,l=e.dilationWidth,c=e.filterHeight,u=e.filterWidth,d=u;let h=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let g=0;g<u;g++)h+=`
           vec4 xTexelC${g*2};
           int xTexelC${g*2}Ready;
           vec4 xTexelC${g*2+1};
           int xTexelC${g*2+1}Ready;
           vec4 xC${g};`;h+=`
     for (int r = 0; r < ${c}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let g=0;g<u;g++)h+=`
           xTexelC${g*2} = vec4(0.0);
           xTexelC${g*2}Ready = 0;
           xTexelC${g*2+1} = vec4(0.0);
           xTexelC${g*2+1}Ready = 0;
           xC${g} = vec4(0.0);`;h+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let g=0;g<(d+1)/2;g++){const y=g*2;if(h+=`
           xC = xCCorner + ${y*l};
           `,a===1){if(y<u&&(o%2===1?(h+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }
               `,l===1&&y>0?h+=`
                 xC${y} = vec4(xTexelC${y-2}.zw, xTexelC${y}.xy);
                 `:h+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${y} = vec4(previous.zw, xTexelC${y}.xy);
                   } else {
                     xC${y} = vec4(0.0, 0.0, xTexelC${y}.xy);
                   }
                   `):h+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 xC${y} = xTexelC${y};
                 `,y+1<u)){const x=o%2===0?VT(l):l;l%2===0&&o%2===1||l%2!==0&&o%2!==1?(h+=`
                   xCOffset = xC + imod(pads[1], 2) + ${x};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                     xTexelC${y+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${y+1}.zw = vec2(0.0);
                     }
                     xTexelC${y+1}Ready = 1;
                   }
                   `,l>1?h+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${y+1} = vec4(previous.zw, xTexelC${y+1}.xy);
                     } else {
                      xC${y+1} = vec4(0.0, 0.0, xTexelC${y+1}.xy);
                     }
                     `:h+=`
                     xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.xy);
                     `):x===1?h+=`
                     xC${y+1} = xTexelC${y};
                     `:h+=`
                     xCOffset = xC + ${x};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                       xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${y+1}.zw = vec2(0.0);
                       }
                       xTexelC${y+1}Ready = 1;
                     }

                     xC${y+1} = xTexelC${y+1};
                     `}}else y<u&&(o%2===1?(h+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${y+1}Ready == 0) {
                   xTexelC${y+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${y+1}.zw = vec2(0.0);
                   }
                   xTexelC${y+1}Ready = 1;
                 }

                 xC${y} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
               `,y+1<u&&(h+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${y+1} = vec4(xTexelC${y+1}.xy, final.xy);
                 `)):(h+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                   xTexelC${y} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${y}.zw = vec2(0.0);
                   }
                   xTexelC${y}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                   xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${y+1}.zw = vec2(0.);
                   }
                   xTexelC${y+1}Ready = 1;
                 }

                 xC${y} = vec4(
                   xTexelC${y}.xy, xTexelC${y+1}.xy);
               `,y+1<u&&(h+=`
                   xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
                 `)));y<u&&(h+=`
             wTexel = getW(r, ${y}, d1, d2);
             dotProd += xC${y}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${y}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,y+1<u&&(h+=`
               wTexel = getW(r, ${y+1}, d1, d2);
               dotProd += xC${y+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${y+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}h+=`
     }
   `,h+=`
     }
   `,h+=`
     }
   `;let f="",p="";s&&(r?f=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${s}
         }`:i?f=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${s}
         }`:f=`vec4 activation(vec4 x) {
           ${s}
         }`,p="result = activation(result);");const m=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${f}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${h}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${m}
         ${p}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nke{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=ls(this.outputShape.length);const{dataFormat:s}=n,r=Ns(),i=s==="channelsLast",o=i?1:2,a=i?2:3,l=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let c="";for(let u=0;u<=1;u++)for(let d=0;d<=1;d++)c+=`
          blockIndex = rc.z + ${d};
          pos = rc.y + ${u};

          ${l}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${o}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${i}) {
                  innerDims = vec2(d1, ch);
                  result[${u*2+d}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${u*2+d}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${c}

        ${r.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q0(t,e){const n=t.length;return n>=3?e?[...t.slice(0,-3),t[n-3]*t[n-2],t[n-1]]:[...t.slice(0,-3),t[n-3],t[n-2]*t[n-1]]:!e&&n===1&&t[0]>1?[t[0],1]:null}function p5({x:t,filter:e,convInfo:n,backend:s,bias:r=null,preluActivationWeights:i=null,leakyreluAlpha:o=0,activation:a=null}){const l=t.shape,c=s.texData.get(t.dataId),u=n.inChannels,d=l[0]*l[1]*l[2],h=n.outChannels,f=n.dataFormat==="channelsLast",p=!1,m=!1;let g;const y=[];if(i!=null){const w=Q0(i.shape,f);w!=null&&(i=ue({inputs:{x:i},backend:s,attrs:{shape:w}}),y.push(i))}if(r!=null){const w=Q0(r.shape,f);w!=null&&(r=ue({inputs:{x:r},backend:s,attrs:{shape:w}}),y.push(r))}if(!((d===1||h===1)&&u>o5)&&c.isPacked&&f&&c.texture!=null&&l[2]%2!==0&&ct(c.shape.slice(-3),l.slice(-3))){const w=l[0]*l[1]*(l[2]+1),S={dataId:t.dataId,shape:[1,w,n.inChannels],dtype:t.dtype},k=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,E(J0(c.shape,S.shape),()=>`packed reshape ${c.shape} to ${S.shape} isn't free`);const C=ue({inputs:{x:e},backend:s,attrs:{shape:[1,n.inChannels,n.outChannels]}});y.push(C);const N=Y0({a:S,b:C,backend:s,transposeA:p,transposeB:m,bias:r,activation:a,preluActivationWeights:i,leakyreluAlpha:o}),T=s.texData.get(N.dataId);E(T.isPacked,()=>"batchMatMul result is expected to be packed"),c.shape=k,T.shape=n.outShape,g=ur({inputs:{x:N},backend:s}),g.shape=n.outShape,y.push(N)}else{const w=n.outHeight*n.outWidth,S=ue({inputs:{x:t},backend:s,attrs:{shape:f?[n.batchSize,w,n.inChannels]:[n.batchSize,n.inChannels,w]}}),k=ue({inputs:{x:e},backend:s,attrs:{shape:[1,n.inChannels,n.outChannels]}}),C=Y0({a:f?S:k,b:f?k:S,transposeA:!f,transposeB:m,backend:s,bias:r,activation:a,preluActivationWeights:i,leakyreluAlpha:o});g=ue({inputs:{x:C},backend:s,attrs:{shape:n.outShape}}),y.push(S),y.push(k),y.push(C)}for(const w of y)s.disposeIntermediateTensorInfo(w);return g}function m5({x:t,filter:e,convInfo:n,backend:s,bias:r=null,preluActivationWeights:i=null,leakyreluAlpha:o=0,activation:a=null}){const{filterWidth:l,filterHeight:c,inChannels:u,outWidth:d,outHeight:h,dataFormat:f}=n,p=f==="channelsLast",m=l*c*u,g=h*d,y=[n.batchSize,m,g],x=!0,v=!1,w=[];if(i!=null){const $=Q0(i.shape,p);$!=null&&(i=ue({inputs:{x:i},backend:s,attrs:{shape:$}}),w.push(i))}if(r!=null){const $=Q0(r.shape,p);$!=null&&(r=ue({inputs:{x:r},backend:s,attrs:{shape:$}}),w.push(r))}const S=ue({inputs:{x:e},backend:s,attrs:{shape:[1,m,Q(e.shape)/m]}});w.push(S);const k=new nke(y,n),C=[t.shape,[n.padInfo.top,n.padInfo.left],[n.strideHeight,n.strideWidth],[n.dilationHeight,n.dilationWidth],[n.inChannels],[n.filterWidth*n.inChannels],[n.outWidth]],N=s.runWebGLProgram(k,[t],"float32",C),T=ue({inputs:{x:N},backend:s,attrs:{shape:y}});w.push(N),w.push(T);const I=r!=null,D=i!=null,F=a==="leakyrelu",A=a?op(a,!0):null,O=new i5(p?T.shape:S.shape,p?S.shape:T.shape,p?[n.batchSize,g,n.outChannels]:[n.batchSize,n.outChannels,g],x,v,I,A,D,F),P=p?[T,S]:[S,T];if(r&&P.push(r),D&&P.push(i),F){const $=s.makeTensorInfo([],"float32",vl(o,"float32"));P.push($),w.push($)}const L=s.runWebGLProgram(O,P,"float32"),G=ue({inputs:{x:L},backend:s,attrs:{shape:n.outShape}});w.push(L);for(const $ of w)s.disposeIntermediateTensorInfo($);return G}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ske(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i}=e,{strides:o,pad:a,dataFormat:l,dilations:c,dimRoundingMode:u}=s,d=ca(l),h=Wn(r.shape,i.shape,o,c,a,u,!1,d);let f;if(h.filterHeight===1&&h.filterWidth===1&&h.dilationHeight===1&&h.dilationWidth===1&&h.strideHeight===1&&h.strideWidth===1&&(h.padInfo.type==="SAME"||h.padInfo.type==="VALID"))f=p5({x:r,filter:i,convInfo:h,backend:n});else if(h.strideWidth<=2&&d==="channelsLast"&&X().getBool("WEBGL_EXP_CONV")){const m=new f5(h),g=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];f=n.runWebGLProgram(m,[r,i],"float32",g)}else if(X().getBool("WEBGL_CONV_IM2COL"))f=m5({x:r,filter:i,convInfo:h,backend:n});else{const m=new h5(h);f=n.runWebGLProgram(m,[r,i],"float32")}const p=ue({inputs:{x:f},backend:n,attrs:{shape:h.outShape}});return n.disposeIntermediateTensorInfo(f),p}const rke={kernelName:Mb,backendName:"webgl",kernelFunc:ske};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ike{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,o=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${i};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              ${o?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class oke{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterHeight,s=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=e.dataFormat==="channelsLast",a=n-1-e.padInfo.top,l=s-1-e.padInfo.left,c=o?1:2,u=o?2:3,d=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${d}];

        ivec2 dyCorner = ivec2(coords[${c}], coords[${u}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${o}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class ake{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideDepth,s=e.strideHeight,r=e.strideWidth,i=e.padInfo.front,o=e.padInfo.top,a=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${n} - ${i};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${s} - ${o};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${r} - ${a};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class lke{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterDepth,s=e.filterHeight,r=e.filterWidth,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,l=n-1-e.padInfo.front,c=s-1-e.padInfo.top,u=r-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${l}, ${c}, ${u});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${n}; wF++) {
          float dyF = float(dyFCorner + wF) / ${i}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${n} - 1 - wF;

          for (int wR = 0; wR < ${s}; wR++) {
            float dyR = float(dyRCorner + wR) / ${o}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${s} - 1 - wR;

            for (int wC = 0; wC < ${r}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${r} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cke(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:i}=e,{strides:o,pad:a,dataFormat:l,dimRoundingMode:c,filterShape:u}=s,d=ca(l),h=Wn(r.shape,u,o,1,a,c,!1,d),f=new ike(h);return n.runWebGLProgram(f,[r,i],"float32")}const uke={kernelName:tE,backendName:"webgl",kernelFunc:cke};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dke{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=ls(this.outputShape.length);const n=e.filterHeight,s=e.filterWidth,r=n-1-e.padInfo.top,i=s-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${r}, ${i});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            int wCPerm = ${s} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hke(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:i}=e,{inputShape:o,strides:a,pad:l,dataFormat:c,dimRoundingMode:u}=s,d=ca(c),h=Wn(o,i.shape,a,1,l,u,!1,d);if(X().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&d==="channelsLast"){const f=[[h.strideHeight,h.strideWidth]],p=new dke(h);return n.runWebGLProgram(p,[r,i],"float32",f)}else{const f=new oke(h);return n.runWebGLProgram(f,[r,i],"float32")}}const fke={kernelName:Pb,backendName:"webgl",kernelFunc:hke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pke(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l}=s,c=Sl(r.shape,i.shape,o,l,a),u=new tke(c);return n.runWebGLProgram(u,[r,i],"float32")}const mke={kernelName:Lb,backendName:"webgl",kernelFunc:pke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gke(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:i}=e,{strides:o,pad:a,filterShape:l}=s,c=Sl(r.shape,l,o,1,a),u=new ake(c);return n.runWebGLProgram(u,[r,i],"float32")}const yke={kernelName:nE,backendName:"webgl",kernelFunc:gke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xke(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:i}=e,{pad:o,strides:a,inputShape:l}=s,c=Sl(l,i.shape,a,1,o),u=new lke(c);return n.runWebGLProgram(u,[r,i],"float32")}const bke={kernelName:sE,backendName:"webgl",kernelFunc:xke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vke=oh+`
  return cos(x);
`,wke=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${iu}
  return result;
`,Ske=rt({opSnippet:vke,packedOpSnippet:wke}),kke={kernelName:Wp,backendName:"webgl",kernelFunc:Ske};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cke=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,Nke=rt({opSnippet:Cke}),Tke={kernelName:Hp,backendName:"webgl",kernelFunc:Nke};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Eke{constructor(e,n,s,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[o,a,l,c]=e,[u]=n,[d,h]=s;this.outputShape=[u,d,h,c];const f=r==="bilinear"?1:0,[p,m]=[`${a-1}.0`,`${l-1}.0`],[g,y,x]=d>1?[`${(a-1)/(d-1)}`,"(y2-y1) * height_ratio",`y1*${p} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${p}`],[v,w,S]=h>1?[`${(l-1)/(h-1)}`,"(x2-x1) * width_ratio",`x1*${m} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${m}`];this.userCode=`
      const float height_ratio = float(${g});
      const float width_ratio = float(${v});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${o}) {
          return;
        }

        float height_scale = ${y};
        float width_scale = ${w};

        float in_y = ${x};
        if( in_y < 0.0 || in_y > ${p} ) {
          setOutput(float(${i}));
          return;
        }
        float in_x = ${S};
        if( in_x < 0.0 || in_x > ${m} ) {
          setOutput(float(${i}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${f} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ike=t=>{const{inputs:e,backend:n,attrs:s}=t,{image:r,boxes:i,boxInd:o}=e,{cropSize:a,method:l,extrapolationValue:c}=s,u=new Eke(r.shape,i.shape,a,l,c);return n.runWebGLProgram(u,[r,i,o],"float32")},Ake={kernelName:iE,backendName:"webgl",kernelFunc:Ike};var lp;(function(t){t.Prod="*",t.Sum="+"})(lp||(lp={}));class mM{constructor(e,n,s,r){this.op=e,this.outputShape=n,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const i=this.outputShape.length,o=this.op===lp.Prod?"1.0":"0.0",a=s?o:`getX(${gM(i,"coords",this.op)})`,l=this.outputShape[this.outputShape.length-1];let c="",u="";s?(c=r?`end != ${l-1}`:"end != 0",u=r?"end + 1":"end - 1"):(c=r?`end + pow2 < ${l}`:"end >= pow2",u=r?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${gt(i)} coords = getOutputCoords();
        int end = ${yM(i,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${c}) {
          int idx = ${u};
          ${yM(i,"coords",this.op)} = idx;
          val ${this.op}= getX(${gM(i,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function gM(t,e,n){if(t===1)return`${e}`;if(t===2)return`${e}.x, ${e}.y`;if(t===3)return`${e}.x, ${e}.y, ${e}.z`;if(t===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}function yM(t,e,n){if(t===1)return`${e}`;if(t===2)return`${e}.y`;if(t===3)return`${e}.z`;if(t===4)return`${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g5(t,e,n,s,r,i){const o=e.shape.length,a=Bt([s],o);let l=e;a!=null&&(l=ks({inputs:{x:e},backend:n,attrs:{perm:a}}));const c=nn(1,o)[0];if(c!==o-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${s}`);const u=l.shape[c];let d=ur({inputs:{x:l},backend:n});for(let h=0;h<=Math.ceil(Math.log2(u))-1;h++){const f=new mM(t,l.shape,!1,i),p=[[h]],m=d;d=n.runWebGLProgram(f,[d],d.dtype,p),n.disposeIntermediateTensorInfo(m)}if(r){const h=new mM(t,l.shape,r,i),f=d;d=n.runWebGLProgram(h,[d],d.dtype),n.disposeIntermediateTensorInfo(f)}if(a!=null){const h=kl(a),f=ks({inputs:{x:d},backend:n,attrs:{perm:h}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(l),f}return d}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $ke(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;return g5(lp.Prod,r,n,i,o,a)}const Rke={kernelName:rE,backendName:"webgl",kernelFunc:$ke};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dke(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,exclusive:o,reverse:a}=s;return g5(lp.Sum,r,n,i,o,a)}const Oke={kernelName:Fb,backendName:"webgl",kernelFunc:Dke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mke(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,weights:i}=e,{size:o,binaryOutput:a}=s;if(r.shape.length===1){const l=n.readSync(r.dataId),c=n.readSync(i.dataId),u=JW(l,c,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,u)}else if(r.shape.length===2){const l=n.bufferSync(r),c=n.bufferSync(i),u=_ve(l,c,o,a);return n.makeTensorInfo(u.shape,i.dtype,u.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const Pke={kernelName:oE,backendName:"webgl",kernelFunc:Mke};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Lke{constructor(e,n,s){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=n,this.dataFormat=s,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${n};
      int offset_h = imod(h, ${n});
      int in_w = w / ${n};
      int offset_w = imod(w, ${n});
      int offset_d = (offset_h * ${n} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fke(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockSize:i,dataFormat:o}=s,a=r.shape[0],l=o==="NHWC"?r.shape[1]:r.shape[2],c=o==="NHWC"?r.shape[2]:r.shape[3],u=o==="NHWC"?r.shape[3]:r.shape[1],d=l*i,h=c*i,f=u/(i*i),p=o==="NHWC"?[a,d,h,f]:[a,f,d,h],m=new Lke(p,i,o);return n.runWebGLProgram(m,[r],r.dtype)}const _ke={kernelName:aE,backendName:"webgl",kernelFunc:Fke};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class y5{constructor(e,n=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=ls(this.outputShape.length);const o=e.filterHeight,a=e.filterWidth,l=e.outChannels/e.inChannels;let c="",u="";s&&(r?c=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:i?c=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:c=`
          float activation(float x) {
            ${s}
          }
        `,u="result = activation(result);");const d=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${c}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${l};
        int q = d2 - d1 * ${l};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${o}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${d}
        ${u}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class x5{constructor(e,n=!1,s=null,r=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=ls(this.outputShape.length);const o=e.outChannels/e.inChannels,a=e.padInfo.left,l=e.strideWidth,c=e.dilationWidth,u=e.filterHeight,d=e.filterWidth,h=d;let f=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let y=0;y<d;y++)f+=`
          vec4 xTexelC${y*2};
          int xTexelC${y*2}Ready;
          vec4 xTexelC${y*2+1};
          int xTexelC${y*2+1}Ready;
          vec4 xC${y};`;f+=`
    for (int r = 0; r < ${u}; r++) {
      `;for(let y=0;y<d;y++)f+=`
          xTexelC${y*2} = vec4(0.0);
          xTexelC${y*2}Ready = 0;
          xTexelC${y*2+1} = vec4(0.0);
          xTexelC${y*2+1}Ready = 0;
          xC${y} = vec4(0.0);`;f+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let y=0;y<(h+1)/2;y++){const x=y*2;if(f+=`
          xC = xCCorner + ${x*c};
          `,l===1){if(x<d&&(a%2===1?(f+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x}Ready == 0) {
                  xTexelC${x} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${x}.zw = vec2(0.0);
                  }
                  xTexelC${x}Ready = 1;
                }
              `,c===1&&x>0?f+=`
                xC${x} = vec4(xTexelC${x-2}.zw, xTexelC${x}.xy);
                `:f+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${x} = vec4(previous.zw, xTexelC${x}.xy);
                  } else {
                    xC${x} = vec4(0.0, 0.0, xTexelC${x}.xy);
                  }
                  `):f+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${x}Ready == 0) {
                  xTexelC${x} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${x}.zw = vec2(0.0);
                  }
                  xTexelC${x}Ready = 1;
                }

                xC${x} = xTexelC${x};
                `,x+1<d)){const v=a%2===0?VT(c):c;c%2===0&&a%2===1||c%2!==0&&a%2!==1?(f+=`
                  xCOffset = xC + imod(pads[1], 2) + ${v};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x+1}Ready == 0) {
                    xTexelC${x+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${x+1}.zw = vec2(0.0);
                    }
                    xTexelC${x+1}Ready = 1;
                  }
                  `,c>1?f+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${x+1} = vec4(previous.zw, xTexelC${x+1}.xy);
                    } else {
                     xC${x+1} = vec4(0.0, 0.0, xTexelC${x+1}.xy);
                    }
                    `:f+=`
                    xC${x+1} = vec4(xTexelC${x}.zw, xTexelC${x+1}.xy);
                    `):v===1?f+=`
                    xC${x+1} = xTexelC${x};
                    `:f+=`
                    xCOffset = xC + ${v};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x+1}Ready == 0) {
                      xTexelC${x+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${x+1}.zw = vec2(0.0);
                      }
                      xTexelC${x+1}Ready = 1;
                    }

                    xC${x+1} = xTexelC${x+1};
                    `}}else x<d&&(a%2===1?(f+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x}Ready == 0) {
                  xTexelC${x} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${x}.zw = vec2(0.0);
                  }
                  xTexelC${x}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${x+1}Ready == 0) {
                  xTexelC${x+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${x+1}.zw = vec2(0.0);
                  }
                  xTexelC${x+1}Ready = 1;
                }

                xC${x} = vec4(xTexelC${x}.zw, xTexelC${x+1}.zw);
              `,x+1<d&&(f+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${x+1} = vec4(xTexelC${x+1}.xy, final.xy);
                `)):(f+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${x}Ready == 0) {
                  xTexelC${x} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${x}.zw = vec2(0.0);
                  }
                  xTexelC${x}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x+1}Ready == 0) {
                  xTexelC${x+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${x+1}.zw = vec2(0.);
                  }
                  xTexelC${x+1}Ready = 1;
                }

                xC${x} = vec4(
                  xTexelC${x}.xy, xTexelC${x+1}.xy);
              `,x+1<d&&(f+=`
                  xC${x+1} = vec4(xTexelC${x}.zw, xTexelC${x+1}.zw);
                `)));x<d&&(f+=`
            wTexel = getW(r, ${x}, d1, q);
            dotProd += xC${x} * vec4(wTexel.xz, wTexel.xz);
          `,x+1<d&&(f+=`
              wTexel = getW(r, ${x+1}, d1, q);
              dotProd += xC${x+1} * vec4(wTexel.xz, wTexel.xz);
            `))}f+=`
    }
  `,f+=`
      }
    `;let p="",m="";s&&(r?p=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:i?p=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:p=`vec4 activation(vec4 x) {
          ${s}
        }`,m="result = activation(result);");const g=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${p}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${o};
        int q = d2 - d1 * ${o};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${f}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${g}
        ${m}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zke(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l,dimRoundingMode:c}=s;let u=l;u==null&&(u=[1,1]),E(is(o,u),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const d=Wn(r.shape,i.shape,o,u,a,c,!0);let h;X().getBool("WEBGL_PACK_DEPTHWISECONV")&&d.strideWidth<=2&&d.outChannels/d.inChannels===1?h=new x5(d):h=new y5(d);const f=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];return n.runWebGLProgram(h,[r,i],"float32",f)}const Bke={kernelName:_b,backendName:"webgl",kernelFunc:zke};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jke{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,i=e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${o} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${i};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Vke{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterHeight,s=e.filterWidth,r=e.strideHeight,i=e.strideWidth,o=n-1-e.padInfo.top,a=s-1-e.padInfo.left,l=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${o}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${l}; dm++) {
              int d2 = d1 * ${l} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uke(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:c,filterShape:u}=s,d=Wn(r.shape,u,o,a,l,c,!0),h=new jke(d);return n.runWebGLProgram(h,[r,i],"float32")}const Wke={kernelName:lE,backendName:"webgl",kernelFunc:Uke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hke(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:i}=e,{strides:o,dilations:a,pad:l,dimRoundingMode:c,inputShape:u}=s,d=Wn(u,i.shape,o,a,l,c,!0),h=new Vke(d);return n.runWebGLProgram(h,[r,i],"float32")}const Gke={kernelName:cE,backendName:"webgl",kernelFunc:Hke};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kke{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qke(t){const{inputs:e,backend:n}=t,{x:s}=e,r=[...s.shape,...s.shape],i=Q(s.shape),o=ue({inputs:{x:s},backend:n,attrs:{shape:[i]}}),a=new Kke(i),l=n.runWebGLProgram(a,[o],o.dtype),c=ue({inputs:{x:l},backend:n,attrs:{shape:r}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(l),c}const Xke={kernelName:Qz,backendName:"webgl",kernelFunc:qke};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Jke{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:n,inWidth:s,padInfo:r,strideHeight:i,strideWidth:o,filterHeight:a,filterWidth:l,dilationHeight:c,dilationWidth:u}=e,{top:d,left:h}=r;this.userCode=`
      const ivec2 strides = ivec2(${i}, ${o});
      const ivec2 pads = ivec2(${d}, ${h});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${c};

          if (hIn >= 0 && hIn < ${n}) {
            for (int w = 0; w < ${l}; w++) {
              int wIn = wBeg + w * ${u};

              if (wIn >= 0 && wIn < ${s}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yke(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i}=e,{strides:o,pad:a,dilations:l}=s,c=Am(r.shape,i.shape,o,a,"NHWC",l);let u;const d=new Jke(c);u=n.runWebGLProgram(d,[r,i],"float32");const h=ue({inputs:{x:u},backend:n,attrs:{shape:c.outShape}});return n.disposeIntermediateTensorInfo(u),h}const Qke={kernelName:zb,backendName:"webgl",kernelFunc:Yke};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zke(t){const{inputs:e,backend:n,attrs:s}=t,{equation:r}=s,i=e,{allDims:o,summedDims:a,idDims:l}=zI(r,i.length);jI(o.length,l,i);const{path:c,steps:u}=VI(a,l),d=u.length;let h=null,f=o.length;const p=[];for(let m=0;m<d;++m){for(const g of u[m]){const{permutationIndices:y,expandDims:x}=BI(f,l[g]);let v;UI(y)?v=i[g]:(v=ks({inputs:{x:i[g]},backend:n,attrs:{perm:y}}),p.push(v));const w=v.shape.slice();for(let S=0;S<x.length;++S)w.splice(x[S],0,1);ct(v.shape,w)||(v=ue({inputs:{x:v},backend:n,attrs:{shape:w}}),p.push(v)),h===null?h=v:(h=A2({inputs:{a:v,b:h},backend:n}),p.push(h))}m<d-1&&(c[m]>=0&&(h=Zv({inputs:{x:h},backend:n,attrs:{axis:c[m]-(o.length-f),keepDims:!1}}),p.push(h)),f--)}for(const m of p)m!==h&&n.disposeIntermediateTensorInfo(m);return h}const eCe={kernelName:uE,backendName:"webgl",kernelFunc:Zke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tCe="return (x >= 0.0) ? x : (exp(x) - 1.0);",nCe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,sCe=rt({opSnippet:tCe,packedOpSnippet:nCe}),rCe={kernelName:Kp,backendName:"webgl",kernelFunc:sCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iCe="return (b >= 0.0) ? a : a * (b + 1.0);",oCe=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,aCe=t=>{const{inputs:e,backend:n}=t,{dy:s,y:r}=e,i=X().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ih(oCe,s.shape,r.shape):new _c(iCe,s.shape,r.shape);return n.runWebGLProgram(i,[s,r],s.dtype)},lCe={kernelName:dE,backendName:"webgl",kernelFunc:aCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cCe=`
  return vec4(equal(a, b));
`,uCe="return float(a == b);",dCe=Gn({opSnippet:uCe,packedOpSnippet:cCe,dtype:"bool",cpuKernelImpl:Uve}),hCe={kernelName:Bb,backendName:"webgl",kernelFunc:dCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fCe=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${DI};
  float a1 = ${OI};
  float a2 = ${MI};
  float a3 = ${PI};
  float a4 = ${LI};
  float a5 = ${FI};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,pCe=rt({opSnippet:fCe}),mCe={kernelName:qp,backendName:"webgl",kernelFunc:pCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gCe=oh+`
  return exp(x);
`,yCe=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,b5=rt({opSnippet:gCe,packedOpSnippet:yCe,cpuKernelImpl:Wve,dtype:"float32"}),xCe={kernelName:Xp,backendName:"webgl",kernelFunc:b5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EC(t){const{inputs:e,attrs:n,backend:s}=t,{dim:r}=n,{input:i}=e,o=i.shape.length,a=i.shape.slice();let l=r;return r<0&&(E(-(o+1)<=r,()=>`Axis must be in the interval [${-(o+1)}, ${o}]`),l=o+r+1),a.splice(l,0,1),ue({inputs:{x:i},backend:s,attrs:{shape:a}})}const bCe={kernelName:jb,backendName:"webgl",kernelFunc:EC};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xM="return exp(x) - 1.0;",vCe=rt({opSnippet:xM,packedOpSnippet:xM,cpuKernelImpl:Hve}),wCe={kernelName:Jp,backendName:"webgl",kernelFunc:vCe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bM{constructor(e,n,s){this.variableNames=["real","imag"];const r=n[1];this.outputShape=n;const i=s?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,o=s?`${r}.0`:"1.0";let a;if(e==="real")a="return real * expR - imag * expI;";else if(e==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${i};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${r});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${r}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${o};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v5(t,e,n){const s=n.texData.get(t.dataId),r=Q(t.shape),i=t.shape[t.shape.length-1],o=r/i,a=ue({inputs:{x:t},backend:n,attrs:{shape:[o,i]}}),l=a.shape,c=new bM("real",l,e),u=new bM("imag",l,e),d=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:l},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:l}],h=n.runWebGLProgram(c,d,"float32"),f=n.runWebGLProgram(u,d,"float32"),p=Al({inputs:{real:h,imag:f},backend:n});n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f);const m=ue({inputs:{x:p},backend:n,attrs:{shape:t.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(p),m}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SCe(t){const{inputs:e,backend:n}=t,{input:s}=e;return v5(s,!1,n)}const kCe={kernelName:hE,backendName:"webgl",kernelFunc:SCe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class CCe{constructor(e,n){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jm(t){const{backend:e,attrs:n}=t,{shape:s,value:r}=n;let{dtype:i}=n;if(i=i||Gd(r),i==="string"){const o=Zt(i,Q(s));return o.fill(r),e.makeTensorInfo(s,i,o)}else{const o=new CCe(s,r),a=[[r]];return e.runWebGLProgram(o,[],i,a)}}const NCe={kernelName:fE,backendName:"webgl",kernelFunc:Jm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class TCe{constructor(e){this.variableNames=["Image"],this.outputShape=[];const n=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${n} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${n}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ECe={kernelName:pE,backendName:"webgl",kernelFunc:({inputs:t,backend:e})=>{const{image:n}=t,s=e,r=new TCe(n.shape);return s.runWebGLProgram(r,[n],n.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vM="return floor(x);",ICe=rt({opSnippet:vM,packedOpSnippet:vM,cpuKernelImpl:Gve}),ACe={kernelName:Yp,backendName:"webgl",kernelFunc:ICe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $Ce=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,RCe=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,DCe=Gn({opSnippet:$Ce,packedOpSnippet:RCe,dtype:"int32"}),OCe={kernelName:Qp,backendName:"webgl",kernelFunc:DCe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class MCe{constructor(e){this.variableNames=["A"];const n=Ns(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${s}.0);

        vec4 values = ${n.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class PCe{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const n=Ns(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${r}.0, ${s}.0);
            vec4 values = ${n.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LCe={kernelName:Mne,backendName:"webgl",kernelFunc:FCe};let vu,Mw=X().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function FCe(t){const{inputs:e,backend:n,attrs:s}=t;let{pixels:r}=e;const{numChannels:i}=s,o=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement,[l,c]=o?[r.videoWidth,r.videoHeight]:[r.width,r.height],u=[c,l],d=[c,l,i];if(a||o){const m=X().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(vu==null||m!==Mw)&&(Mw=m,vu=document.createElement("canvas").getContext("2d",{willReadFrequently:Mw})),vu.canvas.width=l,vu.canvas.height=c,vu.drawImage(r,0,0,l,c),r=vu.canvas}const h=n.makeTensorInfo(u,"int32");n.texData.get(h.dataId).usage=br.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(h.dataId),r);const f=X().getBool("WEBGL_PACK")?new PCe(d):new MCe(d),p=n.runWebGLProgram(f,[h],"int32");return n.disposeData(h.dataId),p}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Ce(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:h,activation:f,leakyreluAlpha:p}=s,m=ca(u),g=Wn(r.shape,i.shape,l,d,c,h,!1,m);let y;const x=[],v=o!=null,w=a!=null,S=f==="leakyrelu",k=()=>{const N=[r,i],T=(I,D)=>{if(D==="NCHW"&&I.shape.length===1&&I.shape[0]!==1){const F=ue({inputs:{x:I},backend:n,attrs:{shape:[I.shape[0],1,1]}});return x.push(F),F}return I};if(v&&N.push(T(o,u)),w&&N.push(T(a,u)),S){const I=n.makeTensorInfo([],"float32",vl(p,"float32"));N.push(I),x.push(I)}return N};if(g.filterHeight===1&&g.filterWidth===1&&g.dilationHeight===1&&g.dilationWidth===1&&g.strideHeight===1&&g.strideWidth===1&&(g.padInfo.type==="SAME"||g.padInfo.type==="VALID"))y=p5({x:r,filter:i,convInfo:g,backend:n,bias:o,activation:f,preluActivationWeights:a,leakyreluAlpha:p});else if(g.strideWidth<=2&&m==="channelsLast"&&X().getBool("WEBGL_EXP_CONV")){const N=f?op(f,!0):null,T=new f5(g,v,N,w,S),I=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],D=k();y=n.runWebGLProgram(T,D,"float32",I)}else if(X().getBool("WEBGL_CONV_IM2COL"))y=m5({x:r,filter:i,convInfo:g,backend:n,bias:o,activation:f,preluActivationWeights:a,leakyreluAlpha:p});else{const N=f?op(f,!1):null,T=new h5(g,v,N,w,S),I=k();y=n.runWebGLProgram(T,I,"float32")}const C=ue({inputs:{x:y},backend:n,attrs:{shape:g.outShape}});return x.push(y),x.forEach(N=>n.disposeIntermediateTensorInfo(N)),C}const zCe={kernelName:N0,backendName:"webgl",kernelFunc:_Ce};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BCe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:i,bias:o,preluActivationWeights:a}=e,{strides:l,pad:c,dilations:u,dimRoundingMode:d,activation:h,leakyreluAlpha:f}=s,p=[];let m=u;m==null&&(m=[1,1]),E(is(l,m),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${m}'`);const g=Wn(r.shape,i.shape,l,m,c,d,!0),y=X().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels===1,x=h?op(h,y):null,v=[r,i],w=o!=null,S=a!=null,k=h==="leakyrelu";if(w&&v.push(o),S&&v.push(a),k){const I=n.makeTensorInfo([],"float32",vl(f,"float32"));v.push(I),p.push(I)}let C;y?C=new x5(g,w,x,S,k):C=new y5(g,w,x,S,k);const N=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],T=n.runWebGLProgram(C,v,"float32",N);return p.forEach(I=>n.disposeIntermediateTensorInfo(I)),T}const jCe={kernelName:yB,backendName:"webgl",kernelFunc:BCe};class VCe{constructor(e,n,s,r){this.sliceDim=e,this.strides=n,this.paramsShape=r,this.variableNames=["x","indices"],this.outputShape=s;const i=gt(s.length);let o=`
    int index;`;for(let a=0;a<this.sliceDim;a++)o+=`
          index = round(getIndices(coords[0], ${a}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};
          flattenIndex += index * ${this.strides[a]};`;this.userCode=`
         void main() {
          ${i} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${o}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UCe(t){const{inputs:e,backend:n}=t,{params:s,indices:r}=e,i=r.shape,o=i[i.length-1],a=Q(s.shape),[l,c,u,d]=wI(s,r),h=ue({inputs:{x:r},backend:n,attrs:{shape:[c,o]}}),f=ue({inputs:{x:s},backend:n,attrs:{shape:[Q(s.shape)/u,u]}});if(n.shouldExecuteOnCPU([s,r])||s.dtype==="string"){const y=n.readSync(r.dataId),x=n.bufferSync(s),v=Kve(y,x,s.dtype,c,o,u,d,s.shape,a);return n.makeTensorInfo(l,s.dtype,v.values)}const p=new VCe(o,d,[c,u],s.shape),m=n.runWebGLProgram(p,[f,h],f.dtype),g=ue({inputs:{x:m},backend:n,attrs:{shape:l}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),g}const WCe={kernelName:Zz,backendName:"webgl",kernelFunc:UCe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class HCe{constructor(e,n){this.variableNames=["A","indices"],this.outputShape=n,this.rank=n.length;const s=gt(this.rank),r=GCe(e);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${r}));
      }
    `}}function GCe(t,e){const n=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[];for(let r=0;r<t.length;r++)r===2?s.push("index"):s.push(`${n[r]}`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w5(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,indices:i}=e,{axis:o,batchDims:a}=s,l=Ge(o,r.shape)[0];if(X().get("DEBUG")){const x=n.readSync(i.dataId),v=r.shape[l];for(let w=0;w<x.length;++w){const S=x[w];E(S<=v-1&&S>=0,()=>`GatherV2: the index value ${S} is not in [0, ${v-1}]`)}}const c=HI(r,i,l,a),u=Q(i.shape),d=[],h=ue({inputs:{x:r},backend:n,attrs:{shape:[c.batchSize,c.outerSize,c.dimSize,c.sliceSize]}}),f=ue({inputs:{x:i},backend:n,attrs:{shape:[c.batchSize,u/c.batchSize]}});d.push(h),d.push(f);const p=[c.batchSize,c.outerSize,u/c.batchSize,c.sliceSize];if(n.shouldExecuteOnCPU([r,i])||r.dtype==="string"){const x=n.bufferSync(f),v=n.bufferSync(h),w=qve(v,x,p);return d.forEach(S=>n.disposeIntermediateTensorInfo(S)),n.makeTensorInfo(c.outputShape,w.dtype,w.values)}const m=new HCe(h.shape,p),g=n.runWebGLProgram(m,[h,f],h.dtype);d.push(g);const y=ue({inputs:{x:g},backend:n,attrs:{shape:c.outputShape}});return d.forEach(x=>n.disposeIntermediateTensorInfo(x)),y}const KCe={kernelName:Ub,backendName:"webgl",kernelFunc:w5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qCe="return float(a > b);",XCe=`
  return vec4(greaterThan(a, b));
`,JCe=Gn({opSnippet:qCe,packedOpSnippet:XCe,cpuKernelImpl:Xve,dtype:"bool"}),YCe={kernelName:Wb,backendName:"webgl",kernelFunc:JCe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QCe="return float(a >= b);",ZCe=`
  return vec4(greaterThanEqual(a, b));
`,eNe=Gn({opSnippet:QCe,packedOpSnippet:ZCe,dtype:"bool",cpuKernelImpl:Jve}),tNe={kernelName:Zp,backendName:"webgl",kernelFunc:eNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nNe(t){const{inputs:e,backend:n}=t,{input:s}=e;return v5(s,!0,n)}const sNe={kernelName:mE,backendName:"webgl",kernelFunc:nNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rNe="return float(!isnan(x) && !isinf(x));",iNe=rt({opSnippet:rNe,dtype:"bool"}),oNe={kernelName:tm,backendName:"webgl",kernelFunc:iNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aNe="return float(isinf(x));",lNe=rt({opSnippet:aNe,dtype:"bool"}),cNe={kernelName:nm,backendName:"webgl",kernelFunc:lNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uNe="return float(isnan(x));",dNe=rt({opSnippet:uNe,dtype:"bool"}),hNe={kernelName:sm,backendName:"webgl",kernelFunc:dNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fNe="return float(a < b);",pNe=`
  return vec4(lessThan(a, b));
`,mNe=Gn({opSnippet:fNe,packedOpSnippet:pNe,cpuKernelImpl:Yve,dtype:"bool"}),gNe={kernelName:Gb,backendName:"webgl",kernelFunc:mNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yNe="return float(a <= b);",xNe=`
  return vec4(lessThanEqual(a, b));
`,bNe=Gn({opSnippet:yNe,packedOpSnippet:xNe,cpuKernelImpl:Qve,dtype:"bool"}),vNe={kernelName:Kb,backendName:"webgl",kernelFunc:bNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wNe(t){const{backend:e,attrs:n}=t,{start:s,stop:r,num:i}=n,o=Zve(s,r,i);return e.makeTensorInfo([o.length],"float32",o)}const SNe={kernelName:eB,backendName:"webgl",kernelFunc:wNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kNe=oh+`
  return x < 0.0 ? 0./0. : log(x);
`,CNe=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,NNe=rt({opSnippet:kNe,packedOpSnippet:CNe,cpuKernelImpl:e1e}),TNe={kernelName:rm,backendName:"webgl",kernelFunc:NNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ENe=oh+`
  return log(1.0 + x);
`,INe=rt({opSnippet:ENe}),ANe={kernelName:im,backendName:"webgl",kernelFunc:INe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $Ne="return float(a >= 1.0 && b >= 1.0);",RNe=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,DNe=Gn({opSnippet:$Ne,packedOpSnippet:RNe,dtype:"bool"}),ONe={kernelName:qb,backendName:"webgl",kernelFunc:DNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MNe="return float(!(x >= 1.0));",PNe=rt({opSnippet:MNe}),LNe={kernelName:Xb,backendName:"webgl",kernelFunc:PNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FNe="return float(a >= 1.0 || b >= 1.0);",_Ne=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,zNe=Gn({opSnippet:FNe,packedOpSnippet:_Ne,dtype:"bool"}),BNe={kernelName:Jb,backendName:"webgl",kernelFunc:zNe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jNe{constructor(e,n,s,r,i){this.variableNames=["x"],this.outputShape=[];const o=n,a=e[3]-1;this.outputShape=e;let l;const c=`float(${s}) + float(${r}) * sum`;i===.5?l=`inversesqrt(${c})`:i===1?l=`1.0/(${c})`:l=`exp(log(${c}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${o}; j <= ${o}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${l};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class VNe{constructor(e,n,s,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const o=n,a=e[3]-1;this.outputShape=e;let l;const c=`float(${s}) + float(${r}) * sum`;i===.5?l=`inversesqrt(${c})`:i===1?l=`1.0/(${c})`:l=`exp(log(${c}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${o};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${o}; j <= ${o}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${l};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UNe=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{depthRadius:i,bias:o,alpha:a,beta:l}=s,c=X().getBool("WEBGL_PACK_NORMALIZATION")?new VNe(r.shape,i,o,a,l):new jNe(r.shape,i,o,a,l);return n.runWebGLProgram(c,[r],r.dtype)},WNe={kernelName:Yb,backendName:"webgl",kernelFunc:UNe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class HNe{constructor(e,n,s,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=n,this.bias=s,this.alpha=r,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${n})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${n} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${r}) * norm + float(${s});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${r})
                * float(${i})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${i});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GNe=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:r,y:i,dy:o}=e,{depthRadius:a,bias:l,alpha:c,beta:u}=s,d=new HNe(r.shape,a,l,c,u);return n.runWebGLProgram(d,[r,i,o],r.dtype)},KNe={kernelName:yE,backendName:"webgl",kernelFunc:GNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qNe(t,e,n,s){const r=Q(e),o=Q(t.shape)/r,a=ue({inputs:{x:t},attrs:{shape:[o,r]},backend:s}),l=ou(a,t.dtype,"max",s),c=ue({inputs:{x:l},attrs:{shape:n},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(l),c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S5(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{reductionIndices:i,keepDims:o}=s,a=r.shape.length,l=Ge(i,r.shape);let c=l;const u=Bt(c,a),d=u!=null,h=n.shouldExecuteOnCPU([r]);let f=r;if(d){if(h){const v=n.texData.get(f.dataId).values,w=new Array(a);for(let C=0;C<w.length;C++)w[C]=r.shape[u[C]];const S=E2(v,r.shape,r.dtype,u,w);f=n.makeTensorInfo(w,r.dtype);const k=n.texData.get(f.dataId);k.values=S}else f=Qv(r,u,n);c=nn(c.length,a)}Hn("max",c,a);const[p,m]=Dn(f.shape,c);let g=p;o&&(g=cn(p,l));let y;if(h){const v=n.texData.get(f.dataId).values,w=t1e(v,Q(m),g,r.dtype);y=n.makeTensorInfo(g,r.dtype);const S=n.texData.get(y.dataId);S.values=w}else y=qNe(f,m,g,n);return d&&n.disposeIntermediateTensorInfo(f),y}const XNe={kernelName:Qb,backendName:"webgl",kernelFunc:S5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JNe=I2+`
  return max(a, b);
`,YNe=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+iu+`
  return result;
`,QNe=Gn({opSnippet:JNe,packedOpSnippet:YNe,cpuKernelImpl:n1e}),ZNe={kernelName:om,backendName:"webgl",kernelFunc:QNe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eTe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e;Km(r,"maxPool");const{filterSize:i,strides:o,pad:a,dimRoundingMode:l}=s,c=1;E(is(o,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);const u=ai(r.shape,i,o,c,a,l);if(u.filterWidth===1&&u.filterHeight===1&&ct(u.inShape,u.outShape))return ur({inputs:{x:r},backend:n});const d=new ap(u,"max",!1);return n.runWebGLProgram(d,[r],r.dtype)}const tTe={kernelName:Zb,backendName:"webgl",kernelFunc:eTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nTe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{filterSize:i,strides:o,pad:a,dataFormat:l,dimRoundingMode:c}=s,u=[1,1,1],d=la(r.shape,i,o,u,a,c,l),h=new $2(d,"max",!1);return n.runWebGLProgram(h,[r],r.dtype)}const sTe={kernelName:ev,backendName:"webgl",kernelFunc:nTe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rTe{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const n=e.strideHeight,s=e.strideWidth,r=e.dilationHeight,i=e.effectiveFilterHeight,o=e.effectiveFilterWidth,a=i-1-e.padInfo.top,l=o-1-e.padInfo.left,c=i*o-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${i};
          wR += ${r}) {
          float dyR = float(dyRCorner + wR) / ${n}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${o}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${c} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${o} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class iTe{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const n=e.strideDepth,s=e.strideHeight,r=e.strideWidth,i=e.dilationDepth,o=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterDepth,c=e.effectiveFilterHeight,u=e.effectiveFilterWidth,d=l-1-e.padInfo.front,h=c-1-e.padInfo.top,f=u-1-e.padInfo.left,p=l*c*u-1;this.userCode=`
      const ivec3 pads = ivec3(${d}, ${h}, ${f});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${l};
           wD += ${i}) {
          float dyD = float(dyDCorner + wD) / ${n}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${c};
              wR += ${o}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${u};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${r}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${p} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${c} * ${u} +
                  wR * ${u} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oTe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:i}=e,o=i,{filterSize:a,strides:l,pad:c,dimRoundingMode:u}=s,d=[1,1,1],h=la(o.shape,a,l,d,c,u),f=new $2(h,"max",!0),p=n.runWebGLProgram(f,[o],o.dtype),m=new iTe(h),g=n.runWebGLProgram(m,[r,p],o.dtype);return n.disposeIntermediateTensorInfo(p),g}const aTe={kernelName:bE,backendName:"webgl",kernelFunc:oTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lTe(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:i,output:o}=e,a=i;Km([i,o],"maxPoolGrad");const{filterSize:l,strides:c,pad:u,dimRoundingMode:d}=s,h=ai(a.shape,l,c,1,u,d),f=!0,p=new ap(h,"max",f),m=n.runWebGLProgram(p,[a],a.dtype),g=new rTe(h),y=n.runWebGLProgram(g,[r,m],a.dtype);return n.disposeIntermediateTensorInfo(m),y}const cTe={kernelName:xE,backendName:"webgl",kernelFunc:lTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uTe(t,e,n,s){let r=new ap(n,"max",!1);const i=s.runWebGLProgram(r,[t],"float32");r=new ap(n,"max",!0,!0,e);const o=s.runWebGLProgram(r,[t],"float32");return[i,o]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dTe={kernelName:tB,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:s}=t,{filterSize:r,strides:i,pad:o,includeBatchInIndex:a}=e,l=n;E(s.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${s.shape.length}.`);const c=[1,1];E(is(i,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${c}'`);const u=ai(s.shape,r,i,c,o),[d,h]=uTe(s,a,u,l);return[d,h]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hTe(t,e,n,s){const r=Q(e),o=Q(t.shape)/r,a=ue({inputs:{x:t},attrs:{shape:[o,r]},backend:s}),l=ou(a,"float32","mean",s),c=ue({inputs:{x:l},attrs:{shape:n},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(l),c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fTe={kernelName:tv,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:s}=t,{keepDims:r,axis:i}=e,o=n,a=s.shape.length,l=Ge(i,s.shape);let c=l;const u=Bt(c,a),d=u!=null,h=o.shouldExecuteOnCPU([s]),f=[];let p=s;if(d){if(h){const w=o.texData.get(p.dataId).values,S=new Array(a);for(let N=0;N<S.length;N++)S[N]=s.shape[u[N]];const k=E2(w,s.shape,s.dtype,u,S);p=o.makeTensorInfo(S,s.dtype);const C=o.texData.get(p.dataId);C.values=k}else p=Qv(s,u,o);f.push(p),c=nn(c.length,a)}Hn("sum",c,a);const[m,g]=Dn(p.shape,c);let y=m;r&&(y=cn(m,l));const x=hTe(p,g,y,o);for(const v of f)o.disposeIntermediateTensorInfo(v);return x}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pTe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=Ge(i,r.shape);let c=l;const u=Bt(c,a);let d=r;u!=null&&(d=ks({inputs:{x:r},backend:n,attrs:{perm:u}}),c=nn(c.length,r.shape.length)),Hn("min",c,a);const[h,f]=Dn(d.shape,c),p=Q(f),m=ue({inputs:{x:d},backend:n,attrs:{shape:[-1,p]}}),g=ou(m,m.dtype,"min",n);let y;if(o){const x=cn(h,l);y=ue({inputs:{x:g},backend:n,attrs:{shape:x}})}else y=ue({inputs:{x:g},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),u!=null&&n.disposeIntermediateTensorInfo(d),y}const mTe={kernelName:nv,backendName:"webgl",kernelFunc:pTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gTe=I2+`
  return min(a, b);
`,yTe=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+iu+`
  return result;
`,xTe=Gn({opSnippet:gTe,packedOpSnippet:yTe,cpuKernelImpl:s1e}),bTe={kernelName:am,backendName:"webgl",kernelFunc:xTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vTe{constructor(e,n,s){this.variableNames=["x"],this.outputShape=n.map((u,d)=>u[0]+e[d]+u[1]);const r=e.length,i=gt(r),o=n.map(u=>u[0]).join(","),a=n.map((u,d)=>u[0]+e[d]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),c=s==="reflect"?0:1;if(r===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${c};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${c};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${o});
      ${i} end = ${i}(${a});

      void main() {
        ${i} outC = getOutputCoords();
        for (int i = 0; i < ${r}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${c};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${c};
          }
        }
        ${i} coords = outC - start;
        setOutput(getX(${l}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wTe{constructor(e,n,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((p,m)=>p[0]+e[m]+p[1]);const r=e.length,i=gt(r),o=n.map(p=>p[0]).join(","),a=n.map((p,m)=>p[0]+e[m]).join(","),l=xs("rc",r),c=xs("source",r),u=`${l[r-1]} < ${this.outputShape[r-1]}`,d=r===1?"source":`vec2(${c.slice(-2).join()})`,h=s==="reflect"?0:1;let f="";if(r===1){const p=`
        ${i} source = rc;
        if (source < start) {
          source = start * 2 - source - ${h};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${h};
        }
        source -= start;
      `;f=`
        ${i} rc = outputLoc;
        ${p}
        result[0] = getChannel(getX(${c.join()}), ${d});
        ${l[r-1]} += 1;
        if(${u}) {
          ${p}
          result[1] = getChannel(getX(${c.join()}), ${d});
        }
      `}else{const p=`
        ${i} source = rc;
        ${i} lt = ${i}(lessThan(source, start));
        ${i} gte = ${i}(greaterThanEqual(source, end));
        ${i} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${h}) +
                gte * ((end - 1) * 2 - source + ${h});
        source -= start;
      `;f=`
        ${i} rc = outputLoc;
        ${p}
        result[0] = getChannel(getX(${c.join()}), ${d});
        ${l[r-1]} += 1;
        if(${u}) {
          ${p}
          result[1] = getChannel(getX(${c.join()}), ${d});
        }
        rc = outputLoc;
        ${l[r-2]} += 1;
        if(${l[r-2]} < ${this.outputShape[r-2]}) {
          ${p}
          result[2] = getChannel(getX(${c.join()}), ${d});
          ${l[r-1]} += 1;
          if(${u}) {
            ${p}
            result[3] = getChannel(getX(${c.join()}), ${d});
          }
        }
      `}this.userCode=`
      const ${i} start = ${i}(${o});
      const ${i} end = ${i}(${a});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${f}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const STe=({inputs:t,backend:e,attrs:n})=>{const{x:s}=t,{paddings:r,mode:i}=n,o=X().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new wTe(s.shape,r,i):new vTe(s.shape,r,i);return e.runWebGLProgram(o,[s],s.dtype)},kTe={kernelName:sv,backendName:"webgl",kernelFunc:STe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CTe=`if (b == 0.0) return NAN;
  return mod(a, b);`,NTe=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+iu+`
  return result;
`,TTe=Gn({opSnippet:CTe,packedOpSnippet:NTe}),ETe={kernelName:lm,backendName:"webgl",kernelFunc:TTe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ITe{constructor(e,n,s){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,s],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${n-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${n-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ATe=`
if (a == b) {
  return 1.0;
};
return a / b;`,$Te=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,k5=Gn({opSnippet:ATe,packedOpSnippet:$Te,checkOutOfBounds:!0}),RTe={kernelName:Gp,backendName:"webgl",kernelFunc:k5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wM="return a - b;",C5=Gn({opSnippet:wM,packedOpSnippet:wM,supportsComplex:!0,cpuKernelImpl:C1e}),DTe={kernelName:Cm,backendName:"webgl",kernelFunc:C5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N5(t){const{inputs:e,backend:n,attrs:s}=t,{logits:r}=e,{dim:i}=s,o=Ge([i],r.shape),a=S5({inputs:{x:r},backend:n,attrs:{reductionIndices:o,keepDims:!1}}),l=cn(a.shape,o),c=ue({inputs:{x:a},backend:n,attrs:{shape:l}}),u=C5({inputs:{a:r,b:c},backend:n}),d=b5({inputs:{x:u},backend:n}),h=Zv({inputs:{x:d},backend:n,attrs:{axis:o,keepDims:!1}}),f=ue({inputs:{x:h},backend:n,attrs:{shape:l}}),p=k5({inputs:{a:d,b:f},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),p}const OTe={kernelName:wv,backendName:"webgl",kernelFunc:N5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MTe(t){const{inputs:e,backend:n,attrs:s}=t,{logits:r}=e,{numSamples:i,seed:o,normalized:a}=s,l=a?r:N5({inputs:{logits:r},backend:n,attrs:{dim:r.shape.length-1}}),c=l.shape[0],u=l.shape[1],d=new ITe(c,u,i),h=[[o]],f=n.runWebGLProgram(d,[l],"int32",h);return a||n.disposeIntermediateTensorInfo(l),f}const PTe={kernelName:nB,backendName:"webgl",kernelFunc:MTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LTe=ci+`
  return -x;
`,FTe=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function _Te(t){const{inputs:e,backend:n}=t,{x:s}=e;if(n.shouldExecuteOnCPU([s])){const i=n.texData.get(s.dataId),[o,a]=i1e(i.values,s.shape,s.dtype);return n.makeTensorInfo(a,s.dtype,o)}let r;return X().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new Oa(s.shape,FTe):r=new to(s.shape,LTe),n.runWebGLProgram(r,[s],s.dtype)}const zTe={kernelName:rv,backendName:"webgl",kernelFunc:_Te};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BTe=mI;function jTe(t){gr("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l}=s,c=n.readSync(r.dataId),u=n.readSync(i.dataId),{selectedIndices:d}=BTe(c,u,o,a,l);return n.makeTensorInfo([d.length],"int32",new Int32Array(d))}const VTe={kernelName:vE,backendName:"webgl",kernelFunc:jTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UTe=gI;function WTe(t){gr("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:c}=s,u=n.readSync(r.dataId),d=n.readSync(i.dataId),{selectedIndices:h,validOutputs:f}=UTe(u,d,o,a,l,c);return[n.makeTensorInfo([h.length],"int32",new Int32Array(h)),n.makeTensorInfo([],"int32",new Int32Array([f]))]}const HTe={kernelName:wE,backendName:"webgl",kernelFunc:WTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GTe=yI;function KTe(t){gr("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:i}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:l,softNmsSigma:c}=s,u=n.readSync(r.dataId),d=n.readSync(i.dataId),h=o,f=a,p=l,m=c,{selectedIndices:g,selectedScores:y}=GTe(u,d,h,f,p,m);return[n.makeTensorInfo([g.length],"int32",new Int32Array(g)),n.makeTensorInfo([y.length],"float32",new Float32Array(y))]}const qTe={kernelName:SE,backendName:"webgl",kernelFunc:KTe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class XTe{constructor(e,n,s,r){this.variableNames=["indices"],this.outputShape=[e,n],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${r}), float(${s}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JTe=t=>{const{inputs:e,backend:n,attrs:s}=t,{indices:r}=e,{dtype:i,depth:o,onValue:a,offValue:l}=s,c=Q(r.shape),u=new XTe(c,o,a,l),d=ue({inputs:{x:r},backend:n,attrs:{shape:[c]}}),h=n.runWebGLProgram(u,[d],i);n.disposeIntermediateTensorInfo(d);const f=[...r.shape,o],p=ue({inputs:{x:h},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(h),p},YTe={kernelName:av,backendName:"webgl",kernelFunc:JTe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z0(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="complex64"){const r=Xm({inputs:{input:s},backend:n}),i=Z0({inputs:{x:r},backend:n}),o=e1({inputs:{input:s},backend:n}),a=Z0({inputs:{x:o},backend:n}),l=Al({inputs:{real:i,imag:a},backend:n});return n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),l}else return Jm({attrs:{shape:s.shape,dtype:s.dtype,value:s.dtype==="string"?"":0},backend:n})}const QTe={kernelName:Cv,backendName:"webgl",kernelFunc:Z0};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T5(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(s.dtype==="complex64"){const r=Xm({inputs:{input:s},backend:n}),i=T5({inputs:{x:r},backend:n}),o=e1({inputs:{input:s},backend:n}),a=Z0({inputs:{x:o},backend:n}),l=Al({inputs:{real:i,imag:a},backend:n});return n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(a),l}else return Jm({attrs:{shape:s.shape,dtype:s.dtype,value:1},backend:n})}const ZTe={kernelName:ov,backendName:"webgl",kernelFunc:T5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eEe(t){const{inputs:e,backend:n,attrs:s}=t,{axis:r}=s;if(e.length===1)return EC({inputs:{input:e[0]},backend:n,attrs:{dim:r}});const i=e[0].shape,o=e[0].dtype;e.forEach(u=>{UT(i,u.shape,"All tensors passed to stack must have matching shapes"),E(o===u.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(u=>{const d=EC({inputs:{input:u},backend:n,attrs:{dim:r}});return a.push(d),d}),c=d5({inputs:l,backend:n,attrs:{axis:r}});return a.forEach(u=>n.disposeIntermediateTensorInfo(u)),c}const tEe={kernelName:lv,backendName:"webgl",kernelFunc:eEe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nEe{constructor(e,n,s){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((c,u)=>c[0]+e[u]+c[1]);const r=e.length,i=gt(r),o=n.map(c=>c[0]).join(","),a=n.map((c,u)=>c[0]+e[u]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);if(r===1){this.userCode=`
        int start = ${o};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${o});
      ${i} end = ${i}(${a});

      void main() {
        ${i} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${i} coords = outC - start;
          setOutput(getX(${l}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sEe{constructor(e,n,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((m,g)=>m[0]+e[g]+m[1]);const r=e.length,i=gt(r),o=n.map(m=>m[0]).join(","),a=n.map((m,g)=>m[0]+e[g]).join(","),l=xs("rc",r),c=xs("source",r),u=`${l[r-1]} < ${this.outputShape[r-1]}`,d=r===1?"source":`vec2(${c.slice(-2).join()})`,h=[`${i} rc = outputLoc;`,`${l[r-1]} += 1;
       if(${u}) {
      `,r===1?"":`}
       rc = outputLoc;
       ${l[r-2]} += 1;
       if(${l[r-2]} < ${this.outputShape[r-2]}) {`,r===1?"":`  ${l[r-1]} += 1;
         if(${u}) {`],f=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let p="";for(let m=0,g=r===1?2:4;m<g;m++)p+=`
        ${h[m]}
        if (${f}) {
          result[${m}] = float(value);
        } else {
          ${i} source = rc - start;
          result[${m}] = getChannel(getX(${c.join()}), ${d});
        }
      `;p+=r===1?"} ":"}}",this.userCode=`
      const ${i} start = ${i}(${o});
      const ${i} end = ${i}(${a});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${p}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const E5=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{paddings:i,constantValue:o}=s;if(Q(r.shape)===0){const c=i.map((u,d)=>u[0]+r.shape[d]+u[1]);return Jm({backend:n,attrs:{shape:c,value:o,dtype:r.dtype}})}const a=X().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new sEe(r.shape,i,o):new nEe(r.shape,i,o),l=[[o]];return n.runWebGLProgram(a,[r],r.dtype,l)},rEe={kernelName:cv,backendName:"webgl",kernelFunc:E5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iEe=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,oEe=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+iu+`
  return result;
`,aEe=Gn({opSnippet:iEe,packedOpSnippet:oEe}),lEe={kernelName:um,backendName:"webgl",kernelFunc:aEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cEe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:i,keepDims:o}=s,a=r.shape.length,l=[],c=Ge(i,r.shape);let u=c;const d=Bt(u,a);let h=r;d!=null&&(h=ks({inputs:{x:r},backend:n,attrs:{perm:d}}),u=nn(u.length,a),l.push(h)),Hn("prod",u,a);let f;if(n.shouldExecuteOnCPU([h])){const p=n.texData.get(h.dataId).values,{outVals:m,outShape:g,outDtype:y}=a1e(h.shape,h.dtype,p,u);f=n.makeTensorInfo(g,y,m)}else{const[p,m]=Dn(h.shape,u),g=Q(m),y=ue({inputs:{x:h},backend:n,attrs:{shape:[-1,g]}}),x=PE(r.dtype),v=ou(y,x,"prod",n);f=ue({inputs:{x:v},backend:n,attrs:{shape:p}}),l.push(y),l.push(v)}if(o){l.push(f);const p=cn(f.shape,c);f=ue({inputs:{x:f},backend:n,attrs:{shape:p}})}return l.forEach(p=>n.disposeIntermediateTensorInfo(p)),f}const uEe={kernelName:dv,backendName:"webgl",kernelFunc:cEe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dEe(t){const{inputs:e,backend:n,attrs:s}=t,{paramsNestedSplits:r,paramsDenseValues:i,indices:o}=e,{outputRaggedRank:a}=s,l=r.map(y=>n.readSync(y.dataId)),c=r.map(y=>y.shape),u=n.readSync(i.dataId),d=n.readSync(o.dataId),[h,f,p]=l1e(l,c,u,i.shape,i.dtype,d,o.shape,a),m=h.map(y=>n.makeTensorInfo([y.length],"int32",y)),g=n.makeTensorInfo(p,i.dtype,f);return m.concat([g])}const hEe={kernelName:sB,backendName:"webgl",kernelFunc:dEe};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fEe(t){const{inputs:e,backend:n}=t,{starts:s,limits:r,deltas:i}=e,o=n.readSync(s.dataId),a=n.readSync(r.dataId),l=n.readSync(i.dataId),[c,u]=c1e(o,s.shape,s.dtype,a,r.shape,l,i.shape),d=n.makeTensorInfo([c.length],"int32",c),h=n.makeTensorInfo([u.length],s.dtype,u);return[d,h]}const pEe={kernelName:rB,backendName:"webgl",kernelFunc:fEe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mEe(t){const{inputs:e,backend:n,attrs:s}=t,{shape:r,values:i,defaultValue:o,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=s,c=n.readSync(r.dataId),u=n.readSync(i.dataId),d=n.readSync(o.dataId),h=a.map(g=>n.readSync(g.dataId)),f=a.map(g=>g.shape),[p,m]=u1e(c,r.shape,u,i.shape,i.dtype,d,o.shape,h,f,l);return n.makeTensorInfo(p,i.dtype,m)}const gEe={kernelName:iB,backendName:"webgl",kernelFunc:mEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I5=t=>{const{backend:e,attrs:n}=t,{start:s,stop:r,step:i,dtype:o}=n,a=d1e(s,r,i,o);return e.makeTensorInfo([a.length],o,a)},yEe={kernelName:kE,backendName:"webgl",kernelFunc:I5};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xEe="return 1.0 / x;",bEe=rt({opSnippet:xEe}),vEe={kernelName:dm,backendName:"webgl",kernelFunc:bEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wEe=ci+`
  return (x < 0.0) ? 0.0 : x;
`,SEe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,kEe=rt({opSnippet:wEe,packedOpSnippet:SEe}),CEe={kernelName:hm,backendName:"webgl",kernelFunc:kEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NEe=ci+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,TEe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,EEe=rt({opSnippet:NEe,packedOpSnippet:TEe}),IEe={kernelName:fm,backendName:"webgl",kernelFunc:EEe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class AEe{constructor(e,n,s,r,i){this.variableNames=["A"],this.outputShape=[];const[o,a,l,c]=e;this.outputShape=[o,n,s,c];const u=[r&&n>1?a-1:a,r&&s>1?l-1:l],d=[r&&n>1?n-1:n,r&&s>1?s-1:s];let h;i?h="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":h="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${u[0]/d[0]},
          ${u[1]/d[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${h};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $Ee{constructor(e,n,s,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,l,c]=e;this.outputShape=[o,n,s,c];const u=[r&&n>1?a-1:a,r&&s>1?l-1:l],d=[r&&n>1?n-1:n,r&&s>1?s-1:s];let h;i?h="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":h="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${u[0]/d[0]},
          ${u[1]/d[1]},
          ${u[1]/d[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${h};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${s-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function REe(t){const{inputs:e,backend:n,attrs:s}=t,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s,[l,c]=a,u=X().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new $Ee(r.shape,l,c,i,o):new AEe(r.shape,l,c,i,o);return n.runWebGLProgram(u,[r],"float32")}const DEe={kernelName:pv,backendName:"webgl",kernelFunc:REe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class OEe{constructor(e,n,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,r,i]=n,[,o,a]=e,l=[s&&o>1?r-1:r,s&&a>1?i-1:i],c=[s&&o>1?o-1:o,s&&a>1?a-1:a],u=l[0]/c[0],d=l[1]/c[1],h=1/u,f=1/d,p=Math.ceil(h)*2+2,m=Math.ceil(f)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${u});
        const float widthScale = float(${d});

        const float invHeightScale = float(${h});
        const float invWidthScale = float(${f});

        const int winHeight = int(${p});
        const int winWidth = int(${m});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${r-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${i-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MEe(t){const{inputs:e,backend:n,attrs:s}=t,{images:r,dy:i}=e,{alignCorners:o}=s,a=new OEe(i.shape,r.shape,o);return n.runWebGLProgram(a,[i],i.dtype)}const PEe={kernelName:TE,backendName:"webgl",kernelFunc:MEe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class LEe{constructor(e,n,s,r,i){this.variableNames=["A"],this.outputShape=[];const[o,a,l,c]=e;this.outputShape=[o,n,s,c];const u=[r&&n>1?a-1:a,r&&s>1?l-1:l],d=[r&&n>1?n-1:n,r&&s>1?s-1:s],h=r?"0.5":"0.0";let f;i?f="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":f="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${u[0]/d[0]},
          ${u[1]/d[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${f};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${h})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class FEe{constructor(e,n,s,r,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[o,a,l,c]=e;this.outputShape=[o,n,s,c];const u=[r&&n>1?a-1:a,r&&s>1?l-1:l],d=[r&&n>1?n-1:n,r&&s>1?s-1:s],h=r?"0.5":"0.0";let f;i?f="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":f="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${u[0]/d[0]},
          ${u[1]/d[1]},
          ${u[1]/d[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${f};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${h})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${s-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Ee(t){const{inputs:e,backend:n,attrs:s}=t,{images:r}=e,{alignCorners:i,halfPixelCenters:o,size:a}=s,[l,c]=a,u=X().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new FEe(r.shape,l,c,i,o):new LEe(r.shape,l,c,i,o);return n.runWebGLProgram(u,[r],r.dtype)}const zEe={kernelName:fv,backendName:"webgl",kernelFunc:_Ee};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class BEe{constructor(e,n,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,r,i]=n,[,o,a]=e,l=[s&&o>1?r-1:r,s&&a>1?i-1:i],c=[s&&o>1?o-1:o,s&&a>1?a-1:a],u=l[0]/c[0],d=l[1]/c[1],h=1/u,f=1/d,p=Math.ceil(h)*2+2,m=Math.ceil(f)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${u});
        const float widthScale = float(${d});

        const float invHeightScale = float(${h});
        const float invWidthScale = float(${f});

        const int winHeight = int(${p});
        const int winWidth = int(${m});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${o}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${l[0]}) *
                (float(dyR) / float(${c[0]}));

            float sourceFracCol =
                float(${l[1]}) *
                  (float(dyC) / float(${c[1]}));

            int sourceNearestRow = int(min(
                float(int(${r}) - 1),
                ${s} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${i}) - 1),
                ${s} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jEe(t){const{inputs:e,backend:n,attrs:s}=t,{images:r,dy:i}=e,{alignCorners:o}=s,a=new BEe(i.shape,r.shape,o);return n.runWebGLProgram(a,[i],i.dtype)}const VEe={kernelName:NE,backendName:"webgl",kernelFunc:jEe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class UEe{constructor(e,n){this.variableNames=["x"];const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);if(this.outputShape=e,s===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}const r=a=>n.indexOf(a)!==-1&&e[a]!==1?`${e[a]} - coords[${a}] - 1`:`coords[${a}]`,i=e.map((a,l)=>r(l)).join(","),o=gt(s);this.userCode=`
      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${i}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class WEe{constructor(e,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);this.outputShape=e;const r=xs("rc",s),i=`${r[s-1]} + 1 < ${this.outputShape[s-1]}`,o=`${r[s-2]} + 1 < ${this.outputShape[s-2]}`,a=gt(s);s===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${i}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${l(r.slice())};
          if(${i}){
            result.g = ${c(r.slice())};
          }
          if(${o}) {
            result.b = ${u(r.slice())};
            if(${i}) {
              result.a = ${d(r.slice())};
            }
          }
          setOutput(result);
        }
    `;function l(p){return h(p)}function c(p){return p[s-1]="("+p[s-1]+" + 1)",h(p)}function u(p){return p[s-2]="("+p[s-2]+" + 1)",h(p)}function d(p){return p[s-1]="("+p[s-1]+" + 1)",p[s-2]="("+p[s-2]+" + 1)",h(p)}function h(p){const m=e.map((x,v)=>f(v,p)),g=m.join(","),y=m.slice(-2).join(",");return`getChannel(getX(${g}), vec2(${y}))`}function f(p,m){return n.indexOf(p)!==-1&&e[p]!==1?`${e[p]} - ${m[p]} - 1`:`${m[p]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HEe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{dims:i}=s,o=r.shape.length,a=Ge(i,r.shape);if(o===0)return ur({inputs:{x:r},backend:n});const l=X().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new WEe(r.shape,a):new UEe(r.shape,a);return n.runWebGLProgram(l,[r],r.dtype)}const GEe={kernelName:mv,backendName:"webgl",kernelFunc:HEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class KEe{constructor(e,n){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const s=e[1],r=e[2];this.outputShape=e;let i="";typeof n=="number"?i=`float outputValue = ${n.toFixed(2)};`:i=`
        vec3 fill = vec3(${n.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${i}
          if(coordX >= 0 && coordX < ${r} && coordY >= 0 && coordY < ${s}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qEe={kernelName:OE,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:s}=t,{radians:r,fillValue:i,center:o}=e,a=n,l=new KEe(s.shape,i),[c,u]=AI(o,s.shape[1],s.shape[2]),d=[[c,u,Math.sin(r),Math.cos(r)]];return a.runWebGLProgram(l,[s],s.dtype,d)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XEe=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,JEe=rt({opSnippet:XEe}),YEe={kernelName:pm,backendName:"webgl",kernelFunc:JEe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QEe="return inversesqrt(x);",ZEe=rt({opSnippet:QEe,cpuKernelImpl:h1e}),eIe={kernelName:mm,backendName:"webgl",kernelFunc:ZEe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class R2{constructor(e,n,s,r,i,o,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;const c=gt(i.length),u=gt(o.length);let d="";s===1?d="i":s===2&&(d="i, j");const h=`getIndices(${d})`;let f="";r===1?f="i":r===2&&(f="i, coords[1]");const p=`getUpdates(${f})`;let m="";l&&(m="coords[0], coords[1]");const g=`getDefaultValue(${m})`,y=n>1?"strides[j]":"strides";this.userCode=`
        ${c} strides = ${c}(${i});

        void main() {
          ${u} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${n}; j++) {
              int index = round(${h});
              flattenedIndex += index * ${y};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${p};
              found = true;
            }
          }
          setOutput(mix(${g}, sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tIe{constructor(e,n,s,r,i,o,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=o;const c=gt(i.length),u=gt(o.length);let d="";s===1?d="i":s===2&&(d="i, j");const h=`getIndices(${d})`;let f="";r===1?f="i":r===2&&(f="i, coords[1]");const p=`getUpdates(${f})`;let m="";l&&(m="coords[0], coords[1]");const g=`getDefaultValue(${m})`,y=n>1?"strides[j]":"strides",x=n>1?"strides[j + 1]":"strides";this.userCode=`
        ${c} strides = ${c}(${i});

        void main() {
          ${u} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${e}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${n}; j+=2) {
              ivec4 index = round(${h});
              flattenedIndex += index.xz * ${y};
              if (j + 1 < ${n}) {
                flattenedIndex += index.yw * ${x};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${p};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${g}, sum, found));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nIe(t){const{inputs:e,backend:n,attrs:s}=t,{indices:r,updates:i}=e,{shape:o}=s,{sliceRank:a,numUpdates:l,sliceSize:c,strides:u,outputSize:d}=eu(i,r,o),h=[d/c,c];if(d===0)return n.makeTensorInfo(o,r.dtype);const f=ue({inputs:{x:r},backend:n,attrs:{shape:[l,a]}}),p=ue({inputs:{x:i},backend:n,attrs:{shape:[l,c]}}),m=n.makeTensorInfo([],"float32",new Float32Array([0]));let g;X().getBool("WEBGL_PACK")?g=new tIe(l,a,f.shape.length,p.shape.length,u,h):g=new R2(l,a,f.shape.length,p.shape.length,u,h);const y=n.runWebGLProgram(g,[p,f,m],p.dtype),x=ue({inputs:{x:y},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(m),x}const sIe={kernelName:oB,backendName:"webgl",kernelFunc:nIe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rIe{constructor(e,n,s,r){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,s];const i="while (left < right) {",o=`for (int i = 0; i < ${Math.ceil(Math.log2(n+1))}; ++i) { if (left >= right) break;`,a=X().getNumber("WEBGL_VERSION")===2?i:o,l=r==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${l} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iIe(t){const{inputs:e,backend:n,attrs:s}=t,{sortedSequence:r,values:i}=e,{side:o}=s,a=new rIe(r.shape[0],r.shape[1],i.shape[1],o),l=[[r.shape[1]]];return n.runWebGLProgram(a,[r,i],"int32",l)}const oIe={kernelName:lB,backendName:"webgl",kernelFunc:iIe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aIe{constructor(e,n,s){this.variableNames=["c","a","b"],this.outputShape=n;let r,i;if(s>4)throw Error(`Where for rank ${s} is not yet supported`);if(s===1)i="resRC",r="resRC";else{const a=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],c=[];for(let u=0;u<n.length;u++)c.push(`${a[u]}`),u<e&&l.push(`${a[u]}`);r=l.join(),i=c.join()}const o=gt(s);this.userCode=`
      void main() {
        ${o} resRC = getOutputCoords();
        float cVal = getC(${r});
        if (cVal >= 1.0) {
          setOutput(getA(${i}));
        } else {
          setOutput(getB(${i}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lIe(t){const{inputs:e,backend:n}=t,{condition:s,t:r,e:i}=e,o=new aIe(s.shape.length,r.shape,r.shape.length);return n.runWebGLProgram(o,[s,r,i],lr(r.dtype,i.dtype))}const cIe={kernelName:gv,backendName:"webgl",kernelFunc:lIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uIe=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${Lv};
  float scale = ${Fv};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,dIe=rt({opSnippet:uIe}),hIe={kernelName:gm,backendName:"webgl",kernelFunc:dIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fIe=oh+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,pIe=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,mIe=rt({opSnippet:fIe,packedOpSnippet:pIe,cpuKernelImpl:p1e}),gIe={kernelName:vm,backendName:"webgl",kernelFunc:mIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yIe=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,xIe=rt({opSnippet:yIe}),bIe={kernelName:bm,backendName:"webgl",kernelFunc:xIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vIe=oh+`
  return sin(x);
`,wIe=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${iu}
  return result;
`,SIe=rt({opSnippet:vIe,packedOpSnippet:wIe}),kIe={kernelName:ym,backendName:"webgl",kernelFunc:SIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CIe=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,NIe=rt({opSnippet:CIe}),TIe={kernelName:xm,backendName:"webgl",kernelFunc:NIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EIe=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,IIe=rt({opSnippet:EIe}),AIe={kernelName:wm,backendName:"webgl",kernelFunc:IIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $Ie=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockShape:i,paddings:o}=s;E(r.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const a=i.reduce((y,x)=>y*x),l=[[0,0]];l.push(...o);for(let y=1+i.length;y<r.shape.length;++y)l.push([0,0]);const c=[],u=E5({inputs:{x:r},backend:n,attrs:{paddings:l,constantValue:0}}),d=Mm(u.shape,i,a,!1),h=Pm(d.length,i.length,!1),f=Lm(u.shape,i,a,!1),p=ue({inputs:{x:u},backend:n,attrs:{shape:d}}),m=ks({inputs:{x:p},backend:n,attrs:{perm:h}}),g=ue({inputs:{x:m},backend:n,attrs:{shape:f}});return c.push(u),c.push(p),c.push(m),c.forEach(y=>n.disposeIntermediateTensorInfo(y)),g},RIe={kernelName:bv,backendName:"webgl",kernelFunc:$Ie};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DIe(t){const{inputs:e,backend:n}=t,{indices:s,values:r,denseShape:i,defaultValue:o}=e;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${i.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${r.shape}`);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${o.shape}`);const a=n.readSync(s.dataId),l=n.readSync(r.dataId),c=n.readSync(i.dataId),u=n.readSync(o.dataId)[0],[d,h,f,p,m]=g1e(a,s.shape,s.dtype,l,r.dtype,c,u);return[n.makeTensorInfo(h,s.dtype,d),n.makeTensorInfo([h[0]],r.dtype,f),n.makeTensorInfo([p.length],"bool",new Uint8Array(p.map(g=>Number(g)))),n.makeTensorInfo([m.length],s.dtype,new Int32Array(m))]}const OIe={kernelName:cB,backendName:"webgl",kernelFunc:DIe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MIe(t){const{inputs:e,backend:n}=t,{inputIndices:s,inputShape:r,newShape:i}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${r.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);const o=Array.from(n.readSync(r.dataId)),a=n.readSync(s.dataId),l=Array.from(n.readSync(i.dataId)),[c,u,d]=y1e(a,s.shape,s.dtype,o,l);return[n.makeTensorInfo(u,s.dtype,c),n.makeTensorInfo([d.length],i.dtype,new Int32Array(d))]}const PIe={kernelName:uB,backendName:"webgl",kernelFunc:MIe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LIe(t){const{inputs:e,backend:n}=t,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${i.shape}`);const o=n.readSync(s.dataId),a=n.readSync(r.dataId),l=n.readSync(i.dataId),[c,u]=QW(o,s.shape,s.dtype,a,l,!0);return n.makeTensorInfo(u,s.dtype,c)}const FIe={kernelName:dB,backendName:"webgl",kernelFunc:LIe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _Ie(t){const{inputs:e,backend:n}=t,{data:s,indices:r,segmentIds:i}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${r.shape}`);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${i.shape}`);const o=n.readSync(s.dataId),a=n.readSync(r.dataId),l=n.readSync(i.dataId),[c,u]=QW(o,s.shape,s.dtype,a,l);return n.makeTensorInfo(u,s.dtype,c)}const zIe={kernelName:hB,backendName:"webgl",kernelFunc:_Ie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BIe(t){const{inputs:e,backend:n,attrs:s}=t,{sparseIndices:r,sparseValues:i,defaultValue:o}=e,{outputShape:a}=s,{sliceRank:l,numUpdates:c,sliceSize:u,strides:d,outputSize:h}=eu(i,r,a),f=!1;if(i.dtype==="string"){const y=n.bufferSync(r),x=n.bufferSync(i),v=ol(n.readSync(o.dataId)[0]),w=f1e(y,x,a,h,u,c,l,d,v,f);return n.makeTensorInfo(a,w.dtype,w.values)}const p=new R2(c,l,r.shape.length,i.shape.length,d,[h,1],f),m=n.runWebGLProgram(p,[i,r,o],i.dtype),g=ue({inputs:{x:m},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(m),g}const jIe={kernelName:fB,backendName:"webgl",kernelFunc:BIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VIe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{numOrSizeSplits:i,axis:o}=s,a=Ge(o,r.shape)[0],l=WI(r,i,a),c=r.shape.length,u=new Array(c).fill(0),d=r.shape.slice();return l.map(h=>{const f=[...d];f[a]=h;const p=ah({inputs:{x:r},backend:n,attrs:{begin:u,size:f}});return u[a]+=h,p})}const UIe={kernelName:vv,backendName:"webgl",kernelFunc:VIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SM="return sqrt(x);",WIe=rt({opSnippet:SM,packedOpSnippet:SM,cpuKernelImpl:x1e}),HIe={kernelName:Sm,backendName:"webgl",kernelFunc:WIe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GIe="return x * x;",KIe=rt({opSnippet:GIe}),qIe={kernelName:EE,backendName:"webgl",kernelFunc:KIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kM="return (a - b) * (a - b);",XIe=Gn({opSnippet:kM,packedOpSnippet:kM}),JIe={kernelName:km,backendName:"webgl",kernelFunc:XIe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YIe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e;if(r.dtype!=="string")throw new Error("Input must be of datatype string");const i=n.readSync(r.dataId),o=ia(i),a=b1e(o,"string",s);return n.makeTensorInfo(r.shape,"string",a)}const QIe={kernelName:IE,backendName:"webgl",kernelFunc:YIe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZIe({inputs:t,attrs:e,backend:n}){const{x:s}=t,r=ci+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,i=new to(s.shape,r);return n.runWebGLProgram(i,[s],s.dtype)}const e2e={kernelName:Im,backendName:"webgl",kernelFunc:ZIe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class t2e{constructor(e,n,s){this.variableNames=["x"],this.outputShape=s;const r=s.length,i=gt(s.length),o=gt(s.length);let a="";if(r===1)a="coords * strides + begin";else{let l=0;a=s.map((c,u)=>(l++,s.length===1?`coords * strides[${u}] + begin[${u}]`:`coords[${l-1}] * strides[${u}] + begin[${u}]`)).join(",")}this.userCode=`
      ${i} begin = ${i}(${e});
      ${i} strides = ${i}(${n});

      void main() {
        ${o} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n2e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{begin:i,end:o,strides:a,beginMask:l,endMask:c,ellipsisMask:u,newAxisMask:d,shrinkAxisMask:h}=s,{finalShapeSparse:f,finalShape:p,isIdentity:m,sliceDim0:g,isSimpleSlice:y,begin:x,end:v,strides:w}=TI(r.shape,i,o,a,l,c,u,d,h);let S;if(m)S=ue({inputs:{x:r},backend:n,attrs:{shape:p}});else if(g||y){E(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const C=kI(x,v,w),N=ah({inputs:{x:r},backend:n,attrs:{begin:x,size:C}});S=ue({inputs:{x:N},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo(N)}else if(n.shouldExecuteOnCPU([r])){const N=n.readSync(r.dataId),T=He(r.shape,r.dtype,N),I=v1e(f,T,w,x);S=n.makeTensorInfo(p,r.dtype,I.values)}else{const N=new t2e(x,w,f);S=n.runWebGLProgram(N,[r],r.dtype)}const k=ue({inputs:{x:S},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(S),k}const s2e={kernelName:AE,backendName:"webgl",kernelFunc:n2e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r2e(t){const{inputs:e,backend:n,attrs:s}=t,{separator:r,nGramWidths:i,leftPad:o,rightPad:a,padWidth:l,preserveShortSequences:c}=s,{data:u,dataSplits:d}=e,h=n.readSync(u.dataId),f=n.readSync(d.dataId),[p,m]=w1e(h,f,r,i,o,a,l,c);return[n.makeTensorInfo([p.length],"string",p),n.makeTensorInfo(d.shape,"int32",m)]}const i2e={kernelName:pB,backendName:"webgl",kernelFunc:r2e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o2e(t){const{inputs:e,backend:n,attrs:s}=t,{skipEmpty:r}=s,{input:i,delimiter:o}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${i.shape}`);if(o.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${o.shape}`);const a=n.readSync(i.dataId),l=n.readSync(o.dataId)[0],[c,u,d]=S1e(a,l,r),h=u.length;return[n.makeTensorInfo([h,2],"int32",c),n.makeTensorInfo([h],"string",u),n.makeTensorInfo([2],"int32",new Int32Array(d))]}const a2e={kernelName:mB,backendName:"webgl",kernelFunc:o2e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l2e(t){const{inputs:e,backend:n,attrs:s}=t,{numBuckets:r}=s,{input:i}=e;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const o=n.readSync(i.dataId),a=k1e(o,r);return n.makeTensorInfo(i.shape,"int32",a)}const c2e={kernelName:gB,backendName:"webgl",kernelFunc:l2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u2e="return tan(x);",d2e=rt({opSnippet:u2e}),h2e={kernelName:Nm,backendName:"webgl",kernelFunc:d2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f2e=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,p2e=rt({opSnippet:f2e}),m2e={kernelName:Tm,backendName:"webgl",kernelFunc:p2e};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g2e(t){const{inputs:e,backend:n,attrs:s}=t,{tensor:r,indices:i,updates:o}=e,{sliceRank:a,numUpdates:l,sliceSize:c,strides:u,outputSize:d}=eu(o,i,r.shape),h=[d/c,c];if(d===0)return n.makeTensorInfo(r.shape,i.dtype);const f=ue({inputs:{x:i},backend:n,attrs:{shape:[l,a]}}),p=ue({inputs:{x:o},backend:n,attrs:{shape:[l,c]}}),m=ue({inputs:{x:r},backend:n,attrs:{shape:h}}),g=new R2(l,a,f.shape.length,p.shape.length,u,h,!1,!0),y=n.runWebGLProgram(g,[p,f,m],m.dtype),x=ue({inputs:{x:y},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(y),x}const y2e={kernelName:aB,backendName:"webgl",kernelFunc:g2e};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class x2e{constructor(e,n){this.variableNames=["A"];const s=new Array(e.length);for(let o=0;o<s.length;o++)s[o]=e[o]*n[o];this.outputShape=s,this.rank=s.length;const r=gt(this.rank),i=b2e(e);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        setOutput(getA(${i}));
      }
    `}}function b2e(t){const e=t.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${t[0]})`;const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],s=[];for(let r=0;r<t.length;r++)s.push(`imod(${n[r]}, ${t[r]})`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A5(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{reps:i}=s;if(r.dtype==="string"||r.shape.length>5){const l=n.readSync(r.dataId),c=r.dtype==="string"?l.map(h=>ol(h)):l,u=He(r.shape,r.dtype,c),d=N1e(u,i);return n.makeTensorInfo(d.shape,d.dtype,d.values)}const o=new x2e(r.shape,i);return n.runWebGLProgram(o,[r],r.dtype)}const v2e={kernelName:Em,backendName:"webgl",kernelFunc:A5};class w2e{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class S2e{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fl(t,e){e!==null&&t.disposeIntermediateTensorInfo(e)}function CM(t){let e=1;for(;e<t;)e*=2;return e}function k2e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{k:i,sorted:o}=s,a=X().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=X().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),c=r.shape,u=c[c.length-1];if(n.shouldExecuteOnCPU([r])||u<a||i>l){const I=n.readSync(r.dataId),[D,F]=T1e(I,c,r.dtype,i,o);return[n.makeTensorInfo(D.shape,D.dtype,D.values),n.makeTensorInfo(F.shape,F.dtype,F.values)]}if(i===0)return c[c.length-1]=0,[n.makeTensorInfo(c,r.dtype,[]),n.makeTensorInfo(c,"int32",[])];if(u===1)return[r,Jm({attrs:{shape:c,dtype:"int32",value:0},backend:n})];const d=n.texData.get(r.dataId),h=d!==null&&d.isPacked,f=h?n.unpackTensor(r):r,m=Q(c)/u,g=ue({inputs:{x:f},attrs:{shape:[m,u]},backend:n});h&&Fl(n,f);const y=CM(i),x=CM(u);let v=null;const w=()=>v===null?[g,g]:[g,v],S=(I,D,F)=>{const A=w(),O=new w2e(F),L=[[u],[v===null?1:0],[Number.NEGATIVE_INFINITY],[I],[D]],G=v;v=n.runWebGLProgram(O,A,"int32",L),Fl(n,G)};for(let I=1;I<y;I*=2){const D=I*2;for(let F=I;F>=1;F/=2)S(D,F,[m,x])}for(let I=x;I>y;I/=2){const D=w(),F=new S2e([m,I/2]),O=[[u],[v===null?1:0],[y]],P=v;v=n.runWebGLProgram(F,D,"int32",O),Fl(n,P);const L=y/2,G=L*2;for(let $=L;$>=1;$/=2)S(G,$,v.shape)}let k=v;v=ah({inputs:{x:v},backend:n,attrs:{begin:0,size:[m,i]}}),Fl(n,k);let C=w5({inputs:{x:g,indices:v},backend:n,attrs:{axis:1,batchDims:1}});Fl(n,g);const N=c.slice(0,-1);N.push(i),k=v,v=ue({inputs:{x:v},attrs:{shape:N},backend:n}),Fl(n,k);const T=C;return C=ue({inputs:{x:C},attrs:{shape:N},backend:n}),Fl(n,T),[C,v]}const C2e={kernelName:$E,backendName:"webgl",kernelFunc:k2e};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class N2e{constructor(e,n,s,r,i,o){this.variableNames=["Image","Transforms"],this.outputShape=o;const a=s==="nearest"?1:2;let l;switch(r){case"constant":l=1;break;case"reflect":l=2;break;case"wrap":l=3;break;case"nearest":l=4;break;default:l=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${l} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${n}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${i});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${i});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${n}));
                float mapY = mapCoord(inY, float(${e}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T2e(t){const{inputs:e,backend:n,attrs:s}=t,{image:r,transforms:i}=e,{interpolation:o,fillMode:a,fillValue:l,outputShape:c}=s,[u,d,h,f]=r.shape,[p,m]=c??[d,h],g=[u,p,m,f],y=new N2e(d,h,o,a,l,g);return n.runWebGLProgram(y,[r,i],"float32")}const E2e={kernelName:RE,backendName:"webgl",kernelFunc:T2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I2e(t){const{inputs:e,attrs:n,backend:s}=t,{axis:r}=n,{x:i}=e;Km(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const o=s.readSync(i.dataId),{outputValues:a,outputShape:l,indices:c}=E1e(o,r,i.shape,i.dtype);return[s.makeTensorInfo(l,i.dtype,a),s.makeTensorInfo([c.length],"int32",c)]}const A2e={kernelName:DE,backendName:"webgl",kernelFunc:I2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $2e(t){const{inputs:e,backend:n,attrs:s}=t,{value:r}=e;let{axis:i}=s;i<0&&(i+=r.shape.length);const o=r,a=o.shape.length,l=r.shape[i],c=new Array(a-1);let u=0;for(let m=0;m<a;m++)m!==i&&(c[u++]=o.shape[m]);const d=[],h=new Array(a).fill(0),f=o.shape.slice();f[i]=1;const p=new Array(l);for(let m=0;m<p.length;m++){h[i]=m;const g=ah({inputs:{x:o},backend:n,attrs:{begin:h,size:f}}),y=ue({inputs:{x:g},backend:n,attrs:{shape:c}});p[m]=y,d.push(g)}return d.forEach(m=>n.disposeIntermediateTensorInfo(m)),p}const R2e={kernelName:Sv,backendName:"webgl",kernelFunc:$2e};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class D2e{constructor(e,n){this.variableNames=["x","segmentIds"];const s=e.windowSize,r=e.batchSize,i=e.inSize,o=e.numSegments,a=o*Math.ceil(i/s);this.outputShape=[r,a];const l="0.0",c="sumValue",u=Math.floor(s/4)*4,d=s%4,h=`
        sumValue += dot(values, segFilter);
    `;let f="";i%s>0&&(f=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `);let p="";i%s>0&&(p=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${l};

      float getValue(int batch, int inIdx) {
        ${f}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${p}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${o})) * float(${s}));
        int currentSeg = int(mod(float(outIdx), float(${o})));

        float sumValue = 0.0;

        for (int i = 0; i < ${u}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${h}
        }

        int inIdx = inOffset + ${u};
        if (${d===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${h}
        } else if (${d===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${h}
        } else if (${d===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${h}
        }
        setOutput(${c});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O2e(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,segmentIds:i}=e,{numSegments:o}=s,a=r.shape.length,l=[];let c=0;const u=Bt([c],a);let d=r;u!=null&&(d=ks({inputs:{x:r},backend:n,attrs:{perm:u}}),l.push(d),c=nn(1,a)[0]);const h=uV(d.shape,c,o),f=Q([d.shape[c]]),p=ue({inputs:{x:d},backend:n,attrs:{shape:[-1,f]}});l.push(p);const m=PE(r.dtype),g=(w,S,k,C,N)=>{const T=w.shape[0],I=w.shape[1],D=cV(I,N),F={windowSize:D,inSize:I,batchSize:T,numSegments:N},A=new D2e(F,S),O=n.compileAndRun(A,[w,k],C);if(l.push(O),O.shape[1]===N)return O;const P=I5({backend:n,attrs:{start:0,stop:N,step:1,dtype:"float32"}}),L=A5({inputs:{x:P},backend:n,attrs:{reps:[I/D]}});return l.push(P),l.push(L),g(O,S,L,C,N)},y=g(p,"unsortedSegmentSum",i,m,o),x=ue({inputs:{x:y},backend:n,attrs:{shape:h}});let v=x;if(u!=null){l.push(x);const w=kl(u);v=ks({inputs:{x:v},backend:n,attrs:{perm:w}})}return l.forEach(w=>n.disposeIntermediateTensorInfo(w)),v}const M2e={kernelName:kv,backendName:"webgl",kernelFunc:O2e};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P2e=[xwe,vwe,kwe,Twe,Iwe,Rwe,Owe,Pwe,zwe,jwe,Wwe,Kwe,Jwe,eSe,sSe,iSe,aSe,dSe,fSe,mSe,bSe,TSe,ISe,DSe,MSe,BSe,VSe,GSe,twe,XSe,eke,rke,uke,fke,mke,yke,bke,kke,Tke,Ake,Rke,Oke,Pke,_ke,Bke,Wke,Gke,Xke,Qke,eCe,rCe,lCe,hCe,mCe,xCe,bCe,wCe,kCe,NCe,ECe,ACe,OCe,LCe,zCe,jCe,WCe,KCe,YCe,tNe,ewe,sNe,QSe,oNe,cNe,hNe,swe,gNe,vNe,SNe,TNe,ANe,ONe,LNe,BNe,WNe,KNe,XNe,ZNe,tTe,sTe,aTe,cTe,dTe,fTe,mTe,bTe,kTe,ETe,PTe,owe,zTe,VTe,HTe,qTe,LSe,YTe,ZTe,tEe,rEe,lEe,iwe,uEe,hEe,pEe,gEe,yEe,FSe,RTe,vEe,CEe,IEe,lwe,DEe,PEe,zEe,VEe,GEe,qEe,YEe,eIe,sIe,oIe,cIe,hIe,gIe,bIe,kIe,TIe,CSe,OTe,AIe,RIe,OIe,PIe,FIe,zIe,jIe,UIe,HIe,qIe,JIe,QIe,e2e,s2e,i2e,a2e,c2e,DTe,mwe,h2e,m2e,y2e,v2e,C2e,E2e,gwe,A2e,R2e,M2e,QTe];for(const t of P2e)xB(t);class L2e{constructor(){$e(this,"model",null);$e(this,"isInitialized",!1);$e(this,"messageHistory",[]);$e(this,"capabilities",{summarization:!1,translation:!1,sentiment:!1,suggestions:!1,smartReplies:!1})}async initialize(){try{this.model=await Yhe("/models/ai-assistant/model.json"),await this.initializeCapabilities(),this.isInitialized=!0,console.log("AI Assistant initialized successfully")}catch{console.warn("AI model not available, using fallback methods"),await this.initializeFallbackCapabilities()}}async initializeCapabilities(){this.capabilities={summarization:!0,translation:!0,sentiment:!0,suggestions:!0,smartReplies:!0}}async initializeFallbackCapabilities(){this.capabilities={summarization:!0,translation:!1,sentiment:!0,suggestions:!0,smartReplies:!0}}async summarizeConversation(e,n=200,s="Correspondant"){if(!this.capabilities.summarization)return this.fallbackSummarize(e,n,s);try{const r=e.filter(o=>{if(o.type==="file"||o.type==="system")return!1;try{if(o.content.startsWith("{")&&o.content.includes('"type":')){const a=JSON.parse(o.content);return!["file_offer","file_metadata","file_chunk","encrypted_message"].includes(a.type)}}catch{return!0}return!0}).map(o=>`${o.sender==="me"?"Moi":s}: ${o.content}`).join(`
`);return await this.generateSummary(r,n)}catch(r){return console.error("Summarization failed:",r),this.fallbackSummarize(e,n,s)}}async generateSummary(e,n){return this.fallbackSummarize([{sender:"system",content:e}],n,"Systme")}fallbackSummarize(e,n,s){return`Rsum de la conversation :
 ${e.filter(o=>{if(o.type==="file")return!1;try{if(o.content.startsWith("{")&&o.content.includes('"type":')){const a=JSON.parse(o.content);return!["file_offer","file_metadata","file_chunk","encrypted_message"].includes(a.type)}}catch{return!0}return!0}).slice(-10).map(o=>{const a=o.sender==="me"?"Moi":s,l=o.content.length>50?o.content.substring(0,50)+"...":o.content;return`${a} : ${l}`}).join(`
 `)}`}async generateSmartReplies(e,n){if(!this.capabilities.smartReplies)return this.generateTemplateReplies(e);try{const s=await this.analyzeMessageIntent(e);return(await this.generateContextualReplies(s,n)).slice(0,3)}catch{return this.generateTemplateReplies(e)}}async analyzeMessageIntent(e){return"unknown"}async generateContextualReplies(e,n){return[]}generateTemplateReplies(e){const n=e.toLowerCase(),s=new Set;return n.includes("?")&&(s.add("D'accord"),s.add("Laisse-moi rflchir"),s.add("Bonne question")),(n.includes("merci")||n.includes("thanks"))&&(s.add("De rien !"),s.add("Content de pouvoir aider")),(n.includes("salut")||n.includes("hello")||n.includes("hi"))&&(s.add("Salut !"),s.add("Comment a va ?")),s.add("Intressant"),s.add("Je vois"),s.add("Parlons-en"),Array.from(s).slice(0,3)}async analyzeSentiment(e){if(!this.capabilities.sentiment)return this.fallbackSentimentAnalysis(e);try{return await this.modelBasedSentimentAnalysis(e)}catch{return this.fallbackSentimentAnalysis(e)}}async modelBasedSentimentAnalysis(e){return this.fallbackSentimentAnalysis(e)}fallbackSentimentAnalysis(e){const n=["bon","super","gnial","excellent","parfait","content","heureux"],s=["mauvais","terrible","horrible","triste","fch","du"],r=e.toLowerCase().split(/\s+/);let i=0,o=0;return r.forEach(a=>{n.includes(a)&&i++,s.includes(a)&&o++}),i>o?{sentiment:"positive",confidence:.7,emotions:["joy"]}:o>i?{sentiment:"negative",confidence:.7,emotions:["sadness"]}:{sentiment:"neutral",confidence:.8,emotions:[]}}async translateText(e,n){if(!this.capabilities.translation)return e;try{return await this.modelBasedTranslation(e,n)}catch(s){return console.warn("Translation failed:",s),e}}async modelBasedTranslation(e,n){return e}async detectTopics(e){const n=e.map(r=>r.content).join(" ");return this.extractCommonTopics(n).slice(0,5)}extractCommonTopics(e){const n=e.toLowerCase().split(/\s+/).filter(r=>r.length>3).filter(r=>!this.isStopWord(r)),s={};return n.forEach(r=>{s[r]=(s[r]||0)+1}),Object.entries(s).sort(([,r],[,i])=>i-r).slice(0,10).map(([r])=>r)}isStopWord(e){return["avec","dans","pour","par","sur","est","sont","ont"].includes(e)}async generateConversationReport(e){const n=await this.summarizeConversation(e),s=await this.detectTopics(e),r=await Promise.all(e.slice(-20).map(a=>this.analyzeSentiment(a.content))),i={positive:r.filter(a=>a.sentiment==="positive").length,negative:r.filter(a=>a.sentiment==="negative").length,neutral:r.filter(a=>a.sentiment==="neutral").length},o=this.calculateActivity(e);return{summary:n,topics:s,sentiment:i,activity:o}}calculateActivity(e){const n={};return e.forEach(s=>{const r=new Date(s.timestamp).toDateString();n[r]=(n[r]||0)+1}),n}getCapabilities(){return this.capabilities}isReady(){return this.isInitialized}}const Ug=new L2e,D2=wo((t,e)=>({isEnabled:!1,isProcessing:!1,capabilities:{},preferences:{autoSummarize:!0,smartReplies:!0,sentimentAnalysis:!0,autoTranslation:!1},enableAI:async()=>{t({isProcessing:!0});try{await Ug.initialize();const n=Ug.getCapabilities();t({isEnabled:!0,isProcessing:!1,capabilities:n})}catch(n){console.error("Failed to enable AI:",n),t({isProcessing:!1})}},disableAI:()=>{t({isEnabled:!1})},toggleFeature:n=>{t(s=>({preferences:{...s.preferences,[n]:!s.preferences[n]}}))},generateSmartReply:async(n,s)=>{const{preferences:r}=e();if(!r.smartReplies)return[];t({isProcessing:!0});try{const i=await Ug.generateSmartReplies(n,s);return t({isProcessing:!1}),i}catch{return t({isProcessing:!1}),[]}},summarizeConversation:async(n,s="Correspondant")=>{const{preferences:r}=e();if(!r.autoSummarize)return"";t({isProcessing:!0});try{const i=await Ug.summarizeConversation(n,200,s);return t({isProcessing:!1}),i}catch{return t({isProcessing:!1}),""}}})),F2e=({lastMessage:t,messageContext:e,onSuggestionSelect:n})=>{const{t:s}=Er(),{generateSmartReply:r,isProcessing:i,preferences:o}=D2(),[a,l]=z.useState([]),[c,u]=z.useState(!1);return z.useEffect(()=>{if(t&&o.smartReplies){const d=setTimeout(async()=>{const h=await r(t,e);l(h),u(h.length>0)},1e3);return()=>clearTimeout(d)}else u(!1)},[t,e,o.smartReplies]),!c||!o.smartReplies?null:b.jsxs("div",{className:"flex items-center space-x-2 p-3 bg-gradient-to-r from-blue-50 to-purple-50 rounded-2xl border border-blue-200 mb-4",children:[b.jsxs("div",{className:"flex items-center space-x-2 text-blue-600",children:[b.jsx("div",{className:"w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center",children:b.jsx("span",{className:"text-white text-xs",children:"AI"})}),b.jsx("span",{className:"text-sm font-medium",children:s("ai.suggestions")})]}),b.jsx("div",{className:"flex-1 flex space-x-2 overflow-x-auto",children:a.map((d,h)=>b.jsx("button",{onClick:()=>n(d),disabled:i,className:"flex-shrink-0 px-3 py-2 bg-white text-gray-700 rounded-xl border border-gray-200 hover:border-blue-300 hover:bg-blue-50 transition-all duration-200 text-sm whitespace-nowrap",children:d},h))}),b.jsx("button",{onClick:()=>u(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",children:""})]})};/*! @license DOMPurify 3.3.0 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.3.0/LICENSE */const{entries:$5,setPrototypeOf:NM,isFrozen:_2e,getPrototypeOf:z2e,getOwnPropertyDescriptor:B2e}=Object;let{freeze:Bs,seal:oi,create:IC}=Object,{apply:AC,construct:$C}=typeof Reflect<"u"&&Reflect;Bs||(Bs=function(e){return e});oi||(oi=function(e){return e});AC||(AC=function(e,n){for(var s=arguments.length,r=new Array(s>2?s-2:0),i=2;i<s;i++)r[i-2]=arguments[i];return e.apply(n,r)});$C||($C=function(e){for(var n=arguments.length,s=new Array(n>1?n-1:0),r=1;r<n;r++)s[r-1]=arguments[r];return new e(...s)});const Wg=js(Array.prototype.forEach),j2e=js(Array.prototype.lastIndexOf),TM=js(Array.prototype.pop),Ah=js(Array.prototype.push),V2e=js(Array.prototype.splice),Oy=js(String.prototype.toLowerCase),Pw=js(String.prototype.toString),Lw=js(String.prototype.match),$h=js(String.prototype.replace),U2e=js(String.prototype.indexOf),W2e=js(String.prototype.trim),pi=js(Object.prototype.hasOwnProperty),Es=js(RegExp.prototype.test),Rh=H2e(TypeError);function js(t){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var n=arguments.length,s=new Array(n>1?n-1:0),r=1;r<n;r++)s[r-1]=arguments[r];return AC(t,e,s)}}function H2e(t){return function(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return $C(t,n)}}function Je(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Oy;NM&&NM(t,null);let s=e.length;for(;s--;){let r=e[s];if(typeof r=="string"){const i=n(r);i!==r&&(_2e(e)||(e[s]=i),r=i)}t[r]=!0}return t}function G2e(t){for(let e=0;e<t.length;e++)pi(t,e)||(t[e]=null);return t}function Do(t){const e=IC(null);for(const[n,s]of $5(t))pi(t,n)&&(Array.isArray(s)?e[n]=G2e(s):s&&typeof s=="object"&&s.constructor===Object?e[n]=Do(s):e[n]=s);return e}function Dh(t,e){for(;t!==null;){const s=B2e(t,e);if(s){if(s.get)return js(s.get);if(typeof s.value=="function")return js(s.value)}t=z2e(t)}function n(){return null}return n}const EM=Bs(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Fw=Bs(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),_w=Bs(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),K2e=Bs(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),zw=Bs(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),q2e=Bs(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),IM=Bs(["#text"]),AM=Bs(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),Bw=Bs(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),$M=Bs(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Hg=Bs(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),X2e=oi(/\{\{[\w\W]*|[\w\W]*\}\}/gm),J2e=oi(/<%[\w\W]*|[\w\W]*%>/gm),Y2e=oi(/\$\{[\w\W]*/gm),Q2e=oi(/^data-[\-\w.\u00B7-\uFFFF]+$/),Z2e=oi(/^aria-[\-\w]+$/),R5=oi(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),eAe=oi(/^(?:\w+script|data):/i),tAe=oi(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),D5=oi(/^html$/i),nAe=oi(/^[a-z][.\w]*(-[.\w]+)+$/i);var RM=Object.freeze({__proto__:null,ARIA_ATTR:Z2e,ATTR_WHITESPACE:tAe,CUSTOM_ELEMENT:nAe,DATA_ATTR:Q2e,DOCTYPE_NAME:D5,ERB_EXPR:J2e,IS_ALLOWED_URI:R5,IS_SCRIPT_OR_DATA:eAe,MUSTACHE_EXPR:X2e,TMPLIT_EXPR:Y2e});const Oh={element:1,attribute:2,text:3,cdataSection:4,entityReference:5,entityNode:6,progressingInstruction:7,comment:8,document:9,documentType:10,documentFragment:11,notation:12},sAe=function(){return typeof window>"u"?null:window},rAe=function(e,n){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let s=null;const r="data-tt-policy-suffix";n&&n.hasAttribute(r)&&(s=n.getAttribute(r));const i="dompurify"+(s?"#"+s:"");try{return e.createPolicy(i,{createHTML(o){return o},createScriptURL(o){return o}})}catch{return console.warn("TrustedTypes policy "+i+" could not be created."),null}},DM=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function O5(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:sAe();const e=Te=>O5(Te);if(e.version="3.3.0",e.removed=[],!t||!t.document||t.document.nodeType!==Oh.document||!t.Element)return e.isSupported=!1,e;let{document:n}=t;const s=n,r=s.currentScript,{DocumentFragment:i,HTMLTemplateElement:o,Node:a,Element:l,NodeFilter:c,NamedNodeMap:u=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:d,DOMParser:h,trustedTypes:f}=t,p=l.prototype,m=Dh(p,"cloneNode"),g=Dh(p,"remove"),y=Dh(p,"nextSibling"),x=Dh(p,"childNodes"),v=Dh(p,"parentNode");if(typeof o=="function"){const Te=n.createElement("template");Te.content&&Te.content.ownerDocument&&(n=Te.content.ownerDocument)}let w,S="";const{implementation:k,createNodeIterator:C,createDocumentFragment:N,getElementsByTagName:T}=n,{importNode:I}=s;let D=DM();e.isSupported=typeof $5=="function"&&typeof v=="function"&&k&&k.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:F,ERB_EXPR:A,TMPLIT_EXPR:O,DATA_ATTR:P,ARIA_ATTR:L,IS_SCRIPT_OR_DATA:G,ATTR_WHITESPACE:$,CUSTOM_ELEMENT:U}=RM;let{IS_ALLOWED_URI:K}=RM,j=null;const ee=Je({},[...EM,...Fw,..._w,...zw,...IM]);let Z=null;const re=Je({},[...AM,...Bw,...$M,...Hg]);let te=Object.seal(IC(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),le=null,pe=null;const we=Object.seal(IC(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let xe=!0,Ne=!0,Ae=!1,Qe=!0,Xe=!1,ft=!0,qe=!1,Ze=!1,ut=!1,et=!1,ge=!1,Fe=!1,Pt=!0,yt=!1;const dn="user-content-";let Ct=!0,Kn=!1,qn={},on=null;const hr=Je({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let _i=null;const ko=Je({},["audio","video","img","source","image","track"]);let Ol=null;const tg=Je({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Co="http://www.w3.org/1998/Math/MathML",lu="http://www.w3.org/2000/svg",ui="http://www.w3.org/1999/xhtml";let cu=ui,y1=!1,x1=null;const l6=Je({},[Co,lu,ui],Pw);let ng=Je({},["mi","mo","mn","ms","mtext"]),sg=Je({},["annotation-xml"]);const c6=Je({},["title","style","font","a","script"]);let ch=null;const u6=["application/xhtml+xml","text/html"],d6="text/html";let Mn=null,uu=null;const h6=n.createElement("form"),bA=function(_){return _ instanceof RegExp||_ instanceof Function},b1=function(){let _=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(uu&&uu===_)){if((!_||typeof _!="object")&&(_={}),_=Do(_),ch=u6.indexOf(_.PARSER_MEDIA_TYPE)===-1?d6:_.PARSER_MEDIA_TYPE,Mn=ch==="application/xhtml+xml"?Pw:Oy,j=pi(_,"ALLOWED_TAGS")?Je({},_.ALLOWED_TAGS,Mn):ee,Z=pi(_,"ALLOWED_ATTR")?Je({},_.ALLOWED_ATTR,Mn):re,x1=pi(_,"ALLOWED_NAMESPACES")?Je({},_.ALLOWED_NAMESPACES,Pw):l6,Ol=pi(_,"ADD_URI_SAFE_ATTR")?Je(Do(tg),_.ADD_URI_SAFE_ATTR,Mn):tg,_i=pi(_,"ADD_DATA_URI_TAGS")?Je(Do(ko),_.ADD_DATA_URI_TAGS,Mn):ko,on=pi(_,"FORBID_CONTENTS")?Je({},_.FORBID_CONTENTS,Mn):hr,le=pi(_,"FORBID_TAGS")?Je({},_.FORBID_TAGS,Mn):Do({}),pe=pi(_,"FORBID_ATTR")?Je({},_.FORBID_ATTR,Mn):Do({}),qn=pi(_,"USE_PROFILES")?_.USE_PROFILES:!1,xe=_.ALLOW_ARIA_ATTR!==!1,Ne=_.ALLOW_DATA_ATTR!==!1,Ae=_.ALLOW_UNKNOWN_PROTOCOLS||!1,Qe=_.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Xe=_.SAFE_FOR_TEMPLATES||!1,ft=_.SAFE_FOR_XML!==!1,qe=_.WHOLE_DOCUMENT||!1,et=_.RETURN_DOM||!1,ge=_.RETURN_DOM_FRAGMENT||!1,Fe=_.RETURN_TRUSTED_TYPE||!1,ut=_.FORCE_BODY||!1,Pt=_.SANITIZE_DOM!==!1,yt=_.SANITIZE_NAMED_PROPS||!1,Ct=_.KEEP_CONTENT!==!1,Kn=_.IN_PLACE||!1,K=_.ALLOWED_URI_REGEXP||R5,cu=_.NAMESPACE||ui,ng=_.MATHML_TEXT_INTEGRATION_POINTS||ng,sg=_.HTML_INTEGRATION_POINTS||sg,te=_.CUSTOM_ELEMENT_HANDLING||{},_.CUSTOM_ELEMENT_HANDLING&&bA(_.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(te.tagNameCheck=_.CUSTOM_ELEMENT_HANDLING.tagNameCheck),_.CUSTOM_ELEMENT_HANDLING&&bA(_.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(te.attributeNameCheck=_.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),_.CUSTOM_ELEMENT_HANDLING&&typeof _.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(te.allowCustomizedBuiltInElements=_.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Xe&&(Ne=!1),ge&&(et=!0),qn&&(j=Je({},IM),Z=[],qn.html===!0&&(Je(j,EM),Je(Z,AM)),qn.svg===!0&&(Je(j,Fw),Je(Z,Bw),Je(Z,Hg)),qn.svgFilters===!0&&(Je(j,_w),Je(Z,Bw),Je(Z,Hg)),qn.mathMl===!0&&(Je(j,zw),Je(Z,$M),Je(Z,Hg))),_.ADD_TAGS&&(typeof _.ADD_TAGS=="function"?we.tagCheck=_.ADD_TAGS:(j===ee&&(j=Do(j)),Je(j,_.ADD_TAGS,Mn))),_.ADD_ATTR&&(typeof _.ADD_ATTR=="function"?we.attributeCheck=_.ADD_ATTR:(Z===re&&(Z=Do(Z)),Je(Z,_.ADD_ATTR,Mn))),_.ADD_URI_SAFE_ATTR&&Je(Ol,_.ADD_URI_SAFE_ATTR,Mn),_.FORBID_CONTENTS&&(on===hr&&(on=Do(on)),Je(on,_.FORBID_CONTENTS,Mn)),Ct&&(j["#text"]=!0),qe&&Je(j,["html","head","body"]),j.table&&(Je(j,["tbody"]),delete le.tbody),_.TRUSTED_TYPES_POLICY){if(typeof _.TRUSTED_TYPES_POLICY.createHTML!="function")throw Rh('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof _.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw Rh('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');w=_.TRUSTED_TYPES_POLICY,S=w.createHTML("")}else w===void 0&&(w=rAe(f,r)),w!==null&&typeof S=="string"&&(S=w.createHTML(""));Bs&&Bs(_),uu=_}},vA=Je({},[...Fw,..._w,...K2e]),wA=Je({},[...zw,...q2e]),f6=function(_){let ce=v(_);(!ce||!ce.tagName)&&(ce={namespaceURI:cu,tagName:"template"});const Se=Oy(_.tagName),Lt=Oy(ce.tagName);return x1[_.namespaceURI]?_.namespaceURI===lu?ce.namespaceURI===ui?Se==="svg":ce.namespaceURI===Co?Se==="svg"&&(Lt==="annotation-xml"||ng[Lt]):!!vA[Se]:_.namespaceURI===Co?ce.namespaceURI===ui?Se==="math":ce.namespaceURI===lu?Se==="math"&&sg[Lt]:!!wA[Se]:_.namespaceURI===ui?ce.namespaceURI===lu&&!sg[Lt]||ce.namespaceURI===Co&&!ng[Lt]?!1:!wA[Se]&&(c6[Se]||!vA[Se]):!!(ch==="application/xhtml+xml"&&x1[_.namespaceURI]):!1},zi=function(_){Ah(e.removed,{element:_});try{v(_).removeChild(_)}catch{g(_)}},Ml=function(_,ce){try{Ah(e.removed,{attribute:ce.getAttributeNode(_),from:ce})}catch{Ah(e.removed,{attribute:null,from:ce})}if(ce.removeAttribute(_),_==="is")if(et||ge)try{zi(ce)}catch{}else try{ce.setAttribute(_,"")}catch{}},SA=function(_){let ce=null,Se=null;if(ut)_="<remove></remove>"+_;else{const hn=Lw(_,/^[\r\n\t ]+/);Se=hn&&hn[0]}ch==="application/xhtml+xml"&&cu===ui&&(_='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+_+"</body></html>");const Lt=w?w.createHTML(_):_;if(cu===ui)try{ce=new h().parseFromString(Lt,ch)}catch{}if(!ce||!ce.documentElement){ce=k.createDocument(cu,"template",null);try{ce.documentElement.innerHTML=y1?S:Lt}catch{}}const cs=ce.body||ce.documentElement;return _&&Se&&cs.insertBefore(n.createTextNode(Se),cs.childNodes[0]||null),cu===ui?T.call(ce,qe?"html":"body")[0]:qe?ce.documentElement:cs},kA=function(_){return C.call(_.ownerDocument||_,_,c.SHOW_ELEMENT|c.SHOW_COMMENT|c.SHOW_TEXT|c.SHOW_PROCESSING_INSTRUCTION|c.SHOW_CDATA_SECTION,null)},v1=function(_){return _ instanceof d&&(typeof _.nodeName!="string"||typeof _.textContent!="string"||typeof _.removeChild!="function"||!(_.attributes instanceof u)||typeof _.removeAttribute!="function"||typeof _.setAttribute!="function"||typeof _.namespaceURI!="string"||typeof _.insertBefore!="function"||typeof _.hasChildNodes!="function")},CA=function(_){return typeof a=="function"&&_ instanceof a};function No(Te,_,ce){Wg(Te,Se=>{Se.call(e,_,ce,uu)})}const NA=function(_){let ce=null;if(No(D.beforeSanitizeElements,_,null),v1(_))return zi(_),!0;const Se=Mn(_.nodeName);if(No(D.uponSanitizeElement,_,{tagName:Se,allowedTags:j}),ft&&_.hasChildNodes()&&!CA(_.firstElementChild)&&Es(/<[/\w!]/g,_.innerHTML)&&Es(/<[/\w!]/g,_.textContent)||_.nodeType===Oh.progressingInstruction||ft&&_.nodeType===Oh.comment&&Es(/<[/\w]/g,_.data))return zi(_),!0;if(!(we.tagCheck instanceof Function&&we.tagCheck(Se))&&(!j[Se]||le[Se])){if(!le[Se]&&EA(Se)&&(te.tagNameCheck instanceof RegExp&&Es(te.tagNameCheck,Se)||te.tagNameCheck instanceof Function&&te.tagNameCheck(Se)))return!1;if(Ct&&!on[Se]){const Lt=v(_)||_.parentNode,cs=x(_)||_.childNodes;if(cs&&Lt){const hn=cs.length;for(let qs=hn-1;qs>=0;--qs){const To=m(cs[qs],!0);To.__removalCount=(_.__removalCount||0)+1,Lt.insertBefore(To,y(_))}}}return zi(_),!0}return _ instanceof l&&!f6(_)||(Se==="noscript"||Se==="noembed"||Se==="noframes")&&Es(/<\/no(script|embed|frames)/i,_.innerHTML)?(zi(_),!0):(Xe&&_.nodeType===Oh.text&&(ce=_.textContent,Wg([F,A,O],Lt=>{ce=$h(ce,Lt," ")}),_.textContent!==ce&&(Ah(e.removed,{element:_.cloneNode()}),_.textContent=ce)),No(D.afterSanitizeElements,_,null),!1)},TA=function(_,ce,Se){if(Pt&&(ce==="id"||ce==="name")&&(Se in n||Se in h6))return!1;if(!(Ne&&!pe[ce]&&Es(P,ce))){if(!(xe&&Es(L,ce))){if(!(we.attributeCheck instanceof Function&&we.attributeCheck(ce,_))){if(!Z[ce]||pe[ce]){if(!(EA(_)&&(te.tagNameCheck instanceof RegExp&&Es(te.tagNameCheck,_)||te.tagNameCheck instanceof Function&&te.tagNameCheck(_))&&(te.attributeNameCheck instanceof RegExp&&Es(te.attributeNameCheck,ce)||te.attributeNameCheck instanceof Function&&te.attributeNameCheck(ce,_))||ce==="is"&&te.allowCustomizedBuiltInElements&&(te.tagNameCheck instanceof RegExp&&Es(te.tagNameCheck,Se)||te.tagNameCheck instanceof Function&&te.tagNameCheck(Se))))return!1}else if(!Ol[ce]){if(!Es(K,$h(Se,$,""))){if(!((ce==="src"||ce==="xlink:href"||ce==="href")&&_!=="script"&&U2e(Se,"data:")===0&&_i[_])){if(!(Ae&&!Es(G,$h(Se,$,"")))){if(Se)return!1}}}}}}}return!0},EA=function(_){return _!=="annotation-xml"&&Lw(_,U)},IA=function(_){No(D.beforeSanitizeAttributes,_,null);const{attributes:ce}=_;if(!ce||v1(_))return;const Se={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:Z,forceKeepAttr:void 0};let Lt=ce.length;for(;Lt--;){const cs=ce[Lt],{name:hn,namespaceURI:qs,value:To}=cs,du=Mn(hn),w1=To;let Xn=hn==="value"?w1:W2e(w1);if(Se.attrName=du,Se.attrValue=Xn,Se.keepAttr=!0,Se.forceKeepAttr=void 0,No(D.uponSanitizeAttribute,_,Se),Xn=Se.attrValue,yt&&(du==="id"||du==="name")&&(Ml(hn,_),Xn=dn+Xn),ft&&Es(/((--!?|])>)|<\/(style|title|textarea)/i,Xn)){Ml(hn,_);continue}if(du==="attributename"&&Lw(Xn,"href")){Ml(hn,_);continue}if(Se.forceKeepAttr)continue;if(!Se.keepAttr){Ml(hn,_);continue}if(!Qe&&Es(/\/>/i,Xn)){Ml(hn,_);continue}Xe&&Wg([F,A,O],$A=>{Xn=$h(Xn,$A," ")});const AA=Mn(_.nodeName);if(!TA(AA,du,Xn)){Ml(hn,_);continue}if(w&&typeof f=="object"&&typeof f.getAttributeType=="function"&&!qs)switch(f.getAttributeType(AA,du)){case"TrustedHTML":{Xn=w.createHTML(Xn);break}case"TrustedScriptURL":{Xn=w.createScriptURL(Xn);break}}if(Xn!==w1)try{qs?_.setAttributeNS(qs,hn,Xn):_.setAttribute(hn,Xn),v1(_)?zi(_):TM(e.removed)}catch{Ml(hn,_)}}No(D.afterSanitizeAttributes,_,null)},p6=function Te(_){let ce=null;const Se=kA(_);for(No(D.beforeSanitizeShadowDOM,_,null);ce=Se.nextNode();)No(D.uponSanitizeShadowNode,ce,null),NA(ce),IA(ce),ce.content instanceof i&&Te(ce.content);No(D.afterSanitizeShadowDOM,_,null)};return e.sanitize=function(Te){let _=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},ce=null,Se=null,Lt=null,cs=null;if(y1=!Te,y1&&(Te="<!-->"),typeof Te!="string"&&!CA(Te))if(typeof Te.toString=="function"){if(Te=Te.toString(),typeof Te!="string")throw Rh("dirty is not a string, aborting")}else throw Rh("toString is not a function");if(!e.isSupported)return Te;if(Ze||b1(_),e.removed=[],typeof Te=="string"&&(Kn=!1),Kn){if(Te.nodeName){const To=Mn(Te.nodeName);if(!j[To]||le[To])throw Rh("root node is forbidden and cannot be sanitized in-place")}}else if(Te instanceof a)ce=SA("<!---->"),Se=ce.ownerDocument.importNode(Te,!0),Se.nodeType===Oh.element&&Se.nodeName==="BODY"||Se.nodeName==="HTML"?ce=Se:ce.appendChild(Se);else{if(!et&&!Xe&&!qe&&Te.indexOf("<")===-1)return w&&Fe?w.createHTML(Te):Te;if(ce=SA(Te),!ce)return et?null:Fe?S:""}ce&&ut&&zi(ce.firstChild);const hn=kA(Kn?Te:ce);for(;Lt=hn.nextNode();)NA(Lt),IA(Lt),Lt.content instanceof i&&p6(Lt.content);if(Kn)return Te;if(et){if(ge)for(cs=N.call(ce.ownerDocument);ce.firstChild;)cs.appendChild(ce.firstChild);else cs=ce;return(Z.shadowroot||Z.shadowrootmode)&&(cs=I.call(s,cs,!0)),cs}let qs=qe?ce.outerHTML:ce.innerHTML;return qe&&j["!doctype"]&&ce.ownerDocument&&ce.ownerDocument.doctype&&ce.ownerDocument.doctype.name&&Es(D5,ce.ownerDocument.doctype.name)&&(qs="<!DOCTYPE "+ce.ownerDocument.doctype.name+`>
`+qs),Xe&&Wg([F,A,O],To=>{qs=$h(qs,To," ")}),w&&Fe?w.createHTML(qs):qs},e.setConfig=function(){let Te=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};b1(Te),Ze=!0},e.clearConfig=function(){uu=null,Ze=!1},e.isValidAttribute=function(Te,_,ce){uu||b1({});const Se=Mn(Te),Lt=Mn(_);return TA(Se,Lt,ce)},e.addHook=function(Te,_){typeof _=="function"&&Ah(D[Te],_)},e.removeHook=function(Te,_){if(_!==void 0){const ce=j2e(D[Te],_);return ce===-1?void 0:V2e(D[Te],ce,1)[0]}return TM(D[Te])},e.removeHooks=function(Te){D[Te]=[]},e.removeAllHooks=function(){D=DM()},e}var jw=O5();const RC=t=>{jw.addHook("uponSanitizeAttribute",(n,s)=>{if(s.attrName==="style"){const r=s.attrValue,i=[],o=r.match(/color:\s*(#[0-9A-Fa-f]{3,6}|rgb\([^)]+\))/);o&&i.push(`color: ${o[1]} !important`);const a=r.match(/font-size:\s*(\d+px)/);a&&i.push(`font-size: ${a[1]} !important`),s.attrValue=i.join("; "),i.length===0&&(s.keepAttr=!1)}});const e=jw.sanitize(t,{ALLOWED_TAGS:["p","br","strong","span"],ALLOWED_ATTR:["style"],ALLOW_DATA_ATTR:!1});return jw.removeAllHooks(),e},DC=t=>{const e=document.createElement("div");return e.innerHTML=t,e.textContent||e.innerText||""},Gg=t=>!DC(t).trim(),iAe=({messages:t,conversationId:e,participantName:n="Correspondant"})=>{const{t:s}=Er(),{summarizeConversation:r,preferences:i}=D2(),[o,a]=z.useState(""),[l,c]=z.useState(()=>{const k=localStorage.getItem(`summary-expanded-${e}`);return k?JSON.parse(k):!1}),[u,d]=z.useState(!1),[h,f]=z.useState(!1),[p,m]=z.useState(!1),g=Fs.useRef(null);z.useEffect(()=>{i.autoSummarize&&t.length>=5&&y()},[t,i.autoSummarize]),z.useEffect(()=>{localStorage.setItem(`summary-expanded-${e}`,JSON.stringify(l))},[l,e]),z.useEffect(()=>{const k=C=>{g.current&&!g.current.contains(C.target)&&m(!1)};return p&&document.addEventListener("mousedown",k),()=>{document.removeEventListener("mousedown",k)}},[p]);const y=async()=>{if(!(t.length<2)){d(!0);try{const k=await r(t,n);a(k)}catch(k){console.error("Failed to generate summary:",k)}finally{d(!1)}}},x=()=>{window.confirm(s("ai.confirmClearSummary")||"Voulez-vous vraiment supprimer ce rsum ?")&&(a(""),c(!1),localStorage.removeItem(`summary-expanded-${e}`))},v=()=>{const k=document.createElement("div");k.innerHTML=o;const C=k.textContent||k.innerText||"",N=document.createElement("a"),T=new Blob([C],{type:"text/plain"});N.href=URL.createObjectURL(T),N.download=`resume_conversation_${new Date().toISOString().slice(0,10)}.txt`,document.body.appendChild(N),N.click(),document.body.removeChild(N)},w=()=>{const k=window.open("","_blank");if(k){const C=RC(o);k.document.write(`
                <html>
                    <head>
                        <title>Rsum de la conversation</title>
                        <style>
                            body { font-family: system-ui, -apple-system, sans-serif; padding: 40px; max-width: 800px; margin: 0 auto; }
                            h1 { color: #2c3e50; border-bottom: 2px solid #eee; padding-bottom: 10px; }
                            .summary { line-height: 1.6; color: #34495e; background: #f8f9fa; padding: 20px; border-radius: 8px; }
                            .summary p { margin: 0.5em 0; }
                            .summary strong { font-weight: 700; }
                            .summary span[style*="color"] { /* Couleur inline prserve */ }
                            .summary span[style*="font-size"] { line-height: 1.5; }
                            .footer { margin-top: 30px; font-size: 12px; color: #7f8c8d; text-align: center; }
                        </style>
                    </head>
                    <body>
                        <h1>Rsum de la conversation</h1>
                        <div class="summary">${C}</div>
                        <div class="footer">Gnr par PalFroG le ${new Date().toLocaleString()}</div>
                        <script>
                            window.onload = function() { window.print(); window.close(); }
                        <\/script>
                    </body>
                </html>
            `),k.document.close()}};if(!o&&!u)return null;const S=h?"fixed top-24 right-4 w-80 z-50 shadow-2xl animate-fade-in":"mb-4";return b.jsxs("div",{className:`bg-gradient-to-r from-green-50 to-blue-50 rounded-2xl border border-green-200 p-4 transition-all duration-300 ${S}`,children:[b.jsxs("div",{className:"flex items-center justify-between mb-2",children:[b.jsxs("div",{className:"flex items-center space-x-2",children:[b.jsx("div",{className:"w-6 h-6 bg-green-500 rounded-full flex items-center justify-center shadow-sm",children:b.jsx("span",{className:"text-white text-xs font-bold",children:"AI"})}),b.jsx("span",{className:"font-medium text-green-800 text-sm",children:s("ai.conversationSummary")})]}),b.jsxs("div",{className:"flex items-center space-x-1",children:[b.jsxs("div",{className:"relative",ref:g,children:[b.jsx("button",{onClick:()=>m(!p),className:`p-1.5 text-green-600 hover:text-green-800 hover:bg-green-100 rounded-lg transition-colors ${p?"bg-green-100 text-green-800":""}`,title:"Exporter",children:""}),p&&b.jsx("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-xl shadow-xl z-50 border border-gray-100 overflow-hidden animate-fade-in-up",children:b.jsxs("div",{className:"py-1",children:[b.jsxs("button",{onClick:()=>{v(),m(!1)},className:"w-full text-left px-4 py-3 text-sm text-gray-700 hover:bg-green-50 hover:text-green-700 transition-colors flex items-center gap-3",children:[b.jsx("span",{className:"text-lg",children:""}),b.jsx("span",{className:"font-medium",children:"Exporter en .TXT"})]}),b.jsxs("button",{onClick:()=>{w(),m(!1)},className:"w-full text-left px-4 py-3 text-sm text-gray-700 hover:bg-green-50 hover:text-green-700 transition-colors flex items-center gap-3 border-t border-gray-50",children:[b.jsx("span",{className:"text-lg",children:""}),b.jsx("span",{className:"font-medium",children:"Exporter en .PDF"})]})]})})]}),b.jsx("button",{onClick:y,disabled:u,className:"p-1.5 text-green-600 hover:text-green-800 hover:bg-green-100 rounded-lg transition-colors",title:s("ai.regenerateSummary"),children:""}),b.jsx("button",{onClick:x,className:"p-1.5 text-red-500 hover:text-red-700 hover:bg-red-50 rounded-lg transition-colors",title:"Nettoyer le rsum",children:""}),b.jsx("button",{onClick:()=>f(!h),className:`p-1.5 text-green-600 hover:text-green-800 hover:bg-green-100 rounded-lg transition-colors ${h?"bg-green-100":""}`,title:h?"Attacher":"Dtacher",children:h?"":""}),b.jsx("button",{onClick:()=>c(!l),className:"p-1.5 text-green-600 hover:text-green-800 hover:bg-green-100 rounded-lg transition-colors",children:l?"":""})]})]}),u?b.jsxs("div",{className:"flex items-center space-x-2 text-green-700 py-2",children:[b.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-green-500"}),b.jsx("span",{className:"text-sm",children:s("ai.generatingSummary")})]}):b.jsx("div",{className:`text-green-800 text-sm leading-relaxed transition-all duration-300 prose prose-sm max-w-none ${l?"max-h-96 overflow-y-auto":"max-h-0 overflow-hidden"}`,dangerouslySetInnerHTML:{__html:RC(o)}})]})},oAe=({message:t,isMe:e})=>{const[n,s]=z.useState(null),[r,i]=z.useState(!1),[o,a]=z.useState(!1),{transfers:l}=pr();if(z.useEffect(()=>{try{const v=JSON.parse(t.content);s(v)}catch(v){console.error("Failed to parse file message",v)}},[t.content]),!n||r)return null;const c=l.get(n.transferId),u=n.fileType.startsWith("image/"),d=n.fileType.startsWith("video/"),h=(c==null?void 0:c.status)||n.transferStatus,f=()=>{$y.acceptFile(n.transferId,t.sender)},p=()=>{i(!0),$y.rejectFile(n.transferId,t.sender)},m=()=>{$y.cancelSend(n.transferId,n.peerId||t.sender);const{removeMessage:v}=Be.getState();v(t.id)},g=()=>{if(c&&c.file){const v=URL.createObjectURL(c.file),w=document.createElement("a");w.href=v,w.download=c.file.name,document.body.appendChild(w),w.click(),document.body.removeChild(w),URL.revokeObjectURL(v)}},y=()=>{c!=null&&c.file&&a(!0)},x=()=>{if(!o||!(c!=null&&c.file))return null;const v=URL.createObjectURL(c.file);return b.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/90 backdrop-blur-sm p-4",onClick:()=>a(!1),children:b.jsxs("div",{className:"relative max-w-4xl w-full bg-black rounded-lg overflow-hidden shadow-2xl",onClick:w=>w.stopPropagation(),children:[b.jsx("button",{onClick:()=>a(!1),className:"absolute top-4 right-4 text-white/70 hover:text-white z-10 bg-black/50 rounded-full p-2",children:""}),b.jsx("video",{src:v,controls:!0,autoPlay:!0,className:"w-full h-auto max-h-[80vh]"}),b.jsxs("div",{className:"p-4 bg-gray-900 text-white flex justify-between items-center",children:[b.jsx("span",{className:"font-medium truncate",children:n.name}),b.jsx("button",{onClick:g,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-sm font-medium transition-colors",children:"Tlcharger"})]})]})})};if(h==="rejected")return b.jsx("div",{className:"w-64 bg-red-50 border border-red-100 p-3 rounded-xl",children:b.jsxs("div",{className:"flex items-center space-x-2 text-red-600",children:[b.jsx("span",{children:""}),b.jsx("span",{className:"text-sm font-medium",children:"Transfert refus par le destinataire"})]})});if(h==="completed"){const v=(n.size/1048576).toFixed(1);return d?b.jsxs(b.Fragment,{children:[b.jsxs("div",{className:"w-72 bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden",children:[b.jsxs("div",{className:"relative group cursor-pointer bg-black",onClick:y,children:[n.thumbnail?b.jsx("img",{src:n.thumbnail,alt:"Video thumbnail",className:"w-full h-40 object-cover opacity-90 group-hover:opacity-100 transition-opacity"}):b.jsx("div",{className:"w-full h-40 flex items-center justify-center bg-gray-900",children:b.jsx("span",{className:"text-4xl",children:""})}),b.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:b.jsx("div",{className:"w-12 h-12 bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center group-hover:scale-110 transition-transform",children:b.jsx("span",{className:"text-2xl ml-1",children:""})})}),b.jsxs("div",{className:"absolute bottom-2 right-2 px-2 py-1 bg-black/60 rounded text-xs text-white font-medium",children:[v," MB"]})]}),b.jsxs("div",{className:"p-3 flex items-center justify-between bg-gray-50",children:[b.jsx("span",{className:"text-sm font-medium truncate text-gray-700 flex-1 mr-2",children:n.name}),b.jsx("button",{onClick:g,className:"text-gray-500 hover:text-blue-600 transition-colors p-1",title:"Tlcharger",children:""})]})]}),b.jsx(x,{})]}):b.jsxs("div",{className:"w-64 bg-white border border-gray-200 p-3 rounded-xl shadow-sm",children:[b.jsxs("div",{className:"flex items-center justify-between mb-2",children:[b.jsxs("div",{className:"flex items-center space-x-2 overflow-hidden",children:[b.jsx("span",{className:"text-xl",children:""}),b.jsx("span",{className:"text-sm font-medium truncate text-gray-900",children:n.name})]}),b.jsx("button",{onClick:g,className:"text-blue-500 hover:text-blue-700 transition-colors",title:"Tlcharger",children:""})]}),b.jsx("div",{className:"w-full bg-gray-100 rounded-full h-1.5 mb-2",children:b.jsx("div",{className:"bg-green-500 h-1.5 rounded-full transition-all duration-300",style:{width:"100%"}})}),b.jsxs("div",{className:"flex justify-between items-center text-xs text-gray-500",children:[b.jsxs("span",{children:[v," MB"]}),b.jsx("span",{className:"font-medium text-green-600",children:"Termin"})]}),u&&(c==null?void 0:c.file)&&b.jsxs("div",{className:"mt-2 relative group cursor-pointer",onClick:g,children:[b.jsx("img",{src:URL.createObjectURL(c.file),alt:n.name,className:"w-full h-32 object-cover rounded-lg"}),b.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors rounded-lg"})]})]})}if((c==null?void 0:c.status)==="transferring"){const v=(n.size/1048576).toFixed(1);return b.jsxs("div",{className:"w-64 bg-white border border-gray-200 p-3 rounded-xl shadow-sm",children:[d&&n.thumbnail&&b.jsxs("div",{className:"mb-2 relative rounded-lg overflow-hidden bg-black",children:[b.jsx("img",{src:n.thumbnail,alt:"Preview",className:"w-full h-32 object-cover opacity-80"}),b.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:b.jsx("div",{className:"w-8 h-8 border-2 border-white border-t-transparent rounded-full animate-spin"})})]}),b.jsxs("div",{className:"flex items-center justify-between mb-2",children:[b.jsxs("div",{className:"flex items-center space-x-2 overflow-hidden",children:[b.jsx("span",{className:"text-xl",children:""}),b.jsx("span",{className:"text-sm font-medium truncate text-gray-900",children:n.name})]}),e&&b.jsx("button",{onClick:m,className:"text-gray-400 hover:text-red-500 transition-colors",title:"Annuler",children:""})]}),b.jsx("div",{className:"w-full bg-gray-100 rounded-full h-1.5 mb-2",children:b.jsx("div",{className:"bg-gray-600 h-1.5 rounded-full transition-all duration-300",style:{width:`${c.progress}%`}})}),b.jsxs("div",{className:"flex justify-between items-center text-xs text-gray-500",children:[b.jsxs("span",{children:[v," MB"]}),b.jsxs("span",{className:"font-medium text-gray-700",children:[Math.round(c.progress),"%"]})]})]})}return e&&(!h||h==="pending")?b.jsxs("div",{className:"w-64 bg-blue-50 border border-blue-100 p-3 rounded-xl",children:[d&&n.thumbnail&&b.jsx("div",{className:"mb-2 rounded-lg overflow-hidden bg-black",children:b.jsx("img",{src:n.thumbnail,alt:"Preview",className:"w-full h-32 object-cover opacity-80"})}),b.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[b.jsx("div",{className:"text-2xl",children:""}),b.jsxs("div",{className:"flex-1 min-w-0",children:[b.jsx("p",{className:"text-sm font-medium text-blue-900 truncate",children:n.name}),b.jsx("p",{className:"text-xs text-blue-600",children:"En attente d'acceptation..."})]})]}),b.jsx("button",{onClick:m,className:"w-full py-1 bg-white text-gray-500 text-xs font-medium rounded border border-gray-200 hover:bg-gray-50 hover:text-red-500 transition-colors",children:"Annuler l'envoi"})]}):!e&&(!h||h==="pending")?b.jsxs("div",{className:"w-64 bg-white border border-gray-200 p-3 rounded-xl shadow-sm",children:[d&&n.thumbnail&&b.jsxs("div",{className:"mb-3 rounded-lg overflow-hidden bg-black",children:[b.jsx("img",{src:n.thumbnail,alt:"Preview",className:"w-full h-32 object-cover opacity-80"}),b.jsxs("div",{className:"absolute bottom-2 right-2 px-2 py-1 bg-black/60 rounded text-xs text-white font-medium",children:[(n.size/(1024*1024)).toFixed(1)," MB"]})]}),b.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[b.jsx("div",{className:"text-2xl",children:""}),b.jsxs("div",{className:"flex-1 min-w-0",children:[b.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:n.name}),b.jsxs("p",{className:"text-xs text-gray-500",children:[(n.size/1024).toFixed(1)," KB"]})]})]}),b.jsxs("div",{className:"flex space-x-2",children:[b.jsx("button",{onClick:f,className:"flex-1 py-1.5 bg-green-500 text-white text-xs font-medium rounded hover:bg-green-600 transition-colors",children:"Accepter"}),b.jsx("button",{onClick:p,className:"flex-1 py-1.5 bg-red-50 text-red-600 text-xs font-medium rounded border border-red-100 hover:bg-red-100 transition-colors",children:"Refuser"})]})]}):null},aAe=({userId:t})=>{const{authorizedUsers:e,authorizeUser:n,unauthorizeUser:s}=Be(),r=e.includes(t),i=()=>{r?s(t):n(t)};return b.jsxs("div",{className:"flex items-center space-x-2",children:[b.jsx("span",{className:"text-xs text-gray-500 font-medium",children:r?"Autoris":"Non autoris"}),b.jsx("button",{onClick:i,className:`relative inline-flex h-5 w-9 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 ${r?"bg-green-500":"bg-gray-300"}`,title:r?"Dsactiver l'autorisation":"Autoriser la conversation",children:b.jsx("span",{className:`inline-block h-3 w-3 transform rounded-full bg-white transition-transform shadow-sm ${r?"translate-x-5":"translate-x-1"}`})})]})};function Yn(t){this.content=t}Yn.prototype={constructor:Yn,find:function(t){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===t)return e;return-1},get:function(t){var e=this.find(t);return e==-1?void 0:this.content[e+1]},update:function(t,e,n){var s=n&&n!=t?this.remove(n):this,r=s.find(t),i=s.content.slice();return r==-1?i.push(n||t,e):(i[r+1]=e,n&&(i[r]=n)),new Yn(i)},remove:function(t){var e=this.find(t);if(e==-1)return this;var n=this.content.slice();return n.splice(e,2),new Yn(n)},addToStart:function(t,e){return new Yn([t,e].concat(this.remove(t).content))},addToEnd:function(t,e){var n=this.remove(t).content.slice();return n.push(t,e),new Yn(n)},addBefore:function(t,e,n){var s=this.remove(e),r=s.content.slice(),i=s.find(t);return r.splice(i==-1?r.length:i,0,e,n),new Yn(r)},forEach:function(t){for(var e=0;e<this.content.length;e+=2)t(this.content[e],this.content[e+1])},prepend:function(t){return t=Yn.from(t),t.size?new Yn(t.content.concat(this.subtract(t).content)):this},append:function(t){return t=Yn.from(t),t.size?new Yn(this.subtract(t).content.concat(t.content)):this},subtract:function(t){var e=this;t=Yn.from(t);for(var n=0;n<t.content.length;n+=2)e=e.remove(t.content[n]);return e},toObject:function(){var t={};return this.forEach(function(e,n){t[e]=n}),t},get size(){return this.content.length>>1}};Yn.from=function(t){if(t instanceof Yn)return t;var e=[];if(t)for(var n in t)e.push(n,t[n]);return new Yn(e)};function M5(t,e,n){for(let s=0;;s++){if(s==t.childCount||s==e.childCount)return t.childCount==e.childCount?null:n;let r=t.child(s),i=e.child(s);if(r==i){n+=r.nodeSize;continue}if(!r.sameMarkup(i))return n;if(r.isText&&r.text!=i.text){for(let o=0;r.text[o]==i.text[o];o++)n++;return n}if(r.content.size||i.content.size){let o=M5(r.content,i.content,n+1);if(o!=null)return o}n+=r.nodeSize}}function P5(t,e,n,s){for(let r=t.childCount,i=e.childCount;;){if(r==0||i==0)return r==i?null:{a:n,b:s};let o=t.child(--r),a=e.child(--i),l=o.nodeSize;if(o==a){n-=l,s-=l;continue}if(!o.sameMarkup(a))return{a:n,b:s};if(o.isText&&o.text!=a.text){let c=0,u=Math.min(o.text.length,a.text.length);for(;c<u&&o.text[o.text.length-c-1]==a.text[a.text.length-c-1];)c++,n--,s--;return{a:n,b:s}}if(o.content.size||a.content.size){let c=P5(o.content,a.content,n-1,s-1);if(c)return c}n-=l,s-=l}}class se{constructor(e,n){if(this.content=e,this.size=n||0,n==null)for(let s=0;s<e.length;s++)this.size+=e[s].nodeSize}nodesBetween(e,n,s,r=0,i){for(let o=0,a=0;a<n;o++){let l=this.content[o],c=a+l.nodeSize;if(c>e&&s(l,r+a,i||null,o)!==!1&&l.content.size){let u=a+1;l.nodesBetween(Math.max(0,e-u),Math.min(l.content.size,n-u),s,r+u)}a=c}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,n,s,r){let i="",o=!0;return this.nodesBetween(e,n,(a,l)=>{let c=a.isText?a.text.slice(Math.max(e,l)-l,n-l):a.isLeaf?r?typeof r=="function"?r(a):r:a.type.spec.leafText?a.type.spec.leafText(a):"":"";a.isBlock&&(a.isLeaf&&c||a.isTextblock)&&s&&(o?o=!1:i+=s),i+=c},0),i}append(e){if(!e.size)return this;if(!this.size)return e;let n=this.lastChild,s=e.firstChild,r=this.content.slice(),i=0;for(n.isText&&n.sameMarkup(s)&&(r[r.length-1]=n.withText(n.text+s.text),i=1);i<e.content.length;i++)r.push(e.content[i]);return new se(r,this.size+e.size)}cut(e,n=this.size){if(e==0&&n==this.size)return this;let s=[],r=0;if(n>e)for(let i=0,o=0;o<n;i++){let a=this.content[i],l=o+a.nodeSize;l>e&&((o<e||l>n)&&(a.isText?a=a.cut(Math.max(0,e-o),Math.min(a.text.length,n-o)):a=a.cut(Math.max(0,e-o-1),Math.min(a.content.size,n-o-1))),s.push(a),r+=a.nodeSize),o=l}return new se(s,r)}cutByIndex(e,n){return e==n?se.empty:e==0&&n==this.content.length?this:new se(this.content.slice(e,n))}replaceChild(e,n){let s=this.content[e];if(s==n)return this;let r=this.content.slice(),i=this.size+n.nodeSize-s.nodeSize;return r[e]=n,new se(r,i)}addToStart(e){return new se([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new se(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let n=0;n<this.content.length;n++)if(!this.content[n].eq(e.content[n]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let n=this.content[e];if(!n)throw new RangeError("Index "+e+" out of range for "+this);return n}maybeChild(e){return this.content[e]||null}forEach(e){for(let n=0,s=0;n<this.content.length;n++){let r=this.content[n];e(r,s,n),s+=r.nodeSize}}findDiffStart(e,n=0){return M5(this,e,n)}findDiffEnd(e,n=this.size,s=e.size){return P5(this,e,n,s)}findIndex(e){if(e==0)return Kg(0,e);if(e==this.size)return Kg(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let n=0,s=0;;n++){let r=this.child(n),i=s+r.nodeSize;if(i>=e)return i==e?Kg(n+1,i):Kg(n,s);s=i}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,n){if(!n)return se.empty;if(!Array.isArray(n))throw new RangeError("Invalid input for Fragment.fromJSON");return new se(n.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return se.empty;let n,s=0;for(let r=0;r<e.length;r++){let i=e[r];s+=i.nodeSize,r&&i.isText&&e[r-1].sameMarkup(i)?(n||(n=e.slice(0,r)),n[n.length-1]=i.withText(n[n.length-1].text+i.text)):n&&n.push(i)}return new se(n||e,s)}static from(e){if(!e)return se.empty;if(e instanceof se)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new se([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}se.empty=new se([],0);const Vw={index:0,offset:0};function Kg(t,e){return Vw.index=t,Vw.offset=e,Vw}function ex(t,e){if(t===e)return!0;if(!(t&&typeof t=="object")||!(e&&typeof e=="object"))return!1;let n=Array.isArray(t);if(Array.isArray(e)!=n)return!1;if(n){if(t.length!=e.length)return!1;for(let s=0;s<t.length;s++)if(!ex(t[s],e[s]))return!1}else{for(let s in t)if(!(s in e)||!ex(t[s],e[s]))return!1;for(let s in e)if(!(s in t))return!1}return!0}let St=class OC{constructor(e,n){this.type=e,this.attrs=n}addToSet(e){let n,s=!1;for(let r=0;r<e.length;r++){let i=e[r];if(this.eq(i))return e;if(this.type.excludes(i.type))n||(n=e.slice(0,r));else{if(i.type.excludes(this.type))return e;!s&&i.type.rank>this.type.rank&&(n||(n=e.slice(0,r)),n.push(this),s=!0),n&&n.push(i)}}return n||(n=e.slice()),s||n.push(this),n}removeFromSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return e.slice(0,n).concat(e.slice(n+1));return e}isInSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return!0;return!1}eq(e){return this==e||this.type==e.type&&ex(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Mark.fromJSON");let s=e.marks[n.type];if(!s)throw new RangeError(`There is no mark type ${n.type} in this schema`);let r=s.create(n.attrs);return s.checkAttrs(r.attrs),r}static sameSet(e,n){if(e==n)return!0;if(e.length!=n.length)return!1;for(let s=0;s<e.length;s++)if(!e[s].eq(n[s]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return OC.none;if(e instanceof OC)return[e];let n=e.slice();return n.sort((s,r)=>s.type.rank-r.type.rank),n}};St.none=[];class tx extends Error{}class me{constructor(e,n,s){this.content=e,this.openStart=n,this.openEnd=s}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,n){let s=F5(this.content,e+this.openStart,n);return s&&new me(s,this.openStart,this.openEnd)}removeBetween(e,n){return new me(L5(this.content,e+this.openStart,n+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,n){if(!n)return me.empty;let s=n.openStart||0,r=n.openEnd||0;if(typeof s!="number"||typeof r!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new me(se.fromJSON(e,n.content),s,r)}static maxOpen(e,n=!0){let s=0,r=0;for(let i=e.firstChild;i&&!i.isLeaf&&(n||!i.type.spec.isolating);i=i.firstChild)s++;for(let i=e.lastChild;i&&!i.isLeaf&&(n||!i.type.spec.isolating);i=i.lastChild)r++;return new me(e,s,r)}}me.empty=new me(se.empty,0,0);function L5(t,e,n){let{index:s,offset:r}=t.findIndex(e),i=t.maybeChild(s),{index:o,offset:a}=t.findIndex(n);if(r==e||i.isText){if(a!=n&&!t.child(o).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(n))}if(s!=o)throw new RangeError("Removing non-flat range");return t.replaceChild(s,i.copy(L5(i.content,e-r-1,n-r-1)))}function F5(t,e,n,s){let{index:r,offset:i}=t.findIndex(e),o=t.maybeChild(r);if(i==e||o.isText)return s&&!s.canReplace(r,r,n)?null:t.cut(0,e).append(n).append(t.cut(e));let a=F5(o.content,e-i-1,n,o);return a&&t.replaceChild(r,o.copy(a))}function lAe(t,e,n){if(n.openStart>t.depth)throw new tx("Inserted content deeper than insertion position");if(t.depth-n.openStart!=e.depth-n.openEnd)throw new tx("Inconsistent open depths");return _5(t,e,n,0)}function _5(t,e,n,s){let r=t.index(s),i=t.node(s);if(r==e.index(s)&&s<t.depth-n.openStart){let o=_5(t,e,n,s+1);return i.copy(i.content.replaceChild(r,o))}else if(n.content.size)if(!n.openStart&&!n.openEnd&&t.depth==s&&e.depth==s){let o=t.parent,a=o.content;return pc(o,a.cut(0,t.parentOffset).append(n.content).append(a.cut(e.parentOffset)))}else{let{start:o,end:a}=cAe(n,t);return pc(i,B5(t,o,a,e,s))}else return pc(i,nx(t,e,s))}function z5(t,e){if(!e.type.compatibleContent(t.type))throw new tx("Cannot join "+e.type.name+" onto "+t.type.name)}function MC(t,e,n){let s=t.node(n);return z5(s,e.node(n)),s}function fc(t,e){let n=e.length-1;n>=0&&t.isText&&t.sameMarkup(e[n])?e[n]=t.withText(e[n].text+t.text):e.push(t)}function yf(t,e,n,s){let r=(e||t).node(n),i=0,o=e?e.index(n):r.childCount;t&&(i=t.index(n),t.depth>n?i++:t.textOffset&&(fc(t.nodeAfter,s),i++));for(let a=i;a<o;a++)fc(r.child(a),s);e&&e.depth==n&&e.textOffset&&fc(e.nodeBefore,s)}function pc(t,e){return t.type.checkContent(e),t.copy(e)}function B5(t,e,n,s,r){let i=t.depth>r&&MC(t,e,r+1),o=s.depth>r&&MC(n,s,r+1),a=[];return yf(null,t,r,a),i&&o&&e.index(r)==n.index(r)?(z5(i,o),fc(pc(i,B5(t,e,n,s,r+1)),a)):(i&&fc(pc(i,nx(t,e,r+1)),a),yf(e,n,r,a),o&&fc(pc(o,nx(n,s,r+1)),a)),yf(s,null,r,a),new se(a)}function nx(t,e,n){let s=[];if(yf(null,t,n,s),t.depth>n){let r=MC(t,e,n+1);fc(pc(r,nx(t,e,n+1)),s)}return yf(e,null,n,s),new se(s)}function cAe(t,e){let n=e.depth-t.openStart,r=e.node(n).copy(t.content);for(let i=n-1;i>=0;i--)r=e.node(i).copy(se.from(r));return{start:r.resolveNoCache(t.openStart+n),end:r.resolveNoCache(r.content.size-t.openEnd-n)}}class cp{constructor(e,n,s){this.pos=e,this.path=n,this.parentOffset=s,this.depth=n.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,n=this.index(this.depth);if(n==e.childCount)return null;let s=this.pos-this.path[this.path.length-1],r=e.child(n);return s?e.child(n).cut(s):r}get nodeBefore(){let e=this.index(this.depth),n=this.pos-this.path[this.path.length-1];return n?this.parent.child(e).cut(0,n):e==0?null:this.parent.child(e-1)}posAtIndex(e,n){n=this.resolveDepth(n);let s=this.path[n*3],r=n==0?0:this.path[n*3-1]+1;for(let i=0;i<e;i++)r+=s.child(i).nodeSize;return r}marks(){let e=this.parent,n=this.index();if(e.content.size==0)return St.none;if(this.textOffset)return e.child(n).marks;let s=e.maybeChild(n-1),r=e.maybeChild(n);if(!s){let a=s;s=r,r=a}let i=s.marks;for(var o=0;o<i.length;o++)i[o].type.spec.inclusive===!1&&(!r||!i[o].isInSet(r.marks))&&(i=i[o--].removeFromSet(i));return i}marksAcross(e){let n=this.parent.maybeChild(this.index());if(!n||!n.isInline)return null;let s=n.marks,r=e.parent.maybeChild(e.index());for(var i=0;i<s.length;i++)s[i].type.spec.inclusive===!1&&(!r||!s[i].isInSet(r.marks))&&(s=s[i--].removeFromSet(s));return s}sharedDepth(e){for(let n=this.depth;n>0;n--)if(this.start(n)<=e&&this.end(n)>=e)return n;return 0}blockRange(e=this,n){if(e.pos<this.pos)return e.blockRange(this);for(let s=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);s>=0;s--)if(e.pos<=this.end(s)&&(!n||n(this.node(s))))return new sx(this,e,s);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let n=1;n<=this.depth;n++)e+=(e?"/":"")+this.node(n).type.name+"_"+this.index(n-1);return e+":"+this.parentOffset}static resolve(e,n){if(!(n>=0&&n<=e.content.size))throw new RangeError("Position "+n+" out of range");let s=[],r=0,i=n;for(let o=e;;){let{index:a,offset:l}=o.content.findIndex(i),c=i-l;if(s.push(o,a,r+l),!c||(o=o.child(a),o.isText))break;i=c-1,r+=l+1}return new cp(n,s,i)}static resolveCached(e,n){let s=OM.get(e);if(s)for(let i=0;i<s.elts.length;i++){let o=s.elts[i];if(o.pos==n)return o}else OM.set(e,s=new uAe);let r=s.elts[s.i]=cp.resolve(e,n);return s.i=(s.i+1)%dAe,r}}class uAe{constructor(){this.elts=[],this.i=0}}const dAe=12,OM=new WeakMap;class sx{constructor(e,n,s){this.$from=e,this.$to=n,this.depth=s}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const hAe=Object.create(null);class $i{constructor(e,n,s,r=St.none){this.type=e,this.attrs=n,this.marks=r,this.content=s||se.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,n,s,r=0){this.content.nodesBetween(e,n,s,r,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,n,s,r){return this.content.textBetween(e,n,s,r)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,n,s){return this.type==e&&ex(this.attrs,n||e.defaultAttrs||hAe)&&St.sameSet(this.marks,s||St.none)}copy(e=null){return e==this.content?this:new $i(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new $i(this.type,this.attrs,this.content,e)}cut(e,n=this.content.size){return e==0&&n==this.content.size?this:this.copy(this.content.cut(e,n))}slice(e,n=this.content.size,s=!1){if(e==n)return me.empty;let r=this.resolve(e),i=this.resolve(n),o=s?0:r.sharedDepth(n),a=r.start(o),c=r.node(o).content.cut(r.pos-a,i.pos-a);return new me(c,r.depth-o,i.depth-o)}replace(e,n,s){return lAe(this.resolve(e),this.resolve(n),s)}nodeAt(e){for(let n=this;;){let{index:s,offset:r}=n.content.findIndex(e);if(n=n.maybeChild(s),!n)return null;if(r==e||n.isText)return n;e-=r+1}}childAfter(e){let{index:n,offset:s}=this.content.findIndex(e);return{node:this.content.maybeChild(n),index:n,offset:s}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:n,offset:s}=this.content.findIndex(e);if(s<e)return{node:this.content.child(n),index:n,offset:s};let r=this.content.child(n-1);return{node:r,index:n-1,offset:s-r.nodeSize}}resolve(e){return cp.resolveCached(this,e)}resolveNoCache(e){return cp.resolve(this,e)}rangeHasMark(e,n,s){let r=!1;return n>e&&this.nodesBetween(e,n,i=>(s.isInSet(i.marks)&&(r=!0),!r)),r}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),j5(this.marks,e)}contentMatchAt(e){let n=this.type.contentMatch.matchFragment(this.content,0,e);if(!n)throw new Error("Called contentMatchAt on a node with invalid content");return n}canReplace(e,n,s=se.empty,r=0,i=s.childCount){let o=this.contentMatchAt(e).matchFragment(s,r,i),a=o&&o.matchFragment(this.content,n);if(!a||!a.validEnd)return!1;for(let l=r;l<i;l++)if(!this.type.allowsMarks(s.child(l).marks))return!1;return!0}canReplaceWith(e,n,s,r){if(r&&!this.type.allowsMarks(r))return!1;let i=this.contentMatchAt(e).matchType(s),o=i&&i.matchFragment(this.content,n);return o?o.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=St.none;for(let n=0;n<this.marks.length;n++){let s=this.marks[n];s.type.checkAttrs(s.attrs),e=s.addToSet(e)}if(!St.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(n=>n.type.name)}`);this.content.forEach(n=>n.check())}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(n=>n.toJSON())),e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Node.fromJSON");let s;if(n.marks){if(!Array.isArray(n.marks))throw new RangeError("Invalid mark data for Node.fromJSON");s=n.marks.map(e.markFromJSON)}if(n.type=="text"){if(typeof n.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(n.text,s)}let r=se.fromJSON(e,n.content),i=e.nodeType(n.type).create(n.attrs,r,s);return i.type.checkAttrs(i.attrs),i}}$i.prototype.text=void 0;class rx extends $i{constructor(e,n,s,r){if(super(e,n,null,r),!s)throw new RangeError("Empty text nodes are not allowed");this.text=s}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):j5(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,n){return this.text.slice(e,n)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new rx(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new rx(this.type,this.attrs,e,this.marks)}cut(e=0,n=this.text.length){return e==0&&n==this.text.length?this:this.withText(this.text.slice(e,n))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function j5(t,e){for(let n=t.length-1;n>=0;n--)e=t[n].type.name+"("+e+")";return e}class zc{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,n){let s=new fAe(e,n);if(s.next==null)return zc.empty;let r=V5(s);s.next&&s.err("Unexpected trailing text");let i=vAe(bAe(r));return wAe(i,s),i}matchType(e){for(let n=0;n<this.next.length;n++)if(this.next[n].type==e)return this.next[n].next;return null}matchFragment(e,n=0,s=e.childCount){let r=this;for(let i=n;r&&i<s;i++)r=r.matchType(e.child(i).type);return r}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:n}=this.next[e];if(!(n.isText||n.hasRequiredAttrs()))return n}return null}compatible(e){for(let n=0;n<this.next.length;n++)for(let s=0;s<e.next.length;s++)if(this.next[n].type==e.next[s].type)return!0;return!1}fillBefore(e,n=!1,s=0){let r=[this];function i(o,a){let l=o.matchFragment(e,s);if(l&&(!n||l.validEnd))return se.from(a.map(c=>c.createAndFill()));for(let c=0;c<o.next.length;c++){let{type:u,next:d}=o.next[c];if(!(u.isText||u.hasRequiredAttrs())&&r.indexOf(d)==-1){r.push(d);let h=i(d,a.concat(u));if(h)return h}}return null}return i(this,[])}findWrapping(e){for(let s=0;s<this.wrapCache.length;s+=2)if(this.wrapCache[s]==e)return this.wrapCache[s+1];let n=this.computeWrapping(e);return this.wrapCache.push(e,n),n}computeWrapping(e){let n=Object.create(null),s=[{match:this,type:null,via:null}];for(;s.length;){let r=s.shift(),i=r.match;if(i.matchType(e)){let o=[];for(let a=r;a.type;a=a.via)o.push(a.type);return o.reverse()}for(let o=0;o<i.next.length;o++){let{type:a,next:l}=i.next[o];!a.isLeaf&&!a.hasRequiredAttrs()&&!(a.name in n)&&(!r.type||l.validEnd)&&(s.push({match:a.contentMatch,type:a,via:r}),n[a.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function n(s){e.push(s);for(let r=0;r<s.next.length;r++)e.indexOf(s.next[r].next)==-1&&n(s.next[r].next)}return n(this),e.map((s,r)=>{let i=r+(s.validEnd?"*":" ")+" ";for(let o=0;o<s.next.length;o++)i+=(o?", ":"")+s.next[o].type.name+"->"+e.indexOf(s.next[o].next);return i}).join(`
`)}}zc.empty=new zc(!0);class fAe{constructor(e,n){this.string=e,this.nodeTypes=n,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function V5(t){let e=[];do e.push(pAe(t));while(t.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function pAe(t){let e=[];do e.push(mAe(t));while(t.next&&t.next!=")"&&t.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function mAe(t){let e=xAe(t);for(;;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else if(t.eat("{"))e=gAe(t,e);else break;return e}function MM(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");let e=Number(t.next);return t.pos++,e}function gAe(t,e){let n=MM(t),s=n;return t.eat(",")&&(t.next!="}"?s=MM(t):s=-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:n,max:s,expr:e}}function yAe(t,e){let n=t.nodeTypes,s=n[e];if(s)return[s];let r=[];for(let i in n){let o=n[i];o.isInGroup(e)&&r.push(o)}return r.length==0&&t.err("No node type or group '"+e+"' found"),r}function xAe(t){if(t.eat("(")){let e=V5(t);return t.eat(")")||t.err("Missing closing paren"),e}else if(/\W/.test(t.next))t.err("Unexpected token '"+t.next+"'");else{let e=yAe(t,t.next).map(n=>(t.inline==null?t.inline=n.isInline:t.inline!=n.isInline&&t.err("Mixing inline and block content"),{type:"name",value:n}));return t.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function bAe(t){let e=[[]];return r(i(t,0),n()),e;function n(){return e.push([])-1}function s(o,a,l){let c={term:l,to:a};return e[o].push(c),c}function r(o,a){o.forEach(l=>l.to=a)}function i(o,a){if(o.type=="choice")return o.exprs.reduce((l,c)=>l.concat(i(c,a)),[]);if(o.type=="seq")for(let l=0;;l++){let c=i(o.exprs[l],a);if(l==o.exprs.length-1)return c;r(c,a=n())}else if(o.type=="star"){let l=n();return s(a,l),r(i(o.expr,l),l),[s(l)]}else if(o.type=="plus"){let l=n();return r(i(o.expr,a),l),r(i(o.expr,l),l),[s(l)]}else{if(o.type=="opt")return[s(a)].concat(i(o.expr,a));if(o.type=="range"){let l=a;for(let c=0;c<o.min;c++){let u=n();r(i(o.expr,l),u),l=u}if(o.max==-1)r(i(o.expr,l),l);else for(let c=o.min;c<o.max;c++){let u=n();s(l,u),r(i(o.expr,l),u),l=u}return[s(l)]}else{if(o.type=="name")return[s(a,void 0,o.value)];throw new Error("Unknown expr type")}}}}function U5(t,e){return e-t}function PM(t,e){let n=[];return s(e),n.sort(U5);function s(r){let i=t[r];if(i.length==1&&!i[0].term)return s(i[0].to);n.push(r);for(let o=0;o<i.length;o++){let{term:a,to:l}=i[o];!a&&n.indexOf(l)==-1&&s(l)}}}function vAe(t){let e=Object.create(null);return n(PM(t,0));function n(s){let r=[];s.forEach(o=>{t[o].forEach(({term:a,to:l})=>{if(!a)return;let c;for(let u=0;u<r.length;u++)r[u][0]==a&&(c=r[u][1]);PM(t,l).forEach(u=>{c||r.push([a,c=[]]),c.indexOf(u)==-1&&c.push(u)})})});let i=e[s.join(",")]=new zc(s.indexOf(t.length-1)>-1);for(let o=0;o<r.length;o++){let a=r[o][1].sort(U5);i.next.push({type:r[o][0],next:e[a.join(",")]||n(a)})}return i}}function wAe(t,e){for(let n=0,s=[t];n<s.length;n++){let r=s[n],i=!r.validEnd,o=[];for(let a=0;a<r.next.length;a++){let{type:l,next:c}=r.next[a];o.push(l.name),i&&!(l.isText||l.hasRequiredAttrs())&&(i=!1),s.indexOf(c)==-1&&s.push(c)}i&&e.err("Only non-generatable nodes ("+o.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function W5(t){let e=Object.create(null);for(let n in t){let s=t[n];if(!s.hasDefault)return null;e[n]=s.default}return e}function H5(t,e){let n=Object.create(null);for(let s in t){let r=e&&e[s];if(r===void 0){let i=t[s];if(i.hasDefault)r=i.default;else throw new RangeError("No value supplied for attribute "+s)}n[s]=r}return n}function G5(t,e,n,s){for(let r in e)if(!(r in t))throw new RangeError(`Unsupported attribute ${r} for ${n} of type ${r}`);for(let r in t){let i=t[r];i.validate&&i.validate(e[r])}}function K5(t,e){let n=Object.create(null);if(e)for(let s in e)n[s]=new kAe(t,s,e[s]);return n}let LM=class q5{constructor(e,n,s){this.name=e,this.schema=n,this.spec=s,this.markSet=null,this.groups=s.group?s.group.split(" "):[],this.attrs=K5(e,s.attrs),this.defaultAttrs=W5(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(s.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==zc.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:H5(this.attrs,e)}create(e=null,n,s){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new $i(this,this.computeAttrs(e),se.from(n),St.setFrom(s))}createChecked(e=null,n,s){return n=se.from(n),this.checkContent(n),new $i(this,this.computeAttrs(e),n,St.setFrom(s))}createAndFill(e=null,n,s){if(e=this.computeAttrs(e),n=se.from(n),n.size){let o=this.contentMatch.fillBefore(n);if(!o)return null;n=o.append(n)}let r=this.contentMatch.matchFragment(n),i=r&&r.fillBefore(se.empty,!0);return i?new $i(this,e,n.append(i),St.setFrom(s)):null}validContent(e){let n=this.contentMatch.matchFragment(e);if(!n||!n.validEnd)return!1;for(let s=0;s<e.childCount;s++)if(!this.allowsMarks(e.child(s).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){G5(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let n=0;n<e.length;n++)if(!this.allowsMarkType(e[n].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let n;for(let s=0;s<e.length;s++)this.allowsMarkType(e[s].type)?n&&n.push(e[s]):n||(n=e.slice(0,s));return n?n.length?n:St.none:e}static compile(e,n){let s=Object.create(null);e.forEach((i,o)=>s[i]=new q5(i,n,o));let r=n.spec.topNode||"doc";if(!s[r])throw new RangeError("Schema is missing its top node type ('"+r+"')");if(!s.text)throw new RangeError("Every schema needs a 'text' type");for(let i in s.text.attrs)throw new RangeError("The text node type should not have attributes");return s}};function SAe(t,e,n){let s=n.split("|");return r=>{let i=r===null?"null":typeof r;if(s.indexOf(i)<0)throw new RangeError(`Expected value of type ${s} for attribute ${e} on type ${t}, got ${i}`)}}class kAe{constructor(e,n,s){this.hasDefault=Object.prototype.hasOwnProperty.call(s,"default"),this.default=s.default,this.validate=typeof s.validate=="string"?SAe(e,n,s.validate):s.validate}get isRequired(){return!this.hasDefault}}class t1{constructor(e,n,s,r){this.name=e,this.rank=n,this.schema=s,this.spec=r,this.attrs=K5(e,r.attrs),this.excluded=null;let i=W5(this.attrs);this.instance=i?new St(this,i):null}create(e=null){return!e&&this.instance?this.instance:new St(this,H5(this.attrs,e))}static compile(e,n){let s=Object.create(null),r=0;return e.forEach((i,o)=>s[i]=new t1(i,r++,n,o)),s}removeFromSet(e){for(var n=0;n<e.length;n++)e[n].type==this&&(e=e.slice(0,n).concat(e.slice(n+1)),n--);return e}isInSet(e){for(let n=0;n<e.length;n++)if(e[n].type==this)return e[n]}checkAttrs(e){G5(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}}class X5{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let n=this.spec={};for(let r in e)n[r]=e[r];n.nodes=Yn.from(e.nodes),n.marks=Yn.from(e.marks||{}),this.nodes=LM.compile(this.spec.nodes,this),this.marks=t1.compile(this.spec.marks,this);let s=Object.create(null);for(let r in this.nodes){if(r in this.marks)throw new RangeError(r+" can not be both a node and a mark");let i=this.nodes[r],o=i.spec.content||"",a=i.spec.marks;if(i.contentMatch=s[o]||(s[o]=zc.parse(o,this.nodes)),i.inlineContent=i.contentMatch.inlineContent,i.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!i.isInline||!i.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=i}i.markSet=a=="_"?null:a?FM(this,a.split(" ")):a==""||!i.inlineContent?[]:null}for(let r in this.marks){let i=this.marks[r],o=i.spec.excludes;i.excluded=o==null?[i]:o==""?[]:FM(this,o.split(" "))}this.nodeFromJSON=r=>$i.fromJSON(this,r),this.markFromJSON=r=>St.fromJSON(this,r),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,n=null,s,r){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof LM){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(n,s,r)}text(e,n){let s=this.nodes.text;return new rx(s,s.defaultAttrs,e,St.setFrom(n))}mark(e,n){return typeof e=="string"&&(e=this.marks[e]),e.create(n)}nodeType(e){let n=this.nodes[e];if(!n)throw new RangeError("Unknown node type: "+e);return n}}function FM(t,e){let n=[];for(let s=0;s<e.length;s++){let r=e[s],i=t.marks[r],o=i;if(i)n.push(i);else for(let a in t.marks){let l=t.marks[a];(r=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(r)>-1)&&n.push(o=l)}if(!o)throw new SyntaxError("Unknown mark type: '"+e[s]+"'")}return n}function CAe(t){return t.tag!=null}function NAe(t){return t.style!=null}class Qa{constructor(e,n){this.schema=e,this.rules=n,this.tags=[],this.styles=[];let s=this.matchedStyles=[];n.forEach(r=>{if(CAe(r))this.tags.push(r);else if(NAe(r)){let i=/[^=]*/.exec(r.style)[0];s.indexOf(i)<0&&s.push(i),this.styles.push(r)}}),this.normalizeLists=!this.tags.some(r=>{if(!/^(ul|ol)\b/.test(r.tag)||!r.node)return!1;let i=e.nodes[r.node];return i.contentMatch.matchType(i)})}parse(e,n={}){let s=new zM(this,n,!1);return s.addAll(e,St.none,n.from,n.to),s.finish()}parseSlice(e,n={}){let s=new zM(this,n,!0);return s.addAll(e,St.none,n.from,n.to),me.maxOpen(s.finish())}matchTag(e,n,s){for(let r=s?this.tags.indexOf(s)+1:0;r<this.tags.length;r++){let i=this.tags[r];if(IAe(e,i.tag)&&(i.namespace===void 0||e.namespaceURI==i.namespace)&&(!i.context||n.matchesContext(i.context))){if(i.getAttrs){let o=i.getAttrs(e);if(o===!1)continue;i.attrs=o||void 0}return i}}}matchStyle(e,n,s,r){for(let i=r?this.styles.indexOf(r)+1:0;i<this.styles.length;i++){let o=this.styles[i],a=o.style;if(!(a.indexOf(e)!=0||o.context&&!s.matchesContext(o.context)||a.length>e.length&&(a.charCodeAt(e.length)!=61||a.slice(e.length+1)!=n))){if(o.getAttrs){let l=o.getAttrs(n);if(l===!1)continue;o.attrs=l||void 0}return o}}}static schemaRules(e){let n=[];function s(r){let i=r.priority==null?50:r.priority,o=0;for(;o<n.length;o++){let a=n[o];if((a.priority==null?50:a.priority)<i)break}n.splice(o,0,r)}for(let r in e.marks){let i=e.marks[r].spec.parseDOM;i&&i.forEach(o=>{s(o=BM(o)),o.mark||o.ignore||o.clearMark||(o.mark=r)})}for(let r in e.nodes){let i=e.nodes[r].spec.parseDOM;i&&i.forEach(o=>{s(o=BM(o)),o.node||o.ignore||o.mark||(o.node=r)})}return n}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new Qa(e,Qa.schemaRules(e)))}}const J5={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},TAe={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},Y5={ol:!0,ul:!0},up=1,PC=2,xf=4;function _M(t,e,n){return e!=null?(e?up:0)|(e==="full"?PC:0):t&&t.whitespace=="pre"?up|PC:n&~xf}class qg{constructor(e,n,s,r,i,o){this.type=e,this.attrs=n,this.marks=s,this.solid=r,this.options=o,this.content=[],this.activeMarks=St.none,this.match=i||(o&xf?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let n=this.type.contentMatch.fillBefore(se.from(e));if(n)this.match=this.type.contentMatch.matchFragment(n);else{let s=this.type.contentMatch,r;return(r=s.findWrapping(e.type))?(this.match=s,r):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&up)){let s=this.content[this.content.length-1],r;if(s&&s.isText&&(r=/[ \t\r\n\u000c]+$/.exec(s.text))){let i=s;s.text.length==r[0].length?this.content.pop():this.content[this.content.length-1]=i.withText(i.text.slice(0,i.text.length-r[0].length))}}let n=se.from(this.content);return!e&&this.match&&(n=n.append(this.match.fillBefore(se.empty,!0))),this.type?this.type.create(this.attrs,n,this.marks):n}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!J5.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class zM{constructor(e,n,s){this.parser=e,this.options=n,this.isOpen=s,this.open=0,this.localPreserveWS=!1;let r=n.topNode,i,o=_M(null,n.preserveWhitespace,0)|(s?xf:0);r?i=new qg(r.type,r.attrs,St.none,!0,n.topMatch||r.type.contentMatch,o):s?i=new qg(null,null,St.none,!0,null,o):i=new qg(e.schema.topNodeType,null,St.none,!0,null,o),this.nodes=[i],this.find=n.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,n){e.nodeType==3?this.addTextNode(e,n):e.nodeType==1&&this.addElement(e,n)}addTextNode(e,n){let s=e.nodeValue,r=this.top,i=r.options&PC?"full":this.localPreserveWS||(r.options&up)>0,{schema:o}=this.parser;if(i==="full"||r.inlineContext(e)||/[^ \t\r\n\u000c]/.test(s)){if(i)if(i==="full")s=s.replace(/\r\n?/g,`
`);else if(o.linebreakReplacement&&/[\r\n]/.test(s)&&this.top.findWrapping(o.linebreakReplacement.create())){let a=s.split(/\r?\n|\r/);for(let l=0;l<a.length;l++)l&&this.insertNode(o.linebreakReplacement.create(),n,!0),a[l]&&this.insertNode(o.text(a[l]),n,!/\S/.test(a[l]));s=""}else s=s.replace(/\r?\n|\r/g," ");else if(s=s.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(s)&&this.open==this.nodes.length-1){let a=r.content[r.content.length-1],l=e.previousSibling;(!a||l&&l.nodeName=="BR"||a.isText&&/[ \t\r\n\u000c]$/.test(a.text))&&(s=s.slice(1))}s&&this.insertNode(o.text(s),n,!/\S/.test(s)),this.findInText(e)}else this.findInside(e)}addElement(e,n,s){let r=this.localPreserveWS,i=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let o=e.nodeName.toLowerCase(),a;Y5.hasOwnProperty(o)&&this.parser.normalizeLists&&EAe(e);let l=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(a=this.parser.matchTag(e,this,s));e:if(l?l.ignore:TAe.hasOwnProperty(o))this.findInside(e),this.ignoreFallback(e,n);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(e=l.skip);let c,u=this.needsBlock;if(J5.hasOwnProperty(o))i.content.length&&i.content[0].isInline&&this.open&&(this.open--,i=this.top),c=!0,i.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,n);break e}let d=l&&l.skip?n:this.readStyles(e,n);d&&this.addAll(e,d),c&&this.sync(i),this.needsBlock=u}else{let c=this.readStyles(e,n);c&&this.addElementByRule(e,l,c,l.consuming===!1?a:void 0)}this.localPreserveWS=r}leafFallback(e,n){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),n)}ignoreFallback(e,n){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),n,!0)}readStyles(e,n){let s=e.style;if(s&&s.length)for(let r=0;r<this.parser.matchedStyles.length;r++){let i=this.parser.matchedStyles[r],o=s.getPropertyValue(i);if(o)for(let a=void 0;;){let l=this.parser.matchStyle(i,o,this,a);if(!l)break;if(l.ignore)return null;if(l.clearMark?n=n.filter(c=>!l.clearMark(c)):n=n.concat(this.parser.schema.marks[l.mark].create(l.attrs)),l.consuming===!1)a=l;else break}}return n}addElementByRule(e,n,s,r){let i,o;if(n.node)if(o=this.parser.schema.nodes[n.node],o.isLeaf)this.insertNode(o.create(n.attrs),s,e.nodeName=="BR")||this.leafFallback(e,s);else{let l=this.enter(o,n.attrs||null,s,n.preserveWhitespace);l&&(i=!0,s=l)}else{let l=this.parser.schema.marks[n.mark];s=s.concat(l.create(n.attrs))}let a=this.top;if(o&&o.isLeaf)this.findInside(e);else if(r)this.addElement(e,s,r);else if(n.getContent)this.findInside(e),n.getContent(e,this.parser.schema).forEach(l=>this.insertNode(l,s,!1));else{let l=e;typeof n.contentElement=="string"?l=e.querySelector(n.contentElement):typeof n.contentElement=="function"?l=n.contentElement(e):n.contentElement&&(l=n.contentElement),this.findAround(e,l,!0),this.addAll(l,s),this.findAround(e,l,!1)}i&&this.sync(a)&&this.open--}addAll(e,n,s,r){let i=s||0;for(let o=s?e.childNodes[s]:e.firstChild,a=r==null?null:e.childNodes[r];o!=a;o=o.nextSibling,++i)this.findAtPoint(e,i),this.addDOM(o,n);this.findAtPoint(e,i)}findPlace(e,n,s){let r,i;for(let o=this.open,a=0;o>=0;o--){let l=this.nodes[o],c=l.findWrapping(e);if(c&&(!r||r.length>c.length+a)&&(r=c,i=l,!c.length))break;if(l.solid){if(s)break;a+=2}}if(!r)return null;this.sync(i);for(let o=0;o<r.length;o++)n=this.enterInner(r[o],null,n,!1);return n}insertNode(e,n,s){if(e.isInline&&this.needsBlock&&!this.top.type){let i=this.textblockFromContext();i&&(n=this.enterInner(i,null,n))}let r=this.findPlace(e,n,s);if(r){this.closeExtra();let i=this.top;i.match&&(i.match=i.match.matchType(e.type));let o=St.none;for(let a of r.concat(e.marks))(i.type?i.type.allowsMarkType(a.type):jM(a.type,e.type))&&(o=a.addToSet(o));return i.content.push(e.mark(o)),!0}return!1}enter(e,n,s,r){let i=this.findPlace(e.create(n),s,!1);return i&&(i=this.enterInner(e,n,s,!0,r)),i}enterInner(e,n,s,r=!1,i){this.closeExtra();let o=this.top;o.match=o.match&&o.match.matchType(e);let a=_M(e,i,o.options);o.options&xf&&o.content.length==0&&(a|=xf);let l=St.none;return s=s.filter(c=>(o.type?o.type.allowsMarkType(c.type):jM(c.type,e))?(l=c.addToSet(l),!1):!0),this.nodes.push(new qg(e,n,l,r,null,a)),this.open++,s}closeExtra(e=!1){let n=this.nodes.length-1;if(n>this.open){for(;n>this.open;n--)this.nodes[n-1].content.push(this.nodes[n].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let n=this.open;n>=0;n--){if(this.nodes[n]==e)return this.open=n,!0;this.localPreserveWS&&(this.nodes[n].options|=up)}return!1}get currentPos(){this.closeExtra();let e=0;for(let n=this.open;n>=0;n--){let s=this.nodes[n].content;for(let r=s.length-1;r>=0;r--)e+=s[r].nodeSize;n&&e++}return e}findAtPoint(e,n){if(this.find)for(let s=0;s<this.find.length;s++)this.find[s].node==e&&this.find[s].offset==n&&(this.find[s].pos=this.currentPos)}findInside(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].pos==null&&e.nodeType==1&&e.contains(this.find[n].node)&&(this.find[n].pos=this.currentPos)}findAround(e,n,s){if(e!=n&&this.find)for(let r=0;r<this.find.length;r++)this.find[r].pos==null&&e.nodeType==1&&e.contains(this.find[r].node)&&n.compareDocumentPosition(this.find[r].node)&(s?2:4)&&(this.find[r].pos=this.currentPos)}findInText(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&(this.find[n].pos=this.currentPos-(e.nodeValue.length-this.find[n].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let n=e.split("/"),s=this.options.context,r=!this.isOpen&&(!s||s.parent.type==this.nodes[0].type),i=-(s?s.depth+1:0)+(r?0:1),o=(a,l)=>{for(;a>=0;a--){let c=n[a];if(c==""){if(a==n.length-1||a==0)continue;for(;l>=i;l--)if(o(a-1,l))return!0;return!1}else{let u=l>0||l==0&&r?this.nodes[l].type:s&&l>=i?s.node(l-i).type:null;if(!u||u.name!=c&&!u.isInGroup(c))return!1;l--}}return!0};return o(n.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let n=e.depth;n>=0;n--){let s=e.node(n).contentMatchAt(e.indexAfter(n)).defaultType;if(s&&s.isTextblock&&s.defaultAttrs)return s}for(let n in this.parser.schema.nodes){let s=this.parser.schema.nodes[n];if(s.isTextblock&&s.defaultAttrs)return s}}}function EAe(t){for(let e=t.firstChild,n=null;e;e=e.nextSibling){let s=e.nodeType==1?e.nodeName.toLowerCase():null;s&&Y5.hasOwnProperty(s)&&n?(n.appendChild(e),e=n):s=="li"?n=e:s&&(n=null)}}function IAe(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function BM(t){let e={};for(let n in t)e[n]=t[n];return e}function jM(t,e){let n=e.schema.nodes;for(let s in n){let r=n[s];if(!r.allowsMarkType(t))continue;let i=[],o=a=>{i.push(a);for(let l=0;l<a.edgeCount;l++){let{type:c,next:u}=a.edge(l);if(c==e||i.indexOf(u)<0&&o(u))return!0}};if(o(r.contentMatch))return!0}}class au{constructor(e,n){this.nodes=e,this.marks=n}serializeFragment(e,n={},s){s||(s=Uw(n).createDocumentFragment());let r=s,i=[];return e.forEach(o=>{if(i.length||o.marks.length){let a=0,l=0;for(;a<i.length&&l<o.marks.length;){let c=o.marks[l];if(!this.marks[c.type.name]){l++;continue}if(!c.eq(i[a][0])||c.type.spec.spanning===!1)break;a++,l++}for(;a<i.length;)r=i.pop()[1];for(;l<o.marks.length;){let c=o.marks[l++],u=this.serializeMark(c,o.isInline,n);u&&(i.push([c,r]),r.appendChild(u.dom),r=u.contentDOM||u.dom)}}r.appendChild(this.serializeNodeInner(o,n))}),s}serializeNodeInner(e,n){let{dom:s,contentDOM:r}=My(Uw(n),this.nodes[e.type.name](e),null,e.attrs);if(r){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,n,r)}return s}serializeNode(e,n={}){let s=this.serializeNodeInner(e,n);for(let r=e.marks.length-1;r>=0;r--){let i=this.serializeMark(e.marks[r],e.isInline,n);i&&((i.contentDOM||i.dom).appendChild(s),s=i.dom)}return s}serializeMark(e,n,s={}){let r=this.marks[e.type.name];return r&&My(Uw(s),r(e,n),null,e.attrs)}static renderSpec(e,n,s=null,r){return My(e,n,s,r)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new au(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let n=VM(e.nodes);return n.text||(n.text=s=>s.text),n}static marksFromSchema(e){return VM(e.marks)}}function VM(t){let e={};for(let n in t){let s=t[n].spec.toDOM;s&&(e[n]=s)}return e}function Uw(t){return t.document||window.document}const UM=new WeakMap;function AAe(t){let e=UM.get(t);return e===void 0&&UM.set(t,e=$Ae(t)),e}function $Ae(t){let e=null;function n(s){if(s&&typeof s=="object")if(Array.isArray(s))if(typeof s[0]=="string")e||(e=[]),e.push(s);else for(let r=0;r<s.length;r++)n(s[r]);else for(let r in s)n(s[r])}return n(t),e}function My(t,e,n,s){if(typeof e=="string")return{dom:t.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let r=e[0],i;if(typeof r!="string")throw new RangeError("Invalid array passed to renderSpec");if(s&&(i=AAe(s))&&i.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let o=r.indexOf(" ");o>0&&(n=r.slice(0,o),r=r.slice(o+1));let a,l=n?t.createElementNS(n,r):t.createElement(r),c=e[1],u=1;if(c&&typeof c=="object"&&c.nodeType==null&&!Array.isArray(c)){u=2;for(let d in c)if(c[d]!=null){let h=d.indexOf(" ");h>0?l.setAttributeNS(d.slice(0,h),d.slice(h+1),c[d]):d=="style"&&l.style?l.style.cssText=c[d]:l.setAttribute(d,c[d])}}for(let d=u;d<e.length;d++){let h=e[d];if(h===0){if(d<e.length-1||d>u)throw new RangeError("Content hole must be the only child of its parent node");return{dom:l,contentDOM:l}}else{let{dom:f,contentDOM:p}=My(t,h,n,s);if(l.appendChild(f),p){if(a)throw new RangeError("Multiple content holes");a=p}}}return{dom:l,contentDOM:a}}const Q5=65535,Z5=Math.pow(2,16);function RAe(t,e){return t+e*Z5}function WM(t){return t&Q5}function DAe(t){return(t-(t&Q5))/Z5}const eH=1,tH=2,Py=4,nH=8;class LC{constructor(e,n,s){this.pos=e,this.delInfo=n,this.recover=s}get deleted(){return(this.delInfo&nH)>0}get deletedBefore(){return(this.delInfo&(eH|Py))>0}get deletedAfter(){return(this.delInfo&(tH|Py))>0}get deletedAcross(){return(this.delInfo&Py)>0}}class yr{constructor(e,n=!1){if(this.ranges=e,this.inverted=n,!e.length&&yr.empty)return yr.empty}recover(e){let n=0,s=WM(e);if(!this.inverted)for(let r=0;r<s;r++)n+=this.ranges[r*3+2]-this.ranges[r*3+1];return this.ranges[s*3]+n+DAe(e)}mapResult(e,n=1){return this._map(e,n,!1)}map(e,n=1){return this._map(e,n,!0)}_map(e,n,s){let r=0,i=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?r:0);if(l>e)break;let c=this.ranges[a+i],u=this.ranges[a+o],d=l+c;if(e<=d){let h=c?e==l?-1:e==d?1:n:n,f=l+r+(h<0?0:u);if(s)return f;let p=e==(n<0?l:d)?null:RAe(a/3,e-l),m=e==l?tH:e==d?eH:Py;return(n<0?e!=l:e!=d)&&(m|=nH),new LC(f,m,p)}r+=u-c}return s?e+r:new LC(e+r,0,null)}touches(e,n){let s=0,r=WM(n),i=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?s:0);if(l>e)break;let c=this.ranges[a+i],u=l+c;if(e<=u&&a==r*3)return!0;s+=this.ranges[a+o]-c}return!1}forEach(e){let n=this.inverted?2:1,s=this.inverted?1:2;for(let r=0,i=0;r<this.ranges.length;r+=3){let o=this.ranges[r],a=o-(this.inverted?i:0),l=o+(this.inverted?0:i),c=this.ranges[r+n],u=this.ranges[r+s];e(a,a+c,l,l+u),i+=u-c}}invert(){return new yr(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?yr.empty:new yr(e<0?[0,-e,0]:[0,0,e])}}yr.empty=new yr([]);class dp{constructor(e,n,s=0,r=e?e.length:0){this.mirror=n,this.from=s,this.to=r,this._maps=e||[],this.ownData=!(e||n)}get maps(){return this._maps}slice(e=0,n=this.maps.length){return new dp(this._maps,this.mirror,e,n)}appendMap(e,n){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),n!=null&&this.setMirror(this._maps.length-1,n)}appendMapping(e){for(let n=0,s=this._maps.length;n<e._maps.length;n++){let r=e.getMirror(n);this.appendMap(e._maps[n],r!=null&&r<n?s+r:void 0)}}getMirror(e){if(this.mirror){for(let n=0;n<this.mirror.length;n++)if(this.mirror[n]==e)return this.mirror[n+(n%2?-1:1)]}}setMirror(e,n){this.mirror||(this.mirror=[]),this.mirror.push(e,n)}appendMappingInverted(e){for(let n=e.maps.length-1,s=this._maps.length+e._maps.length;n>=0;n--){let r=e.getMirror(n);this.appendMap(e._maps[n].invert(),r!=null&&r>n?s-r-1:void 0)}}invert(){let e=new dp;return e.appendMappingInverted(this),e}map(e,n=1){if(this.mirror)return this._map(e,n,!0);for(let s=this.from;s<this.to;s++)e=this._maps[s].map(e,n);return e}mapResult(e,n=1){return this._map(e,n,!1)}_map(e,n,s){let r=0;for(let i=this.from;i<this.to;i++){let o=this._maps[i],a=o.mapResult(e,n);if(a.recover!=null){let l=this.getMirror(i);if(l!=null&&l>i&&l<this.to){i=l,e=this._maps[l].recover(a.recover);continue}}r|=a.delInfo,e=a.pos}return s?e:new LC(e,r,null)}}const Ww=Object.create(null);class Ts{getMap(){return yr.empty}merge(e){return null}static fromJSON(e,n){if(!n||!n.stepType)throw new RangeError("Invalid input for Step.fromJSON");let s=Ww[n.stepType];if(!s)throw new RangeError(`No step type ${n.stepType} defined`);return s.fromJSON(e,n)}static jsonID(e,n){if(e in Ww)throw new RangeError("Duplicate use of step JSON ID "+e);return Ww[e]=n,n.prototype.jsonID=e,n}}class bn{constructor(e,n){this.doc=e,this.failed=n}static ok(e){return new bn(e,null)}static fail(e){return new bn(null,e)}static fromReplace(e,n,s,r){try{return bn.ok(e.replace(n,s,r))}catch(i){if(i instanceof tx)return bn.fail(i.message);throw i}}}function O2(t,e,n){let s=[];for(let r=0;r<t.childCount;r++){let i=t.child(r);i.content.size&&(i=i.copy(O2(i.content,e,i))),i.isInline&&(i=e(i,n,r)),s.push(i)}return se.fromArray(s)}class Ma extends Ts{constructor(e,n,s){super(),this.from=e,this.to=n,this.mark=s}apply(e){let n=e.slice(this.from,this.to),s=e.resolve(this.from),r=s.node(s.sharedDepth(this.to)),i=new me(O2(n.content,(o,a)=>!o.isAtom||!a.type.allowsMarkType(this.mark.type)?o:o.mark(this.mark.addToSet(o.marks)),r),n.openStart,n.openEnd);return bn.fromReplace(e,this.from,this.to,i)}invert(){return new ki(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),s=e.mapResult(this.to,-1);return n.deleted&&s.deleted||n.pos>=s.pos?null:new Ma(n.pos,s.pos,this.mark)}merge(e){return e instanceof Ma&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Ma(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new Ma(n.from,n.to,e.markFromJSON(n.mark))}}Ts.jsonID("addMark",Ma);class ki extends Ts{constructor(e,n,s){super(),this.from=e,this.to=n,this.mark=s}apply(e){let n=e.slice(this.from,this.to),s=new me(O2(n.content,r=>r.mark(this.mark.removeFromSet(r.marks)),e),n.openStart,n.openEnd);return bn.fromReplace(e,this.from,this.to,s)}invert(){return new Ma(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),s=e.mapResult(this.to,-1);return n.deleted&&s.deleted||n.pos>=s.pos?null:new ki(n.pos,s.pos,this.mark)}merge(e){return e instanceof ki&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new ki(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new ki(n.from,n.to,e.markFromJSON(n.mark))}}Ts.jsonID("removeMark",ki);class Pa extends Ts{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return bn.fail("No node at mark step's position");let s=n.type.create(n.attrs,null,this.mark.addToSet(n.marks));return bn.fromReplace(e,this.pos,this.pos+1,new me(se.from(s),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);if(n){let s=this.mark.addToSet(n.marks);if(s.length==n.marks.length){for(let r=0;r<n.marks.length;r++)if(!n.marks[r].isInSet(s))return new Pa(this.pos,n.marks[r]);return new Pa(this.pos,this.mark)}}return new Bc(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new Pa(n.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new Pa(n.pos,e.markFromJSON(n.mark))}}Ts.jsonID("addNodeMark",Pa);class Bc extends Ts{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return bn.fail("No node at mark step's position");let s=n.type.create(n.attrs,null,this.mark.removeFromSet(n.marks));return bn.fromReplace(e,this.pos,this.pos+1,new me(se.from(s),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);return!n||!this.mark.isInSet(n.marks)?this:new Pa(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new Bc(n.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new Bc(n.pos,e.markFromJSON(n.mark))}}Ts.jsonID("removeNodeMark",Bc);class _n extends Ts{constructor(e,n,s,r=!1){super(),this.from=e,this.to=n,this.slice=s,this.structure=r}apply(e){return this.structure&&FC(e,this.from,this.to)?bn.fail("Structure replace would overwrite content"):bn.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new yr([this.from,this.to-this.from,this.slice.size])}invert(e){return new _n(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let n=e.mapResult(this.from,1),s=e.mapResult(this.to,-1);return n.deletedAcross&&s.deletedAcross?null:new _n(n.pos,Math.max(n.pos,s.pos),this.slice,this.structure)}merge(e){if(!(e instanceof _n)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let n=this.slice.size+e.slice.size==0?me.empty:new me(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new _n(this.from,this.to+(e.to-e.from),n,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let n=this.slice.size+e.slice.size==0?me.empty:new me(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new _n(e.from,this.to,n,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new _n(n.from,n.to,me.fromJSON(e,n.slice),!!n.structure)}}Ts.jsonID("replace",_n);class Vn extends Ts{constructor(e,n,s,r,i,o,a=!1){super(),this.from=e,this.to=n,this.gapFrom=s,this.gapTo=r,this.slice=i,this.insert=o,this.structure=a}apply(e){if(this.structure&&(FC(e,this.from,this.gapFrom)||FC(e,this.gapTo,this.to)))return bn.fail("Structure gap-replace would overwrite content");let n=e.slice(this.gapFrom,this.gapTo);if(n.openStart||n.openEnd)return bn.fail("Gap is not a flat range");let s=this.slice.insertAt(this.insert,n.content);return s?bn.fromReplace(e,this.from,this.to,s):bn.fail("Content does not fit in gap")}getMap(){return new yr([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let n=this.gapTo-this.gapFrom;return new Vn(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let n=e.mapResult(this.from,1),s=e.mapResult(this.to,-1),r=this.from==this.gapFrom?n.pos:e.map(this.gapFrom,-1),i=this.to==this.gapTo?s.pos:e.map(this.gapTo,1);return n.deletedAcross&&s.deletedAcross||r<n.pos||i>s.pos?null:new Vn(n.pos,s.pos,r,i,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number"||typeof n.gapFrom!="number"||typeof n.gapTo!="number"||typeof n.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new Vn(n.from,n.to,n.gapFrom,n.gapTo,me.fromJSON(e,n.slice),n.insert,!!n.structure)}}Ts.jsonID("replaceAround",Vn);function FC(t,e,n){let s=t.resolve(e),r=n-e,i=s.depth;for(;r>0&&i>0&&s.indexAfter(i)==s.node(i).childCount;)i--,r--;if(r>0){let o=s.node(i).maybeChild(s.indexAfter(i));for(;r>0;){if(!o||o.isLeaf)return!0;o=o.firstChild,r--}}return!1}function OAe(t,e,n,s){let r=[],i=[],o,a;t.doc.nodesBetween(e,n,(l,c,u)=>{if(!l.isInline)return;let d=l.marks;if(!s.isInSet(d)&&u.type.allowsMarkType(s.type)){let h=Math.max(c,e),f=Math.min(c+l.nodeSize,n),p=s.addToSet(d);for(let m=0;m<d.length;m++)d[m].isInSet(p)||(o&&o.to==h&&o.mark.eq(d[m])?o.to=f:r.push(o=new ki(h,f,d[m])));a&&a.to==h?a.to=f:i.push(a=new Ma(h,f,s))}}),r.forEach(l=>t.step(l)),i.forEach(l=>t.step(l))}function MAe(t,e,n,s){let r=[],i=0;t.doc.nodesBetween(e,n,(o,a)=>{if(!o.isInline)return;i++;let l=null;if(s instanceof t1){let c=o.marks,u;for(;u=s.isInSet(c);)(l||(l=[])).push(u),c=u.removeFromSet(c)}else s?s.isInSet(o.marks)&&(l=[s]):l=o.marks;if(l&&l.length){let c=Math.min(a+o.nodeSize,n);for(let u=0;u<l.length;u++){let d=l[u],h;for(let f=0;f<r.length;f++){let p=r[f];p.step==i-1&&d.eq(r[f].style)&&(h=p)}h?(h.to=c,h.step=i):r.push({style:d,from:Math.max(a,e),to:c,step:i})}}}),r.forEach(o=>t.step(new ki(o.from,o.to,o.style)))}function M2(t,e,n,s=n.contentMatch,r=!0){let i=t.doc.nodeAt(e),o=[],a=e+1;for(let l=0;l<i.childCount;l++){let c=i.child(l),u=a+c.nodeSize,d=s.matchType(c.type);if(!d)o.push(new _n(a,u,me.empty));else{s=d;for(let h=0;h<c.marks.length;h++)n.allowsMarkType(c.marks[h].type)||t.step(new ki(a,u,c.marks[h]));if(r&&c.isText&&n.whitespace!="pre"){let h,f=/\r?\n|\r/g,p;for(;h=f.exec(c.text);)p||(p=new me(se.from(n.schema.text(" ",n.allowedMarks(c.marks))),0,0)),o.push(new _n(a+h.index,a+h.index+h[0].length,p))}}a=u}if(!s.validEnd){let l=s.fillBefore(se.empty,!0);t.replace(a,a,new me(l,0,0))}for(let l=o.length-1;l>=0;l--)t.step(o[l])}function PAe(t,e,n){return(e==0||t.canReplace(e,t.childCount))&&(n==t.childCount||t.canReplace(0,n))}function lh(t){let n=t.parent.content.cutByIndex(t.startIndex,t.endIndex);for(let s=t.depth,r=0,i=0;;--s){let o=t.$from.node(s),a=t.$from.index(s)+r,l=t.$to.indexAfter(s)-i;if(s<t.depth&&o.canReplace(a,l,n))return s;if(s==0||o.type.spec.isolating||!PAe(o,a,l))break;a&&(r=1),l<o.childCount&&(i=1)}return null}function LAe(t,e,n){let{$from:s,$to:r,depth:i}=e,o=s.before(i+1),a=r.after(i+1),l=o,c=a,u=se.empty,d=0;for(let p=i,m=!1;p>n;p--)m||s.index(p)>0?(m=!0,u=se.from(s.node(p).copy(u)),d++):l--;let h=se.empty,f=0;for(let p=i,m=!1;p>n;p--)m||r.after(p+1)<r.end(p)?(m=!0,h=se.from(r.node(p).copy(h)),f++):c++;t.step(new Vn(l,c,o,a,new me(u.append(h),d,f),u.size-d,!0))}function P2(t,e,n=null,s=t){let r=FAe(t,e),i=r&&_Ae(s,e);return i?r.map(HM).concat({type:e,attrs:n}).concat(i.map(HM)):null}function HM(t){return{type:t,attrs:null}}function FAe(t,e){let{parent:n,startIndex:s,endIndex:r}=t,i=n.contentMatchAt(s).findWrapping(e);if(!i)return null;let o=i.length?i[0]:e;return n.canReplaceWith(s,r,o)?i:null}function _Ae(t,e){let{parent:n,startIndex:s,endIndex:r}=t,i=n.child(s),o=e.contentMatch.findWrapping(i.type);if(!o)return null;let l=(o.length?o[o.length-1]:e).contentMatch;for(let c=s;l&&c<r;c++)l=l.matchType(n.child(c).type);return!l||!l.validEnd?null:o}function zAe(t,e,n){let s=se.empty;for(let o=n.length-1;o>=0;o--){if(s.size){let a=n[o].type.contentMatch.matchFragment(s);if(!a||!a.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}s=se.from(n[o].type.create(n[o].attrs,s))}let r=e.start,i=e.end;t.step(new Vn(r,i,r,i,new me(s,0,0),n.length,!0))}function BAe(t,e,n,s,r){if(!s.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let i=t.steps.length;t.doc.nodesBetween(e,n,(o,a)=>{let l=typeof r=="function"?r(o):r;if(o.isTextblock&&!o.hasMarkup(s,l)&&jAe(t.doc,t.mapping.slice(i).map(a),s)){let c=null;if(s.schema.linebreakReplacement){let f=s.whitespace=="pre",p=!!s.contentMatch.matchType(s.schema.linebreakReplacement);f&&!p?c=!1:!f&&p&&(c=!0)}c===!1&&rH(t,o,a,i),M2(t,t.mapping.slice(i).map(a,1),s,void 0,c===null);let u=t.mapping.slice(i),d=u.map(a,1),h=u.map(a+o.nodeSize,1);return t.step(new Vn(d,h,d+1,h-1,new me(se.from(s.create(l,null,o.marks)),0,0),1,!0)),c===!0&&sH(t,o,a,i),!1}})}function sH(t,e,n,s){e.forEach((r,i)=>{if(r.isText){let o,a=/\r?\n|\r/g;for(;o=a.exec(r.text);){let l=t.mapping.slice(s).map(n+1+i+o.index);t.replaceWith(l,l+1,e.type.schema.linebreakReplacement.create())}}})}function rH(t,e,n,s){e.forEach((r,i)=>{if(r.type==r.type.schema.linebreakReplacement){let o=t.mapping.slice(s).map(n+1+i);t.replaceWith(o,o+1,e.type.schema.text(`
`))}})}function jAe(t,e,n){let s=t.resolve(e),r=s.index();return s.parent.canReplaceWith(r,r+1,n)}function VAe(t,e,n,s,r){let i=t.doc.nodeAt(e);if(!i)throw new RangeError("No node at given position");n||(n=i.type);let o=n.create(s,null,r||i.marks);if(i.isLeaf)return t.replaceWith(e,e+i.nodeSize,o);if(!n.validContent(i.content))throw new RangeError("Invalid content for node type "+n.name);t.step(new Vn(e,e+i.nodeSize,e+1,e+i.nodeSize-1,new me(se.from(o),0,0),1,!0))}function od(t,e,n=1,s){let r=t.resolve(e),i=r.depth-n,o=s&&s[s.length-1]||r.parent;if(i<0||r.parent.type.spec.isolating||!r.parent.canReplace(r.index(),r.parent.childCount)||!o.type.validContent(r.parent.content.cutByIndex(r.index(),r.parent.childCount)))return!1;for(let c=r.depth-1,u=n-2;c>i;c--,u--){let d=r.node(c),h=r.index(c);if(d.type.spec.isolating)return!1;let f=d.content.cutByIndex(h,d.childCount),p=s&&s[u+1];p&&(f=f.replaceChild(0,p.type.create(p.attrs)));let m=s&&s[u]||d;if(!d.canReplace(h+1,d.childCount)||!m.type.validContent(f))return!1}let a=r.indexAfter(i),l=s&&s[0];return r.node(i).canReplaceWith(a,a,l?l.type:r.node(i+1).type)}function UAe(t,e,n=1,s){let r=t.doc.resolve(e),i=se.empty,o=se.empty;for(let a=r.depth,l=r.depth-n,c=n-1;a>l;a--,c--){i=se.from(r.node(a).copy(i));let u=s&&s[c];o=se.from(u?u.type.create(u.attrs,o):r.node(a).copy(o))}t.step(new _n(e,e,new me(i.append(o),n,n),!0))}function $l(t,e){let n=t.resolve(e),s=n.index();return iH(n.nodeBefore,n.nodeAfter)&&n.parent.canReplace(s,s+1)}function WAe(t,e){e.content.size||t.type.compatibleContent(e.type);let n=t.contentMatchAt(t.childCount),{linebreakReplacement:s}=t.type.schema;for(let r=0;r<e.childCount;r++){let i=e.child(r),o=i.type==s?t.type.schema.nodes.text:i.type;if(n=n.matchType(o),!n||!t.type.allowsMarks(i.marks))return!1}return n.validEnd}function iH(t,e){return!!(t&&e&&!t.isLeaf&&WAe(t,e))}function n1(t,e,n=-1){let s=t.resolve(e);for(let r=s.depth;;r--){let i,o,a=s.index(r);if(r==s.depth?(i=s.nodeBefore,o=s.nodeAfter):n>0?(i=s.node(r+1),a++,o=s.node(r).maybeChild(a)):(i=s.node(r).maybeChild(a-1),o=s.node(r+1)),i&&!i.isTextblock&&iH(i,o)&&s.node(r).canReplace(a,a+1))return e;if(r==0)break;e=n<0?s.before(r):s.after(r)}}function HAe(t,e,n){let s=null,{linebreakReplacement:r}=t.doc.type.schema,i=t.doc.resolve(e-n),o=i.node().type;if(r&&o.inlineContent){let u=o.whitespace=="pre",d=!!o.contentMatch.matchType(r);u&&!d?s=!1:!u&&d&&(s=!0)}let a=t.steps.length;if(s===!1){let u=t.doc.resolve(e+n);rH(t,u.node(),u.before(),a)}o.inlineContent&&M2(t,e+n-1,o,i.node().contentMatchAt(i.index()),s==null);let l=t.mapping.slice(a),c=l.map(e-n);if(t.step(new _n(c,l.map(e+n,-1),me.empty,!0)),s===!0){let u=t.doc.resolve(c);sH(t,u.node(),u.before(),t.steps.length)}return t}function GAe(t,e,n){let s=t.resolve(e);if(s.parent.canReplaceWith(s.index(),s.index(),n))return e;if(s.parentOffset==0)for(let r=s.depth-1;r>=0;r--){let i=s.index(r);if(s.node(r).canReplaceWith(i,i,n))return s.before(r+1);if(i>0)return null}if(s.parentOffset==s.parent.content.size)for(let r=s.depth-1;r>=0;r--){let i=s.indexAfter(r);if(s.node(r).canReplaceWith(i,i,n))return s.after(r+1);if(i<s.node(r).childCount)return null}return null}function oH(t,e,n){let s=t.resolve(e);if(!n.content.size)return e;let r=n.content;for(let i=0;i<n.openStart;i++)r=r.firstChild.content;for(let i=1;i<=(n.openStart==0&&n.size?2:1);i++)for(let o=s.depth;o>=0;o--){let a=o==s.depth?0:s.pos<=(s.start(o+1)+s.end(o+1))/2?-1:1,l=s.index(o)+(a>0?1:0),c=s.node(o),u=!1;if(i==1)u=c.canReplace(l,l,r);else{let d=c.contentMatchAt(l).findWrapping(r.firstChild.type);u=d&&c.canReplaceWith(l,l,d[0])}if(u)return a==0?s.pos:a<0?s.before(o+1):s.after(o+1)}return null}function s1(t,e,n=e,s=me.empty){if(e==n&&!s.size)return null;let r=t.resolve(e),i=t.resolve(n);return aH(r,i,s)?new _n(e,n,s):new KAe(r,i,s).fit()}function aH(t,e,n){return!n.openStart&&!n.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),n.content)}class KAe{constructor(e,n,s){this.$from=e,this.$to=n,this.unplaced=s,this.frontier=[],this.placed=se.empty;for(let r=0;r<=e.depth;r++){let i=e.node(r);this.frontier.push({type:i.type,match:i.contentMatchAt(e.indexAfter(r))})}for(let r=e.depth;r>0;r--)this.placed=se.from(e.node(r).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let c=this.findFittable();c?this.placeNodes(c):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),n=this.placed.size-this.depth-this.$from.depth,s=this.$from,r=this.close(e<0?this.$to:s.doc.resolve(e));if(!r)return null;let i=this.placed,o=s.depth,a=r.depth;for(;o&&a&&i.childCount==1;)i=i.firstChild.content,o--,a--;let l=new me(i,o,a);return e>-1?new Vn(s.pos,e,this.$to.pos,this.$to.end(),l,n):l.size||s.pos!=this.$to.pos?new _n(s.pos,r.pos,l):null}findFittable(){let e=this.unplaced.openStart;for(let n=this.unplaced.content,s=0,r=this.unplaced.openEnd;s<e;s++){let i=n.firstChild;if(n.childCount>1&&(r=0),i.type.spec.isolating&&r<=s){e=s;break}n=i.content}for(let n=1;n<=2;n++)for(let s=n==1?e:this.unplaced.openStart;s>=0;s--){let r,i=null;s?(i=Hw(this.unplaced.content,s-1).firstChild,r=i.content):r=this.unplaced.content;let o=r.firstChild;for(let a=this.depth;a>=0;a--){let{type:l,match:c}=this.frontier[a],u,d=null;if(n==1&&(o?c.matchType(o.type)||(d=c.fillBefore(se.from(o),!1)):i&&l.compatibleContent(i.type)))return{sliceDepth:s,frontierDepth:a,parent:i,inject:d};if(n==2&&o&&(u=c.findWrapping(o.type)))return{sliceDepth:s,frontierDepth:a,parent:i,wrap:u};if(i&&c.matchType(i.type))break}}}openMore(){let{content:e,openStart:n,openEnd:s}=this.unplaced,r=Hw(e,n);return!r.childCount||r.firstChild.isLeaf?!1:(this.unplaced=new me(e,n+1,Math.max(s,r.size+n>=e.size-s?n+1:0)),!0)}dropNode(){let{content:e,openStart:n,openEnd:s}=this.unplaced,r=Hw(e,n);if(r.childCount<=1&&n>0){let i=e.size-n<=n+r.size;this.unplaced=new me(Xh(e,n-1,1),n-1,i?n-1:s)}else this.unplaced=new me(Xh(e,n,1),n,s)}placeNodes({sliceDepth:e,frontierDepth:n,parent:s,inject:r,wrap:i}){for(;this.depth>n;)this.closeFrontierNode();if(i)for(let m=0;m<i.length;m++)this.openFrontierNode(i[m]);let o=this.unplaced,a=s?s.content:o.content,l=o.openStart-e,c=0,u=[],{match:d,type:h}=this.frontier[n];if(r){for(let m=0;m<r.childCount;m++)u.push(r.child(m));d=d.matchFragment(r)}let f=a.size+e-(o.content.size-o.openEnd);for(;c<a.childCount;){let m=a.child(c),g=d.matchType(m.type);if(!g)break;c++,(c>1||l==0||m.content.size)&&(d=g,u.push(lH(m.mark(h.allowedMarks(m.marks)),c==1?l:0,c==a.childCount?f:-1)))}let p=c==a.childCount;p||(f=-1),this.placed=Jh(this.placed,n,se.from(u)),this.frontier[n].match=d,p&&f<0&&s&&s.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let m=0,g=a;m<f;m++){let y=g.lastChild;this.frontier.push({type:y.type,match:y.contentMatchAt(y.childCount)}),g=y.content}this.unplaced=p?e==0?me.empty:new me(Xh(o.content,e-1,1),e-1,f<0?o.openEnd:e-1):new me(Xh(o.content,e,c),o.openStart,o.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],n;if(!e.type.isTextblock||!Gw(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(n=this.findCloseLevel(this.$to))&&n.depth==this.depth)return-1;let{depth:s}=this.$to,r=this.$to.after(s);for(;s>1&&r==this.$to.end(--s);)++r;return r}findCloseLevel(e){e:for(let n=Math.min(this.depth,e.depth);n>=0;n--){let{match:s,type:r}=this.frontier[n],i=n<e.depth&&e.end(n+1)==e.pos+(e.depth-(n+1)),o=Gw(e,n,r,s,i);if(o){for(let a=n-1;a>=0;a--){let{match:l,type:c}=this.frontier[a],u=Gw(e,a,c,l,!0);if(!u||u.childCount)continue e}return{depth:n,fit:o,move:i?e.doc.resolve(e.after(n+1)):e}}}}close(e){let n=this.findCloseLevel(e);if(!n)return null;for(;this.depth>n.depth;)this.closeFrontierNode();n.fit.childCount&&(this.placed=Jh(this.placed,n.depth,n.fit)),e=n.move;for(let s=n.depth+1;s<=e.depth;s++){let r=e.node(s),i=r.type.contentMatch.fillBefore(r.content,!0,e.index(s));this.openFrontierNode(r.type,r.attrs,i)}return e}openFrontierNode(e,n=null,s){let r=this.frontier[this.depth];r.match=r.match.matchType(e),this.placed=Jh(this.placed,this.depth,se.from(e.create(n,s))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let n=this.frontier.pop().match.fillBefore(se.empty,!0);n.childCount&&(this.placed=Jh(this.placed,this.frontier.length,n))}}function Xh(t,e,n){return e==0?t.cutByIndex(n,t.childCount):t.replaceChild(0,t.firstChild.copy(Xh(t.firstChild.content,e-1,n)))}function Jh(t,e,n){return e==0?t.append(n):t.replaceChild(t.childCount-1,t.lastChild.copy(Jh(t.lastChild.content,e-1,n)))}function Hw(t,e){for(let n=0;n<e;n++)t=t.firstChild.content;return t}function lH(t,e,n){if(e<=0)return t;let s=t.content;return e>1&&(s=s.replaceChild(0,lH(s.firstChild,e-1,s.childCount==1?n-1:0))),e>0&&(s=t.type.contentMatch.fillBefore(s).append(s),n<=0&&(s=s.append(t.type.contentMatch.matchFragment(s).fillBefore(se.empty,!0)))),t.copy(s)}function Gw(t,e,n,s,r){let i=t.node(e),o=r?t.indexAfter(e):t.index(e);if(o==i.childCount&&!n.compatibleContent(i.type))return null;let a=s.fillBefore(i.content,!0,o);return a&&!qAe(n,i.content,o)?a:null}function qAe(t,e,n){for(let s=n;s<e.childCount;s++)if(!t.allowsMarks(e.child(s).marks))return!0;return!1}function XAe(t){return t.spec.defining||t.spec.definingForContent}function JAe(t,e,n,s){if(!s.size)return t.deleteRange(e,n);let r=t.doc.resolve(e),i=t.doc.resolve(n);if(aH(r,i,s))return t.step(new _n(e,n,s));let o=uH(r,i);o[o.length-1]==0&&o.pop();let a=-(r.depth+1);o.unshift(a);for(let h=r.depth,f=r.pos-1;h>0;h--,f--){let p=r.node(h).type.spec;if(p.defining||p.definingAsContext||p.isolating)break;o.indexOf(h)>-1?a=h:r.before(h)==f&&o.splice(1,0,-h)}let l=o.indexOf(a),c=[],u=s.openStart;for(let h=s.content,f=0;;f++){let p=h.firstChild;if(c.push(p),f==s.openStart)break;h=p.content}for(let h=u-1;h>=0;h--){let f=c[h],p=XAe(f.type);if(p&&!f.sameMarkup(r.node(Math.abs(a)-1)))u=h;else if(p||!f.type.isTextblock)break}for(let h=s.openStart;h>=0;h--){let f=(h+u+1)%(s.openStart+1),p=c[f];if(p)for(let m=0;m<o.length;m++){let g=o[(m+l)%o.length],y=!0;g<0&&(y=!1,g=-g);let x=r.node(g-1),v=r.index(g-1);if(x.canReplaceWith(v,v,p.type,p.marks))return t.replace(r.before(g),y?i.after(g):n,new me(cH(s.content,0,s.openStart,f),f,s.openEnd))}}let d=t.steps.length;for(let h=o.length-1;h>=0&&(t.replace(e,n,s),!(t.steps.length>d));h--){let f=o[h];f<0||(e=r.before(f),n=i.after(f))}}function cH(t,e,n,s,r){if(e<n){let i=t.firstChild;t=t.replaceChild(0,i.copy(cH(i.content,e+1,n,s,i)))}if(e>s){let i=r.contentMatchAt(0),o=i.fillBefore(t).append(t);t=o.append(i.matchFragment(o).fillBefore(se.empty,!0))}return t}function YAe(t,e,n,s){if(!s.isInline&&e==n&&t.doc.resolve(e).parent.content.size){let r=GAe(t.doc,e,s.type);r!=null&&(e=n=r)}t.replaceRange(e,n,new me(se.from(s),0,0))}function QAe(t,e,n){let s=t.doc.resolve(e),r=t.doc.resolve(n),i=uH(s,r);for(let o=0;o<i.length;o++){let a=i[o],l=o==i.length-1;if(l&&a==0||s.node(a).type.contentMatch.validEnd)return t.delete(s.start(a),r.end(a));if(a>0&&(l||s.node(a-1).canReplace(s.index(a-1),r.indexAfter(a-1))))return t.delete(s.before(a),r.after(a))}for(let o=1;o<=s.depth&&o<=r.depth;o++)if(e-s.start(o)==s.depth-o&&n>s.end(o)&&r.end(o)-n!=r.depth-o&&s.start(o-1)==r.start(o-1)&&s.node(o-1).canReplace(s.index(o-1),r.index(o-1)))return t.delete(s.before(o),n);t.delete(e,n)}function uH(t,e){let n=[],s=Math.min(t.depth,e.depth);for(let r=s;r>=0;r--){let i=t.start(r);if(i<t.pos-(t.depth-r)||e.end(r)>e.pos+(e.depth-r)||t.node(r).type.spec.isolating||e.node(r).type.spec.isolating)break;(i==e.start(r)||r==t.depth&&r==e.depth&&t.parent.inlineContent&&e.parent.inlineContent&&r&&e.start(r-1)==i-1)&&n.push(r)}return n}class ad extends Ts{constructor(e,n,s){super(),this.pos=e,this.attr=n,this.value=s}apply(e){let n=e.nodeAt(this.pos);if(!n)return bn.fail("No node at attribute step's position");let s=Object.create(null);for(let i in n.attrs)s[i]=n.attrs[i];s[this.attr]=this.value;let r=n.type.create(s,null,n.marks);return bn.fromReplace(e,this.pos,this.pos+1,new me(se.from(r),0,n.isLeaf?0:1))}getMap(){return yr.empty}invert(e){return new ad(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new ad(n.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.pos!="number"||typeof n.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new ad(n.pos,n.attr,n.value)}}Ts.jsonID("attr",ad);class hp extends Ts{constructor(e,n){super(),this.attr=e,this.value=n}apply(e){let n=Object.create(null);for(let r in e.attrs)n[r]=e.attrs[r];n[this.attr]=this.value;let s=e.type.create(n,e.content,e.marks);return bn.ok(s)}getMap(){return yr.empty}invert(e){return new hp(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new hp(n.attr,n.value)}}Ts.jsonID("docAttr",hp);let Od=class extends Error{};Od=function t(e){let n=Error.call(this,e);return n.__proto__=t.prototype,n};Od.prototype=Object.create(Error.prototype);Od.prototype.constructor=Od;Od.prototype.name="TransformError";class dH{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new dp}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let n=this.maybeStep(e);if(n.failed)throw new Od(n.failed);return this}maybeStep(e){let n=e.apply(this.doc);return n.failed||this.addStep(e,n.doc),n}get docChanged(){return this.steps.length>0}addStep(e,n){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=n}replace(e,n=e,s=me.empty){let r=s1(this.doc,e,n,s);return r&&this.step(r),this}replaceWith(e,n,s){return this.replace(e,n,new me(se.from(s),0,0))}delete(e,n){return this.replace(e,n,me.empty)}insert(e,n){return this.replaceWith(e,e,n)}replaceRange(e,n,s){return JAe(this,e,n,s),this}replaceRangeWith(e,n,s){return YAe(this,e,n,s),this}deleteRange(e,n){return QAe(this,e,n),this}lift(e,n){return LAe(this,e,n),this}join(e,n=1){return HAe(this,e,n),this}wrap(e,n){return zAe(this,e,n),this}setBlockType(e,n=e,s,r=null){return BAe(this,e,n,s,r),this}setNodeMarkup(e,n,s=null,r){return VAe(this,e,n,s,r),this}setNodeAttribute(e,n,s){return this.step(new ad(e,n,s)),this}setDocAttribute(e,n){return this.step(new hp(e,n)),this}addNodeMark(e,n){return this.step(new Pa(e,n)),this}removeNodeMark(e,n){let s=this.doc.nodeAt(e);if(!s)throw new RangeError("No node at position "+e);if(n instanceof St)n.isInSet(s.marks)&&this.step(new Bc(e,n));else{let r=s.marks,i,o=[];for(;i=n.isInSet(r);)o.push(new Bc(e,i)),r=i.removeFromSet(r);for(let a=o.length-1;a>=0;a--)this.step(o[a])}return this}split(e,n=1,s){return UAe(this,e,n,s),this}addMark(e,n,s){return OAe(this,e,n,s),this}removeMark(e,n,s){return MAe(this,e,n,s),this}clearIncompatible(e,n,s){return M2(this,e,n,s),this}}const Kw=Object.create(null);class We{constructor(e,n,s){this.$anchor=e,this.$head=n,this.ranges=s||[new ZAe(e.min(n),e.max(n))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let n=0;n<e.length;n++)if(e[n].$from.pos!=e[n].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,n=me.empty){let s=n.content.lastChild,r=null;for(let a=0;a<n.openEnd;a++)r=s,s=s.lastChild;let i=e.steps.length,o=this.ranges;for(let a=0;a<o.length;a++){let{$from:l,$to:c}=o[a],u=e.mapping.slice(i);e.replaceRange(u.map(l.pos),u.map(c.pos),a?me.empty:n),a==0&&qM(e,i,(s?s.isInline:r&&r.isTextblock)?-1:1)}}replaceWith(e,n){let s=e.steps.length,r=this.ranges;for(let i=0;i<r.length;i++){let{$from:o,$to:a}=r[i],l=e.mapping.slice(s),c=l.map(o.pos),u=l.map(a.pos);i?e.deleteRange(c,u):(e.replaceRangeWith(c,u,n),qM(e,s,n.isInline?-1:1))}}static findFrom(e,n,s=!1){let r=e.parent.inlineContent?new Le(e):Tu(e.node(0),e.parent,e.pos,e.index(),n,s);if(r)return r;for(let i=e.depth-1;i>=0;i--){let o=n<0?Tu(e.node(0),e.node(i),e.before(i+1),e.index(i),n,s):Tu(e.node(0),e.node(i),e.after(i+1),e.index(i)+1,n,s);if(o)return o}return null}static near(e,n=1){return this.findFrom(e,n)||this.findFrom(e,-n)||new Zr(e.node(0))}static atStart(e){return Tu(e,e,0,0,1)||new Zr(e)}static atEnd(e){return Tu(e,e,e.content.size,e.childCount,-1)||new Zr(e)}static fromJSON(e,n){if(!n||!n.type)throw new RangeError("Invalid input for Selection.fromJSON");let s=Kw[n.type];if(!s)throw new RangeError(`No selection type ${n.type} defined`);return s.fromJSON(e,n)}static jsonID(e,n){if(e in Kw)throw new RangeError("Duplicate use of selection JSON ID "+e);return Kw[e]=n,n.prototype.jsonID=e,n}getBookmark(){return Le.between(this.$anchor,this.$head).getBookmark()}}We.prototype.visible=!0;class ZAe{constructor(e,n){this.$from=e,this.$to=n}}let GM=!1;function KM(t){!GM&&!t.parent.inlineContent&&(GM=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+t.parent.type.name+")"))}class Le extends We{constructor(e,n=e){KM(e),KM(n),super(e,n)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,n){let s=e.resolve(n.map(this.head));if(!s.parent.inlineContent)return We.near(s);let r=e.resolve(n.map(this.anchor));return new Le(r.parent.inlineContent?r:s,s)}replace(e,n=me.empty){if(super.replace(e,n),n==me.empty){let s=this.$from.marksAcross(this.$to);s&&e.ensureMarks(s)}}eq(e){return e instanceof Le&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new r1(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,n){if(typeof n.anchor!="number"||typeof n.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new Le(e.resolve(n.anchor),e.resolve(n.head))}static create(e,n,s=n){let r=e.resolve(n);return new this(r,s==n?r:e.resolve(s))}static between(e,n,s){let r=e.pos-n.pos;if((!s||r)&&(s=r>=0?1:-1),!n.parent.inlineContent){let i=We.findFrom(n,s,!0)||We.findFrom(n,-s,!0);if(i)n=i.$head;else return We.near(n,s)}return e.parent.inlineContent||(r==0?e=n:(e=(We.findFrom(e,-s,!0)||We.findFrom(e,s,!0)).$anchor,e.pos<n.pos!=r<0&&(e=n))),new Le(e,n)}}We.jsonID("text",Le);class r1{constructor(e,n){this.anchor=e,this.head=n}map(e){return new r1(e.map(this.anchor),e.map(this.head))}resolve(e){return Le.between(e.resolve(this.anchor),e.resolve(this.head))}}class Re extends We{constructor(e){let n=e.nodeAfter,s=e.node(0).resolve(e.pos+n.nodeSize);super(e,s),this.node=n}map(e,n){let{deleted:s,pos:r}=n.mapResult(this.anchor),i=e.resolve(r);return s?We.near(i):new Re(i)}content(){return new me(se.from(this.node),0,0)}eq(e){return e instanceof Re&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new L2(this.anchor)}static fromJSON(e,n){if(typeof n.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new Re(e.resolve(n.anchor))}static create(e,n){return new Re(e.resolve(n))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}}Re.prototype.visible=!1;We.jsonID("node",Re);class L2{constructor(e){this.anchor=e}map(e){let{deleted:n,pos:s}=e.mapResult(this.anchor);return n?new r1(s,s):new L2(s)}resolve(e){let n=e.resolve(this.anchor),s=n.nodeAfter;return s&&Re.isSelectable(s)?new Re(n):We.near(n)}}class Zr extends We{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,n=me.empty){if(n==me.empty){e.delete(0,e.doc.content.size);let s=We.atStart(e.doc);s.eq(e.selection)||e.setSelection(s)}else super.replace(e,n)}toJSON(){return{type:"all"}}static fromJSON(e){return new Zr(e)}map(e){return new Zr(e)}eq(e){return e instanceof Zr}getBookmark(){return e$e}}We.jsonID("all",Zr);const e$e={map(){return this},resolve(t){return new Zr(t)}};function Tu(t,e,n,s,r,i=!1){if(e.inlineContent)return Le.create(t,n);for(let o=s-(r>0?0:1);r>0?o<e.childCount:o>=0;o+=r){let a=e.child(o);if(a.isAtom){if(!i&&Re.isSelectable(a))return Re.create(t,n-(r<0?a.nodeSize:0))}else{let l=Tu(t,a,n+r,r<0?a.childCount:0,r,i);if(l)return l}n+=a.nodeSize*r}return null}function qM(t,e,n){let s=t.steps.length-1;if(s<e)return;let r=t.steps[s];if(!(r instanceof _n||r instanceof Vn))return;let i=t.mapping.maps[s],o;i.forEach((a,l,c,u)=>{o==null&&(o=u)}),t.setSelection(We.near(t.doc.resolve(o),n))}const XM=1,Xg=2,JM=4;class t$e extends dH{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|XM)&~Xg,this.storedMarks=null,this}get selectionSet(){return(this.updated&XM)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=Xg,this}ensureMarks(e){return St.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&Xg)>0}addStep(e,n){super.addStep(e,n),this.updated=this.updated&~Xg,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,n=!0){let s=this.selection;return n&&(e=e.mark(this.storedMarks||(s.empty?s.$from.marks():s.$from.marksAcross(s.$to)||St.none))),s.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,n,s){let r=this.doc.type.schema;if(n==null)return e?this.replaceSelectionWith(r.text(e),!0):this.deleteSelection();{if(s==null&&(s=n),!e)return this.deleteRange(n,s);let i=this.storedMarks;if(!i){let o=this.doc.resolve(n);i=s==n?o.marks():o.marksAcross(this.doc.resolve(s))}return this.replaceRangeWith(n,s,r.text(e,i)),!this.selection.empty&&this.selection.to==n+e.length&&this.setSelection(We.near(this.selection.$to)),this}}setMeta(e,n){return this.meta[typeof e=="string"?e:e.key]=n,this}getMeta(e){return this.meta[typeof e=="string"?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=JM,this}get scrolledIntoView(){return(this.updated&JM)>0}}function YM(t,e){return!e||!t?t:t.bind(e)}class Yh{constructor(e,n,s){this.name=e,this.init=YM(n.init,s),this.apply=YM(n.apply,s)}}const n$e=[new Yh("doc",{init(t){return t.doc||t.schema.topNodeType.createAndFill()},apply(t){return t.doc}}),new Yh("selection",{init(t,e){return t.selection||We.atStart(e.doc)},apply(t){return t.selection}}),new Yh("storedMarks",{init(t){return t.storedMarks||null},apply(t,e,n,s){return s.selection.$cursor?t.storedMarks:null}}),new Yh("scrollToSelection",{init(){return 0},apply(t,e){return t.scrolledIntoView?e+1:e}})];class qw{constructor(e,n){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=n$e.slice(),n&&n.forEach(s=>{if(this.pluginsByKey[s.key])throw new RangeError("Adding different instances of a keyed plugin ("+s.key+")");this.plugins.push(s),this.pluginsByKey[s.key]=s,s.spec.state&&this.fields.push(new Yh(s.key,s.spec.state,s))})}}class Ku{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,n=-1){for(let s=0;s<this.config.plugins.length;s++)if(s!=n){let r=this.config.plugins[s];if(r.spec.filterTransaction&&!r.spec.filterTransaction.call(r,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let n=[e],s=this.applyInner(e),r=null;for(;;){let i=!1;for(let o=0;o<this.config.plugins.length;o++){let a=this.config.plugins[o];if(a.spec.appendTransaction){let l=r?r[o].n:0,c=r?r[o].state:this,u=l<n.length&&a.spec.appendTransaction.call(a,l?n.slice(l):n,c,s);if(u&&s.filterTransaction(u,o)){if(u.setMeta("appendedTransaction",e),!r){r=[];for(let d=0;d<this.config.plugins.length;d++)r.push(d<o?{state:s,n:n.length}:{state:this,n:0})}n.push(u),s=s.applyInner(u),i=!0}r&&(r[o]={state:s,n:n.length})}}if(!i)return{state:s,transactions:n}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let n=new Ku(this.config),s=this.config.fields;for(let r=0;r<s.length;r++){let i=s[r];n[i.name]=i.apply(e,this[i.name],this,n)}return n}get tr(){return new t$e(this)}static create(e){let n=new qw(e.doc?e.doc.type.schema:e.schema,e.plugins),s=new Ku(n);for(let r=0;r<n.fields.length;r++)s[n.fields[r].name]=n.fields[r].init(e,s);return s}reconfigure(e){let n=new qw(this.schema,e.plugins),s=n.fields,r=new Ku(n);for(let i=0;i<s.length;i++){let o=s[i].name;r[o]=this.hasOwnProperty(o)?this[o]:s[i].init(e,r)}return r}toJSON(e){let n={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(n.storedMarks=this.storedMarks.map(s=>s.toJSON())),e&&typeof e=="object")for(let s in e){if(s=="doc"||s=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let r=e[s],i=r.spec.state;i&&i.toJSON&&(n[s]=i.toJSON.call(r,this[r.key]))}return n}static fromJSON(e,n,s){if(!n)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let r=new qw(e.schema,e.plugins),i=new Ku(r);return r.fields.forEach(o=>{if(o.name=="doc")i.doc=$i.fromJSON(e.schema,n.doc);else if(o.name=="selection")i.selection=We.fromJSON(i.doc,n.selection);else if(o.name=="storedMarks")n.storedMarks&&(i.storedMarks=n.storedMarks.map(e.schema.markFromJSON));else{if(s)for(let a in s){let l=s[a],c=l.spec.state;if(l.key==o.name&&c&&c.fromJSON&&Object.prototype.hasOwnProperty.call(n,a)){i[o.name]=c.fromJSON.call(l,e,n[a],i);return}}i[o.name]=o.init(e,i)}}),i}}function hH(t,e,n){for(let s in t){let r=t[s];r instanceof Function?r=r.bind(e):s=="handleDOMEvents"&&(r=hH(r,e,{})),n[s]=r}return n}class Gt{constructor(e){this.spec=e,this.props={},e.props&&hH(e.props,this,this.props),this.key=e.key?e.key.key:fH("plugin")}getState(e){return e[this.key]}}const Xw=Object.create(null);function fH(t){return t in Xw?t+"$"+ ++Xw[t]:(Xw[t]=0,t+"$")}class On{constructor(e="key"){this.key=fH(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const s$e=(t,e)=>t.selection.empty?!1:(e&&e(t.tr.deleteSelection().scrollIntoView()),!0);function pH(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("backward",t):n.parentOffset>0)?null:n}const r$e=(t,e,n)=>{let s=pH(t,n);if(!s)return!1;let r=F2(s);if(!r){let o=s.blockRange(),a=o&&lh(o);return a==null?!1:(e&&e(t.tr.lift(o,a).scrollIntoView()),!0)}let i=r.nodeBefore;if(xH(t,r,e,-1))return!0;if(s.parent.content.size==0&&(Md(i,"end")||Re.isSelectable(i)))for(let o=s.depth;;o--){let a=s1(t.doc,s.before(o),s.after(o),me.empty);if(a&&a.slice.size<a.to-a.from){if(e){let l=t.tr.step(a);l.setSelection(Md(i,"end")?We.findFrom(l.doc.resolve(l.mapping.map(r.pos,-1)),-1):Re.create(l.doc,r.pos-i.nodeSize)),e(l.scrollIntoView())}return!0}if(o==1||s.node(o-1).childCount>1)break}return i.isAtom&&r.depth==s.depth-1?(e&&e(t.tr.delete(r.pos-i.nodeSize,r.pos).scrollIntoView()),!0):!1},i$e=(t,e,n)=>{let s=pH(t,n);if(!s)return!1;let r=F2(s);return r?mH(t,r,e):!1},o$e=(t,e,n)=>{let s=gH(t,n);if(!s)return!1;let r=_2(s);return r?mH(t,r,e):!1};function mH(t,e,n){let s=e.nodeBefore,r=s,i=e.pos-1;for(;!r.isTextblock;i--){if(r.type.spec.isolating)return!1;let u=r.lastChild;if(!u)return!1;r=u}let o=e.nodeAfter,a=o,l=e.pos+1;for(;!a.isTextblock;l++){if(a.type.spec.isolating)return!1;let u=a.firstChild;if(!u)return!1;a=u}let c=s1(t.doc,i,l,me.empty);if(!c||c.from!=i||c instanceof _n&&c.slice.size>=l-i)return!1;if(n){let u=t.tr.step(c);u.setSelection(Le.create(u.doc,i)),n(u.scrollIntoView())}return!0}function Md(t,e,n=!1){for(let s=t;s;s=e=="start"?s.firstChild:s.lastChild){if(s.isTextblock)return!0;if(n&&s.childCount!=1)return!1}return!1}const a$e=(t,e,n)=>{let{$head:s,empty:r}=t.selection,i=s;if(!r)return!1;if(s.parent.isTextblock){if(n?!n.endOfTextblock("backward",t):s.parentOffset>0)return!1;i=F2(s)}let o=i&&i.nodeBefore;return!o||!Re.isSelectable(o)?!1:(e&&e(t.tr.setSelection(Re.create(t.doc,i.pos-o.nodeSize)).scrollIntoView()),!0)};function F2(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){if(t.index(e)>0)return t.doc.resolve(t.before(e+1));if(t.node(e).type.spec.isolating)break}return null}function gH(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("forward",t):n.parentOffset<n.parent.content.size)?null:n}const l$e=(t,e,n)=>{let s=gH(t,n);if(!s)return!1;let r=_2(s);if(!r)return!1;let i=r.nodeAfter;if(xH(t,r,e,1))return!0;if(s.parent.content.size==0&&(Md(i,"start")||Re.isSelectable(i))){let o=s1(t.doc,s.before(),s.after(),me.empty);if(o&&o.slice.size<o.to-o.from){if(e){let a=t.tr.step(o);a.setSelection(Md(i,"start")?We.findFrom(a.doc.resolve(a.mapping.map(r.pos)),1):Re.create(a.doc,a.mapping.map(r.pos))),e(a.scrollIntoView())}return!0}}return i.isAtom&&r.depth==s.depth-1?(e&&e(t.tr.delete(r.pos,r.pos+i.nodeSize).scrollIntoView()),!0):!1},c$e=(t,e,n)=>{let{$head:s,empty:r}=t.selection,i=s;if(!r)return!1;if(s.parent.isTextblock){if(n?!n.endOfTextblock("forward",t):s.parentOffset<s.parent.content.size)return!1;i=_2(s)}let o=i&&i.nodeAfter;return!o||!Re.isSelectable(o)?!1:(e&&e(t.tr.setSelection(Re.create(t.doc,i.pos)).scrollIntoView()),!0)};function _2(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){let n=t.node(e);if(t.index(e)+1<n.childCount)return t.doc.resolve(t.after(e+1));if(n.type.spec.isolating)break}return null}const u$e=(t,e)=>{let n=t.selection,s=n instanceof Re,r;if(s){if(n.node.isTextblock||!$l(t.doc,n.from))return!1;r=n.from}else if(r=n1(t.doc,n.from,-1),r==null)return!1;if(e){let i=t.tr.join(r);s&&i.setSelection(Re.create(i.doc,r-t.doc.resolve(r).nodeBefore.nodeSize)),e(i.scrollIntoView())}return!0},d$e=(t,e)=>{let n=t.selection,s;if(n instanceof Re){if(n.node.isTextblock||!$l(t.doc,n.to))return!1;s=n.to}else if(s=n1(t.doc,n.to,1),s==null)return!1;return e&&e(t.tr.join(s).scrollIntoView()),!0},h$e=(t,e)=>{let{$from:n,$to:s}=t.selection,r=n.blockRange(s),i=r&&lh(r);return i==null?!1:(e&&e(t.tr.lift(r,i).scrollIntoView()),!0)},f$e=(t,e)=>{let{$head:n,$anchor:s}=t.selection;return!n.parent.type.spec.code||!n.sameParent(s)?!1:(e&&e(t.tr.insertText(`
`).scrollIntoView()),!0)};function yH(t){for(let e=0;e<t.edgeCount;e++){let{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}const p$e=(t,e)=>{let{$head:n,$anchor:s}=t.selection;if(!n.parent.type.spec.code||!n.sameParent(s))return!1;let r=n.node(-1),i=n.indexAfter(-1),o=yH(r.contentMatchAt(i));if(!o||!r.canReplaceWith(i,i,o))return!1;if(e){let a=n.after(),l=t.tr.replaceWith(a,a,o.createAndFill());l.setSelection(We.near(l.doc.resolve(a),1)),e(l.scrollIntoView())}return!0},m$e=(t,e)=>{let n=t.selection,{$from:s,$to:r}=n;if(n instanceof Zr||s.parent.inlineContent||r.parent.inlineContent)return!1;let i=yH(r.parent.contentMatchAt(r.indexAfter()));if(!i||!i.isTextblock)return!1;if(e){let o=(!s.parentOffset&&r.index()<r.parent.childCount?s:r).pos,a=t.tr.insert(o,i.createAndFill());a.setSelection(Le.create(a.doc,o+1)),e(a.scrollIntoView())}return!0},g$e=(t,e)=>{let{$cursor:n}=t.selection;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){let i=n.before();if(od(t.doc,i))return e&&e(t.tr.split(i).scrollIntoView()),!0}let s=n.blockRange(),r=s&&lh(s);return r==null?!1:(e&&e(t.tr.lift(s,r).scrollIntoView()),!0)},y$e=(t,e)=>{let{$from:n,to:s}=t.selection,r,i=n.sharedDepth(s);return i==0?!1:(r=n.before(i),e&&e(t.tr.setSelection(Re.create(t.doc,r))),!0)};function x$e(t,e,n){let s=e.nodeBefore,r=e.nodeAfter,i=e.index();return!s||!r||!s.type.compatibleContent(r.type)?!1:!s.content.size&&e.parent.canReplace(i-1,i)?(n&&n(t.tr.delete(e.pos-s.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(i,i+1)||!(r.isTextblock||$l(t.doc,e.pos))?!1:(n&&n(t.tr.join(e.pos).scrollIntoView()),!0)}function xH(t,e,n,s){let r=e.nodeBefore,i=e.nodeAfter,o,a,l=r.type.spec.isolating||i.type.spec.isolating;if(!l&&x$e(t,e,n))return!0;let c=!l&&e.parent.canReplace(e.index(),e.index()+1);if(c&&(o=(a=r.contentMatchAt(r.childCount)).findWrapping(i.type))&&a.matchType(o[0]||i.type).validEnd){if(n){let f=e.pos+i.nodeSize,p=se.empty;for(let y=o.length-1;y>=0;y--)p=se.from(o[y].create(null,p));p=se.from(r.copy(p));let m=t.tr.step(new Vn(e.pos-1,f,e.pos,f,new me(p,1,0),o.length,!0)),g=m.doc.resolve(f+2*o.length);g.nodeAfter&&g.nodeAfter.type==r.type&&$l(m.doc,g.pos)&&m.join(g.pos),n(m.scrollIntoView())}return!0}let u=i.type.spec.isolating||s>0&&l?null:We.findFrom(e,1),d=u&&u.$from.blockRange(u.$to),h=d&&lh(d);if(h!=null&&h>=e.depth)return n&&n(t.tr.lift(d,h).scrollIntoView()),!0;if(c&&Md(i,"start",!0)&&Md(r,"end")){let f=r,p=[];for(;p.push(f),!f.isTextblock;)f=f.lastChild;let m=i,g=1;for(;!m.isTextblock;m=m.firstChild)g++;if(f.canReplace(f.childCount,f.childCount,m.content)){if(n){let y=se.empty;for(let v=p.length-1;v>=0;v--)y=se.from(p[v].copy(y));let x=t.tr.step(new Vn(e.pos-p.length,e.pos+i.nodeSize,e.pos+g,e.pos+i.nodeSize-g,new me(y,p.length,0),0,!0));n(x.scrollIntoView())}return!0}}return!1}function bH(t){return function(e,n){let s=e.selection,r=t<0?s.$from:s.$to,i=r.depth;for(;r.node(i).isInline;){if(!i)return!1;i--}return r.node(i).isTextblock?(n&&n(e.tr.setSelection(Le.create(e.doc,t<0?r.start(i):r.end(i)))),!0):!1}}const b$e=bH(-1),v$e=bH(1);function w$e(t,e=null){return function(n,s){let{$from:r,$to:i}=n.selection,o=r.blockRange(i),a=o&&P2(o,t,e);return a?(s&&s(n.tr.wrap(o,a).scrollIntoView()),!0):!1}}function QM(t,e=null){return function(n,s){let r=!1;for(let i=0;i<n.selection.ranges.length&&!r;i++){let{$from:{pos:o},$to:{pos:a}}=n.selection.ranges[i];n.doc.nodesBetween(o,a,(l,c)=>{if(r)return!1;if(!(!l.isTextblock||l.hasMarkup(t,e)))if(l.type==t)r=!0;else{let u=n.doc.resolve(c),d=u.index();r=u.parent.canReplaceWith(d,d+1,t)}})}if(!r)return!1;if(s){let i=n.tr;for(let o=0;o<n.selection.ranges.length;o++){let{$from:{pos:a},$to:{pos:l}}=n.selection.ranges[o];i.setBlockType(a,l,t,e)}s(i.scrollIntoView())}return!0}}typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform&&os.platform()=="darwin";function S$e(t,e=null){return function(n,s){let{$from:r,$to:i}=n.selection,o=r.blockRange(i);if(!o)return!1;let a=s?n.tr:null;return k$e(a,o,t,e)?(s&&s(a.scrollIntoView()),!0):!1}}function k$e(t,e,n,s=null){let r=!1,i=e,o=e.$from.doc;if(e.depth>=2&&e.$from.node(e.depth-1).type.compatibleContent(n)&&e.startIndex==0){if(e.$from.index(e.depth-1)==0)return!1;let l=o.resolve(e.start-2);i=new sx(l,l,e.depth),e.endIndex<e.parent.childCount&&(e=new sx(e.$from,o.resolve(e.$to.end(e.depth)),e.depth)),r=!0}let a=P2(i,n,s,e);return a?(t&&C$e(t,e,a,r,n),!0):!1}function C$e(t,e,n,s,r){let i=se.empty;for(let u=n.length-1;u>=0;u--)i=se.from(n[u].type.create(n[u].attrs,i));t.step(new Vn(e.start-(s?2:0),e.end,e.start,e.end,new me(i,0,0),n.length,!0));let o=0;for(let u=0;u<n.length;u++)n[u].type==r&&(o=u+1);let a=n.length-o,l=e.start+n.length-(s?2:0),c=e.parent;for(let u=e.startIndex,d=e.endIndex,h=!0;u<d;u++,h=!1)!h&&od(t.doc,l,a)&&(t.split(l,a),l+=2*a),l+=c.child(u).nodeSize;return t}function N$e(t){return function(e,n){let{$from:s,$to:r}=e.selection,i=s.blockRange(r,o=>o.childCount>0&&o.firstChild.type==t);return i?n?s.node(i.depth-1).type==t?T$e(e,n,t,i):E$e(e,n,i):!0:!1}}function T$e(t,e,n,s){let r=t.tr,i=s.end,o=s.$to.end(s.depth);i<o&&(r.step(new Vn(i-1,o,i,o,new me(se.from(n.create(null,s.parent.copy())),1,0),1,!0)),s=new sx(r.doc.resolve(s.$from.pos),r.doc.resolve(o),s.depth));const a=lh(s);if(a==null)return!1;r.lift(s,a);let l=r.doc.resolve(r.mapping.map(i,-1)-1);return $l(r.doc,l.pos)&&l.nodeBefore.type==l.nodeAfter.type&&r.join(l.pos),e(r.scrollIntoView()),!0}function E$e(t,e,n){let s=t.tr,r=n.parent;for(let f=n.end,p=n.endIndex-1,m=n.startIndex;p>m;p--)f-=r.child(p).nodeSize,s.delete(f-1,f+1);let i=s.doc.resolve(n.start),o=i.nodeAfter;if(s.mapping.map(n.end)!=n.start+i.nodeAfter.nodeSize)return!1;let a=n.startIndex==0,l=n.endIndex==r.childCount,c=i.node(-1),u=i.index(-1);if(!c.canReplace(u+(a?0:1),u+1,o.content.append(l?se.empty:se.from(r))))return!1;let d=i.pos,h=d+o.nodeSize;return s.step(new Vn(d-(a?1:0),h+(l?1:0),d+1,h-1,new me((a?se.empty:se.from(r.copy(se.empty))).append(l?se.empty:se.from(r.copy(se.empty))),a?0:1,l?0:1),a?0:1)),e(s.scrollIntoView()),!0}function I$e(t){return function(e,n){let{$from:s,$to:r}=e.selection,i=s.blockRange(r,c=>c.childCount>0&&c.firstChild.type==t);if(!i)return!1;let o=i.startIndex;if(o==0)return!1;let a=i.parent,l=a.child(o-1);if(l.type!=t)return!1;if(n){let c=l.lastChild&&l.lastChild.type==a.type,u=se.from(c?t.create():null),d=new me(se.from(t.create(null,se.from(a.type.create(null,u)))),c?3:1,0),h=i.start,f=i.end;n(e.tr.step(new Vn(h-(c?3:1),f,h,f,d,1,!0)).scrollIntoView())}return!0}}const Qn=function(t){for(var e=0;;e++)if(t=t.previousSibling,!t)return e},Pd=function(t){let e=t.assignedSlot||t.parentNode;return e&&e.nodeType==11?e.host:e};let _C=null;const Po=function(t,e,n){let s=_C||(_C=document.createRange());return s.setEnd(t,n??t.nodeValue.length),s.setStart(t,e||0),s},A$e=function(){_C=null},jc=function(t,e,n,s){return n&&(ZM(t,e,n,s,-1)||ZM(t,e,n,s,1))},$$e=/^(img|br|input|textarea|hr)$/i;function ZM(t,e,n,s,r){for(var i;;){if(t==n&&e==s)return!0;if(e==(r<0?0:Hr(t))){let o=t.parentNode;if(!o||o.nodeType!=1||Ym(t)||$$e.test(t.nodeName)||t.contentEditable=="false")return!1;e=Qn(t)+(r<0?0:1),t=o}else if(t.nodeType==1){let o=t.childNodes[e+(r<0?-1:0)];if(o.nodeType==1&&o.contentEditable=="false")if(!((i=o.pmViewDesc)===null||i===void 0)&&i.ignoreForSelection)e+=r;else return!1;else t=o,e=r<0?Hr(t):0}else return!1}}function Hr(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function R$e(t,e){for(;;){if(t.nodeType==3&&e)return t;if(t.nodeType==1&&e>0){if(t.contentEditable=="false")return null;t=t.childNodes[e-1],e=Hr(t)}else if(t.parentNode&&!Ym(t))e=Qn(t),t=t.parentNode;else return null}}function D$e(t,e){for(;;){if(t.nodeType==3&&e<t.nodeValue.length)return t;if(t.nodeType==1&&e<t.childNodes.length){if(t.contentEditable=="false")return null;t=t.childNodes[e],e=0}else if(t.parentNode&&!Ym(t))e=Qn(t)+1,t=t.parentNode;else return null}}function O$e(t,e,n){for(let s=e==0,r=e==Hr(t);s||r;){if(t==n)return!0;let i=Qn(t);if(t=t.parentNode,!t)return!1;s=s&&i==0,r=r&&i==Hr(t)}}function Ym(t){let e;for(let n=t;n&&!(e=n.pmViewDesc);n=n.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==t||e.contentDOM==t)}const i1=function(t){return t.focusNode&&jc(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset)};function ql(t,e){let n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=t,n.key=n.code=e,n}function M$e(t){let e=t.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function P$e(t,e,n){if(t.caretPositionFromPoint)try{let s=t.caretPositionFromPoint(e,n);if(s)return{node:s.offsetNode,offset:Math.min(Hr(s.offsetNode),s.offset)}}catch{}if(t.caretRangeFromPoint){let s=t.caretRangeFromPoint(e,n);if(s)return{node:s.startContainer,offset:Math.min(Hr(s.startContainer),s.startOffset)}}}const bo=typeof navigator<"u"?navigator:null,eP=typeof document<"u"?document:null,Rl=bo&&bo.userAgent||"",zC=/Edge\/(\d+)/.exec(Rl),vH=/MSIE \d/.exec(Rl),BC=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Rl),or=!!(vH||BC||zC),Za=vH?document.documentMode:BC?+BC[1]:zC?+zC[1]:0,ei=!or&&/gecko\/(\d+)/i.test(Rl);ei&&+(/Firefox\/(\d+)/.exec(Rl)||[0,0])[1];const jC=!or&&/Chrome\/(\d+)/.exec(Rl),vs=!!jC,wH=jC?+jC[1]:0,Vs=!or&&!!bo&&/Apple Computer/.test(bo.vendor),Ld=Vs&&(/Mobile\/\w+/.test(Rl)||!!bo&&bo.maxTouchPoints>2),Br=Ld||(bo?/Mac/.test(bo.platform):!1),L$e=bo?/Win/.test(bo.platform):!1,Wo=/Android \d/.test(Rl),Qm=!!eP&&"webkitFontSmoothing"in eP.documentElement.style,F$e=Qm?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function _$e(t){let e=t.defaultView&&t.defaultView.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:t.documentElement.clientWidth,top:0,bottom:t.documentElement.clientHeight}}function Ao(t,e){return typeof t=="number"?t:t[e]}function z$e(t){let e=t.getBoundingClientRect(),n=e.width/t.offsetWidth||1,s=e.height/t.offsetHeight||1;return{left:e.left,right:e.left+t.clientWidth*n,top:e.top,bottom:e.top+t.clientHeight*s}}function tP(t,e,n){let s=t.someProp("scrollThreshold")||0,r=t.someProp("scrollMargin")||5,i=t.dom.ownerDocument;for(let o=n||t.dom;o;){if(o.nodeType!=1){o=Pd(o);continue}let a=o,l=a==i.body,c=l?_$e(i):z$e(a),u=0,d=0;if(e.top<c.top+Ao(s,"top")?d=-(c.top-e.top+Ao(r,"top")):e.bottom>c.bottom-Ao(s,"bottom")&&(d=e.bottom-e.top>c.bottom-c.top?e.top+Ao(r,"top")-c.top:e.bottom-c.bottom+Ao(r,"bottom")),e.left<c.left+Ao(s,"left")?u=-(c.left-e.left+Ao(r,"left")):e.right>c.right-Ao(s,"right")&&(u=e.right-c.right+Ao(r,"right")),u||d)if(l)i.defaultView.scrollBy(u,d);else{let f=a.scrollLeft,p=a.scrollTop;d&&(a.scrollTop+=d),u&&(a.scrollLeft+=u);let m=a.scrollLeft-f,g=a.scrollTop-p;e={left:e.left-m,top:e.top-g,right:e.right-m,bottom:e.bottom-g}}let h=l?"fixed":getComputedStyle(o).position;if(/^(fixed|sticky)$/.test(h))break;o=h=="absolute"?o.offsetParent:Pd(o)}}function B$e(t){let e=t.dom.getBoundingClientRect(),n=Math.max(0,e.top),s,r;for(let i=(e.left+e.right)/2,o=n+1;o<Math.min(innerHeight,e.bottom);o+=5){let a=t.root.elementFromPoint(i,o);if(!a||a==t.dom||!t.dom.contains(a))continue;let l=a.getBoundingClientRect();if(l.top>=n-20){s=a,r=l.top;break}}return{refDOM:s,refTop:r,stack:SH(t.dom)}}function SH(t){let e=[],n=t.ownerDocument;for(let s=t;s&&(e.push({dom:s,top:s.scrollTop,left:s.scrollLeft}),t!=n);s=Pd(s));return e}function j$e({refDOM:t,refTop:e,stack:n}){let s=t?t.getBoundingClientRect().top:0;kH(n,s==0?0:s-e)}function kH(t,e){for(let n=0;n<t.length;n++){let{dom:s,top:r,left:i}=t[n];s.scrollTop!=r+e&&(s.scrollTop=r+e),s.scrollLeft!=i&&(s.scrollLeft=i)}}let wu=null;function V$e(t){if(t.setActive)return t.setActive();if(wu)return t.focus(wu);let e=SH(t);t.focus(wu==null?{get preventScroll(){return wu={preventScroll:!0},!0}}:void 0),wu||(wu=!1,kH(e,0))}function CH(t,e){let n,s=2e8,r,i=0,o=e.top,a=e.top,l,c;for(let u=t.firstChild,d=0;u;u=u.nextSibling,d++){let h;if(u.nodeType==1)h=u.getClientRects();else if(u.nodeType==3)h=Po(u).getClientRects();else continue;for(let f=0;f<h.length;f++){let p=h[f];if(p.top<=o&&p.bottom>=a){o=Math.max(p.bottom,o),a=Math.min(p.top,a);let m=p.left>e.left?p.left-e.left:p.right<e.left?e.left-p.right:0;if(m<s){n=u,s=m,r=m&&n.nodeType==3?{left:p.right<e.left?p.right:p.left,top:e.top}:e,u.nodeType==1&&m&&(i=d+(e.left>=(p.left+p.right)/2?1:0));continue}}else p.top>e.top&&!l&&p.left<=e.left&&p.right>=e.left&&(l=u,c={left:Math.max(p.left,Math.min(p.right,e.left)),top:p.top});!n&&(e.left>=p.right&&e.top>=p.top||e.left>=p.left&&e.top>=p.bottom)&&(i=d+1)}}return!n&&l&&(n=l,r=c,s=0),n&&n.nodeType==3?U$e(n,r):!n||s&&n.nodeType==1?{node:t,offset:i}:CH(n,r)}function U$e(t,e){let n=t.nodeValue.length,s=document.createRange();for(let r=0;r<n;r++){s.setEnd(t,r+1),s.setStart(t,r);let i=ga(s,1);if(i.top!=i.bottom&&z2(e,i))return{node:t,offset:r+(e.left>=(i.left+i.right)/2?1:0)}}return{node:t,offset:0}}function z2(t,e){return t.left>=e.left-1&&t.left<=e.right+1&&t.top>=e.top-1&&t.top<=e.bottom+1}function W$e(t,e){let n=t.parentNode;return n&&/^li$/i.test(n.nodeName)&&e.left<t.getBoundingClientRect().left?n:t}function H$e(t,e,n){let{node:s,offset:r}=CH(e,n),i=-1;if(s.nodeType==1&&!s.firstChild){let o=s.getBoundingClientRect();i=o.left!=o.right&&n.left>(o.left+o.right)/2?1:-1}return t.docView.posFromDOM(s,r,i)}function G$e(t,e,n,s){let r=-1;for(let i=e,o=!1;i!=t.dom;){let a=t.docView.nearestDesc(i,!0),l;if(!a)return null;if(a.dom.nodeType==1&&(a.node.isBlock&&a.parent||!a.contentDOM)&&((l=a.dom.getBoundingClientRect()).width||l.height)&&(a.node.isBlock&&a.parent&&!/^T(R|BODY|HEAD|FOOT)$/.test(a.dom.nodeName)&&(!o&&l.left>s.left||l.top>s.top?r=a.posBefore:(!o&&l.right<s.left||l.bottom<s.top)&&(r=a.posAfter),o=!0),!a.contentDOM&&r<0&&!a.node.isText))return(a.node.isBlock?s.top<(l.top+l.bottom)/2:s.left<(l.left+l.right)/2)?a.posBefore:a.posAfter;i=a.dom.parentNode}return r>-1?r:t.docView.posFromDOM(e,n,-1)}function NH(t,e,n){let s=t.childNodes.length;if(s&&n.top<n.bottom)for(let r=Math.max(0,Math.min(s-1,Math.floor(s*(e.top-n.top)/(n.bottom-n.top))-2)),i=r;;){let o=t.childNodes[i];if(o.nodeType==1){let a=o.getClientRects();for(let l=0;l<a.length;l++){let c=a[l];if(z2(e,c))return NH(o,e,c)}}if((i=(i+1)%s)==r)break}return t}function K$e(t,e){let n=t.dom.ownerDocument,s,r=0,i=P$e(n,e.left,e.top);i&&({node:s,offset:r}=i);let o=(t.root.elementFromPoint?t.root:n).elementFromPoint(e.left,e.top),a;if(!o||!t.dom.contains(o.nodeType!=1?o.parentNode:o)){let c=t.dom.getBoundingClientRect();if(!z2(e,c)||(o=NH(t.dom,e,c),!o))return null}if(Vs)for(let c=o;s&&c;c=Pd(c))c.draggable&&(s=void 0);if(o=W$e(o,e),s){if(ei&&s.nodeType==1&&(r=Math.min(r,s.childNodes.length),r<s.childNodes.length)){let u=s.childNodes[r],d;u.nodeName=="IMG"&&(d=u.getBoundingClientRect()).right<=e.left&&d.bottom>e.top&&r++}let c;Qm&&r&&s.nodeType==1&&(c=s.childNodes[r-1]).nodeType==1&&c.contentEditable=="false"&&c.getBoundingClientRect().top>=e.top&&r--,s==t.dom&&r==s.childNodes.length-1&&s.lastChild.nodeType==1&&e.top>s.lastChild.getBoundingClientRect().bottom?a=t.state.doc.content.size:(r==0||s.nodeType!=1||s.childNodes[r-1].nodeName!="BR")&&(a=G$e(t,s,r,e))}a==null&&(a=H$e(t,o,e));let l=t.docView.nearestDesc(o,!0);return{pos:a,inside:l?l.posAtStart-l.border:-1}}function nP(t){return t.top<t.bottom||t.left<t.right}function ga(t,e){let n=t.getClientRects();if(n.length){let s=n[e<0?0:n.length-1];if(nP(s))return s}return Array.prototype.find.call(n,nP)||t.getBoundingClientRect()}const q$e=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function TH(t,e,n){let{node:s,offset:r,atom:i}=t.docView.domFromPos(e,n<0?-1:1),o=Qm||ei;if(s.nodeType==3)if(o&&(q$e.test(s.nodeValue)||(n<0?!r:r==s.nodeValue.length))){let l=ga(Po(s,r,r),n);if(ei&&r&&/\s/.test(s.nodeValue[r-1])&&r<s.nodeValue.length){let c=ga(Po(s,r-1,r-1),-1);if(c.top==l.top){let u=ga(Po(s,r,r+1),-1);if(u.top!=l.top)return Mh(u,u.left<c.left)}}return l}else{let l=r,c=r,u=n<0?1:-1;return n<0&&!r?(c++,u=-1):n>=0&&r==s.nodeValue.length?(l--,u=1):n<0?l--:c++,Mh(ga(Po(s,l,c),u),u<0)}if(!t.state.doc.resolve(e-(i||0)).parent.inlineContent){if(i==null&&r&&(n<0||r==Hr(s))){let l=s.childNodes[r-1];if(l.nodeType==1)return Jw(l.getBoundingClientRect(),!1)}if(i==null&&r<Hr(s)){let l=s.childNodes[r];if(l.nodeType==1)return Jw(l.getBoundingClientRect(),!0)}return Jw(s.getBoundingClientRect(),n>=0)}if(i==null&&r&&(n<0||r==Hr(s))){let l=s.childNodes[r-1],c=l.nodeType==3?Po(l,Hr(l)-(o?0:1)):l.nodeType==1&&(l.nodeName!="BR"||!l.nextSibling)?l:null;if(c)return Mh(ga(c,1),!1)}if(i==null&&r<Hr(s)){let l=s.childNodes[r];for(;l.pmViewDesc&&l.pmViewDesc.ignoreForCoords;)l=l.nextSibling;let c=l?l.nodeType==3?Po(l,0,o?0:1):l.nodeType==1?l:null:null;if(c)return Mh(ga(c,-1),!0)}return Mh(ga(s.nodeType==3?Po(s):s,-n),n>=0)}function Mh(t,e){if(t.width==0)return t;let n=e?t.left:t.right;return{top:t.top,bottom:t.bottom,left:n,right:n}}function Jw(t,e){if(t.height==0)return t;let n=e?t.top:t.bottom;return{top:n,bottom:n,left:t.left,right:t.right}}function EH(t,e,n){let s=t.state,r=t.root.activeElement;s!=e&&t.updateState(e),r!=t.dom&&t.focus();try{return n()}finally{s!=e&&t.updateState(s),r!=t.dom&&r&&r.focus()}}function X$e(t,e,n){let s=e.selection,r=n=="up"?s.$from:s.$to;return EH(t,e,()=>{let{node:i}=t.docView.domFromPos(r.pos,n=="up"?-1:1);for(;;){let a=t.docView.nearestDesc(i,!0);if(!a)break;if(a.node.isBlock){i=a.contentDOM||a.dom;break}i=a.dom.parentNode}let o=TH(t,r.pos,1);for(let a=i.firstChild;a;a=a.nextSibling){let l;if(a.nodeType==1)l=a.getClientRects();else if(a.nodeType==3)l=Po(a,0,a.nodeValue.length).getClientRects();else continue;for(let c=0;c<l.length;c++){let u=l[c];if(u.bottom>u.top+1&&(n=="up"?o.top-u.top>(u.bottom-o.top)*2:u.bottom-o.bottom>(o.bottom-u.top)*2))return!1}}return!0})}const J$e=/[\u0590-\u08ac]/;function Y$e(t,e,n){let{$head:s}=e.selection;if(!s.parent.isTextblock)return!1;let r=s.parentOffset,i=!r,o=r==s.parent.content.size,a=t.domSelection();return a?!J$e.test(s.parent.textContent)||!a.modify?n=="left"||n=="backward"?i:o:EH(t,e,()=>{let{focusNode:l,focusOffset:c,anchorNode:u,anchorOffset:d}=t.domSelectionRange(),h=a.caretBidiLevel;a.modify("move",n,"character");let f=s.depth?t.docView.domAfterPos(s.before()):t.dom,{focusNode:p,focusOffset:m}=t.domSelectionRange(),g=p&&!f.contains(p.nodeType==1?p:p.parentNode)||l==p&&c==m;try{a.collapse(u,d),l&&(l!=u||c!=d)&&a.extend&&a.extend(l,c)}catch{}return h!=null&&(a.caretBidiLevel=h),g}):s.pos==s.start()||s.pos==s.end()}let sP=null,rP=null,iP=!1;function Q$e(t,e,n){return sP==e&&rP==n?iP:(sP=e,rP=n,iP=n=="up"||n=="down"?X$e(t,e,n):Y$e(t,e,n))}const ti=0,oP=1,sc=2,vo=3;class Zm{constructor(e,n,s,r){this.parent=e,this.children=n,this.dom=s,this.contentDOM=r,this.dirty=ti,s.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,n,s){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let n=0;n<this.children.length;n++)e+=this.children[n].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let n=0,s=this.posAtStart;;n++){let r=this.children[n];if(r==e)return s;s+=r.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,n,s){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(s<0){let i,o;if(e==this.contentDOM)i=e.childNodes[n-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;i=e.previousSibling}for(;i&&!((o=i.pmViewDesc)&&o.parent==this);)i=i.previousSibling;return i?this.posBeforeChild(o)+o.size:this.posAtStart}else{let i,o;if(e==this.contentDOM)i=e.childNodes[n];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;i=e.nextSibling}for(;i&&!((o=i.pmViewDesc)&&o.parent==this);)i=i.nextSibling;return i?this.posBeforeChild(o):this.posAtEnd}let r;if(e==this.dom&&this.contentDOM)r=n>Qn(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))r=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(n==0)for(let i=e;;i=i.parentNode){if(i==this.dom){r=!1;break}if(i.previousSibling)break}if(r==null&&n==e.childNodes.length)for(let i=e;;i=i.parentNode){if(i==this.dom){r=!0;break}if(i.nextSibling)break}}return r??s>0?this.posAtEnd:this.posAtStart}nearestDesc(e,n=!1){for(let s=!0,r=e;r;r=r.parentNode){let i=this.getDesc(r),o;if(i&&(!n||i.node))if(s&&(o=i.nodeDOM)&&!(o.nodeType==1?o.contains(e.nodeType==1?e:e.parentNode):o==e))s=!1;else return i}}getDesc(e){let n=e.pmViewDesc;for(let s=n;s;s=s.parent)if(s==this)return n}posFromDOM(e,n,s){for(let r=e;r;r=r.parentNode){let i=this.getDesc(r);if(i)return i.localPosFromDOM(e,n,s)}return-1}descAt(e){for(let n=0,s=0;n<this.children.length;n++){let r=this.children[n],i=s+r.size;if(s==e&&i!=s){for(;!r.border&&r.children.length;)for(let o=0;o<r.children.length;o++){let a=r.children[o];if(a.size){r=a;break}}return r}if(e<i)return r.descAt(e-s-r.border);s=i}}domFromPos(e,n){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let s=0,r=0;for(let i=0;s<this.children.length;s++){let o=this.children[s],a=i+o.size;if(a>e||o instanceof AH){r=e-i;break}i=a}if(r)return this.children[s].domFromPos(r-this.children[s].border,n);for(let i;s&&!(i=this.children[s-1]).size&&i instanceof IH&&i.side>=0;s--);if(n<=0){let i,o=!0;for(;i=s?this.children[s-1]:null,!(!i||i.dom.parentNode==this.contentDOM);s--,o=!1);return i&&n&&o&&!i.border&&!i.domAtom?i.domFromPos(i.size,n):{node:this.contentDOM,offset:i?Qn(i.dom)+1:0}}else{let i,o=!0;for(;i=s<this.children.length?this.children[s]:null,!(!i||i.dom.parentNode==this.contentDOM);s++,o=!1);return i&&o&&!i.border&&!i.domAtom?i.domFromPos(0,n):{node:this.contentDOM,offset:i?Qn(i.dom):this.contentDOM.childNodes.length}}}parseRange(e,n,s=0){if(this.children.length==0)return{node:this.contentDOM,from:e,to:n,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let r=-1,i=-1;for(let o=s,a=0;;a++){let l=this.children[a],c=o+l.size;if(r==-1&&e<=c){let u=o+l.border;if(e>=u&&n<=c-l.border&&l.node&&l.contentDOM&&this.contentDOM.contains(l.contentDOM))return l.parseRange(e,n,u);e=o;for(let d=a;d>0;d--){let h=this.children[d-1];if(h.size&&h.dom.parentNode==this.contentDOM&&!h.emptyChildAt(1)){r=Qn(h.dom)+1;break}e-=h.size}r==-1&&(r=0)}if(r>-1&&(c>n||a==this.children.length-1)){n=c;for(let u=a+1;u<this.children.length;u++){let d=this.children[u];if(d.size&&d.dom.parentNode==this.contentDOM&&!d.emptyChildAt(-1)){i=Qn(d.dom);break}n+=d.size}i==-1&&(i=this.contentDOM.childNodes.length);break}o=c}return{node:this.contentDOM,from:e,to:n,fromOffset:r,toOffset:i}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let n=this.children[e<0?0:this.children.length-1];return n.size==0||n.emptyChildAt(e)}domAfterPos(e){let{node:n,offset:s}=this.domFromPos(e,0);if(n.nodeType!=1||s==n.childNodes.length)throw new RangeError("No node after pos "+e);return n.childNodes[s]}setSelection(e,n,s,r=!1){let i=Math.min(e,n),o=Math.max(e,n);for(let f=0,p=0;f<this.children.length;f++){let m=this.children[f],g=p+m.size;if(i>p&&o<g)return m.setSelection(e-p-m.border,n-p-m.border,s,r);p=g}let a=this.domFromPos(e,e?-1:1),l=n==e?a:this.domFromPos(n,n?-1:1),c=s.root.getSelection(),u=s.domSelectionRange(),d=!1;if((ei||Vs)&&e==n){let{node:f,offset:p}=a;if(f.nodeType==3){if(d=!!(p&&f.nodeValue[p-1]==`
`),d&&p==f.nodeValue.length)for(let m=f,g;m;m=m.parentNode){if(g=m.nextSibling){g.nodeName=="BR"&&(a=l={node:g.parentNode,offset:Qn(g)+1});break}let y=m.pmViewDesc;if(y&&y.node&&y.node.isBlock)break}}else{let m=f.childNodes[p-1];d=m&&(m.nodeName=="BR"||m.contentEditable=="false")}}if(ei&&u.focusNode&&u.focusNode!=l.node&&u.focusNode.nodeType==1){let f=u.focusNode.childNodes[u.focusOffset];f&&f.contentEditable=="false"&&(r=!0)}if(!(r||d&&Vs)&&jc(a.node,a.offset,u.anchorNode,u.anchorOffset)&&jc(l.node,l.offset,u.focusNode,u.focusOffset))return;let h=!1;if((c.extend||e==n)&&!(d&&ei)){c.collapse(a.node,a.offset);try{e!=n&&c.extend(l.node,l.offset),h=!0}catch{}}if(!h){if(e>n){let p=a;a=l,l=p}let f=document.createRange();f.setEnd(l.node,l.offset),f.setStart(a.node,a.offset),c.removeAllRanges(),c.addRange(f)}}ignoreMutation(e){return!this.contentDOM&&e.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,n){for(let s=0,r=0;r<this.children.length;r++){let i=this.children[r],o=s+i.size;if(s==o?e<=o&&n>=s:e<o&&n>s){let a=s+i.border,l=o-i.border;if(e>=a&&n<=l){this.dirty=e==s||n==o?sc:oP,e==a&&n==l&&(i.contentLost||i.dom.parentNode!=this.contentDOM)?i.dirty=vo:i.markDirty(e-a,n-a);return}else i.dirty=i.dom==i.contentDOM&&i.dom.parentNode==this.contentDOM&&!i.children.length?sc:vo}s=o}this.dirty=sc}markParentsDirty(){let e=1;for(let n=this.parent;n;n=n.parent,e++){let s=e==1?sc:oP;n.dirty<s&&(n.dirty=s)}}get domAtom(){return!1}get ignoreForCoords(){return!1}get ignoreForSelection(){return!1}isText(e){return!1}}class IH extends Zm{constructor(e,n,s,r){let i,o=n.type.toDOM;if(typeof o=="function"&&(o=o(s,()=>{if(!i)return r;if(i.parent)return i.parent.posBeforeChild(i)})),!n.type.spec.raw){if(o.nodeType!=1){let a=document.createElement("span");a.appendChild(o),o=a}o.contentEditable="false",o.classList.add("ProseMirror-widget")}super(e,[],o,null),this.widget=n,this.widget=n,i=this}matchesWidget(e){return this.dirty==ti&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let n=this.widget.spec.stopEvent;return n?n(e):!1}ignoreMutation(e){return e.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get ignoreForSelection(){return!!this.widget.type.spec.relaxedSide}get side(){return this.widget.type.side}}class Z$e extends Zm{constructor(e,n,s,r){super(e,[],n,null),this.textDOM=s,this.text=r}get size(){return this.text.length}localPosFromDOM(e,n){return e!=this.textDOM?this.posAtStart+(n?this.size:0):this.posAtStart+n}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return e.type==="characterData"&&e.target.nodeValue==e.oldValue}}class Vc extends Zm{constructor(e,n,s,r,i){super(e,[],s,r),this.mark=n,this.spec=i}static create(e,n,s,r){let i=r.nodeViews[n.type.name],o=i&&i(n,r,s);return(!o||!o.dom)&&(o=au.renderSpec(document,n.type.spec.toDOM(n,s),null,n.attrs)),new Vc(e,n,o.dom,o.contentDOM||o.dom,o)}parseRule(){return this.dirty&vo||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return this.dirty!=vo&&this.mark.eq(e)}markDirty(e,n){if(super.markDirty(e,n),this.dirty!=ti){let s=this.parent;for(;!s.node;)s=s.parent;s.dirty<this.dirty&&(s.dirty=this.dirty),this.dirty=ti}}slice(e,n,s){let r=Vc.create(this.parent,this.mark,!0,s),i=this.children,o=this.size;n<o&&(i=UC(i,n,o,s)),e>0&&(i=UC(i,0,e,s));for(let a=0;a<i.length;a++)i[a].parent=r;return r.children=i,r}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class el extends Zm{constructor(e,n,s,r,i,o,a,l,c){super(e,[],i,o),this.node=n,this.outerDeco=s,this.innerDeco=r,this.nodeDOM=a}static create(e,n,s,r,i,o){let a=i.nodeViews[n.type.name],l,c=a&&a(n,i,()=>{if(!l)return o;if(l.parent)return l.parent.posBeforeChild(l)},s,r),u=c&&c.dom,d=c&&c.contentDOM;if(n.isText){if(!u)u=document.createTextNode(n.text);else if(u.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else u||({dom:u,contentDOM:d}=au.renderSpec(document,n.type.spec.toDOM(n),null,n.attrs));!d&&!n.isText&&u.nodeName!="BR"&&(u.hasAttribute("contenteditable")||(u.contentEditable="false"),n.type.spec.draggable&&(u.draggable=!0));let h=u;return u=DH(u,s,n),c?l=new eRe(e,n,s,r,u,d||null,h,c,i,o+1):n.isText?new o1(e,n,s,r,u,h,i):new el(e,n,s,r,u,d||null,h,i,o+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(e.preserveWhitespace="full"),!this.contentDOM)e.getContent=()=>this.node.content;else if(!this.contentLost)e.contentElement=this.contentDOM;else{for(let n=this.children.length-1;n>=0;n--){let s=this.children[n];if(this.dom.contains(s.dom.parentNode)){e.contentElement=s.dom.parentNode;break}}e.contentElement||(e.getContent=()=>se.empty)}return e}matchesNode(e,n,s){return this.dirty==ti&&e.eq(this.node)&&ix(n,this.outerDeco)&&s.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,n){let s=this.node.inlineContent,r=n,i=e.composing?this.localCompositionInfo(e,n):null,o=i&&i.pos>-1?i:null,a=i&&i.pos<0,l=new nRe(this,o&&o.node,e);iRe(this.node,this.innerDeco,(c,u,d)=>{c.spec.marks?l.syncToMarks(c.spec.marks,s,e):c.type.side>=0&&!d&&l.syncToMarks(u==this.node.childCount?St.none:this.node.child(u).marks,s,e),l.placeWidget(c,e,r)},(c,u,d,h)=>{l.syncToMarks(c.marks,s,e);let f;l.findNodeMatch(c,u,d,h)||a&&e.state.selection.from>r&&e.state.selection.to<r+c.nodeSize&&(f=l.findIndexWithChild(i.node))>-1&&l.updateNodeAt(c,u,d,f,e)||l.updateNextNode(c,u,d,e,h,r)||l.addNode(c,u,d,e,r),r+=c.nodeSize}),l.syncToMarks([],s,e),this.node.isTextblock&&l.addTextblockHacks(),l.destroyRest(),(l.changed||this.dirty==sc)&&(o&&this.protectLocalComposition(e,o),$H(this.contentDOM,this.children,e),Ld&&oRe(this.dom))}localCompositionInfo(e,n){let{from:s,to:r}=e.state.selection;if(!(e.state.selection instanceof Le)||s<n||r>n+this.node.content.size)return null;let i=e.input.compositionNode;if(!i||!this.dom.contains(i.parentNode))return null;if(this.node.inlineContent){let o=i.nodeValue,a=aRe(this.node.content,o,s-n,r-n);return a<0?null:{node:i,pos:a,text:o}}else return{node:i,pos:-1,text:""}}protectLocalComposition(e,{node:n,pos:s,text:r}){if(this.getDesc(n))return;let i=n;for(;i.parentNode!=this.contentDOM;i=i.parentNode){for(;i.previousSibling;)i.parentNode.removeChild(i.previousSibling);for(;i.nextSibling;)i.parentNode.removeChild(i.nextSibling);i.pmViewDesc&&(i.pmViewDesc=void 0)}let o=new Z$e(this,i,n,r);e.input.compositionNodes.push(o),this.children=UC(this.children,s,s+r.length,e,o)}update(e,n,s,r){return this.dirty==vo||!e.sameMarkup(this.node)?!1:(this.updateInner(e,n,s,r),!0)}updateInner(e,n,s,r){this.updateOuterDeco(n),this.node=e,this.innerDeco=s,this.contentDOM&&this.updateChildren(r,this.posAtStart),this.dirty=ti}updateOuterDeco(e){if(ix(e,this.outerDeco))return;let n=this.nodeDOM.nodeType!=1,s=this.dom;this.dom=RH(this.dom,this.nodeDOM,VC(this.outerDeco,this.node,n),VC(e,this.node,n)),this.dom!=s&&(s.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.nodeDOM.draggable=!0))}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.nodeDOM.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function aP(t,e,n,s,r){DH(s,e,t);let i=new el(void 0,t,e,n,s,s,s,r,0);return i.contentDOM&&i.updateChildren(r,0),i}class o1 extends el{constructor(e,n,s,r,i,o,a){super(e,n,s,r,i,null,o,a,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,n,s,r){return this.dirty==vo||this.dirty!=ti&&!this.inParent()||!e.sameMarkup(this.node)?!1:(this.updateOuterDeco(n),(this.dirty!=ti||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,r.trackWrites==this.nodeDOM&&(r.trackWrites=null)),this.node=e,this.dirty=ti,!0)}inParent(){let e=this.parent.contentDOM;for(let n=this.nodeDOM;n;n=n.parentNode)if(n==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,n,s){return e==this.nodeDOM?this.posAtStart+Math.min(n,this.node.text.length):super.localPosFromDOM(e,n,s)}ignoreMutation(e){return e.type!="characterData"&&e.type!="selection"}slice(e,n,s){let r=this.node.cut(e,n),i=document.createTextNode(r.text);return new o1(this.parent,r,this.outerDeco,this.innerDeco,i,i,s)}markDirty(e,n){super.markDirty(e,n),this.dom!=this.nodeDOM&&(e==0||n==this.nodeDOM.nodeValue.length)&&(this.dirty=vo)}get domAtom(){return!1}isText(e){return this.node.text==e}}class AH extends Zm{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==ti&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class eRe extends el{constructor(e,n,s,r,i,o,a,l,c,u){super(e,n,s,r,i,o,a,c,u),this.spec=l}update(e,n,s,r){if(this.dirty==vo)return!1;if(this.spec.update&&(this.node.type==e.type||this.spec.multiType)){let i=this.spec.update(e,n,s);return i&&this.updateInner(e,n,s,r),i}else return!this.contentDOM&&!e.isLeaf?!1:super.update(e,n,s,r)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,n,s,r){this.spec.setSelection?this.spec.setSelection(e,n,s.root):super.setSelection(e,n,s,r)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return this.spec.stopEvent?this.spec.stopEvent(e):!1}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function $H(t,e,n){let s=t.firstChild,r=!1;for(let i=0;i<e.length;i++){let o=e[i],a=o.dom;if(a.parentNode==t){for(;a!=s;)s=lP(s),r=!0;s=s.nextSibling}else r=!0,t.insertBefore(a,s);if(o instanceof Vc){let l=s?s.previousSibling:t.lastChild;$H(o.contentDOM,o.children,n),s=l?l.nextSibling:t.firstChild}}for(;s;)s=lP(s),r=!0;r&&n.trackWrites==t&&(n.trackWrites=null)}const bf=function(t){t&&(this.nodeName=t)};bf.prototype=Object.create(null);const rc=[new bf];function VC(t,e,n){if(t.length==0)return rc;let s=n?rc[0]:new bf,r=[s];for(let i=0;i<t.length;i++){let o=t[i].type.attrs;if(o){o.nodeName&&r.push(s=new bf(o.nodeName));for(let a in o){let l=o[a];l!=null&&(n&&r.length==1&&r.push(s=new bf(e.isInline?"span":"div")),a=="class"?s.class=(s.class?s.class+" ":"")+l:a=="style"?s.style=(s.style?s.style+";":"")+l:a!="nodeName"&&(s[a]=l))}}}return r}function RH(t,e,n,s){if(n==rc&&s==rc)return e;let r=e;for(let i=0;i<s.length;i++){let o=s[i],a=n[i];if(i){let l;a&&a.nodeName==o.nodeName&&r!=t&&(l=r.parentNode)&&l.nodeName.toLowerCase()==o.nodeName||(l=document.createElement(o.nodeName),l.pmIsDeco=!0,l.appendChild(r),a=rc[0]),r=l}tRe(r,a||rc[0],o)}return r}function tRe(t,e,n){for(let s in e)s!="class"&&s!="style"&&s!="nodeName"&&!(s in n)&&t.removeAttribute(s);for(let s in n)s!="class"&&s!="style"&&s!="nodeName"&&n[s]!=e[s]&&t.setAttribute(s,n[s]);if(e.class!=n.class){let s=e.class?e.class.split(" ").filter(Boolean):[],r=n.class?n.class.split(" ").filter(Boolean):[];for(let i=0;i<s.length;i++)r.indexOf(s[i])==-1&&t.classList.remove(s[i]);for(let i=0;i<r.length;i++)s.indexOf(r[i])==-1&&t.classList.add(r[i]);t.classList.length==0&&t.removeAttribute("class")}if(e.style!=n.style){if(e.style){let s=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,r;for(;r=s.exec(e.style);)t.style.removeProperty(r[1])}n.style&&(t.style.cssText+=n.style)}}function DH(t,e,n){return RH(t,t,rc,VC(e,n,t.nodeType!=1))}function ix(t,e){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!t[n].type.eq(e[n].type))return!1;return!0}function lP(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}class nRe{constructor(e,n,s){this.lock=n,this.view=s,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=sRe(e.node.content,e)}destroyBetween(e,n){if(e!=n){for(let s=e;s<n;s++)this.top.children[s].destroy();this.top.children.splice(e,n-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,n,s){let r=0,i=this.stack.length>>1,o=Math.min(i,e.length);for(;r<o&&(r==i-1?this.top:this.stack[r+1<<1]).matchesMark(e[r])&&e[r].type.spec.spanning!==!1;)r++;for(;r<i;)this.destroyRest(),this.top.dirty=ti,this.index=this.stack.pop(),this.top=this.stack.pop(),i--;for(;i<e.length;){this.stack.push(this.top,this.index+1);let a=-1;for(let l=this.index;l<Math.min(this.index+3,this.top.children.length);l++){let c=this.top.children[l];if(c.matchesMark(e[i])&&!this.isLocked(c.dom)){a=l;break}}if(a>-1)a>this.index&&(this.changed=!0,this.destroyBetween(this.index,a)),this.top=this.top.children[this.index];else{let l=Vc.create(this.top,e[i],n,s);this.top.children.splice(this.index,0,l),this.top=l,this.changed=!0}this.index=0,i++}}findNodeMatch(e,n,s,r){let i=-1,o;if(r>=this.preMatch.index&&(o=this.preMatch.matches[r-this.preMatch.index]).parent==this.top&&o.matchesNode(e,n,s))i=this.top.children.indexOf(o,this.index);else for(let a=this.index,l=Math.min(this.top.children.length,a+5);a<l;a++){let c=this.top.children[a];if(c.matchesNode(e,n,s)&&!this.preMatch.matched.has(c)){i=a;break}}return i<0?!1:(this.destroyBetween(this.index,i),this.index++,!0)}updateNodeAt(e,n,s,r,i){let o=this.top.children[r];return o.dirty==vo&&o.dom==o.contentDOM&&(o.dirty=sc),o.update(e,n,s,i)?(this.destroyBetween(this.index,r),this.index++,!0):!1}findIndexWithChild(e){for(;;){let n=e.parentNode;if(!n)return-1;if(n==this.top.contentDOM){let s=e.pmViewDesc;if(s){for(let r=this.index;r<this.top.children.length;r++)if(this.top.children[r]==s)return r}return-1}e=n}}updateNextNode(e,n,s,r,i,o){for(let a=this.index;a<this.top.children.length;a++){let l=this.top.children[a];if(l instanceof el){let c=this.preMatch.matched.get(l);if(c!=null&&c!=i)return!1;let u=l.dom,d,h=this.isLocked(u)&&!(e.isText&&l.node&&l.node.isText&&l.nodeDOM.nodeValue==e.text&&l.dirty!=vo&&ix(n,l.outerDeco));if(!h&&l.update(e,n,s,r))return this.destroyBetween(this.index,a),l.dom!=u&&(this.changed=!0),this.index++,!0;if(!h&&(d=this.recreateWrapper(l,e,n,s,r,o)))return this.destroyBetween(this.index,a),this.top.children[this.index]=d,d.contentDOM&&(d.dirty=sc,d.updateChildren(r,o+1),d.dirty=ti),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,n,s,r,i,o){if(e.dirty||n.isAtom||!e.children.length||!e.node.content.eq(n.content)||!ix(s,e.outerDeco)||!r.eq(e.innerDeco))return null;let a=el.create(this.top,n,s,r,i,o);if(a.contentDOM){a.children=e.children,e.children=[];for(let l of a.children)l.parent=a}return e.destroy(),a}addNode(e,n,s,r,i){let o=el.create(this.top,e,n,s,r,i);o.contentDOM&&o.updateChildren(r,i+1),this.top.children.splice(this.index++,0,o),this.changed=!0}placeWidget(e,n,s){let r=this.index<this.top.children.length?this.top.children[this.index]:null;if(r&&r.matchesWidget(e)&&(e==r.widget||!r.widget.type.toDOM.parentNode))this.index++;else{let i=new IH(this.top,e,n,s);this.top.children.splice(this.index++,0,i),this.changed=!0}}addTextblockHacks(){let e=this.top.children[this.index-1],n=this.top;for(;e instanceof Vc;)n=e,e=n.children[n.children.length-1];(!e||!(e instanceof o1)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((Vs||vs)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG",n),this.addHackNode("BR",this.top))}addHackNode(e,n){if(n==this.top&&this.index<n.children.length&&n.children[this.index].matchesHack(e))this.index++;else{let s=document.createElement(e);e=="IMG"&&(s.className="ProseMirror-separator",s.alt=""),e=="BR"&&(s.className="ProseMirror-trailingBreak");let r=new AH(this.top,[],s,null);n!=this.top?n.children.push(r):n.children.splice(this.index++,0,r),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||e.nodeType==1&&e.contains(this.lock.parentNode))}}function sRe(t,e){let n=e,s=n.children.length,r=t.childCount,i=new Map,o=[];e:for(;r>0;){let a;for(;;)if(s){let c=n.children[s-1];if(c instanceof Vc)n=c,s=c.children.length;else{a=c,s--;break}}else{if(n==e)break e;s=n.parent.children.indexOf(n),n=n.parent}let l=a.node;if(l){if(l!=t.child(r-1))break;--r,i.set(a,r),o.push(a)}}return{index:r,matched:i,matches:o.reverse()}}function rRe(t,e){return t.type.side-e.type.side}function iRe(t,e,n,s){let r=e.locals(t),i=0;if(r.length==0){for(let c=0;c<t.childCount;c++){let u=t.child(c);s(u,r,e.forChild(i,u),c),i+=u.nodeSize}return}let o=0,a=[],l=null;for(let c=0;;){let u,d;for(;o<r.length&&r[o].to==i;){let g=r[o++];g.widget&&(u?(d||(d=[u])).push(g):u=g)}if(u)if(d){d.sort(rRe);for(let g=0;g<d.length;g++)n(d[g],c,!!l)}else n(u,c,!!l);let h,f;if(l)f=-1,h=l,l=null;else if(c<t.childCount)f=c,h=t.child(c++);else break;for(let g=0;g<a.length;g++)a[g].to<=i&&a.splice(g--,1);for(;o<r.length&&r[o].from<=i&&r[o].to>i;)a.push(r[o++]);let p=i+h.nodeSize;if(h.isText){let g=p;o<r.length&&r[o].from<g&&(g=r[o].from);for(let y=0;y<a.length;y++)a[y].to<g&&(g=a[y].to);g<p&&(l=h.cut(g-i),h=h.cut(0,g-i),p=g,f=-1)}else for(;o<r.length&&r[o].to<p;)o++;let m=h.isInline&&!h.isLeaf?a.filter(g=>!g.inline):a.slice();s(h,m,e.forChild(i,h),f),i=p}}function oRe(t){if(t.nodeName=="UL"||t.nodeName=="OL"){let e=t.style.cssText;t.style.cssText=e+"; list-style: square !important",window.getComputedStyle(t).listStyle,t.style.cssText=e}}function aRe(t,e,n,s){for(let r=0,i=0;r<t.childCount&&i<=s;){let o=t.child(r++),a=i;if(i+=o.nodeSize,!o.isText)continue;let l=o.text;for(;r<t.childCount;){let c=t.child(r++);if(i+=c.nodeSize,!c.isText)break;l+=c.text}if(i>=n){if(i>=s&&l.slice(s-e.length-a,s-a)==e)return s-e.length;let c=a<s?l.lastIndexOf(e,s-a-1):-1;if(c>=0&&c+e.length+a>=n)return a+c;if(n==s&&l.length>=s+e.length-a&&l.slice(s-a,s-a+e.length)==e)return s}}return-1}function UC(t,e,n,s,r){let i=[];for(let o=0,a=0;o<t.length;o++){let l=t[o],c=a,u=a+=l.size;c>=n||u<=e?i.push(l):(c<e&&i.push(l.slice(0,e-c,s)),r&&(i.push(r),r=void 0),u>n&&i.push(l.slice(n-c,l.size,s)))}return i}function B2(t,e=null){let n=t.domSelectionRange(),s=t.state.doc;if(!n.focusNode)return null;let r=t.docView.nearestDesc(n.focusNode),i=r&&r.size==0,o=t.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(o<0)return null;let a=s.resolve(o),l,c;if(i1(n)){for(l=o;r&&!r.node;)r=r.parent;let d=r.node;if(r&&d.isAtom&&Re.isSelectable(d)&&r.parent&&!(d.isInline&&O$e(n.focusNode,n.focusOffset,r.dom))){let h=r.posBefore;c=new Re(o==h?a:s.resolve(h))}}else{if(n instanceof t.dom.ownerDocument.defaultView.Selection&&n.rangeCount>1){let d=o,h=o;for(let f=0;f<n.rangeCount;f++){let p=n.getRangeAt(f);d=Math.min(d,t.docView.posFromDOM(p.startContainer,p.startOffset,1)),h=Math.max(h,t.docView.posFromDOM(p.endContainer,p.endOffset,-1))}if(d<0)return null;[l,o]=h==t.state.selection.anchor?[h,d]:[d,h],a=s.resolve(o)}else l=t.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(l<0)return null}let u=s.resolve(l);if(!c){let d=e=="pointer"||t.state.selection.head<a.pos&&!i?1:-1;c=j2(t,u,a,d)}return c}function OH(t){return t.editable?t.hasFocus():PH(t)&&document.activeElement&&document.activeElement.contains(t.dom)}function Xo(t,e=!1){let n=t.state.selection;if(MH(t,n),!!OH(t)){if(!e&&t.input.mouseDown&&t.input.mouseDown.allowDefault&&vs){let s=t.domSelectionRange(),r=t.domObserver.currentSelection;if(s.anchorNode&&r.anchorNode&&jc(s.anchorNode,s.anchorOffset,r.anchorNode,r.anchorOffset)){t.input.mouseDown.delayedSelectionSync=!0,t.domObserver.setCurSelection();return}}if(t.domObserver.disconnectSelection(),t.cursorWrapper)cRe(t);else{let{anchor:s,head:r}=n,i,o;cP&&!(n instanceof Le)&&(n.$from.parent.inlineContent||(i=uP(t,n.from)),!n.empty&&!n.$from.parent.inlineContent&&(o=uP(t,n.to))),t.docView.setSelection(s,r,t,e),cP&&(i&&dP(i),o&&dP(o)),n.visible?t.dom.classList.remove("ProseMirror-hideselection"):(t.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&lRe(t))}t.domObserver.setCurSelection(),t.domObserver.connectSelection()}}const cP=Vs||vs&&wH<63;function uP(t,e){let{node:n,offset:s}=t.docView.domFromPos(e,0),r=s<n.childNodes.length?n.childNodes[s]:null,i=s?n.childNodes[s-1]:null;if(Vs&&r&&r.contentEditable=="false")return Yw(r);if((!r||r.contentEditable=="false")&&(!i||i.contentEditable=="false")){if(r)return Yw(r);if(i)return Yw(i)}}function Yw(t){return t.contentEditable="true",Vs&&t.draggable&&(t.draggable=!1,t.wasDraggable=!0),t}function dP(t){t.contentEditable="false",t.wasDraggable&&(t.draggable=!0,t.wasDraggable=null)}function lRe(t){let e=t.dom.ownerDocument;e.removeEventListener("selectionchange",t.input.hideSelectionGuard);let n=t.domSelectionRange(),s=n.anchorNode,r=n.anchorOffset;e.addEventListener("selectionchange",t.input.hideSelectionGuard=()=>{(n.anchorNode!=s||n.anchorOffset!=r)&&(e.removeEventListener("selectionchange",t.input.hideSelectionGuard),setTimeout(()=>{(!OH(t)||t.state.selection.visible)&&t.dom.classList.remove("ProseMirror-hideselection")},20))})}function cRe(t){let e=t.domSelection();if(!e)return;let n=t.cursorWrapper.dom,s=n.nodeName=="IMG";s?e.collapse(n.parentNode,Qn(n)+1):e.collapse(n,0),!s&&!t.state.selection.visible&&or&&Za<=11&&(n.disabled=!0,n.disabled=!1)}function MH(t,e){if(e instanceof Re){let n=t.docView.descAt(e.from);n!=t.lastSelectedViewDesc&&(hP(t),n&&n.selectNode(),t.lastSelectedViewDesc=n)}else hP(t)}function hP(t){t.lastSelectedViewDesc&&(t.lastSelectedViewDesc.parent&&t.lastSelectedViewDesc.deselectNode(),t.lastSelectedViewDesc=void 0)}function j2(t,e,n,s){return t.someProp("createSelectionBetween",r=>r(t,e,n))||Le.between(e,n,s)}function fP(t){return t.editable&&!t.hasFocus()?!1:PH(t)}function PH(t){let e=t.domSelectionRange();if(!e.anchorNode)return!1;try{return t.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(t.editable||t.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function uRe(t){let e=t.docView.domFromPos(t.state.selection.anchor,0),n=t.domSelectionRange();return jc(e.node,e.offset,n.anchorNode,n.anchorOffset)}function WC(t,e){let{$anchor:n,$head:s}=t.selection,r=e>0?n.max(s):n.min(s),i=r.parent.inlineContent?r.depth?t.doc.resolve(e>0?r.after():r.before()):null:r;return i&&We.findFrom(i,e)}function wa(t,e){return t.dispatch(t.state.tr.setSelection(e).scrollIntoView()),!0}function pP(t,e,n){let s=t.state.selection;if(s instanceof Le)if(n.indexOf("s")>-1){let{$head:r}=s,i=r.textOffset?null:e<0?r.nodeBefore:r.nodeAfter;if(!i||i.isText||!i.isLeaf)return!1;let o=t.state.doc.resolve(r.pos+i.nodeSize*(e<0?-1:1));return wa(t,new Le(s.$anchor,o))}else if(s.empty){if(t.endOfTextblock(e>0?"forward":"backward")){let r=WC(t.state,e);return r&&r instanceof Re?wa(t,r):!1}else if(!(Br&&n.indexOf("m")>-1)){let r=s.$head,i=r.textOffset?null:e<0?r.nodeBefore:r.nodeAfter,o;if(!i||i.isText)return!1;let a=e<0?r.pos-i.nodeSize:r.pos;return i.isAtom||(o=t.docView.descAt(a))&&!o.contentDOM?Re.isSelectable(i)?wa(t,new Re(e<0?t.state.doc.resolve(r.pos-i.nodeSize):r)):Qm?wa(t,new Le(t.state.doc.resolve(e<0?a:a+i.nodeSize))):!1:!1}}else return!1;else{if(s instanceof Re&&s.node.isInline)return wa(t,new Le(e>0?s.$to:s.$from));{let r=WC(t.state,e);return r?wa(t,r):!1}}}function ox(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function vf(t,e){let n=t.pmViewDesc;return n&&n.size==0&&(e<0||t.nextSibling||t.nodeName!="BR")}function Su(t,e){return e<0?dRe(t):hRe(t)}function dRe(t){let e=t.domSelectionRange(),n=e.focusNode,s=e.focusOffset;if(!n)return;let r,i,o=!1;for(ei&&n.nodeType==1&&s<ox(n)&&vf(n.childNodes[s],-1)&&(o=!0);;)if(s>0){if(n.nodeType!=1)break;{let a=n.childNodes[s-1];if(vf(a,-1))r=n,i=--s;else if(a.nodeType==3)n=a,s=n.nodeValue.length;else break}}else{if(LH(n))break;{let a=n.previousSibling;for(;a&&vf(a,-1);)r=n.parentNode,i=Qn(a),a=a.previousSibling;if(a)n=a,s=ox(n);else{if(n=n.parentNode,n==t.dom)break;s=0}}}o?HC(t,n,s):r&&HC(t,r,i)}function hRe(t){let e=t.domSelectionRange(),n=e.focusNode,s=e.focusOffset;if(!n)return;let r=ox(n),i,o;for(;;)if(s<r){if(n.nodeType!=1)break;let a=n.childNodes[s];if(vf(a,1))i=n,o=++s;else break}else{if(LH(n))break;{let a=n.nextSibling;for(;a&&vf(a,1);)i=a.parentNode,o=Qn(a)+1,a=a.nextSibling;if(a)n=a,s=0,r=ox(n);else{if(n=n.parentNode,n==t.dom)break;s=r=0}}}i&&HC(t,i,o)}function LH(t){let e=t.pmViewDesc;return e&&e.node&&e.node.isBlock}function fRe(t,e){for(;t&&e==t.childNodes.length&&!Ym(t);)e=Qn(t)+1,t=t.parentNode;for(;t&&e<t.childNodes.length;){let n=t.childNodes[e];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;t=n,e=0}}function pRe(t,e){for(;t&&!e&&!Ym(t);)e=Qn(t),t=t.parentNode;for(;t&&e;){let n=t.childNodes[e-1];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;t=n,e=t.childNodes.length}}function HC(t,e,n){if(e.nodeType!=3){let i,o;(o=fRe(e,n))?(e=o,n=0):(i=pRe(e,n))&&(e=i,n=i.nodeValue.length)}let s=t.domSelection();if(!s)return;if(i1(s)){let i=document.createRange();i.setEnd(e,n),i.setStart(e,n),s.removeAllRanges(),s.addRange(i)}else s.extend&&s.extend(e,n);t.domObserver.setCurSelection();let{state:r}=t;setTimeout(()=>{t.state==r&&Xo(t)},50)}function mP(t,e){let n=t.state.doc.resolve(e);if(!(vs||L$e)&&n.parent.inlineContent){let r=t.coordsAtPos(e);if(e>n.start()){let i=t.coordsAtPos(e-1),o=(i.top+i.bottom)/2;if(o>r.top&&o<r.bottom&&Math.abs(i.left-r.left)>1)return i.left<r.left?"ltr":"rtl"}if(e<n.end()){let i=t.coordsAtPos(e+1),o=(i.top+i.bottom)/2;if(o>r.top&&o<r.bottom&&Math.abs(i.left-r.left)>1)return i.left>r.left?"ltr":"rtl"}}return getComputedStyle(t.dom).direction=="rtl"?"rtl":"ltr"}function gP(t,e,n){let s=t.state.selection;if(s instanceof Le&&!s.empty||n.indexOf("s")>-1||Br&&n.indexOf("m")>-1)return!1;let{$from:r,$to:i}=s;if(!r.parent.inlineContent||t.endOfTextblock(e<0?"up":"down")){let o=WC(t.state,e);if(o&&o instanceof Re)return wa(t,o)}if(!r.parent.inlineContent){let o=e<0?r:i,a=s instanceof Zr?We.near(o,e):We.findFrom(o,e);return a?wa(t,a):!1}return!1}function yP(t,e){if(!(t.state.selection instanceof Le))return!0;let{$head:n,$anchor:s,empty:r}=t.state.selection;if(!n.sameParent(s))return!0;if(!r)return!1;if(t.endOfTextblock(e>0?"forward":"backward"))return!0;let i=!n.textOffset&&(e<0?n.nodeBefore:n.nodeAfter);if(i&&!i.isText){let o=t.state.tr;return e<0?o.delete(n.pos-i.nodeSize,n.pos):o.delete(n.pos,n.pos+i.nodeSize),t.dispatch(o),!0}return!1}function xP(t,e,n){t.domObserver.stop(),e.contentEditable=n,t.domObserver.start()}function mRe(t){if(!Vs||t.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:n}=t.domSelectionRange();if(e&&e.nodeType==1&&n==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let s=e.firstChild;xP(t,s,"true"),setTimeout(()=>xP(t,s,"false"),20)}return!1}function gRe(t){let e="";return t.ctrlKey&&(e+="c"),t.metaKey&&(e+="m"),t.altKey&&(e+="a"),t.shiftKey&&(e+="s"),e}function yRe(t,e){let n=e.keyCode,s=gRe(e);if(n==8||Br&&n==72&&s=="c")return yP(t,-1)||Su(t,-1);if(n==46&&!e.shiftKey||Br&&n==68&&s=="c")return yP(t,1)||Su(t,1);if(n==13||n==27)return!0;if(n==37||Br&&n==66&&s=="c"){let r=n==37?mP(t,t.state.selection.from)=="ltr"?-1:1:-1;return pP(t,r,s)||Su(t,r)}else if(n==39||Br&&n==70&&s=="c"){let r=n==39?mP(t,t.state.selection.from)=="ltr"?1:-1:1;return pP(t,r,s)||Su(t,r)}else{if(n==38||Br&&n==80&&s=="c")return gP(t,-1,s)||Su(t,-1);if(n==40||Br&&n==78&&s=="c")return mRe(t)||gP(t,1,s)||Su(t,1);if(s==(Br?"m":"c")&&(n==66||n==73||n==89||n==90))return!0}return!1}function V2(t,e){t.someProp("transformCopied",f=>{e=f(e,t)});let n=[],{content:s,openStart:r,openEnd:i}=e;for(;r>1&&i>1&&s.childCount==1&&s.firstChild.childCount==1;){r--,i--;let f=s.firstChild;n.push(f.type.name,f.attrs!=f.type.defaultAttrs?f.attrs:null),s=f.content}let o=t.someProp("clipboardSerializer")||au.fromSchema(t.state.schema),a=VH(),l=a.createElement("div");l.appendChild(o.serializeFragment(s,{document:a}));let c=l.firstChild,u,d=0;for(;c&&c.nodeType==1&&(u=jH[c.nodeName.toLowerCase()]);){for(let f=u.length-1;f>=0;f--){let p=a.createElement(u[f]);for(;l.firstChild;)p.appendChild(l.firstChild);l.appendChild(p),d++}c=l.firstChild}c&&c.nodeType==1&&c.setAttribute("data-pm-slice",`${r} ${i}${d?` -${d}`:""} ${JSON.stringify(n)}`);let h=t.someProp("clipboardTextSerializer",f=>f(e,t))||e.content.textBetween(0,e.content.size,`

`);return{dom:l,text:h,slice:e}}function FH(t,e,n,s,r){let i=r.parent.type.spec.code,o,a;if(!n&&!e)return null;let l=!!e&&(s||i||!n);if(l){if(t.someProp("transformPastedText",h=>{e=h(e,i||s,t)}),i)return a=new me(se.from(t.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0),t.someProp("transformPasted",h=>{a=h(a,t,!0)}),a;let d=t.someProp("clipboardTextParser",h=>h(e,r,s,t));if(d)a=d;else{let h=r.marks(),{schema:f}=t.state,p=au.fromSchema(f);o=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(m=>{let g=o.appendChild(document.createElement("p"));m&&g.appendChild(p.serializeNode(f.text(m,h)))})}}else t.someProp("transformPastedHTML",d=>{n=d(n,t)}),o=wRe(n),Qm&&SRe(o);let c=o&&o.querySelector("[data-pm-slice]"),u=c&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(c.getAttribute("data-pm-slice")||"");if(u&&u[3])for(let d=+u[3];d>0;d--){let h=o.firstChild;for(;h&&h.nodeType!=1;)h=h.nextSibling;if(!h)break;o=h}if(a||(a=(t.someProp("clipboardParser")||t.someProp("domParser")||Qa.fromSchema(t.state.schema)).parseSlice(o,{preserveWhitespace:!!(l||u),context:r,ruleFromNode(h){return h.nodeName=="BR"&&!h.nextSibling&&h.parentNode&&!xRe.test(h.parentNode.nodeName)?{ignore:!0}:null}})),u)a=kRe(bP(a,+u[1],+u[2]),u[4]);else if(a=me.maxOpen(bRe(a.content,r),!0),a.openStart||a.openEnd){let d=0,h=0;for(let f=a.content.firstChild;d<a.openStart&&!f.type.spec.isolating;d++,f=f.firstChild);for(let f=a.content.lastChild;h<a.openEnd&&!f.type.spec.isolating;h++,f=f.lastChild);a=bP(a,d,h)}return t.someProp("transformPasted",d=>{a=d(a,t,l)}),a}const xRe=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function bRe(t,e){if(t.childCount<2)return t;for(let n=e.depth;n>=0;n--){let r=e.node(n).contentMatchAt(e.index(n)),i,o=[];if(t.forEach(a=>{if(!o)return;let l=r.findWrapping(a.type),c;if(!l)return o=null;if(c=o.length&&i.length&&zH(l,i,a,o[o.length-1],0))o[o.length-1]=c;else{o.length&&(o[o.length-1]=BH(o[o.length-1],i.length));let u=_H(a,l);o.push(u),r=r.matchType(u.type),i=l}}),o)return se.from(o)}return t}function _H(t,e,n=0){for(let s=e.length-1;s>=n;s--)t=e[s].create(null,se.from(t));return t}function zH(t,e,n,s,r){if(r<t.length&&r<e.length&&t[r]==e[r]){let i=zH(t,e,n,s.lastChild,r+1);if(i)return s.copy(s.content.replaceChild(s.childCount-1,i));if(s.contentMatchAt(s.childCount).matchType(r==t.length-1?n.type:t[r+1]))return s.copy(s.content.append(se.from(_H(n,t,r+1))))}}function BH(t,e){if(e==0)return t;let n=t.content.replaceChild(t.childCount-1,BH(t.lastChild,e-1)),s=t.contentMatchAt(t.childCount).fillBefore(se.empty,!0);return t.copy(n.append(s))}function GC(t,e,n,s,r,i){let o=e<0?t.firstChild:t.lastChild,a=o.content;return t.childCount>1&&(i=0),r<s-1&&(a=GC(a,e,n,s,r+1,i)),r>=n&&(a=e<0?o.contentMatchAt(0).fillBefore(a,i<=r).append(a):a.append(o.contentMatchAt(o.childCount).fillBefore(se.empty,!0))),t.replaceChild(e<0?0:t.childCount-1,o.copy(a))}function bP(t,e,n){return e<t.openStart&&(t=new me(GC(t.content,-1,e,t.openStart,0,t.openEnd),e,t.openEnd)),n<t.openEnd&&(t=new me(GC(t.content,1,n,t.openEnd,0,0),t.openStart,n)),t}const jH={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let vP=null;function VH(){return vP||(vP=document.implementation.createHTMLDocument("title"))}let Qw=null;function vRe(t){let e=window.trustedTypes;return e?(Qw||(Qw=e.defaultPolicy||e.createPolicy("ProseMirrorClipboard",{createHTML:n=>n})),Qw.createHTML(t)):t}function wRe(t){let e=/^(\s*<meta [^>]*>)*/.exec(t);e&&(t=t.slice(e[0].length));let n=VH().createElement("div"),s=/<([a-z][^>\s]+)/i.exec(t),r;if((r=s&&jH[s[1].toLowerCase()])&&(t=r.map(i=>"<"+i+">").join("")+t+r.map(i=>"</"+i+">").reverse().join("")),n.innerHTML=vRe(t),r)for(let i=0;i<r.length;i++)n=n.querySelector(r[i])||n;return n}function SRe(t){let e=t.querySelectorAll(vs?"span:not([class]):not([style])":"span.Apple-converted-space");for(let n=0;n<e.length;n++){let s=e[n];s.childNodes.length==1&&s.textContent==""&&s.parentNode&&s.parentNode.replaceChild(t.ownerDocument.createTextNode(" "),s)}}function kRe(t,e){if(!t.size)return t;let n=t.content.firstChild.type.schema,s;try{s=JSON.parse(e)}catch{return t}let{content:r,openStart:i,openEnd:o}=t;for(let a=s.length-2;a>=0;a-=2){let l=n.nodes[s[a]];if(!l||l.hasRequiredAttrs())break;r=se.from(l.create(s[a+1],r)),i++,o++}return new me(r,i,o)}const Us={},Ws={},CRe={touchstart:!0,touchmove:!0};class NRe{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function TRe(t){for(let e in Us){let n=Us[e];t.dom.addEventListener(e,t.input.eventHandlers[e]=s=>{IRe(t,s)&&!U2(t,s)&&(t.editable||!(s.type in Ws))&&n(t,s)},CRe[e]?{passive:!0}:void 0)}Vs&&t.dom.addEventListener("input",()=>null),KC(t)}function La(t,e){t.input.lastSelectionOrigin=e,t.input.lastSelectionTime=Date.now()}function ERe(t){t.domObserver.stop();for(let e in t.input.eventHandlers)t.dom.removeEventListener(e,t.input.eventHandlers[e]);clearTimeout(t.input.composingTimeout),clearTimeout(t.input.lastIOSEnterFallbackTimeout)}function KC(t){t.someProp("handleDOMEvents",e=>{for(let n in e)t.input.eventHandlers[n]||t.dom.addEventListener(n,t.input.eventHandlers[n]=s=>U2(t,s))})}function U2(t,e){return t.someProp("handleDOMEvents",n=>{let s=n[e.type];return s?s(t,e)||e.defaultPrevented:!1})}function IRe(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let n=e.target;n!=t.dom;n=n.parentNode)if(!n||n.nodeType==11||n.pmViewDesc&&n.pmViewDesc.stopEvent(e))return!1;return!0}function ARe(t,e){!U2(t,e)&&Us[e.type]&&(t.editable||!(e.type in Ws))&&Us[e.type](t,e)}Ws.keydown=(t,e)=>{let n=e;if(t.input.shiftKey=n.keyCode==16||n.shiftKey,!WH(t,n)&&(t.input.lastKeyCode=n.keyCode,t.input.lastKeyCodeTime=Date.now(),!(Wo&&vs&&n.keyCode==13)))if(n.keyCode!=229&&t.domObserver.forceFlush(),Ld&&n.keyCode==13&&!n.ctrlKey&&!n.altKey&&!n.metaKey){let s=Date.now();t.input.lastIOSEnter=s,t.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{t.input.lastIOSEnter==s&&(t.someProp("handleKeyDown",r=>r(t,ql(13,"Enter"))),t.input.lastIOSEnter=0)},200)}else t.someProp("handleKeyDown",s=>s(t,n))||yRe(t,n)?n.preventDefault():La(t,"key")};Ws.keyup=(t,e)=>{e.keyCode==16&&(t.input.shiftKey=!1)};Ws.keypress=(t,e)=>{let n=e;if(WH(t,n)||!n.charCode||n.ctrlKey&&!n.altKey||Br&&n.metaKey)return;if(t.someProp("handleKeyPress",r=>r(t,n))){n.preventDefault();return}let s=t.state.selection;if(!(s instanceof Le)||!s.$from.sameParent(s.$to)){let r=String.fromCharCode(n.charCode),i=()=>t.state.tr.insertText(r).scrollIntoView();!/[\r\n]/.test(r)&&!t.someProp("handleTextInput",o=>o(t,s.$from.pos,s.$to.pos,r,i))&&t.dispatch(i()),n.preventDefault()}};function a1(t){return{left:t.clientX,top:t.clientY}}function $Re(t,e){let n=e.x-t.clientX,s=e.y-t.clientY;return n*n+s*s<100}function W2(t,e,n,s,r){if(s==-1)return!1;let i=t.state.doc.resolve(s);for(let o=i.depth+1;o>0;o--)if(t.someProp(e,a=>o>i.depth?a(t,n,i.nodeAfter,i.before(o),r,!0):a(t,n,i.node(o),i.before(o),r,!1)))return!0;return!1}function ld(t,e,n){if(t.focused||t.focus(),t.state.selection.eq(e))return;let s=t.state.tr.setSelection(e);n=="pointer"&&s.setMeta("pointer",!0),t.dispatch(s)}function RRe(t,e){if(e==-1)return!1;let n=t.state.doc.resolve(e),s=n.nodeAfter;return s&&s.isAtom&&Re.isSelectable(s)?(ld(t,new Re(n),"pointer"),!0):!1}function DRe(t,e){if(e==-1)return!1;let n=t.state.selection,s,r;n instanceof Re&&(s=n.node);let i=t.state.doc.resolve(e);for(let o=i.depth+1;o>0;o--){let a=o>i.depth?i.nodeAfter:i.node(o);if(Re.isSelectable(a)){s&&n.$from.depth>0&&o>=n.$from.depth&&i.before(n.$from.depth+1)==n.$from.pos?r=i.before(n.$from.depth):r=i.before(o);break}}return r!=null?(ld(t,Re.create(t.state.doc,r),"pointer"),!0):!1}function ORe(t,e,n,s,r){return W2(t,"handleClickOn",e,n,s)||t.someProp("handleClick",i=>i(t,e,s))||(r?DRe(t,n):RRe(t,n))}function MRe(t,e,n,s){return W2(t,"handleDoubleClickOn",e,n,s)||t.someProp("handleDoubleClick",r=>r(t,e,s))}function PRe(t,e,n,s){return W2(t,"handleTripleClickOn",e,n,s)||t.someProp("handleTripleClick",r=>r(t,e,s))||LRe(t,n,s)}function LRe(t,e,n){if(n.button!=0)return!1;let s=t.state.doc;if(e==-1)return s.inlineContent?(ld(t,Le.create(s,0,s.content.size),"pointer"),!0):!1;let r=s.resolve(e);for(let i=r.depth+1;i>0;i--){let o=i>r.depth?r.nodeAfter:r.node(i),a=r.before(i);if(o.inlineContent)ld(t,Le.create(s,a+1,a+1+o.content.size),"pointer");else if(Re.isSelectable(o))ld(t,Re.create(s,a),"pointer");else continue;return!0}}function H2(t){return ax(t)}const UH=Br?"metaKey":"ctrlKey";Us.mousedown=(t,e)=>{let n=e;t.input.shiftKey=n.shiftKey;let s=H2(t),r=Date.now(),i="singleClick";r-t.input.lastClick.time<500&&$Re(n,t.input.lastClick)&&!n[UH]&&t.input.lastClick.button==n.button&&(t.input.lastClick.type=="singleClick"?i="doubleClick":t.input.lastClick.type=="doubleClick"&&(i="tripleClick")),t.input.lastClick={time:r,x:n.clientX,y:n.clientY,type:i,button:n.button};let o=t.posAtCoords(a1(n));o&&(i=="singleClick"?(t.input.mouseDown&&t.input.mouseDown.done(),t.input.mouseDown=new FRe(t,o,n,!!s)):(i=="doubleClick"?MRe:PRe)(t,o.pos,o.inside,n)?n.preventDefault():La(t,"pointer"))};class FRe{constructor(e,n,s,r){this.view=e,this.pos=n,this.event=s,this.flushed=r,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!s[UH],this.allowDefault=s.shiftKey;let i,o;if(n.inside>-1)i=e.state.doc.nodeAt(n.inside),o=n.inside;else{let u=e.state.doc.resolve(n.pos);i=u.parent,o=u.depth?u.before():0}const a=r?null:s.target,l=a?e.docView.nearestDesc(a,!0):null;this.target=l&&l.nodeDOM.nodeType==1?l.nodeDOM:null;let{selection:c}=e.state;(s.button==0&&i.type.spec.draggable&&i.type.spec.selectable!==!1||c instanceof Re&&c.from<=o&&c.to>o)&&(this.mightDrag={node:i,pos:o,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&ei&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),La(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>Xo(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let n=this.pos;this.view.state.doc!=this.startDoc&&(n=this.view.posAtCoords(a1(e))),this.updateAllowDefault(e),this.allowDefault||!n?La(this.view,"pointer"):ORe(this.view,n.pos,n.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||Vs&&this.mightDrag&&!this.mightDrag.node.isAtom||vs&&!this.view.state.selection.visible&&Math.min(Math.abs(n.pos-this.view.state.selection.from),Math.abs(n.pos-this.view.state.selection.to))<=2)?(ld(this.view,We.near(this.view.state.doc.resolve(n.pos)),"pointer"),e.preventDefault()):La(this.view,"pointer")}move(e){this.updateAllowDefault(e),La(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}Us.touchstart=t=>{t.input.lastTouch=Date.now(),H2(t),La(t,"pointer")};Us.touchmove=t=>{t.input.lastTouch=Date.now(),La(t,"pointer")};Us.contextmenu=t=>H2(t);function WH(t,e){return t.composing?!0:Vs&&Math.abs(e.timeStamp-t.input.compositionEndedAt)<500?(t.input.compositionEndedAt=-2e8,!0):!1}const _Re=Wo?5e3:-1;Ws.compositionstart=Ws.compositionupdate=t=>{if(!t.composing){t.domObserver.flush();let{state:e}=t,n=e.selection.$to;if(e.selection instanceof Le&&(e.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some(s=>s.type.spec.inclusive===!1)))t.markCursor=t.state.storedMarks||n.marks(),ax(t,!0),t.markCursor=null;else if(ax(t,!e.selection.empty),ei&&e.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length){let s=t.domSelectionRange();for(let r=s.focusNode,i=s.focusOffset;r&&r.nodeType==1&&i!=0;){let o=i<0?r.lastChild:r.childNodes[i-1];if(!o)break;if(o.nodeType==3){let a=t.domSelection();a&&a.collapse(o,o.nodeValue.length);break}else r=o,i=-1}}t.input.composing=!0}HH(t,_Re)};Ws.compositionend=(t,e)=>{t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=e.timeStamp,t.input.compositionPendingChanges=t.domObserver.pendingRecords().length?t.input.compositionID:0,t.input.compositionNode=null,t.input.compositionPendingChanges&&Promise.resolve().then(()=>t.domObserver.flush()),t.input.compositionID++,HH(t,20))};function HH(t,e){clearTimeout(t.input.composingTimeout),e>-1&&(t.input.composingTimeout=setTimeout(()=>ax(t),e))}function GH(t){for(t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=BRe());t.input.compositionNodes.length>0;)t.input.compositionNodes.pop().markParentsDirty()}function zRe(t){let e=t.domSelectionRange();if(!e.focusNode)return null;let n=R$e(e.focusNode,e.focusOffset),s=D$e(e.focusNode,e.focusOffset);if(n&&s&&n!=s){let r=s.pmViewDesc,i=t.domObserver.lastChangedTextNode;if(n==i||s==i)return i;if(!r||!r.isText(s.nodeValue))return s;if(t.input.compositionNode==s){let o=n.pmViewDesc;if(!(!o||!o.isText(n.nodeValue)))return s}}return n||s}function BRe(){let t=document.createEvent("Event");return t.initEvent("event",!0,!0),t.timeStamp}function ax(t,e=!1){if(!(Wo&&t.domObserver.flushingSoon>=0)){if(t.domObserver.forceFlush(),GH(t),e||t.docView&&t.docView.dirty){let n=B2(t),s=t.state.selection;return n&&!n.eq(s)?t.dispatch(t.state.tr.setSelection(n)):(t.markCursor||e)&&!s.$from.node(s.$from.sharedDepth(s.to)).inlineContent?t.dispatch(t.state.tr.deleteSelection()):t.updateState(t.state),!0}return!1}}function jRe(t,e){if(!t.dom.parentNode)return;let n=t.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(e),n.style.cssText="position: fixed; left: -10000px; top: 10px";let s=getSelection(),r=document.createRange();r.selectNodeContents(e),t.dom.blur(),s.removeAllRanges(),s.addRange(r),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n),t.focus()},50)}const fp=or&&Za<15||Ld&&F$e<604;Us.copy=Ws.cut=(t,e)=>{let n=e,s=t.state.selection,r=n.type=="cut";if(s.empty)return;let i=fp?null:n.clipboardData,o=s.content(),{dom:a,text:l}=V2(t,o);i?(n.preventDefault(),i.clearData(),i.setData("text/html",a.innerHTML),i.setData("text/plain",l)):jRe(t,a),r&&t.dispatch(t.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function VRe(t){return t.openStart==0&&t.openEnd==0&&t.content.childCount==1?t.content.firstChild:null}function URe(t,e){if(!t.dom.parentNode)return;let n=t.input.shiftKey||t.state.selection.$from.parent.type.spec.code,s=t.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(s.contentEditable="true"),s.style.cssText="position: fixed; left: -10000px; top: 10px",s.focus();let r=t.input.shiftKey&&t.input.lastKeyCode!=45;setTimeout(()=>{t.focus(),s.parentNode&&s.parentNode.removeChild(s),n?pp(t,s.value,null,r,e):pp(t,s.textContent,s.innerHTML,r,e)},50)}function pp(t,e,n,s,r){let i=FH(t,e,n,s,t.state.selection.$from);if(t.someProp("handlePaste",l=>l(t,r,i||me.empty)))return!0;if(!i)return!1;let o=VRe(i),a=o?t.state.tr.replaceSelectionWith(o,s):t.state.tr.replaceSelection(i);return t.dispatch(a.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function KH(t){let e=t.getData("text/plain")||t.getData("Text");if(e)return e;let n=t.getData("text/uri-list");return n?n.replace(/\r?\n/g," "):""}Ws.paste=(t,e)=>{let n=e;if(t.composing&&!Wo)return;let s=fp?null:n.clipboardData,r=t.input.shiftKey&&t.input.lastKeyCode!=45;s&&pp(t,KH(s),s.getData("text/html"),r,n)?n.preventDefault():URe(t,n)};class qH{constructor(e,n,s){this.slice=e,this.move=n,this.node=s}}const WRe=Br?"altKey":"ctrlKey";function XH(t,e){let n=t.someProp("dragCopies",s=>!s(e));return n??!e[WRe]}Us.dragstart=(t,e)=>{let n=e,s=t.input.mouseDown;if(s&&s.done(),!n.dataTransfer)return;let r=t.state.selection,i=r.empty?null:t.posAtCoords(a1(n)),o;if(!(i&&i.pos>=r.from&&i.pos<=(r instanceof Re?r.to-1:r.to))){if(s&&s.mightDrag)o=Re.create(t.state.doc,s.mightDrag.pos);else if(n.target&&n.target.nodeType==1){let d=t.docView.nearestDesc(n.target,!0);d&&d.node.type.spec.draggable&&d!=t.docView&&(o=Re.create(t.state.doc,d.posBefore))}}let a=(o||t.state.selection).content(),{dom:l,text:c,slice:u}=V2(t,a);(!n.dataTransfer.files.length||!vs||wH>120)&&n.dataTransfer.clearData(),n.dataTransfer.setData(fp?"Text":"text/html",l.innerHTML),n.dataTransfer.effectAllowed="copyMove",fp||n.dataTransfer.setData("text/plain",c),t.dragging=new qH(u,XH(t,n),o)};Us.dragend=t=>{let e=t.dragging;window.setTimeout(()=>{t.dragging==e&&(t.dragging=null)},50)};Ws.dragover=Ws.dragenter=(t,e)=>e.preventDefault();Ws.drop=(t,e)=>{let n=e,s=t.dragging;if(t.dragging=null,!n.dataTransfer)return;let r=t.posAtCoords(a1(n));if(!r)return;let i=t.state.doc.resolve(r.pos),o=s&&s.slice;o?t.someProp("transformPasted",p=>{o=p(o,t,!1)}):o=FH(t,KH(n.dataTransfer),fp?null:n.dataTransfer.getData("text/html"),!1,i);let a=!!(s&&XH(t,n));if(t.someProp("handleDrop",p=>p(t,n,o||me.empty,a))){n.preventDefault();return}if(!o)return;n.preventDefault();let l=o?oH(t.state.doc,i.pos,o):i.pos;l==null&&(l=i.pos);let c=t.state.tr;if(a){let{node:p}=s;p?p.replace(c):c.deleteSelection()}let u=c.mapping.map(l),d=o.openStart==0&&o.openEnd==0&&o.content.childCount==1,h=c.doc;if(d?c.replaceRangeWith(u,u,o.content.firstChild):c.replaceRange(u,u,o),c.doc.eq(h))return;let f=c.doc.resolve(u);if(d&&Re.isSelectable(o.content.firstChild)&&f.nodeAfter&&f.nodeAfter.sameMarkup(o.content.firstChild))c.setSelection(new Re(f));else{let p=c.mapping.map(l);c.mapping.maps[c.mapping.maps.length-1].forEach((m,g,y,x)=>p=x),c.setSelection(j2(t,f,c.doc.resolve(p)))}t.focus(),t.dispatch(c.setMeta("uiEvent","drop"))};Us.focus=t=>{t.input.lastFocus=Date.now(),t.focused||(t.domObserver.stop(),t.dom.classList.add("ProseMirror-focused"),t.domObserver.start(),t.focused=!0,setTimeout(()=>{t.docView&&t.hasFocus()&&!t.domObserver.currentSelection.eq(t.domSelectionRange())&&Xo(t)},20))};Us.blur=(t,e)=>{let n=e;t.focused&&(t.domObserver.stop(),t.dom.classList.remove("ProseMirror-focused"),t.domObserver.start(),n.relatedTarget&&t.dom.contains(n.relatedTarget)&&t.domObserver.currentSelection.clear(),t.focused=!1)};Us.beforeinput=(t,e)=>{if(vs&&Wo&&e.inputType=="deleteContentBackward"){t.domObserver.flushSoon();let{domChangeCount:s}=t.input;setTimeout(()=>{if(t.input.domChangeCount!=s||(t.dom.blur(),t.focus(),t.someProp("handleKeyDown",i=>i(t,ql(8,"Backspace")))))return;let{$cursor:r}=t.state.selection;r&&r.pos>0&&t.dispatch(t.state.tr.delete(r.pos-1,r.pos).scrollIntoView())},50)}};for(let t in Ws)Us[t]=Ws[t];function mp(t,e){if(t==e)return!0;for(let n in t)if(t[n]!==e[n])return!1;for(let n in e)if(!(n in t))return!1;return!0}class lx{constructor(e,n){this.toDOM=e,this.spec=n||mc,this.side=this.spec.side||0}map(e,n,s,r){let{pos:i,deleted:o}=e.mapResult(n.from+r,this.side<0?-1:1);return o?null:new Ms(i-s,i-s,this)}valid(){return!0}eq(e){return this==e||e instanceof lx&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&mp(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class tl{constructor(e,n){this.attrs=e,this.spec=n||mc}map(e,n,s,r){let i=e.map(n.from+r,this.spec.inclusiveStart?-1:1)-s,o=e.map(n.to+r,this.spec.inclusiveEnd?1:-1)-s;return i>=o?null:new Ms(i,o,this)}valid(e,n){return n.from<n.to}eq(e){return this==e||e instanceof tl&&mp(this.attrs,e.attrs)&&mp(this.spec,e.spec)}static is(e){return e.type instanceof tl}destroy(){}}class G2{constructor(e,n){this.attrs=e,this.spec=n||mc}map(e,n,s,r){let i=e.mapResult(n.from+r,1);if(i.deleted)return null;let o=e.mapResult(n.to+r,-1);return o.deleted||o.pos<=i.pos?null:new Ms(i.pos-s,o.pos-s,this)}valid(e,n){let{index:s,offset:r}=e.content.findIndex(n.from),i;return r==n.from&&!(i=e.child(s)).isText&&r+i.nodeSize==n.to}eq(e){return this==e||e instanceof G2&&mp(this.attrs,e.attrs)&&mp(this.spec,e.spec)}destroy(){}}class Ms{constructor(e,n,s){this.from=e,this.to=n,this.type=s}copy(e,n){return new Ms(e,n,this.type)}eq(e,n=0){return this.type.eq(e.type)&&this.from+n==e.from&&this.to+n==e.to}map(e,n,s){return this.type.map(e,this,n,s)}static widget(e,n,s){return new Ms(e,e,new lx(n,s))}static inline(e,n,s,r){return new Ms(e,n,new tl(s,r))}static node(e,n,s,r){return new Ms(e,n,new G2(s,r))}get spec(){return this.type.spec}get inline(){return this.type instanceof tl}get widget(){return this.type instanceof lx}}const Eu=[],mc={};class Vt{constructor(e,n){this.local=e.length?e:Eu,this.children=n.length?n:Eu}static create(e,n){return n.length?cx(n,e,0,mc):fs}find(e,n,s){let r=[];return this.findInner(e??0,n??1e9,r,0,s),r}findInner(e,n,s,r,i){for(let o=0;o<this.local.length;o++){let a=this.local[o];a.from<=n&&a.to>=e&&(!i||i(a.spec))&&s.push(a.copy(a.from+r,a.to+r))}for(let o=0;o<this.children.length;o+=3)if(this.children[o]<n&&this.children[o+1]>e){let a=this.children[o]+1;this.children[o+2].findInner(e-a,n-a,s,r+a,i)}}map(e,n,s){return this==fs||e.maps.length==0?this:this.mapInner(e,n,0,0,s||mc)}mapInner(e,n,s,r,i){let o;for(let a=0;a<this.local.length;a++){let l=this.local[a].map(e,s,r);l&&l.type.valid(n,l)?(o||(o=[])).push(l):i.onRemove&&i.onRemove(this.local[a].spec)}return this.children.length?HRe(this.children,o||[],e,n,s,r,i):o?new Vt(o.sort(gc),Eu):fs}add(e,n){return n.length?this==fs?Vt.create(e,n):this.addInner(e,n,0):this}addInner(e,n,s){let r,i=0;e.forEach((a,l)=>{let c=l+s,u;if(u=YH(n,a,c)){for(r||(r=this.children.slice());i<r.length&&r[i]<l;)i+=3;r[i]==l?r[i+2]=r[i+2].addInner(a,u,c+1):r.splice(i,0,l,l+a.nodeSize,cx(u,a,c+1,mc)),i+=3}});let o=JH(i?QH(n):n,-s);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||o.splice(a--,1);return new Vt(o.length?this.local.concat(o).sort(gc):this.local,r||this.children)}remove(e){return e.length==0||this==fs?this:this.removeInner(e,0)}removeInner(e,n){let s=this.children,r=this.local;for(let i=0;i<s.length;i+=3){let o,a=s[i]+n,l=s[i+1]+n;for(let u=0,d;u<e.length;u++)(d=e[u])&&d.from>a&&d.to<l&&(e[u]=null,(o||(o=[])).push(d));if(!o)continue;s==this.children&&(s=this.children.slice());let c=s[i+2].removeInner(o,a+1);c!=fs?s[i+2]=c:(s.splice(i,3),i-=3)}if(r.length){for(let i=0,o;i<e.length;i++)if(o=e[i])for(let a=0;a<r.length;a++)r[a].eq(o,n)&&(r==this.local&&(r=this.local.slice()),r.splice(a--,1))}return s==this.children&&r==this.local?this:r.length||s.length?new Vt(r,s):fs}forChild(e,n){if(this==fs)return this;if(n.isLeaf)return Vt.empty;let s,r;for(let a=0;a<this.children.length;a+=3)if(this.children[a]>=e){this.children[a]==e&&(s=this.children[a+2]);break}let i=e+1,o=i+n.content.size;for(let a=0;a<this.local.length;a++){let l=this.local[a];if(l.from<o&&l.to>i&&l.type instanceof tl){let c=Math.max(i,l.from)-i,u=Math.min(o,l.to)-i;c<u&&(r||(r=[])).push(l.copy(c,u))}}if(r){let a=new Vt(r.sort(gc),Eu);return s?new Ea([a,s]):a}return s||fs}eq(e){if(this==e)return!0;if(!(e instanceof Vt)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let n=0;n<this.local.length;n++)if(!this.local[n].eq(e.local[n]))return!1;for(let n=0;n<this.children.length;n+=3)if(this.children[n]!=e.children[n]||this.children[n+1]!=e.children[n+1]||!this.children[n+2].eq(e.children[n+2]))return!1;return!0}locals(e){return K2(this.localsInner(e))}localsInner(e){if(this==fs)return Eu;if(e.inlineContent||!this.local.some(tl.is))return this.local;let n=[];for(let s=0;s<this.local.length;s++)this.local[s].type instanceof tl||n.push(this.local[s]);return n}forEachSet(e){e(this)}}Vt.empty=new Vt([],[]);Vt.removeOverlap=K2;const fs=Vt.empty;class Ea{constructor(e){this.members=e}map(e,n){const s=this.members.map(r=>r.map(e,n,mc));return Ea.from(s)}forChild(e,n){if(n.isLeaf)return Vt.empty;let s=[];for(let r=0;r<this.members.length;r++){let i=this.members[r].forChild(e,n);i!=fs&&(i instanceof Ea?s=s.concat(i.members):s.push(i))}return Ea.from(s)}eq(e){if(!(e instanceof Ea)||e.members.length!=this.members.length)return!1;for(let n=0;n<this.members.length;n++)if(!this.members[n].eq(e.members[n]))return!1;return!0}locals(e){let n,s=!0;for(let r=0;r<this.members.length;r++){let i=this.members[r].localsInner(e);if(i.length)if(!n)n=i;else{s&&(n=n.slice(),s=!1);for(let o=0;o<i.length;o++)n.push(i[o])}}return n?K2(s?n:n.sort(gc)):Eu}static from(e){switch(e.length){case 0:return fs;case 1:return e[0];default:return new Ea(e.every(n=>n instanceof Vt)?e:e.reduce((n,s)=>n.concat(s instanceof Vt?s:s.members),[]))}}forEachSet(e){for(let n=0;n<this.members.length;n++)this.members[n].forEachSet(e)}}function HRe(t,e,n,s,r,i,o){let a=t.slice();for(let c=0,u=i;c<n.maps.length;c++){let d=0;n.maps[c].forEach((h,f,p,m)=>{let g=m-p-(f-h);for(let y=0;y<a.length;y+=3){let x=a[y+1];if(x<0||h>x+u-d)continue;let v=a[y]+u-d;f>=v?a[y+1]=h<=v?-2:-1:h>=u&&g&&(a[y]+=g,a[y+1]+=g)}d+=g}),u=n.maps[c].map(u,-1)}let l=!1;for(let c=0;c<a.length;c+=3)if(a[c+1]<0){if(a[c+1]==-2){l=!0,a[c+1]=-1;continue}let u=n.map(t[c]+i),d=u-r;if(d<0||d>=s.content.size){l=!0;continue}let h=n.map(t[c+1]+i,-1),f=h-r,{index:p,offset:m}=s.content.findIndex(d),g=s.maybeChild(p);if(g&&m==d&&m+g.nodeSize==f){let y=a[c+2].mapInner(n,g,u+1,t[c]+i+1,o);y!=fs?(a[c]=d,a[c+1]=f,a[c+2]=y):(a[c+1]=-2,l=!0)}else l=!0}if(l){let c=GRe(a,t,e,n,r,i,o),u=cx(c,s,0,o);e=u.local;for(let d=0;d<a.length;d+=3)a[d+1]<0&&(a.splice(d,3),d-=3);for(let d=0,h=0;d<u.children.length;d+=3){let f=u.children[d];for(;h<a.length&&a[h]<f;)h+=3;a.splice(h,0,u.children[d],u.children[d+1],u.children[d+2])}}return new Vt(e.sort(gc),a)}function JH(t,e){if(!e||!t.length)return t;let n=[];for(let s=0;s<t.length;s++){let r=t[s];n.push(new Ms(r.from+e,r.to+e,r.type))}return n}function GRe(t,e,n,s,r,i,o){function a(l,c){for(let u=0;u<l.local.length;u++){let d=l.local[u].map(s,r,c);d?n.push(d):o.onRemove&&o.onRemove(l.local[u].spec)}for(let u=0;u<l.children.length;u+=3)a(l.children[u+2],l.children[u]+c+1)}for(let l=0;l<t.length;l+=3)t[l+1]==-1&&a(t[l+2],e[l]+i+1);return n}function YH(t,e,n){if(e.isLeaf)return null;let s=n+e.nodeSize,r=null;for(let i=0,o;i<t.length;i++)(o=t[i])&&o.from>n&&o.to<s&&((r||(r=[])).push(o),t[i]=null);return r}function QH(t){let e=[];for(let n=0;n<t.length;n++)t[n]!=null&&e.push(t[n]);return e}function cx(t,e,n,s){let r=[],i=!1;e.forEach((a,l)=>{let c=YH(t,a,l+n);if(c){i=!0;let u=cx(c,a,n+l+1,s);u!=fs&&r.push(l,l+a.nodeSize,u)}});let o=JH(i?QH(t):t,-n).sort(gc);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||(s.onRemove&&s.onRemove(o[a].spec),o.splice(a--,1));return o.length||r.length?new Vt(o,r):fs}function gc(t,e){return t.from-e.from||t.to-e.to}function K2(t){let e=t;for(let n=0;n<e.length-1;n++){let s=e[n];if(s.from!=s.to)for(let r=n+1;r<e.length;r++){let i=e[r];if(i.from==s.from){i.to!=s.to&&(e==t&&(e=t.slice()),e[r]=i.copy(i.from,s.to),wP(e,r+1,i.copy(s.to,i.to)));continue}else{i.from<s.to&&(e==t&&(e=t.slice()),e[n]=s.copy(s.from,i.from),wP(e,r,s.copy(i.from,s.to)));break}}}return e}function wP(t,e,n){for(;e<t.length&&gc(n,t[e])>0;)e++;t.splice(e,0,n)}function Zw(t){let e=[];return t.someProp("decorations",n=>{let s=n(t.state);s&&s!=fs&&e.push(s)}),t.cursorWrapper&&e.push(Vt.create(t.state.doc,[t.cursorWrapper.deco])),Ea.from(e)}const KRe={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},qRe=or&&Za<=11;class XRe{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class JRe{constructor(e,n){this.view=e,this.handleDOMChange=n,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new XRe,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(s=>{for(let r=0;r<s.length;r++)this.queue.push(s[r]);or&&Za<=11&&s.some(r=>r.type=="childList"&&r.removedNodes.length||r.type=="characterData"&&r.oldValue.length>r.target.nodeValue.length)?this.flushSoon():this.flush()}),qRe&&(this.onCharData=s=>{this.queue.push({target:s.target,type:"characterData",oldValue:s.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,KRe)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let n=0;n<e.length;n++)this.queue.push(e[n]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(fP(this.view)){if(this.suppressingSelectionUpdates)return Xo(this.view);if(or&&Za<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&jc(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let n=new Set,s;for(let i=e.focusNode;i;i=Pd(i))n.add(i);for(let i=e.anchorNode;i;i=Pd(i))if(n.has(i)){s=i;break}let r=s&&this.view.docView.nearestDesc(s);if(r&&r.ignoreMutation({type:"selection",target:s.nodeType==3?s.parentNode:s}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let n=this.pendingRecords();n.length&&(this.queue=[]);let s=e.domSelectionRange(),r=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(s)&&fP(e)&&!this.ignoreSelectionChange(s),i=-1,o=-1,a=!1,l=[];if(e.editable)for(let u=0;u<n.length;u++){let d=this.registerMutation(n[u],l);d&&(i=i<0?d.from:Math.min(d.from,i),o=o<0?d.to:Math.max(d.to,o),d.typeOver&&(a=!0))}if(ei&&l.length){let u=l.filter(d=>d.nodeName=="BR");if(u.length==2){let[d,h]=u;d.parentNode&&d.parentNode.parentNode==h.parentNode?h.remove():d.remove()}else{let{focusNode:d}=this.currentSelection;for(let h of u){let f=h.parentNode;f&&f.nodeName=="LI"&&(!d||ZRe(e,d)!=f)&&h.remove()}}}let c=null;i<0&&r&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&i1(s)&&(c=B2(e))&&c.eq(We.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,Xo(e),this.currentSelection.set(s),e.scrollToSelection()):(i>-1||r)&&(i>-1&&(e.docView.markDirty(i,o),YRe(e)),this.handleDOMChange(i,o,a,l),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(s)||Xo(e),this.currentSelection.set(s))}registerMutation(e,n){if(n.indexOf(e.target)>-1)return null;let s=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(s==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!s||s.ignoreMutation(e))return null;if(e.type=="childList"){for(let u=0;u<e.addedNodes.length;u++){let d=e.addedNodes[u];n.push(d),d.nodeType==3&&(this.lastChangedTextNode=d)}if(s.contentDOM&&s.contentDOM!=s.dom&&!s.contentDOM.contains(e.target))return{from:s.posBefore,to:s.posAfter};let r=e.previousSibling,i=e.nextSibling;if(or&&Za<=11&&e.addedNodes.length)for(let u=0;u<e.addedNodes.length;u++){let{previousSibling:d,nextSibling:h}=e.addedNodes[u];(!d||Array.prototype.indexOf.call(e.addedNodes,d)<0)&&(r=d),(!h||Array.prototype.indexOf.call(e.addedNodes,h)<0)&&(i=h)}let o=r&&r.parentNode==e.target?Qn(r)+1:0,a=s.localPosFromDOM(e.target,o,-1),l=i&&i.parentNode==e.target?Qn(i):e.target.childNodes.length,c=s.localPosFromDOM(e.target,l,1);return{from:a,to:c}}else return e.type=="attributes"?{from:s.posAtStart-s.border,to:s.posAtEnd+s.border}:(this.lastChangedTextNode=e.target,{from:s.posAtStart,to:s.posAtEnd,typeOver:e.target.nodeValue==e.oldValue})}}let SP=new WeakMap,kP=!1;function YRe(t){if(!SP.has(t)&&(SP.set(t,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(t.dom).whiteSpace)!==-1)){if(t.requiresGeckoHackNode=ei,kP)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),kP=!0}}function CP(t,e){let n=e.startContainer,s=e.startOffset,r=e.endContainer,i=e.endOffset,o=t.domAtPos(t.state.selection.anchor);return jc(o.node,o.offset,r,i)&&([n,s,r,i]=[r,i,n,s]),{anchorNode:n,anchorOffset:s,focusNode:r,focusOffset:i}}function QRe(t,e){if(e.getComposedRanges){let r=e.getComposedRanges(t.root)[0];if(r)return CP(t,r)}let n;function s(r){r.preventDefault(),r.stopImmediatePropagation(),n=r.getTargetRanges()[0]}return t.dom.addEventListener("beforeinput",s,!0),document.execCommand("indent"),t.dom.removeEventListener("beforeinput",s,!0),n?CP(t,n):null}function ZRe(t,e){for(let n=e.parentNode;n&&n!=t.dom;n=n.parentNode){let s=t.docView.nearestDesc(n,!0);if(s&&s.node.isBlock)return n}return null}function eDe(t,e,n){let{node:s,fromOffset:r,toOffset:i,from:o,to:a}=t.docView.parseRange(e,n),l=t.domSelectionRange(),c,u=l.anchorNode;if(u&&t.dom.contains(u.nodeType==1?u:u.parentNode)&&(c=[{node:u,offset:l.anchorOffset}],i1(l)||c.push({node:l.focusNode,offset:l.focusOffset})),vs&&t.input.lastKeyCode===8)for(let g=i;g>r;g--){let y=s.childNodes[g-1],x=y.pmViewDesc;if(y.nodeName=="BR"&&!x){i=g;break}if(!x||x.size)break}let d=t.state.doc,h=t.someProp("domParser")||Qa.fromSchema(t.state.schema),f=d.resolve(o),p=null,m=h.parse(s,{topNode:f.parent,topMatch:f.parent.contentMatchAt(f.index()),topOpen:!0,from:r,to:i,preserveWhitespace:f.parent.type.whitespace=="pre"?"full":!0,findPositions:c,ruleFromNode:tDe,context:f});if(c&&c[0].pos!=null){let g=c[0].pos,y=c[1]&&c[1].pos;y==null&&(y=g),p={anchor:g+o,head:y+o}}return{doc:m,sel:p,from:o,to:a}}function tDe(t){let e=t.pmViewDesc;if(e)return e.parseRule();if(t.nodeName=="BR"&&t.parentNode){if(Vs&&/^(ul|ol)$/i.test(t.parentNode.nodeName)){let n=document.createElement("div");return n.appendChild(document.createElement("li")),{skip:n}}else if(t.parentNode.lastChild==t||Vs&&/^(tr|table)$/i.test(t.parentNode.nodeName))return{ignore:!0}}else if(t.nodeName=="IMG"&&t.getAttribute("mark-placeholder"))return{ignore:!0};return null}const nDe=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|img|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function sDe(t,e,n,s,r){let i=t.input.compositionPendingChanges||(t.composing?t.input.compositionID:0);if(t.input.compositionPendingChanges=0,e<0){let C=t.input.lastSelectionTime>Date.now()-50?t.input.lastSelectionOrigin:null,N=B2(t,C);if(N&&!t.state.selection.eq(N)){if(vs&&Wo&&t.input.lastKeyCode===13&&Date.now()-100<t.input.lastKeyCodeTime&&t.someProp("handleKeyDown",I=>I(t,ql(13,"Enter"))))return;let T=t.state.tr.setSelection(N);C=="pointer"?T.setMeta("pointer",!0):C=="key"&&T.scrollIntoView(),i&&T.setMeta("composition",i),t.dispatch(T)}return}let o=t.state.doc.resolve(e),a=o.sharedDepth(n);e=o.before(a+1),n=t.state.doc.resolve(n).after(a+1);let l=t.state.selection,c=eDe(t,e,n),u=t.state.doc,d=u.slice(c.from,c.to),h,f;t.input.lastKeyCode===8&&Date.now()-100<t.input.lastKeyCodeTime?(h=t.state.selection.to,f="end"):(h=t.state.selection.from,f="start"),t.input.lastKeyCode=null;let p=oDe(d.content,c.doc.content,c.from,h,f);if(p&&t.input.domChangeCount++,(Ld&&t.input.lastIOSEnter>Date.now()-225||Wo)&&r.some(C=>C.nodeType==1&&!nDe.test(C.nodeName))&&(!p||p.endA>=p.endB)&&t.someProp("handleKeyDown",C=>C(t,ql(13,"Enter")))){t.input.lastIOSEnter=0;return}if(!p)if(s&&l instanceof Le&&!l.empty&&l.$head.sameParent(l.$anchor)&&!t.composing&&!(c.sel&&c.sel.anchor!=c.sel.head))p={start:l.from,endA:l.to,endB:l.to};else{if(c.sel){let C=NP(t,t.state.doc,c.sel);if(C&&!C.eq(t.state.selection)){let N=t.state.tr.setSelection(C);i&&N.setMeta("composition",i),t.dispatch(N)}}return}t.state.selection.from<t.state.selection.to&&p.start==p.endB&&t.state.selection instanceof Le&&(p.start>t.state.selection.from&&p.start<=t.state.selection.from+2&&t.state.selection.from>=c.from?p.start=t.state.selection.from:p.endA<t.state.selection.to&&p.endA>=t.state.selection.to-2&&t.state.selection.to<=c.to&&(p.endB+=t.state.selection.to-p.endA,p.endA=t.state.selection.to)),or&&Za<=11&&p.endB==p.start+1&&p.endA==p.start&&p.start>c.from&&c.doc.textBetween(p.start-c.from-1,p.start-c.from+1)==" "&&(p.start--,p.endA--,p.endB--);let m=c.doc.resolveNoCache(p.start-c.from),g=c.doc.resolveNoCache(p.endB-c.from),y=u.resolve(p.start),x=m.sameParent(g)&&m.parent.inlineContent&&y.end()>=p.endA;if((Ld&&t.input.lastIOSEnter>Date.now()-225&&(!x||r.some(C=>C.nodeName=="DIV"||C.nodeName=="P"))||!x&&m.pos<c.doc.content.size&&(!m.sameParent(g)||!m.parent.inlineContent)&&m.pos<g.pos&&!/\S/.test(c.doc.textBetween(m.pos,g.pos,"","")))&&t.someProp("handleKeyDown",C=>C(t,ql(13,"Enter")))){t.input.lastIOSEnter=0;return}if(t.state.selection.anchor>p.start&&iDe(u,p.start,p.endA,m,g)&&t.someProp("handleKeyDown",C=>C(t,ql(8,"Backspace")))){Wo&&vs&&t.domObserver.suppressSelectionUpdates();return}vs&&p.endB==p.start&&(t.input.lastChromeDelete=Date.now()),Wo&&!x&&m.start()!=g.start()&&g.parentOffset==0&&m.depth==g.depth&&c.sel&&c.sel.anchor==c.sel.head&&c.sel.head==p.endA&&(p.endB-=2,g=c.doc.resolveNoCache(p.endB-c.from),setTimeout(()=>{t.someProp("handleKeyDown",function(C){return C(t,ql(13,"Enter"))})},20));let v=p.start,w=p.endA,S=C=>{let N=C||t.state.tr.replace(v,w,c.doc.slice(p.start-c.from,p.endB-c.from));if(c.sel){let T=NP(t,N.doc,c.sel);T&&!(vs&&t.composing&&T.empty&&(p.start!=p.endB||t.input.lastChromeDelete<Date.now()-100)&&(T.head==v||T.head==N.mapping.map(w)-1)||or&&T.empty&&T.head==v)&&N.setSelection(T)}return i&&N.setMeta("composition",i),N.scrollIntoView()},k;if(x)if(m.pos==g.pos){or&&Za<=11&&m.parentOffset==0&&(t.domObserver.suppressSelectionUpdates(),setTimeout(()=>Xo(t),20));let C=S(t.state.tr.delete(v,w)),N=u.resolve(p.start).marksAcross(u.resolve(p.endA));N&&C.ensureMarks(N),t.dispatch(C)}else if(p.endA==p.endB&&(k=rDe(m.parent.content.cut(m.parentOffset,g.parentOffset),y.parent.content.cut(y.parentOffset,p.endA-y.start())))){let C=S(t.state.tr);k.type=="add"?C.addMark(v,w,k.mark):C.removeMark(v,w,k.mark),t.dispatch(C)}else if(m.parent.child(m.index()).isText&&m.index()==g.index()-(g.textOffset?0:1)){let C=m.parent.textBetween(m.parentOffset,g.parentOffset),N=()=>S(t.state.tr.insertText(C,v,w));t.someProp("handleTextInput",T=>T(t,v,w,C,N))||t.dispatch(N())}else t.dispatch(S());else t.dispatch(S())}function NP(t,e,n){return Math.max(n.anchor,n.head)>e.content.size?null:j2(t,e.resolve(n.anchor),e.resolve(n.head))}function rDe(t,e){let n=t.firstChild.marks,s=e.firstChild.marks,r=n,i=s,o,a,l;for(let u=0;u<s.length;u++)r=s[u].removeFromSet(r);for(let u=0;u<n.length;u++)i=n[u].removeFromSet(i);if(r.length==1&&i.length==0)a=r[0],o="add",l=u=>u.mark(a.addToSet(u.marks));else if(r.length==0&&i.length==1)a=i[0],o="remove",l=u=>u.mark(a.removeFromSet(u.marks));else return null;let c=[];for(let u=0;u<e.childCount;u++)c.push(l(e.child(u)));if(se.from(c).eq(t))return{mark:a,type:o}}function iDe(t,e,n,s,r){if(n-e<=r.pos-s.pos||eS(s,!0,!1)<r.pos)return!1;let i=t.resolve(e);if(!s.parent.isTextblock){let a=i.nodeAfter;return a!=null&&n==e+a.nodeSize}if(i.parentOffset<i.parent.content.size||!i.parent.isTextblock)return!1;let o=t.resolve(eS(i,!0,!0));return!o.parent.isTextblock||o.pos>n||eS(o,!0,!1)<n?!1:s.parent.content.cut(s.parentOffset).eq(o.parent.content)}function eS(t,e,n){let s=t.depth,r=e?t.end():t.pos;for(;s>0&&(e||t.indexAfter(s)==t.node(s).childCount);)s--,r++,e=!1;if(n){let i=t.node(s).maybeChild(t.indexAfter(s));for(;i&&!i.isLeaf;)i=i.firstChild,r++}return r}function oDe(t,e,n,s,r){let i=t.findDiffStart(e,n);if(i==null)return null;let{a:o,b:a}=t.findDiffEnd(e,n+t.size,n+e.size);if(r=="end"){let l=Math.max(0,i-Math.min(o,a));s-=o+l-i}if(o<i&&t.size<e.size){let l=s<=i&&s>=o?i-s:0;i-=l,i&&i<e.size&&TP(e.textBetween(i-1,i+1))&&(i+=l?1:-1),a=i+(a-o),o=i}else if(a<i){let l=s<=i&&s>=a?i-s:0;i-=l,i&&i<t.size&&TP(t.textBetween(i-1,i+1))&&(i+=l?1:-1),o=i+(o-a),a=i}return{start:i,endA:o,endB:a}}function TP(t){if(t.length!=2)return!1;let e=t.charCodeAt(0),n=t.charCodeAt(1);return e>=56320&&e<=57343&&n>=55296&&n<=56319}class ZH{constructor(e,n){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new NRe,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=n,this.state=n.state,this.directPlugins=n.plugins||[],this.directPlugins.forEach(RP),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):typeof e=="function"?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=AP(this),IP(this),this.nodeViews=$P(this),this.docView=aP(this.state.doc,EP(this),Zw(this),this.dom,this),this.domObserver=new JRe(this,(s,r,i,o)=>sDe(this,s,r,i,o)),this.domObserver.start(),TRe(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let n in e)this._props[n]=e[n];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&KC(this);let n=this._props;this._props=e,e.plugins&&(e.plugins.forEach(RP),this.directPlugins=e.plugins),this.updateStateInner(e.state,n)}setProps(e){let n={};for(let s in this._props)n[s]=this._props[s];n.state=this.state;for(let s in e)n[s]=e[s];this.update(n)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,n){var s;let r=this.state,i=!1,o=!1;e.storedMarks&&this.composing&&(GH(this),o=!0),this.state=e;let a=r.plugins!=e.plugins||this._props.plugins!=n.plugins;if(a||this._props.plugins!=n.plugins||this._props.nodeViews!=n.nodeViews){let f=$P(this);lDe(f,this.nodeViews)&&(this.nodeViews=f,i=!0)}(a||n.handleDOMEvents!=this._props.handleDOMEvents)&&KC(this),this.editable=AP(this),IP(this);let l=Zw(this),c=EP(this),u=r.plugins!=e.plugins&&!r.doc.eq(e.doc)?"reset":e.scrollToSelection>r.scrollToSelection?"to selection":"preserve",d=i||!this.docView.matchesNode(e.doc,c,l);(d||!e.selection.eq(r.selection))&&(o=!0);let h=u=="preserve"&&o&&this.dom.style.overflowAnchor==null&&B$e(this);if(o){this.domObserver.stop();let f=d&&(or||vs)&&!this.composing&&!r.selection.empty&&!e.selection.empty&&aDe(r.selection,e.selection);if(d){let p=vs?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=zRe(this)),(i||!this.docView.update(e.doc,c,l,this))&&(this.docView.updateOuterDeco(c),this.docView.destroy(),this.docView=aP(e.doc,c,l,this.dom,this)),p&&!this.trackWrites&&(f=!0)}f||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&uRe(this))?Xo(this,f):(MH(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(r),!((s=this.dragging)===null||s===void 0)&&s.node&&!r.doc.eq(e.doc)&&this.updateDraggedNode(this.dragging,r),u=="reset"?this.dom.scrollTop=0:u=="to selection"?this.scrollToSelection():h&&j$e(h)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(!(!e||!this.dom.contains(e.nodeType==1?e:e.parentNode))){if(!this.someProp("handleScrollToSelection",n=>n(this)))if(this.state.selection instanceof Re){let n=this.docView.domAfterPos(this.state.selection.from);n.nodeType==1&&tP(this,n.getBoundingClientRect(),e)}else tP(this,this.coordsAtPos(this.state.selection.head,1),e)}}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let n=0;n<this.directPlugins.length;n++){let s=this.directPlugins[n];s.spec.view&&this.pluginViews.push(s.spec.view(this))}for(let n=0;n<this.state.plugins.length;n++){let s=this.state.plugins[n];s.spec.view&&this.pluginViews.push(s.spec.view(this))}}else for(let n=0;n<this.pluginViews.length;n++){let s=this.pluginViews[n];s.update&&s.update(this,e)}}updateDraggedNode(e,n){let s=e.node,r=-1;if(this.state.doc.nodeAt(s.from)==s.node)r=s.from;else{let i=s.from+(this.state.doc.content.size-n.doc.content.size);(i>0&&this.state.doc.nodeAt(i))==s.node&&(r=i)}this.dragging=new qH(e.slice,e.move,r<0?void 0:Re.create(this.state.doc,r))}someProp(e,n){let s=this._props&&this._props[e],r;if(s!=null&&(r=n?n(s):s))return r;for(let o=0;o<this.directPlugins.length;o++){let a=this.directPlugins[o].props[e];if(a!=null&&(r=n?n(a):a))return r}let i=this.state.plugins;if(i)for(let o=0;o<i.length;o++){let a=i[o].props[e];if(a!=null&&(r=n?n(a):a))return r}}hasFocus(){if(or){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if(e.contentEditable=="false")return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&V$e(this.dom),Xo(this),this.domObserver.start()}get root(){let e=this._root;if(e==null){for(let n=this.dom.parentNode;n;n=n.parentNode)if(n.nodeType==9||n.nodeType==11&&n.host)return n.getSelection||(Object.getPrototypeOf(n).getSelection=()=>n.ownerDocument.getSelection()),this._root=n}return e||document}updateRoot(){this._root=null}posAtCoords(e){return K$e(this,e)}coordsAtPos(e,n=1){return TH(this,e,n)}domAtPos(e,n=0){return this.docView.domFromPos(e,n)}nodeDOM(e){let n=this.docView.descAt(e);return n?n.nodeDOM:null}posAtDOM(e,n,s=-1){let r=this.docView.posFromDOM(e,n,s);if(r==null)throw new RangeError("DOM position not inside the editor");return r}endOfTextblock(e,n){return Q$e(this,n||this.state,e)}pasteHTML(e,n){return pp(this,"",e,!1,n||new ClipboardEvent("paste"))}pasteText(e,n){return pp(this,e,null,!0,n||new ClipboardEvent("paste"))}serializeForClipboard(e){return V2(this,e)}destroy(){this.docView&&(ERe(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],Zw(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,A$e())}get isDestroyed(){return this.docView==null}dispatchEvent(e){return ARe(this,e)}domSelectionRange(){let e=this.domSelection();return e?Vs&&this.root.nodeType===11&&M$e(this.dom.ownerDocument)==this.dom&&QRe(this,e)||e:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}ZH.prototype.dispatch=function(t){let e=this._props.dispatchTransaction;e?e.call(this,t):this.updateState(this.state.apply(t))};function EP(t){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(t.editable),t.someProp("attributes",n=>{if(typeof n=="function"&&(n=n(t.state)),n)for(let s in n)s=="class"?e.class+=" "+n[s]:s=="style"?e.style=(e.style?e.style+";":"")+n[s]:!e[s]&&s!="contenteditable"&&s!="nodeName"&&(e[s]=String(n[s]))}),e.translate||(e.translate="no"),[Ms.node(0,t.state.doc.content.size,e)]}function IP(t){if(t.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),t.cursorWrapper={dom:e,deco:Ms.widget(t.state.selection.from,e,{raw:!0,marks:t.markCursor})}}else t.cursorWrapper=null}function AP(t){return!t.someProp("editable",e=>e(t.state)===!1)}function aDe(t,e){let n=Math.min(t.$anchor.sharedDepth(t.head),e.$anchor.sharedDepth(e.head));return t.$anchor.start(n)!=e.$anchor.start(n)}function $P(t){let e=Object.create(null);function n(s){for(let r in s)Object.prototype.hasOwnProperty.call(e,r)||(e[r]=s[r])}return t.someProp("nodeViews",n),t.someProp("markViews",n),e}function lDe(t,e){let n=0,s=0;for(let r in t){if(t[r]!=e[r])return!0;n++}for(let r in e)s++;return n!=s}function RP(t){if(t.spec.state||t.spec.filterTransaction||t.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var hl={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},ux={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},cDe=typeof navigator<"u"&&/Mac/.test(navigator.platform),uDe=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var Zn=0;Zn<10;Zn++)hl[48+Zn]=hl[96+Zn]=String(Zn);for(var Zn=1;Zn<=24;Zn++)hl[Zn+111]="F"+Zn;for(var Zn=65;Zn<=90;Zn++)hl[Zn]=String.fromCharCode(Zn+32),ux[Zn]=String.fromCharCode(Zn);for(var tS in hl)ux.hasOwnProperty(tS)||(ux[tS]=hl[tS]);function dDe(t){var e=cDe&&t.metaKey&&t.shiftKey&&!t.ctrlKey&&!t.altKey||uDe&&t.shiftKey&&t.key&&t.key.length==1||t.key=="Unidentified",n=!e&&t.key||(t.shiftKey?ux:hl)[t.keyCode]||t.key||"Unidentified";return n=="Esc"&&(n="Escape"),n=="Del"&&(n="Delete"),n=="Left"&&(n="ArrowLeft"),n=="Up"&&(n="ArrowUp"),n=="Right"&&(n="ArrowRight"),n=="Down"&&(n="ArrowDown"),n}const hDe=typeof navigator<"u"&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),fDe=typeof navigator<"u"&&/Win/.test(navigator.platform);function pDe(t){let e=t.split(/-(?!$)/),n=e[e.length-1];n=="Space"&&(n=" ");let s,r,i,o;for(let a=0;a<e.length-1;a++){let l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))s=!0;else if(/^(c|ctrl|control)$/i.test(l))r=!0;else if(/^s(hift)?$/i.test(l))i=!0;else if(/^mod$/i.test(l))hDe?o=!0:r=!0;else throw new Error("Unrecognized modifier name: "+l)}return s&&(n="Alt-"+n),r&&(n="Ctrl-"+n),o&&(n="Meta-"+n),i&&(n="Shift-"+n),n}function mDe(t){let e=Object.create(null);for(let n in t)e[pDe(n)]=t[n];return e}function nS(t,e,n=!0){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),n&&e.shiftKey&&(t="Shift-"+t),t}function gDe(t){return new Gt({props:{handleKeyDown:eG(t)}})}function eG(t){let e=mDe(t);return function(n,s){let r=dDe(s),i,o=e[nS(r,s)];if(o&&o(n.state,n.dispatch,n))return!0;if(r.length==1&&r!=" "){if(s.shiftKey){let a=e[nS(r,s,!1)];if(a&&a(n.state,n.dispatch,n))return!0}if((s.altKey||s.metaKey||s.ctrlKey)&&!(fDe&&s.ctrlKey&&s.altKey)&&(i=hl[s.keyCode])&&i!=r){let a=e[nS(i,s)];if(a&&a(n.state,n.dispatch,n))return!0}}return!1}}var yDe=Object.defineProperty,q2=(t,e)=>{for(var n in e)yDe(t,n,{get:e[n],enumerable:!0})};function l1(t){const{state:e,transaction:n}=t;let{selection:s}=n,{doc:r}=n,{storedMarks:i}=n;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return i},get selection(){return s},get doc(){return r},get tr(){return s=n.selection,r=n.doc,i=n.storedMarks,n}}}var c1=class{constructor(t){this.editor=t.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=t.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:t,editor:e,state:n}=this,{view:s}=e,{tr:r}=n,i=this.buildProps(r);return Object.fromEntries(Object.entries(t).map(([o,a])=>[o,(...c)=>{const u=a(...c)(i);return!r.getMeta("preventDispatch")&&!this.hasCustomState&&s.dispatch(r),u}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(t,e=!0){const{rawCommands:n,editor:s,state:r}=this,{view:i}=s,o=[],a=!!t,l=t||r.tr,c=()=>(!a&&e&&!l.getMeta("preventDispatch")&&!this.hasCustomState&&i.dispatch(l),o.every(d=>d===!0)),u={...Object.fromEntries(Object.entries(n).map(([d,h])=>[d,(...p)=>{const m=this.buildProps(l,e),g=h(...p)(m);return o.push(g),u}])),run:c};return u}createCan(t){const{rawCommands:e,state:n}=this,s=!1,r=t||n.tr,i=this.buildProps(r,s);return{...Object.fromEntries(Object.entries(e).map(([a,l])=>[a,(...c)=>l(...c)({...i,dispatch:void 0})])),chain:()=>this.createChain(r,s)}}buildProps(t,e=!0){const{rawCommands:n,editor:s,state:r}=this,{view:i}=s,o={tr:t,editor:s,view:i,state:l1({state:r,transaction:t}),dispatch:e?()=>{}:void 0,chain:()=>this.createChain(t,e),can:()=>this.createCan(t),get commands(){return Object.fromEntries(Object.entries(n).map(([a,l])=>[a,(...c)=>l(...c)(o)]))}};return o}},tG={};q2(tG,{blur:()=>xDe,clearContent:()=>bDe,clearNodes:()=>vDe,command:()=>wDe,createParagraphNear:()=>SDe,cut:()=>kDe,deleteCurrentNode:()=>CDe,deleteNode:()=>NDe,deleteRange:()=>TDe,deleteSelection:()=>EDe,enter:()=>IDe,exitCode:()=>ADe,extendMarkRange:()=>$De,first:()=>RDe,focus:()=>ODe,forEach:()=>MDe,insertContent:()=>PDe,insertContentAt:()=>_De,joinBackward:()=>jDe,joinDown:()=>BDe,joinForward:()=>VDe,joinItemBackward:()=>UDe,joinItemForward:()=>WDe,joinTextblockBackward:()=>HDe,joinTextblockForward:()=>GDe,joinUp:()=>zDe,keyboardShortcut:()=>qDe,lift:()=>XDe,liftEmptyBlock:()=>JDe,liftListItem:()=>YDe,newlineInCode:()=>QDe,resetAttributes:()=>ZDe,scrollIntoView:()=>eOe,selectAll:()=>tOe,selectNodeBackward:()=>nOe,selectNodeForward:()=>sOe,selectParentNode:()=>rOe,selectTextblockEnd:()=>iOe,selectTextblockStart:()=>oOe,setContent:()=>aOe,setMark:()=>NOe,setMeta:()=>TOe,setNode:()=>EOe,setNodeSelection:()=>IOe,setTextDirection:()=>AOe,setTextSelection:()=>$Oe,sinkListItem:()=>ROe,splitBlock:()=>DOe,splitListItem:()=>OOe,toggleList:()=>MOe,toggleMark:()=>POe,toggleNode:()=>LOe,toggleWrap:()=>FOe,undoInputRule:()=>_Oe,unsetAllMarks:()=>zOe,unsetMark:()=>BOe,unsetTextDirection:()=>jOe,updateAttributes:()=>VOe,wrapIn:()=>UOe,wrapInList:()=>WOe});var xDe=()=>({editor:t,view:e})=>(requestAnimationFrame(()=>{var n;t.isDestroyed||(e.dom.blur(),(n=window==null?void 0:window.getSelection())==null||n.removeAllRanges())}),!0),bDe=(t=!0)=>({commands:e})=>e.setContent("",{emitUpdate:t}),vDe=()=>({state:t,tr:e,dispatch:n})=>{const{selection:s}=e,{ranges:r}=s;return n&&r.forEach(({$from:i,$to:o})=>{t.doc.nodesBetween(i.pos,o.pos,(a,l)=>{if(a.type.isText)return;const{doc:c,mapping:u}=e,d=c.resolve(u.map(l)),h=c.resolve(u.map(l+a.nodeSize)),f=d.blockRange(h);if(!f)return;const p=lh(f);if(a.type.isTextblock){const{defaultType:m}=d.parent.contentMatchAt(d.index());e.setNodeMarkup(f.start,m)}(p||p===0)&&e.lift(f,p)})}),!0},wDe=t=>e=>t(e),SDe=()=>({state:t,dispatch:e})=>m$e(t,e),kDe=(t,e)=>({editor:n,tr:s})=>{const{state:r}=n,i=r.doc.slice(t.from,t.to);s.deleteRange(t.from,t.to);const o=s.mapping.map(e);return s.insert(o,i.content),s.setSelection(new Le(s.doc.resolve(Math.max(o-1,0)))),!0},CDe=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,s=n.$anchor.node();if(s.content.size>0)return!1;const r=t.selection.$anchor;for(let i=r.depth;i>0;i-=1)if(r.node(i).type===s.type){if(e){const a=r.before(i),l=r.after(i);t.delete(a,l).scrollIntoView()}return!0}return!1};function Cn(t,e){if(typeof t=="string"){if(!e.nodes[t])throw Error(`There is no node type named '${t}'. Maybe you forgot to add the extension?`);return e.nodes[t]}return t}var NDe=t=>({tr:e,state:n,dispatch:s})=>{const r=Cn(t,n.schema),i=e.selection.$anchor;for(let o=i.depth;o>0;o-=1)if(i.node(o).type===r){if(s){const l=i.before(o),c=i.after(o);e.delete(l,c).scrollIntoView()}return!0}return!1},TDe=t=>({tr:e,dispatch:n})=>{const{from:s,to:r}=t;return n&&e.delete(s,r),!0},EDe=()=>({state:t,dispatch:e})=>s$e(t,e),IDe=()=>({commands:t})=>t.keyboardShortcut("Enter"),ADe=()=>({state:t,dispatch:e})=>p$e(t,e);function X2(t){return Object.prototype.toString.call(t)==="[object RegExp]"}function dx(t,e,n={strict:!0}){const s=Object.keys(e);return s.length?s.every(r=>n.strict?e[r]===t[r]:X2(e[r])?e[r].test(t[r]):e[r]===t[r]):!0}function nG(t,e,n={}){return t.find(s=>s.type===e&&dx(Object.fromEntries(Object.keys(n).map(r=>[r,s.attrs[r]])),n))}function DP(t,e,n={}){return!!nG(t,e,n)}function J2(t,e,n){var s;if(!t||!e)return;let r=t.parent.childAfter(t.parentOffset);if((!r.node||!r.node.marks.some(u=>u.type===e))&&(r=t.parent.childBefore(t.parentOffset)),!r.node||!r.node.marks.some(u=>u.type===e)||(n=n||((s=r.node.marks[0])==null?void 0:s.attrs),!nG([...r.node.marks],e,n)))return;let o=r.index,a=t.start()+r.offset,l=o+1,c=a+r.node.nodeSize;for(;o>0&&DP([...t.parent.child(o-1).marks],e,n);)o-=1,a-=t.parent.child(o).nodeSize;for(;l<t.parent.childCount&&DP([...t.parent.child(l).marks],e,n);)c+=t.parent.child(l).nodeSize,l+=1;return{from:a,to:c}}function da(t,e){if(typeof t=="string"){if(!e.marks[t])throw Error(`There is no mark type named '${t}'. Maybe you forgot to add the extension?`);return e.marks[t]}return t}var $De=(t,e={})=>({tr:n,state:s,dispatch:r})=>{const i=da(t,s.schema),{doc:o,selection:a}=n,{$from:l,from:c,to:u}=a;if(r){const d=J2(l,i,e);if(d&&d.from<=c&&d.to>=u){const h=Le.create(o,d.from,d.to);n.setSelection(h)}}return!0},RDe=t=>e=>{const n=typeof t=="function"?t(e):t;for(let s=0;s<n.length;s+=1)if(n[s](e))return!0;return!1};function sG(t){return t instanceof Le}function ic(t=0,e=0,n=0){return Math.min(Math.max(t,e),n)}function rG(t,e=null){if(!e)return null;const n=We.atStart(t),s=We.atEnd(t);if(e==="start"||e===!0)return n;if(e==="end")return s;const r=n.from,i=s.to;return e==="all"?Le.create(t,ic(0,r,i),ic(t.content.size,r,i)):Le.create(t,ic(e,r,i),ic(e,r,i))}function DDe(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function Y2(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}var ODe=(t=null,e={})=>({editor:n,view:s,tr:r,dispatch:i})=>{e={scrollIntoView:!0,...e};const o=()=>{(Y2()||DDe())&&s.dom.focus(),requestAnimationFrame(()=>{n.isDestroyed||(s.focus(),e!=null&&e.scrollIntoView&&n.commands.scrollIntoView())})};if(s.hasFocus()&&t===null||t===!1)return!0;if(i&&t===null&&!sG(n.state.selection))return o(),!0;const a=rG(r.doc,t)||n.state.selection,l=n.state.selection.eq(a);return i&&(l||r.setSelection(a),l&&r.storedMarks&&r.setStoredMarks(r.storedMarks),o()),!0},MDe=(t,e)=>n=>t.every((s,r)=>e(s,{...n,index:r})),PDe=(t,e)=>({tr:n,commands:s})=>s.insertContentAt({from:n.selection.from,to:n.selection.to},t,e),iG=t=>{const e=t.childNodes;for(let n=e.length-1;n>=0;n-=1){const s=e[n];s.nodeType===3&&s.nodeValue&&/^(\n\s\s|\n)$/.test(s.nodeValue)?t.removeChild(s):s.nodeType===1&&iG(s)}return t};function Jg(t){if(typeof window>"u")throw new Error("[tiptap error]: there is no window object available, so this function cannot be used");const e=`<body>${t}</body>`,n=new window.DOMParser().parseFromString(e,"text/html").body;return iG(n)}function gp(t,e,n){if(t instanceof $i||t instanceof se)return t;n={slice:!0,parseOptions:{},...n};const s=typeof t=="object"&&t!==null,r=typeof t=="string";if(s)try{if(Array.isArray(t)&&t.length>0)return se.fromArray(t.map(a=>e.nodeFromJSON(a)));const o=e.nodeFromJSON(t);return n.errorOnInvalidContent&&o.check(),o}catch(i){if(n.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:i});return console.warn("[tiptap warn]: Invalid content.","Passed value:",t,"Error:",i),gp("",e,n)}if(r){if(n.errorOnInvalidContent){let o=!1,a="";const l=new X5({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:c=>(o=!0,a=typeof c=="string"?c:c.outerHTML,null)}]}})});if(n.slice?Qa.fromSchema(l).parseSlice(Jg(t),n.parseOptions):Qa.fromSchema(l).parse(Jg(t),n.parseOptions),n.errorOnInvalidContent&&o)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${a}`)})}const i=Qa.fromSchema(e);return n.slice?i.parseSlice(Jg(t),n.parseOptions).content:i.parse(Jg(t),n.parseOptions)}return gp("",e,n)}function LDe(t,e,n){const s=t.steps.length-1;if(s<e)return;const r=t.steps[s];if(!(r instanceof _n||r instanceof Vn))return;const i=t.mapping.maps[s];let o=0;i.forEach((a,l,c,u)=>{o===0&&(o=u)}),t.setSelection(We.near(t.doc.resolve(o),n))}var FDe=t=>!("type"in t),_De=(t,e,n)=>({tr:s,dispatch:r,editor:i})=>{var o;if(r){n={parseOptions:i.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...n};let a;const l=g=>{i.emit("contentError",{editor:i,error:g,disableCollaboration:()=>{"collaboration"in i.storage&&typeof i.storage.collaboration=="object"&&i.storage.collaboration&&(i.storage.collaboration.isDisabled=!0)}})},c={preserveWhitespace:"full",...n.parseOptions};if(!n.errorOnInvalidContent&&!i.options.enableContentCheck&&i.options.emitContentError)try{gp(e,i.schema,{parseOptions:c,errorOnInvalidContent:!0})}catch(g){l(g)}try{a=gp(e,i.schema,{parseOptions:c,errorOnInvalidContent:(o=n.errorOnInvalidContent)!=null?o:i.options.enableContentCheck})}catch(g){return l(g),!1}let{from:u,to:d}=typeof t=="number"?{from:t,to:t}:{from:t.from,to:t.to},h=!0,f=!0;if((FDe(a)?a:[a]).forEach(g=>{g.check(),h=h?g.isText&&g.marks.length===0:!1,f=f?g.isBlock:!1}),u===d&&f){const{parent:g}=s.doc.resolve(u);g.isTextblock&&!g.type.spec.code&&!g.childCount&&(u-=1,d+=1)}let m;if(h){if(Array.isArray(e))m=e.map(g=>g.text||"").join("");else if(e instanceof se){let g="";e.forEach(y=>{y.text&&(g+=y.text)}),m=g}else typeof e=="object"&&e&&e.text?m=e.text:m=e;s.insertText(m,u,d)}else{m=a;const g=s.doc.resolve(u),y=g.node(),x=g.parentOffset===0,v=y.isText||y.isTextblock,w=y.content.size>0;x&&v&&w&&(u=Math.max(0,u-1)),s.replaceWith(u,d,m)}n.updateSelection&&LDe(s,s.steps.length-1,-1),n.applyInputRules&&s.setMeta("applyInputRules",{from:u,text:m}),n.applyPasteRules&&s.setMeta("applyPasteRules",{from:u,text:m})}return!0},zDe=()=>({state:t,dispatch:e})=>u$e(t,e),BDe=()=>({state:t,dispatch:e})=>d$e(t,e),jDe=()=>({state:t,dispatch:e})=>r$e(t,e),VDe=()=>({state:t,dispatch:e})=>l$e(t,e),UDe=()=>({state:t,dispatch:e,tr:n})=>{try{const s=n1(t.doc,t.selection.$from.pos,-1);return s==null?!1:(n.join(s,2),e&&e(n),!0)}catch{return!1}},WDe=()=>({state:t,dispatch:e,tr:n})=>{try{const s=n1(t.doc,t.selection.$from.pos,1);return s==null?!1:(n.join(s,2),e&&e(n),!0)}catch{return!1}},HDe=()=>({state:t,dispatch:e})=>i$e(t,e),GDe=()=>({state:t,dispatch:e})=>o$e(t,e);function oG(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function KDe(t){const e=t.split(/-(?!$)/);let n=e[e.length-1];n==="Space"&&(n=" ");let s,r,i,o;for(let a=0;a<e.length-1;a+=1){const l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))s=!0;else if(/^(c|ctrl|control)$/i.test(l))r=!0;else if(/^s(hift)?$/i.test(l))i=!0;else if(/^mod$/i.test(l))Y2()||oG()?o=!0:r=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return s&&(n=`Alt-${n}`),r&&(n=`Ctrl-${n}`),o&&(n=`Meta-${n}`),i&&(n=`Shift-${n}`),n}var qDe=t=>({editor:e,view:n,tr:s,dispatch:r})=>{const i=KDe(t).split(/-(?!$)/),o=i.find(c=>!["Alt","Ctrl","Meta","Shift"].includes(c)),a=new KeyboardEvent("keydown",{key:o==="Space"?" ":o,altKey:i.includes("Alt"),ctrlKey:i.includes("Ctrl"),metaKey:i.includes("Meta"),shiftKey:i.includes("Shift"),bubbles:!0,cancelable:!0}),l=e.captureTransaction(()=>{n.someProp("handleKeyDown",c=>c(n,a))});return l==null||l.steps.forEach(c=>{const u=c.map(s.mapping);u&&r&&s.maybeStep(u)}),!0};function fl(t,e,n={}){const{from:s,to:r,empty:i}=t.selection,o=e?Cn(e,t.schema):null,a=[];t.doc.nodesBetween(s,r,(d,h)=>{if(d.isText)return;const f=Math.max(s,h),p=Math.min(r,h+d.nodeSize);a.push({node:d,from:f,to:p})});const l=r-s,c=a.filter(d=>o?o.name===d.node.type.name:!0).filter(d=>dx(d.node.attrs,n,{strict:!1}));return i?!!c.length:c.reduce((d,h)=>d+h.to-h.from,0)>=l}var XDe=(t,e={})=>({state:n,dispatch:s})=>{const r=Cn(t,n.schema);return fl(n,r,e)?h$e(n,s):!1},JDe=()=>({state:t,dispatch:e})=>g$e(t,e),YDe=t=>({state:e,dispatch:n})=>{const s=Cn(t,e.schema);return N$e(s)(e,n)},QDe=()=>({state:t,dispatch:e})=>f$e(t,e);function u1(t,e){return e.nodes[t]?"node":e.marks[t]?"mark":null}function OP(t,e){const n=typeof e=="string"?[e]:e;return Object.keys(t).reduce((s,r)=>(n.includes(r)||(s[r]=t[r]),s),{})}var ZDe=(t,e)=>({tr:n,state:s,dispatch:r})=>{let i=null,o=null;const a=u1(typeof t=="string"?t:t.name,s.schema);if(!a)return!1;a==="node"&&(i=Cn(t,s.schema)),a==="mark"&&(o=da(t,s.schema));let l=!1;return n.selection.ranges.forEach(c=>{s.doc.nodesBetween(c.$from.pos,c.$to.pos,(u,d)=>{i&&i===u.type&&(l=!0,r&&n.setNodeMarkup(d,void 0,OP(u.attrs,e))),o&&u.marks.length&&u.marks.forEach(h=>{o===h.type&&(l=!0,r&&n.addMark(d,d+u.nodeSize,o.create(OP(h.attrs,e))))})})}),l},eOe=()=>({tr:t,dispatch:e})=>(e&&t.scrollIntoView(),!0),tOe=()=>({tr:t,dispatch:e})=>{if(e){const n=new Zr(t.doc);t.setSelection(n)}return!0},nOe=()=>({state:t,dispatch:e})=>a$e(t,e),sOe=()=>({state:t,dispatch:e})=>c$e(t,e),rOe=()=>({state:t,dispatch:e})=>y$e(t,e),iOe=()=>({state:t,dispatch:e})=>v$e(t,e),oOe=()=>({state:t,dispatch:e})=>b$e(t,e);function qC(t,e,n={},s={}){return gp(t,e,{slice:!1,parseOptions:n,errorOnInvalidContent:s.errorOnInvalidContent})}var aOe=(t,{errorOnInvalidContent:e,emitUpdate:n=!0,parseOptions:s={}}={})=>({editor:r,tr:i,dispatch:o,commands:a})=>{const{doc:l}=i;if(s.preserveWhitespace!=="full"){const c=qC(t,r.schema,s,{errorOnInvalidContent:e??r.options.enableContentCheck});return o&&i.replaceWith(0,l.content.size,c).setMeta("preventUpdate",!n),!0}return o&&i.setMeta("preventUpdate",!n),a.insertContentAt({from:0,to:l.content.size},t,{parseOptions:s,errorOnInvalidContent:e??r.options.enableContentCheck})};function aG(t,e){const n=da(e,t.schema),{from:s,to:r,empty:i}=t.selection,o=[];i?(t.storedMarks&&o.push(...t.storedMarks),o.push(...t.selection.$head.marks())):t.doc.nodesBetween(s,r,l=>{o.push(...l.marks)});const a=o.find(l=>l.type.name===n.name);return a?{...a.attrs}:{}}function lG(t,e){const n=new dH(t);return e.forEach(s=>{s.steps.forEach(r=>{n.step(r)})}),n}function lOe(t){for(let e=0;e<t.edgeCount;e+=1){const{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}function cOe(t,e,n){const s=[];return t.nodesBetween(e.from,e.to,(r,i)=>{n(r)&&s.push({node:r,pos:i})}),s}function uOe(t,e){for(let n=t.depth;n>0;n-=1){const s=t.node(n);if(e(s))return{pos:n>0?t.before(n):0,start:t.start(n),depth:n,node:s}}}function d1(t){return e=>uOe(e.$from,t)}function Ee(t,e,n){return t.config[e]===void 0&&t.parent?Ee(t.parent,e,n):typeof t.config[e]=="function"?t.config[e].bind({...n,parent:t.parent?Ee(t.parent,e,n):null}):t.config[e]}function Q2(t){return t.map(e=>{const n={name:e.name,options:e.options,storage:e.storage},s=Ee(e,"addExtensions",n);return s?[e,...Q2(s())]:e}).flat(10)}function Z2(t,e){const n=au.fromSchema(e).serializeFragment(t),r=document.implementation.createHTMLDocument().createElement("div");return r.appendChild(n),r.innerHTML}function cG(t){return typeof t=="function"}function pt(t,e=void 0,...n){return cG(t)?e?t.bind(e)(...n):t(...n):t}function dOe(t={}){return Object.keys(t).length===0&&t.constructor===Object}function Fd(t){const e=t.filter(r=>r.type==="extension"),n=t.filter(r=>r.type==="node"),s=t.filter(r=>r.type==="mark");return{baseExtensions:e,nodeExtensions:n,markExtensions:s}}function uG(t){const e=[],{nodeExtensions:n,markExtensions:s}=Fd(t),r=[...n,...s],i={default:null,validate:void 0,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return t.forEach(o=>{const a={name:o.name,options:o.options,storage:o.storage,extensions:r},l=Ee(o,"addGlobalAttributes",a);if(!l)return;l().forEach(u=>{u.types.forEach(d=>{Object.entries(u.attributes).forEach(([h,f])=>{e.push({type:d,name:h,attribute:{...i,...f}})})})})}),r.forEach(o=>{const a={name:o.name,options:o.options,storage:o.storage},l=Ee(o,"addAttributes",a);if(!l)return;const c=l();Object.entries(c).forEach(([u,d])=>{const h={...i,...d};typeof(h==null?void 0:h.default)=="function"&&(h.default=h.default()),h!=null&&h.isRequired&&(h==null?void 0:h.default)===void 0&&delete h.default,e.push({type:o.name,name:u,attribute:h})})}),e}function un(...t){return t.filter(e=>!!e).reduce((e,n)=>{const s={...e};return Object.entries(n).forEach(([r,i])=>{if(!s[r]){s[r]=i;return}if(r==="class"){const a=i?String(i).split(" "):[],l=s[r]?s[r].split(" "):[],c=a.filter(u=>!l.includes(u));s[r]=[...l,...c].join(" ")}else if(r==="style"){const a=i?i.split(";").map(u=>u.trim()).filter(Boolean):[],l=s[r]?s[r].split(";").map(u=>u.trim()).filter(Boolean):[],c=new Map;l.forEach(u=>{const[d,h]=u.split(":").map(f=>f.trim());c.set(d,h)}),a.forEach(u=>{const[d,h]=u.split(":").map(f=>f.trim());c.set(d,h)}),s[r]=Array.from(c.entries()).map(([u,d])=>`${u}: ${d}`).join("; ")}else s[r]=i}),s},{})}function hx(t,e){return e.filter(n=>n.type===t.type.name).filter(n=>n.attribute.rendered).map(n=>n.attribute.renderHTML?n.attribute.renderHTML(t.attrs)||{}:{[n.name]:t.attrs[n.name]}).reduce((n,s)=>un(n,s),{})}function hOe(t){return typeof t!="string"?t:t.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(t):t==="true"?!0:t==="false"?!1:t}function MP(t,e){return"style"in t?t:{...t,getAttrs:n=>{const s=t.getAttrs?t.getAttrs(n):t.attrs;if(s===!1)return!1;const r=e.reduce((i,o)=>{const a=o.attribute.parseHTML?o.attribute.parseHTML(n):hOe(n.getAttribute(o.name));return a==null?i:{...i,[o.name]:a}},{});return{...s,...r}}}}function PP(t){return Object.fromEntries(Object.entries(t).filter(([e,n])=>e==="attrs"&&dOe(n)?!1:n!=null))}function LP(t){var e,n;const s={};return!((e=t==null?void 0:t.attribute)!=null&&e.isRequired)&&"default"in((t==null?void 0:t.attribute)||{})&&(s.default=t.attribute.default),((n=t==null?void 0:t.attribute)==null?void 0:n.validate)!==void 0&&(s.validate=t.attribute.validate),[t.name,s]}function fOe(t,e){var n;const s=uG(t),{nodeExtensions:r,markExtensions:i}=Fd(t),o=(n=r.find(c=>Ee(c,"topNode")))==null?void 0:n.name,a=Object.fromEntries(r.map(c=>{const u=s.filter(y=>y.type===c.name),d={name:c.name,options:c.options,storage:c.storage,editor:e},h=t.reduce((y,x)=>{const v=Ee(x,"extendNodeSchema",d);return{...y,...v?v(c):{}}},{}),f=PP({...h,content:pt(Ee(c,"content",d)),marks:pt(Ee(c,"marks",d)),group:pt(Ee(c,"group",d)),inline:pt(Ee(c,"inline",d)),atom:pt(Ee(c,"atom",d)),selectable:pt(Ee(c,"selectable",d)),draggable:pt(Ee(c,"draggable",d)),code:pt(Ee(c,"code",d)),whitespace:pt(Ee(c,"whitespace",d)),linebreakReplacement:pt(Ee(c,"linebreakReplacement",d)),defining:pt(Ee(c,"defining",d)),isolating:pt(Ee(c,"isolating",d)),attrs:Object.fromEntries(u.map(LP))}),p=pt(Ee(c,"parseHTML",d));p&&(f.parseDOM=p.map(y=>MP(y,u)));const m=Ee(c,"renderHTML",d);m&&(f.toDOM=y=>m({node:y,HTMLAttributes:hx(y,u)}));const g=Ee(c,"renderText",d);return g&&(f.toText=g),[c.name,f]})),l=Object.fromEntries(i.map(c=>{const u=s.filter(g=>g.type===c.name),d={name:c.name,options:c.options,storage:c.storage,editor:e},h=t.reduce((g,y)=>{const x=Ee(y,"extendMarkSchema",d);return{...g,...x?x(c):{}}},{}),f=PP({...h,inclusive:pt(Ee(c,"inclusive",d)),excludes:pt(Ee(c,"excludes",d)),group:pt(Ee(c,"group",d)),spanning:pt(Ee(c,"spanning",d)),code:pt(Ee(c,"code",d)),attrs:Object.fromEntries(u.map(LP))}),p=pt(Ee(c,"parseHTML",d));p&&(f.parseDOM=p.map(g=>MP(g,u)));const m=Ee(c,"renderHTML",d);return m&&(f.toDOM=g=>m({mark:g,HTMLAttributes:hx(g,u)})),[c.name,f]}));return new X5({topNode:o,nodes:a,marks:l})}function pOe(t){const e=t.filter((n,s)=>t.indexOf(n)!==s);return Array.from(new Set(e))}function eA(t){return t.sort((n,s)=>{const r=Ee(n,"priority")||100,i=Ee(s,"priority")||100;return r>i?-1:r<i?1:0})}function dG(t){const e=eA(Q2(t)),n=pOe(e.map(s=>s.name));return n.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${n.map(s=>`'${s}'`).join(", ")}]. This can lead to issues.`),e}function hG(t,e,n){const{from:s,to:r}=e,{blockSeparator:i=`

`,textSerializers:o={}}=n||{};let a="";return t.nodesBetween(s,r,(l,c,u,d)=>{var h;l.isBlock&&c>s&&(a+=i);const f=o==null?void 0:o[l.type.name];if(f)return u&&(a+=f({node:l,pos:c,parent:u,index:d,range:e})),!1;l.isText&&(a+=(h=l==null?void 0:l.text)==null?void 0:h.slice(Math.max(s,c)-c,r-c))}),a}function mOe(t,e){const n={from:0,to:t.content.size};return hG(t,n,e)}function fG(t){return Object.fromEntries(Object.entries(t.nodes).filter(([,e])=>e.spec.toText).map(([e,n])=>[e,n.spec.toText]))}function gOe(t,e){const n=Cn(e,t.schema),{from:s,to:r}=t.selection,i=[];t.doc.nodesBetween(s,r,a=>{i.push(a)});const o=i.reverse().find(a=>a.type.name===n.name);return o?{...o.attrs}:{}}function pG(t,e){const n=u1(typeof e=="string"?e:e.name,t.schema);return n==="node"?gOe(t,e):n==="mark"?aG(t,e):{}}function yOe(t,e=JSON.stringify){const n={};return t.filter(s=>{const r=e(s);return Object.prototype.hasOwnProperty.call(n,r)?!1:n[r]=!0})}function xOe(t){const e=yOe(t);return e.length===1?e:e.filter((n,s)=>!e.filter((i,o)=>o!==s).some(i=>n.oldRange.from>=i.oldRange.from&&n.oldRange.to<=i.oldRange.to&&n.newRange.from>=i.newRange.from&&n.newRange.to<=i.newRange.to))}function mG(t){const{mapping:e,steps:n}=t,s=[];return e.maps.forEach((r,i)=>{const o=[];if(r.ranges.length)r.forEach((a,l)=>{o.push({from:a,to:l})});else{const{from:a,to:l}=n[i];if(a===void 0||l===void 0)return;o.push({from:a,to:l})}o.forEach(({from:a,to:l})=>{const c=e.slice(i).map(a,-1),u=e.slice(i).map(l),d=e.invert().map(c,-1),h=e.invert().map(u);s.push({oldRange:{from:d,to:h},newRange:{from:c,to:u}})})}),xOe(s)}function tA(t,e,n){const s=[];return t===e?n.resolve(t).marks().forEach(r=>{const i=n.resolve(t),o=J2(i,r.type);o&&s.push({mark:r,...o})}):n.nodesBetween(t,e,(r,i)=>{!r||(r==null?void 0:r.nodeSize)===void 0||s.push(...r.marks.map(o=>({from:i,to:i+r.nodeSize,mark:o})))}),s}var bOe=(t,e,n,s=20)=>{const r=t.doc.resolve(n);let i=s,o=null;for(;i>0&&o===null;){const a=r.node(i);(a==null?void 0:a.type.name)===e?o=a:i-=1}return[o,i]};function sS(t,e){return e.nodes[t]||e.marks[t]||null}function Ly(t,e,n){return Object.fromEntries(Object.entries(n).filter(([s])=>{const r=t.find(i=>i.type===e&&i.name===s);return r?r.attribute.keepOnSplit:!1}))}var vOe=(t,e=500)=>{let n="";const s=t.parentOffset;return t.parent.nodesBetween(Math.max(0,s-e),s,(r,i,o,a)=>{var l,c;const u=((c=(l=r.type.spec).toText)==null?void 0:c.call(l,{node:r,pos:i,parent:o,index:a}))||r.textContent||"%leaf%";n+=r.isAtom&&!r.isText?u:u.slice(0,Math.max(0,s-i))}),n};function XC(t,e,n={}){const{empty:s,ranges:r}=t.selection,i=e?da(e,t.schema):null;if(s)return!!(t.storedMarks||t.selection.$from.marks()).filter(d=>i?i.name===d.type.name:!0).find(d=>dx(d.attrs,n,{strict:!1}));let o=0;const a=[];if(r.forEach(({$from:d,$to:h})=>{const f=d.pos,p=h.pos;t.doc.nodesBetween(f,p,(m,g)=>{if(!m.isText&&!m.marks.length)return;const y=Math.max(f,g),x=Math.min(p,g+m.nodeSize),v=x-y;o+=v,a.push(...m.marks.map(w=>({mark:w,from:y,to:x})))})}),o===0)return!1;const l=a.filter(d=>i?i.name===d.mark.type.name:!0).filter(d=>dx(d.mark.attrs,n,{strict:!1})).reduce((d,h)=>d+h.to-h.from,0),c=a.filter(d=>i?d.mark.type!==i&&d.mark.type.excludes(i):!0).reduce((d,h)=>d+h.to-h.from,0);return(l>0?l+c:l)>=o}function wOe(t,e,n={}){if(!e)return fl(t,null,n)||XC(t,null,n);const s=u1(e,t.schema);return s==="node"?fl(t,e,n):s==="mark"?XC(t,e,n):!1}var SOe=(t,e)=>{const{$from:n,$to:s,$anchor:r}=t.selection;if(e){const i=d1(a=>a.type.name===e)(t.selection);if(!i)return!1;const o=t.doc.resolve(i.pos+1);return r.pos+1===o.end()}return!(s.parentOffset<s.parent.nodeSize-2||n.pos!==s.pos)},kOe=t=>{const{$from:e,$to:n}=t.selection;return!(e.parentOffset>0||e.pos!==n.pos)};function FP(t,e){return Array.isArray(e)?e.some(n=>(typeof n=="string"?n:n.name)===t.name):e}function _P(t,e){const{nodeExtensions:n}=Fd(e),s=n.find(o=>o.name===t);if(!s)return!1;const r={name:s.name,options:s.options,storage:s.storage},i=pt(Ee(s,"group",r));return typeof i!="string"?!1:i.split(" ").includes("list")}function h1(t,{checkChildren:e=!0,ignoreWhitespace:n=!1}={}){var s;if(n){if(t.type.name==="hardBreak")return!0;if(t.isText)return/^\s*$/m.test((s=t.text)!=null?s:"")}if(t.isText)return!t.text;if(t.isAtom||t.isLeaf)return!1;if(t.content.childCount===0)return!0;if(e){let r=!0;return t.content.forEach(i=>{r!==!1&&(h1(i,{ignoreWhitespace:n,checkChildren:e})||(r=!1))}),r}return!1}function gG(t){return t instanceof Re}function COe(t,e,n){var s;const{selection:r}=e;let i=null;if(sG(r)&&(i=r.$cursor),i){const a=(s=t.storedMarks)!=null?s:i.marks();return i.parent.type.allowsMarkType(n)&&(!!n.isInSet(a)||!a.some(c=>c.type.excludes(n)))}const{ranges:o}=r;return o.some(({$from:a,$to:l})=>{let c=a.depth===0?t.doc.inlineContent&&t.doc.type.allowsMarkType(n):!1;return t.doc.nodesBetween(a.pos,l.pos,(u,d,h)=>{if(c)return!1;if(u.isInline){const f=!h||h.type.allowsMarkType(n),p=!!n.isInSet(u.marks)||!u.marks.some(m=>m.type.excludes(n));c=f&&p}return!c}),c})}var NOe=(t,e={})=>({tr:n,state:s,dispatch:r})=>{const{selection:i}=n,{empty:o,ranges:a}=i,l=da(t,s.schema);if(r)if(o){const c=aG(s,l);n.addStoredMark(l.create({...c,...e}))}else a.forEach(c=>{const u=c.$from.pos,d=c.$to.pos;s.doc.nodesBetween(u,d,(h,f)=>{const p=Math.max(f,u),m=Math.min(f+h.nodeSize,d);h.marks.find(y=>y.type===l)?h.marks.forEach(y=>{l===y.type&&n.addMark(p,m,l.create({...y.attrs,...e}))}):n.addMark(p,m,l.create(e))})});return COe(s,n,l)},TOe=(t,e)=>({tr:n})=>(n.setMeta(t,e),!0),EOe=(t,e={})=>({state:n,dispatch:s,chain:r})=>{const i=Cn(t,n.schema);let o;return n.selection.$anchor.sameParent(n.selection.$head)&&(o=n.selection.$anchor.parent.attrs),i.isTextblock?r().command(({commands:a})=>QM(i,{...o,...e})(n)?!0:a.clearNodes()).command(({state:a})=>QM(i,{...o,...e})(a,s)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},IOe=t=>({tr:e,dispatch:n})=>{if(n){const{doc:s}=e,r=ic(t,0,s.content.size),i=Re.create(s,r);e.setSelection(i)}return!0},AOe=(t,e)=>({tr:n,state:s,dispatch:r})=>{const{selection:i}=s;let o,a;return typeof e=="number"?(o=e,a=e):e&&"from"in e&&"to"in e?(o=e.from,a=e.to):(o=i.from,a=i.to),r&&n.doc.nodesBetween(o,a,(l,c)=>{l.isText||n.setNodeMarkup(c,void 0,{...l.attrs,dir:t})}),!0},$Oe=t=>({tr:e,dispatch:n})=>{if(n){const{doc:s}=e,{from:r,to:i}=typeof t=="number"?{from:t,to:t}:t,o=Le.atStart(s).from,a=Le.atEnd(s).to,l=ic(r,o,a),c=ic(i,o,a),u=Le.create(s,l,c);e.setSelection(u)}return!0},ROe=t=>({state:e,dispatch:n})=>{const s=Cn(t,e.schema);return I$e(s)(e,n)};function zP(t,e){const n=t.storedMarks||t.selection.$to.parentOffset&&t.selection.$from.marks();if(n){const s=n.filter(r=>e==null?void 0:e.includes(r.type.name));t.tr.ensureMarks(s)}}var DOe=({keepMarks:t=!0}={})=>({tr:e,state:n,dispatch:s,editor:r})=>{const{selection:i,doc:o}=e,{$from:a,$to:l}=i,c=r.extensionManager.attributes,u=Ly(c,a.node().type.name,a.node().attrs);if(i instanceof Re&&i.node.isBlock)return!a.parentOffset||!od(o,a.pos)?!1:(s&&(t&&zP(n,r.extensionManager.splittableMarks),e.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;const d=l.parentOffset===l.parent.content.size,h=a.depth===0?void 0:lOe(a.node(-1).contentMatchAt(a.indexAfter(-1)));let f=d&&h?[{type:h,attrs:u}]:void 0,p=od(e.doc,e.mapping.map(a.pos),1,f);if(!f&&!p&&od(e.doc,e.mapping.map(a.pos),1,h?[{type:h}]:void 0)&&(p=!0,f=h?[{type:h,attrs:u}]:void 0),s){if(p&&(i instanceof Le&&e.deleteSelection(),e.split(e.mapping.map(a.pos),1,f),h&&!d&&!a.parentOffset&&a.parent.type!==h)){const m=e.mapping.map(a.before()),g=e.doc.resolve(m);a.node(-1).canReplaceWith(g.index(),g.index()+1,h)&&e.setNodeMarkup(e.mapping.map(a.before()),h)}t&&zP(n,r.extensionManager.splittableMarks),e.scrollIntoView()}return p},OOe=(t,e={})=>({tr:n,state:s,dispatch:r,editor:i})=>{var o;const a=Cn(t,s.schema),{$from:l,$to:c}=s.selection,u=s.selection.node;if(u&&u.isBlock||l.depth<2||!l.sameParent(c))return!1;const d=l.node(-1);if(d.type!==a)return!1;const h=i.extensionManager.attributes;if(l.parent.content.size===0&&l.node(-1).childCount===l.indexAfter(-1)){if(l.depth===2||l.node(-3).type!==a||l.index(-2)!==l.node(-2).childCount-1)return!1;if(r){let y=se.empty;const x=l.index(-1)?1:l.index(-2)?2:3;for(let N=l.depth-x;N>=l.depth-3;N-=1)y=se.from(l.node(N).copy(y));const v=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,w={...Ly(h,l.node().type.name,l.node().attrs),...e},S=((o=a.contentMatch.defaultType)==null?void 0:o.createAndFill(w))||void 0;y=y.append(se.from(a.createAndFill(null,S)||void 0));const k=l.before(l.depth-(x-1));n.replace(k,l.after(-v),new me(y,4-x,0));let C=-1;n.doc.nodesBetween(k,n.doc.content.size,(N,T)=>{if(C>-1)return!1;N.isTextblock&&N.content.size===0&&(C=T+1)}),C>-1&&n.setSelection(Le.near(n.doc.resolve(C))),n.scrollIntoView()}return!0}const f=c.pos===l.end()?d.contentMatchAt(0).defaultType:null,p={...Ly(h,d.type.name,d.attrs),...e},m={...Ly(h,l.node().type.name,l.node().attrs),...e};n.delete(l.pos,c.pos);const g=f?[{type:a,attrs:p},{type:f,attrs:m}]:[{type:a,attrs:p}];if(!od(n.doc,l.pos,2))return!1;if(r){const{selection:y,storedMarks:x}=s,{splittableMarks:v}=i.extensionManager,w=x||y.$to.parentOffset&&y.$from.marks();if(n.split(l.pos,2,g).scrollIntoView(),!w||!r)return!0;const S=w.filter(k=>v.includes(k.type.name));n.ensureMarks(S)}return!0},rS=(t,e)=>{const n=d1(o=>o.type===e)(t.selection);if(!n)return!0;const s=t.doc.resolve(Math.max(0,n.pos-1)).before(n.depth);if(s===void 0)return!0;const r=t.doc.nodeAt(s);return n.node.type===(r==null?void 0:r.type)&&$l(t.doc,n.pos)&&t.join(n.pos),!0},iS=(t,e)=>{const n=d1(o=>o.type===e)(t.selection);if(!n)return!0;const s=t.doc.resolve(n.start).after(n.depth);if(s===void 0)return!0;const r=t.doc.nodeAt(s);return n.node.type===(r==null?void 0:r.type)&&$l(t.doc,s)&&t.join(s),!0},MOe=(t,e,n,s={})=>({editor:r,tr:i,state:o,dispatch:a,chain:l,commands:c,can:u})=>{const{extensions:d,splittableMarks:h}=r.extensionManager,f=Cn(t,o.schema),p=Cn(e,o.schema),{selection:m,storedMarks:g}=o,{$from:y,$to:x}=m,v=y.blockRange(x),w=g||m.$to.parentOffset&&m.$from.marks();if(!v)return!1;const S=d1(k=>_P(k.type.name,d))(m);if(v.depth>=1&&S&&v.depth-S.depth<=1){if(S.node.type===f)return c.liftListItem(p);if(_P(S.node.type.name,d)&&f.validContent(S.node.content)&&a)return l().command(()=>(i.setNodeMarkup(S.pos,f),!0)).command(()=>rS(i,f)).command(()=>iS(i,f)).run()}return!n||!w||!a?l().command(()=>u().wrapInList(f,s)?!0:c.clearNodes()).wrapInList(f,s).command(()=>rS(i,f)).command(()=>iS(i,f)).run():l().command(()=>{const k=u().wrapInList(f,s),C=w.filter(N=>h.includes(N.type.name));return i.ensureMarks(C),k?!0:c.clearNodes()}).wrapInList(f,s).command(()=>rS(i,f)).command(()=>iS(i,f)).run()},POe=(t,e={},n={})=>({state:s,commands:r})=>{const{extendEmptyMarkRange:i=!1}=n,o=da(t,s.schema);return XC(s,o,e)?r.unsetMark(o,{extendEmptyMarkRange:i}):r.setMark(o,e)},LOe=(t,e,n={})=>({state:s,commands:r})=>{const i=Cn(t,s.schema),o=Cn(e,s.schema),a=fl(s,i,n);let l;return s.selection.$anchor.sameParent(s.selection.$head)&&(l=s.selection.$anchor.parent.attrs),a?r.setNode(o,l):r.setNode(i,{...l,...n})},FOe=(t,e={})=>({state:n,commands:s})=>{const r=Cn(t,n.schema);return fl(n,r,e)?s.lift(r):s.wrapIn(r,e)},_Oe=()=>({state:t,dispatch:e})=>{const n=t.plugins;for(let s=0;s<n.length;s+=1){const r=n[s];let i;if(r.spec.isInputRules&&(i=r.getState(t))){if(e){const o=t.tr,a=i.transform;for(let l=a.steps.length-1;l>=0;l-=1)o.step(a.steps[l].invert(a.docs[l]));if(i.text){const l=o.doc.resolve(i.from).marks();o.replaceWith(i.from,i.to,t.schema.text(i.text,l))}else o.delete(i.from,i.to)}return!0}}return!1},zOe=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,{empty:s,ranges:r}=n;return s||e&&r.forEach(i=>{t.removeMark(i.$from.pos,i.$to.pos)}),!0},BOe=(t,e={})=>({tr:n,state:s,dispatch:r})=>{var i;const{extendEmptyMarkRange:o=!1}=e,{selection:a}=n,l=da(t,s.schema),{$from:c,empty:u,ranges:d}=a;if(!r)return!0;if(u&&o){let{from:h,to:f}=a;const p=(i=c.marks().find(g=>g.type===l))==null?void 0:i.attrs,m=J2(c,l,p);m&&(h=m.from,f=m.to),n.removeMark(h,f,l)}else d.forEach(h=>{n.removeMark(h.$from.pos,h.$to.pos,l)});return n.removeStoredMark(l),!0},jOe=t=>({tr:e,state:n,dispatch:s})=>{const{selection:r}=n;let i,o;return typeof t=="number"?(i=t,o=t):t&&"from"in t&&"to"in t?(i=t.from,o=t.to):(i=r.from,o=r.to),s&&e.doc.nodesBetween(i,o,(a,l)=>{if(a.isText)return;const c={...a.attrs};delete c.dir,e.setNodeMarkup(l,void 0,c)}),!0},VOe=(t,e={})=>({tr:n,state:s,dispatch:r})=>{let i=null,o=null;const a=u1(typeof t=="string"?t:t.name,s.schema);if(!a)return!1;a==="node"&&(i=Cn(t,s.schema)),a==="mark"&&(o=da(t,s.schema));let l=!1;return n.selection.ranges.forEach(c=>{const u=c.$from.pos,d=c.$to.pos;let h,f,p,m;n.selection.empty?s.doc.nodesBetween(u,d,(g,y)=>{i&&i===g.type&&(l=!0,p=Math.max(y,u),m=Math.min(y+g.nodeSize,d),h=y,f=g)}):s.doc.nodesBetween(u,d,(g,y)=>{y<u&&i&&i===g.type&&(l=!0,p=Math.max(y,u),m=Math.min(y+g.nodeSize,d),h=y,f=g),y>=u&&y<=d&&(i&&i===g.type&&(l=!0,r&&n.setNodeMarkup(y,void 0,{...g.attrs,...e})),o&&g.marks.length&&g.marks.forEach(x=>{if(o===x.type&&(l=!0,r)){const v=Math.max(y,u),w=Math.min(y+g.nodeSize,d);n.addMark(v,w,o.create({...x.attrs,...e}))}}))}),f&&(h!==void 0&&r&&n.setNodeMarkup(h,void 0,{...f.attrs,...e}),o&&f.marks.length&&f.marks.forEach(g=>{o===g.type&&r&&n.addMark(p,m,o.create({...g.attrs,...e}))}))}),l},UOe=(t,e={})=>({state:n,dispatch:s})=>{const r=Cn(t,n.schema);return w$e(r,e)(n,s)},WOe=(t,e={})=>({state:n,dispatch:s})=>{const r=Cn(t,n.schema);return S$e(r,e)(n,s)},HOe=class{constructor(){this.callbacks={}}on(t,e){return this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(e),this}emit(t,...e){const n=this.callbacks[t];return n&&n.forEach(s=>s.apply(this,e)),this}off(t,e){const n=this.callbacks[t];return n&&(e?this.callbacks[t]=n.filter(s=>s!==e):delete this.callbacks[t]),this}once(t,e){const n=(...s)=>{this.off(t,n),e.apply(this,s)};return this.on(t,n)}removeAllListeners(){this.callbacks={}}},f1=class{constructor(t){var e;this.find=t.find,this.handler=t.handler,this.undoable=(e=t.undoable)!=null?e:!0}},GOe=(t,e)=>{if(X2(e))return e.exec(t);const n=e(t);if(!n)return null;const s=[n.text];return s.index=n.index,s.input=t,s.data=n.data,n.replaceWith&&(n.text.includes(n.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),s.push(n.replaceWith)),s};function Yg(t){var e;const{editor:n,from:s,to:r,text:i,rules:o,plugin:a}=t,{view:l}=n;if(l.composing)return!1;const c=l.state.doc.resolve(s);if(c.parent.type.spec.code||(e=c.nodeBefore||c.nodeAfter)!=null&&e.marks.find(h=>h.type.spec.code))return!1;let u=!1;const d=vOe(c)+i;return o.forEach(h=>{if(u)return;const f=GOe(d,h.find);if(!f)return;const p=l.state.tr,m=l1({state:l.state,transaction:p}),g={from:s-(f[0].length-i.length),to:r},{commands:y,chain:x,can:v}=new c1({editor:n,state:m});h.handler({state:m,range:g,match:f,commands:y,chain:x,can:v})===null||!p.steps.length||(h.undoable&&p.setMeta(a,{transform:p,from:s,to:r,text:i}),l.dispatch(p),u=!0)}),u}function KOe(t){const{editor:e,rules:n}=t,s=new Gt({state:{init(){return null},apply(r,i,o){const a=r.getMeta(s);if(a)return a;const l=r.getMeta("applyInputRules");return!!l&&setTimeout(()=>{let{text:u}=l;typeof u=="string"?u=u:u=Z2(se.from(u),o.schema);const{from:d}=l,h=d+u.length;Yg({editor:e,from:d,to:h,text:u,rules:n,plugin:s})}),r.selectionSet||r.docChanged?null:i}},props:{handleTextInput(r,i,o,a){return Yg({editor:e,from:i,to:o,text:a,rules:n,plugin:s})},handleDOMEvents:{compositionend:r=>(setTimeout(()=>{const{$cursor:i}=r.state.selection;i&&Yg({editor:e,from:i.pos,to:i.pos,text:"",rules:n,plugin:s})}),!1)},handleKeyDown(r,i){if(i.key!=="Enter")return!1;const{$cursor:o}=r.state.selection;return o?Yg({editor:e,from:o.pos,to:o.pos,text:`
`,rules:n,plugin:s}):!1}},isInputRules:!0});return s}function qOe(t){return Object.prototype.toString.call(t).slice(8,-1)}function Qg(t){return qOe(t)!=="Object"?!1:t.constructor===Object&&Object.getPrototypeOf(t)===Object.prototype}function yG(t,e){const n={...t};return Qg(t)&&Qg(e)&&Object.keys(e).forEach(s=>{Qg(e[s])&&Qg(t[s])?n[s]=yG(t[s],e[s]):n[s]=e[s]}),n}var nA=class{constructor(t={}){this.type="extendable",this.parent=null,this.child=null,this.name="",this.config={name:this.name},this.config={...this.config,...t},this.name=this.config.name}get options(){return{...pt(Ee(this,"addOptions",{name:this.name}))||{}}}get storage(){return{...pt(Ee(this,"addStorage",{name:this.name,options:this.options}))||{}}}configure(t={}){const e=this.extend({...this.config,addOptions:()=>yG(this.options,t)});return e.name=this.name,e.parent=this.parent,e}extend(t={}){const e=new this.constructor({...this.config,...t});return e.parent=this,this.child=e,e.name="name"in t?t.name:e.parent.name,e}},Dl=class xG extends nA{constructor(){super(...arguments),this.type="mark"}static create(e={}){const n=typeof e=="function"?e():e;return new xG(n)}static handleExit({editor:e,mark:n}){const{tr:s}=e.state,r=e.state.selection.$from;if(r.pos===r.end()){const o=r.marks();if(!!!o.find(c=>(c==null?void 0:c.type.name)===n.name))return!1;const l=o.find(c=>(c==null?void 0:c.type.name)===n.name);return l&&s.removeStoredMark(l),s.insertText(" ",r.pos),e.view.dispatch(s),!0}return!1}configure(e){return super.configure(e)}extend(e){const n=typeof e=="function"?e():e;return super.extend(n)}};function XOe(t){return typeof t=="number"}var JOe=class{constructor(t){this.find=t.find,this.handler=t.handler}},YOe=(t,e,n)=>{if(X2(e))return[...t.matchAll(e)];const s=e(t,n);return s?s.map(r=>{const i=[r.text];return i.index=r.index,i.input=t,i.data=r.data,r.replaceWith&&(r.text.includes(r.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),i.push(r.replaceWith)),i}):[]};function QOe(t){const{editor:e,state:n,from:s,to:r,rule:i,pasteEvent:o,dropEvent:a}=t,{commands:l,chain:c,can:u}=new c1({editor:e,state:n}),d=[];return n.doc.nodesBetween(s,r,(f,p)=>{var m,g,y,x,v;if((g=(m=f.type)==null?void 0:m.spec)!=null&&g.code||!(f.isText||f.isTextblock||f.isInline))return;const w=(v=(x=(y=f.content)==null?void 0:y.size)!=null?x:f.nodeSize)!=null?v:0,S=Math.max(s,p),k=Math.min(r,p+w);if(S>=k)return;const C=f.isText?f.text||"":f.textBetween(S-p,k-p,void 0,"");YOe(C,i.find,o).forEach(T=>{if(T.index===void 0)return;const I=S+T.index+1,D=I+T[0].length,F={from:n.tr.mapping.map(I),to:n.tr.mapping.map(D)},A=i.handler({state:n,range:F,match:T,commands:l,chain:c,can:u,pasteEvent:o,dropEvent:a});d.push(A)})}),d.every(f=>f!==null)}var Zg=null,ZOe=t=>{var e;const n=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(e=n.clipboardData)==null||e.setData("text/html",t),n};function eMe(t){const{editor:e,rules:n}=t;let s=null,r=!1,i=!1,o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,a;try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}const l=({state:u,from:d,to:h,rule:f,pasteEvt:p})=>{const m=u.tr,g=l1({state:u,transaction:m});if(!(!QOe({editor:e,state:g,from:Math.max(d-1,0),to:h.b-1,rule:f,pasteEvent:p,dropEvent:a})||!m.steps.length)){try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}return o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,m}};return n.map(u=>new Gt({view(d){const h=p=>{var m;s=(m=d.dom.parentElement)!=null&&m.contains(p.target)?d.dom.parentElement:null,s&&(Zg=e)},f=()=>{Zg&&(Zg=null)};return window.addEventListener("dragstart",h),window.addEventListener("dragend",f),{destroy(){window.removeEventListener("dragstart",h),window.removeEventListener("dragend",f)}}},props:{handleDOMEvents:{drop:(d,h)=>{if(i=s===d.dom.parentElement,a=h,!i){const f=Zg;f!=null&&f.isEditable&&setTimeout(()=>{const p=f.state.selection;p&&f.commands.deleteRange({from:p.from,to:p.to})},10)}return!1},paste:(d,h)=>{var f;const p=(f=h.clipboardData)==null?void 0:f.getData("text/html");return o=h,r=!!(p!=null&&p.includes("data-pm-slice")),!1}}},appendTransaction:(d,h,f)=>{const p=d[0],m=p.getMeta("uiEvent")==="paste"&&!r,g=p.getMeta("uiEvent")==="drop"&&!i,y=p.getMeta("applyPasteRules"),x=!!y;if(!m&&!g&&!x)return;if(x){let{text:S}=y;typeof S=="string"?S=S:S=Z2(se.from(S),f.schema);const{from:k}=y,C=k+S.length,N=ZOe(S);return l({rule:u,state:f,from:k,to:{b:C},pasteEvt:N})}const v=h.doc.content.findDiffStart(f.doc.content),w=h.doc.content.findDiffEnd(f.doc.content);if(!(!XOe(v)||!w||v===w.b))return l({rule:u,state:f,from:v,to:w,pasteEvt:o})}}))}var p1=class{constructor(t,e){this.splittableMarks=[],this.editor=e,this.baseExtensions=t,this.extensions=dG(t),this.schema=fOe(this.extensions,e),this.setupExtensions()}get commands(){return this.extensions.reduce((t,e)=>{const n={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:this.editor,type:sS(e.name,this.schema)},s=Ee(e,"addCommands",n);return s?{...t,...s()}:t},{})}get plugins(){const{editor:t}=this;return eA([...this.extensions].reverse()).flatMap(s=>{const r={name:s.name,options:s.options,storage:this.editor.extensionStorage[s.name],editor:t,type:sS(s.name,this.schema)},i=[],o=Ee(s,"addKeyboardShortcuts",r);let a={};if(s.type==="mark"&&Ee(s,"exitable",r)&&(a.ArrowRight=()=>Dl.handleExit({editor:t,mark:s})),o){const h=Object.fromEntries(Object.entries(o()).map(([f,p])=>[f,()=>p({editor:t})]));a={...a,...h}}const l=gDe(a);i.push(l);const c=Ee(s,"addInputRules",r);if(FP(s,t.options.enableInputRules)&&c){const h=c();if(h&&h.length){const f=KOe({editor:t,rules:h}),p=Array.isArray(f)?f:[f];i.push(...p)}}const u=Ee(s,"addPasteRules",r);if(FP(s,t.options.enablePasteRules)&&u){const h=u();if(h&&h.length){const f=eMe({editor:t,rules:h});i.push(...f)}}const d=Ee(s,"addProseMirrorPlugins",r);if(d){const h=d();i.push(...h)}return i})}get attributes(){return uG(this.extensions)}get nodeViews(){const{editor:t}=this,{nodeExtensions:e}=Fd(this.extensions);return Object.fromEntries(e.filter(n=>!!Ee(n,"addNodeView")).map(n=>{const s=this.attributes.filter(l=>l.type===n.name),r={name:n.name,options:n.options,storage:this.editor.extensionStorage[n.name],editor:t,type:Cn(n.name,this.schema)},i=Ee(n,"addNodeView",r);if(!i)return[];const o=i();if(!o)return[];const a=(l,c,u,d,h)=>{const f=hx(l,s);return o({node:l,view:c,getPos:u,decorations:d,innerDecorations:h,editor:t,extension:n,HTMLAttributes:f})};return[n.name,a]}))}get markViews(){const{editor:t}=this,{markExtensions:e}=Fd(this.extensions);return Object.fromEntries(e.filter(n=>!!Ee(n,"addMarkView")).map(n=>{const s=this.attributes.filter(a=>a.type===n.name),r={name:n.name,options:n.options,storage:this.editor.extensionStorage[n.name],editor:t,type:da(n.name,this.schema)},i=Ee(n,"addMarkView",r);if(!i)return[];const o=(a,l,c)=>{const u=hx(a,s);return i()({mark:a,view:l,inline:c,editor:t,extension:n,HTMLAttributes:u,updateAttributes:d=>{pMe(a,t,d)}})};return[n.name,o]}))}setupExtensions(){const t=this.extensions;this.editor.extensionStorage=Object.fromEntries(t.map(e=>[e.name,e.storage])),t.forEach(e=>{var n;const s={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:this.editor,type:sS(e.name,this.schema)};e.type==="mark"&&((n=pt(Ee(e,"keepOnSplit",s)))==null||n)&&this.splittableMarks.push(e.name);const r=Ee(e,"onBeforeCreate",s),i=Ee(e,"onCreate",s),o=Ee(e,"onUpdate",s),a=Ee(e,"onSelectionUpdate",s),l=Ee(e,"onTransaction",s),c=Ee(e,"onFocus",s),u=Ee(e,"onBlur",s),d=Ee(e,"onDestroy",s);r&&this.editor.on("beforeCreate",r),i&&this.editor.on("create",i),o&&this.editor.on("update",o),a&&this.editor.on("selectionUpdate",a),l&&this.editor.on("transaction",l),c&&this.editor.on("focus",c),u&&this.editor.on("blur",u),d&&this.editor.on("destroy",d)})}};p1.resolve=dG;p1.sort=eA;p1.flatten=Q2;var tMe={};q2(tMe,{ClipboardTextSerializer:()=>vG,Commands:()=>wG,Delete:()=>SG,Drop:()=>kG,Editable:()=>CG,FocusEvents:()=>TG,Keymap:()=>EG,Paste:()=>IG,Tabindex:()=>AG,TextDirection:()=>$G,focusEventsPluginKey:()=>NG});var bt=class bG extends nA{constructor(){super(...arguments),this.type="extension"}static create(e={}){const n=typeof e=="function"?e():e;return new bG(n)}configure(e){return super.configure(e)}extend(e){const n=typeof e=="function"?e():e;return super.extend(n)}},vG=bt.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new Gt({key:new On("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:t}=this,{state:e,schema:n}=t,{doc:s,selection:r}=e,{ranges:i}=r,o=Math.min(...i.map(u=>u.$from.pos)),a=Math.max(...i.map(u=>u.$to.pos)),l=fG(n);return hG(s,{from:o,to:a},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}}),wG=bt.create({name:"commands",addCommands(){return{...tG}}}),SG=bt.create({name:"delete",onUpdate({transaction:t,appendedTransactions:e}){var n,s,r;const i=()=>{var o,a,l,c;if((c=(l=(a=(o=this.editor.options.coreExtensionOptions)==null?void 0:o.delete)==null?void 0:a.filterTransaction)==null?void 0:l.call(a,t))!=null?c:t.getMeta("y-sync$"))return;const u=lG(t.before,[t,...e]);mG(u).forEach(f=>{u.mapping.mapResult(f.oldRange.from).deletedAfter&&u.mapping.mapResult(f.oldRange.to).deletedBefore&&u.before.nodesBetween(f.oldRange.from,f.oldRange.to,(p,m)=>{const g=m+p.nodeSize-2,y=f.oldRange.from<=m&&g<=f.oldRange.to;this.editor.emit("delete",{type:"node",node:p,from:m,to:g,newFrom:u.mapping.map(m),newTo:u.mapping.map(g),deletedRange:f.oldRange,newRange:f.newRange,partial:!y,editor:this.editor,transaction:t,combinedTransform:u})})});const h=u.mapping;u.steps.forEach((f,p)=>{var m,g;if(f instanceof ki){const y=h.slice(p).map(f.from,-1),x=h.slice(p).map(f.to),v=h.invert().map(y,-1),w=h.invert().map(x),S=(m=u.doc.nodeAt(y-1))==null?void 0:m.marks.some(C=>C.eq(f.mark)),k=(g=u.doc.nodeAt(x))==null?void 0:g.marks.some(C=>C.eq(f.mark));this.editor.emit("delete",{type:"mark",mark:f.mark,from:f.from,to:f.to,deletedRange:{from:v,to:w},newRange:{from:y,to:x},partial:!!(k||S),editor:this.editor,transaction:t,combinedTransform:u})}})};(r=(s=(n=this.editor.options.coreExtensionOptions)==null?void 0:n.delete)==null?void 0:s.async)==null||r?setTimeout(i,0):i()}}),kG=bt.create({name:"drop",addProseMirrorPlugins(){return[new Gt({key:new On("tiptapDrop"),props:{handleDrop:(t,e,n,s)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:n,moved:s})}}})]}}),CG=bt.create({name:"editable",addProseMirrorPlugins(){return[new Gt({key:new On("editable"),props:{editable:()=>this.editor.options.editable}})]}}),NG=new On("focusEvents"),TG=bt.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:t}=this;return[new Gt({key:NG,props:{handleDOMEvents:{focus:(e,n)=>{t.isFocused=!0;const s=t.state.tr.setMeta("focus",{event:n}).setMeta("addToHistory",!1);return e.dispatch(s),!1},blur:(e,n)=>{t.isFocused=!1;const s=t.state.tr.setMeta("blur",{event:n}).setMeta("addToHistory",!1);return e.dispatch(s),!1}}}})]}}),EG=bt.create({name:"keymap",addKeyboardShortcuts(){const t=()=>this.editor.commands.first(({commands:o})=>[()=>o.undoInputRule(),()=>o.command(({tr:a})=>{const{selection:l,doc:c}=a,{empty:u,$anchor:d}=l,{pos:h,parent:f}=d,p=d.parent.isTextblock&&h>0?a.doc.resolve(h-1):d,m=p.parent.type.spec.isolating,g=d.pos-d.parentOffset,y=m&&p.parent.childCount===1?g===d.pos:We.atStart(c).from===h;return!u||!f.type.isTextblock||f.textContent.length||!y||y&&d.parent.type.name==="paragraph"?!1:o.clearNodes()}),()=>o.deleteSelection(),()=>o.joinBackward(),()=>o.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:o})=>[()=>o.deleteSelection(),()=>o.deleteCurrentNode(),()=>o.joinForward(),()=>o.selectNodeForward()]),s={Enter:()=>this.editor.commands.first(({commands:o})=>[()=>o.newlineInCode(),()=>o.createParagraphNear(),()=>o.liftEmptyBlock(),()=>o.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:t,"Mod-Backspace":t,"Shift-Backspace":t,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},r={...s},i={...s,"Ctrl-h":t,"Alt-Backspace":t,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return Y2()||oG()?i:r},addProseMirrorPlugins(){return[new Gt({key:new On("clearDocument"),appendTransaction:(t,e,n)=>{if(t.some(m=>m.getMeta("composition")))return;const s=t.some(m=>m.docChanged)&&!e.doc.eq(n.doc),r=t.some(m=>m.getMeta("preventClearDocument"));if(!s||r)return;const{empty:i,from:o,to:a}=e.selection,l=We.atStart(e.doc).from,c=We.atEnd(e.doc).to;if(i||!(o===l&&a===c)||!h1(n.doc))return;const h=n.tr,f=l1({state:n,transaction:h}),{commands:p}=new c1({editor:this.editor,state:f});if(p.clearNodes(),!!h.steps.length)return h}})]}}),IG=bt.create({name:"paste",addProseMirrorPlugins(){return[new Gt({key:new On("tiptapPaste"),props:{handlePaste:(t,e,n)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:n})}}})]}}),AG=bt.create({name:"tabindex",addProseMirrorPlugins(){return[new Gt({key:new On("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}}),$G=bt.create({name:"textDirection",addOptions(){return{direction:void 0}},addGlobalAttributes(){if(!this.options.direction)return[];const{nodeExtensions:t}=Fd(this.extensions);return[{types:t.filter(e=>e.name!=="text").map(e=>e.name),attributes:{dir:{default:this.options.direction,parseHTML:e=>{const n=e.getAttribute("dir");return n&&(n==="ltr"||n==="rtl"||n==="auto")?n:this.options.direction},renderHTML:e=>e.dir?{dir:e.dir}:{}}}}]},addProseMirrorPlugins(){return[new Gt({key:new On("textDirection"),props:{attributes:()=>{const t=this.options.direction;return t?{dir:t}:{}}}})]}}),nMe=class Iu{constructor(e,n,s=!1,r=null){this.currentNode=null,this.actualDepth=null,this.isBlock=s,this.resolvedPos=e,this.editor=n,this.currentNode=r}get name(){return this.node.type.name}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var e;return(e=this.actualDepth)!=null?e:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(e){let n=this.from,s=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You cant set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}n=this.from+1,s=this.to-1}this.editor.commands.insertContentAt({from:n,to:s},e)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;const e=this.resolvedPos.start(this.resolvedPos.depth-1),n=this.resolvedPos.doc.resolve(e);return new Iu(n,this.editor)}get before(){let e=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.from-3)),new Iu(e,this.editor)}get after(){let e=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.to+3)),new Iu(e,this.editor)}get children(){const e=[];return this.node.content.forEach((n,s)=>{const r=n.isBlock&&!n.isTextblock,i=n.isAtom&&!n.isText,o=this.pos+s+(i?0:1);if(o<0||o>this.resolvedPos.doc.nodeSize-2)return;const a=this.resolvedPos.doc.resolve(o);if(!r&&a.depth<=this.depth)return;const l=new Iu(a,this.editor,r,r?n:null);r&&(l.actualDepth=this.depth+1),e.push(new Iu(a,this.editor,r,r?n:null))}),e}get firstChild(){return this.children[0]||null}get lastChild(){const e=this.children;return e[e.length-1]||null}closest(e,n={}){let s=null,r=this.parent;for(;r&&!s;){if(r.node.type.name===e)if(Object.keys(n).length>0){const i=r.node.attrs,o=Object.keys(n);for(let a=0;a<o.length;a+=1){const l=o[a];if(i[l]!==n[l])break}}else s=r;r=r.parent}return s}querySelector(e,n={}){return this.querySelectorAll(e,n,!0)[0]||null}querySelectorAll(e,n={},s=!1){let r=[];if(!this.children||this.children.length===0)return r;const i=Object.keys(n);return this.children.forEach(o=>{s&&r.length>0||(o.node.type.name===e&&i.every(l=>n[l]===o.node.attrs[l])&&r.push(o),!(s&&r.length>0)&&(r=r.concat(o.querySelectorAll(e,n,s))))}),r}setAttribute(e){const{tr:n}=this.editor.state;n.setNodeMarkup(this.from,void 0,{...this.node.attrs,...e}),this.editor.view.dispatch(n)}},sMe=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}`;function rMe(t,e,n){const s=document.querySelector(`style[data-tiptap-style${n?`-${n}`:""}]`);if(s!==null)return s;const r=document.createElement("style");return e&&r.setAttribute("nonce",e),r.setAttribute(`data-tiptap-style${n?`-${n}`:""}`,""),r.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(r),r}var iMe=class extends HOe{constructor(t={}){super(),this.css=null,this.className="tiptap",this.editorView=null,this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.instanceId=Math.random().toString(36).slice(2,9),this.options={element:typeof document<"u"?document.createElement("div"):null,content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,textDirection:void 0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:()=>null,onCreate:()=>null,onMount:()=>null,onUnmount:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:s})=>{throw s},onPaste:()=>null,onDrop:()=>null,onDelete:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(t),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("mount",this.options.onMount),this.on("unmount",this.options.onUnmount),this.on("contentError",this.options.onContentError),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:s,slice:r,moved:i})=>this.options.onDrop(s,r,i)),this.on("paste",({event:s,slice:r})=>this.options.onPaste(s,r)),this.on("delete",this.options.onDelete);const e=this.createDoc(),n=rG(e,this.options.autofocus);this.editorState=Ku.create({doc:e,schema:this.schema,selection:n||void 0}),this.options.element&&this.mount(this.options.element)}mount(t){if(typeof document>"u")throw new Error("[tiptap error]: The editor cannot be mounted because there is no 'document' defined in this environment.");this.createView(t),this.emit("mount",{editor:this}),this.css&&!document.head.contains(this.css)&&document.head.appendChild(this.css),window.setTimeout(()=>{this.isDestroyed||(this.options.autofocus!==!1&&this.options.autofocus!==null&&this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}unmount(){if(this.editorView){const t=this.editorView.dom;t!=null&&t.editor&&delete t.editor,this.editorView.destroy()}if(this.editorView=null,this.isInitialized=!1,this.css&&!document.querySelectorAll(`.${this.className}`).length)try{typeof this.css.remove=="function"?this.css.remove():this.css.parentNode&&this.css.parentNode.removeChild(this.css)}catch(t){console.warn("Failed to remove CSS element:",t)}this.css=null,this.emit("unmount",{editor:this})}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&typeof document<"u"&&(this.css=rMe(sMe,this.options.injectNonce))}setOptions(t={}){this.options={...this.options,...t},!(!this.editorView||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(t,e=!0){this.setOptions({editable:t}),e&&this.emit("update",{editor:this,transaction:this.state.tr,appendedTransactions:[]})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get view(){return this.editorView?this.editorView:new Proxy({state:this.editorState,updateState:t=>{this.editorState=t},dispatch:t=>{this.dispatchTransaction(t)},composing:!1,dragging:null,editable:!0,isDestroyed:!1},{get:(t,e)=>{if(this.editorView)return this.editorView[e];if(e==="state")return this.editorState;if(e in t)return Reflect.get(t,e);throw new Error(`[tiptap error]: The editor view is not available. Cannot access view['${e}']. The editor may not be mounted yet.`)}})}get state(){return this.editorView&&(this.editorState=this.view.state),this.editorState}registerPlugin(t,e){const n=cG(e)?e(t,[...this.state.plugins]):[...this.state.plugins,t],s=this.state.reconfigure({plugins:n});return this.view.updateState(s),s}unregisterPlugin(t){if(this.isDestroyed)return;const e=this.state.plugins;let n=e;if([].concat(t).forEach(r=>{const i=typeof r=="string"?`${r}$`:r.key;n=n.filter(o=>!o.key.startsWith(i))}),e.length===n.length)return;const s=this.state.reconfigure({plugins:n});return this.view.updateState(s),s}createExtensionManager(){var t,e;const s=[...this.options.enableCoreExtensions?[CG,vG.configure({blockSeparator:(e=(t=this.options.coreExtensionOptions)==null?void 0:t.clipboardTextSerializer)==null?void 0:e.blockSeparator}),wG,TG,EG,AG,kG,IG,SG,$G.configure({direction:this.options.textDirection})].filter(r=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[r.name]!==!1:!0):[],...this.options.extensions].filter(r=>["extension","node","mark"].includes(r==null?void 0:r.type));this.extensionManager=new p1(s,this)}createCommandManager(){this.commandManager=new c1({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createDoc(){let t;try{t=qC(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(e){if(!(e instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(e.message))throw e;this.emit("contentError",{editor:this,error:e,disableCollaboration:()=>{"collaboration"in this.storage&&typeof this.storage.collaboration=="object"&&this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(n=>n.name!=="collaboration"),this.createExtensionManager()}}),t=qC(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}return t}createView(t){var e;this.editorView=new ZH(t,{...this.options.editorProps,attributes:{role:"textbox",...(e=this.options.editorProps)==null?void 0:e.attributes},dispatchTransaction:this.dispatchTransaction.bind(this),state:this.editorState,markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews});const n=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(n),this.prependClass(),this.injectCSS();const s=this.view.dom;s.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`${this.className} ${this.view.dom.className}`}captureTransaction(t){this.isCapturingTransaction=!0,t(),this.isCapturingTransaction=!1;const e=this.capturedTransaction;return this.capturedTransaction=null,e}dispatchTransaction(t){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=t;return}t.steps.forEach(c=>{var u;return(u=this.capturedTransaction)==null?void 0:u.step(c)});return}const{state:e,transactions:n}=this.state.applyTransaction(t),s=!this.state.selection.eq(e.selection),r=n.includes(t),i=this.state;if(this.emit("beforeTransaction",{editor:this,transaction:t,nextState:e}),!r)return;this.view.updateState(e),this.emit("transaction",{editor:this,transaction:t,appendedTransactions:n.slice(1)}),s&&this.emit("selectionUpdate",{editor:this,transaction:t});const o=n.findLast(c=>c.getMeta("focus")||c.getMeta("blur")),a=o==null?void 0:o.getMeta("focus"),l=o==null?void 0:o.getMeta("blur");a&&this.emit("focus",{editor:this,event:a.event,transaction:o}),l&&this.emit("blur",{editor:this,event:l.event,transaction:o}),!(t.getMeta("preventUpdate")||!n.some(c=>c.docChanged)||i.doc.eq(e.doc))&&this.emit("update",{editor:this,transaction:t,appendedTransactions:n.slice(1)})}getAttributes(t){return pG(this.state,t)}isActive(t,e){const n=typeof t=="string"?t:null,s=typeof t=="string"?e:t;return wOe(this.state,n,s)}getJSON(){return this.state.doc.toJSON()}getHTML(){return Z2(this.state.doc.content,this.schema)}getText(t){const{blockSeparator:e=`

`,textSerializers:n={}}=t||{};return mOe(this.state.doc,{blockSeparator:e,textSerializers:{...fG(this.schema),...n}})}get isEmpty(){return h1(this.state.doc)}destroy(){this.emit("destroy"),this.unmount(),this.removeAllListeners()}get isDestroyed(){var t,e;return(e=(t=this.editorView)==null?void 0:t.isDestroyed)!=null?e:!0}$node(t,e){var n;return((n=this.$doc)==null?void 0:n.querySelector(t,e))||null}$nodes(t,e){var n;return((n=this.$doc)==null?void 0:n.querySelectorAll(t,e))||null}$pos(t){const e=this.state.doc.resolve(t);return new nMe(e,this)}get $doc(){return this.$pos(0)}};function _d(t){return new f1({find:t.find,handler:({state:e,range:n,match:s})=>{const r=pt(t.getAttributes,void 0,s);if(r===!1||r===null)return null;const{tr:i}=e,o=s[s.length-1],a=s[0];if(o){const l=a.search(/\S/),c=n.from+a.indexOf(o),u=c+o.length;if(tA(n.from,n.to,e.doc).filter(f=>f.mark.type.excluded.find(m=>m===t.type&&m!==f.mark.type)).filter(f=>f.to>c).length)return null;u<n.to&&i.delete(u,n.to),c>n.from&&i.delete(n.from+l,c);const h=n.from+l+o.length;i.addMark(n.from+l,h,t.type.create(r||{})),i.removeStoredMark(t.type)}},undoable:t.undoable})}function oMe(t){return new f1({find:t.find,handler:({state:e,range:n,match:s})=>{const r=pt(t.getAttributes,void 0,s)||{},{tr:i}=e,o=n.from;let a=n.to;const l=t.type.create(r);if(s[1]){const c=s[0].lastIndexOf(s[1]);let u=o+c;u>a?u=a:a=u+s[1].length;const d=s[0][s[0].length-1];i.insertText(d,o+s[0].length-1),i.replaceWith(u,a,l)}else if(s[0]){const c=t.type.isInline?o:o-1;i.insert(c,t.type.create(r)).delete(i.mapping.map(o),i.mapping.map(a))}i.scrollIntoView()},undoable:t.undoable})}function JC(t){return new f1({find:t.find,handler:({state:e,range:n,match:s})=>{const r=e.doc.resolve(n.from),i=pt(t.getAttributes,void 0,s)||{};if(!r.node(-1).canReplaceWith(r.index(-1),r.indexAfter(-1),t.type))return null;e.tr.delete(n.from,n.to).setBlockType(n.from,n.from,t.type,i)},undoable:t.undoable})}function zd(t){return new f1({find:t.find,handler:({state:e,range:n,match:s,chain:r})=>{const i=pt(t.getAttributes,void 0,s)||{},o=e.tr.delete(n.from,n.to),l=o.doc.resolve(n.from).blockRange(),c=l&&P2(l,t.type,i);if(!c)return null;if(o.wrap(l,c),t.keepMarks&&t.editor){const{selection:d,storedMarks:h}=e,{splittableMarks:f}=t.editor.extensionManager,p=h||d.$to.parentOffset&&d.$from.marks();if(p){const m=p.filter(g=>f.includes(g.type.name));o.ensureMarks(m)}}if(t.keepAttributes){const d=t.type.name==="bulletList"||t.type.name==="orderedList"?"listItem":"taskList";r().updateAttributes(d,i).run()}const u=o.doc.resolve(n.from-1).nodeBefore;u&&u.type===t.type&&$l(o.doc,n.from-1)&&(!t.joinPredicate||t.joinPredicate(s,u))&&o.join(n.from-1)},undoable:t.undoable})}function aMe(t,e){const{selection:n}=t,{$from:s}=n;if(n instanceof Re){const i=s.index();return s.parent.canReplaceWith(i,i+1,e)}let r=s.depth;for(;r>=0;){const i=s.index(r);if(s.node(r).contentMatchAt(i).matchType(e))return!0;r-=1}return!1}var lMe={};q2(lMe,{createAtomBlockMarkdownSpec:()=>cMe,createBlockMarkdownSpec:()=>uMe,createInlineMarkdownSpec:()=>fMe,parseAttributes:()=>sA,parseIndentedBlocks:()=>YC,renderNestedMarkdownContent:()=>iA,serializeAttributes:()=>rA});function sA(t){if(!(t!=null&&t.trim()))return{};const e={},n=[],s=t.replace(/["']([^"']*)["']/g,c=>(n.push(c),`__QUOTED_${n.length-1}__`)),r=s.match(/(?:^|\s)\.([a-zA-Z][\w-]*)/g);if(r){const c=r.map(u=>u.trim().slice(1));e.class=c.join(" ")}const i=s.match(/(?:^|\s)#([a-zA-Z][\w-]*)/);i&&(e.id=i[1]);const o=/([a-zA-Z][\w-]*)\s*=\s*(__QUOTED_\d+__)/g;Array.from(s.matchAll(o)).forEach(([,c,u])=>{var d;const h=parseInt(((d=u.match(/__QUOTED_(\d+)__/))==null?void 0:d[1])||"0",10),f=n[h];f&&(e[c]=f.slice(1,-1))});const l=s.replace(/(?:^|\s)\.([a-zA-Z][\w-]*)/g,"").replace(/(?:^|\s)#([a-zA-Z][\w-]*)/g,"").replace(/([a-zA-Z][\w-]*)\s*=\s*__QUOTED_\d+__/g,"").trim();return l&&l.split(/\s+/).filter(Boolean).forEach(u=>{u.match(/^[a-zA-Z][\w-]*$/)&&(e[u]=!0)}),e}function rA(t){if(!t||Object.keys(t).length===0)return"";const e=[];return t.class&&String(t.class).split(/\s+/).filter(Boolean).forEach(s=>e.push(`.${s}`)),t.id&&e.push(`#${t.id}`),Object.entries(t).forEach(([n,s])=>{n==="class"||n==="id"||(s===!0?e.push(n):s!==!1&&s!=null&&e.push(`${n}="${String(s)}"`))}),e.join(" ")}function cMe(t){const{nodeName:e,name:n,parseAttributes:s=sA,serializeAttributes:r=rA,defaultAttributes:i={},requiredAttributes:o=[],allowedAttributes:a}=t,l=n||e,c=u=>{if(!a)return u;const d={};return a.forEach(h=>{h in u&&(d[h]=u[h])}),d};return{parseMarkdown:(u,d)=>{const h={...i,...u.attributes};return d.createNode(e,h,[])},markdownTokenizer:{name:e,level:"block",start(u){var d;const h=new RegExp(`^:::${l}(?:\\s|$)`,"m"),f=(d=u.match(h))==null?void 0:d.index;return f!==void 0?f:-1},tokenize(u,d,h){const f=new RegExp(`^:::${l}(?:\\s+\\{([^}]*)\\})?\\s*:::(?:\\n|$)`),p=u.match(f);if(!p)return;const m=p[1]||"",g=s(m);if(!o.find(x=>!(x in g)))return{type:e,raw:p[0],attributes:g}}},renderMarkdown:u=>{const d=c(u.attrs||{}),h=r(d),f=h?` {${h}}`:"";return`:::${l}${f} :::`}}}function uMe(t){const{nodeName:e,name:n,getContent:s,parseAttributes:r=sA,serializeAttributes:i=rA,defaultAttributes:o={},content:a="block",allowedAttributes:l}=t,c=n||e,u=d=>{if(!l)return d;const h={};return l.forEach(f=>{f in d&&(h[f]=d[f])}),h};return{parseMarkdown:(d,h)=>{let f;if(s){const m=s(d);f=typeof m=="string"?[{type:"text",text:m}]:m}else a==="block"?f=h.parseChildren(d.tokens||[]):f=h.parseInline(d.tokens||[]);const p={...o,...d.attributes};return h.createNode(e,p,f)},markdownTokenizer:{name:e,level:"block",start(d){var h;const f=new RegExp(`^:::${c}`,"m"),p=(h=d.match(f))==null?void 0:h.index;return p!==void 0?p:-1},tokenize(d,h,f){var p;const m=new RegExp(`^:::${c}(?:\\s+\\{([^}]*)\\})?\\s*\\n`),g=d.match(m);if(!g)return;const[y,x=""]=g,v=r(x);let w=1;const S=y.length;let k="";const C=/^:::([\w-]*)(\s.*)?/gm,N=d.slice(S);for(C.lastIndex=0;;){const T=C.exec(N);if(T===null)break;const I=T.index,D=T[1];if(!((p=T[2])!=null&&p.endsWith(":::"))){if(D)w+=1;else if(w-=1,w===0){const F=N.slice(0,I);k=F.trim();const A=d.slice(0,S+I+T[0].length);let O=[];if(k)if(a==="block")for(O=f.blockTokens(F),O.forEach(P=>{P.text&&(!P.tokens||P.tokens.length===0)&&(P.tokens=f.inlineTokens(P.text))});O.length>0;){const P=O[O.length-1];if(P.type==="paragraph"&&(!P.text||P.text.trim()===""))O.pop();else break}else O=f.inlineTokens(k);return{type:e,raw:A,attributes:v,content:k,tokens:O}}}}}},renderMarkdown:(d,h)=>{const f=u(d.attrs||{}),p=i(f),m=p?` {${p}}`:"",g=h.renderChildren(d.content||[],`

`);return`:::${c}${m}

${g}

:::`}}}function dMe(t){if(!t.trim())return{};const e={},n=/(\w+)=(?:"([^"]*)"|'([^']*)')/g;let s=n.exec(t);for(;s!==null;){const[,r,i,o]=s;e[r]=i||o,s=n.exec(t)}return e}function hMe(t){return Object.entries(t).filter(([,e])=>e!=null).map(([e,n])=>`${e}="${n}"`).join(" ")}function fMe(t){const{nodeName:e,name:n,getContent:s,parseAttributes:r=dMe,serializeAttributes:i=hMe,defaultAttributes:o={},selfClosing:a=!1,allowedAttributes:l}=t,c=n||e,u=h=>{if(!l)return h;const f={};return l.forEach(p=>{p in h&&(f[p]=h[p])}),f},d=c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return{parseMarkdown:(h,f)=>{const p={...o,...h.attributes};if(a)return f.createNode(e,p);const m=s?s(h):h.content||"";return m?f.createNode(e,p,[f.createTextNode(m)]):f.createNode(e,p,[])},markdownTokenizer:{name:e,level:"inline",start(h){const f=a?new RegExp(`\\[${d}\\s*[^\\]]*\\]`):new RegExp(`\\[${d}\\s*[^\\]]*\\][\\s\\S]*?\\[\\/${d}\\]`),p=h.match(f),m=p==null?void 0:p.index;return m!==void 0?m:-1},tokenize(h,f,p){const m=a?new RegExp(`^\\[${d}\\s*([^\\]]*)\\]`):new RegExp(`^\\[${d}\\s*([^\\]]*)\\]([\\s\\S]*?)\\[\\/${d}\\]`),g=h.match(m);if(!g)return;let y="",x="";if(a){const[,w]=g;x=w}else{const[,w,S]=g;x=w,y=S||""}const v=r(x.trim());return{type:e,raw:g[0],content:y.trim(),attributes:v}}},renderMarkdown:h=>{let f="";s?f=s(h):h.content&&h.content.length>0&&(f=h.content.filter(y=>y.type==="text").map(y=>y.text).join(""));const p=u(h.attrs||{}),m=i(p),g=m?` ${m}`:"";return a?`[${c}${g}]`:`[${c}${g}]${f}[/${c}]`}}}function YC(t,e,n){var s,r,i,o;const a=t.split(`
`),l=[];let c="",u=0;const d=e.baseIndentSize||2;for(;u<a.length;){const h=a[u],f=h.match(e.itemPattern);if(!f){if(l.length>0)break;if(h.trim()===""){u+=1,c=`${c}${h}
`;continue}else return}const p=e.extractItemData(f),{indentLevel:m,mainContent:g}=p;c=`${c}${h}
`;const y=[g];for(u+=1;u<a.length;){const S=a[u];if(S.trim()===""){const C=a.slice(u+1).findIndex(I=>I.trim()!=="");if(C===-1)break;if((((r=(s=a[u+1+C].match(/^(\s*)/))==null?void 0:s[1])==null?void 0:r.length)||0)>m){y.push(S),c=`${c}${S}
`,u+=1;continue}else break}if((((o=(i=S.match(/^(\s*)/))==null?void 0:i[1])==null?void 0:o.length)||0)>m)y.push(S),c=`${c}${S}
`,u+=1;else break}let x;const v=y.slice(1);if(v.length>0){const S=v.map(k=>k.slice(m+d)).join(`
`);S.trim()&&(e.customNestedParser?x=e.customNestedParser(S):x=n.blockTokens(S))}const w=e.createToken(p,x);l.push(w)}if(l.length!==0)return{items:l,raw:c}}function iA(t,e,n,s){if(!t||!Array.isArray(t.content))return"";const r=typeof n=="function"?n(s):n,[i,...o]=t.content,a=e.renderChildren([i]),l=[`${r}${a}`];return o&&o.length>0&&o.forEach(c=>{const u=e.renderChildren([c]);if(u){const d=u.split(`
`).map(h=>h?e.indent(h):"").join(`
`);l.push(d)}}),l.join(`
`)}function pMe(t,e,n={}){const{state:s}=e,{doc:r,tr:i}=s,o=t;r.descendants((a,l)=>{const c=i.mapping.map(l),u=i.mapping.map(l)+a.nodeSize;let d=null;if(a.marks.forEach(f=>{if(f!==o)return!1;d=f}),!d)return;let h=!1;if(Object.keys(n).forEach(f=>{n[f]!==d.attrs[f]&&(h=!0)}),h){const f=t.type.create({...t.attrs,...n});i.removeMark(c,u,t.type),i.addMark(c,u,f)}}),i.docChanged&&e.view.dispatch(i)}var $r=class RG extends nA{constructor(){super(...arguments),this.type="node"}static create(e={}){const n=typeof e=="function"?e():e;return new RG(n)}configure(e){return super.configure(e)}extend(e){const n=typeof e=="function"?e():e;return super.extend(n)}};function Uc(t){return new JOe({find:t.find,handler:({state:e,range:n,match:s,pasteEvent:r})=>{const i=pt(t.getAttributes,void 0,s,r);if(i===!1||i===null)return null;const{tr:o}=e,a=s[s.length-1],l=s[0];let c=n.to;if(a){const u=l.search(/\S/),d=n.from+l.indexOf(a),h=d+a.length;if(tA(n.from,n.to,e.doc).filter(p=>p.mark.type.excluded.find(g=>g===t.type&&g!==p.mark.type)).filter(p=>p.to>d).length)return null;h<n.to&&o.delete(h,n.to),d>n.from&&o.delete(n.from+u,d),c=n.from+u+a.length,o.addMark(n.from+u,c,t.type.create(i||{})),o.removeStoredMark(t.type)}}})}var mMe=function t(e,n){if(e===n)return!0;if(e&&n&&typeof e=="object"&&typeof n=="object"){if(e.constructor!==n.constructor)return!1;var s,r,i;if(Array.isArray(e)){if(s=e.length,s!=n.length)return!1;for(r=s;r--!==0;)if(!t(e[r],n[r]))return!1;return!0}if(e instanceof Map&&n instanceof Map){if(e.size!==n.size)return!1;for(r of e.entries())if(!n.has(r[0]))return!1;for(r of e.entries())if(!t(r[1],n.get(r[0])))return!1;return!0}if(e instanceof Set&&n instanceof Set){if(e.size!==n.size)return!1;for(r of e.entries())if(!n.has(r[0]))return!1;return!0}if(ArrayBuffer.isView(e)&&ArrayBuffer.isView(n)){if(s=e.length,s!=n.length)return!1;for(r=s;r--!==0;)if(e[r]!==n[r])return!1;return!0}if(e.constructor===RegExp)return e.source===n.source&&e.flags===n.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===n.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===n.toString();if(i=Object.keys(e),s=i.length,s!==Object.keys(n).length)return!1;for(r=s;r--!==0;)if(!Object.prototype.hasOwnProperty.call(n,i[r]))return!1;for(r=s;r--!==0;){var o=i[r];if(!(o==="_owner"&&e.$$typeof)&&!t(e[o],n[o]))return!1}return!0}return e!==e&&n!==n};const gMe=bp(mMe);var yMe=(...t)=>e=>{t.forEach(n=>{typeof n=="function"?n(e):n&&(n.current=e)})},xMe=({contentComponent:t})=>{const e=iT.useSyncExternalStore(t.subscribe,t.getSnapshot,t.getServerSnapshot);return b.jsx(b.Fragment,{children:Object.values(e)})};function bMe(){const t=new Set;let e={};return{subscribe(n){return t.add(n),()=>{t.delete(n)}},getSnapshot(){return e},getServerSnapshot(){return e},setRenderer(n,s){e={...e,[n]:W8.createPortal(s.reactElement,s.element,n)},t.forEach(r=>r())},removeRenderer(n){const s={...e};delete s[n],e=s,t.forEach(r=>r())}}}var vMe=class extends Fs.Component{constructor(t){var e;super(t),this.editorContentRef=Fs.createRef(),this.initialized=!1,this.state={hasContentComponentInitialized:!!((e=t.editor)!=null&&e.contentComponent)}}componentDidMount(){this.init()}componentDidUpdate(){this.init()}init(){const t=this.props.editor;if(t&&!t.isDestroyed&&t.options.element){if(t.contentComponent)return;const e=this.editorContentRef.current;e.append(t.view.dom),t.setOptions({element:e}),t.contentComponent=bMe(),this.state.hasContentComponentInitialized||(this.unsubscribeToContentComponent=t.contentComponent.subscribe(()=>{this.setState(n=>n.hasContentComponentInitialized?n:{hasContentComponentInitialized:!0}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent()})),t.createNodeViews(),this.initialized=!0}}componentWillUnmount(){var t;const e=this.props.editor;if(e){this.initialized=!1,e.isDestroyed||e.view.setProps({nodeViews:{}}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent(),e.contentComponent=null;try{if(!((t=e.view.dom)!=null&&t.firstChild))return;const n=document.createElement("div");n.append(e.view.dom),e.setOptions({element:n})}catch{}}}render(){const{editor:t,innerRef:e,...n}=this.props;return b.jsxs(b.Fragment,{children:[b.jsx("div",{ref:yMe(e,this.editorContentRef),...n}),(t==null?void 0:t.contentComponent)&&b.jsx(xMe,{contentComponent:t.contentComponent})]})}},wMe=z.forwardRef((t,e)=>{const n=Fs.useMemo(()=>Math.floor(Math.random()*4294967295).toString(),[t.editor]);return Fs.createElement(vMe,{key:n,innerRef:e,...t})}),SMe=Fs.memo(wMe),kMe=typeof window<"u"?z.useLayoutEffect:z.useEffect,CMe=class{constructor(t){this.transactionNumber=0,this.lastTransactionNumber=0,this.subscribers=new Set,this.editor=t,this.lastSnapshot={editor:t,transactionNumber:0},this.getSnapshot=this.getSnapshot.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.watch=this.watch.bind(this),this.subscribe=this.subscribe.bind(this)}getSnapshot(){return this.transactionNumber===this.lastTransactionNumber?this.lastSnapshot:(this.lastTransactionNumber=this.transactionNumber,this.lastSnapshot={editor:this.editor,transactionNumber:this.transactionNumber},this.lastSnapshot)}getServerSnapshot(){return{editor:null,transactionNumber:0}}subscribe(t){return this.subscribers.add(t),()=>{this.subscribers.delete(t)}}watch(t){if(this.editor=t,this.editor){const e=()=>{this.transactionNumber+=1,this.subscribers.forEach(s=>s())},n=this.editor;return n.on("transaction",e),()=>{n.off("transaction",e)}}}};function NMe(t){var e;const[n]=z.useState(()=>new CMe(t.editor)),s=b_.useSyncExternalStoreWithSelector(n.subscribe,n.getSnapshot,n.getServerSnapshot,t.selector,(e=t.equalityFn)!=null?e:gMe);return kMe(()=>n.watch(t.editor),[t.editor,n]),z.useDebugValue(s),s}var TMe=!1,QC=typeof window>"u",EMe=QC||!!(typeof window<"u"&&window.next),IMe=class DG{constructor(e){this.editor=null,this.subscriptions=new Set,this.isComponentMounted=!1,this.previousDeps=null,this.instanceId="",this.options=e,this.subscriptions=new Set,this.setEditor(this.getInitialEditor()),this.scheduleDestroy(),this.getEditor=this.getEditor.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.subscribe=this.subscribe.bind(this),this.refreshEditorInstance=this.refreshEditorInstance.bind(this),this.scheduleDestroy=this.scheduleDestroy.bind(this),this.onRender=this.onRender.bind(this),this.createEditor=this.createEditor.bind(this)}setEditor(e){this.editor=e,this.instanceId=Math.random().toString(36).slice(2,9),this.subscriptions.forEach(n=>n())}getInitialEditor(){if(this.options.current.immediatelyRender===void 0)return QC||EMe?null:this.createEditor();if(this.options.current.immediatelyRender&&QC&&TMe)throw new Error("Tiptap Error: SSR has been detected, and `immediatelyRender` has been set to `true` this is an unsupported configuration that may result in errors, explicitly set `immediatelyRender` to `false` to avoid hydration mismatches.");return this.options.current.immediatelyRender?this.createEditor():null}createEditor(){const e={...this.options.current,onBeforeCreate:(...s)=>{var r,i;return(i=(r=this.options.current).onBeforeCreate)==null?void 0:i.call(r,...s)},onBlur:(...s)=>{var r,i;return(i=(r=this.options.current).onBlur)==null?void 0:i.call(r,...s)},onCreate:(...s)=>{var r,i;return(i=(r=this.options.current).onCreate)==null?void 0:i.call(r,...s)},onDestroy:(...s)=>{var r,i;return(i=(r=this.options.current).onDestroy)==null?void 0:i.call(r,...s)},onFocus:(...s)=>{var r,i;return(i=(r=this.options.current).onFocus)==null?void 0:i.call(r,...s)},onSelectionUpdate:(...s)=>{var r,i;return(i=(r=this.options.current).onSelectionUpdate)==null?void 0:i.call(r,...s)},onTransaction:(...s)=>{var r,i;return(i=(r=this.options.current).onTransaction)==null?void 0:i.call(r,...s)},onUpdate:(...s)=>{var r,i;return(i=(r=this.options.current).onUpdate)==null?void 0:i.call(r,...s)},onContentError:(...s)=>{var r,i;return(i=(r=this.options.current).onContentError)==null?void 0:i.call(r,...s)},onDrop:(...s)=>{var r,i;return(i=(r=this.options.current).onDrop)==null?void 0:i.call(r,...s)},onPaste:(...s)=>{var r,i;return(i=(r=this.options.current).onPaste)==null?void 0:i.call(r,...s)},onDelete:(...s)=>{var r,i;return(i=(r=this.options.current).onDelete)==null?void 0:i.call(r,...s)}};return new iMe(e)}getEditor(){return this.editor}getServerSnapshot(){return null}subscribe(e){return this.subscriptions.add(e),()=>{this.subscriptions.delete(e)}}static compareOptions(e,n){return Object.keys(e).every(s=>["onCreate","onBeforeCreate","onDestroy","onUpdate","onTransaction","onFocus","onBlur","onSelectionUpdate","onContentError","onDrop","onPaste"].includes(s)?!0:s==="extensions"&&e.extensions&&n.extensions?e.extensions.length!==n.extensions.length?!1:e.extensions.every((r,i)=>{var o;return r===((o=n.extensions)==null?void 0:o[i])}):e[s]===n[s])}onRender(e){return()=>(this.isComponentMounted=!0,clearTimeout(this.scheduledDestructionTimeout),this.editor&&!this.editor.isDestroyed&&e.length===0?DG.compareOptions(this.options.current,this.editor.options)||this.editor.setOptions({...this.options.current,editable:this.editor.isEditable}):this.refreshEditorInstance(e),()=>{this.isComponentMounted=!1,this.scheduleDestroy()})}refreshEditorInstance(e){if(this.editor&&!this.editor.isDestroyed){if(this.previousDeps===null){this.previousDeps=e;return}if(this.previousDeps.length===e.length&&this.previousDeps.every((s,r)=>s===e[r]))return}this.editor&&!this.editor.isDestroyed&&this.editor.destroy(),this.setEditor(this.createEditor()),this.previousDeps=e}scheduleDestroy(){const e=this.instanceId,n=this.editor;this.scheduledDestructionTimeout=setTimeout(()=>{if(this.isComponentMounted&&this.instanceId===e){n&&n.setOptions(this.options.current);return}n&&!n.isDestroyed&&(n.destroy(),this.instanceId===e&&this.setEditor(null))},1)}};function AMe(t={},e=[]){const n=z.useRef(t);n.current=t;const[s]=z.useState(()=>new IMe(n)),r=iT.useSyncExternalStore(s.subscribe,s.getEditor,s.getServerSnapshot);return z.useDebugValue(r),z.useEffect(s.onRender(e)),NMe({editor:r,selector:({transactionNumber:i})=>t.shouldRerenderOnTransaction===!1||t.shouldRerenderOnTransaction===void 0?null:t.immediatelyRender&&i===0?0:i+1}),r}var $Me=z.createContext({editor:null});$Me.Consumer;var RMe=z.createContext({onDragStart:()=>{},nodeViewContentChildren:void 0,nodeViewContentRef:()=>{}}),DMe=()=>z.useContext(RMe);Fs.forwardRef((t,e)=>{const{onDragStart:n}=DMe(),s=t.as||"div";return b.jsx(s,{...t,ref:e,"data-node-view-wrapper":"",onDragStart:n,style:{whiteSpace:"normal",...t.style}})});Fs.createContext({markViewContentRef:()=>{}});var fx=(t,e)=>{if(t==="slot")return 0;if(t instanceof Function)return t(e);const{children:n,...s}=e??{};if(t==="svg")throw new Error("SVG elements are not supported in the JSX syntax, use the array syntax instead");return[t,s,n]},OMe=/^\s*>\s$/,MMe=$r.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:t}){return fx("blockquote",{...un(this.options.HTMLAttributes,t),children:fx("slot",{})})},parseMarkdown:(t,e)=>e.createNode("blockquote",void 0,e.parseChildren(t.tokens||[])),renderMarkdown:(t,e)=>{if(!t.content)return"";const n=">",s=[];return t.content.forEach(r=>{const a=e.renderChildren([r]).split(`
`).map(l=>l.trim()===""?n:`${n} ${l}`);s.push(a.join(`
`))}),s.join(`
${n}
`)},addCommands(){return{setBlockquote:()=>({commands:t})=>t.wrapIn(this.name),toggleBlockquote:()=>({commands:t})=>t.toggleWrap(this.name),unsetBlockquote:()=>({commands:t})=>t.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[zd({find:OMe,type:this.type})]}}),PMe=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,LMe=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,FMe=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,_Me=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,zMe=Dl.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:t=>t.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:t=>t.type.name===this.name},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}]},renderHTML({HTMLAttributes:t}){return fx("strong",{...un(this.options.HTMLAttributes,t),children:fx("slot",{})})},markdownTokenName:"strong",parseMarkdown:(t,e)=>e.applyMark("bold",e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>`**${e.renderChildren(t)}**`,addCommands(){return{setBold:()=>({commands:t})=>t.setMark(this.name),toggleBold:()=>({commands:t})=>t.toggleMark(this.name),unsetBold:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[_d({find:PMe,type:this.type}),_d({find:FMe,type:this.type})]},addPasteRules(){return[Uc({find:LMe,type:this.type}),Uc({find:_Me,type:this.type})]}}),BMe=/(^|[^`])`([^`]+)`(?!`)$/,jMe=/(^|[^`])`([^`]+)`(?!`)/g,VMe=Dl.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:t}){return["code",un(this.options.HTMLAttributes,t),0]},markdownTokenName:"codespan",parseMarkdown:(t,e)=>e.applyMark("code",[{type:"text",text:t.text||""}]),renderMarkdown:(t,e)=>t.content?`\`${e.renderChildren(t.content)}\``:"",addCommands(){return{setCode:()=>({commands:t})=>t.setMark(this.name),toggleCode:()=>({commands:t})=>t.toggleMark(this.name),unsetCode:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[_d({find:BMe,type:this.type})]},addPasteRules(){return[Uc({find:jMe,type:this.type})]}}),oS=4,UMe=/^```([a-z]+)?[\s\n]$/,WMe=/^~~~([a-z]+)?[\s\n]$/,HMe=$r.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,enableTabIndentation:!1,tabSize:oS,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:t=>{var e;const{languageClassPrefix:n}=this.options;if(!n)return null;const i=[...((e=t.firstElementChild)==null?void 0:e.classList)||[]].filter(o=>o.startsWith(n)).map(o=>o.replace(n,""))[0];return i||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:t,HTMLAttributes:e}){return["pre",un(this.options.HTMLAttributes,e),["code",{class:t.attrs.language?this.options.languageClassPrefix+t.attrs.language:null},0]]},markdownTokenName:"code",parseMarkdown:(t,e)=>{var n;return((n=t.raw)==null?void 0:n.startsWith("```"))===!1&&t.codeBlockStyle!=="indented"?[]:e.createNode("codeBlock",{language:t.lang||null},t.text?[e.createTextNode(t.text)]:[])},renderMarkdown:(t,e)=>{var n;let s="";const r=((n=t.attrs)==null?void 0:n.language)||"";return t.content?s=[`\`\`\`${r}`,e.renderChildren(t.content),"```"].join(`
`):s=`\`\`\`${r}

\`\`\``,s},addCommands(){return{setCodeBlock:t=>({commands:e})=>e.setNode(this.name,t),toggleCodeBlock:t=>({commands:e})=>e.toggleNode(this.name,"paragraph",t)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:t,$anchor:e}=this.editor.state.selection,n=e.pos===1;return!t||e.parent.type.name!==this.name?!1:n||!e.parent.textContent.length?this.editor.commands.clearNodes():!1},Tab:({editor:t})=>{var e;if(!this.options.enableTabIndentation)return!1;const n=(e=this.options.tabSize)!=null?e:oS,{state:s}=t,{selection:r}=s,{$from:i,empty:o}=r;if(i.parent.type!==this.type)return!1;const a=" ".repeat(n);return o?t.commands.insertContent(a):t.commands.command(({tr:l})=>{const{from:c,to:u}=r,f=s.doc.textBetween(c,u,`
`,`
`).split(`
`).map(p=>a+p).join(`
`);return l.replaceWith(c,u,s.schema.text(f)),!0})},"Shift-Tab":({editor:t})=>{var e;if(!this.options.enableTabIndentation)return!1;const n=(e=this.options.tabSize)!=null?e:oS,{state:s}=t,{selection:r}=s,{$from:i,empty:o}=r;return i.parent.type!==this.type?!1:o?t.commands.command(({tr:a})=>{var l;const{pos:c}=i,u=i.start(),d=i.end(),f=s.doc.textBetween(u,d,`
`,`
`).split(`
`);let p=0,m=0;const g=c-u;for(let k=0;k<f.length;k+=1){if(m+f[k].length>=g){p=k;break}m+=f[k].length+1}const x=((l=f[p].match(/^ */))==null?void 0:l[0])||"",v=Math.min(x.length,n);if(v===0)return!0;let w=u;for(let k=0;k<p;k+=1)w+=f[k].length+1;return a.delete(w,w+v),c-w<=v&&a.setSelection(Le.create(a.doc,w)),!0}):t.commands.command(({tr:a})=>{const{from:l,to:c}=r,h=s.doc.textBetween(l,c,`
`,`
`).split(`
`).map(f=>{var p;const m=((p=f.match(/^ */))==null?void 0:p[0])||"",g=Math.min(m.length,n);return f.slice(g)}).join(`
`);return a.replaceWith(l,c,s.schema.text(h)),!0})},Enter:({editor:t})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:e}=t,{selection:n}=e,{$from:s,empty:r}=n;if(!r||s.parent.type!==this.type)return!1;const i=s.parentOffset===s.parent.nodeSize-2,o=s.parent.textContent.endsWith(`

`);return!i||!o?!1:t.chain().command(({tr:a})=>(a.delete(s.pos-2,s.pos),!0)).exitCode().run()},ArrowDown:({editor:t})=>{if(!this.options.exitOnArrowDown)return!1;const{state:e}=t,{selection:n,doc:s}=e,{$from:r,empty:i}=n;if(!i||r.parent.type!==this.type||!(r.parentOffset===r.parent.nodeSize-2))return!1;const a=r.after();return a===void 0?!1:s.nodeAt(a)?t.commands.command(({tr:c})=>(c.setSelection(We.near(s.resolve(a))),!0)):t.commands.exitCode()}}},addInputRules(){return[JC({find:UMe,type:this.type,getAttributes:t=>({language:t[1]})}),JC({find:WMe,type:this.type,getAttributes:t=>({language:t[1]})})]},addProseMirrorPlugins(){return[new Gt({key:new On("codeBlockVSCodeHandler"),props:{handlePaste:(t,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const n=e.clipboardData.getData("text/plain"),s=e.clipboardData.getData("vscode-editor-data"),r=s?JSON.parse(s):void 0,i=r==null?void 0:r.mode;if(!n||!i)return!1;const{tr:o,schema:a}=t.state,l=a.text(n.replace(/\r\n?/g,`
`));return o.replaceSelectionWith(this.type.create({language:i},l)),o.selection.$from.parent.type!==this.type&&o.setSelection(Le.near(o.doc.resolve(Math.max(0,o.selection.from-2)))),o.setMeta("paste",!0),t.dispatch(o),!0}}})]}}),GMe=$r.create({name:"doc",topNode:!0,content:"block+",renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`

`):""}),KMe=$r.create({name:"hardBreak",markdownTokenName:"br",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:t}){return["br",un(this.options.HTMLAttributes,t)]},renderText(){return`
`},renderMarkdown:()=>`  
`,parseMarkdown:()=>({type:"hardBreak"}),addCommands(){return{setHardBreak:()=>({commands:t,chain:e,state:n,editor:s})=>t.first([()=>t.exitCode(),()=>t.command(()=>{const{selection:r,storedMarks:i}=n;if(r.$from.parent.type.spec.isolating)return!1;const{keepMarks:o}=this.options,{splittableMarks:a}=s.extensionManager,l=i||r.$to.parentOffset&&r.$from.marks();return e().insertContent({type:this.name}).command(({tr:c,dispatch:u})=>{if(u&&l&&o){const d=l.filter(h=>a.includes(h.type.name));c.ensureMarks(d)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),qMe=$r.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(t=>({tag:`h${t}`,attrs:{level:t}}))},renderHTML({node:t,HTMLAttributes:e}){return[`h${this.options.levels.includes(t.attrs.level)?t.attrs.level:this.options.levels[0]}`,un(this.options.HTMLAttributes,e),0]},parseMarkdown:(t,e)=>e.createNode("heading",{level:t.depth||1},e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>{var n;const s=(n=t.attrs)!=null&&n.level?parseInt(t.attrs.level,10):1,r="#".repeat(s);return t.content?`${r} ${e.renderChildren(t.content)}`:""},addCommands(){return{setHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.setNode(this.name,t):!1,toggleHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.toggleNode(this.name,"paragraph",t):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((t,e)=>({...t,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(t=>JC({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${t}})\\s$`),type:this.type,getAttributes:{level:t}}))}}),XMe=$r.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{},nextNodeType:"paragraph"}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:t}){return["hr",un(this.options.HTMLAttributes,t)]},markdownTokenName:"hr",parseMarkdown:(t,e)=>e.createNode("horizontalRule"),renderMarkdown:()=>"---",addCommands(){return{setHorizontalRule:()=>({chain:t,state:e})=>{if(!aMe(e,e.schema.nodes[this.name]))return!1;const{selection:n}=e,{$to:s}=n,r=t();return gG(n)?r.insertContentAt(s.pos,{type:this.name}):r.insertContent({type:this.name}),r.command(({state:i,tr:o,dispatch:a})=>{if(a){const{$to:l}=o.selection,c=l.end();if(l.nodeAfter)l.nodeAfter.isTextblock?o.setSelection(Le.create(o.doc,l.pos+1)):l.nodeAfter.isBlock?o.setSelection(Re.create(o.doc,l.pos)):o.setSelection(Le.create(o.doc,l.pos));else{const u=i.schema.nodes[this.options.nextNodeType]||l.parent.type.contentMatch.defaultType,d=u==null?void 0:u.create();d&&(o.insert(c,d),o.setSelection(Le.create(o.doc,c+1)))}o.scrollIntoView()}return!0}).run()}}},addInputRules(){return[oMe({find:/^(?:---|-|___\s|\*\*\*\s)$/,type:this.type})]}}),JMe=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,YMe=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,QMe=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,ZMe=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,ePe=Dl.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:t=>t.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:t=>t.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:t}){return["em",un(this.options.HTMLAttributes,t),0]},addCommands(){return{setItalic:()=>({commands:t})=>t.setMark(this.name),toggleItalic:()=>({commands:t})=>t.toggleMark(this.name),unsetItalic:()=>({commands:t})=>t.unsetMark(this.name)}},markdownTokenName:"em",parseMarkdown:(t,e)=>e.applyMark("italic",e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>`*${e.renderChildren(t)}*`,addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[_d({find:JMe,type:this.type}),_d({find:QMe,type:this.type})]},addPasteRules(){return[Uc({find:YMe,type:this.type}),Uc({find:ZMe,type:this.type})]}});const tPe="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0axi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mgensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",nPe="121342632165322333335355455655552435435422463632574574330355524444661154543332344423364211133222221212112052232222232212222223222241112222224322321222",ZC="numeric",eN="ascii",tN="alpha",wf="asciinumeric",Qh="alphanumeric",nN="domain",OG="emoji",sPe="scheme",rPe="slashscheme",aS="whitespace";function iPe(t,e){return t in e||(e[t]=[]),e[t]}function oc(t,e,n){e[ZC]&&(e[wf]=!0,e[Qh]=!0),e[eN]&&(e[wf]=!0,e[tN]=!0),e[wf]&&(e[Qh]=!0),e[tN]&&(e[Qh]=!0),e[Qh]&&(e[nN]=!0),e[OG]&&(e[nN]=!0);for(const s in e){const r=iPe(s,n);r.indexOf(t)<0&&r.push(t)}}function oPe(t,e){const n={};for(const s in e)e[s].indexOf(t)>=0&&(n[s]=!0);return n}function Ys(t=null){this.j={},this.jr=[],this.jd=null,this.t=t}Ys.groups={};Ys.prototype={accepts(){return!!this.t},go(t){const e=this,n=e.j[t];if(n)return n;for(let s=0;s<e.jr.length;s++){const r=e.jr[s][0],i=e.jr[s][1];if(i&&r.test(t))return i}return e.jd},has(t,e=!1){return e?t in this.j:!!this.go(t)},ta(t,e,n,s){for(let r=0;r<t.length;r++)this.tt(t[r],e,n,s)},tr(t,e,n,s){s=s||Ys.groups;let r;return e&&e.j?r=e:(r=new Ys(e),n&&s&&oc(e,n,s)),this.jr.push([t,r]),r},ts(t,e,n,s){let r=this;const i=t.length;if(!i)return r;for(let o=0;o<i-1;o++)r=r.tt(t[o]);return r.tt(t[i-1],e,n,s)},tt(t,e,n,s){s=s||Ys.groups;const r=this;if(e&&e.j)return r.j[t]=e,e;const i=e;let o,a=r.go(t);if(a?(o=new Ys,Object.assign(o.j,a.j),o.jr.push.apply(o.jr,a.jr),o.jd=a.jd,o.t=a.t):o=new Ys,i){if(s)if(o.t&&typeof o.t=="string"){const l=Object.assign(oPe(o.t,s),n);oc(i,l,s)}else n&&oc(i,n,s);o.t=i}return r.j[t]=o,o}};const Ue=(t,e,n,s,r)=>t.ta(e,n,s,r),Kt=(t,e,n,s,r)=>t.tr(e,n,s,r),BP=(t,e,n,s,r)=>t.ts(e,n,s,r),oe=(t,e,n,s,r)=>t.tt(e,n,s,r),Oo="WORD",sN="UWORD",MG="ASCIINUMERICAL",PG="ALPHANUMERICAL",yp="LOCALHOST",rN="TLD",iN="UTLD",Fy="SCHEME",Au="SLASH_SCHEME",oA="NUM",oN="WS",aA="NL",Sf="OPENBRACE",kf="CLOSEBRACE",px="OPENBRACKET",mx="CLOSEBRACKET",gx="OPENPAREN",yx="CLOSEPAREN",xx="OPENANGLEBRACKET",bx="CLOSEANGLEBRACKET",vx="FULLWIDTHLEFTPAREN",wx="FULLWIDTHRIGHTPAREN",Sx="LEFTCORNERBRACKET",kx="RIGHTCORNERBRACKET",Cx="LEFTWHITECORNERBRACKET",Nx="RIGHTWHITECORNERBRACKET",Tx="FULLWIDTHLESSTHAN",Ex="FULLWIDTHGREATERTHAN",Ix="AMPERSAND",Ax="APOSTROPHE",$x="ASTERISK",Sa="AT",Rx="BACKSLASH",Dx="BACKTICK",Ox="CARET",Ia="COLON",lA="COMMA",Mx="DOLLAR",Wi="DOT",Px="EQUALS",cA="EXCLAMATION",Fr="HYPHEN",Cf="PERCENT",Lx="PIPE",Fx="PLUS",_x="POUND",Nf="QUERY",uA="QUOTE",LG="FULLWIDTHMIDDLEDOT",dA="SEMI",Hi="SLASH",Tf="TILDE",zx="UNDERSCORE",FG="EMOJI",Bx="SYM";var _G=Object.freeze({__proto__:null,ALPHANUMERICAL:PG,AMPERSAND:Ix,APOSTROPHE:Ax,ASCIINUMERICAL:MG,ASTERISK:$x,AT:Sa,BACKSLASH:Rx,BACKTICK:Dx,CARET:Ox,CLOSEANGLEBRACKET:bx,CLOSEBRACE:kf,CLOSEBRACKET:mx,CLOSEPAREN:yx,COLON:Ia,COMMA:lA,DOLLAR:Mx,DOT:Wi,EMOJI:FG,EQUALS:Px,EXCLAMATION:cA,FULLWIDTHGREATERTHAN:Ex,FULLWIDTHLEFTPAREN:vx,FULLWIDTHLESSTHAN:Tx,FULLWIDTHMIDDLEDOT:LG,FULLWIDTHRIGHTPAREN:wx,HYPHEN:Fr,LEFTCORNERBRACKET:Sx,LEFTWHITECORNERBRACKET:Cx,LOCALHOST:yp,NL:aA,NUM:oA,OPENANGLEBRACKET:xx,OPENBRACE:Sf,OPENBRACKET:px,OPENPAREN:gx,PERCENT:Cf,PIPE:Lx,PLUS:Fx,POUND:_x,QUERY:Nf,QUOTE:uA,RIGHTCORNERBRACKET:kx,RIGHTWHITECORNERBRACKET:Nx,SCHEME:Fy,SEMI:dA,SLASH:Hi,SLASH_SCHEME:Au,SYM:Bx,TILDE:Tf,TLD:rN,UNDERSCORE:zx,UTLD:iN,UWORD:sN,WORD:Oo,WS:oN});const $o=/[a-z]/,Ph=/\p{L}/u,lS=/\p{Emoji}/u,Ro=/\d/,cS=/\s/,jP="\r",uS=`
`,aPe="",lPe="",dS="";let ey=null,ty=null;function cPe(t=[]){const e={};Ys.groups=e;const n=new Ys;ey==null&&(ey=VP(tPe)),ty==null&&(ty=VP(nPe)),oe(n,"'",Ax),oe(n,"{",Sf),oe(n,"}",kf),oe(n,"[",px),oe(n,"]",mx),oe(n,"(",gx),oe(n,")",yx),oe(n,"<",xx),oe(n,">",bx),oe(n,"",vx),oe(n,"",wx),oe(n,"",Sx),oe(n,"",kx),oe(n,"",Cx),oe(n,"",Nx),oe(n,"",Tx),oe(n,"",Ex),oe(n,"&",Ix),oe(n,"*",$x),oe(n,"@",Sa),oe(n,"`",Dx),oe(n,"^",Ox),oe(n,":",Ia),oe(n,",",lA),oe(n,"$",Mx),oe(n,".",Wi),oe(n,"=",Px),oe(n,"!",cA),oe(n,"-",Fr),oe(n,"%",Cf),oe(n,"|",Lx),oe(n,"+",Fx),oe(n,"#",_x),oe(n,"?",Nf),oe(n,'"',uA),oe(n,"/",Hi),oe(n,";",dA),oe(n,"~",Tf),oe(n,"_",zx),oe(n,"\\",Rx),oe(n,"",LG);const s=Kt(n,Ro,oA,{[ZC]:!0});Kt(s,Ro,s);const r=Kt(s,$o,MG,{[wf]:!0}),i=Kt(s,Ph,PG,{[Qh]:!0}),o=Kt(n,$o,Oo,{[eN]:!0});Kt(o,Ro,r),Kt(o,$o,o),Kt(r,Ro,r),Kt(r,$o,r);const a=Kt(n,Ph,sN,{[tN]:!0});Kt(a,$o),Kt(a,Ro,i),Kt(a,Ph,a),Kt(i,Ro,i),Kt(i,$o),Kt(i,Ph,i);const l=oe(n,uS,aA,{[aS]:!0}),c=oe(n,jP,oN,{[aS]:!0}),u=Kt(n,cS,oN,{[aS]:!0});oe(n,dS,u),oe(c,uS,l),oe(c,dS,u),Kt(c,cS,u),oe(u,jP),oe(u,uS),Kt(u,cS,u),oe(u,dS,u);const d=Kt(n,lS,FG,{[OG]:!0});oe(d,"#"),Kt(d,lS,d),oe(d,aPe,d);const h=oe(d,lPe);oe(h,"#"),Kt(h,lS,d);const f=[[$o,o],[Ro,r]],p=[[$o,null],[Ph,a],[Ro,i]];for(let m=0;m<ey.length;m++)pa(n,ey[m],rN,Oo,f);for(let m=0;m<ty.length;m++)pa(n,ty[m],iN,sN,p);oc(rN,{tld:!0,ascii:!0},e),oc(iN,{utld:!0,alpha:!0},e),pa(n,"file",Fy,Oo,f),pa(n,"mailto",Fy,Oo,f),pa(n,"http",Au,Oo,f),pa(n,"https",Au,Oo,f),pa(n,"ftp",Au,Oo,f),pa(n,"ftps",Au,Oo,f),oc(Fy,{scheme:!0,ascii:!0},e),oc(Au,{slashscheme:!0,ascii:!0},e),t=t.sort((m,g)=>m[0]>g[0]?1:-1);for(let m=0;m<t.length;m++){const g=t[m][0],x=t[m][1]?{[sPe]:!0}:{[rPe]:!0};g.indexOf("-")>=0?x[nN]=!0:$o.test(g)?Ro.test(g)?x[wf]=!0:x[eN]=!0:x[ZC]=!0,BP(n,g,g,x)}return BP(n,"localhost",yp,{ascii:!0}),n.jd=new Ys(Bx),{start:n,tokens:Object.assign({groups:e},_G)}}function zG(t,e){const n=uPe(e.replace(/[A-Z]/g,a=>a.toLowerCase())),s=n.length,r=[];let i=0,o=0;for(;o<s;){let a=t,l=null,c=0,u=null,d=-1,h=-1;for(;o<s&&(l=a.go(n[o]));)a=l,a.accepts()?(d=0,h=0,u=a):d>=0&&(d+=n[o].length,h++),c+=n[o].length,i+=n[o].length,o++;i-=d,o-=h,c-=d,r.push({t:u.t,v:e.slice(i-c,i),s:i-c,e:i})}return r}function uPe(t){const e=[],n=t.length;let s=0;for(;s<n;){let r=t.charCodeAt(s),i,o=r<55296||r>56319||s+1===n||(i=t.charCodeAt(s+1))<56320||i>57343?t[s]:t.slice(s,s+2);e.push(o),s+=o.length}return e}function pa(t,e,n,s,r){let i;const o=e.length;for(let a=0;a<o-1;a++){const l=e[a];t.j[l]?i=t.j[l]:(i=new Ys(s),i.jr=r.slice(),t.j[l]=i),t=i}return i=new Ys(n),i.jr=r.slice(),t.j[e[o-1]]=i,i}function VP(t){const e=[],n=[];let s=0,r="0123456789";for(;s<t.length;){let i=0;for(;r.indexOf(t[s+i])>=0;)i++;if(i>0){e.push(n.join(""));for(let o=parseInt(t.substring(s,s+i),10);o>0;o--)n.pop();s+=i}else n.push(t[s]),s++}return e}const xp={defaultProtocol:"http",events:null,format:UP,formatHref:UP,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function hA(t,e=null){let n=Object.assign({},xp);t&&(n=Object.assign(n,t instanceof hA?t.o:t));const s=n.ignoreTags,r=[];for(let i=0;i<s.length;i++)r.push(s[i].toUpperCase());this.o=n,e&&(this.defaultRender=e),this.ignoreTags=r}hA.prototype={o:xp,ignoreTags:[],defaultRender(t){return t},check(t){return this.get("validate",t.toString(),t)},get(t,e,n){const s=e!=null;let r=this.o[t];return r&&(typeof r=="object"?(r=n.t in r?r[n.t]:xp[t],typeof r=="function"&&s&&(r=r(e,n))):typeof r=="function"&&s&&(r=r(e,n.t,n)),r)},getObj(t,e,n){let s=this.o[t];return typeof s=="function"&&e!=null&&(s=s(e,n.t,n)),s},render(t){const e=t.render(this);return(this.get("render",null,t)||this.defaultRender)(e,t.t,t)}};function UP(t){return t}function BG(t,e){this.t="token",this.v=t,this.tk=e}BG.prototype={isLink:!1,toString(){return this.v},toHref(t){return this.toString()},toFormattedString(t){const e=this.toString(),n=t.get("truncate",e,this),s=t.get("format",e,this);return n&&s.length>n?s.substring(0,n)+"":s},toFormattedHref(t){return t.get("formatHref",this.toHref(t.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(t=xp.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(t),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(t){return{type:this.t,value:this.toFormattedString(t),isLink:this.isLink,href:this.toFormattedHref(t),start:this.startIndex(),end:this.endIndex()}},validate(t){return t.get("validate",this.toString(),this)},render(t){const e=this,n=this.toHref(t.get("defaultProtocol")),s=t.get("formatHref",n,this),r=t.get("tagName",n,e),i=this.toFormattedString(t),o={},a=t.get("className",n,e),l=t.get("target",n,e),c=t.get("rel",n,e),u=t.getObj("attributes",n,e),d=t.getObj("events",n,e);return o.href=s,a&&(o.class=a),l&&(o.target=l),c&&(o.rel=c),u&&Object.assign(o,u),{tagName:r,attributes:o,content:i,eventListeners:d}}};function m1(t,e){class n extends BG{constructor(r,i){super(r,i),this.t=t}}for(const s in e)n.prototype[s]=e[s];return n.t=t,n}const WP=m1("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),HP=m1("text"),dPe=m1("nl"),ny=m1("url",{isLink:!0,toHref(t=xp.defaultProtocol){return this.hasProtocol()?this.v:`${t}://${this.v}`},hasProtocol(){const t=this.tk;return t.length>=2&&t[0].t!==yp&&t[1].t===Ia}}),Mr=t=>new Ys(t);function hPe({groups:t}){const e=t.domain.concat([Ix,$x,Sa,Rx,Dx,Ox,Mx,Px,Fr,oA,Cf,Lx,Fx,_x,Hi,Bx,Tf,zx]),n=[Ax,Ia,lA,Wi,cA,Cf,Nf,uA,dA,xx,bx,Sf,kf,mx,px,gx,yx,vx,wx,Sx,kx,Cx,Nx,Tx,Ex],s=[Ix,Ax,$x,Rx,Dx,Ox,Mx,Px,Fr,Sf,kf,Cf,Lx,Fx,_x,Nf,Hi,Bx,Tf,zx],r=Mr(),i=oe(r,Tf);Ue(i,s,i),Ue(i,t.domain,i);const o=Mr(),a=Mr(),l=Mr();Ue(r,t.domain,o),Ue(r,t.scheme,a),Ue(r,t.slashscheme,l),Ue(o,s,i),Ue(o,t.domain,o);const c=oe(o,Sa);oe(i,Sa,c),oe(a,Sa,c),oe(l,Sa,c);const u=oe(i,Wi);Ue(u,s,i),Ue(u,t.domain,i);const d=Mr();Ue(c,t.domain,d),Ue(d,t.domain,d);const h=oe(d,Wi);Ue(h,t.domain,d);const f=Mr(WP);Ue(h,t.tld,f),Ue(h,t.utld,f),oe(c,yp,f);const p=oe(d,Fr);oe(p,Fr,p),Ue(p,t.domain,d),Ue(f,t.domain,d),oe(f,Wi,h),oe(f,Fr,p);const m=oe(f,Ia);Ue(m,t.numeric,WP);const g=oe(o,Fr),y=oe(o,Wi);oe(g,Fr,g),Ue(g,t.domain,o),Ue(y,s,i),Ue(y,t.domain,o);const x=Mr(ny);Ue(y,t.tld,x),Ue(y,t.utld,x),Ue(x,t.domain,o),Ue(x,s,i),oe(x,Wi,y),oe(x,Fr,g),oe(x,Sa,c);const v=oe(x,Ia),w=Mr(ny);Ue(v,t.numeric,w);const S=Mr(ny),k=Mr();Ue(S,e,S),Ue(S,n,k),Ue(k,e,S),Ue(k,n,k),oe(x,Hi,S),oe(w,Hi,S);const C=oe(a,Ia),N=oe(l,Ia),T=oe(N,Hi),I=oe(T,Hi);Ue(a,t.domain,o),oe(a,Wi,y),oe(a,Fr,g),Ue(l,t.domain,o),oe(l,Wi,y),oe(l,Fr,g),Ue(C,t.domain,S),oe(C,Hi,S),oe(C,Nf,S),Ue(I,t.domain,S),Ue(I,e,S),oe(I,Hi,S);const D=[[Sf,kf],[px,mx],[gx,yx],[xx,bx],[vx,wx],[Sx,kx],[Cx,Nx],[Tx,Ex]];for(let F=0;F<D.length;F++){const[A,O]=D[F],P=oe(S,A);oe(k,A,P),oe(P,O,S);const L=Mr(ny);Ue(P,e,L);const G=Mr();Ue(P,n),Ue(L,e,L),Ue(L,n,G),Ue(G,e,L),Ue(G,n,G),oe(L,O,S),oe(G,O,S)}return oe(r,yp,x),oe(r,aA,dPe),{start:r,tokens:_G}}function fPe(t,e,n){let s=n.length,r=0,i=[],o=[];for(;r<s;){let a=t,l=null,c=null,u=0,d=null,h=-1;for(;r<s&&!(l=a.go(n[r].t));)o.push(n[r++]);for(;r<s&&(c=l||a.go(n[r].t));)l=null,a=c,a.accepts()?(h=0,d=a):h>=0&&h++,r++,u++;if(h<0)r-=u,r<s&&(o.push(n[r]),r++);else{o.length>0&&(i.push(hS(HP,e,o)),o=[]),r-=h,u-=h;const f=d.t,p=n.slice(r-u,r);i.push(hS(f,e,p))}}return o.length>0&&i.push(hS(HP,e,o)),i}function hS(t,e,n){const s=n[0].s,r=n[n.length-1].e,i=e.slice(s,r);return new t(i,n)}const pPe=typeof console<"u"&&console&&console.warn||(()=>{}),mPe="until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.",$t={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function gPe(){return Ys.groups={},$t.scanner=null,$t.parser=null,$t.tokenQueue=[],$t.pluginQueue=[],$t.customSchemes=[],$t.initialized=!1,$t}function GP(t,e=!1){if($t.initialized&&pPe(`linkifyjs: already initialized - will not register custom scheme "${t}" ${mPe}`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(t))throw new Error(`linkifyjs: incorrect scheme format.
1. Must only contain digits, lowercase ASCII letters or "-"
2. Cannot start or end with "-"
3. "-" cannot repeat`);$t.customSchemes.push([t,e])}function yPe(){$t.scanner=cPe($t.customSchemes);for(let t=0;t<$t.tokenQueue.length;t++)$t.tokenQueue[t][1]({scanner:$t.scanner});$t.parser=hPe($t.scanner.tokens);for(let t=0;t<$t.pluginQueue.length;t++)$t.pluginQueue[t][1]({scanner:$t.scanner,parser:$t.parser});return $t.initialized=!0,$t}function fA(t){return $t.initialized||yPe(),fPe($t.parser.start,t,zG($t.scanner.start,t))}fA.scan=zG;function jG(t,e=null,n=null){if(e&&typeof e=="object"){if(n)throw Error(`linkifyjs: Invalid link type ${e}; must be a string`);n=e,e=null}const s=new hA(n),r=fA(t),i=[];for(let o=0;o<r.length;o++){const a=r[o];a.isLink&&(!e||a.t===e)&&s.check(a)&&i.push(a.toFormattedObject(s))}return i}var pA="[\0- -\u2029]",xPe=new RegExp(pA),bPe=new RegExp(`${pA}$`),vPe=new RegExp(pA,"g");function wPe(t){return t.length===1?t[0].isLink:t.length===3&&t[1].isLink?["()","[]"].includes(t[0].value+t[2].value):!1}function SPe(t){return new Gt({key:new On("autolink"),appendTransaction:(e,n,s)=>{const r=e.some(c=>c.docChanged)&&!n.doc.eq(s.doc),i=e.some(c=>c.getMeta("preventAutolink"));if(!r||i)return;const{tr:o}=s,a=lG(n.doc,[...e]);if(mG(a).forEach(({newRange:c})=>{const u=cOe(s.doc,c,f=>f.isTextblock);let d,h;if(u.length>1)d=u[0],h=s.doc.textBetween(d.pos,d.pos+d.node.nodeSize,void 0," ");else if(u.length){const f=s.doc.textBetween(c.from,c.to," "," ");if(!bPe.test(f))return;d=u[0],h=s.doc.textBetween(d.pos,c.to,void 0," ")}if(d&&h){const f=h.split(xPe).filter(Boolean);if(f.length<=0)return!1;const p=f[f.length-1],m=d.pos+h.lastIndexOf(p);if(!p)return!1;const g=fA(p).map(y=>y.toObject(t.defaultProtocol));if(!wPe(g))return!1;g.filter(y=>y.isLink).map(y=>({...y,from:m+y.start+1,to:m+y.end+1})).filter(y=>s.schema.marks.code?!s.doc.rangeHasMark(y.from,y.to,s.schema.marks.code):!0).filter(y=>t.validate(y.value)).filter(y=>t.shouldAutoLink(y.value)).forEach(y=>{tA(y.from,y.to,s.doc).some(x=>x.mark.type===t.type)||o.addMark(y.from,y.to,t.type.create({href:y.href}))})}}),!!o.steps.length)return o}})}function kPe(t){return new Gt({key:new On("handleClickLink"),props:{handleClick:(e,n,s)=>{var r,i;if(s.button!==0||!e.editable)return!1;let o=null;if(s.target instanceof HTMLAnchorElement)o=s.target;else{let u=s.target;const d=[];for(;u.nodeName!=="DIV";)d.push(u),u=u.parentNode;o=d.find(h=>h.nodeName==="A")}if(!o)return!1;const a=pG(e.state,t.type.name),l=(r=o==null?void 0:o.href)!=null?r:a.href,c=(i=o==null?void 0:o.target)!=null?i:a.target;return t.enableClickSelection&&t.editor.commands.extendMarkRange(t.type.name),o&&l?(window.open(l,c),!0):!1}}})}function CPe(t){return new Gt({key:new On("handlePasteLink"),props:{handlePaste:(e,n,s)=>{const{shouldAutoLink:r}=t,{state:i}=e,{selection:o}=i,{empty:a}=o;if(a)return!1;let l="";s.content.forEach(u=>{l+=u.textContent});const c=jG(l,{defaultProtocol:t.defaultProtocol}).find(u=>u.isLink&&u.value===l);return!l||!c||r!==void 0&&!r(c.href)?!1:t.editor.commands.setMark(t.type,{href:c.href})}}})}function _l(t,e){const n=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return e&&e.forEach(s=>{const r=typeof s=="string"?s:s.scheme;r&&n.push(r)}),!t||t.replace(vPe,"").match(new RegExp(`^(?:(?:${n.join("|")}):|[^a-z]|[a-z0-9+.-]+(?:[^a-z+.-:]|$))`,"i"))}var NPe=Dl.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate,console.warn("The `validate` option is deprecated. Rename to the `shouldAutoLink` option instead.")),this.options.protocols.forEach(t=>{if(typeof t=="string"){GP(t);return}GP(t.scheme,t.optionalSlashes)})},onDestroy(){gPe()},inclusive(){return this.options.autolink},addOptions(){return{openOnClick:!0,enableClickSelection:!1,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:(t,e)=>!!_l(t,e.protocols),validate:t=>!!t,shouldAutoLink:t=>!!t}},addAttributes(){return{href:{default:null,parseHTML(t){return t.getAttribute("href")}},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:"a[href]",getAttrs:t=>{const e=t.getAttribute("href");return!e||!this.options.isAllowedUri(e,{defaultValidate:n=>!!_l(n,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:null}}]},renderHTML({HTMLAttributes:t}){return this.options.isAllowedUri(t.href,{defaultValidate:e=>!!_l(e,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",un(this.options.HTMLAttributes,t),0]:["a",un(this.options.HTMLAttributes,{...t,href:""}),0]},markdownTokenName:"link",parseMarkdown:(t,e)=>e.applyMark("link",e.parseInline(t.tokens||[]),{href:t.href,title:t.title||null}),renderMarkdown:(t,e)=>{var n;const s=((n=t.attrs)==null?void 0:n.href)||"";return`[${e.renderChildren(t)}](${s})`},addCommands(){return{setLink:t=>({chain:e})=>{const{href:n}=t;return this.options.isAllowedUri(n,{defaultValidate:s=>!!_l(s,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?e().setMark(this.name,t).setMeta("preventAutolink",!0).run():!1},toggleLink:t=>({chain:e})=>{const{href:n}=t||{};return n&&!this.options.isAllowedUri(n,{defaultValidate:s=>!!_l(s,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:e().toggleMark(this.name,t,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()},unsetLink:()=>({chain:t})=>t().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[Uc({find:t=>{const e=[];if(t){const{protocols:n,defaultProtocol:s}=this.options,r=jG(t).filter(i=>i.isLink&&this.options.isAllowedUri(i.value,{defaultValidate:o=>!!_l(o,n),protocols:n,defaultProtocol:s}));r.length&&r.forEach(i=>{this.options.shouldAutoLink(i.value)&&e.push({text:i.value,data:{href:i.href},index:i.start})})}return e},type:this.type,getAttributes:t=>{var e;return{href:(e=t.data)==null?void 0:e.href}}})]},addProseMirrorPlugins(){const t=[],{protocols:e,defaultProtocol:n}=this.options;return this.options.autolink&&t.push(SPe({type:this.type,defaultProtocol:this.options.defaultProtocol,validate:s=>this.options.isAllowedUri(s,{defaultValidate:r=>!!_l(r,e),protocols:e,defaultProtocol:n}),shouldAutoLink:this.options.shouldAutoLink})),this.options.openOnClick===!0&&t.push(kPe({type:this.type,editor:this.editor,enableClickSelection:this.options.enableClickSelection})),this.options.linkOnPaste&&t.push(CPe({editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type,shouldAutoLink:this.options.shouldAutoLink})),t}}),TPe=Object.defineProperty,EPe=(t,e)=>{for(var n in e)TPe(t,n,{get:e[n],enumerable:!0})},IPe="listItem",KP="textStyle",qP=/^\s*([-+*])\s$/,VG=$r.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:t}){return["ul",un(this.options.HTMLAttributes,t),0]},markdownTokenName:"list",parseMarkdown:(t,e)=>t.type!=="list"||t.ordered?[]:{type:"bulletList",content:t.items?e.parseChildren(t.items):[]},renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`
`):"",markdownOptions:{indentsContent:!0},addCommands(){return{toggleBulletList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(IPe,this.editor.getAttributes(KP)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let t=zd({find:qP,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(t=zd({find:qP,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(KP),editor:this.editor})),[t]}}),UG=$r.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:t}){return["li",un(this.options.HTMLAttributes,t),0]},markdownTokenName:"list_item",parseMarkdown:(t,e)=>{if(t.type!=="list_item")return[];let n=[];if(t.tokens&&t.tokens.length>0)if(t.tokens.some(r=>r.type==="paragraph"))n=e.parseChildren(t.tokens);else{const r=t.tokens[0];if(r&&r.type==="text"&&r.tokens&&r.tokens.length>0){if(n=[{type:"paragraph",content:e.parseInline(r.tokens)}],t.tokens.length>1){const o=t.tokens.slice(1),a=e.parseChildren(o);n.push(...a)}}else n=e.parseChildren(t.tokens)}return n.length===0&&(n=[{type:"paragraph",content:[]}]),{type:"listItem",content:n}},renderMarkdown:(t,e,n)=>iA(t,e,s=>s.parentType==="bulletList"?"- ":s.parentType==="orderedList"?`${s.index+1}. `:"- ",n),addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),APe={};EPe(APe,{findListItemPos:()=>eg,getNextListDepth:()=>mA,handleBackspace:()=>aN,handleDelete:()=>lN,hasListBefore:()=>WG,hasListItemAfter:()=>$Pe,hasListItemBefore:()=>HG,listItemHasSubList:()=>GG,nextListIsDeeper:()=>KG,nextListIsHigher:()=>qG});var eg=(t,e)=>{const{$from:n}=e.selection,s=Cn(t,e.schema);let r=null,i=n.depth,o=n.pos,a=null;for(;i>0&&a===null;)r=n.node(i),r.type===s?a=i:(i-=1,o-=1);return a===null?null:{$pos:e.doc.resolve(o),depth:a}},mA=(t,e)=>{const n=eg(t,e);if(!n)return!1;const[,s]=bOe(e,t,n.$pos.pos+4);return s},WG=(t,e,n)=>{const{$anchor:s}=t.selection,r=Math.max(0,s.pos-2),i=t.doc.resolve(r).node();return!(!i||!n.includes(i.type.name))},HG=(t,e)=>{var n;const{$anchor:s}=e.selection,r=e.doc.resolve(s.pos-2);return!(r.index()===0||((n=r.nodeBefore)==null?void 0:n.type.name)!==t)},GG=(t,e,n)=>{if(!n)return!1;const s=Cn(t,e.schema);let r=!1;return n.descendants(i=>{i.type===s&&(r=!0)}),r},aN=(t,e,n)=>{if(t.commands.undoInputRule())return!0;if(t.state.selection.from!==t.state.selection.to)return!1;if(!fl(t.state,e)&&WG(t.state,e,n)){const{$anchor:a}=t.state.selection,l=t.state.doc.resolve(a.before()-1),c=[];l.node().descendants((h,f)=>{h.type.name===e&&c.push({node:h,pos:f})});const u=c.at(-1);if(!u)return!1;const d=t.state.doc.resolve(l.start()+u.pos+1);return t.chain().cut({from:a.start()-1,to:a.end()+1},d.end()).joinForward().run()}if(!fl(t.state,e)||!kOe(t.state))return!1;const s=eg(e,t.state);if(!s)return!1;const i=t.state.doc.resolve(s.$pos.pos-2).node(s.depth),o=GG(e,t.state,i);return HG(e,t.state)&&!o?t.commands.joinItemBackward():t.chain().liftListItem(e).run()},KG=(t,e)=>{const n=mA(t,e),s=eg(t,e);return!s||!n?!1:n>s.depth},qG=(t,e)=>{const n=mA(t,e),s=eg(t,e);return!s||!n?!1:n<s.depth},lN=(t,e)=>{if(!fl(t.state,e)||!SOe(t.state,e))return!1;const{selection:n}=t.state,{$from:s,$to:r}=n;return!n.empty&&s.sameParent(r)?!1:KG(e,t.state)?t.chain().focus(t.state.selection.from+4).lift(e).joinBackward().run():qG(e,t.state)?t.chain().joinForward().joinBackward().run():t.commands.joinItemForward()},$Pe=(t,e)=>{var n;const{$anchor:s}=e.selection,r=e.doc.resolve(s.pos-s.parentOffset-2);return!(r.index()===r.parent.childCount-1||((n=r.nodeAfter)==null?void 0:n.type.name)!==t)},XG=bt.create({name:"listKeymap",addOptions(){return{listTypes:[{itemName:"listItem",wrapperNames:["bulletList","orderedList"]},{itemName:"taskItem",wrapperNames:["taskList"]}]}},addKeyboardShortcuts(){return{Delete:({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:n})=>{t.state.schema.nodes[n]!==void 0&&lN(t,n)&&(e=!0)}),e},"Mod-Delete":({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:n})=>{t.state.schema.nodes[n]!==void 0&&lN(t,n)&&(e=!0)}),e},Backspace:({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:n,wrapperNames:s})=>{t.state.schema.nodes[n]!==void 0&&aN(t,n,s)&&(e=!0)}),e},"Mod-Backspace":({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:n,wrapperNames:s})=>{t.state.schema.nodes[n]!==void 0&&aN(t,n,s)&&(e=!0)}),e}}}}),XP=/^(\s*)(\d+)\.\s+(.*)$/,RPe=/^\s/;function DPe(t){const e=[];let n=0,s=0;for(;n<t.length;){const r=t[n],i=r.match(XP);if(!i)break;const[,o,a,l]=i,c=o.length;let u=l,d=n+1;const h=[r];for(;d<t.length;){const f=t[d];if(f.match(XP))break;if(f.trim()==="")h.push(f),u+=`
`,d+=1;else if(f.match(RPe))h.push(f),u+=`
${f.slice(c+2)}`,d+=1;else break}e.push({indent:c,number:parseInt(a,10),content:u.trim(),raw:h.join(`
`)}),s=d,n=d}return[e,s]}function JG(t,e,n){var s;const r=[];let i=0;for(;i<t.length;){const o=t[i];if(o.indent===e){const a=o.content.split(`
`),l=((s=a[0])==null?void 0:s.trim())||"",c=[];l&&c.push({type:"paragraph",raw:l,tokens:n.inlineTokens(l)});const u=a.slice(1).join(`
`).trim();if(u){const f=n.blockTokens(u);c.push(...f)}let d=i+1;const h=[];for(;d<t.length&&t[d].indent>e;)h.push(t[d]),d+=1;if(h.length>0){const f=Math.min(...h.map(m=>m.indent)),p=JG(h,f,n);c.push({type:"list",ordered:!0,start:h[0].number,items:p,raw:h.map(m=>m.raw).join(`
`)})}r.push({type:"list_item",raw:o.raw,tokens:c}),i=d}else i+=1}return r}function OPe(t,e){return t.map(n=>{if(n.type!=="list_item")return e.parseChildren([n])[0];const s=[];return n.tokens&&n.tokens.length>0&&n.tokens.forEach(r=>{if(r.type==="paragraph"||r.type==="list"||r.type==="blockquote"||r.type==="code")s.push(...e.parseChildren([r]));else if(r.type==="text"&&r.tokens){const i=e.parseChildren([r]);s.push({type:"paragraph",content:i})}else{const i=e.parseChildren([r]);i.length>0&&s.push(...i)}}),{type:"listItem",content:s}})}var MPe="listItem",JP="textStyle",YP=/^(\d+)\.\s$/,YG=$r.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:t=>t.hasAttribute("start")?parseInt(t.getAttribute("start")||"",10):1},type:{default:null,parseHTML:t=>t.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:t}){const{start:e,...n}=t;return e===1?["ol",un(this.options.HTMLAttributes,n),0]:["ol",un(this.options.HTMLAttributes,t),0]},markdownTokenName:"list",parseMarkdown:(t,e)=>{if(t.type!=="list"||!t.ordered)return[];const n=t.start||1,s=t.items?OPe(t.items,e):[];return n!==1?{type:"orderedList",attrs:{start:n},content:s}:{type:"orderedList",content:s}},renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`
`):"",markdownTokenizer:{name:"orderedList",level:"block",start:t=>{const e=t.match(/^(\s*)(\d+)\.\s+/),n=e==null?void 0:e.index;return n!==void 0?n:-1},tokenize:(t,e,n)=>{var s;const r=t.split(`
`),[i,o]=DPe(r);if(i.length===0)return;const a=JG(i,0,n);return a.length===0?void 0:{type:"list",ordered:!0,start:((s=i[0])==null?void 0:s.number)||1,items:a,raw:r.slice(0,o).join(`
`)}}},markdownOptions:{indentsContent:!0},addCommands(){return{toggleOrderedList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(MPe,this.editor.getAttributes(JP)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let t=zd({find:YP,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(t=zd({find:YP,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes(JP)}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1],editor:this.editor})),[t]}}),PPe=/^\s*(\[([( |x])?\])\s$/,LPe=$r.create({name:"taskItem",addOptions(){return{nested:!1,HTMLAttributes:{},taskListTypeName:"taskList",a11y:void 0}},content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes(){return{checked:{default:!1,keepOnSplit:!1,parseHTML:t=>{const e=t.getAttribute("data-checked");return e===""||e==="true"},renderHTML:t=>({"data-checked":t.checked})}}},parseHTML(){return[{tag:`li[data-type="${this.name}"]`,priority:51}]},renderHTML({node:t,HTMLAttributes:e}){return["li",un(this.options.HTMLAttributes,e,{"data-type":this.name}),["label",["input",{type:"checkbox",checked:t.attrs.checked?"checked":null}],["span"]],["div",0]]},parseMarkdown:(t,e)=>{const n=[];if(t.tokens&&t.tokens.length>0?n.push(e.createNode("paragraph",{},e.parseInline(t.tokens))):t.text?n.push(e.createNode("paragraph",{},[e.createNode("text",{text:t.text})])):n.push(e.createNode("paragraph",{},[])),t.nestedTokens&&t.nestedTokens.length>0){const s=e.parseChildren(t.nestedTokens);n.push(...s)}return e.createNode("taskItem",{checked:t.checked||!1},n)},renderMarkdown:(t,e)=>{var n;const r=`- [${(n=t.attrs)!=null&&n.checked?"x":" "}] `;return iA(t,e,r)},addKeyboardShortcuts(){const t={Enter:()=>this.editor.commands.splitListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)};return this.options.nested?{...t,Tab:()=>this.editor.commands.sinkListItem(this.name)}:t},addNodeView(){return({node:t,HTMLAttributes:e,getPos:n,editor:s})=>{const r=document.createElement("li"),i=document.createElement("label"),o=document.createElement("span"),a=document.createElement("input"),l=document.createElement("div"),c=u=>{var d,h;a.ariaLabel=((h=(d=this.options.a11y)==null?void 0:d.checkboxLabel)==null?void 0:h.call(d,u,a.checked))||`Task item checkbox for ${u.textContent||"empty task item"}`};return c(t),i.contentEditable="false",a.type="checkbox",a.addEventListener("mousedown",u=>u.preventDefault()),a.addEventListener("change",u=>{if(!s.isEditable&&!this.options.onReadOnlyChecked){a.checked=!a.checked;return}const{checked:d}=u.target;s.isEditable&&typeof n=="function"&&s.chain().focus(void 0,{scrollIntoView:!1}).command(({tr:h})=>{const f=n();if(typeof f!="number")return!1;const p=h.doc.nodeAt(f);return h.setNodeMarkup(f,void 0,{...p==null?void 0:p.attrs,checked:d}),!0}).run(),!s.isEditable&&this.options.onReadOnlyChecked&&(this.options.onReadOnlyChecked(t,d)||(a.checked=!a.checked))}),Object.entries(this.options.HTMLAttributes).forEach(([u,d])=>{r.setAttribute(u,d)}),r.dataset.checked=t.attrs.checked,a.checked=t.attrs.checked,i.append(a,o),r.append(i,l),Object.entries(e).forEach(([u,d])=>{r.setAttribute(u,d)}),{dom:r,contentDOM:l,update:u=>u.type!==this.type?!1:(r.dataset.checked=u.attrs.checked,a.checked=u.attrs.checked,c(u),!0)}}},addInputRules(){return[zd({find:PPe,type:this.type,getAttributes:t=>({checked:t[t.length-1]==="x"})})]}}),FPe=$r.create({name:"taskList",addOptions(){return{itemTypeName:"taskItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:`ul[data-type="${this.name}"]`,priority:51}]},renderHTML({HTMLAttributes:t}){return["ul",un(this.options.HTMLAttributes,t,{"data-type":this.name}),0]},parseMarkdown:(t,e)=>e.createNode("taskList",{},e.parseChildren(t.items||[])),renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`
`):"",markdownTokenizer:{name:"taskList",level:"block",start(t){var e;const n=(e=t.match(/^\s*[-+*]\s+\[([ xX])\]\s+/))==null?void 0:e.index;return n!==void 0?n:-1},tokenize(t,e,n){const s=i=>{const o=YC(i,{itemPattern:/^(\s*)([-+*])\s+\[([ xX])\]\s+(.*)$/,extractItemData:a=>({indentLevel:a[1].length,mainContent:a[4],checked:a[3].toLowerCase()==="x"}),createToken:(a,l)=>({type:"taskItem",raw:"",mainContent:a.mainContent,indentLevel:a.indentLevel,checked:a.checked,text:a.mainContent,tokens:n.inlineTokens(a.mainContent),nestedTokens:l}),customNestedParser:s},n);return o?[{type:"taskList",raw:o.raw,items:o.items}]:n.blockTokens(i)},r=YC(t,{itemPattern:/^(\s*)([-+*])\s+\[([ xX])\]\s+(.*)$/,extractItemData:i=>({indentLevel:i[1].length,mainContent:i[4],checked:i[3].toLowerCase()==="x"}),createToken:(i,o)=>({type:"taskItem",raw:"",mainContent:i.mainContent,indentLevel:i.indentLevel,checked:i.checked,text:i.mainContent,tokens:n.inlineTokens(i.mainContent),nestedTokens:o}),customNestedParser:s},n);if(r)return{type:"taskList",raw:r.raw,items:r.items}}},markdownOptions:{indentsContent:!0},addCommands(){return{toggleTaskList:()=>({commands:t})=>t.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}});bt.create({name:"listKit",addExtensions(){const t=[];return this.options.bulletList!==!1&&t.push(VG.configure(this.options.bulletList)),this.options.listItem!==!1&&t.push(UG.configure(this.options.listItem)),this.options.listKeymap!==!1&&t.push(XG.configure(this.options.listKeymap)),this.options.orderedList!==!1&&t.push(YG.configure(this.options.orderedList)),this.options.taskItem!==!1&&t.push(LPe.configure(this.options.taskItem)),this.options.taskList!==!1&&t.push(FPe.configure(this.options.taskList)),t}});var _Pe=$r.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:t}){return["p",un(this.options.HTMLAttributes,t),0]},parseMarkdown:(t,e)=>{const n=t.tokens||[];return n.length===1&&n[0].type==="image"?e.parseChildren([n[0]]):e.createNode("paragraph",void 0,e.parseInline(n))},renderMarkdown:(t,e)=>!t||!Array.isArray(t.content)?"":e.renderChildren(t.content),addCommands(){return{setParagraph:()=>({commands:t})=>t.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),zPe=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,BPe=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,jPe=Dl.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["s",un(this.options.HTMLAttributes,t),0]},markdownTokenName:"del",parseMarkdown:(t,e)=>e.applyMark("strike",e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>`~~${e.renderChildren(t)}~~`,addCommands(){return{setStrike:()=>({commands:t})=>t.setMark(this.name),toggleStrike:()=>({commands:t})=>t.toggleMark(this.name),unsetStrike:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[_d({find:zPe,type:this.type})]},addPasteRules(){return[Uc({find:BPe,type:this.type})]}}),VPe=$r.create({name:"text",group:"inline",parseMarkdown:t=>({type:"text",text:t.text||""}),renderMarkdown:t=>t.text||""}),UPe=Dl.create({name:"underline",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("underline")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["u",un(this.options.HTMLAttributes,t),0]},parseMarkdown(t,e){return e.applyMark(this.name||"underline",e.parseInline(t.tokens||[]))},renderMarkdown(t,e){return`++${e.renderChildren(t)}++`},markdownTokenizer:{name:"underline",level:"inline",start(t){return t.indexOf("++")},tokenize(t,e,n){const r=/^(\+\+)([\s\S]+?)(\+\+)/.exec(t);if(!r)return;const i=r[2].trim();return{type:"underline",raw:r[0],text:i,tokens:n.inlineTokens(i)}}},addCommands(){return{setUnderline:()=>({commands:t})=>t.setMark(this.name),toggleUnderline:()=>({commands:t})=>t.toggleMark(this.name),unsetUnderline:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}});function WPe(t={}){return new Gt({view(e){return new HPe(e,t)}})}class HPe{constructor(e,n){var s;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(s=n.width)!==null&&s!==void 0?s:1,this.color=n.color===!1?void 0:n.color||"black",this.class=n.class,this.handlers=["dragover","dragend","drop","dragleave"].map(r=>{let i=o=>{this[r](o)};return e.dom.addEventListener(r,i),{name:r,handler:i}})}destroy(){this.handlers.forEach(({name:e,handler:n})=>this.editorView.dom.removeEventListener(e,n))}update(e,n){this.cursorPos!=null&&n.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e=this.editorView.state.doc.resolve(this.cursorPos),n=!e.parent.inlineContent,s,r=this.editorView.dom,i=r.getBoundingClientRect(),o=i.width/r.offsetWidth,a=i.height/r.offsetHeight;if(n){let d=e.nodeBefore,h=e.nodeAfter;if(d||h){let f=this.editorView.nodeDOM(this.cursorPos-(d?d.nodeSize:0));if(f){let p=f.getBoundingClientRect(),m=d?p.bottom:p.top;d&&h&&(m=(m+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let g=this.width/2*a;s={left:p.left,right:p.right,top:m-g,bottom:m+g}}}}if(!s){let d=this.editorView.coordsAtPos(this.cursorPos),h=this.width/2*o;s={left:d.left-h,right:d.left+h,top:d.top,bottom:d.bottom}}let l=this.editorView.dom.offsetParent;this.element||(this.element=l.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",n),this.element.classList.toggle("prosemirror-dropcursor-inline",!n);let c,u;if(!l||l==document.body&&getComputedStyle(l).position=="static")c=-pageXOffset,u=-pageYOffset;else{let d=l.getBoundingClientRect(),h=d.width/l.offsetWidth,f=d.height/l.offsetHeight;c=d.left-l.scrollLeft*h,u=d.top-l.scrollTop*f}this.element.style.left=(s.left-c)/o+"px",this.element.style.top=(s.top-u)/a+"px",this.element.style.width=(s.right-s.left)/o+"px",this.element.style.height=(s.bottom-s.top)/a+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let n=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),s=n&&n.inside>=0&&this.editorView.state.doc.nodeAt(n.inside),r=s&&s.type.spec.disableDropCursor,i=typeof r=="function"?r(this.editorView,n,e):r;if(n&&!i){let o=n.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let a=oH(this.editorView.state.doc,o,this.editorView.dragging.slice);a!=null&&(o=a)}this.setCursor(o),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}}class Xt extends We{constructor(e){super(e,e)}map(e,n){let s=e.resolve(n.map(this.head));return Xt.valid(s)?new Xt(s):We.near(s)}content(){return me.empty}eq(e){return e instanceof Xt&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new Xt(e.resolve(n.pos))}getBookmark(){return new gA(this.anchor)}static valid(e){let n=e.parent;if(n.isTextblock||!GPe(e)||!KPe(e))return!1;let s=n.type.spec.allowGapCursor;if(s!=null)return s;let r=n.contentMatchAt(e.index()).defaultType;return r&&r.isTextblock}static findGapCursorFrom(e,n,s=!1){e:for(;;){if(!s&&Xt.valid(e))return e;let r=e.pos,i=null;for(let o=e.depth;;o--){let a=e.node(o);if(n>0?e.indexAfter(o)<a.childCount:e.index(o)>0){i=a.child(n>0?e.indexAfter(o):e.index(o)-1);break}else if(o==0)return null;r+=n;let l=e.doc.resolve(r);if(Xt.valid(l))return l}for(;;){let o=n>0?i.firstChild:i.lastChild;if(!o){if(i.isAtom&&!i.isText&&!Re.isSelectable(i)){e=e.doc.resolve(r+i.nodeSize*n),s=!1;continue e}break}i=o,r+=n;let a=e.doc.resolve(r);if(Xt.valid(a))return a}return null}}}Xt.prototype.visible=!1;Xt.findFrom=Xt.findGapCursorFrom;We.jsonID("gapcursor",Xt);class gA{constructor(e){this.pos=e}map(e){return new gA(e.map(this.pos))}resolve(e){let n=e.resolve(this.pos);return Xt.valid(n)?new Xt(n):We.near(n)}}function QG(t){return t.isAtom||t.spec.isolating||t.spec.createGapCursor}function GPe(t){for(let e=t.depth;e>=0;e--){let n=t.index(e),s=t.node(e);if(n==0){if(s.type.spec.isolating)return!0;continue}for(let r=s.child(n-1);;r=r.lastChild){if(r.childCount==0&&!r.inlineContent||QG(r.type))return!0;if(r.inlineContent)return!1}}return!0}function KPe(t){for(let e=t.depth;e>=0;e--){let n=t.indexAfter(e),s=t.node(e);if(n==s.childCount){if(s.type.spec.isolating)return!0;continue}for(let r=s.child(n);;r=r.firstChild){if(r.childCount==0&&!r.inlineContent||QG(r.type))return!0;if(r.inlineContent)return!1}}return!0}function qPe(){return new Gt({props:{decorations:QPe,createSelectionBetween(t,e,n){return e.pos==n.pos&&Xt.valid(n)?new Xt(n):null},handleClick:JPe,handleKeyDown:XPe,handleDOMEvents:{beforeinput:YPe}}})}const XPe=eG({ArrowLeft:sy("horiz",-1),ArrowRight:sy("horiz",1),ArrowUp:sy("vert",-1),ArrowDown:sy("vert",1)});function sy(t,e){const n=t=="vert"?e>0?"down":"up":e>0?"right":"left";return function(s,r,i){let o=s.selection,a=e>0?o.$to:o.$from,l=o.empty;if(o instanceof Le){if(!i.endOfTextblock(n)||a.depth==0)return!1;l=!1,a=s.doc.resolve(e>0?a.after():a.before())}let c=Xt.findGapCursorFrom(a,e,l);return c?(r&&r(s.tr.setSelection(new Xt(c))),!0):!1}}function JPe(t,e,n){if(!t||!t.editable)return!1;let s=t.state.doc.resolve(e);if(!Xt.valid(s))return!1;let r=t.posAtCoords({left:n.clientX,top:n.clientY});return r&&r.inside>-1&&Re.isSelectable(t.state.doc.nodeAt(r.inside))?!1:(t.dispatch(t.state.tr.setSelection(new Xt(s))),!0)}function YPe(t,e){if(e.inputType!="insertCompositionText"||!(t.state.selection instanceof Xt))return!1;let{$from:n}=t.state.selection,s=n.parent.contentMatchAt(n.index()).findWrapping(t.state.schema.nodes.text);if(!s)return!1;let r=se.empty;for(let o=s.length-1;o>=0;o--)r=se.from(s[o].createAndFill(null,r));let i=t.state.tr.replace(n.pos,n.pos,new me(r,0,0));return i.setSelection(Le.near(i.doc.resolve(n.pos+1))),t.dispatch(i),!1}function QPe(t){if(!(t.selection instanceof Xt))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",Vt.create(t.doc,[Ms.widget(t.selection.head,e,{key:"gapcursor"})])}var jx=200,Un=function(){};Un.prototype.append=function(e){return e.length?(e=Un.from(e),!this.length&&e||e.length<jx&&this.leafAppend(e)||this.length<jx&&e.leafPrepend(this)||this.appendInner(e)):this};Un.prototype.prepend=function(e){return e.length?Un.from(e).append(this):this};Un.prototype.appendInner=function(e){return new ZPe(this,e)};Un.prototype.slice=function(e,n){return e===void 0&&(e=0),n===void 0&&(n=this.length),e>=n?Un.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,n))};Un.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};Un.prototype.forEach=function(e,n,s){n===void 0&&(n=0),s===void 0&&(s=this.length),n<=s?this.forEachInner(e,n,s,0):this.forEachInvertedInner(e,n,s,0)};Un.prototype.map=function(e,n,s){n===void 0&&(n=0),s===void 0&&(s=this.length);var r=[];return this.forEach(function(i,o){return r.push(e(i,o))},n,s),r};Un.from=function(e){return e instanceof Un?e:e&&e.length?new ZG(e):Un.empty};var ZG=function(t){function e(s){t.call(this),this.values=s}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(r,i){return r==0&&i==this.length?this:new e(this.values.slice(r,i))},e.prototype.getInner=function(r){return this.values[r]},e.prototype.forEachInner=function(r,i,o,a){for(var l=i;l<o;l++)if(r(this.values[l],a+l)===!1)return!1},e.prototype.forEachInvertedInner=function(r,i,o,a){for(var l=i-1;l>=o;l--)if(r(this.values[l],a+l)===!1)return!1},e.prototype.leafAppend=function(r){if(this.length+r.length<=jx)return new e(this.values.concat(r.flatten()))},e.prototype.leafPrepend=function(r){if(this.length+r.length<=jx)return new e(r.flatten().concat(this.values))},n.length.get=function(){return this.values.length},n.depth.get=function(){return 0},Object.defineProperties(e.prototype,n),e}(Un);Un.empty=new ZG([]);var ZPe=function(t){function e(n,s){t.call(this),this.left=n,this.right=s,this.length=n.length+s.length,this.depth=Math.max(n.depth,s.depth)+1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(s){return s<this.left.length?this.left.get(s):this.right.get(s-this.left.length)},e.prototype.forEachInner=function(s,r,i,o){var a=this.left.length;if(r<a&&this.left.forEachInner(s,r,Math.min(i,a),o)===!1||i>a&&this.right.forEachInner(s,Math.max(r-a,0),Math.min(this.length,i)-a,o+a)===!1)return!1},e.prototype.forEachInvertedInner=function(s,r,i,o){var a=this.left.length;if(r>a&&this.right.forEachInvertedInner(s,r-a,Math.max(i,a)-a,o+a)===!1||i<a&&this.left.forEachInvertedInner(s,Math.min(r,a),i,o)===!1)return!1},e.prototype.sliceInner=function(s,r){if(s==0&&r==this.length)return this;var i=this.left.length;return r<=i?this.left.slice(s,r):s>=i?this.right.slice(s-i,r-i):this.left.slice(s,i).append(this.right.slice(0,r-i))},e.prototype.leafAppend=function(s){var r=this.right.leafAppend(s);if(r)return new e(this.left,r)},e.prototype.leafPrepend=function(s){var r=this.left.leafPrepend(s);if(r)return new e(r,this.right)},e.prototype.appendInner=function(s){return this.left.depth>=Math.max(this.right.depth,s.depth)+1?new e(this.left,new e(this.right,s)):new e(this,s)},e}(Un);const eLe=500;class wi{constructor(e,n){this.items=e,this.eventCount=n}popEvent(e,n){if(this.eventCount==0)return null;let s=this.items.length;for(;;s--)if(this.items.get(s-1).selection){--s;break}let r,i;n&&(r=this.remapping(s,this.items.length),i=r.maps.length);let o=e.tr,a,l,c=[],u=[];return this.items.forEach((d,h)=>{if(!d.step){r||(r=this.remapping(s,h+1),i=r.maps.length),i--,u.push(d);return}if(r){u.push(new Gi(d.map));let f=d.step.map(r.slice(i)),p;f&&o.maybeStep(f).doc&&(p=o.mapping.maps[o.mapping.maps.length-1],c.push(new Gi(p,void 0,void 0,c.length+u.length))),i--,p&&r.appendMap(p,i)}else o.maybeStep(d.step);if(d.selection)return a=r?d.selection.map(r.slice(i)):d.selection,l=new wi(this.items.slice(0,s).append(u.reverse().concat(c)),this.eventCount-1),!1},this.items.length,0),{remaining:l,transform:o,selection:a}}addTransform(e,n,s,r){let i=[],o=this.eventCount,a=this.items,l=!r&&a.length?a.get(a.length-1):null;for(let u=0;u<e.steps.length;u++){let d=e.steps[u].invert(e.docs[u]),h=new Gi(e.mapping.maps[u],d,n),f;(f=l&&l.merge(h))&&(h=f,u?i.pop():a=a.slice(0,a.length-1)),i.push(h),n&&(o++,n=void 0),r||(l=h)}let c=o-s.depth;return c>nLe&&(a=tLe(a,c),o-=c),new wi(a.append(i),o)}remapping(e,n){let s=new dp;return this.items.forEach((r,i)=>{let o=r.mirrorOffset!=null&&i-r.mirrorOffset>=e?s.maps.length-r.mirrorOffset:void 0;s.appendMap(r.map,o)},e,n),s}addMaps(e){return this.eventCount==0?this:new wi(this.items.append(e.map(n=>new Gi(n))),this.eventCount)}rebased(e,n){if(!this.eventCount)return this;let s=[],r=Math.max(0,this.items.length-n),i=e.mapping,o=e.steps.length,a=this.eventCount;this.items.forEach(h=>{h.selection&&a--},r);let l=n;this.items.forEach(h=>{let f=i.getMirror(--l);if(f==null)return;o=Math.min(o,f);let p=i.maps[f];if(h.step){let m=e.steps[f].invert(e.docs[f]),g=h.selection&&h.selection.map(i.slice(l+1,f));g&&a++,s.push(new Gi(p,m,g))}else s.push(new Gi(p))},r);let c=[];for(let h=n;h<o;h++)c.push(new Gi(i.maps[h]));let u=this.items.slice(0,r).append(c).append(s),d=new wi(u,a);return d.emptyItemCount()>eLe&&(d=d.compress(this.items.length-s.length)),d}emptyItemCount(){let e=0;return this.items.forEach(n=>{n.step||e++}),e}compress(e=this.items.length){let n=this.remapping(0,e),s=n.maps.length,r=[],i=0;return this.items.forEach((o,a)=>{if(a>=e)r.push(o),o.selection&&i++;else if(o.step){let l=o.step.map(n.slice(s)),c=l&&l.getMap();if(s--,c&&n.appendMap(c,s),l){let u=o.selection&&o.selection.map(n.slice(s));u&&i++;let d=new Gi(c.invert(),l,u),h,f=r.length-1;(h=r.length&&r[f].merge(d))?r[f]=h:r.push(d)}}else o.map&&s--},this.items.length,0),new wi(Un.from(r.reverse()),i)}}wi.empty=new wi(Un.empty,0);function tLe(t,e){let n;return t.forEach((s,r)=>{if(s.selection&&e--==0)return n=r,!1}),t.slice(n)}class Gi{constructor(e,n,s,r){this.map=e,this.step=n,this.selection=s,this.mirrorOffset=r}merge(e){if(this.step&&e.step&&!e.selection){let n=e.step.merge(this.step);if(n)return new Gi(n.getMap().invert(),n,this.selection)}}}class ka{constructor(e,n,s,r,i){this.done=e,this.undone=n,this.prevRanges=s,this.prevTime=r,this.prevComposition=i}}const nLe=20;function sLe(t,e,n,s){let r=n.getMeta(yc),i;if(r)return r.historyState;n.getMeta(oLe)&&(t=new ka(t.done,t.undone,null,0,-1));let o=n.getMeta("appendedTransaction");if(n.steps.length==0)return t;if(o&&o.getMeta(yc))return o.getMeta(yc).redo?new ka(t.done.addTransform(n,void 0,s,_y(e)),t.undone,QP(n.mapping.maps),t.prevTime,t.prevComposition):new ka(t.done,t.undone.addTransform(n,void 0,s,_y(e)),null,t.prevTime,t.prevComposition);if(n.getMeta("addToHistory")!==!1&&!(o&&o.getMeta("addToHistory")===!1)){let a=n.getMeta("composition"),l=t.prevTime==0||!o&&t.prevComposition!=a&&(t.prevTime<(n.time||0)-s.newGroupDelay||!rLe(n,t.prevRanges)),c=o?fS(t.prevRanges,n.mapping):QP(n.mapping.maps);return new ka(t.done.addTransform(n,l?e.selection.getBookmark():void 0,s,_y(e)),wi.empty,c,n.time,a??t.prevComposition)}else return(i=n.getMeta("rebased"))?new ka(t.done.rebased(n,i),t.undone.rebased(n,i),fS(t.prevRanges,n.mapping),t.prevTime,t.prevComposition):new ka(t.done.addMaps(n.mapping.maps),t.undone.addMaps(n.mapping.maps),fS(t.prevRanges,n.mapping),t.prevTime,t.prevComposition)}function rLe(t,e){if(!e)return!1;if(!t.docChanged)return!0;let n=!1;return t.mapping.maps[0].forEach((s,r)=>{for(let i=0;i<e.length;i+=2)s<=e[i+1]&&r>=e[i]&&(n=!0)}),n}function QP(t){let e=[];for(let n=t.length-1;n>=0&&e.length==0;n--)t[n].forEach((s,r,i,o)=>e.push(i,o));return e}function fS(t,e){if(!t)return null;let n=[];for(let s=0;s<t.length;s+=2){let r=e.map(t[s],1),i=e.map(t[s+1],-1);r<=i&&n.push(r,i)}return n}function iLe(t,e,n){let s=_y(e),r=yc.get(e).spec.config,i=(n?t.undone:t.done).popEvent(e,s);if(!i)return null;let o=i.selection.resolve(i.transform.doc),a=(n?t.done:t.undone).addTransform(i.transform,e.selection.getBookmark(),r,s),l=new ka(n?a:i.remaining,n?i.remaining:a,null,0,-1);return i.transform.setSelection(o).setMeta(yc,{redo:n,historyState:l})}let pS=!1,ZP=null;function _y(t){let e=t.plugins;if(ZP!=e){pS=!1,ZP=e;for(let n=0;n<e.length;n++)if(e[n].spec.historyPreserveItems){pS=!0;break}}return pS}const yc=new On("history"),oLe=new On("closeHistory");function aLe(t={}){return t={depth:t.depth||100,newGroupDelay:t.newGroupDelay||500},new Gt({key:yc,state:{init(){return new ka(wi.empty,wi.empty,null,0,-1)},apply(e,n,s){return sLe(n,s,e,t)}},config:t,props:{handleDOMEvents:{beforeinput(e,n){let s=n.inputType,r=s=="historyUndo"?t6:s=="historyRedo"?n6:null;return!r||!e.editable?!1:(n.preventDefault(),r(e.state,e.dispatch))}}}})}function e6(t,e){return(n,s)=>{let r=yc.getState(n);if(!r||(t?r.undone:r.done).eventCount==0)return!1;if(s){let i=iLe(r,n,t);i&&s(e?i.scrollIntoView():i)}return!0}}const t6=e6(!1,!0),n6=e6(!0,!0);bt.create({name:"characterCount",addOptions(){return{limit:null,mode:"textSize",textCounter:t=>t.length,wordCounter:t=>t.split(" ").filter(e=>e!=="").length}},addStorage(){return{characters:()=>0,words:()=>0}},onBeforeCreate(){this.storage.characters=t=>{const e=(t==null?void 0:t.node)||this.editor.state.doc;if(((t==null?void 0:t.mode)||this.options.mode)==="textSize"){const s=e.textBetween(0,e.content.size,void 0," ");return this.options.textCounter(s)}return e.nodeSize},this.storage.words=t=>{const e=(t==null?void 0:t.node)||this.editor.state.doc,n=e.textBetween(0,e.content.size," "," ");return this.options.wordCounter(n)}},addProseMirrorPlugins(){let t=!1;return[new Gt({key:new On("characterCount"),appendTransaction:(e,n,s)=>{if(t)return;const r=this.options.limit;if(r==null||r===0){t=!0;return}const i=this.storage.characters({node:s.doc});if(i>r){const o=i-r,a=0,l=o;console.warn(`[CharacterCount] Initial content exceeded limit of ${r} characters. Content was automatically trimmed.`);const c=s.tr.deleteRange(a,l);return t=!0,c}t=!0},filterTransaction:(e,n)=>{const s=this.options.limit;if(!e.docChanged||s===0||s===null||s===void 0)return!0;const r=this.storage.characters({node:n.doc}),i=this.storage.characters({node:e.doc});if(i<=s||r>s&&i>s&&i<=r)return!0;if(r>s&&i>s&&i>r||!e.getMeta("paste"))return!1;const a=e.selection.$head.pos,l=i-s,c=a-l,u=a;return e.deleteRange(c,u),!(this.storage.characters({node:e.doc})>s)}})]}});var lLe=bt.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[WPe(this.options)]}});bt.create({name:"focus",addOptions(){return{className:"has-focus",mode:"all"}},addProseMirrorPlugins(){return[new Gt({key:new On("focus"),props:{decorations:({doc:t,selection:e})=>{const{isEditable:n,isFocused:s}=this.editor,{anchor:r}=e,i=[];if(!n||!s)return Vt.create(t,[]);let o=0;this.options.mode==="deepest"&&t.descendants((l,c)=>{if(l.isText)return;if(!(r>=c&&r<=c+l.nodeSize-1))return!1;o+=1});let a=0;return t.descendants((l,c)=>{if(l.isText||!(r>=c&&r<=c+l.nodeSize-1))return!1;if(a+=1,this.options.mode==="deepest"&&o-a>0||this.options.mode==="shallowest"&&a>1)return this.options.mode==="deepest";i.push(Ms.node(c,c+l.nodeSize,{class:this.options.className}))}),Vt.create(t,i)}}})]}});var cLe=bt.create({name:"gapCursor",addProseMirrorPlugins(){return[qPe()]},extendNodeSchema(t){var e;const n={name:t.name,options:t.options,storage:t.storage};return{allowGapCursor:(e=pt(Ee(t,"allowGapCursor",n)))!=null?e:null}}}),uLe=bt.create({name:"placeholder",addOptions(){return{emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something ",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}},addProseMirrorPlugins(){return[new Gt({key:new On("placeholder"),props:{decorations:({doc:t,selection:e})=>{const n=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:s}=e,r=[];if(!n)return null;const i=this.editor.isEmpty;return t.descendants((o,a)=>{const l=s>=a&&s<=a+o.nodeSize,c=!o.isLeaf&&h1(o);if((l||!this.options.showOnlyCurrent)&&c){const u=[this.options.emptyNodeClass];i&&u.push(this.options.emptyEditorClass);const d=Ms.node(a,a+o.nodeSize,{class:u.join(" "),"data-placeholder":typeof this.options.placeholder=="function"?this.options.placeholder({editor:this.editor,node:o,pos:a,hasAnchor:l}):this.options.placeholder});r.push(d)}return this.options.includeChildren}),Vt.create(t,r)}}})]}});bt.create({name:"selection",addOptions(){return{className:"selection"}},addProseMirrorPlugins(){const{editor:t,options:e}=this;return[new Gt({key:new On("selection"),props:{decorations(n){return n.selection.empty||t.isFocused||!t.isEditable||gG(n.selection)||t.view.dragging?null:Vt.create(n.doc,[Ms.inline(n.selection.from,n.selection.to,{class:e.className})])}}})]}});function eL({types:t,node:e}){return e&&Array.isArray(t)&&t.includes(e.type)||(e==null?void 0:e.type)===t}var dLe=bt.create({name:"trailingNode",addOptions(){return{node:void 0,notAfter:[]}},addProseMirrorPlugins(){var t;const e=new On(this.name),n=((t=this.editor.schema.topNodeType.contentMatch.defaultType)==null?void 0:t.name)||this.options.node||"paragraph",s=Object.entries(this.editor.schema.nodes).map(([,r])=>r).filter(r=>(this.options.notAfter||[]).concat(n).includes(r.name));return[new Gt({key:e,appendTransaction:(r,i,o)=>{const{doc:a,tr:l,schema:c}=o,u=e.getState(o),d=a.content.size,h=c.nodes[n];if(u)return l.insert(d,h.create())},state:{init:(r,i)=>{const o=i.tr.doc.lastChild;return!eL({node:o,types:s})},apply:(r,i)=>{if(!r.docChanged||r.getMeta("__uniqueIDTransaction"))return i;const o=r.doc.lastChild;return!eL({node:o,types:s})}}})]}}),hLe=bt.create({name:"undoRedo",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:t,dispatch:e})=>t6(t,e),redo:()=>({state:t,dispatch:e})=>n6(t,e)}},addProseMirrorPlugins(){return[aLe(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-":()=>this.editor.commands.undo(),"Shift-Mod-":()=>this.editor.commands.redo()}}}),fLe=bt.create({name:"starterKit",addExtensions(){var t,e,n,s;const r=[];return this.options.bold!==!1&&r.push(zMe.configure(this.options.bold)),this.options.blockquote!==!1&&r.push(MMe.configure(this.options.blockquote)),this.options.bulletList!==!1&&r.push(VG.configure(this.options.bulletList)),this.options.code!==!1&&r.push(VMe.configure(this.options.code)),this.options.codeBlock!==!1&&r.push(HMe.configure(this.options.codeBlock)),this.options.document!==!1&&r.push(GMe.configure(this.options.document)),this.options.dropcursor!==!1&&r.push(lLe.configure(this.options.dropcursor)),this.options.gapcursor!==!1&&r.push(cLe.configure(this.options.gapcursor)),this.options.hardBreak!==!1&&r.push(KMe.configure(this.options.hardBreak)),this.options.heading!==!1&&r.push(qMe.configure(this.options.heading)),this.options.undoRedo!==!1&&r.push(hLe.configure(this.options.undoRedo)),this.options.horizontalRule!==!1&&r.push(XMe.configure(this.options.horizontalRule)),this.options.italic!==!1&&r.push(ePe.configure(this.options.italic)),this.options.listItem!==!1&&r.push(UG.configure(this.options.listItem)),this.options.listKeymap!==!1&&r.push(XG.configure((t=this.options)==null?void 0:t.listKeymap)),this.options.link!==!1&&r.push(NPe.configure((e=this.options)==null?void 0:e.link)),this.options.orderedList!==!1&&r.push(YG.configure(this.options.orderedList)),this.options.paragraph!==!1&&r.push(_Pe.configure(this.options.paragraph)),this.options.strike!==!1&&r.push(jPe.configure(this.options.strike)),this.options.text!==!1&&r.push(VPe.configure(this.options.text)),this.options.underline!==!1&&r.push(UPe.configure((n=this.options)==null?void 0:n.underline)),this.options.trailingNode!==!1&&r.push(dLe.configure((s=this.options)==null?void 0:s.trailingNode)),r}}),pLe=fLe,mLe=uLe,gLe=20,s6=(t,e=0)=>{const n=[];return!t.children.length||e>gLe||Array.from(t.children).forEach(s=>{s.tagName==="SPAN"?n.push(s):s.children.length&&n.push(...s6(s,e+1))}),n},yLe=t=>{if(!t.children.length)return;const e=s6(t);e&&e.forEach(n=>{var s,r;const i=n.getAttribute("style"),o=(r=(s=n.parentElement)==null?void 0:s.closest("span"))==null?void 0:r.getAttribute("style");n.setAttribute("style",`${o};${i}`)})},r6=Dl.create({name:"textStyle",priority:101,addOptions(){return{HTMLAttributes:{},mergeNestedSpanStyles:!0}},parseHTML(){return[{tag:"span",consuming:!1,getAttrs:t=>t.hasAttribute("style")?(this.options.mergeNestedSpanStyles&&yLe(t),{}):!1}]},renderHTML({HTMLAttributes:t}){return["span",un(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleTextStyle:t=>({commands:e})=>e.toggleMark(this.name,t),removeEmptyTextStyle:()=>({tr:t})=>{const{selection:e}=t;return t.doc.nodesBetween(e.from,e.to,(n,s)=>{if(n.isTextblock)return!0;n.marks.filter(r=>r.type===this.type).some(r=>Object.values(r.attrs).some(i=>!!i))||t.removeMark(s,s+n.nodeSize,this.type)}),!0}}}}),xLe=bt.create({name:"backgroundColor",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{backgroundColor:{default:null,parseHTML:t=>{var e;const n=t.getAttribute("style");if(n){const s=n.split(";").map(r=>r.trim()).filter(Boolean);for(let r=s.length-1;r>=0;r-=1){const i=s[r].split(":");if(i.length>=2){const o=i[0].trim().toLowerCase(),a=i.slice(1).join(":").trim();if(o==="background-color")return a.replace(/['"]+/g,"")}}}return(e=t.style.backgroundColor)==null?void 0:e.replace(/['"]+/g,"")},renderHTML:t=>t.backgroundColor?{style:`background-color: ${t.backgroundColor}`}:{}}}}]},addCommands(){return{setBackgroundColor:t=>({chain:e})=>e().setMark("textStyle",{backgroundColor:t}).run(),unsetBackgroundColor:()=>({chain:t})=>t().setMark("textStyle",{backgroundColor:null}).removeEmptyTextStyle().run()}}}),i6=bt.create({name:"color",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{color:{default:null,parseHTML:t=>{var e;const n=t.getAttribute("style");if(n){const s=n.split(";").map(r=>r.trim()).filter(Boolean);for(let r=s.length-1;r>=0;r-=1){const i=s[r].split(":");if(i.length>=2){const o=i[0].trim().toLowerCase(),a=i.slice(1).join(":").trim();if(o==="color")return a.replace(/['"]+/g,"")}}}return(e=t.style.color)==null?void 0:e.replace(/['"]+/g,"")},renderHTML:t=>t.color?{style:`color: ${t.color}`}:{}}}}]},addCommands(){return{setColor:t=>({chain:e})=>e().setMark("textStyle",{color:t}).run(),unsetColor:()=>({chain:t})=>t().setMark("textStyle",{color:null}).removeEmptyTextStyle().run()}}}),bLe=bt.create({name:"fontFamily",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{fontFamily:{default:null,parseHTML:t=>t.style.fontFamily,renderHTML:t=>t.fontFamily?{style:`font-family: ${t.fontFamily}`}:{}}}}]},addCommands(){return{setFontFamily:t=>({chain:e})=>e().setMark("textStyle",{fontFamily:t}).run(),unsetFontFamily:()=>({chain:t})=>t().setMark("textStyle",{fontFamily:null}).removeEmptyTextStyle().run()}}}),vLe=bt.create({name:"fontSize",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{fontSize:{default:null,parseHTML:t=>t.style.fontSize,renderHTML:t=>t.fontSize?{style:`font-size: ${t.fontSize}`}:{}}}}]},addCommands(){return{setFontSize:t=>({chain:e})=>e().setMark("textStyle",{fontSize:t}).run(),unsetFontSize:()=>({chain:t})=>t().setMark("textStyle",{fontSize:null}).removeEmptyTextStyle().run()}}}),wLe=bt.create({name:"lineHeight",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{lineHeight:{default:null,parseHTML:t=>t.style.lineHeight,renderHTML:t=>t.lineHeight?{style:`line-height: ${t.lineHeight}`}:{}}}}]},addCommands(){return{setLineHeight:t=>({chain:e})=>e().setMark("textStyle",{lineHeight:t}).run(),unsetLineHeight:()=>({chain:t})=>t().setMark("textStyle",{lineHeight:null}).removeEmptyTextStyle().run()}}});bt.create({name:"textStyleKit",addExtensions(){const t=[];return this.options.backgroundColor!==!1&&t.push(xLe.configure(this.options.backgroundColor)),this.options.color!==!1&&t.push(i6.configure(this.options.color)),this.options.fontFamily!==!1&&t.push(bLe.configure(this.options.fontFamily)),this.options.fontSize!==!1&&t.push(vLe.configure(this.options.fontSize)),this.options.lineHeight!==!1&&t.push(wLe.configure(this.options.lineHeight)),this.options.textStyle!==!1&&t.push(r6.configure(this.options.textStyle)),t}});const SLe=bt.create({name:"fontSize",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{fontSize:{default:null,parseHTML:t=>{var e;return(e=t.style.fontSize)==null?void 0:e.replace(/['"]+/g,"")},renderHTML:t=>t.fontSize?{style:`font-size: ${t.fontSize}`}:{}}}}]},addCommands(){return{setFontSize:t=>({chain:e})=>e().setMark("textStyle",{fontSize:t}).run(),unsetFontSize:()=>({chain:t})=>t().setMark("textStyle",{fontSize:null}).removeEmptyTextStyle().run()}}}),kLe=({value:t,onChange:e,onSubmit:n,placeholder:s="crivez votre message...",disabled:r=!1,className:i=""})=>{const[o,a]=z.useState(!1),[l,c]=z.useState(!1);z.useEffect(()=>{const p=()=>{a(!1),c(!1)};if(o||l)return document.addEventListener("mousedown",p),()=>document.removeEventListener("mousedown",p)},[o,l]);const u=AMe({extensions:[pLe.configure({heading:!1,codeBlock:!1,code:!1,horizontalRule:!1,blockquote:!1,bulletList:!1,orderedList:!1,listItem:!1,italic:!1,strike:!1,hardBreak:!1}),mLe.configure({placeholder:s}),r6,i6,SLe],content:t,editable:!r,editorProps:{attributes:{class:"prose prose-sm max-w-none focus:outline-none min-h-[44px] max-h-[200px] overflow-y-auto px-4 py-3"},handleKeyDown:(p,m)=>m.key==="Enter"&&!m.shiftKey&&!m.ctrlKey&&!m.metaKey&&!m.altKey?(m.preventDefault(),n(),!0):m.key==="Enter"&&m.shiftKey?(m.preventDefault(),p.dispatch(p.state.tr.replaceSelectionWith(p.state.schema.nodes.hardBreak.create()).scrollIntoView()),!0):!1},onUpdate:({editor:p})=>{const m=p.getHTML();e(m==="<p></p>"?"":m)}});if(z.useEffect(()=>{u&&t!==u.getHTML()&&u.commands.setContent(t||"")},[t,u]),!u)return null;const d=[{name:"Noir",value:"#000000"},{name:"Gris",value:"#6B7280"},{name:"Rouge",value:"#EF4444"},{name:"Orange",value:"#F97316"},{name:"Jaune",value:"#EAB308"},{name:"Vert",value:"#10B981"},{name:"Bleu",value:"#3B82F6"},{name:"Violet",value:"#8B5CF6"},{name:"Rose",value:"#EC4899"}],h=[{name:"Petit",value:"14px"},{name:"Normal",value:"16px"},{name:"Grand",value:"20px"},{name:"Trs grand",value:"24px"}],f=({onClick:p,isActive:m,icon:g,title:y,disabled:x})=>b.jsx("button",{type:"button",onClick:p,disabled:x,title:y,className:`p-2 rounded-lg transition-all ${m?"bg-primary-500 text-white":"text-gray-600 hover:bg-gray-100 hover:text-gray-900"} disabled:opacity-30 disabled:cursor-not-allowed`,children:g});return b.jsxs("div",{className:`flex-1 border rounded-xl bg-white shadow-sm ${r?"opacity-50 cursor-not-allowed border-red-200 bg-red-50":"border-gray-200 focus-within:border-primary-400 focus-within:ring-2 focus-within:ring-primary-100"} ${i}`,children:[b.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 border-b border-gray-100",children:[b.jsx(f,{onClick:()=>u.chain().focus().toggleBold().run(),isActive:u.isActive("bold"),disabled:r,icon:b.jsx("span",{className:"font-bold text-sm",children:"B"}),title:"Gras (Ctrl+B)"}),b.jsxs("div",{className:"relative",children:[b.jsxs("button",{type:"button",onClick:()=>c(!l),disabled:r,title:"Taille du texte",className:"p-2 rounded-lg text-gray-600 hover:bg-gray-100 hover:text-gray-900 transition-all disabled:opacity-30 disabled:cursor-not-allowed flex items-center gap-1",children:[b.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:b.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21h10M7 21v-2m10 2v-2M7 3h10M7 3v2m10-2v2M3 7h18M3 17h18M7 9h10v6H7V9z"})}),b.jsx("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:b.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})]}),l&&!r&&b.jsx("div",{className:"absolute bottom-full left-0 mb-1 bg-white border border-gray-200 rounded-lg shadow-lg z-50 py-1 min-w-[120px]",children:h.map(p=>b.jsx("button",{type:"button",onClick:()=>{u.chain().focus().setFontSize(p.value).run(),c(!1)},className:"w-full text-left px-3 py-2 hover:bg-gray-50 text-sm transition-colors",style:{fontSize:p.value},children:p.name},p.value))})]}),b.jsxs("div",{className:"relative",children:[b.jsxs("button",{type:"button",onClick:()=>a(!o),disabled:r,title:"Couleur du texte",className:"p-2 rounded-lg text-gray-600 hover:bg-gray-100 hover:text-gray-900 transition-all disabled:opacity-30 disabled:cursor-not-allowed flex items-center gap-1",children:[b.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:b.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"})}),b.jsx("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:b.jsx("path",{fillRule:"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z",clipRule:"evenodd"})})]}),o&&!r&&b.jsx("div",{className:"absolute bottom-full left-0 mb-1 bg-white border border-gray-200 rounded-lg shadow-lg z-50 p-2 grid grid-cols-3 gap-2",children:d.map(p=>b.jsx("button",{type:"button",onClick:()=>{u.chain().focus().setColor(p.value).run(),a(!1)},title:p.name,className:"w-8 h-8 rounded border-2 border-gray-200 hover:border-primary-400 transition-all",style:{backgroundColor:p.value}},p.value))})]}),b.jsx("div",{className:"flex-1"}),b.jsx("span",{className:"text-xs text-gray-400",children:"Enter pour envoyer  Shift+Enter pour nouvelle ligne"})]}),b.jsx(SMe,{editor:u,className:r?"pointer-events-none":""})]})},CLe=()=>{var ut,et;const{messages:t,activeChat:e,sendMessage:n,onlineUsers:s,loadChatHistory:r,clearChatHistory:i,exportChat:o,typingUsers:a,startTyping:l,stopTyping:c,encryptionStatus:u,isEncryptionEnabled:d,authorizedUsers:h,authorizeUser:f,acceptAuth:p,rejectAuth:m,markAsRead:g}=Be(),{startCall:y}=zr();_t();const{preferences:x}=D2(),[v,w]=z.useState(""),[S,k]=z.useState(!1),[C,N]=z.useState(!1),[T,I]=z.useState(!1),[D,F]=z.useState(!1),[A,O]=z.useState(""),[P,L]=z.useState(void 0),[G,$]=z.useState(()=>{const ge=localStorage.getItem("palfrog-ai-suggestions-enabled");return ge?JSON.parse(ge):!1}),U=z.useRef(null),K=z.useRef(),j=s.find(ge=>ge.userId===e),Z=((j==null?void 0:j.status)||"offline")==="dnd",te=(e?h.includes(e):!1)||D;z.useEffect(()=>{(async()=>{let Fe,Pt;if(j&&(Pt=j.username,Fe=j.avatarUrl),!Fe)try{const dn=(await Pn.getAllChats()).find(Ct=>Ct.participantId===e);if(dn&&(Pt||(Pt=dn.participantName),dn.avatarUrl&&(Fe=dn.avatarUrl)),!Fe&&e)try{const Ct=await ed.getVisibleProfile(e);Ct&&(Pt||(Pt=Ct.username),Ct.avatarUrl&&(Fe=Ct.avatarUrl,Pn.updateChatAvatar(e,Ct.avatarUrl)))}catch{}}catch(yt){console.error("Error fetching chat details:",yt)}O(Pt||"Utilisateur inconnu"),L(Fe)})()},[e,j]);const le=ge=>{w(ge)},pe=()=>t.slice(-5).map(ge=>ge.content).filter(ge=>ge&&ge.length>0),xe=(()=>{if(!e||!d)return null;switch(u.get(e)){case"established":return{text:"Chiffrement E2E activ",icon:"",color:"text-green-500"};case"pending":return{text:"tablissement du chiffrement...",icon:"",color:"text-yellow-500"};case"failed":return{text:"Chiffrement chou",icon:"",color:"text-red-500"};default:return{text:"Chiffrement en attente",icon:"",color:"text-gray-500"}}})(),Ne=(ge="smooth")=>{var Fe;(Fe=U.current)==null||Fe.scrollIntoView({behavior:ge,block:"end"})};z.useEffect(()=>(e&&(r(e),F(!1),g(e),setTimeout(()=>Ne("auto"),100)),()=>{K.current&&clearTimeout(K.current),e&&c(e)}),[e,r,c,g]),z.useEffect(()=>{e&&t.length>0&&t[t.length-1].sender===e&&g(e)},[t.length,e,g]),z.useEffect(()=>{t.length>0&&Ne("smooth")},[t.length,a]),z.useEffect(()=>{t.length>0&&e&&setTimeout(()=>Ne("auto"),150)},[e,t.length>0]),z.useEffect(()=>{localStorage.setItem("palfrog-ai-suggestions-enabled",JSON.stringify(G))},[G]);const Ae=()=>{$(ge=>!ge)},Qe=ge=>{w(ge),e&&(!S&&!Gg(ge)&&(k(!0),l(e)),K.current&&clearTimeout(K.current),K.current=setTimeout(()=>{k(!1),e&&c(e)},1e3))},Xe=ge=>{if(ge.preventDefault(),!Gg(v)&&e){if(Z){const Fe=document.createElement("div");Fe.className="fixed top-20 right-4 bg-red-50 border-l-4 border-red-500 text-red-800 px-6 py-4 rounded-lg shadow-lg z-50 animate-slide-in-right max-w-md",Fe.innerHTML=`
                    <div class="flex items-start space-x-3">
                        <span class="text-2xl"></span>
                        <div>
                            <p class="font-semibold mb-1">Message non envoy</p>
                            <p class="text-sm">${A} est en mode <strong>Ne pas dranger</strong>. Votre message ne peut pas tre envoy pour le moment.</p>
                        </div>
                    </div>
                `,document.body.appendChild(Fe),setTimeout(()=>{Fe.classList.add("animate-fade-out"),setTimeout(()=>Fe.remove(),300)},5e3);return}h.includes(e)||f(e),k(!1),c(e),n(v,e),w(""),K.current&&clearTimeout(K.current)}},qe=(()=>!e||a.size===0?null:Array.from(a.keys()).includes(e)?`${A||e} est en train d'crire...`:null)(),Ze=j?{id:j.userId,username:j.username,email:j.email,avatarUrl:j.avatarUrl}:e?{id:e,username:A,avatarUrl:P}:null;return e?b.jsxs("div",{className:"flex-1 flex flex-col bg-white/30 backdrop-blur-sm overflow-hidden rounded-tl-2xl shadow-inner",children:[b.jsxs("div",{className:"p-4 border-b border-gray-200/60 bg-white/50 backdrop-blur-md flex items-center justify-between shadow-sm z-10",children:[b.jsxs("div",{className:"flex items-center gap-3",children:[P?b.jsx("img",{src:P,alt:A,className:"w-10 h-10 rounded-full object-cover shadow-md"}):b.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-primary-500 to-accent-500 flex items-center justify-center text-white font-bold shadow-md",children:((ut=A[0])==null?void 0:ut.toUpperCase())||"?"}),b.jsxs("div",{children:[b.jsx("h3",{className:"font-semibold text-gray-800",children:A}),b.jsxs("div",{className:"flex flex-col",children:[(()=>{const ge=j?j.status||"online":"offline",Fe={online:{label:"En ligne",color:"bg-green-500",textColor:"text-green-600"},busy:{label:"Occup(e)",color:"bg-red-500",textColor:"text-red-600"},away:{label:"Absent(e)",color:"bg-yellow-500",textColor:"text-yellow-600"},dnd:{label:"Ne pas dranger",color:"bg-red-600",textColor:"text-red-700"},offline:{label:"Hors ligne",color:"bg-gray-400",textColor:"text-gray-400"}},Pt=Fe[ge]||Fe.offline;return b.jsxs("span",{className:`text-xs flex items-center gap-1 font-medium ${Pt.textColor}`,children:[b.jsx("span",{className:`w-2 h-2 rounded-full ${Pt.color} ${ge==="online"?"animate-pulse":""}`}),Pt.label]})})(),xe&&b.jsxs("span",{className:`text-[10px] flex items-center gap-1 font-medium ${xe.color}`,children:[b.jsx("span",{children:xe.icon}),xe.text]})]})]})]}),b.jsxs("div",{className:"flex items-center gap-4",children:[e&&b.jsx(aAe,{userId:e}),b.jsxs("div",{className:"flex space-x-2",children:[b.jsx("button",{onClick:()=>I(!0),className:"p-2 text-gray-500 hover:text-primary-500 transition-colors rounded-full hover:bg-primary-50",title:"Voir le profil",children:""}),b.jsx("button",{onClick:()=>e&&y(e,"audio"),className:"p-2 text-gray-500 hover:text-green-500 transition-colors rounded-full hover:bg-green-50",title:"Appel audio",children:""}),b.jsx("button",{onClick:()=>e&&y(e,"video"),className:"p-2 text-gray-500 hover:text-green-500 transition-colors rounded-full hover:bg-green-50",title:"Appel vido",children:""}),b.jsx("button",{onClick:()=>N(!0),className:"p-2 text-gray-500 hover:text-blue-500 transition-colors rounded-full hover:bg-blue-50",title:"Rechercher",children:""}),b.jsx("button",{onClick:()=>e&&i(e),className:"p-2 text-gray-500 hover:text-red-500 transition-colors rounded-full hover:bg-red-50",title:"Effacer l'historique",children:""}),b.jsx("button",{onClick:()=>e&&o(e),className:"p-2 text-gray-500 hover:text-blue-500 transition-colors rounded-full hover:bg-blue-50",title:"Exporter la conversation",children:""})]})]})]}),b.jsx(mne,{isOpen:C,onClose:()=>N(!1)}),x.autoSummarize&&e&&b.jsx("div",{className:"px-4 pt-4 z-10",children:b.jsx(iAe,{messages:t,conversationId:e,participantName:A})}),b.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[t.filter(ge=>(ge.sender===e||ge.sender==="me"&&e)&&!ge.isPendingAuth).map((ge,Fe,Pt)=>{var ko;const yt=ge.sender==="me",dn=Pt[Fe+1],Ct=!dn,Kn=dn&&dn.sender!==ge.sender,qn=dn&&new Date(dn.timestamp).getTime()-new Date(ge.timestamp).getTime()>6e4,on=Ct||Kn||qn,hr=on?"mb-4":"mb-1",_i=!yt&&on;return b.jsxs("div",{className:`flex ${yt?"justify-end":"justify-start items-end gap-2"} animate-fade-in-up ${hr}`,children:[!yt&&b.jsx("div",{className:"w-8 h-8 flex-shrink-0",children:_i&&(P?b.jsx("img",{src:P,alt:A,className:"w-8 h-8 rounded-full object-cover shadow-sm"}):b.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-gray-400 to-gray-500 flex items-center justify-center text-white text-xs font-bold",children:(ko=A[0])==null?void 0:ko.toUpperCase()}))}),b.jsxs("div",{className:`max-w-[70%] shadow-lg rounded-3xl backdrop-blur-sm transition-all duration-300 ease-out animate-[slideUp_0.3s_ease-out] ${yt?"bg-gradient-to-br from-primary-500 via-primary-600 to-primary-700 "+(on?"rounded-br-md":"rounded-br-2xl"):"bg-gradient-to-br from-gray-50 to-gray-100 border border-gray-200/50 "+(on?"rounded-bl-md":"rounded-bl-2xl")} ${ge.type==="file"?"p-1 bg-none border-none shadow-none !bg-transparent":"px-6 py-3"}`,children:[ge.type==="file"?b.jsx(oAe,{message:ge,isMe:yt}):b.jsx("div",{className:`leading-relaxed break-words prose prose-sm max-w-none ${yt?"text-white":"text-gray-800"}`,dangerouslySetInnerHTML:{__html:RC(ge.content)}}),on&&b.jsxs("span",{className:`text-[10px] mt-1 block text-right ${yt?"text-primary-100":"text-gray-400"} ${ge.type==="file"?"pr-2":""}`,children:[new Date(ge.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),yt&&b.jsxs("span",{className:"ml-1 text-xs opacity-70 inline-flex items-center gap-0.5",title:ge.status,children:[ge.status==="pending"&&"",ge.status==="sent"&&"",ge.status==="delivered"&&"",ge.status==="read"&&b.jsx("span",{className:"text-blue-200 font-bold",children:""}),ge.status==="refused"&&b.jsx("span",{className:"text-red-300",children:""})]})]})]})]},ge.id)}),b.jsx("div",{ref:U}),qe&&b.jsx("div",{className:"flex justify-start animate-fade-in-up",children:b.jsx("div",{className:"bg-white border border-gray-200 rounded-2xl rounded-bl-none px-4 py-2 shadow-sm",children:b.jsxs("div",{className:"flex items-center space-x-2",children:[b.jsxs("div",{className:"flex space-x-1",children:[b.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),b.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),b.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]}),b.jsx("span",{className:"text-xs text-gray-500 italic",children:qe})]})})})]}),t.length>0&&G&&b.jsx("div",{className:"px-4",children:b.jsx(F2e,{lastMessage:((et=t[t.length-1])==null?void 0:et.content)||"",messageContext:pe(),onSuggestionSelect:le})}),!te&&t.some(ge=>ge.sender===e&&ge.isPendingAuth)?b.jsxs("div",{className:"p-6 bg-white/80 border-t border-gray-200/60 backdrop-blur-md flex flex-col items-center justify-center space-y-4 animate-fade-in-up",children:[b.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center text-2xl",children:""}),b.jsxs("div",{className:"text-center",children:[b.jsx("h3",{className:"font-semibold text-gray-800",children:"Nouvelle demande de conversation"}),b.jsxs("p",{className:"text-gray-600 text-sm mt-1",children:[(j==null?void 0:j.username)||"Cet utilisateur"," souhaite discuter avec vous."]})]}),b.jsxs("div",{className:"flex space-x-3",children:[b.jsx("button",{onClick:()=>p(e),className:"bg-gradient-to-r from-primary-500 to-accent-500 hover:from-primary-600 hover:to-accent-600 text-white px-6 py-2 rounded-xl font-medium transition-all shadow-md hover:shadow-lg transform active:scale-95",children:"Toujours autoriser"}),b.jsx("button",{onClick:()=>F(!0),className:"bg-white border border-gray-200 hover:bg-gray-50 text-gray-700 px-6 py-2 rounded-xl font-medium transition-all shadow-sm hover:shadow-md",children:"Accepter (Session)"}),b.jsx("button",{onClick:()=>m(e),className:"bg-red-50 border border-red-100 hover:bg-red-100 text-red-600 px-6 py-2 rounded-xl font-medium transition-all shadow-sm hover:shadow-md",children:"Refuser"})]})]}):b.jsxs("form",{onSubmit:Xe,className:"p-4 bg-white/50 border-t border-gray-200/60 backdrop-blur-md",children:[Z&&b.jsxs("div",{className:"mb-3 bg-red-50 border border-red-200 rounded-lg px-4 py-3 flex items-start space-x-3 animate-fade-in",children:[b.jsx("span",{className:"text-xl",children:""}),b.jsxs("div",{className:"flex-1",children:[b.jsx("p",{className:"text-sm font-semibold text-red-800 mb-1",children:"Mode Ne pas dranger actif"}),b.jsxs("p",{className:"text-xs text-red-600",children:[A," a activ le mode Ne pas dranger. L'envoi de messages est temporairement dsactiv."]})]})]}),b.jsx("div",{className:"flex items-center space-x-2 mb-2",children:d?b.jsxs("div",{className:"flex items-center space-x-1 text-green-500 text-xs",children:[b.jsx("span",{children:""}),b.jsx("span",{children:"Messages chiffrs de bout en bout"})]}):b.jsxs("div",{className:"flex items-center space-x-1 text-yellow-500 text-xs",children:[b.jsx("span",{children:""}),b.jsx("span",{children:"Messages non chiffrs"})]})}),b.jsxs("div",{className:"flex gap-3 items-end",children:[e&&b.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[b.jsx(pne,{peerId:e}),b.jsx("button",{onClick:Ae,className:`p-2.5 rounded-xl transition-all duration-200 shadow-sm hover:shadow-md transform hover:scale-105 ${G?"bg-gradient-to-r from-blue-500 to-purple-500 text-white":"bg-white border border-gray-200 text-gray-400 hover:text-blue-500 hover:border-blue-300"}`,title:G?"Dsactiver les suggestions AI":"Activer les suggestions AI",children:G?"":""})]}),b.jsx(kLe,{value:v,onChange:Qe,onSubmit:()=>{!Gg(v)&&!Z&&Xe({preventDefault:()=>{}})},placeholder:Z?`${A} est en mode Ne pas dranger`:"crivez votre message...",disabled:Z}),b.jsx("button",{type:"submit",disabled:Gg(v)||Z,className:"bg-gradient-to-r from-primary-500 to-accent-500 hover:from-primary-600 hover:to-accent-600 text-white px-6 py-2 rounded-xl font-medium transition-all shadow-md hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed disabled:shadow-none transform active:scale-95 mb-2",title:Z?`${A} est en mode Ne pas dranger`:"Envoyer (Enter)",children:"Envoyer"})]})]}),Ze&&b.jsx(Cb,{isOpen:T,onClose:()=>I(!1),user:Ze,isOnline:!!j})]}):b.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center bg-white/30 backdrop-blur-sm text-gray-500 p-8 text-center",children:[b.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-primary-100 to-accent-100 rounded-full flex items-center justify-center mb-6 animate-float",children:b.jsx("span",{className:"text-4xl",children:""})}),b.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Bienvenue sur PaLFroG"}),b.jsx("p",{className:"max-w-md",children:"Slectionnez un contact dans la liste pour dmarrer une conversation scurise en Peer-to-Peer."})]})},yA=({isOpen:t,title:e,message:n,onConfirm:s,onCancel:r,confirmText:i="Confirmer",cancelText:o="Annuler",isDangerous:a=!1})=>t?b.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",children:b.jsxs("div",{className:"bg-white rounded-2xl shadow-xl max-w-md w-full p-6 transform transition-all scale-100",children:[b.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:e}),b.jsx("p",{className:"text-gray-600 mb-6",children:n}),b.jsxs("div",{className:"flex justify-end gap-3",children:[b.jsx("button",{onClick:r,className:"px-4 py-2 rounded-xl text-gray-600 hover:bg-gray-100 font-medium transition-colors",children:o}),b.jsx("button",{onClick:s,className:`px-4 py-2 rounded-xl text-white font-medium transition-colors shadow-sm ${a?"bg-red-500 hover:bg-red-600 shadow-red-200":"bg-primary-500 hover:bg-primary-600 shadow-primary-200"}`,children:i})]})]})}):null,NLe=()=>{const{activeChat:t,setActiveChat:e,onlineUsers:n,messages:s,totalUnreadCount:r,clearChatHistory:i,exportChat:o,createPeerConnection:a}=Be(),{user:l,setCurrentView:c}=_t(),[u,d]=z.useState([]),[h,f]=z.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{}}),p=async()=>{const v=(await Pn.getAllChats()).sort((w,S)=>w.unreadCount>0&&S.unreadCount===0?-1:w.unreadCount===0&&S.unreadCount>0?1:new Date(S.lastActivity).getTime()-new Date(w.lastActivity).getTime());d(v)};z.useEffect(()=>{p()},[s,t,r]);const m=async x=>{e(x),await a(x),c("chat")},g=async(x,v)=>{x.stopPropagation(),f({isOpen:!0,title:"Supprimer la conversation",message:"Voulez-vous vraiment supprimer cette conversation ?",onConfirm:async()=>{try{await i(v),p(),Yt.success("Conversation supprime")}catch{Yt.error("Erreur lors de la suppression")}f(w=>({...w,isOpen:!1}))}})},y=async(x,v)=>{x.stopPropagation(),await o(v),Yt.success("Conversation exporte")};return b.jsxs("div",{className:"flex flex-col h-full bg-white/50 backdrop-blur-sm",children:[b.jsx(yA,{isOpen:h.isOpen,title:h.title,message:h.message,onConfirm:h.onConfirm,onCancel:()=>f(x=>({...x,isOpen:!1})),isDangerous:!0}),b.jsx("div",{className:"p-4 border-b border-gray-200/60",children:b.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Messages"})}),b.jsxs("div",{className:"flex-1 overflow-y-auto p-2 space-y-2",children:[u.length===0&&b.jsx("div",{className:"p-8 text-center text-gray-500",children:"Aucune conversation"}),u.map(x=>{var T;const v=n.find(I=>I.userId===x.participantId),w=!!v,S=t===x.participantId,k=x.unreadCount>0,C=(v==null?void 0:v.username)||x.participantName,N=(v==null?void 0:v.avatarUrl)||x.avatarUrl;return b.jsxs("div",{onClick:()=>m(x.participantId),className:`
                                w-full p-3 flex items-center gap-3 rounded-xl transition-all duration-200 cursor-pointer group relative
                                ${S?"bg-primary-50 border border-primary-100 shadow-sm":"hover:bg-white hover:shadow-sm border border-transparent"}
                                ${k?"bg-blue-50/50":""}
                            `,children:[b.jsxs("div",{className:"relative flex-shrink-0",children:[N?b.jsx("img",{src:N,alt:C,className:"w-12 h-12 rounded-full object-cover shadow-sm"}):b.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center text-gray-600 font-bold shadow-sm",children:((T=C[0])==null?void 0:T.toUpperCase())||"?"}),w&&b.jsx("div",{className:"absolute bottom-0 right-0 w-3 h-3 rounded-full bg-green-500 border-2 border-white"})]}),b.jsxs("div",{className:"flex-1 min-w-0",children:[b.jsxs("div",{className:"flex justify-between items-baseline",children:[b.jsx("h3",{className:`truncate text-sm ${k?"font-bold text-gray-900":"font-medium text-gray-700"}`,children:C}),b.jsx("span",{className:"text-xs text-gray-400 ml-2 flex-shrink-0",children:new Date(x.lastActivity).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),b.jsx("p",{className:`truncate text-xs mt-0.5 ${k?"font-semibold text-gray-800":"text-gray-500"}`,children:(()=>{try{if(x.lastMessage.startsWith("{")&&x.lastMessage.includes('"type":')){const I=JSON.parse(x.lastMessage);if(I.type==="file_offer"||I.type==="file_metadata")return` Fichier : ${I.name||"Inconnu"}`;if(I.type==="encrypted_message")return" Message chiffr"}return DC(x.lastMessage)}catch{return DC(x.lastMessage)}})()})]}),k&&b.jsx("div",{className:"min-w-[20px] h-5 flex items-center justify-center bg-red-500 text-white text-xs font-bold rounded-full px-1.5 shadow-sm",children:x.unreadCount}),b.jsxs("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity bg-white/90 rounded-lg shadow-sm p-1",children:[b.jsx("button",{onClick:I=>y(I,x.participantId),className:"p-1.5 hover:bg-gray-100 rounded-md text-gray-500 hover:text-blue-600 transition-colors",title:"Exporter",children:""}),b.jsx("button",{onClick:I=>g(I,x.participantId),className:"p-1.5 hover:bg-gray-100 rounded-md text-gray-500 hover:text-red-600 transition-colors",title:"Supprimer",children:""})]})]},x.id)})]})]})},o6={createConversation:async t=>(await Fn.post("/chat/conversations",{userIds:t})).data,getConversations:async()=>(await Fn.get("/chat/conversations")).data,getMessages:async t=>(await Fn.get(`/chat/conversations/${t}/messages`)).data,sendMessage:async(t,e,n="TEXT")=>(await Fn.post(`/chat/conversations/${t}/messages`,{content:e,type:n})).data},a6=()=>{const{onlineUsers:t,createPeerConnection:e,setActiveChat:n,activeChat:s}=Be(),{user:r,setCurrentView:i}=_t(),[o,a]=z.useState([]),[l,c]=z.useState(null),[u,d]=z.useState(!1),[h,f]=z.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{}}),p=async()=>{try{const v=await Vo.getFriends();a(v)}catch(v){console.error("Failed to load friends:",v)}};z.useEffect(()=>{p()},[]);const m=async v=>{try{await o6.createConversation([v]),n(v),await e(v),i("chat")}catch(w){console.error("Error opening chat:",w)}},g=(v,w)=>{w.stopPropagation(),f({isOpen:!0,title:"Retirer un ami",message:"Voulez-vous vraiment retirer cet ami de votre liste ?",isDangerous:!0,onConfirm:async()=>{try{await Vo.removeFriend(v),p(),Yt.success("Ami retir")}catch(S){console.error("Error removing friend:",S),Yt.error("Erreur lors de la suppression")}f(S=>({...S,isOpen:!1}))}})},y=(v,w)=>{w.stopPropagation(),f({isOpen:!0,title:"Bloquer un utilisateur",message:"Voulez-vous vraiment bloquer cet utilisateur ? Il ne pourra plus vous contacter.",isDangerous:!0,onConfirm:async()=>{try{await Vo.blockUser(v),p(),Yt.success("Utilisateur bloqu")}catch(S){console.error("Error blocking user:",S),Yt.error("Erreur lors du blocage")}f(S=>({...S,isOpen:!1}))}})},x=async(v,w)=>{w.stopPropagation();try{await Vo.unblockUser(v),p(),Yt.success("Utilisateur dbloqu")}catch(S){console.error("Error unblocking user:",S),Yt.error("Erreur lors du dblocage")}};return b.jsxs("div",{className:"flex flex-col h-full bg-white/50 backdrop-blur-sm",children:[b.jsx(yA,{isOpen:h.isOpen,title:h.title,message:h.message,onConfirm:h.onConfirm,onCancel:()=>f(v=>({...v,isOpen:!1})),isDangerous:h.isDangerous}),b.jsx(Cb,{isOpen:u,onClose:()=>d(!1),user:l,isOnline:l?t.some(v=>v.userId===l.id):!1}),b.jsxs("div",{className:"p-4 border-b border-gray-200/60",children:[b.jsx(Vz,{}),b.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Mes Amis"})]}),b.jsxs("div",{className:"flex-1 overflow-y-auto p-2 space-y-2",children:[o.map(v=>{var F;const w=v.friend,S=v.status==="BLOCKED",k=t.find(A=>A.userId===w.id),C=k?k.status||"online":"offline",N=C!=="offline",T={online:{label:"En ligne",color:"bg-green-500",textColor:"text-green-600"},busy:{label:"Occup(e)",color:"bg-red-500",textColor:"text-red-600"},away:{label:"Absent(e)",color:"bg-yellow-500",textColor:"text-yellow-600"},dnd:{label:"Ne pas dranger",color:"bg-red-600",textColor:"text-red-700"},offline:{label:"Hors ligne",color:"bg-gray-400",textColor:"text-gray-400"}},I=T[C]||T.offline,D=(k==null?void 0:k.avatarUrl)||((F=w.profile)==null?void 0:F.avatarUrl)||w.avatarUrl;return b.jsxs("div",{onDoubleClick:()=>!S&&m(w.id),className:`w-full p-3 flex items-center justify-between rounded-xl transition-all duration-200 group cursor-pointer
              ${s===w.id?"bg-primary-50 border border-primary-100 shadow-sm":"hover:bg-white hover:shadow-sm border border-transparent"}
              ${S?"opacity-75 bg-gray-50":""}
            `,children:[b.jsxs("div",{className:"flex items-center gap-3",children:[b.jsxs("div",{className:"relative",children:[D?b.jsx("img",{src:D,alt:w.username,className:`w-10 h-10 rounded-full object-cover shadow-md transition-transform ${S?"grayscale":"group-hover:scale-105"}`}):b.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-white font-bold shadow-md transition-transform ${S?"bg-gray-400":"bg-gradient-to-br from-primary-500 to-accent-500 group-hover:scale-105"}`,children:w.username[0].toUpperCase()}),!S&&N&&b.jsx("div",{className:`absolute bottom-0 right-0 w-3 h-3 rounded-full ${I.color} border-2 border-white`})]}),b.jsxs("div",{children:[b.jsxs("div",{className:"font-medium text-gray-800 flex items-center gap-2",children:[w.username,S&&b.jsx("span",{className:"text-[10px] px-1.5 py-0.5 bg-orange-100 text-orange-600 rounded-full font-bold uppercase tracking-wider",children:"Bloqu"})]}),b.jsx("div",{className:`text-xs font-medium ${S?"text-orange-500":I.textColor}`,children:S?"Bloqu":I.label})]})]}),b.jsxs("div",{className:"flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[!S&&b.jsxs(b.Fragment,{children:[b.jsx("button",{onClick:A=>{A.stopPropagation(),m(w.id)},className:"p-2 text-blue-500 hover:bg-blue-50 rounded-lg transition-colors",title:"Envoyer un message",children:""}),b.jsx("button",{onClick:A=>{A.stopPropagation(),c(w),d(!0)},className:"p-2 text-purple-500 hover:bg-purple-50 rounded-lg transition-colors",title:"Voir profil",children:""})]}),S&&b.jsx("button",{onClick:A=>x(w.id,A),className:"p-2 text-orange-500 hover:bg-orange-50 rounded-lg transition-colors",title:"Dbloquer",children:""}),b.jsx("button",{onClick:A=>g(w.id,A),className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors",title:"Retirer des amis",children:""}),!S&&b.jsx("button",{onClick:A=>y(w.id,A),className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors",title:"Bloquer",children:""})]})]},w.id)}),o.length===0&&b.jsxs("div",{className:"p-8 text-center",children:[b.jsx("div",{className:"text-4xl mb-3",children:""}),b.jsx("p",{className:"text-gray-500 text-sm",children:"Vous n'avez pas encore d'amis."}),b.jsx("button",{onClick:()=>i("friend-search"),className:"text-xs text-primary-500 mt-2 hover:underline hover:text-primary-600 transition-colors",children:`Utilisez l'onglet "Ajout" pour en trouver !`})]})]})]})},TLe=()=>{const[t,e]=z.useState("contacts");return b.jsxs("div",{className:"flex flex-col h-full bg-white/30 backdrop-blur-sm",children:[b.jsxs("div",{className:"flex p-2 gap-1 border-b border-gray-200/60 bg-white/50 overflow-x-auto",children:[b.jsx("button",{onClick:()=>e("contacts"),className:`flex-1 py-2 px-2 rounded-lg text-xs font-medium transition-all duration-200 whitespace-nowrap
                        ${t==="contacts"?"bg-white text-primary-600 shadow-sm":"text-gray-500 hover:bg-white/50 hover:text-gray-700"}`,children:"Contacts"}),b.jsx("button",{onClick:()=>e("messages"),className:`flex-1 py-2 px-2 rounded-lg text-xs font-medium transition-all duration-200 whitespace-nowrap
                        ${t==="messages"?"bg-white text-primary-600 shadow-sm":"text-gray-500 hover:bg-white/50 hover:text-gray-700"}`,children:"Messages"})]}),b.jsxs("div",{className:"flex-1 overflow-hidden",children:[t==="messages"&&b.jsx(NLe,{}),t==="contacts"&&b.jsx(a6,{})]})]})},ELe=()=>{const[t,e]=z.useState("default"),[n,s]=z.useState(!0),[r,i]=z.useState(!0);z.useEffect(()=>{"Notification"in window&&e(Notification.permission);const d=localStorage.getItem("palfrog-sounds-enabled"),h=localStorage.getItem("palfrog-desktop-notifications");d!==null&&s(JSON.parse(d)),h!==null&&i(JSON.parse(h))},[]);const o=async()=>{const d=await qo.requestPermission();e(d?"granted":"denied")},a=d=>{s(d),localStorage.setItem("palfrog-sounds-enabled",JSON.stringify(d))},l=d=>{i(d),localStorage.setItem("palfrog-desktop-notifications",JSON.stringify(d))},c=async()=>{await qo.notifyNewMessage({id:"test",content:"Ceci est une notification de test",sender:"Systme",chatId:"test"})},u=async()=>{await qo.playNotificationSound("message")};return b.jsx("div",{className:"space-y-6",children:b.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-200",children:[b.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:" Notifications"}),b.jsxs("div",{className:"flex items-center justify-between py-3",children:[b.jsxs("div",{children:[b.jsx("p",{className:"font-medium text-gray-900",children:"Permissions navigateur"}),b.jsx("p",{className:"text-sm text-gray-500",children:t==="granted"?" Autorises":t==="denied"?" Bloques":" En attente"})]}),t!=="granted"&&b.jsx("button",{onClick:o,className:"px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors",children:"Autoriser"})]}),b.jsxs("div",{className:"flex items-center justify-between py-3 border-t border-gray-100",children:[b.jsxs("div",{children:[b.jsx("p",{className:"font-medium text-gray-900",children:"Sons de notification"}),b.jsx("p",{className:"text-sm text-gray-500",children:"Jouer un son pour les nouveaux messages"})]}),b.jsxs("div",{className:"flex items-center space-x-3",children:[b.jsx("button",{onClick:()=>u(),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",title:"Tester le son",children:""}),b.jsxs("button",{onClick:()=>a(!n),className:"relative inline-block w-12 h-6 focus:outline-none",children:[b.jsx("input",{type:"checkbox",checked:n,onChange:()=>{},className:"sr-only"}),b.jsx("div",{className:`
                w-12 h-6 rounded-full transition-colors duration-200
                ${n?"bg-primary-500":"bg-gray-300"}
              `}),b.jsx("div",{className:`
                absolute top-1 w-4 h-4 bg-white rounded-full transition-transform duration-200 shadow-sm
                ${n?"transform translate-x-7":"transform translate-x-1"}
              `})]})]})]}),b.jsxs("div",{className:"flex items-center justify-between py-3 border-t border-gray-100",children:[b.jsxs("div",{children:[b.jsx("p",{className:"font-medium text-gray-900",children:"Notifications desktop"}),b.jsx("p",{className:"text-sm text-gray-500",children:"Afficher les notifications hors de l'application"})]}),b.jsxs("div",{className:"flex items-center space-x-3",children:[b.jsx("button",{onClick:()=>c(),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",title:"Tester la notification",children:""}),b.jsxs("button",{onClick:()=>l(!r),className:"relative inline-block w-12 h-6 focus:outline-none",children:[b.jsx("input",{type:"checkbox",checked:r,onChange:()=>{},className:"sr-only"}),b.jsx("div",{className:`
                w-12 h-6 rounded-full transition-colors duration-200
                ${r?"bg-primary-500":"bg-gray-300"}
              `}),b.jsx("div",{className:`
                absolute top-1 w-4 h-4 bg-white rounded-full transition-transform duration-200 shadow-sm
                ${r?"transform translate-x-7":"transform translate-x-1"}
              `})]})]})]}),b.jsx("div",{className:"mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200",children:b.jsx("p",{className:"text-sm text-blue-700",children:" Les notifications vous alertent mme lorsque l'application est en arrire-plan."})})]})})},ILe=Fs.lazy(()=>bs(()=>import("./CallInterface-b8ff4b39.js"),[]).then(t=>({default:t.CallInterface})));Fs.lazy(()=>bs(()=>import("./FileTransferList-0af0f8c6.js"),[]).then(t=>({default:t.FileTransferList})));const tL=Fs.lazy(()=>bs(()=>import("./SecuritySettings-87a91d25.js"),[]).then(t=>({default:t.SecuritySettings}))),ALe=()=>b.jsx("div",{className:"flex items-center justify-center p-8",children:b.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500"})});class $Le{constructor(){$e(this,"connections",new Map);$e(this,"messageQueue",[]);$e(this,"isProcessing",!1);this.initializeDefaultConnections(),this.startMessageProcessor()}initializeDefaultConnections(){[{id:"whatsapp-bridge",type:"whatsapp",status:"disconnected",lastSync:null,settings:{autoImport:!0,autoExport:!1,syncInterval:30},statistics:{messagesImported:0,messagesExported:0,lastActivity:new Date}},{id:"telegram-bridge",type:"telegram",status:"disconnected",lastSync:null,settings:{autoImport:!0,autoExport:!1,syncInterval:30},statistics:{messagesImported:0,messagesExported:0,lastActivity:new Date}},{id:"signal-bridge",type:"signal",status:"disconnected",lastSync:null,settings:{autoImport:!0,autoExport:!1,syncInterval:30},statistics:{messagesImported:0,messagesExported:0,lastActivity:new Date}},{id:"email-bridge",type:"email",status:"disconnected",lastSync:null,settings:{autoImport:!0,autoExport:!0,syncInterval:60},statistics:{messagesImported:0,messagesExported:0,lastActivity:new Date}},{id:"sms-bridge",type:"sms",status:"disconnected",lastSync:null,settings:{autoImport:!0,autoExport:!0,syncInterval:15},statistics:{messagesImported:0,messagesExported:0,lastActivity:new Date}}].forEach(n=>{this.connections.set(n.id,n)})}async connectWhatsApp(e){const n="whatsapp-bridge",s=this.connections.get(n);if(!s)return!1;try{return console.log("Connecting to WhatsApp for:",e),await this.simulateAPICall(2e3),s.status="connected",s.lastSync=new Date,this.connections.set(n,s),this.startSync(n),!0}catch(r){return console.error("WhatsApp connection failed:",r),s.status="error",this.connections.set(n,s),!1}}async connectTelegram(e){const n="telegram-bridge",s=this.connections.get(n);if(!s)return!1;try{const r=await this.telegramAPI(e);return r.success?(s.status="connected",s.lastSync=new Date,s.settings.telegramSession=r.session,this.connections.set(n,s),this.startSync(n),!0):!1}catch(r){return console.error("Telegram connection failed:",r),s.status="error",this.connections.set(n,s),!1}}async importFromWhatsApp(e,n=100){const s="whatsapp-bridge",r=this.connections.get(s);if(!r||r.status!=="connected")throw new Error("WhatsApp bridge not connected");try{const i=await this.simulateWhatsAppImport(e,n);return await this.processImportedMessages(s,i),r.statistics.messagesImported+=i.length,r.statistics.lastActivity=new Date,this.connections.set(s,r),i}catch(i){throw console.error("WhatsApp import failed:",i),i}}async exportToWhatsApp(e,n){const s="whatsapp-bridge",r=this.connections.get(s);if(!r||r.status!=="connected")throw new Error("WhatsApp bridge not connected");try{return await this.simulateWhatsAppExport(e,n),r.statistics.messagesExported+=n.length,r.statistics.lastActivity=new Date,this.connections.set(s,r),!0}catch(i){throw console.error("WhatsApp export failed:",i),i}}async migrateFromSignal(e){var n,s;try{const r=await this.readSignalBackup(e),i=this.convertSignalToPalfrog(r);return await this.bulkImportMessages(i),{success:!0,stats:{messages:i.length,contacts:new Set(i.map(o=>o.sender)).size,period:{start:(n=i[0])==null?void 0:n.timestamp,end:(s=i[i.length-1])==null?void 0:s.timestamp}}}}catch(r){return console.error("Signal migration failed:",r),{success:!1,stats:{}}}}async setupEmailBridge(e,n){const s="email-bridge",r=this.connections.get(s);if(!r)return!1;try{return r.settings.email=e,r.settings.imap=n,r.status="connected",this.connections.set(s,r),this.startEmailMonitoring(s),!0}catch(i){return console.error("Email bridge setup failed:",i),!1}}async setupSMSBridge(e){const n="sms-bridge",s=this.connections.get(n);if(!s)return!1;try{if(!this.checkSMSPermissions())throw new Error("SMS permissions required");return s.settings.phoneNumber=e,s.status="connected",this.connections.set(n,s),this.startSMSMonitoring(n),!0}catch(r){return console.error("SMS bridge setup failed:",r),!1}}async processImportedMessages(e,n){const s=n.map(r=>({id:`bridge-${Date.now()}-${Math.random()}`,bridgeId:e,externalId:r.id,content:r.content,sender:r.sender,timestamp:new Date(r.timestamp),direction:"import",status:"pending"}));this.messageQueue.push(...s),this.processMessageQueue()}startMessageProcessor(){setInterval(()=>{this.processMessageQueue()},5e3)}async processMessageQueue(){if(!(this.isProcessing||this.messageQueue.length===0)){this.isProcessing=!0;try{const e=this.messageQueue.splice(0,10);for(const n of e)try{await this.importMessageToPalfrog(n),n.status="success"}catch(s){console.error("Failed to import message:",s),n.status="failed"}this.saveMessageQueue()}finally{this.isProcessing=!1}}}async importMessageToPalfrog(e){const{addMessage:n}=Be.getState();n({id:e.id,content:e.content,sender:e.sender,timestamp:e.timestamp,type:"text",bridge:{source:e.bridgeId,externalId:e.externalId}})}startSync(e){const n=this.connections.get(e);if(!n)return;const s=setInterval(async()=>{if(n.status!=="connected"){clearInterval(s);return}try{n.status="syncing",this.connections.set(e,n),await this.performBridgeSync(e),n.status="connected",n.lastSync=new Date,this.connections.set(e,n)}catch(r){console.error(`Sync failed for ${e}:`,r),n.status="error",this.connections.set(e,n)}},n.settings.syncInterval*60*1e3)}async simulateAPICall(e){return new Promise(n=>setTimeout(n,e))}async simulateWhatsAppImport(e,n){return await this.simulateAPICall(1e3),Array.from({length:Math.min(n,50)},(s,r)=>({id:`wa-${e}-${r}`,content:`Message WhatsApp exemple ${r+1}`,sender:e,timestamp:new Date(Date.now()-r*6e4),type:"text"}))}async simulateWhatsAppExport(e,n){await this.simulateAPICall(1500),console.log(`Exported ${n.length} messages to WhatsApp contact: ${e}`)}checkSMSPermissions(){return"sms"in navigator||typeof window.electron<"u"}async readSignalBackup(e){return new Promise((n,s)=>{const r=new FileReader;r.onload=i=>{var o;try{const a=(o=i.target)==null?void 0:o.result,l=JSON.parse(a);n(l)}catch{s(new Error("Invalid Signal backup file"))}},r.onerror=()=>s(new Error("Failed to read file")),r.readAsText(e)})}convertSignalToPalfrog(e){var n;return((n=e.messages)==null?void 0:n.map(s=>({id:`signal-${s.id}`,content:s.body||"",sender:s.source||"Unknown",timestamp:new Date(s.timestamp),type:"text",bridge:{source:"signal",originalId:s.id}})))||[]}async bulkImportMessages(e){const{addMessage:n}=Be.getState();e.forEach(s=>{n(s)})}async telegramAPI(e){return await this.simulateAPICall(1500),{success:!0,session:`tg-session-${e}`}}async performBridgeSync(e){switch(e){case"whatsapp-bridge":await this.syncWhatsApp();break;case"telegram-bridge":await this.syncTelegram();break;case"email-bridge":await this.syncEmail();break;case"sms-bridge":await this.syncSMS();break}}async syncWhatsApp(){console.log("Syncing WhatsApp...")}async syncTelegram(){console.log("Syncing Telegram...")}async syncEmail(){console.log("Syncing Email...")}async syncSMS(){console.log("Syncing SMS...")}startEmailMonitoring(e){console.log("Starting email monitoring for:",e)}startSMSMonitoring(e){console.log("Starting SMS monitoring for:",e)}saveMessageQueue(){localStorage.setItem("palfrog-bridge-queue",JSON.stringify(this.messageQueue))}getConnections(){return Array.from(this.connections.values())}getConnection(e){return this.connections.get(e)}updateConnectionSettings(e,n){const s=this.connections.get(e);return s?(s.settings={...s.settings,...n},this.connections.set(e,s),!0):!1}disconnectBridge(e){const n=this.connections.get(e);return n?(n.status="disconnected",this.connections.set(e,n),!0):!1}getQueueStats(){return{pending:this.messageQueue.filter(e=>e.status==="pending").length,success:this.messageQueue.filter(e=>e.status==="success").length,failed:this.messageQueue.filter(e=>e.status==="failed").length,total:this.messageQueue.length}}}const fr=new $Le,xA=wo()(v_((t,e)=>({connections:[],isImporting:!1,importProgress:0,migrationStats:{},connectToService:async(n,s)=>{try{let r=!1;switch(n){case"whatsapp":r=await fr.connectWhatsApp(s.phoneNumber);break;case"telegram":r=await fr.connectTelegram(s.phoneNumber);break;case"email":r=await fr.setupEmailBridge(s.email,s.imap);break;case"sms":r=await fr.setupSMSBridge(s.phoneNumber);break}return r&&t({connections:fr.getConnections()}),r}catch(r){return console.error(`Connection to ${n} failed:`,r),!1}},disconnectFromService:n=>{const s=`${n}-bridge`;fr.disconnectBridge(s),t({connections:fr.getConnections()})},importFromService:async(n,s)=>{t({isImporting:!0,importProgress:0});try{let r;const i=o=>{t({importProgress:o})};switch(n){case"whatsapp":r=await fr.importFromWhatsApp(s.contactId,s.limit);break;case"signal":r=await fr.migrateFromSignal(s.backupFile);break}return t({isImporting:!1,importProgress:100}),r}catch(r){throw t({isImporting:!1,importProgress:0}),r}},exportToService:async(n,s)=>{try{switch(n){case"whatsapp":return await fr.exportToWhatsApp("default-contact",s);default:return!1}}catch(r){return console.error(`Export to ${n} failed:`,r),!1}},migrateFromBackup:async(n,s)=>{t({isImporting:!0,importProgress:0});try{let r;switch(n){case"signal":r=await fr.migrateFromSignal(s);break}return t({isImporting:!1,importProgress:100,migrationStats:(r==null?void 0:r.stats)||{}}),r}catch(r){throw t({isImporting:!1,importProgress:0}),r}},updateBridgeSettings:(n,s)=>{const r=`${n}-bridge`;fr.updateConnectionSettings(r,s),t({connections:fr.getConnections()})}}),{name:"bridge-storage"})),RLe=()=>{const{t}=Er(),{connectToService:e,disconnectFromService:n,importFromService:s,connections:r}=xA(),[i,o]=z.useState(""),[a,l]=z.useState(!1),[c,u]=z.useState({contactId:"",limit:100}),d=r.find(g=>g.id==="whatsapp-bridge"),h=(d==null?void 0:d.status)==="connected",f=async()=>{if(i){l(!0);try{await e("whatsapp",{phoneNumber:i}),Yt.success(t("bridge.connected"))}catch{Yt.error(t("bridge.connectionFailed"))}finally{l(!1)}}},p=()=>{n("whatsapp"),Yt.success(t("bridge.disconnected"))},m=async()=>{if(c.contactId)try{await s("whatsapp",c),Yt.success(t("bridge.importSuccess"))}catch{Yt.error(t("bridge.importFailed"))}};return b.jsxs("div",{className:"space-y-6",children:[b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("div",{children:[b.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"WhatsApp Bridge"}),b.jsx("p",{className:"text-gray-600",children:t(h?"bridge.connectedDescription":"bridge.disconnectedDescription")})]}),b.jsx("div",{className:`px-4 py-2 rounded-full text-white text-sm font-medium ${h?"bg-green-500":"bg-gray-500"}`,children:t(h?"bridge.connected":"bridge.disconnected")})]}),!h&&b.jsxs("div",{className:"bg-blue-50 rounded-2xl p-6 border border-blue-200",children:[b.jsx("h4",{className:"font-semibold text-blue-900 mb-4",children:t("bridge.connectToService",{service:"WhatsApp"})}),b.jsxs("div",{className:"space-y-4",children:[b.jsxs("div",{children:[b.jsx("label",{className:"block text-sm font-medium text-blue-800 mb-2",children:t("bridge.phoneNumber")}),b.jsx("input",{type:"tel",value:i,onChange:g=>o(g.target.value),placeholder:"+33 1 23 45 67 89",className:"w-full px-4 py-3 border border-blue-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),b.jsx("button",{onClick:f,disabled:a||!i,className:"w-full px-6 py-3 bg-green-500 text-white rounded-xl hover:bg-green-600 disabled:opacity-50 transition-colors",children:t(a?"common.loading":"bridge.connect")})]})]}),h&&b.jsxs("div",{className:"space-y-6",children:[b.jsxs("div",{className:"bg-white rounded-2xl p-6 border border-gray-200",children:[b.jsx("h4",{className:"font-semibold text-gray-900 mb-4",children:t("bridge.importMessages")}),b.jsxs("div",{className:"space-y-4",children:[b.jsxs("div",{children:[b.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t("bridge.contactId")}),b.jsx("input",{type:"text",value:c.contactId,onChange:g=>u(y=>({...y,contactId:g.target.value})),placeholder:"ID du contact WhatsApp",className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),b.jsxs("div",{children:[b.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t("bridge.importLimit")}),b.jsx("input",{type:"number",value:c.limit,onChange:g=>u(y=>({...y,limit:parseInt(g.target.value)})),min:"1",max:"1000",className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),b.jsx("button",{onClick:m,disabled:!c.contactId,className:"w-full px-6 py-3 bg-blue-500 text-white rounded-xl hover:bg-blue-600 disabled:opacity-50 transition-colors",children:t("bridge.startImport")})]})]}),b.jsxs("div",{className:"bg-white rounded-2xl p-6 border border-gray-200",children:[b.jsx("h4",{className:"font-semibold text-gray-900 mb-4",children:t("bridge.settings")}),b.jsxs("div",{className:"space-y-4",children:[b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsx("span",{className:"text-gray-700",children:t("bridge.autoImport")}),b.jsxs("div",{className:"relative inline-block w-12 h-6",children:[b.jsx("input",{type:"checkbox",defaultChecked:d==null?void 0:d.settings.autoImport,className:"sr-only"}),b.jsx("div",{className:"w-12 h-6 bg-gray-300 rounded-full"}),b.jsx("div",{className:"absolute top-1 w-4 h-4 bg-white rounded-full transform translate-x-1"})]})]}),b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsx("span",{className:"text-gray-700",children:t("bridge.autoExport")}),b.jsxs("div",{className:"relative inline-block w-12 h-6",children:[b.jsx("input",{type:"checkbox",defaultChecked:d==null?void 0:d.settings.autoExport,className:"sr-only"}),b.jsx("div",{className:"w-12 h-6 bg-gray-300 rounded-full"}),b.jsx("div",{className:"absolute top-1 w-4 h-4 bg-white rounded-full transform translate-x-1"})]})]})]})]}),b.jsx("button",{onClick:p,className:"w-full px-6 py-3 bg-red-500 text-white rounded-xl hover:bg-red-600 transition-colors",children:t("bridge.disconnect")})]}),b.jsx("div",{className:"bg-yellow-50 rounded-2xl p-4 border border-yellow-200",children:b.jsxs("div",{className:"flex items-start space-x-3",children:[b.jsx("span",{className:"text-yellow-600 text-lg",children:""}),b.jsxs("div",{children:[b.jsx("h5",{className:"font-semibold text-yellow-800",children:t("bridge.securityNote")}),b.jsx("p",{className:"text-yellow-700 text-sm mt-1",children:t("bridge.whatsappSecurity")})]})]})})]})},DLe=()=>b.jsx("div",{children:"Telegram Bridge Placeholder"}),OLe=()=>b.jsx("div",{children:"Signal Bridge Placeholder"}),MLe=()=>b.jsx("div",{children:"Email Bridge Placeholder"}),PLe=()=>b.jsx("div",{children:"SMS Bridge Placeholder"}),LLe=()=>{const{t}=Er(),{connections:e}=xA(),[n,s]=z.useState("whatsapp"),i={whatsapp:RLe,telegram:DLe,signal:OLe,email:MLe,sms:PLe}[n],o=l=>{const c=e.find(u=>u.id===`${l}-bridge`);return(c==null?void 0:c.status)||"disconnected"},a=l=>{switch(l){case"connected":return"bg-green-500";case"syncing":return"bg-blue-500";case"error":return"bg-red-500";default:return"bg-gray-500"}};return b.jsxs("div",{className:"space-y-6",children:[b.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-200",children:[b.jsxs("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:[" ",t("bridge.dashboardTitle")]}),b.jsx("p",{className:"text-gray-600",children:t("bridge.dashboardDescription")})]}),b.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200",children:[b.jsx("div",{className:"border-b border-gray-200",children:b.jsx("nav",{className:"flex space-x-8 px-6","aria-label":"Tabs",children:[{id:"whatsapp",name:"WhatsApp",icon:""},{id:"telegram",name:"Telegram",icon:""},{id:"signal",name:"Signal",icon:""},{id:"email",name:"Email",icon:""},{id:"sms",name:"SMS",icon:""}].map(l=>{const c=o(l.id);return b.jsxs("button",{onClick:()=>s(l.id),className:`
                    flex items-center space-x-2 py-4 px-1 border-b-2 font-medium text-sm
                    ${n===l.id?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}
                  `,children:[b.jsx("span",{children:l.icon}),b.jsx("span",{children:l.name}),b.jsx("div",{className:`w-2 h-2 rounded-full ${a(c)}`})]},l.id)})})}),b.jsx("div",{className:"p-6",children:b.jsx(i,{})})]}),b.jsx(FLe,{})]})},FLe=()=>{const{connections:t}=xA(),{t:e}=Er(),n=t.reduce((s,r)=>({messagesImported:s.messagesImported+r.statistics.messagesImported,messagesExported:s.messagesExported+r.statistics.messagesExported,activeConnections:s.activeConnections+(r.status==="connected"?1:0)}),{messagesImported:0,messagesExported:0,activeConnections:0});return b.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[b.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-200 text-center",children:[b.jsx("div",{className:"text-3xl font-bold text-blue-600 mb-2",children:n.messagesImported}),b.jsx("div",{className:"text-gray-600",children:e("bridge.messagesImported")})]}),b.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-200 text-center",children:[b.jsx("div",{className:"text-3xl font-bold text-green-600 mb-2",children:n.messagesExported}),b.jsx("div",{className:"text-gray-600",children:e("bridge.messagesExported")})]}),b.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-200 text-center",children:[b.jsx("div",{className:"text-3xl font-bold text-purple-600 mb-2",children:n.activeConnections}),b.jsx("div",{className:"text-gray-600",children:e("bridge.activeConnections")})]})]})},_Le=()=>b.jsx(LLe,{});class zLe{constructor(){$e(this,"stats",{level:1,experience:0,points:0,streak:0,lastActivity:new Date,achievements:[],rank:"bronze"});$e(this,"achievements",[{id:"first_message",name:"Premier Pas",description:"Envoyez votre premier message",icon:"",points:50,category:"communication",rarity:"common",unlocked:!1,progress:0,maxProgress:1},{id:"security_master",name:"Matre de la Scurit",description:"Activez toutes les fonctionnalits de scurit",icon:"",points:200,category:"security",rarity:"epic",unlocked:!1,progress:0,maxProgress:5},{id:"social_butterfly",name:"Papillon Social",description:"Communiquez avec 10 contacts diffrents",icon:"",points:150,category:"social",rarity:"rare",unlocked:!1,progress:0,maxProgress:10},{id:"file_sharer",name:"Partageur Pro",description:"Partagez 50 fichiers",icon:"",points:100,category:"communication",rarity:"rare",unlocked:!1,progress:0,maxProgress:50},{id:"call_expert",name:"Expert en Appels",description:"Passez 10 appels vido",icon:"",points:300,category:"communication",rarity:"epic",unlocked:!1,progress:0,maxProgress:10},{id:"streak_master",name:"Matre de la Rgularit",description:"Connectez-vous 30 jours conscutifs",icon:"",points:500,category:"mastery",rarity:"legendary",unlocked:!1,progress:0,maxProgress:30},{id:"bridge_explorer",name:"Explorateur de Bridges",description:"Connectez 3 services externes",icon:"",points:250,category:"mastery",rarity:"epic",unlocked:!1,progress:0,maxProgress:3},{id:"ai_companion",name:"Compagnon IA",description:"Utilisez 50 suggestions IA",icon:"",points:180,category:"mastery",rarity:"rare",unlocked:!1,progress:0,maxProgress:50}]);this.loadStats(),this.initializeAchievements(),this.startDailyReset()}addExperience(e,n){this.stats.experience+=e,this.stats.points+=Math.floor(e/10),this.stats.lastActivity=new Date,this.checkLevelUp(),this.checkAchievements(),this.saveStats(),console.log(`+${e} XP - ${n}`)}addPoints(e,n){this.stats.points+=e,this.stats.lastActivity=new Date,this.saveStats(),console.log(`+${e} points - ${n}`)}updateStreak(){const e=new Date,n=new Date(this.stats.lastActivity),s=Math.abs(e.getTime()-n.getTime()),r=Math.ceil(s/(1e3*60*60*24));r===1?(this.stats.streak++,this.addExperience(this.stats.streak*10,`Streak de ${this.stats.streak} jours`)):r>1&&(this.stats.streak=1,this.addExperience(10,"Nouveau streak")),this.stats.lastActivity=e,this.saveStats()}checkLevelUp(){const e=this.getExpForLevel(this.stats.level+1);this.stats.experience>=e&&(this.stats.level++,this.addPoints(100,`Niveau ${this.stats.level} atteint!`),this.updateRank(),this.triggerLevelUpNotification())}getExpForLevel(e){return Math.floor(100*Math.pow(1.5,e-1))}updateRank(){const e=[{level:1,rank:"bronze"},{level:5,rank:"silver"},{level:10,rank:"gold"},{level:20,rank:"platinum"},{level:30,rank:"diamond"}],n=e.filter(s=>this.stats.level>=s.level).reduce((s,r)=>r.level>s.level?r:s,e[0]);n.rank!==this.stats.rank&&(this.stats.rank=n.rank,this.addPoints(500,`Rang ${n.rank} atteint!`))}initializeAchievements(){this.stats.achievements=this.achievements.map(e=>({...e,unlocked:!1,progress:0}))}checkAchievements(){this.stats.achievements.forEach(e=>{e.unlocked||this.updateAchievementProgress(e.id)})}updateAchievementProgress(e,n=1){const s=this.stats.achievements.find(r=>r.id===e);!s||s.unlocked||(s.progress+=n,s.progress>=s.maxProgress&&this.unlockAchievement(e),this.saveStats())}unlockAchievement(e){const n=this.stats.achievements.find(s=>s.id===e);!n||n.unlocked||(n.unlocked=!0,n.unlockedAt=new Date,this.addPoints(n.points,`Succs: ${n.name}`),this.triggerAchievementNotification(n),console.log(` Succs dbloqu: ${n.name}`))}trackMessageSent(){this.addExperience(5,"Message envoy"),this.updateAchievementProgress("first_message"),this.updateAchievementProgress("social_butterfly")}trackFileShared(){this.addExperience(10,"Fichier partag"),this.updateAchievementProgress("file_sharer")}trackVideoCall(){this.addExperience(25,"Appel vido"),this.updateAchievementProgress("call_expert")}trackSecurityFeatureEnabled(){this.addExperience(15,"Fonctionnalit de scurit active"),this.updateAchievementProgress("security_master")}trackBridgeConnected(){this.addExperience(20,"Bridge connect"),this.updateAchievementProgress("bridge_explorer")}trackAISuggestionUsed(){this.addExperience(2,"Suggestion IA utilise"),this.updateAchievementProgress("ai_companion")}triggerLevelUpNotification(){"Notification"in window&&Notification.permission==="granted"&&new Notification(" Level Up!",{body:`Flicitations! Vous tes maintenant niveau ${this.stats.level}`,icon:"/icon-192.png"})}triggerAchievementNotification(e){"Notification"in window&&Notification.permission==="granted"&&new Notification(" Succs Dbloqu!",{body:`${e.icon} ${e.name} - ${e.description}`,icon:"/icon-192.png"})}getLeaderboardStats(){return{level:this.stats.level,rank:this.stats.rank,points:this.stats.points,streak:this.stats.streak,achievements:this.stats.achievements.filter(e=>e.unlocked).length,totalAchievements:this.stats.achievements.length}}getRankProgress(){const e=this.stats.experience,n=this.getExpForLevel(this.stats.level),r=this.getExpForLevel(this.stats.level+1)-n,i=e-n,o=i/r*100;return{current:i,next:r,percentage:Math.min(100,Math.max(0,o))}}loadStats(){try{const e=localStorage.getItem("palfrog-gamification-stats");if(e){const n=JSON.parse(e);this.stats={...this.stats,...n},this.stats.lastActivity=new Date(this.stats.lastActivity)}}catch(e){console.error("Failed to load gamification stats:",e)}}saveStats(){try{localStorage.setItem("palfrog-gamification-stats",JSON.stringify(this.stats))}catch(e){console.error("Failed to save gamification stats:",e)}}startDailyReset(){const e=new Date,n=new Date(e);n.setDate(n.getDate()+1),n.setHours(0,0,0,0);const s=n.getTime()-e.getTime();setTimeout(()=>{this.dailyReset(),setInterval(()=>this.dailyReset(),24*60*60*1e3)},s)}dailyReset(){this.updateStreak(),this.saveStats()}getStats(){return{...this.stats}}getAchievements(){return[...this.stats.achievements]}getUnlockedAchievements(){return this.stats.achievements.filter(e=>e.unlocked)}getNextAchievements(){return this.stats.achievements.filter(e=>!e.unlocked).sort((e,n)=>n.points-e.points).slice(0,3)}}const Pr=new zLe,g1=wo((t,e)=>({stats:null,achievements:[],isInitialized:!1,initialize:()=>{const n=Pr.getStats(),s=Pr.getAchievements();t({stats:n,achievements:s,isInitialized:!0})},trackActivity:(n,s)=>{switch(n){case"message_sent":Pr.trackMessageSent();break;case"file_shared":Pr.trackFileShared();break;case"video_call":Pr.trackVideoCall();break;case"security_enabled":Pr.trackSecurityFeatureEnabled();break;case"bridge_connected":Pr.trackBridgeConnected();break;case"ai_suggestion_used":Pr.trackAISuggestionUsed();break}const r=Pr.getStats(),i=Pr.getAchievements();t({stats:r,achievements:i})},getLeaderboardData:()=>Pr.getLeaderboardStats(),getNextLevelProgress:()=>Pr.getRankProgress()})),BLe=()=>{const{t}=Er(),{getNextLevelProgress:e,stats:n}=g1(),s=e(),r=o=>{switch(o){case"bronze":return"from-yellow-600 to-yellow-800";case"silver":return"from-gray-400 to-gray-600";case"gold":return"from-yellow-400 to-yellow-600";case"platinum":return"from-blue-400 to-blue-600";case"diamond":return"from-purple-400 to-purple-600";default:return"from-gray-400 to-gray-600"}},i=o=>{switch(o){case"bronze":return"";case"silver":return"";case"gold":return"";case"platinum":return"";case"diamond":return"";default:return""}};return b.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-200",children:[b.jsxs("div",{className:"flex items-center justify-between mb-4",children:[b.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:t("gamification.levelProgress")}),b.jsxs("div",{className:"flex items-center space-x-2",children:[b.jsx("span",{className:"text-2xl",children:i(n.rank)}),b.jsx("span",{className:"font-semibold capitalize text-gray-700",children:t(`gamification.ranks.${n.rank}`)})]})]}),b.jsxs("div",{className:"space-y-2",children:[b.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[b.jsxs("span",{children:["Niveau ",n.level]}),b.jsxs("span",{children:["Niveau ",n.level+1]})]}),b.jsx("div",{className:"w-full bg-gray-200 rounded-full h-4",children:b.jsx("div",{className:`h-4 rounded-full bg-gradient-to-r ${r(n.rank)} transition-all duration-1000 ease-out`,style:{width:`${s.percentage}%`}})}),b.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[b.jsxs("span",{children:[s.current," XP"]}),b.jsxs("span",{children:[s.next," XP"]})]})]}),b.jsx("div",{className:"flex justify-between mt-6",children:[1,5,10,20,30].map(o=>b.jsxs("div",{className:`flex flex-col items-center ${n.level>=o?"opacity-100":"opacity-40"}`,children:[b.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-white text-sm ${n.level>=o?o>=20?"bg-purple-500":o>=10?"bg-yellow-500":o>=5?"bg-gray-400":"bg-yellow-600":"bg-gray-300"}`,children:o}),b.jsx("div",{className:"text-xs mt-1 text-gray-600",children:o===1?"Bronze":o===5?"Silver":o===10?"Gold":o===20?"Platinum":"Diamond"})]},o))})]})},jLe=()=>{const{t}=Er(),{achievements:e}=g1(),n=e.filter(r=>r.unlocked),s=e.filter(r=>!r.unlocked);return b.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-200",children:[b.jsxs("div",{className:"flex items-center justify-between mb-6",children:[b.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:[" ",t("gamification.achievements")]}),b.jsxs("div",{className:"text-sm text-gray-600",children:[n.length," / ",e.length," ",t("gamification.unlocked")]})]}),b.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-8",children:n.slice(0,4).map(r=>b.jsx(nL,{achievement:r,unlocked:!0},r.id))}),b.jsx("h4",{className:"font-semibold text-gray-900 mb-4",children:t("gamification.nextAchievements")}),b.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:s.slice(0,3).map(r=>b.jsx(nL,{achievement:r,unlocked:!1},r.id))})]})},nL=({achievement:t,unlocked:e})=>{const n=t.progress/t.maxProgress*100;return b.jsx("div",{className:`p-4 rounded-xl border-2 transition-all duration-200 ${e?"border-green-200 bg-green-50":"border-gray-200 bg-gray-50"}`,children:b.jsxs("div",{className:"flex items-start space-x-3",children:[b.jsx("div",{className:`text-2xl ${e?"opacity-100":"opacity-60"}`,children:t.icon}),b.jsxs("div",{className:"flex-1",children:[b.jsx("h5",{className:`font-semibold ${e?"text-green-900":"text-gray-900"}`,children:t.name}),b.jsx("p",{className:`text-sm ${e?"text-green-700":"text-gray-600"}`,children:t.description}),!e&&b.jsxs("div",{className:"mt-2",children:[b.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:b.jsx("div",{className:"h-2 rounded-full bg-blue-500 transition-all duration-500",style:{width:`${n}%`}})}),b.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[t.progress," / ",t.maxProgress]})]}),e&&t.unlockedAt&&b.jsxs("div",{className:"text-xs text-green-600 mt-1",children:["Dbloqu le ",t.unlockedAt.toLocaleDateString()]})]}),b.jsxs("div",{className:`px-2 py-1 rounded-full text-xs font-semibold ${e?"bg-green-500 text-white":"bg-gray-300 text-gray-700"}`,children:["+",t.points]})]})})},VLe=()=>{const{t}=Er(),e=[{id:"msg",label:"quests.sendMessages",progress:3,total:10},{id:"call",label:"quests.makeCalls",progress:1,total:3},{id:"ai",label:"quests.useAI",progress:5,total:5,completed:!0}];return b.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-200 h-full",children:[b.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:[" ",t("gamification.dailyQuests")]}),b.jsx("div",{className:"space-y-4",children:e.map(n=>b.jsxs("div",{className:"space-y-2",children:[b.jsxs("div",{className:"flex justify-between text-sm",children:[b.jsx("span",{className:n.completed?"text-green-600 line-through":"text-gray-700",children:t(`gamification.${n.label}`)}),b.jsxs("span",{className:"text-gray-500",children:[n.progress,"/",n.total]})]}),b.jsx("div",{className:"w-full bg-gray-100 rounded-full h-2",children:b.jsx("div",{className:`h-2 rounded-full ${n.completed?"bg-green-500":"bg-blue-500"}`,style:{width:`${n.progress/n.total*100}%`}})})]},n.id))})]})},ULe=()=>{const{t}=Er(),{stats:e}=g1(),n=[{rank:1,name:"Alice",points:12500,level:15},{rank:2,name:"Bob",points:11200,level:14},{rank:3,name:"You",points:(e==null?void 0:e.points)||0,level:(e==null?void 0:e.level)||1,isUser:!0},{rank:4,name:"Charlie",points:8500,level:10}];return b.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-200",children:[b.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:[" ",t("gamification.leaderboard")]}),b.jsx("div",{className:"space-y-3",children:n.map(s=>b.jsxs("div",{className:`flex items-center justify-between p-3 rounded-xl ${s.isUser?"bg-primary-50 border border-primary-100":"bg-gray-50"}`,children:[b.jsxs("div",{className:"flex items-center space-x-3",children:[b.jsx("div",{className:`w-8 h-8 flex items-center justify-center rounded-full font-bold ${s.rank===1?"bg-yellow-100 text-yellow-700":s.rank===2?"bg-gray-200 text-gray-700":s.rank===3?"bg-orange-100 text-orange-700":"bg-white text-gray-500"}`,children:s.rank}),b.jsxs("div",{children:[b.jsxs("div",{className:`font-medium ${s.isUser?"text-primary-900":"text-gray-900"}`,children:[s.name," ",s.isUser&&"(Moi)"]}),b.jsxs("div",{className:"text-xs text-gray-500",children:["Niveau ",s.level]})]})]}),b.jsxs("div",{className:"font-bold text-gray-700",children:[s.points.toLocaleString()," pts"]})]},s.rank))})]})},WLe=()=>{const{t}=Er(),{stats:e,achievements:n,initialize:s,getLeaderboardData:r}=g1();if(z.useEffect(()=>{s()},[]),!e)return b.jsx("div",{className:"flex items-center justify-center h-64",children:b.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-500"})});const i=r();return b.jsxs("div",{className:"space-y-6",children:[b.jsx("div",{className:"bg-gradient-to-r from-purple-500 to-pink-500 rounded-2xl p-6 text-white",children:b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("div",{children:[b.jsxs("h1",{className:"text-2xl font-bold",children:[" ",t("gamification.dashboardTitle")]}),b.jsx("p",{className:"opacity-90",children:t("gamification.dashboardSubtitle")})]}),b.jsxs("div",{className:"text-right",children:[b.jsxs("div",{className:"text-3xl font-bold",children:["Niveau ",e.level]}),b.jsx("div",{className:"text-sm opacity-90 capitalize",children:e.rank})]})]})}),b.jsx(BLe,{}),b.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[b.jsx("div",{className:"lg:col-span-1",children:b.jsx(VLe,{})}),b.jsx("div",{className:"lg:col-span-2",children:b.jsx(jLe,{})})]}),b.jsx(ULe,{}),b.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[b.jsx(ry,{icon:"",label:t("gamification.streak"),value:e.streak,suffix:"jours"}),b.jsx(ry,{icon:"",label:t("gamification.achievements"),value:i.achievements,suffix:`/ ${i.totalAchievements}`}),b.jsx(ry,{icon:"",label:t("gamification.points"),value:e.points}),b.jsx(ry,{icon:"",label:t("gamification.rank"),value:t(`gamification.ranks.${e.rank}`)})]})]})},ry=({icon:t,label:e,value:n,suffix:s})=>b.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm border border-gray-200 text-center",children:[b.jsx("div",{className:"text-2xl mb-2",children:t}),b.jsxs("div",{className:"text-lg font-bold text-gray-900",children:[n," ",s]}),b.jsx("div",{className:"text-sm text-gray-600",children:e})]});class HLe{constructor(){$e(this,"conversationStats",{totalMessages:0,messagesSent:0,messagesReceived:0,averageResponseTime:0,mostActiveHours:[],conversationLength:0});$e(this,"dataCollectionEnabled",!0);$e(this,"privacyLevel","balanced");this.initializeDataCollection(),this.startPeriodicAnalysis()}initializeDataCollection(){this.dataCollectionEnabled&&(this.setupMessageMonitoring(),this.setupActivityTracking(),this.loadHistoricalData())}setupMessageMonitoring(){const e=Be.getState().addMessage;Be.setState({addMessage:n=>{e(n),this.analyzeNewMessage(n)}})}setupActivityTracking(){let e=new Date,n=0;const s=()=>{const r=new Date;n+=(r.getTime()-e.getTime())/1e3/60,e=r};window.addEventListener("focus",()=>{e=new Date}),window.addEventListener("blur",()=>{s()}),setInterval(()=>{s(),this.saveActivityData(n)},3e4)}analyzeNewMessage(e){this.updateConversationStats(e),this.updateRelationshipMap(e),this.updateMoodTracking(e),this.updateProductivityStats()}updateConversationStats(e){const n=this.conversationStats;n.totalMessages++,e.sender==="me"?n.messagesSent++:n.messagesReceived++;const s=new Date(e.timestamp).getHours(),r=n.mostActiveHours.find(i=>i.hour===s);r?r.count++:n.mostActiveHours.push({hour:s,count:1}),n.mostActiveHours.sort((i,o)=>o.count-i.count),this.saveConversationStats()}async getAllMessagesFromDB(){const e=await Pn.getAllChats();let n=[];for(const s of e){const r=await Pn.getChatMessages(s.id,1e3);n=[...n,...r]}return n}async generateRelationshipMap(){const e=new Map,n=await Pn.getAllChats();for(const r of n)(await Pn.getChatMessages(r.id,1e3)).forEach(o=>{const a=r.id;e.has(a)||e.set(a,{id:a,name:r.participantName||a,messageCount:0,lastInteraction:new Date(o.timestamp),interactions:[]});const l=e.get(a);l.messageCount++,new Date(o.timestamp)>l.lastInteraction&&(l.lastInteraction=new Date(o.timestamp)),l.interactions.push({timestamp:new Date(o.timestamp),type:o.sender==="me"?"sent":"received",content:o.content})});return{contacts:Array.from(e.values()).map(r=>{const i=this.calculateRelationshipStrength(r),o=this.analyzeConversationSentiment(r.interactions),a=this.extractCommonTopics(r.interactions);return{...r,strength:i,sentiment:o,commonTopics:a.slice(0,5)}}).sort((r,i)=>i.strength-r.strength),groups:await this.analyzeGroupActivity()}}calculateRelationshipStrength(e){const{messageCount:n,lastInteraction:s,interactions:r}=e,o=(new Date().getTime()-s.getTime())/(1e3*60*60*24),a=Math.min(n/100,1)*40,l=Math.max(0,1-o/30)*30,c=this.calculateFrequencyScore(r)*30;return Math.min(a+l+c,100)}calculateFrequencyScore(e){if(e.length<2)return 0;const n=e.map(o=>new Date(o.timestamp).getTime()),s=[];for(let o=1;o<n.length;o++)s.push(n[o]-n[o-1]);const i=s.reduce((o,a)=>o+a,0)/s.length/(1e3*60*60*24);return Math.max(0,1-i/7)}analyzeConversationSentiment(e){const n=["super","gnial","merci","content","bon","excellent","parfait"],s=["mauvais","probleme","erreur","fch","triste","du"];let r=0,i=0;return e.forEach(o=>{const a=o.content.toLowerCase();n.forEach(l=>{a.includes(l)&&r++}),s.forEach(l=>{a.includes(l)&&i++})}),r>i?"positive":i>r?"negative":"neutral"}extractCommonTopics(e){const s=e.map(i=>i.content).join(" ").toLowerCase().split(/\s+/).filter(i=>i.length>3),r={};return s.forEach(i=>{r[i]=(r[i]||0)+1}),Object.entries(r).sort(([,i],[,o])=>o-i).slice(0,10).map(([i])=>i)}async generateProductivityReport(){const e=await this.loadActivityData(),n=await this.getAllMessagesFromDB(),s=e.totalTime||0,r=this.calculateFocusSessions(e.sessions||[]),i=this.calculateInterruptions(n),o=this.findPeakProductivityHours(n),a=this.calculateWeeklyTrend(e);return{timeSpent:s,focusSessions:r,interruptions:i,peakProductivityHours:o,weeklyTrend:a}}calculateFocusSessions(e){return e.filter(n=>n.duration>15&&n.interruptions<3).length}calculateInterruptions(e){let n=0,s=new Date;return e.forEach(r=>{const i=new Date(r.timestamp),o=(i.getTime()-s.getTime())/(1e3*60);r.sender!=="me"&&o>5&&n++,s=i}),n}findPeakProductivityHours(e){const n=Array(24).fill(0);return e.forEach(s=>{if(s.sender==="me"){const r=new Date(s.timestamp).getHours();n[r]++}}),n.map((s,r)=>({hour:r,count:s})).sort((s,r)=>r.count-s.count).slice(0,3).map(s=>s.hour)}async generateMoodReport(){const e=await this.getAllMessagesFromDB(),n=this.analyzeDailyMood(e),s=this.analyzeSentimentTrend(e),r=this.detectStressIndicators(e),i=this.calculateWellbeingScore(n,r);return{dailyMood:n,sentimentTrend:s,stressIndicators:r,wellbeingScore:i}}analyzeDailyMood(e){const n=new Map;return e.forEach(s=>{const r=new Date(s.timestamp).toDateString(),i=this.analyzeMessageSentiment(s.content);n.has(r)||n.set(r,{date:r,sentiments:[],factors:[]});const o=n.get(r);o.sentiments.push(i.score),i.factors.length>0&&o.factors.push(...i.factors)}),Array.from(n.values()).map(s=>({date:s.date,mood:s.sentiments.length>0?s.sentiments.reduce((r,i)=>r+i,0)/s.sentiments.length:50,factors:[...new Set(s.factors)].slice(0,3)}))}analyzeMessageSentiment(e){const n=["super","gnial","merci","content","bon","excellent","parfait","","",""],s=["mauvais","probleme","erreur","fch","triste","du","","",""];let r=50;const i=[],o=e.toLowerCase();return n.forEach(a=>{o.includes(a)&&(r+=5,i.push(a))}),s.forEach(a=>{o.includes(a)&&(r-=5,i.push(a))}),{score:Math.max(0,Math.min(100,r)),factors:i}}async generateCommunicationGoals(){const e=[{id:"social-connections",title:"largir le rseau social",target:10,current:0,unit:"nouveaux contacts",category:"social"},{id:"response-time",title:"Amliorer le temps de rponse",target:30,current:0,unit:"minutes en moyenne",category:"productivity"},{id:"meaningful-conversations",title:"Conversations significatives",target:5,current:0,unit:"par semaine",category:"wellbeing"},{id:"learning-share",title:"Partage de connaissances",target:3,current:0,unit:"ressources partages",category:"learning"}],n=await this.generateRelationshipMap(),s=await this.generateProductivityReport();e[0].current=n.contacts.length,e[1].current=Math.round(s.timeSpent/60),e[2].current=this.calculateMeaningfulConversations(),e[3].current=this.calculateSharedResources();const r=e.reduce((i,o)=>i+o.current/o.target*25,0);return{goals:e,progress:Math.min(100,r)}}async generateComprehensiveReport(){const[e,n,s,r,i]=await Promise.all([this.generateRelationshipMap(),this.generateProductivityReport(),this.generateMoodReport(),this.generateCommunicationGoals(),this.getConversationStats()]);return{summary:{generatedAt:new Date,period:"all-time",overallScore:this.calculateOverallScore(e,n,s)},relationshipMap:e,productivityStats:n,moodTracking:s,communicationGoals:r,conversationStats:i,insights:this.generateInsights(e,n,s)}}calculateOverallScore(e,n,s){const r=e.contacts.length>0?e.contacts.reduce((a,l)=>a+l.strength,0)/e.contacts.length:0,i=Math.min(n.timeSpent/60,100),o=s.wellbeingScore;return Math.round((r+i+o)/3)}generateInsights(e,n,s){const r=[];e.contacts.length<5&&r.push(" Vous pourriez largir votre rseau en contactant de nouvelles personnes");const i=e.contacts.filter(o=>o.strength>70);return i.length>0&&r.push(` Vous avez ${i.length} relations trs fortes - continuez  les entretenir !`),n.peakProductivityHours.length>0&&r.push(` Vous tes plus productif autour de ${n.peakProductivityHours[0]}h - planifiez vos tches importantes  ce moment`),n.interruptions>10&&r.push(" Beaucoup d'interruptions dtectes - envisagez des plages de travail sans distraction"),s.wellbeingScore<40&&r.push(" Votre bien-tre communicationnel semble bas - prenez du temps pour des conversations positives"),r.slice(0,5)}saveConversationStats(){localStorage.setItem("palfrog-conversation-stats",JSON.stringify(this.conversationStats))}async loadHistoricalData(){try{const e=localStorage.getItem("palfrog-conversation-stats");e&&(this.conversationStats=JSON.parse(e))}catch(e){console.error("Failed to load historical data:",e)}}saveActivityData(e){const n=new Date().toDateString(),s=JSON.parse(localStorage.getItem("palfrog-activity-data")||"{}");s[n]||(s[n]={totalTime:0,sessions:[]}),s[n].totalTime+=e,localStorage.setItem("palfrog-activity-data",JSON.stringify(s))}async loadActivityData(){try{const e=localStorage.getItem("palfrog-activity-data");return e?JSON.parse(e):{}}catch{return{}}}setPrivacyLevel(e){this.privacyLevel=e,this.dataCollectionEnabled=e!=="minimal",localStorage.setItem("palfrog-analytics-privacy",e)}getPrivacyLevel(){return this.privacyLevel}clearAllData(){localStorage.removeItem("palfrog-conversation-stats"),localStorage.removeItem("palfrog-activity-data"),localStorage.removeItem("palfrog-analytics-privacy"),this.conversationStats={totalMessages:0,messagesSent:0,messagesReceived:0,averageResponseTime:0,mostActiveHours:[],conversationLength:0}}getConversationStats(){return{...this.conversationStats}}startPeriodicAnalysis(){setInterval(()=>{this.generateComprehensiveReport().catch(console.error)},60*60*1e3)}calculateMeaningfulConversations(){return Math.floor(Math.random()*5)}calculateSharedResources(){return Math.floor(Math.random()*3)}calculateWeeklyTrend(e){return Array.from({length:7},(n,s)=>{const r=new Date;return r.setDate(r.getDate()-s),{date:r.toDateString(),productivity:Math.floor(Math.random()*100)}}).reverse()}async analyzeGroupActivity(){return[]}analyzeSentimentTrend(e){return[]}detectStressIndicators(e){return[]}calculateWellbeingScore(e,n){return 75}updateRelationshipMap(e){}updateMoodTracking(e){}updateProductivityStats(){}}const zl=new HLe,GLe=wo((t,e)=>({privacyLevel:"balanced",isGeneratingReport:!1,lastReport:null,setPrivacyLevel:n=>{zl.setPrivacyLevel(n),t({privacyLevel:n})},generateComprehensiveReport:async()=>{t({isGeneratingReport:!0});try{const n=await zl.generateComprehensiveReport();return t({lastReport:n,isGeneratingReport:!1}),n}catch(n){throw t({isGeneratingReport:!1}),n}},getRelationshipMap:async()=>await zl.generateRelationshipMap(),getProductivityReport:async()=>await zl.generateProductivityReport(),getMoodReport:async()=>await zl.generateMoodReport(),getCommunicationGoals:async()=>await zl.generateCommunicationGoals(),clearAllData:()=>{zl.clearAllData(),t({lastReport:null})},exportData:async n=>{const s=await e().generateComprehensiveReport();if(n==="json")return new Blob([JSON.stringify(s,null,2)],{type:"application/json"});{const r=KLe(s);return new Blob([r],{type:"text/csv"})}}}));function KLe(t){const n=[["Category","Metric","Value"].join(",")];return t.conversationStats&&Object.entries(t.conversationStats).forEach(([s,r])=>{n.push(`Conversation,${s},${r}`)}),t.productivityStats&&Object.entries(t.productivityStats).forEach(([s,r])=>{typeof r=="number"&&n.push(`Productivity,${s},${r}`)}),n.join(`
`)}const qLe=({data:t})=>b.jsxs("div",{className:"space-y-6",children:[b.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Carte des Relations"}),b.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.contacts.map(e=>b.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200 shadow-sm",children:[b.jsxs("div",{className:"flex justify-between items-start mb-2",children:[b.jsx("h4",{className:"font-medium text-gray-900",children:e.name}),b.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${e.sentiment==="positive"?"bg-green-100 text-green-800":e.sentiment==="negative"?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:e.sentiment})]}),b.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[b.jsxs("div",{className:"flex justify-between",children:[b.jsx("span",{children:"Force:"}),b.jsx("div",{className:"w-24 bg-gray-200 rounded-full h-2 mt-1",children:b.jsx("div",{className:"bg-blue-500 h-2 rounded-full",style:{width:`${e.strength}%`}})})]}),b.jsxs("div",{className:"flex justify-between",children:[b.jsx("span",{children:"Messages:"}),b.jsx("span",{children:e.messageCount})]}),b.jsxs("div",{children:[b.jsx("span",{className:"block mb-1",children:"Sujets communs:"}),b.jsx("div",{className:"flex flex-wrap gap-1",children:e.commonTopics.map((n,s)=>b.jsx("span",{className:"px-2 py-0.5 bg-gray-100 rounded text-xs",children:n},s))})]})]})]},e.id))})]}),XLe=({data:t})=>b.jsxs("div",{className:"space-y-6",children:[b.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Analyse de Productivit"}),b.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[b.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[b.jsx("div",{className:"text-sm text-blue-600 mb-1",children:"Sessions Focus"}),b.jsx("div",{className:"text-2xl font-bold text-blue-900",children:t.focusSessions})]}),b.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg",children:[b.jsx("div",{className:"text-sm text-orange-600 mb-1",children:"Interruptions"}),b.jsx("div",{className:"text-2xl font-bold text-orange-900",children:t.interruptions})]}),b.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[b.jsx("div",{className:"text-sm text-green-600 mb-1",children:"Heures de Pointe"}),b.jsx("div",{className:"text-2xl font-bold text-green-900",children:t.peakProductivityHours.map(e=>`${e}h`).join(", ")})]})]}),b.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[b.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-4",children:"Tendance Hebdomadaire"}),b.jsx("div",{className:"h-48 flex items-end space-x-2",children:t.weeklyTrend.map((e,n)=>b.jsxs("div",{className:"flex-1 flex flex-col items-center group",children:[b.jsx("div",{className:"w-full bg-blue-500 rounded-t transition-all group-hover:bg-blue-600",style:{height:`${e.productivity}%`}}),b.jsx("div",{className:"text-xs text-gray-500 mt-2 rotate-45 origin-left",children:new Date(e.date).toLocaleDateString(void 0,{weekday:"short"})})]},n))})]})]}),JLe=({data:t})=>b.jsxs("div",{className:"space-y-6",children:[b.jsxs("div",{className:"flex justify-between items-center",children:[b.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Suivi d'Humeur"}),b.jsxs("div",{className:"text-sm font-medium px-3 py-1 bg-purple-100 text-purple-800 rounded-full",children:["Score Bien-tre: ",t.wellbeingScore,"/100"]})]}),b.jsx("div",{className:"space-y-4",children:t.dailyMood.map((e,n)=>b.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200 flex items-center justify-between",children:[b.jsxs("div",{children:[b.jsx("div",{className:"font-medium text-gray-900",children:e.date}),b.jsxs("div",{className:"text-sm text-gray-500",children:["Facteurs: ",e.factors.join(", ")]})]}),b.jsxs("div",{className:"flex items-center space-x-3",children:[b.jsx("div",{className:"w-32 bg-gray-200 rounded-full h-2",children:b.jsx("div",{className:`h-2 rounded-full ${e.mood>60?"bg-green-500":e.mood<40?"bg-red-500":"bg-yellow-500"}`,style:{width:`${e.mood}%`}})}),b.jsx("span",{className:"text-sm font-medium w-8",children:Math.round(e.mood)})]})]},n))}),t.stressIndicators.length>0&&b.jsxs("div",{className:"bg-red-50 p-4 rounded-lg border border-red-100",children:[b.jsx("h4",{className:"text-sm font-medium text-red-800 mb-2",children:"Indicateurs de Stress Dtects"}),b.jsx("ul",{className:"list-disc list-inside text-sm text-red-700",children:t.stressIndicators.map((e,n)=>b.jsx("li",{children:e},n))})]})]}),YLe=({data:t})=>b.jsxs("div",{className:"space-y-6",children:[b.jsxs("div",{className:"flex justify-between items-center",children:[b.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Objectifs de Communication"}),b.jsxs("div",{className:"text-sm text-gray-500",children:["Progression Globale: ",Math.round(t.progress),"%"]})]}),b.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:t.goals.map(e=>{const n=Math.min(100,e.current/e.target*100);return b.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200 shadow-sm",children:[b.jsxs("div",{className:"flex justify-between items-start mb-2",children:[b.jsxs("div",{children:[b.jsx("h4",{className:"font-medium text-gray-900",children:e.title}),b.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${e.category==="social"?"bg-blue-100 text-blue-800":e.category==="productivity"?"bg-green-100 text-green-800":e.category==="learning"?"bg-yellow-100 text-yellow-800":"bg-purple-100 text-purple-800"}`,children:e.category})]}),b.jsxs("div",{className:"text-right",children:[b.jsx("div",{className:"text-2xl font-bold text-gray-900",children:e.current}),b.jsxs("div",{className:"text-xs text-gray-500",children:["/ ",e.target," ",e.unit]})]})]}),b.jsx("div",{className:"mt-4",children:b.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:b.jsx("div",{className:"bg-primary-500 h-2 rounded-full transition-all duration-500",style:{width:`${n}%`}})})})]},e.id)})})]}),QLe=({insights:t})=>t.length===0?null:b.jsxs("div",{className:"bg-gradient-to-r from-indigo-50 to-purple-50 rounded-2xl p-6 border border-indigo-100",children:[b.jsxs("h3",{className:"text-lg font-semibold text-indigo-900 mb-4 flex items-center",children:[b.jsx("span",{className:"mr-2",children:""})," Insights & Recommandations"]}),b.jsx("div",{className:"grid gap-3",children:t.map((e,n)=>b.jsxs("div",{className:"bg-white/60 backdrop-blur-sm p-3 rounded-lg border border-indigo-50 text-indigo-800 flex items-start",children:[b.jsx("span",{className:"mr-2 mt-0.5",children:""}),b.jsx("span",{children:e})]},n))})]}),ZLe=()=>{const{t}=Er(),{generateComprehensiveReport:e,lastReport:n,isGeneratingReport:s,privacyLevel:r,setPrivacyLevel:i}=GLe(),[o,a]=z.useState("overview");return z.useEffect(()=>{n||e()},[]),s?b.jsx("div",{className:"flex items-center justify-center h-64",children:b.jsxs("div",{className:"text-center",children:[b.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-500 mx-auto mb-4"}),b.jsx("p",{className:"text-gray-600",children:t("analytics.generatingReport")})]})}):n?b.jsxs("div",{className:"space-y-6",children:[b.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-200",children:[b.jsxs("div",{className:"flex items-center justify-between mb-6",children:[b.jsxs("div",{children:[b.jsxs("h1",{className:"text-2xl font-bold text-gray-900",children:[" ",t("analytics.dashboardTitle")]}),b.jsx("p",{className:"text-gray-600",children:t("analytics.dashboardSubtitle")})]}),b.jsxs("div",{className:"flex items-center space-x-4",children:[b.jsxs("select",{value:r,onChange:l=>i(l.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",children:[b.jsx("option",{value:"minimal",children:t("analytics.privacyMinimal")}),b.jsx("option",{value:"balanced",children:t("analytics.privacyBalanced")}),b.jsx("option",{value:"detailed",children:t("analytics.privacyDetailed")})]}),b.jsxs("button",{onClick:()=>e(),className:"px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors",children:[" ",t("analytics.refresh")]})]})]}),b.jsx("div",{className:"text-center",children:b.jsxs("div",{className:"inline-block bg-gradient-to-r from-blue-500 to-purple-500 text-white rounded-2xl px-8 py-6",children:[b.jsx("div",{className:"text-sm opacity-90",children:t("analytics.overallScore")}),b.jsxs("div",{className:"text-4xl font-bold",children:[n.summary.overallScore,"/100"]}),b.jsxs("div",{className:"text-sm opacity-90 mt-2",children:[t("analytics.generatedOn")," ",new Date(n.summary.generatedAt).toLocaleDateString()]})]})})]}),b.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-200",children:[b.jsx("nav",{className:"flex space-x-8 border-b border-gray-200 px-6",children:[{id:"overview",name:t("analytics.overview"),icon:""},{id:"relationships",name:t("analytics.relationships"),icon:""},{id:"productivity",name:t("analytics.productivity"),icon:""},{id:"mood",name:t("analytics.mood"),icon:""},{id:"goals",name:t("analytics.goals"),icon:""}].map(l=>b.jsxs("button",{onClick:()=>a(l.id),className:`flex items-center space-x-2 py-4 border-b-2 font-medium text-sm transition-colors ${o===l.id?"border-primary-500 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[b.jsx("span",{children:l.icon}),b.jsx("span",{children:l.name})]},l.id))}),b.jsxs("div",{className:"p-6",children:[o==="overview"&&b.jsx(eFe,{report:n}),o==="relationships"&&b.jsx(qLe,{data:n.relationshipMap}),o==="productivity"&&b.jsx(XLe,{data:n.productivityStats}),o==="mood"&&b.jsx(JLe,{data:n.moodTracking}),o==="goals"&&b.jsx(YLe,{data:n.communicationGoals})]})]}),b.jsx(QLe,{insights:n.insights})]}):b.jsxs("div",{className:"text-center py-12",children:[b.jsx("div",{className:"text-6xl mb-4",children:""}),b.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:t("analytics.noDataTitle")}),b.jsx("p",{className:"text-gray-600 mb-6",children:t("analytics.noDataDescription")}),b.jsx("button",{onClick:()=>e(),className:"px-6 py-3 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-colors",children:t("analytics.generateFirstReport")})]})},eFe=({report:t})=>{const{t:e}=Er();return b.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[b.jsx(iy,{icon:"",label:e("analytics.totalMessages"),value:t.conversationStats.totalMessages}),b.jsx(iy,{icon:"",label:e("analytics.contacts"),value:t.relationshipMap.contacts.length}),b.jsx(iy,{icon:"",label:e("analytics.timeSpent"),value:`${Math.round(t.productivityStats.timeSpent)}m`}),b.jsx(iy,{icon:"",label:e("analytics.wellbeingScore"),value:`${t.moodTracking.wellbeingScore}/100`})]})},iy=({icon:t,label:e,value:n})=>b.jsxs("div",{className:"bg-gray-50 rounded-xl p-6 text-center border border-gray-200",children:[b.jsx("div",{className:"text-3xl mb-2",children:t}),b.jsx("div",{className:"text-2xl font-bold text-gray-900 mb-1",children:n}),b.jsx("div",{className:"text-sm text-gray-600",children:e})]});class tFe{constructor(){$e(this,"alerts",[]);$e(this,"subscribers",[])}checkForSecurityIssues(){this.checkEncryptionStatus(),this.checkNetworkSecurity(),this.checkFileSecurity(),this.checkPrivacySettings()}checkEncryptionStatus(){const{isEncryptionEnabled:e}=Be.getState();e||this.addAlert({id:"encryption-disabled",type:"warning",title:"Chiffrement dsactiv",message:"Vos messages ne sont pas chiffrs. Activez le chiffrement pour protger vos conversations.",action:{label:"Activer",callback:()=>{Be.getState().isEncryptionEnabled=!0,this.dismissAlert("encryption-disabled")}},dismissible:!0})}checkNetworkSecurity(){this.isSuspiciousNetwork()&&this.addAlert({id:"suspicious-network",type:"warning",title:"Rseau non scuris dtect",message:"Votre connexion rseau peut tre vulnrable. vitez les transactions sensibles.",dismissible:!0})}checkFileSecurity(){parseInt(localStorage.getItem("palfrog-recent-downloads")||"0")>5&&this.addAlert({id:"high-download-activity",type:"info",title:"Activit de tlchargement leve",message:"Vous avez tlcharg plusieurs fichiers rcemment. Vrifiez leur scurit.",dismissible:!0})}checkPrivacySettings(){localStorage.getItem("palfrog-profile-visible")==="public"&&this.addAlert({id:"profile-public",type:"info",title:"Profil public",message:"Votre profil est visible publiquement. Pensez  vrifier vos paramtres de confidentialit.",dismissible:!0})}isSuspiciousNetwork(){return navigator.userAgent.includes("Mobile")&&!window.location.protocol.includes("https")}addAlert(e){const n={...e,timestamp:new Date};this.alerts.find(s=>s.id===n.id)||(this.alerts.push(n),this.notifySubscribers())}dismissAlert(e){this.alerts=this.alerts.filter(n=>n.id!==e),this.notifySubscribers()}getAlerts(){return this.alerts}subscribe(e){return this.subscribers.push(e),()=>{this.subscribers=this.subscribers.filter(n=>n!==e)}}notifySubscribers(){this.subscribers.forEach(e=>e([...this.alerts]))}}const cN=new tFe,nFe=()=>{const[t,e]=z.useState([]);return z.useEffect(()=>{const n=cN.subscribe(s=>{e(s)});return()=>n()},[]),t.length===0?null:b.jsx("div",{className:"fixed bottom-4 right-4 z-50 space-y-2 max-w-sm",children:t.map(n=>b.jsxs("div",{className:`p-4 rounded-lg shadow-lg border-l-4 ${n.type==="warning"?"bg-yellow-50 border-yellow-500 text-yellow-800":n.type==="critical"?"bg-red-50 border-red-500 text-red-800":n.type==="success"?"bg-green-50 border-green-500 text-green-800":"bg-blue-50 border-blue-500 text-blue-800"}`,children:[b.jsxs("div",{className:"flex justify-between items-start",children:[b.jsxs("div",{children:[b.jsx("h4",{className:"font-bold text-sm",children:n.title}),b.jsx("p",{className:"text-sm mt-1",children:n.message})]}),n.dismissible&&b.jsx("button",{onClick:()=>cN.dismissAlert(n.id),className:"text-gray-400 hover:text-gray-600",children:""})]}),n.action&&b.jsx("button",{onClick:n.action.callback,className:"mt-2 text-sm font-medium underline hover:no-underline",children:n.action.label})]},n.id))})},sFe=({children:t})=>{const{calculateScore:e}=jz();return z.useEffect(()=>{e();const n=setInterval(()=>{cN.checkForSecurityIssues()},5*60*1e3);return()=>clearInterval(n)},[]),b.jsxs(b.Fragment,{children:[t,b.jsx(nFe,{})]})},rFe=()=>{const{currentCall:t,acceptCall:e,rejectCall:n}=zr(),{onlineUsers:s}=Be();if(!t||t.direction!=="incoming"||t.status==="active")return null;const r=s.find(a=>a.userId===t.peerId),i=(r==null?void 0:r.username)||"Utilisateur",o=i.charAt(0).toUpperCase();return b.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",children:b.jsxs("div",{className:"bg-white rounded-2xl p-8 max-w-md w-full mx-4 text-center",children:[b.jsx("div",{className:"w-20 h-20 bg-gradient-to-r from-primary-500 to-accent-400 rounded-full flex items-center justify-center mx-auto mb-6",children:b.jsx("span",{className:"text-2xl text-white font-semibold",children:o})}),b.jsxs("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:["Appel ",t.type==="audio"?"audio":"vido"," entrant"]}),b.jsxs("p",{className:"text-gray-600 mb-6",children:[" ",i," vous appelle"]}),b.jsxs("div",{className:"flex justify-center space-x-6",children:[b.jsx("button",{onClick:n,className:"w-16 h-16 bg-red-500 rounded-full flex items-center justify-center hover:bg-red-600 transition-all duration-200 transform hover:scale-110",children:b.jsx("svg",{className:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:b.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),b.jsx("button",{onClick:()=>e(t.peerId),className:"w-16 h-16 bg-green-500 rounded-full flex items-center justify-center hover:bg-green-600 transition-all duration-200 transform hover:scale-110",children:b.jsx("svg",{className:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:b.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})})]})]})})},iFe=()=>{const{currentTier:t,isLoading:e,subscribe:n}=BT(),[s,r]=z.useState("monthly"),i=[{id:"free",name:"Gratuit",price:{monthly:0,yearly:0},description:"Pour les individus et les petits projets",features:["Jusqu' 3 ponts","1GB de stockage","Support communautaire","Fonctionnalits de base"],buttonText:"Commencer gratuitement",recommended:!1},{id:"pro",name:"Pro",price:{monthly:29,yearly:290},description:"Pour les professionnels et les crateurs",features:["Ponts illimits","50GB de stockage","Support prioritaire","IA Avance","Mode hors ligne","Analytiques avances"],buttonText:"Passer  Pro",recommended:!0},{id:"enterprise",name:"Entreprise",price:{monthly:99,yearly:990},description:"Pour les grandes quipes et organisations",features:["Tout du plan Pro","Stockage illimit","SSO & Scurit avance","Gestionnaire de compte ddi","SLA garanti","API ddie"],buttonText:"Contacter les ventes",recommended:!1}],o=async a=>{if(a==="enterprise"){window.location.href="mailto:sales@palfrog.com";return}try{await n(a,s,{}),Yt.success(`Flicitations ! Vous tes maintenant abonn au plan ${a.toUpperCase()}.`,{duration:5e3,icon:""})}catch{Yt.error("Une erreur est survenue lors de l'abonnement.")}};return b.jsx("div",{className:"min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:b.jsxs("div",{className:"max-w-7xl mx-auto",children:[b.jsxs("div",{className:"text-center",children:[b.jsx("h2",{className:"text-3xl font-extrabold text-gray-900 sm:text-4xl",children:"Plans et Tarifs"}),b.jsx("p",{className:"mt-4 text-xl text-gray-600",children:"Choisissez le plan qui correspond le mieux  vos besoins"}),b.jsx("div",{className:"mt-6 flex justify-center",children:b.jsxs("div",{className:"relative bg-white rounded-lg p-0.5 flex sm:mt-8 border border-gray-200",children:[b.jsx("button",{type:"button",className:`${s==="monthly"?"bg-indigo-600 text-white shadow-sm":"text-gray-500 hover:text-gray-900"} relative w-1/2 rounded-md py-2 text-sm font-medium whitespace-nowrap focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:z-10 sm:w-auto sm:px-8 transition-colors duration-200`,onClick:()=>r("monthly"),children:"Mensuel"}),b.jsx("button",{type:"button",className:`${s==="yearly"?"bg-indigo-600 text-white shadow-sm":"text-gray-500 hover:text-gray-900"} relative w-1/2 rounded-md py-2 text-sm font-medium whitespace-nowrap focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:z-10 sm:w-auto sm:px-8 transition-colors duration-200`,onClick:()=>r("yearly"),children:"Annuel (-20%)"})]})})]}),b.jsx("div",{className:"mt-12 space-y-4 sm:mt-16 sm:space-y-0 sm:grid sm:grid-cols-2 sm:gap-6 lg:max-w-4xl lg:mx-auto xl:max-w-none xl:mx-0 xl:grid-cols-3",children:i.map(a=>b.jsxs("div",{className:`border rounded-lg shadow-sm divide-y divide-gray-200 bg-white flex flex-col ${a.recommended?"border-indigo-500 ring-2 ring-indigo-500 relative":"border-gray-200"}`,children:[a.recommended&&b.jsx("div",{className:"absolute top-0 right-0 -mt-4 mr-4",children:b.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-indigo-600 text-white uppercase tracking-wide",children:"Recommand"})}),b.jsxs("div",{className:"p-6 flex-1",children:[b.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:a.name}),b.jsx("p",{className:"mt-4 text-sm text-gray-500",children:a.description}),b.jsxs("p",{className:"mt-8",children:[b.jsx("span",{className:"text-4xl font-extrabold text-gray-900",children:s==="monthly"?`${a.price.monthly}`:`${a.price.yearly}`}),b.jsxs("span",{className:"text-base font-medium text-gray-500",children:["/",s==="monthly"?"mois":"an"]})]}),b.jsx("ul",{className:"mt-6 space-y-4",children:a.features.map(l=>b.jsxs("li",{className:"flex items-start",children:[b.jsx("div",{className:"flex-shrink-0",children:b.jsx("svg",{className:"h-6 w-6 text-green-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:b.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),b.jsx("p",{className:"ml-3 text-sm text-gray-700",children:l})]},l))})]}),b.jsx("div",{className:"p-6 bg-gray-50 rounded-b-lg",children:b.jsx("button",{onClick:()=>o(a.id),disabled:e||t===a.id,className:`w-full flex items-center justify-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white ${t===a.id?"bg-green-600 hover:bg-green-700 cursor-default":a.recommended?"bg-indigo-600 hover:bg-indigo-700":"bg-gray-800 hover:bg-gray-900"} focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors duration-200`,children:t===a.id?"Plan Actuel":a.buttonText})})]},a.id))})]})})},oFe=()=>{const[t,e]=z.useState(()=>localStorage.getItem("palfrog-theme")||"auto");return z.useEffect(()=>{const n=document.documentElement,s=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",r=t==="auto"?s:t;n.setAttribute("data-theme",r),n.classList.add("theme-transition"),localStorage.setItem("palfrog-theme",t)},[t]),z.useEffect(()=>{const n=window.matchMedia("(prefers-color-scheme: dark)"),s=()=>{t==="auto"&&document.documentElement.setAttribute("data-theme",n.matches?"dark":"light")};return n.addEventListener("change",s),()=>n.removeEventListener("change",s)},[t]),{theme:t,setTheme:e}};const aFe=()=>{const[t,e]=z.useState(""),[n,s]=z.useState([]),[r,i]=z.useState(!1),[o,a]=z.useState(null),[l,c]=z.useState(!1),{createPeerConnection:u,setActiveChat:d,onlineUsers:h}=Be(),{setCurrentView:f}=_t(),[p,m]=z.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{}}),g=async k=>{i(!0);try{const C=await Vo.searchUsers(k);s(C)}catch(C){console.error("Failed to search users:",C)}finally{i(!1)}};z.useEffect(()=>{g("")},[]),z.useEffect(()=>{const k=setTimeout(()=>{g(t)},300);return()=>clearTimeout(k)},[t]);const y=k=>{e(k.target.value)},x=async k=>{try{await Vo.addFriend(k),g(t),Yt.success("Ami ajout avec succs !")}catch{Yt.error("Erreur lors de l'ajout de l'ami")}},v=k=>{m({isOpen:!0,title:"Bloquer un utilisateur",message:"Voulez-vous vraiment bloquer cet utilisateur ?",isDangerous:!0,onConfirm:async()=>{try{await Vo.blockUser(k),g(t),Yt.success("Utilisateur bloqu")}catch{Yt.error("Erreur lors du blocage")}m(C=>({...C,isOpen:!1}))}})},w=async k=>{try{await Vo.unblockUser(k),g(t),Yt.success("Utilisateur dbloqu")}catch{Yt.error("Erreur lors du dblocage")}},S=async k=>{try{await o6.createConversation([k]),d(k),await u(k),f("chat")}catch(C){console.error("Erreur lors de la cration de la conversation:",C),d(k),f("chat")}};return b.jsxs("div",{className:"flex flex-col h-full bg-white/50 backdrop-blur-sm",children:[b.jsx(yA,{isOpen:p.isOpen,title:p.title,message:p.message,onConfirm:p.onConfirm,onCancel:()=>m(k=>({...k,isOpen:!1})),isDangerous:p.isDangerous}),b.jsxs("div",{className:"p-4 border-b border-gray-200/60",children:[b.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-3",children:"Rechercher un ami"}),b.jsxs("div",{className:"relative",children:[b.jsx("input",{type:"text",placeholder:"Nom d'utilisateur ou email...",value:t,onChange:y,className:"w-full pl-10 pr-4 py-2 rounded-xl border border-gray-200 focus:border-primary-500 focus:ring-2 focus:ring-primary-200 outline-none transition-all"}),b.jsx("span",{className:"absolute left-3 top-2.5 text-gray-400",children:""})]})]}),b.jsxs("div",{className:"flex-1 overflow-y-auto p-2 space-y-2",children:[r&&b.jsx("div",{className:"text-center p-4 text-gray-500",children:"Chargement..."}),!r&&n.length===0&&b.jsxs("div",{className:"text-center p-8 text-gray-500",children:["Aucun utilisateur trouv",b.jsx("p",{className:"text-xs mt-2 text-gray-400",children:"(Vous ne pouvez pas vous rechercher vous-mme)"})]}),n.map(k=>{const C=h.find(T=>T.userId===k.id),N=(C==null?void 0:C.avatarUrl)||k.avatarUrl;return b.jsxs("div",{className:"bg-white p-3 rounded-xl shadow-sm border border-gray-100 flex items-center justify-between group hover:shadow-md transition-all cursor-pointer",onDoubleClick:()=>S(k.id),children:[b.jsxs("div",{className:"flex items-center gap-3",children:[N?b.jsx("img",{src:N,alt:k.username,className:"w-10 h-10 rounded-full object-cover shadow-sm"}):b.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-indigo-500 to-purple-500 flex items-center justify-center text-white font-bold",children:k.username[0].toUpperCase()}),b.jsxs("div",{children:[b.jsx("div",{className:"font-medium text-gray-800",children:k.username}),b.jsx("div",{className:"text-xs text-gray-500",children:k.email})]})]}),b.jsxs("div",{className:"flex items-center gap-2",children:[b.jsx("button",{onClick:T=>{T.stopPropagation(),a(k),c(!0)},className:"p-2 text-purple-500 hover:bg-purple-50 rounded-lg transition-colors",title:"Voir profil",children:""}),k.friendStatus==="ACCEPTED"?b.jsx("button",{onClick:()=>S(k.id),className:"p-2 text-blue-500 hover:bg-blue-50 rounded-lg transition-colors",title:"Envoyer un message",children:""}):k.friendStatus==="BLOCKED"?b.jsx("button",{onClick:()=>w(k.id),className:"px-3 py-1.5 bg-orange-100 text-orange-600 rounded-lg text-xs font-medium hover:bg-orange-200 transition-colors",title:"Dbloquer cet utilisateur",children:"Dbloquer"}):b.jsx("button",{onClick:()=>x(k.id),className:"p-2 text-green-600 hover:bg-green-50 rounded-lg transition-colors",title:"Ajouter aux amis",children:""}),k.friendStatus!=="BLOCKED"&&b.jsx("button",{onClick:()=>v(k.id),className:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors",title:"Bloquer",children:""})]})]},k.id)})]}),b.jsx(Cb,{isOpen:l,onClose:()=>c(!1),user:o,isOnline:o?h.some(k=>k.userId===o.id):!1})]})};function lFe(){const{isAuthenticated:t,ui:e,setShowSignup:n,getProfile:s,setCurrentView:r}=_t(),i=e.showSignup,{currentTier:o}=BT();return oFe(),z.useEffect(()=>{t&&s().catch(console.error)},[t,s]),t?b.jsx(sFe,{children:b.jsxs(hne,{children:[b.jsx(kY,{position:"top-right",toastOptions:{className:"",style:{background:"#fff",color:"#333",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)",borderRadius:"12px",padding:"16px",fontSize:"14px"},success:{iconTheme:{primary:"#10B981",secondary:"#fff"}},error:{iconTheme:{primary:"#EF4444",secondary:"#fff"}}}}),b.jsxs(z.Suspense,{fallback:b.jsx(ALe,{}),children:[b.jsx(fne,{}),b.jsx(ILe,{}),b.jsx(rFe,{}),e.currentView==="chat"&&b.jsxs("div",{className:"flex h-full",children:[b.jsx("div",{className:"w-80 border-r border-gray-200/60 hidden md:block bg-white/30 backdrop-blur-sm",children:b.jsx(TLe,{})}),b.jsx("div",{className:"flex-1 flex flex-col min-w-0",children:b.jsx(CLe,{})})]}),e.currentView==="contacts"&&b.jsxs("div",{className:"p-6 h-full flex flex-col",children:[b.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Tous les contacts"}),b.jsx("div",{className:"flex-1 bg-white/30 backdrop-blur-sm rounded-2xl shadow-sm overflow-hidden",children:b.jsx(a6,{})})]}),e.currentView==="friend-search"&&b.jsx("div",{className:"p-6 h-full flex flex-col",children:b.jsx("div",{className:"flex-1 bg-white/30 backdrop-blur-sm rounded-2xl shadow-sm overflow-hidden",children:b.jsx(aFe,{})})}),e.currentView==="bridge"&&b.jsx("div",{className:"p-6 h-full overflow-y-auto",children:b.jsx(_Le,{})}),e.currentView==="social"&&b.jsx("div",{className:"p-6 h-full overflow-y-auto",children:b.jsx(WLe,{})}),e.currentView==="analytics"&&b.jsx("div",{className:"p-6 h-full overflow-y-auto",children:b.jsx(ZLe,{})}),e.currentView==="settings"&&b.jsxs("div",{className:"p-6 h-full overflow-y-auto",children:[b.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Paramtres"}),b.jsxs("div",{className:"max-w-2xl space-y-6",children:[o==="free"&&b.jsxs("div",{className:"bg-gradient-to-br from-indigo-500 to-purple-600 rounded-2xl p-6 text-white shadow-lg transform transition-all hover:scale-[1.01]",children:[b.jsxs("div",{className:"flex items-center justify-between",children:[b.jsxs("div",{children:[b.jsx("h3",{className:"font-bold text-xl mb-2",children:"Passez  Pro "}),b.jsx("p",{className:"text-indigo-100 mb-4 max-w-md",children:"Dbloquez l'IA illimite, le stockage tendu et des fonctionnalits exclusives pour booster votre productivit."})]}),b.jsx("div",{className:"hidden sm:block text-4xl",children:""})]}),b.jsx("button",{onClick:()=>r("pricing"),className:"bg-white text-indigo-600 px-6 py-2.5 rounded-xl font-bold hover:bg-indigo-50 transition-colors shadow-sm",children:"Voir les plans disponibles"})]}),b.jsx(ELe,{}),b.jsx(tL,{})]})]}),e.currentView==="security"&&b.jsxs("div",{className:"p-6 h-full overflow-y-auto",children:[b.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Scurit"}),b.jsx("div",{className:"max-w-2xl space-y-6",children:b.jsx(tL,{})})]}),e.currentView==="pricing"&&b.jsx("div",{className:"p-6 h-full overflow-y-auto",children:b.jsx(iFe,{})})]})]})}):b.jsxs("div",{children:[i?b.jsx(t7,{}):b.jsx(e7,{}),b.jsx("div",{className:"fixed bottom-8 right-8 z-50",children:b.jsxs("button",{onClick:()=>n(!i),className:"group flex items-center space-x-2 bg-white/90 backdrop-blur-sm px-6 py-3 rounded-full shadow-lg hover:shadow-xl transition-all duration-300 border border-gray-100 hover:border-primary-200",children:[b.jsx("span",{className:"text-sm font-medium text-gray-600 group-hover:text-primary-600 transition-colors",children:i?"Dj un compte ? Connectez-vous":"Pas encore de compte ? Crez-en un ici"}),b.jsx("span",{className:"text-lg group-hover:translate-x-1 transition-transform duration-300",children:i?"":""})]})})]})}mS.createRoot(document.getElementById("root")).render(b.jsx(Fs.StrictMode,{children:b.jsx(lFe,{})}));export{yA as C,Fs as R,bs as _,Be as a,pr as b,Er as c,jz as d,D2 as e,Vo as f,_t as g,yu as h,b as j,z as r,pFe as s,zr as u,Yt as z};
