import{u as H,a as T,r as n,j as e,f as A}from"./index-1a54a5af.js";const P=()=>{const{currentCall:t,localStream:c,remoteStream:o,isAudioMuted:b,isVideoOff:l,isScreenSharing:L,endCall:M,toggleAudio:C,toggleVideo:S,toggleScreenShare:z}=H(),{onlineUsers:j}=T(),[f,x]=n.useState(""),[r,y]=n.useState("normal"),[u,k]=n.useState({x:0,y:0}),[m,N]=n.useState(!1),[g,E]=n.useState({x:0,y:0}),w=n.useRef(null),d=n.useRef(null),V=n.useRef(null);n.useEffect(()=>{if(typeof window<"u"){const i=Math.min(640,window.innerWidth*.9),s=Math.min(480,window.innerHeight*.9);k({x:(window.innerWidth-i)/2,y:(window.innerHeight-s)/2})}},[]);const $=i=>{r==="normal"&&(N(!0),E({x:i.clientX-u.x,y:i.clientY-u.y}))},v=n.useCallback(i=>{m&&r==="normal"&&k({x:i.clientX-g.x,y:i.clientY-g.y})},[m,g,r]),p=n.useCallback(()=>{N(!1)},[]);if(n.useEffect(()=>(m&&(window.addEventListener("mousemove",v),window.addEventListener("mouseup",p)),()=>{window.removeEventListener("mousemove",v),window.removeEventListener("mouseup",p)}),[m,v,p]),n.useEffect(()=>{(async()=>{if(!(t!=null&&t.peerId))return;const s=j.find(a=>a.userId===t.peerId);if(s){x(s.username);return}try{const h=(await A.getFriends()).find(R=>R.friend.id===t.peerId);if(h){x(h.friend.username);return}}catch(a){console.warn("Failed to fetch friends for name resolution",a)}x(t.peerId)})()},[t==null?void 0:t.peerId,j]),n.useEffect(()=>{w.current&&c&&!l&&(w.current.srcObject=c)},[c,l]),n.useEffect(()=>{if(d.current&&o){d.current.srcObject=o,d.current.play().catch(()=>{});const i=()=>{var s;(s=d.current)==null||s.play().catch(()=>{})};return o.getVideoTracks().forEach(s=>{s.addEventListener("unmute",i)}),()=>{o.getVideoTracks().forEach(s=>{s.removeEventListener("unmute",i)})}}},[o]),!t)return null;const W=()=>{if(!t.startTime)return"00:00";const i=t.endTime||new Date,s=Math.floor((i.getTime()-t.startTime.getTime())/1e3),a=Math.floor(s/60).toString().padStart(2,"0"),h=(s%60).toString().padStart(2,"0");return`${a}:${h}`},I=()=>{switch(r){case"fullscreen":return{inset:0};case"minimized":return{bottom:"1rem",right:"1rem",width:"320px",height:"180px"};case"normal":default:return{left:`${u.x}px`,top:`${u.y}px`,width:"640px",height:"480px",maxWidth:"95vw",maxHeight:"95vh"}}};return e.jsxs(e.Fragment,{children:[r!=="minimized"&&e.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm z-40"}),e.jsxs("div",{ref:V,className:`fixed z-50 bg-gray-900 shadow-2xl overflow-hidden flex flex-col transition-all duration-300 ease-in-out border border-gray-700
                    ${r==="fullscreen"?"rounded-none":"rounded-2xl"}
                `,style:I(),children:[e.jsxs("div",{className:`absolute top-0 left-0 right-0 h-14 bg-gradient-to-b from-black/80 to-transparent z-20 flex justify-between items-start p-4 ${r==="normal"?"cursor-move":""}`,onMouseDown:$,children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`w-2.5 h-2.5 rounded-full ${t.status==="active"?"bg-green-500":"bg-yellow-500"} animate-pulse`}),e.jsx("span",{className:"text-white text-sm font-medium shadow-black drop-shadow-md",children:t.status==="active"?W():"Connexion..."})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>y(r==="minimized"?"normal":"minimized"),className:"p-1.5 text-white/80 hover:text-white hover:bg-white/10 rounded-lg transition-colors",title:r==="minimized"?"Agrandir":"R√©duire",children:r==="minimized"?"‚ÜóÔ∏è":"üîΩ"}),e.jsx("button",{onClick:()=>y(r==="fullscreen"?"normal":"fullscreen"),className:"p-1.5 text-white/80 hover:text-white hover:bg-white/10 rounded-lg transition-colors",title:r==="fullscreen"?"Quitter plein √©cran":"Plein √©cran",children:r==="fullscreen"?"‚ÜôÔ∏è":"‚õ∂"})]})]}),e.jsxs("div",{className:"flex-1 relative bg-gray-900",children:[t.type==="video"&&o?e.jsx("video",{ref:d,autoPlay:!0,playsInline:!0,muted:!1,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gray-800",children:e.jsxs("div",{className:"text-center text-white",children:[e.jsx("div",{className:`bg-primary-500 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg ${r==="minimized"?"w-12 h-12":"w-24 h-24"}`,children:e.jsx("span",{className:`${r==="minimized"?"text-xl":"text-3xl"} font-bold`,children:f?f.charAt(0).toUpperCase():"?"})}),r!=="minimized"&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-2xl font-bold mb-1",children:f||"Utilisateur inconnu"}),e.jsxs("p",{className:"text-gray-400 text-sm uppercase tracking-wider font-medium",children:["Appel ",t.type==="audio"?"audio":"vid√©o"]})]})]})}),t.type==="video"&&c&&!l&&e.jsx("div",{className:`absolute bg-gray-900 rounded-lg overflow-hidden shadow-2xl border border-gray-700 transition-all duration-300
                            ${r==="minimized"?"bottom-2 right-2 w-20 h-14":"bottom-4 right-4 w-48 h-36"}
                        `,children:e.jsx("video",{ref:w,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover transform scale-x-[-1]"})})]}),r!=="minimized"&&e.jsx("div",{className:"bg-gray-800/90 backdrop-blur-md p-4 border-t border-gray-700",children:e.jsxs("div",{className:"flex justify-center space-x-4",children:[e.jsx("button",{onClick:C,className:`w-12 h-12 rounded-full flex items-center justify-center transition-all duration-200 ${b?"bg-red-500 hover:bg-red-600":"bg-gray-600 hover:bg-gray-500"}`,children:b?e.jsxs("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 016 0v6a3 3 0 01-3 3z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v8m4-4H8"})]}):e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 016 0v6a3 3 0 01-3 3z"})})}),t.type==="video"&&e.jsx("button",{onClick:S,className:`w-12 h-12 rounded-full flex items-center justify-center transition-all duration-200 ${l?"bg-red-500 hover:bg-red-600":"bg-gray-600 hover:bg-gray-500"}`,children:l?e.jsxs("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2 2l20 20"})]}):e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),t.type==="video"&&e.jsx("button",{onClick:z,className:`w-12 h-12 rounded-full flex items-center justify-center transition-all duration-200 ${L?"bg-blue-500 hover:bg-blue-600":"bg-gray-600 hover:bg-gray-500"}`,children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2M9 7a2 2 0 012-2h2a2 2 0 012 2m0 10V7m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 00-2-2h-2a2 2 0 00-2 2"})})}),e.jsx("button",{onClick:M,className:"w-12 h-12 bg-red-500 rounded-full flex items-center justify-center hover:bg-red-600 transition-all duration-200 transform hover:scale-110 shadow-lg",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})})]})]})};export{P as CallInterface};
